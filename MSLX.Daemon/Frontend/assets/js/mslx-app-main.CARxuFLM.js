import{d as ne,o,b as S,n as $e,e as se,f as nt,h as t,r as $,i as Ie,j as nl,w as ol,k as v,l as D,m as a,p as e,F as ce,q as fe,s as it,t as I,u as N,v as Qt,x as $s,y as b,z as c,A as Fa,T as Yt,K as il,B as et,C as oa,D as xt,M as B,E as be,G as rl,H as ul,I as dl,J as cl,L as Qe,N as Da,O as Vt,P as pa,Q as xs,R as As,S as va,U as Mt,V as Lt,W as Ft,X as ml,Y as pl,Z as dt,_ as Oa,$ as Aa,a0 as vl,a1 as kt,a2 as Xe,a3 as Cs,a4 as fl,a5 as Ss,a6 as gl,a7 as mt,a8 as _l,a9 as Ze,aa as hl,ab as fa,ac as yl,ad as Je,ae as at,af as Is,ag as bl,ah as $t,ai as Ut,aj as wl,ak as kl,al as $l,am as st,an as Dt,ao as xl,ap as St,aq as Al,ar as Vs,as as vt,at as Ms,au as Us,av as Rt,aw as Cl,ax as Ot,ay as Zt,az as Ls,aA as Sl,aB as Il,aC as Et,aD as Vl,aE as Ml,aF as Ul,aG as Bs,aH as zs,aI as Ht,aJ as Tt,aK as Ll,aL as ga,aM as Ps,aN as Sa,aO as Ia,aP as Bl,aQ as Va,aR as Jt,aS as Ma,aT as ra,aU as Rs,aV as pt,aW as ua,aX as _a,aY as zl,aZ as Pl,a_ as Rl,a$ as es,b0 as Ua,b1 as El,b2 as Tl,b3 as Fl,b4 as Dl,b5 as Es,b6 as Ts,b7 as Ol,b8 as Fs,b9 as Ds,ba as jl,bb as Nl,bc as Kl,bd as ql,be as Gl,bf as Hl,bg as Jl,bh as Wl,bi as Xl,bj as Os,bk as Ql,bl as Yl,bm as js,bn as Zl,bo as en,bp as tn,bq as an,br as ts,bs as sn,bt as ln,bu as nn}from"./mslx-core.DZvKyUP2.js";import{a3 as La,a4 as Ns,a5 as on,a6 as wt,a7 as rn,a8 as un,a9 as Ct,aa as dn,ab as cn,ac as mn,ad as Gt,ae as pe,af as Ks,ag as qs,ah as pn}from"./mslx-libs.emslgIvx.js";import{i as da,L as Gs}from"./mslx-charts.DdwWzlHk.js";import{o as vn,a as fn,d as gn,t as _n,h as hn,e as yn,j as bn,y as wn,f as kn}from"./mslx-editor.BDhGHaM4.js";import{H as $n,w as xn,_ as An,K as as,T as ss,C as Cn}from"./mslx-formatter.B-70lPdB.js";const Sn="modulepreload",In=function(s){return"/"+s},ls={},We=function(l,n,u){let i=Promise.resolve();if(n&&n.length>0){let m=function(g){return Promise.all(g.map(y=>Promise.resolve(y).then(L=>({status:"fulfilled",value:L}),L=>({status:"rejected",reason:L}))))};document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),r=f?.nonce||f?.getAttribute("nonce");i=m(n.map(g=>{if(g=In(g),g in ls)return;ls[g]=!0;const y=g.endsWith(".css"),L=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${g}"]${L}`))return;const A=document.createElement("link");if(A.rel=y?"stylesheet":Sn,y||(A.as="script"),A.crossOrigin="",A.href=g,r&&A.setAttribute("nonce",r),document.head.appendChild(A),y)return new Promise((P,w)=>{A.addEventListener("load",P),A.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${g}`)))})}))}function d(f){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=f,window.dispatchEvent(r),!r.defaultPrevented)throw f}return i.then(f=>{for(const r of f||[])r.status==="rejected"&&d(r.reason);return l().catch(d)})},Vn=["src"],Mn=ne({__name:"index",props:{url:String,type:{type:String,default:"layout"}},setup(s){const l=s,n=se(()=>{const{type:u}=l;return["thumbnail-container",{"thumbnail-circle":u==="circle","thumbnail-layout":u==="layout"}]});return(u,i)=>(o(),S("img",{class:$e(n.value),src:s.url},null,10,Vn))}}),ue=(s,l)=>{const n=s.__vccOpts||s;for(const[u,i]of l)n[u]=i;return n},Un=ue(Mn,[["__scopeId","data-v-bc3a7420"]]),Ln={DEFAULT:{"--td-brand-color":"#0052d9","--td-brand-color-1":"#f2f3ff","--td-brand-color-2":"#d9e1ff","--td-brand-color-3":"#b5c7ff","--td-brand-color-4":"#8eabff","--td-brand-color-5":"#618dff","--td-brand-color-6":"#366ef4","--td-brand-color-7":"#0052d9","--td-brand-color-8":"#003cab","--td-brand-color-9":"#002a7c","--td-brand-color-10":"#001a57"},CYAN:{"--td-brand-color":"#0594FA","--td-brand-color-1":"#d7eefe","--td-brand-color-2":"#aeddfd","--td-brand-color-3":"#84cafd","--td-brand-color-4":"#58b8fc","--td-brand-color-5":"#29a4fb","--td-brand-color-6":"#0594FA","--td-brand-color-7":"#29a4fb","--td-brand-color-8":"#0594FA","--td-brand-color-9":"#0378df","--td-brand-color-10":"#01409b"},GREEN:{"--td-brand-color":"#00A870","--td-brand-color-1":"#8dffd9","--td-brand-color-2":"#00f2a2","--td-brand-color-3":"#00dc92","--td-brand-color-4":"#00c583","--td-brand-color-5":"#00A870","--td-brand-color-6":"#009a5d","--td-brand-color-7":"#00c583","--td-brand-color-8":"#00A870","--td-brand-color-9":"#009a5d","--td-brand-color-10":"#004a14"},ORANGE:{"--td-brand-color":"#ED7B2F","--td-brand-color-1":"#fce5d7","--td-brand-color-2":"#f8cdaf","--td-brand-color-3":"#f4b285","--td-brand-color-4":"#f19659","--td-brand-color-5":"#ED7B2F","--td-brand-color-6":"#e75510","--td-brand-color-7":"#f19659","--td-brand-color-8":"#ED7B2F","--td-brand-color-9":"#e75510","--td-brand-color-10":"#7f0a02"},RED:{"--td-brand-color":"#E34D59","--td-brand-color-1":"#fbe5e7","--td-brand-color-2":"#f7ccd0","--td-brand-color-3":"#f3b2b8","--td-brand-color-4":"#ef989f","--td-brand-color-5":"#ea7b84","--td-brand-color-6":"#E34D59","--td-brand-color-7":"#ea7b84","--td-brand-color-8":"#E34D59","--td-brand-color-9":"#e42c3a","--td-brand-color-10":"#8d0309"},PINK:{"--td-brand-color":"#ED49B4","--td-brand-color-1":"#fce5f4","--td-brand-color-2":"#facae9","--td-brand-color-3":"#f7aede","--td-brand-color-4":"#f491d2","--td-brand-color-5":"#f172c5","--td-brand-color-6":"#ED49B4","--td-brand-color-7":"#f172c5","--td-brand-color-8":"#ED49B4","--td-brand-color-9":"#e80f9d","--td-brand-color-10":"#8f025e"},PURPLE:{"--td-brand-color":"#834EC2","--td-brand-color-1":"#eee6f7","--td-brand-color-2":"#ddceee","--td-brand-color-3":"#ccb6e6","--td-brand-color-4":"#bb9edc","--td-brand-color-5":"#ab87d5","--td-brand-color-6":"#9a6fce","--td-brand-color-7":"#9a6fce","--td-brand-color-8":"#834EC2","--td-brand-color-9":"#783ac3","--td-brand-color-10":"#4c1397"},YELLOW:{"--td-brand-color":"#EBB105","--td-brand-color-1":"#fde9ab","--td-brand-color-2":"#fbd152","--td-brand-color-3":"#EBB105","--td-brand-color-4":"#dda204","--td-brand-color-5":"#ca8d03","--td-brand-color-6":"#b67803","--td-brand-color-7":"#fbd152","--td-brand-color-8":"#EBB105","--td-brand-color-9":"#dda204","--td-brand-color-10":"#603100"}},Hs={textColor:"rgba(0, 0, 0, 0.9)",placeholderColor:"rgba(0, 0, 0, 0.35)",borderColor:"#dcdcdc",containerColor:"#fff"},Bn={textColor:"rgba(255, 255, 255, 0.9)",placeholderColor:"rgba(255, 255, 255, 0.35)",borderColor:"#5e5e5e",containerColor:"#242424"};function zn(s){return s.replace(/([A-Z])/g,"_$1").toUpperCase()}function Pn(s,l){const n=/^#[A-F\d]{6}$/i.test(s)?s:zn(s);return l[n||"DEFAULT"]}function Rn(s,l,n){const u=n==="dark";let i=l.indexOf(s);return u&&(l.reverse().map(f=>{const[r,m,g]=La.colorTransform(f,"hex","hsl");return La.colorTransform([r,Number(m)-4,g],"hsl","hex")}),i=5,l[0]=`${l[i]}20`),{"--td-brand-color":l[i],"--td-brand-color-1":l[0],"--td-brand-color-2":l[1],"--td-brand-color-3":l[2],"--td-brand-color-4":l[3],"--td-brand-color-5":l[4],"--td-brand-color-6":l[5],"--td-brand-color-7":i>0?l[i-1]:s,"--td-brand-color-8":l[i],"--td-brand-color-9":i>8?s:l[i+1],"--td-brand-color-10":l[9]}}function En(s,l,n){const i=n==="dark"?`:root[theme-color='${s}'][theme-mode='dark']`:`:root[theme-color='${s}']`,d=document.createElement("style");d.type="text/css",d.innerText=`${i}{
    --td-brand-color: ${l["--td-brand-color"]};
    --td-brand-color-1: ${l["--td-brand-color-1"]};
    --td-brand-color-2: ${l["--td-brand-color-2"]};
    --td-brand-color-3: ${l["--td-brand-color-3"]};
    --td-brand-color-4: ${l["--td-brand-color-4"]};
    --td-brand-color-5: ${l["--td-brand-color-5"]};
    --td-brand-color-6: ${l["--td-brand-color-6"]};
    --td-brand-color-7: ${l["--td-brand-color-7"]};
    --td-brand-color-8: ${l["--td-brand-color-8"]};
    --td-brand-color-9: ${l["--td-brand-color-9"]};
    --td-brand-color-10: ${l["--td-brand-color-10"]};
  }`,document.head.appendChild(d)}const Tn="conic-gradient(from 90deg at 50% 50%, #FF0000 -19.41deg, #FF0000 18.76deg, #FF8A00 59.32deg, #FFE600 99.87deg, #14FF00 141.65deg, #00A3FF 177.72deg, #0500FF 220.23deg, #AD00FF 260.13deg, #FF00C7 300.69deg, #FF0000 340.59deg, #FF0000 378.76deg)",Fn=ne({__name:"index",props:{value:{type:String}},setup(s){const l=rt(),n=s,u=se(()=>{const{value:i}=n,{colorList:d}=l;return{background:i!=="dynamic"?Pn(i,d)["--td-brand-color"]:Tn}});return(i,d)=>(o(),S("div",{style:nt(u.value),class:"color-container"},null,4))}}),ns=ue(Fn,[["__scopeId","data-v-e8478b14"]]),ja={showFooter:!0,isSidebarCompact:!1,showBreadcrumb:!1,mode:"auto",layout:"side",splitMenu:!1,isFooterAside:!1,isSidebarFixed:!0,isHeaderFixed:!0,showHeader:!0,backgroundTheme:"blueGrey",brandTheme:"default",enableCustomTheme:!1},Dn={xmlns:"http://www.w3.org/2000/svg",width:"88",height:"48",fill:"none"};function On(s,l){return o(),S("svg",Dn,[...l[0]||(l[0]=[t("path",{fill:"#13161B",d:"M0 0h88v48H0z"},null,-1),t("path",{fill:"#949EAA","fill-rule":"evenodd",d:"M52.533 26.87q-.748.129-1.533.13a9 9 0 0 1-8.533-11.87A9 9 0 0 0 44 33a9 9 0 0 0 8.533-6.13","clip-rule":"evenodd"},null,-1)])])}const jn={render:On},Nn={xmlns:"http://www.w3.org/2000/svg",width:"88",height:"48",fill:"none"};function Kn(s,l){return o(),S("svg",Nn,[...l[0]||(l[0]=[t("path",{fill:"var(--td-component-border)",d:"M0 0h88v48H0z"},null,-1),t("path",{fill:"var(--td-text-color-primary)","fill-rule":"evenodd",d:"M44 20.583a3.417 3.417 0 1 0 0 6.833 3.417 3.417 0 0 0 0-6.833M39.083 24a4.917 4.917 0 1 1 9.834 0 4.917 4.917 0 0 1-9.834 0M43.25 17.333v-2.5h1.5v2.5zM48.184 18.755l1.767-1.767 1.06 1.06-1.767 1.768zM50.667 23.25h2.5v1.5h-2.5zM49.244 28.184l1.768 1.767-1.06 1.06-1.768-1.767zM44.75 30.666v2.5h-1.5v-2.5zM39.816 29.244l-1.767 1.768-1.061-1.061 1.767-1.768zM37.333 24.75h-2.5v-1.5h2.5zM38.756 19.816l-1.768-1.768 1.06-1.06 1.768 1.767z","clip-rule":"evenodd"},null,-1)])])}const qn={render:Kn},Gn={xmlns:"http://www.w3.org/2000/svg",width:"88",height:"48",fill:"none"};function Hn(s,l){return o(),S("svg",Gn,[...l[0]||(l[0]=[t("path",{fill:"var(--td-component-border)",d:"M0 0h88v48H0z"},null,-1),t("path",{fill:"var(--td-text-color-primary)",d:"M42.863 14.052v2.708h1.625v-2.708z"},null,-1),t("path",{fill:"var(--td-text-color-primary)","fill-rule":"evenodd",d:"M38.349 23.982a5.326 5.326 0 1 1 10.653 0 5.326 5.326 0 0 1-10.653 0m5.326-3.701a3.701 3.701 0 1 0 0 7.403 3.701 3.701 0 0 0 0-7.403M52.208 26.781h-2.621l-2.06 6.699 1.552.478.511-1.661h2.614l.511 1.66 1.554-.477zm-.503 3.89-.697-2.265h-.221l-.697 2.266z","clip-rule":"evenodd"},null,-1),t("path",{fill:"var(--td-text-color-primary)",d:"m48.208 18.3 1.915-1.914 1.149 1.15-1.915 1.914zM53.606 23.17h-2.709v1.625h2.709zM44.488 31.205v2.708h-1.625v-2.708zM37.228 31.579l1.915-1.915-1.15-1.15-1.914 1.916zM36.453 24.795h-2.708V23.17h2.708zM36.079 17.535l1.915 1.915 1.149-1.15-1.915-1.914z"},null,-1)])])}const Jn={render:Hn},Wn={class:"setting-container"},Xn={style:{textAlign:"center",marginTop:"8px"}},Qn={class:"setting-item-row"},Yn={class:"setting-layout-drawer"},Zn=ne({__name:"setting",setup(s){const l=rt(),n=$(window.innerWidth),u=se(()=>n.value<480),i=se(()=>u.value?"85%":"408px"),d=()=>{n.value=window.innerWidth},f=["side","top"],r=["default","cyan","green","yellow","orange","red","pink","purple","dynamic"],m=[{type:"auto",text:"跟随系统"},{type:"light",text:"明亮"},{type:"dark",text:"暗黑"}],y=$({...(()=>{const p={...ja};for(const V in p)Object.prototype.hasOwnProperty.call(p,V)&&(p[V]=l[V]);return p})()});u.value&&y.value.layout==="side"&&(y.value.layout="top");const L=$(!1),A=se({get(){return l.showSettingPanel},set(p){l.updateConfig({showSettingPanel:p})}}),P=p=>{const V=La.getPaletteByGradation({colors:[p],step:10})[0],{mode:h}=l,E=Rn(p,V,h);l.addColor({[p]:E}),l.updateConfig({...y.value,brandTheme:p}),En(p,E,h)};Ie(()=>{const p=document.querySelector(".dynamic-color-btn");p&&p.addEventListener("click",()=>{L.value=!0}),window.addEventListener("resize",d)}),nl(()=>{window.removeEventListener("resize",d)});const w=(p,V)=>{!p&&V.trigger==="document"&&(L.value=p)},C=p=>p==="light"?qn:p==="dark"?jn:Jn,k=()=>{l.updateConfig({showSettingPanel:!1})},z=p=>`https://tdesign.gtimg.com/tdesign-pro/setting/${p}.png`;return ol(()=>{l.updateConfig(y.value)}),(p,V)=>{const h=v("t-radio-button"),E=v("t-radio-group"),F=v("t-switch"),R=v("t-color-picker-panel"),H=v("t-popup"),q=v("t-form"),U=v("t-drawer");return o(),D(U,{visible:A.value,"onUpdate:visible":V[4]||(V[4]=_=>A.value=_),size:i.value,footer:!1,header:"面板样式","close-btn":!0,class:"setting-drawer-container",onCloseBtnClick:k},{default:a(()=>[t("div",Wn,[e(q,{ref:"form",data:y.value,"label-align":"left"},{default:a(()=>[V[6]||(V[6]=t("div",{class:"setting-group-title"},"主题模式",-1)),e(E,{modelValue:y.value.mode,"onUpdate:modelValue":V[0]||(V[0]=_=>y.value.mode=_)},{default:a(()=>[(o(),S(ce,null,fe(m,(_,x)=>t("div",{key:x,class:"setting-layout-drawer"},[t("div",null,[(o(),D(h,{key:x,value:_.type},{default:a(()=>[(o(),D(it(C(_.type))))]),_:2},1032,["value"])),t("p",Xn,I(_.text),1)])])),64))]),_:1},8,["modelValue"]),V[7]||(V[7]=t("div",{class:"setting-group-title"},"个性化",-1)),t("div",Qn,[V[5]||(V[5]=t("span",{class:"setting-item-label"},"开启背景美化",-1)),e(F,{modelValue:y.value.enableCustomTheme,"onUpdate:modelValue":V[1]||(V[1]=_=>y.value.enableCustomTheme=_)},null,8,["modelValue"])]),V[8]||(V[8]=t("div",{class:"setting-group-title"},"主题色",-1)),e(E,{modelValue:y.value.brandTheme,"onUpdate:modelValue":V[2]||(V[2]=_=>y.value.brandTheme=_)},{default:a(()=>[(o(!0),S(ce,null,fe(r.slice(0,r.length-1),(_,x)=>(o(),S("div",{key:x,class:"setting-layout-drawer"},[(o(),D(h,{key:x,value:_,class:"setting-layout-color-group"},{default:a(()=>[e(ns,{value:_},null,8,["value"])]),_:2},1032,["value"]))]))),128)),t("div",Yn,[e(H,{"destroy-on-close":"","expand-animation":"",placement:"bottom-right",trigger:"click",visible:L.value,"overlay-style":{padding:0},onVisibleChange:w},{content:a(()=>[e(R,{"on-change":P,"color-modes":["monochrome"],format:"HEX","swatch-colors":[]})]),default:a(()=>[e(h,{value:r[r.length-1],class:"setting-layout-color-group dynamic-color-btn"},{default:a(()=>[e(ns,{value:r[r.length-1]},null,8,["value"])]),_:1},8,["value"])]),_:1},8,["visible"])])]),_:1},8,["modelValue"]),V[9]||(V[9]=t("div",{class:"setting-group-title"},"导航布局",-1)),e(E,{modelValue:y.value.layout,"onUpdate:modelValue":V[3]||(V[3]=_=>y.value.layout=_)},{default:a(()=>[(o(),S(ce,null,fe(f,(_,x)=>t("div",{key:x,class:"setting-layout-drawer"},[(o(),D(h,{key:x,value:_},{default:a(()=>[e(Un,{src:z(_)},null,8,["src"])]),_:2},1032,["value"]))])),64))]),_:1},8,["modelValue"])]),_:1},8,["data"])])]),_:1},8,["visible","size"])}}}),Na=ue(Zn,[["__scopeId","data-v-9f31e17e"]]),Te="mslx-webpanel",zt="mslx-web-token",Pt="mslx-base-url",eo={class:"menu-text"},to={class:"menu-text"},ao=ne({name:"MenuContent",__name:"MenuContent",props:{navData:{type:Array,default:()=>[]},isHorizontal:{type:Boolean,default:!1},maxItemCount:{type:Number,default:3}},setup(s){const l=s,n=se(()=>ca()),u=se(()=>{const{navData:A}=l;return f(A)}),i=se(()=>l.isHorizontal?u.value.slice(0,l.maxItemCount):u.value),d=se(()=>l.isHorizontal?u.value.slice(l.maxItemCount):[]),f=(A,P)=>A?(A.sort((w,C)=>(w.meta?.orderNo||0)-(C.meta?.orderNo||0)),A.map(w=>{const C=P&&!w.path.includes(P)?`${P}/${w.path}`:w.path;return{path:C,title:w.meta?.title,icon:w.meta?.icon||"",children:f(w.children,C),meta:w.meta,redirect:w.redirect}}).filter(w=>w.meta&&w.meta.hidden!==!0)):[],r=A=>{const{frameSrc:P,frameBlank:w}=A.meta;return P&&w?P.match(/(http|https):\/\/([\w.]+\/?)\S*/):null},m=A=>n.value.startsWith(A.path)?n.value:A.meta?.single?A.redirect:A.path,g=A=>A.icon&&typeof A.icon=="string",y=A=>Ns(A.icon)&&typeof A.icon.render=="function"?{can:!0,render:A.icon.render}:{can:!1,render:null},L=A=>{window.open(A)};return(A,P)=>{const w=v("t-icon"),C=v("t-menu-item"),k=v("menu-content",!0),z=v("t-submenu");return o(),S("div",{id:"menu-wrapper",class:$e(["modern-menu-wrapper",{"is-horizontal":s.isHorizontal}])},[(o(!0),S(ce,null,fe(i.value,p=>(o(),S(ce,{key:p.path},[!p.children||!p.children.length||p.meta?.single?(o(),S(ce,{key:0},[r(p)?(o(),D(C,{key:0,name:p.path,value:m(p),class:"modern-menu-item",onClick:V=>L(r(p)[0])},{icon:a(()=>[g(p)?(o(),D(w,{key:0,name:p.icon},null,8,["name"])):y(p).can?(o(),D(it(y(p).render),{key:1,class:"t-icon"})):N("",!0)]),default:a(()=>[t("span",eo,I(p.title),1)]),_:2},1032,["name","value","onClick"])):(o(),D(C,{key:1,name:p.path,value:m(p),to:p.path,class:"modern-menu-item"},{icon:a(()=>[g(p)?(o(),D(w,{key:0,name:p.icon},null,8,["name"])):y(p).can?(o(),D(it(y(p).render),{key:1,class:"t-icon"})):N("",!0)]),default:a(()=>[t("span",to,I(p.title),1)]),_:2},1032,["name","value","to"]))],64)):(o(),D(z,{key:1,name:p.path,value:p.path,title:p.title,class:"modern-submenu"},{icon:a(()=>[g(p)?(o(),D(w,{key:0,name:p.icon},null,8,["name"])):y(p).can?(o(),D(it(y(p).render),{key:1,class:"t-icon"})):N("",!0)]),default:a(()=>[p.children?(o(),D(k,{key:0,"nav-data":p.children,"is-horizontal":!1},null,8,["nav-data"])):N("",!0)]),_:2},1032,["name","value","title"]))],64))),128)),s.isHorizontal&&d.value.length>0?(o(),D(z,{key:0,name:"more-menu",title:"更多",class:"modern-submenu"},{icon:a(()=>[e(w,{name:"ellipsis"})]),default:a(()=>[e(k,{"nav-data":d.value,"is-horizontal":!1},null,8,["nav-data"])]),_:1})):N("",!0)],2)}}}),Ba=ue(ao,[["__scopeId","data-v-3b61b27d"]]),Ka="/assets/png/mslx-logo.BqgIBdpC.png",so=["src"],lo={key:1,class:"header-operate-left show-on-mobile"},no={class:"operations-container"},oo={class:"header-user-account",style:{"margin-left":"6px"}},io=ne({__name:"Header",props:{theme:{type:String,default:"light"},layout:{type:String,default:"top"},showLogo:{type:Boolean,default:!0},menu:{type:Array,default:()=>[]},isFixed:{type:Boolean,default:!1},isCompact:{type:Boolean,default:!1},maxLevel:{type:Number,default:3}},setup(s){const l=Fe(),n=s,u=Qt(),i=rt(),d=()=>{i.updateConfig({showSettingPanel:!0})},f=se(()=>ca()),r=se(()=>[`${Te}-header-layout`]),m=se(()=>{const{isFixed:C,layout:k,isCompact:z}=n;return[{[`${Te}-header-menu`]:!C,[`${Te}-header-menu-fixed`]:C,[`${Te}-header-menu-fixed-side`]:k==="side"&&C,[`${Te}-header-menu-fixed-side-compact`]:k==="side"&&C&&z}]}),g=()=>{i.updateConfig({isSidebarCompact:!i.isSidebarCompact})},y=C=>{u.push(C)},L=C=>{C&&u.push(C)},A=()=>{u.push({path:"/login",query:{redirect:encodeURIComponent(u.currentRoute.value.fullPath)}})},P=()=>{window.open("https://github.com/MSLTeam/MSLX")},w=()=>{window.open("https://mslx.mslmc.cn")};return(C,k)=>{const z=v("t-icon"),p=v("t-button"),V=v("t-menu"),h=v("t-popup"),E=v("t-tooltip"),F=v("t-dropdown-item"),R=v("t-dropdown-menu"),H=v("t-avatar"),q=v("t-dropdown"),U=v("t-head-menu");return o(),S("div",{class:$e(r.value)},[e(U,{class:$e(m.value),theme:s.theme,"expand-type":"popup",value:f.value},$s({logo:a(()=>[s.showLogo?(o(),S("span",{key:0,class:$e(`${b(Te)}-side-nav-logo-wrapper`),onClick:k[0]||(k[0]=_=>y("/dashboard/base"))},[t("img",{style:{width:"32px"},src:b(Ka),class:$e(`${b(Te)}-side-nav-logo-img`),alt:"logo"},null,10,so),t("span",{style:{"margin-left":"8px","font-size":"18px","font-weight":"bold","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap"},class:$e(`${b(Te)}-side-nav-logo-text hide-on-mobile`)}," MSLX 管理中心 ",2)],2)):N("",!0),s.layout=="side"?(o(),S("div",lo,[e(p,{theme:"default",shape:"square",variant:"text",onClick:g},{default:a(()=>[e(z,{class:"collapsed-icon",name:"view-list"})]),_:1})])):N("",!0)]),operations:a(()=>[t("div",no,[e(E,{placement:"bottom",content:"代码仓库",class:"hide-on-mobile"},{default:a(()=>[e(p,{theme:"default",shape:"square",variant:"text",onClick:P},{default:a(()=>[e(z,{name:"logo-github"})]),_:1})]),_:1}),e(E,{placement:"bottom",content:"帮助文档",class:"hide-on-mobile"},{default:a(()=>[e(p,{theme:"default",shape:"square",variant:"text",onClick:w},{default:a(()=>[e(z,{name:"help-circle"})]),_:1})]),_:1}),e(q,{"min-column-width":135,trigger:"click"},{dropdown:a(()=>[e(R,null,{default:a(()=>[e(F,{class:"operations-dropdown-container-item",onClick:k[1]||(k[1]=_=>y("/settings"))},{default:a(()=>[e(z,{name:"user-circle"}),k[2]||(k[2]=c("个人中心 ",-1))]),_:1}),e(F,{class:"operations-dropdown-container-item",onClick:A},{default:a(()=>[e(z,{name:"poweroff"}),k[3]||(k[3]=c("退出登录 ",-1))]),_:1})]),_:1})]),default:a(()=>[e(p,{class:"header-user-btn",theme:"default",variant:"text"},{icon:a(()=>[e(H,{image:b(l).userInfo.avatar},null,8,["image"])]),suffix:a(()=>[e(z,{name:"chevron-down"})]),default:a(()=>[t("div",oo,I(b(l).userInfo.name),1)]),_:1})]),_:1}),e(q,{"min-column-width":135,trigger:"click",class:"show-on-mobile"},{dropdown:a(()=>[e(R,null,{default:a(()=>[e(F,{class:"operations-dropdown-container-item",onClick:P},{default:a(()=>[e(z,{name:"logo-github"}),k[4]||(k[4]=c("代码仓库 ",-1))]),_:1}),e(F,{class:"operations-dropdown-container-item",onClick:w},{default:a(()=>[e(z,{name:"help-circle"}),k[5]||(k[5]=c("帮助文档 ",-1))]),_:1}),e(F,{class:"operations-dropdown-container-item",onClick:d},{default:a(()=>[e(z,{name:"setting"}),k[6]||(k[6]=c("系统设置 ",-1))]),_:1})]),_:1})]),default:a(()=>[e(p,{theme:"default",shape:"square",variant:"text"},{default:a(()=>[e(z,{name:"more"})]),_:1})]),_:1}),e(E,{placement:"bottom",content:"系统设置",class:"hide-on-mobile"},{default:a(()=>[e(p,{theme:"default",shape:"square",variant:"text",onClick:d},{default:a(()=>[e(z,{name:"setting"})]),_:1})]),_:1})])]),_:2},[s.layout!=="side"?{name:"default",fn:a(()=>[e(Ba,{class:"header-menu hide-on-mobile","nav-data":s.menu,"is-horizontal":!0},null,8,["nav-data"]),e(h,{placement:"bottom-left",class:"show-on-mobile header-menu-mobile-popup","overlay-style":{padding:"0",width:"100%",marginTop:"2px",boxShadow:"none",borderTop:"1px solid var(--td-border-level-1-color)"}},{content:a(()=>[e(V,{value:f.value,theme:s.theme,"expand-mutex":"",style:{width:"100vw"},onChange:L},{default:a(()=>[e(Ba,{"nav-data":s.menu},null,8,["nav-data"])]),_:1},8,["value","theme"])]),default:a(()=>[e(p,{style:{"margin-left":"-16px"},theme:"default",shape:"square",variant:"text"},{default:a(()=>[e(z,{name:"app"})]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["class","theme","value"])],2)}}}),ro=ue(io,[["__scopeId","data-v-f5039bf3"]]),os=ne({__name:"LayoutHeader",setup(s){const l=Wt(),n=rt(),{routers:u}=Fa(l),i=se(()=>n.layout==="mix"?n.splitMenu?u.value.map(d=>({...d,children:[]})):[]:u.value);return(d,f)=>b(n).showHeader?(o(),D(ro,{key:0,"show-logo":b(n).showHeaderLogo,theme:b(n).displayMode,layout:b(n).layout,"is-fixed":b(n).isHeaderFixed,menu:i.value,"is-compact":b(n).isSidebarCompact},null,8,["show-logo","theme","layout","is-fixed","menu","is-compact"])):N("",!0)}}),uo={};function co(s,l){const n=v("router-view");return o(),D(n,null,{default:a(({Component:u})=>[e(Yt,{name:"fade",mode:"out-in"},{default:a(()=>[(o(),D(il,null,[(o(),D(it(u)))],1024))]),_:2},1024)]),_:1})}const mo=ue(uo,[["render",co],["__scopeId","data-v-6214f40c"]]),po=ne({__name:"Breadcrumb",setup(s){const l=se(()=>{const n=et(),u=n.path.split("/");return u.shift(),u.reduce((d,f,r)=>(n.matched[r]?.meta?.hiddenBreadcrumb||Object.values(n.params).includes(f)||d.push({path:f,to:d[r-1]?`/${d[r-1].path}/${f}`:`/${f}`,title:n.matched[r]?.meta?.title??f}),d),[])});return(n,u)=>{const i=v("t-breadcrumbItem"),d=v("t-breadcrumb");return o(),D(d,{"max-item-width":"150",class:"tdesign-breadcrumb"},{default:a(()=>[(o(!0),S(ce,null,fe(l.value,f=>(o(),D(i,{key:f.to,to:f.to},{default:a(()=>[c(I(f.title),1)]),_:2},1032,["to"]))),128))]),_:1})}}}),vo=ue(po,[["__scopeId","data-v-b4121266"]]),fo={class:"glass-capsule design-card"},go={class:"copyright"},_o=ne({__name:"Footer",setup(s){return(l,n)=>(o(),S("footer",{class:$e(`${b(Te)}-footer-centered-lite`)},[t("div",fo,[n[0]||(n[0]=t("span",{class:"brand"},"MSLX-WEBPANEL",-1)),n[1]||(n[1]=t("span",{class:"divider"},"/",-1)),n[2]||(n[2]=t("span",{class:"brand"},"MSLTEAM",-1)),n[3]||(n[3]=t("span",{class:"divider"},"/",-1)),t("span",go,"© 2021-"+I(new Date().getFullYear()),1)])],2))}}),ho=ue(_o,[["__scopeId","data-v-05d9fb24"]]),is=ne({__name:"LayoutContent",setup(s){const l=rt();return(n,u)=>{const i=v("t-content"),d=v("t-footer"),f=v("t-layout");return o(),D(f,{class:$e(`${b(Te)}-layout`)},{default:a(()=>[e(i,{class:$e(`${b(Te)}-content-layout`)},{default:a(()=>[b(l).showBreadcrumb?(o(),D(vo,{key:0})):N("",!0),e(mo)]),_:1},8,["class"]),b(l).showFooter?(o(),D(d,{key:0,class:$e(`${b(Te)}-footer-layout`)},{default:a(()=>[e(ho)]),_:1},8,["class"])):N("",!0)]),_:1},8,["class"])}}}),yo="mslx-webpanel",bo="1.2.2",wo={dev:"vite --mode development","dev:linux":"vite --mode development","build:test":"vite build --mode test",build:"vue-tsc --noEmit && vite build --mode release && node generate-build-info.js",preview:"vite preview",lint:"eslint --ext .vue,.js,.jsx,.ts,.tsx ./ --max-warnings 0","lint:fix":"eslint --ext .vue,.js,jsx,.ts,.tsx ./ --max-warnings 0 --fix",stylelint:"stylelint src/**/*.{html,vue,sass,less}","stylelint:fix":"stylelint --fix src/**/*.{html,vue,vss,sass,less}",prepare:`node -e "if(require('fs').existsSync('.git')){process.exit(1)}" || is-ci || husky install`,"site:preview":"npm run build && cp -r dist _site",test:'echo "no test specified,work in process"',"test:coverage":'echo "no test:coverage specified,work in process"'},ko={"@codemirror/lang-javascript":"^6.2.4","@codemirror/lang-json":"^6.0.2","@codemirror/lang-yaml":"^6.1.2","@codemirror/language":"^6.12.1","@codemirror/legacy-modes":"^6.5.2","@codemirror/state":"^6.5.2","@codemirror/theme-one-dark":"^6.1.3","@codemirror/view":"^6.39.2","@eslint/js":"^9.38.0","@microsoft/signalr":"^10.0.0","@vueuse/core":"^14.2.1","@xterm/addon-fit":"^0.11.0","@xterm/xterm":"^6.0.0","ansi-colors":"^4.1.3",axios:"^1.13.5","cron-parser":"^5.4.0",dayjs:"^1.11.11",echarts:"^6.0.0",lodash:"4.17.23","md-editor-v3":"^6.1.0",nprogress:"^0.2.0",pinia:"^2.1.7","pinia-plugin-persistedstate":"^3.2.1","qrcode.vue":"^3.4.1",qs:"6.14.2","tdesign-icons-vue-next":"^0.4.1","tdesign-vue-next":"^1.18.2","tvision-color":"^1.6.0","typescript-eslint":"^8.46.2",vue:"^3.5.29","vue-clipboard3":"^2.0.0","vue-codemirror":"^6.1.1","vue-router":"^4.4.0"},$o={"@commitlint/cli":"^19.3.0","@commitlint/config-conventional":"^19.2.2","@types/lodash":"^4.17.23","@types/qs":"^6.9.15","@types/ws":"^8.5.10","@typescript-eslint/eslint-plugin":"^8.46.2","@typescript-eslint/parser":"^8.46.2","@vitejs/plugin-vue":"^6.0.3","@vitejs/plugin-vue-jsx":"^5.1.3","@vue/compiler-sfc":"^3.4.31","@vue/eslint-config-typescript":"^14.6.0",commitizen:"^4.3.0","cz-conventional-changelog":"^3.3.0",eslint:"^9.38.0","eslint-config-prettier":"^9.1.0","eslint-plugin-import":"^2.32.0","eslint-plugin-prettier":"^5.1.3","eslint-plugin-vue":"^10.7.0","eslint-plugin-vue-scoped-css":"^2.12.0",husky:"^9.1.1",less:"^4.2.0","lint-staged":"^15.2.7",prettier:"^3.3.3",stylelint:"^16.25.0","stylelint-less":"^3.0.0","stylelint-order":"^6.0.4",typescript:"^5.5.3",vite:"^7.3.1","vite-svg-loader":"^5.1.0","vue-tsc":"^2.0.26"},xo={commitizen:{path:"./node_modules/cz-conventional-changelog"}},Ao="MSLX Web Panel",qt={name:yo,version:bo,scripts:wo,dependencies:ko,devDependencies:$o,config:xo,"lint-staged":{"*.{js,jsx,vue,ts,tsx}":["prettier --write","npm run lint:fix","git add ."],"*.{html,vue,vss,sass,less}":["npm run stylelint:fix","git add ."]},description:Ao},Co=["src"],So={class:"version-container"},Io=991,Vo=ne({__name:"SideNav",props:{menu:{type:Array,default:()=>[]},showLogo:{type:Boolean,default:!0},isFixed:{type:Boolean,default:!0},layout:{type:String,default:""},headerHeight:{type:String,default:"64px"},theme:{type:String,default:"light"},isCompact:{type:Boolean,default:!1}},setup(s){const l=s,n=se(()=>rt().isSidebarCompact),u=se(()=>ca()),i=se(()=>{const L=ca(),A=L.substring(0,L.lastIndexOf("/")),P=mi();return on(P,A===""?[]:[A])}),d=se(()=>{const{isCompact:L}=l;return[`${Te}-sidebar-layout`,{[`${Te}-sidebar-compact`]:L}]}),f=se(()=>{const{showLogo:L,isFixed:A,layout:P}=l;return[`${Te}-side-nav`,{[`${Te}-side-nav-no-logo`]:!L,[`${Te}-side-nav-no-fixed`]:!A,[`${Te}-side-nav-mix-fixed`]:P==="mix"&&A}]}),r=Qt(),m=rt(),g=()=>{const L=window.innerWidth<=Io;m.updateConfig({isSidebarCompact:L})};Ie(()=>{g(),window.onresize=()=>{g()}});const y=()=>{r.push("/dashboard/base")};return(L,A)=>{const P=v("t-menu");return o(),S("div",{class:$e(d.value)},[e(P,{class:$e(f.value),theme:s.theme,value:u.value,collapsed:n.value,"default-expanded":i.value},{logo:a(()=>[s.showLogo?(o(),S("span",{key:0,class:$e(`${b(Te)}-side-nav-logo-wrapper`),style:nt(n.value?"display: flex; justify-content: center; width: 100%;":"display: flex; align-items: center; justify-content: flex-start; width: 100%;"),onClick:y},[t("img",{style:{width:"32px","margin-right":"8px"},src:b(Ka),class:$e(`${b(Te)}-side-nav-logo-img`),alt:"logo"},null,10,Co),n.value?N("",!0):(o(),S("span",{key:0,style:{"font-size":"18px","font-weight":"bold","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap"},class:$e(`${b(Te)}-side-nav-logo-text`)}," MSLX 管理中心 ",2))],6)):N("",!0)]),operations:a(()=>[t("span",So,I(n.value?"":"MSLX-WEBPANEL")+" v"+I(b(qt).version),1)]),default:a(()=>[e(Ba,{"nav-data":s.menu},null,8,["nav-data"])]),_:1},8,["class","theme","value","collapsed","default-expanded"]),t("div",{class:$e(`${b(Te)}-side-nav-placeholder${n.value?"-hidden":""}`)},null,2)],2)}}}),rs=ne({__name:"LayoutSideNav",setup(s){const l=et(),n=Wt(),u=rt(),{routers:i}=Fa(n),d=se(()=>{const{layout:f,splitMenu:r}=u;let m=i.value;return f==="mix"&&r&&m.forEach(g=>{l.path.indexOf(g.path)===0&&(m=g.children.map(y=>({...y,path:`${g.path}/${y.path}`})))}),m});return(f,r)=>b(u).showSidebar?(o(),D(Vo,{key:0,"show-logo":b(u).showSidebarLogo,layout:b(u).layout,"is-fixed":b(u).isSidebarFixed,menu:d.value,theme:b(u).displayMode,"is-compact":b(u).isSidebarCompact},null,8,["show-logo","layout","is-fixed","menu","theme","is-compact"])):N("",!0)}}),qa="/assets/jpg/mslx-bg_light_new.CL71WzMj.jpg",Ga="/assets/jpg/mslx-bg_night_new.CfCwUDBl.jpg";let bt=new Map;const us=s=>[s.method,s.url].join("&");class Mo{addPending(l){this.removePending(l);const n=us(l);l.cancelToken=l.cancelToken||new oa.CancelToken(u=>{bt.has(n)||bt.set(n,u)})}removeAllPending(){bt.forEach(l=>{l&&wt(l)&&l()}),bt.clear()}removePending(l){const n=us(l);if(bt.has(n)){const u=bt.get(n);u&&u(n),bt.delete(n)}}reset(){bt=new Map}}class Uo{instance;options;constructor(l){this.options=l,this.instance=oa.create(l),this.setupInterceptors()}createAxios(l){this.instance=oa.create(l)}getTransform(){const{transform:l}=this.options;return l}getAxios(){return this.instance}configAxios(l){this.instance&&this.createAxios(l)}setHeader(l){this.instance&&Object.assign(this.instance.defaults.headers,l)}setupInterceptors(){const l=this.getTransform();if(!l)return;const{requestInterceptors:n,requestInterceptorsCatch:u,responseInterceptors:i,responseInterceptorsCatch:d}=l,f=new Mo;this.instance.interceptors.request.use(r=>{const{headers:{ignoreRepeatRequest:m}}=r;return(m??this.options.requestOptions?.ignoreRepeatRequest)||f.addPending(r),n&&wt(n)&&(r=n(r,this.options)),r},void 0),u&&wt(u)&&this.instance.interceptors.request.use(void 0,u),this.instance.interceptors.response.use(r=>(r&&f.removePending(r.config),i&&wt(i)&&(r=i(r)),r),void 0),d&&wt(d)&&this.instance.interceptors.response.use(void 0,d)}supportFormData(l){const n=l.headers||this.options.headers;return(n?.["Content-Type"]||n?.["content-type"])!=="application/x-www-form-urlencoded;charset=UTF-8"||!Reflect.has(l,"data")||l.method?.toUpperCase()==="GET"?l:{...l,data:rn.stringify(l.data,{arrayFormat:"brackets"})}}get(l,n){return this.request({...l,method:"GET"},n)}post(l,n){return this.request({...l,method:"POST"},n)}put(l,n){return this.request({...l,method:"PUT"},n)}delete(l,n){return this.request({...l,method:"DELETE"},n)}patch(l,n){return this.request({...l,method:"PATCH"},n)}async request(l,n){let u=un(l);const i=this.getTransform(),{requestOptions:d}=this.options,f={...d,...n},{beforeRequestHook:r,requestCatchHook:m,transformRequestHook:g}=i||{};return r&&wt(r)&&(u=r(u,f)),u.requestOptions=f,u=this.supportFormData(u),new Promise((y,L)=>{this.instance.request(l.retryCount?l:u).then(A=>{if(g&&wt(g)){try{const P=g(A,f);y(P)}catch(P){L(P||new Error("请求错误!"))}return}y(A)}).catch(A=>{if(m&&wt(m)){L(m(A,f));return}oa.isAxiosError(A),L(A)})})}}const Lo="YYYY-MM-DD HH:mm:ss";function ds(s,l=!1){if(!s)return l?"":{};const n=new Date().getTime();return l?`?_t=${n}`:{_t:n}}function za(s){if(Object.prototype.toString.call(s)==="[object Object]")for(const l in s){if(s[l]&&s[l]._isAMomentObject&&(s[l]=s[l].format(Lo)),Ct(l)){const n=s[l];if(n)try{s[l]=Ct(n)?n.trim():n}catch(u){throw new Error(u)}}Ns(s[l])&&za(s[l])}}function Bo(s,l){let n="";for(const u in l)n+=`${u}=${encodeURIComponent(l[u])}&`;return n=n.replace(/&$/,""),/\?$/.test(s)?s+n:s.replace(/\/?$/,"?")+n}const zo={transformRequestHook:(s,l)=>{const{isTransformResponse:n,isReturnNativeResponse:u}=l,i=s.config.method?.toLowerCase();if(s.status===204||i==="put"||i==="patch"||u)return s;if(!n)return s.data;const{data:d}=s;if(!d)throw new Error("请求接口错误");if(d&&Reflect.has(d,"code")&&Reflect.has(d,"message")){const{code:r,message:m}=d;if(r===200)return d.data;throw new Error(m||`请求接口错误, 错误码: ${r}`)}else return d},beforeRequestHook:(s,l)=>{const{apiUrl:n,isJoinPrefix:u,urlPrefix:i,joinParamsToUrl:d,formatDate:f,joinTime:r=!0}=l;u&&i&&Ct(i)&&(s.url=`${i}${s.url}`),n&&Ct(n)&&!s.baseURL&&(s.url=`${n}${s.url}`);const m=s.params||{},g=s.data||!1;return f&&g&&!Ct(g)&&za(g),s.method?.toUpperCase()==="GET"?Ct(m)?(s.url=`${s.url+m}${ds(r,!0)}`,s.params=void 0):s.params=Object.assign(m||{},ds(r,!1)):Ct(m)?(s.url+=m,s.params=void 0):(f&&za(m),Reflect.has(s,"data")&&s.data&&(Object.keys(s.data).length>0||g instanceof FormData)?(s.data=g,s.params=m):(s.data=m,s.params=void 0),d&&(s.url=Bo(s.url,{...s.params,...s.data}))),s},requestInterceptors:(s,l)=>{const n=localStorage.getItem(zt),u=localStorage.getItem(Pt);return u&&!/^(https?:)?\/\//.test(s.url||"")&&!s.baseURL&&(s.baseURL=u),n&&s?.requestOptions?.withToken!==!1&&(s.headers.hasAuthorization()||(s.headers["x-user-token"]=n)),s},responseInterceptors:s=>s,responseInterceptorsCatch:s=>{const{response:l}=s;if(l&&l.data){const u=l.data?.message;return u?Promise.reject(new Error(u)):Promise.reject(s)}return Promise.reject(s)}};function Po(s){return new Uo(dn({authenticationScheme:"",timeout:10*1e3,withCredentials:!1,headers:{"Content-Type":"application/json;charset=UTF-8"},transform:zo,requestOptions:{apiUrl:"",isJoinPrefix:!0,urlPrefix:"",isReturnNativeResponse:!1,isTransformResponse:!0,joinParamsToUrl:!1,formatDate:!0,joinTime:!1,ignoreRepeatRequest:!0,withToken:!0,retry:{count:3,delay:1e3}}},{}))}const Q=Po();function Ro(){return Q.get({url:"/api/settings"})}function Eo(s){return Q.post({url:"/api/settings",data:s})}function To(s){return Q.post({url:"/api/settings/webpanel/style",data:s})}function Fo(){return Q.get({url:"/api/settings/webpanel/style"})}async function ea(){return await Q.post({url:"/api/files/upload/init"})}async function ta(s,l,n,u,i){const d=new FormData;return d.append("index",l.toString()),d.append("file",n),await Q.post({url:`/api/files/upload/chunk/${s}`,data:d,headers:{"Content-Type":"multipart/form-data"},timeout:300*1e3,onUploadProgress:u,signal:i})}async function aa(s,l){return await Q.post({url:`/api/files/upload/finish/${s}`,data:{totalChunks:l},timeout:120*1e3})}async function It(s){return await Q.post({url:`/api/files/upload/delete/${s}`})}async function Do(s){return await Q.get({url:`/api/files/upload/inspect/${s}`,timeout:60*1e3})}async function Oo(s,l=""){return await Q.get({url:`/api/files/instance/${s}/lists`,params:{path:l}})}async function ha(s,l){return await Q.get({url:`/api/files/instance/${s}/content`,params:{path:l}})}function Ha(s,l,n){return Q.post({url:`/api/files/instance/${s}/content`,data:{path:l,content:n}})}function jo(s,l,n){return Q.post({url:`/api/files/instance/${s}/directory`,data:{path:l,name:n}})}function No(s,l,n){return Q.post({url:`/api/files/instance/${s}/rename`,data:{oldPath:l,newPath:n}})}function Ko(s,l){return Q.post({url:`/api/files/instance/${s}/delete`,data:{paths:l}})}function qo(s,l,n,u){return Q.post({url:`/api/files/instance/${s}/upload`,data:{uploadId:l,fileName:n,currentPath:u}})}function Go(s,l){return Q.get({url:`/api/files/instance/${s}/download`,params:{path:l},responseType:"blob"})}function Ho(s,l,n,u){return Q.post({url:`/api/files/instance/${s}/compress`,data:{sources:l,targetName:n,currentPath:u}})}function Jo(s){return Q.get({url:`/api/files/task/compress/${s}`})}function Wo(s,l,n,u="utf-8",i=!0){return Q.post({url:`/api/files/instance/${s}/decompress`,data:{fileName:l,currentPath:n,encoding:u,createSubFolder:i}})}function Xo(s){return Q.get({url:`/api/files/task/decompress/${s}`})}async function Qo(s,l,n){return await Q.post({url:`/api/files/instance/${s}/chmod`,data:{path:l,mode:n}})}async function Pa(s,l,n){return await Q.get({url:`/api/files/pm/instance/${s}/list?${n?"checkClient=true":""}`,params:{mode:l}})}async function Yo(s,l,n,u){return await Q.post({url:`/api/files/pm/instance/${s}/set`,data:{mode:l,action:n,targets:u}})}function Zo(s,l,n){return Q.post({url:`/api/files/instance/${s}/copy`,data:{sourcePaths:l,targetPath:n},timeout:120*1e3})}function ei(s,l,n){return Q.post({url:`/api/files/instance/${s}/move`,data:{sourcePaths:l,targetPath:n},timeout:120*1e3})}function ti(s,l){return Q.post({url:"api/static/images/upload",data:{fileKey:s,fileName:l}})}const jt=xt("webpanel",{state:()=>({settings:{webPanelStyleDarkBackgroundOpacity:1,webPanelStyleDarkComponentsOpacity:.4,webpPanelTerminalBlurDark:5,webPanelStyleLightBackground:"",webPanelStyleLightBackgroundOpacity:1,webPanelStyleLightComponentsOpacity:.6,webpPanelTerminalBlurLight:5,webPanelStyleDarkBackground:"",webPanelColorizeLogLevel:1},loading:!1,submitLoading:!1}),actions:{async fetchSettings(){this.loading=!0;try{const s=await Fo();this.settings=s}catch(s){console.error("获取面板样式失败",s)}finally{this.loading=!1}},async saveSettings(){this.submitLoading=!0;try{await To(this.settings),B.success("面板样式保存成功")}catch(s){B.error("保存失败: "+s.message)}finally{this.submitLoading=!1}},async uploadImage(s){if(!s)return B.error("文件对象无效"),null;if(!["image/png","image/jpeg","image/webp"].includes(s.type))return B.error("仅支持 PNG, JPG, WEBP 格式的图片"),null;if(!(s.size/1024/1024<10))return B.error("图片大小不能超过 10MB"),null;try{const{uploadId:u}=await ea();return await ta(u,1,s),await aa(u,1),await ti(u,s.name),B.success(`上传成功: ${s.name}`),s.name}catch(u){return B.error("上传失败: "+(u.message||"网络错误")),null}}},persist:{key:"webpanel-style-storage",paths:["settings"]}}),ai=ne({__name:"index",setup(s){const l=et(),n=rt(),u=Fe(),i=jt(),d=Fa(n),f=(y,L)=>y?y.startsWith("http")?y:`${u.baseUrl||window.location.origin}/api/static/images/${y}`:L,r=se(()=>{const y=i.settings,L=f(y.webPanelStyleLightBackground,qa),A=f(y.webPanelStyleDarkBackground,Ga);return{"--bg-img-light":`url('${L}')`,"--bg-img-dark":`url('${A}')`,"--bg-op-light":y.webPanelStyleLightBackgroundOpacity,"--bg-op-dark":y.webPanelStyleDarkBackgroundOpacity,"--comp-op-light":y.webPanelStyleLightComponentsOpacity,"--comp-op-dark":y.webPanelStyleDarkComponentsOpacity,"--term-blur-light":`${y.webpPanelTerminalBlurLight??5}px`,"--term-blur-dark":`${y.webpPanelTerminalBlurDark??5}px`}}),m=se(()=>n.enableCustomTheme),g=se(()=>[{"t-layout--with-sider":n.showSidebar}]);return Ie(()=>{i.fetchSettings()}),be(()=>l.path,()=>{document.querySelector(`.${Te}-layout`).scrollTo({top:0,behavior:"smooth"})}),(y,L)=>{const A=v("t-aside"),P=v("t-header"),w=v("t-content"),C=v("t-layout");return o(),S("div",{class:$e(["global-layout-bg",{"custom-theme-enabled":m.value}]),style:nt(r.value)},[b(d).layout.value==="side"?(o(),D(C,{key:"side",class:$e(g.value)},{default:a(()=>[e(A,null,{default:a(()=>[e(rs)]),_:1}),e(C,null,{default:a(()=>[e(P,null,{default:a(()=>[e(os)]),_:1}),e(w,null,{default:a(()=>[e(is)]),_:1})]),_:1})]),_:1},8,["class"])):(o(),D(C,{key:"no-side"},{default:a(()=>[e(P,null,{default:a(()=>[e(os)]),_:1}),e(C,{class:$e(g.value)},{default:a(()=>[e(rs),e(is)]),_:1},8,["class"])]),_:1})),e(Na)],6)}}}),ct=ue(ai,[["__scopeId","data-v-f3c5347d"]]),si=[{path:"/dashboard",redirect:"/dashboard/base",component:ct,name:"dashboard",meta:{title:"仪表盘",icon:"dashboard"},children:[{path:"base",name:"DashboardBaseIndex",component:()=>We(()=>Promise.resolve().then(()=>fu),void 0),meta:{title:"仪表盘",hidden:!0}}]},{path:"/instance",component:ct,name:"instance",meta:{title:"服务端管理",icon:"server"},children:[{path:"list",name:"InstanceList",component:()=>We(()=>Promise.resolve().then(()=>Pu),void 0),meta:{title:"服务端列表",icon:"grid-view"}},{path:"create",name:"InstanceCreate",component:()=>We(()=>Promise.resolve().then(()=>Km),void 0),meta:{title:"创建服务端",icon:"add"}},{path:"backup",name:"InstanceBackupManager",component:()=>We(()=>Promise.resolve().then(()=>mp),void 0),meta:{title:"备份管理",icon:"backup"}}]},{path:"/frp",component:ct,name:"frp",meta:{title:"隧道管理",icon:"rocket"},children:[{path:"list",name:"FrpList",component:()=>We(()=>Promise.resolve().then(()=>iv),void 0),meta:{title:"隧道列表",icon:"format-vertical-align-left"}},{path:"create",name:"FrpCreate",component:()=>We(()=>Promise.resolve().then(()=>Mf),void 0),meta:{title:"创建隧道",icon:"add"}}]}],li=Object.freeze(Object.defineProperty({__proto__:null,default:si},Symbol.toStringTag,{value:"Module"})),ni=[{path:"/frp/console",component:ct,meta:{hidden:!0},children:[{path:":frpId",name:"FrpConsole",component:()=>We(()=>Promise.resolve().then(()=>kg),void 0),meta:{title:"隧道控制台",hidden:!0,activeMenu:"/frp/list"}}]},{path:"/instance/console",component:ct,meta:{hidden:!0},children:[{path:":serverId",name:"InstanceConsole",component:()=>We(()=>Promise.resolve().then(()=>O2),void 0),meta:{title:"服务器控制台",hidden:!0,activeMenu:"/instance/list"}}]},{path:"/instance/files",component:ct,meta:{hidden:!0},children:[{path:":serverFilesId",name:"InstanceFiles",component:()=>We(()=>Promise.resolve().then(()=>Ww),void 0),meta:{title:"文件管理",hidden:!0,activeMenu:"/instance/list"}}]}],oi=Object.freeze(Object.defineProperty({__proto__:null,default:ni},Symbol.toStringTag,{value:"Module"})),cs=()=>We(()=>Promise.resolve().then(()=>Zw),void 0),ii=[{path:"/frame",name:"Frame",component:ct,redirect:"/frame/doc",meta:{icon:"earth",title:"链接"},children:[{path:"MSLX",name:"MSLX",component:cs,meta:{frameSrc:"https://mslx.mslmc.cn",frameBlank:!0,title:"MSLX 文档",icon:"book"}},{path:"MSLUser",name:"MSLUser",component:cs,meta:{frameSrc:"https://user.mslmc.net",frameBlank:!0,title:"MSL 用户中心",icon:"user-arrow-left"}}]}],ri=Object.freeze(Object.defineProperty({__proto__:null,default:ii},Symbol.toStringTag,{value:"Module"})),ui=[{path:"/users",component:ct,name:"usersBase",meta:{title:"用户管理",icon:"user"},children:[{path:"",name:"users",component:()=>We(()=>Promise.resolve().then(()=>_k),void 0),meta:{title:"用户管理",hidden:!0}}]},{path:"/settings",component:ct,name:"settingsBase",meta:{title:"设置",icon:"setting"},children:[{path:"",name:"settings",component:()=>We(()=>Promise.resolve().then(()=>Fk),void 0),meta:{title:"设置",hidden:!0}}]},{path:"/about",component:ct,name:"aboutBase",meta:{title:"关于面板",icon:"info-circle"},children:[{path:"",name:"about",component:()=>We(()=>Promise.resolve().then(()=>D$),void 0),meta:{title:"关于面板",hidden:!0}}]}],di=Object.freeze(Object.defineProperty({__proto__:null,default:ui},Symbol.toStringTag,{value:"Module"})),ms=Object.assign({"./modules/base.ts":li,"./modules/components.ts":oi,"./modules/iframe.ts":ri,"./modules/others.ts":di}),Js=[];Object.keys(ms).forEach(s=>{const l=ms[s].default||{},n=Array.isArray(l)?[...l]:[l];Js.push(...n)});const Ra=[...Js],ci=[{path:"/login",name:"login",component:()=>We(()=>Promise.resolve().then(()=>g3),void 0)},{path:"/oauth/callback",name:"oauth",component:()=>We(()=>Promise.resolve().then(()=>B3),void 0)},{path:"/",redirect:"/dashboard/base"},{path:"/404",name:"404",component:()=>We(()=>Promise.resolve().then(()=>D3),void 0)},{path:"/:w+",name:"404Page",redirect:"/404"}],Ws=[...ci,...Ra],mi=()=>{const s=[];return Ws.forEach(l=>{l.meta&&l.meta.expanded&&s.push(l.path),l.children&&l.children.length>0&&l.children.filter(n=>n.meta&&n.meta.expanded).forEach(n=>{s.push(l.path),s.push(`${l.path}/${n.path}`)})}),cn(s)},ca=(s=3)=>{const l=ft.currentRoute.value;return l.path?l.meta?.activeMenu?l.meta.activeMenu:l.path.split("/").filter((n,u)=>u<=s&&u>0).map(n=>`/${n}`).join(""):""};function Me(s){s.includes("http")?window.open(s):ft.replace(s)}const ft=rl({history:ul(),routes:Ws,scrollBehavior(){return{el:"#app",top:0,behavior:"smooth"}}});function pi(s,l){const n=[],u=[];return s.forEach(i=>{const d=[];i.children?.forEach(f=>{const r=f.meta?.roleCode||f.name;l.indexOf(r)!==-1?d.push(f):u.push(f)}),d.length>0&&(i.children=d,n.push(i))}),{accessedRouters:n,removeRoutes:u}}const Wt=xt("permission",{state:()=>({whiteListRouters:["/login","/oauth/callback"],routers:[],removeRoutes:[],dynamicRoutesAdded:[]}),actions:{async initRoutes(s){this.clearRoutes();let l=[],n=[];if(s.includes("all"))l=Ra;else{const i=pi(Ra,s);l=i.accessedRouters,n=i.removeRoutes}const u=[];l.forEach(i=>{ft.addRoute(i),i.name&&u.push(i.name)}),this.routers=l,this.removeRoutes=n,this.dynamicRoutesAdded=u},async clearRoutes(){this.dynamicRoutesAdded.forEach(l=>{ft.hasRoute(l)&&ft.removeRoute(l)}),this.routers=[],this.removeRoutes=[],this.dynamicRoutesAdded=[]}}});function vi(){return Wt(ya)}const ps="remembered_url",vs="remembered_username",Ca={name:"",username:"",avatar:"",id:"",version:"",systemInfo:{netVersion:"",osType:"",osVersion:"",osArchitecture:"",hostname:"",docker:!1},targetFrontendVersion:{desktop:"",panel:""},roles:[]},Fe=xt("user",{state:()=>({token:localStorage.getItem(zt)||"",baseUrl:localStorage.getItem(Pt)||window.location.origin,userInfo:{...Ca}}),getters:{roles:s=>s.userInfo?.roles||[]},actions:{async checkConnection(s){let l=s;s&&!/^(https?:)?\/\//.test(s)&&(l=`http://${s}`);try{return await Q.get({url:"/api/ping",baseURL:l||void 0,timeout:3e3}),!0}catch{return!1}},async login(s){const{url:l,username:n,password:u,checked:i}=s;let d=l;d&&!/^(https?:)?\/\//.test(d)&&(d=`http://${d}`);const f=d||"";try{const r=await Q.post({url:"/api/auth/login",baseURL:f,data:{username:n,password:u}});this.token=r.token,this.baseUrl=f,localStorage.setItem(zt,r.token),localStorage.setItem(Pt,f),i?(localStorage.setItem(ps,l||""),localStorage.setItem(vs,n)):(localStorage.removeItem(ps),localStorage.removeItem(vs)),await this.getUserInfo()}catch(r){throw console.error("Login failed:",r),r}},async loginByOAuth(s){try{this.token=s.token,localStorage.setItem(zt,s.token),this.baseUrl||(this.baseUrl=window.location.origin,localStorage.setItem(Pt,this.baseUrl)),await this.getUserInfo()}catch(l){throw console.error("OAuth登录失败:",l),l}},async getUserInfo(){if(this.token)try{const s=await Q.get({url:"/api/status"});this.userInfo={...Ca,...s,name:s.user||s.username,roles:["all"]},await Wt().initRoutes(this.userInfo.roles)}catch(s){console.error("Get user info failed:",s),await this.logout(),Me("/login")}},async logout(){await Wt().clearRoutes(),localStorage.removeItem(zt),localStorage.removeItem(Pt),this.token="",this.baseUrl="",this.userInfo={...Ca}},async removeToken(){this.token=""}},persist:{afterRestore:s=>{s.store.token&&s.store.getUserInfo()}}});function Xs(){return Fe(ya)}const fi={...ja,showSettingPanel:!1,colorList:Ln,chartColors:Hs,systemTheme:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"},rt=xt("setting",{state:()=>fi,getters:{showSidebar:s=>s.layout!=="top",showSidebarLogo:s=>s.layout==="side",showHeaderLogo:s=>s.layout!=="side",displayMode:s=>s.mode==="auto"?s.systemTheme:s.mode},actions:{async changeMode(s){let l=s;s==="auto"&&(l=this.systemTheme);const n=l==="dark";document.documentElement.setAttribute("theme-mode",n?"dark":""),this.chartColors=n?Bn:Hs},setSystemTheme(s){this.systemTheme=s,this.mode==="auto"&&this.changeMode("auto")},changeBrandTheme(s){document.documentElement.setAttribute("theme-color",s)},addColor(s){this.colorList={...this.colorList,...s}},updateConfig(s){for(const l in s)s[l]!==void 0&&(this[l]=s[l]),l==="mode"&&this.changeMode(s[l]),l==="brandTheme"&&this.changeBrandTheme(s[l])}},persist:{paths:[...mn(ja),"colorList","chartColors"]}});async function gi(){return Q.get({url:"/api/update/info"})}async function _i(){return Q.get({url:"/api/update/download"})}async function hi(){return Q.post({url:"/api/update"})}const Ja=xt("update",()=>{const s=$(!1),l=$(null),n=$(null),u=$(!1);return{showUpdateModal:s,updateInfo:l,downloadInfo:n,loading:u,checkAppUpdate:async(f=!1)=>{if(!u.value){u.value=!0;try{const m=await gi();if(m&&m.needUpdate){if(!f&&localStorage.getItem("mslx-skip-version")===m.latestVersion){console.log(`[Update] 用户已跳过版本 ${m.latestVersion}`);return}l.value=m;try{const g=await _i();n.value=g}catch(g){console.error("获取下载链接失败",g),n.value={web:"",file:""}}s.value=!0,f&&B.success("发现新版本！")}else f&&B.success("当前已是最新版本")}catch(r){console.error("[Update] 检查更新失败:",r),f&&B.error("检查更新失败，请检查网络日志")}finally{u.value=!1}}},handleSkipVersion:()=>{l.value?.latestVersion&&(localStorage.setItem("mslx-skip-version",l.value.latestVersion),B.success("已跳过该版本，下次将不再提醒"),s.value=!1)}}}),ya=dl();ya.use(cl());Gt.configure({showSpinner:!1});ft.beforeEach(async(s,l,n)=>{window.document.title=s.meta.title?`${s.meta.title} | MSLX 控制台`:"MSLX 控制台",Gt.start();const u=Xs(),i=vi(),{whiteListRouters:d}=i,{token:f}=u;if(f){if(s.path==="/login"||s.path==="/oauth/callback"){n();return}const{roles:r}=u;if(r&&r.length>0)n();else try{await u.getUserInfo();const{roles:m}=u;await i.initRoutes(m),ft.hasRoute(s.name)?n():n("/")}catch(m){B.error(m),n({path:"/login",query:{redirect:encodeURIComponent(s.fullPath)}}),Gt.done()}}else d.indexOf(s.path)!==-1?n():n({path:"/login",query:{redirect:encodeURIComponent(s.fullPath)}}),Gt.done()});ft.afterEach(s=>{s.path==="/login"&&Xs().logout(),Gt.done()});const yi={class:"modal-header"},bi={class:"header-content"},wi={class:"title-row"},ki={class:"version-row"},$i={class:"modal-body"},xi={key:0,class:"status-container success"},Ai={key:1,class:"status-container docker-warn"},Ci={key:2,class:"status-container server-running-warn"},Si={class:"warn-icon-wrapper"},Ii={key:3,class:"status-container permission-wait"},Vi={key:4,class:"status-container updating"},Mi={key:0,class:"error-box"},Ui={class:"progress-info"},Li={class:"speed"},Bi={key:5},zi={style:{margin:"4px 0 0 0","line-height":"1.6"}},Pi={class:"log-scroll-area"},Ri={class:"log-text"},Ei={key:0,class:"modal-footer"},Ti={class:"primary-actions"},Fi={class:"secondary-grid"},Di={key:0,class:"sub-actions"},Oi={key:1,class:"modal-footer"},ji={key:2,class:"modal-footer"},Ni={key:3,class:"modal-footer"},Ki={class:"primary-actions"},qi=ne({__name:"UpdateModal",props:{visible:{type:Boolean},updateInfo:{},downloadInfo:{}},emits:["close","skip","success"],setup(s,{emit:l}){const n=s,u=l,i=Fe(),d=$(!1),f=$(0),r=$("0 KB/s"),m=$("准备中..."),g=$(!1),y=$(!1),L=$(!1),A=$("");let P=null;const w=se(()=>n.updateInfo?.status==="beta"),C=se(()=>{const U=i.userInfo?.systemInfo?.osType||"";return U.includes("macOS")||U.includes("OSX")}),k=se(()=>(i.userInfo?.systemInfo?.osType||"").toLowerCase().includes("linux")),z=U=>{U&&window.open(U,"_blank")},p=()=>{u("close"),Me("/instance/list")},V=()=>{if(d.value&&!L.value){B.warning("正在更新中，请勿关闭窗口");return}F(),u("close")},h=()=>{u("skip")},E=()=>{window.location.reload()},F=async()=>{if(P){try{await P.stop()}catch(U){console.error("Stop Hub Error:",U)}P=null}},R=async()=>{await F();const{baseUrl:U,token:_}=i,x=new URL("/api/hubs/daemonUpdate",U||window.location.origin);_&&x.searchParams.append("x-user-token",_),P=new Lt().withUrl(x.toString(),{withCredentials:!1}).configureLogging(Ft.Warning).withAutomaticReconnect([0,2e3,5e3,1e4]).build(),P.on("UpdateProgress",M=>{f.value=M.progress||0,r.value=M.speed||"",M.stage==="permission_check"?m.value="等待服务端确认权限...":M.stage==="restarting"?(console.log("[Update] 收到重启信号，准备轮询..."),m.value="服务正在重启...",F(),setTimeout(()=>{q()},3e3)):m.value=M.status||"正在处理..."}),P.on("UpdateFailed",M=>{d.value=!1,A.value=M||"更新失败",F()}),P.onclose(M=>{P&&(d.value&&f.value>=100?setTimeout(()=>{q()},6e3):M&&(d.value=!1,A.value=`连接断开: ${M.message}`))});try{await P.start()}catch(M){A.value=`连接更新服务失败: ${M.message}`,d.value=!1}},H=async()=>{if(!d.value){d.value=!0,g.value=!1,y.value=!1,A.value="",f.value=0,L.value=!1,await R();try{await hi()}catch(U){d.value=!1,F();const _=U.message||"";_.includes("Docker")||_.includes("容器")?g.value=!0:_.includes("运行")&&(_.includes("服务器")||_.includes("实例"))?y.value=!0:A.value=_||"请求更新失败，请检查网络或日志"}}},q=async()=>{m.value="服务正在重启，请稍候...";const U=async()=>{try{return await Q.get({url:"/api/ping",timeout:3e3}),!0}catch{return!1}},_=60;let x=0;const M=setInterval(async()=>{x++,await U()?(clearInterval(M),d.value=!1,L.value=!0,m.value="更新成功！",F(),setTimeout(()=>u("success"),1e3)):x>_&&(clearInterval(M),d.value=!1,A.value="服务重启超时，请手动刷新页面检查状态。",F())},2e3)};return Qe(()=>{F()}),(U,_)=>{const x=v("t-tag"),M=v("t-button"),J=v("t-link"),W=v("t-alert"),X=v("t-progress"),K=v("t-popconfirm"),G=v("t-dialog");return o(),D(G,{visible:n.visible,header:!1,footer:!1,"close-on-overlay-click":!1,"close-btn":!1,width:"500px",class:"update-modal","destroy-on-close":"",onClose:V},{default:a(()=>[t("div",yi,[t("div",bi,[t("div",wi,[t("h3",null,I(L.value?"更新完成":"发现新版本"),1),w.value?(o(),D(x,{key:0,theme:"warning",variant:"light"},{default:a(()=>[..._[2]||(_[2]=[c("Beta",-1)])]),_:1})):(o(),D(x,{key:1,theme:"success",variant:"light"},{default:a(()=>[..._[3]||(_[3]=[c("Release",-1)])]),_:1}))]),t("div",ki,[e(x,{variant:"outline",size:"small"},{default:a(()=>[c(I(s.updateInfo?.currentVersion),1)]),_:1}),_[4]||(_[4]=t("span",{class:"arrow"},"→",-1)),e(x,{theme:"primary",variant:"light-outline",size:"small"},{default:a(()=>[c(I(s.updateInfo?.latestVersion),1)]),_:1})])]),d.value?N("",!0):(o(),D(M,{key:0,variant:"text",shape:"circle",onClick:V},{icon:a(()=>[e(b(Da))]),_:1}))]),t("div",$i,[L.value?(o(),S("div",xi,[e(b(Vt),{size:"48px",class:"success-icon"}),_[5]||(_[5]=t("p",null,[t("b",null,"MSLX守护进程端"),c("已成功更新至最新版本")],-1)),_[6]||(_[6]=t("p",{class:"sub-text"},"请刷新页面以加载最新功能",-1))])):g.value?(o(),S("div",Ai,[e(W,{theme:"warning",title:"检测到 Docker 环境"},{message:a(()=>[_[8]||(_[8]=c(" 当前程序运行在 ",-1)),_[9]||(_[9]=t("b",null,"Docker 容器",-1)),_[10]||(_[10]=c(" 内，不支持热更新。",-1)),_[11]||(_[11]=t("br",null,null,-1)),_[12]||(_[12]=c("请使用以下命令或者参照 ",-1)),_[13]||(_[13]=t("b",null,"官方文档",-1)),_[14]||(_[14]=c(" 更新。",-1)),_[15]||(_[15]=t("br",null,null,-1)),e(J,{theme:"primary",href:"https://mslx.mslmc.cn/docs/install/docker/",target:"_blank",style:{"vertical-align":"baseline"}},{default:a(()=>[..._[7]||(_[7]=[t("b",null,"Docker安装/更新文档",-1)])]),_:1})]),_:1}),_[16]||(_[16]=t("div",{class:"code-block"},"sudo docker compose pull && docker compose up -d # 指令仅适用于Docker Compose安装方式。",-1))])):y.value?(o(),S("div",Ci,[t("div",Si,[e(b(pa),{size:"48px",style:{color:"var(--td-warning-color)"}})]),_[17]||(_[17]=t("p",{class:"warn-title"},"无法开始更新",-1)),_[18]||(_[18]=t("p",{class:"warn-desc"},[c(" 检测到当前有服务器实例正在运行。 "),t("br"),c("为了防止数据丢失，请先停止所有实例。 ")],-1))])):m.value.includes("等待服务端确认权限")?(o(),S("div",Ii,[..._[19]||(_[19]=[t("p",{class:"warn-title"},"请在服务端确认权限",-1),t("p",{class:"warn-desc"},[c(" macOS 系统已弹出提示： "),t("br"),t("strong",null,"“MSLX-Daemon 想要控制应用程序 终端.app”"),c(),t("br"),c("请务必点击 "),t("strong",null,"【好/OK】"),c(" 以继续更新。 ")],-1)])])):d.value||A.value?(o(),S("div",Vi,[A.value?(o(),S("div",Mi,[e(b(xs),{style:{color:"var(--td-error-color)"}}),t("span",null,I(A.value),1)])):(o(),S(ce,{key:1},[t("div",Ui,[t("span",null,I(m.value),1),t("span",Li,I(r.value),1)]),e(X,{theme:"plump",percentage:f.value,status:f.value>=100?"active":"success"},null,8,["percentage","status"])],64))])):(o(),S("div",Bi,[C.value?(o(),D(W,{key:0,theme:"warning",variant:"outline",class:"macos-alert"},{message:a(()=>[..._[20]||(_[20]=[t("strong",null,"macOS 用户请注意：",-1),t("br",null,null,-1),c("受 Apple 安全机制 (Gatekeeper) 限制，更新重启后应用可能无法自动启动。如遇此情况，请前往「系统设置 > 隐私与安全性」手动允许应用运行。 ",-1)])]),_:1})):N("",!0),k.value?(o(),D(W,{key:1,theme:"info",variant:"outline",class:"macos-alert"},{message:a(()=>[_[26]||(_[26]=t("strong",null,"Linux 用户提示：",-1)),t("ul",zi,[t("li",null,[_[22]||(_[22]=c(" 如使用一键脚本部署，推荐优先参考 ",-1)),e(J,{theme:"primary",href:"https://mslx.mslmc.cn/docs/install/linux/",target:"_blank",style:{"vertical-align":"baseline"}},{default:a(()=>[..._[21]||(_[21]=[c(" 官方文档 ",-1)])]),_:1}),_[23]||(_[23]=c(" 使用脚本进行更新。 ",-1))]),_[24]||(_[24]=t("li",null,[c(" 若启用 "),t("strong",null,"Systemd"),c(" 托管，请确保服务名称为 "),t("code",null,"mslx"),c("，否则自动更新后可能无法自动重启。 ")],-1)),_[25]||(_[25]=t("li",null,"如果更新完成后仍然是旧版本，请尝试手动重启服务或手动更新！",-1))])]),_:1})):N("",!0),_[27]||(_[27]=t("div",{class:"log-title"},"更新内容：",-1)),t("div",Pi,[t("div",Ri,I(s.updateInfo?.log||"暂无详细日志"),1)])]))]),!L.value&&!g.value&&!y.value?(o(),S("div",Ei,[t("div",Ti,[e(M,{theme:"primary",block:"",loading:d.value,disabled:d.value,onClick:H},{icon:a(()=>[e(b(As))]),default:a(()=>[c(" "+I(d.value?"正在更新...":"立即更新"),1)]),_:1},8,["loading","disabled"]),t("div",Fi,[e(M,{variant:"outline",disabled:!s.downloadInfo?.file||d.value,onClick:_[0]||(_[0]=Le=>z(s.downloadInfo?.file||""))},{icon:a(()=>[e(b(va))]),default:a(()=>[_[28]||(_[28]=c(" 下载新版本 ",-1))]),_:1},8,["disabled"]),e(M,{variant:"dashed",disabled:!s.downloadInfo?.web||d.value,onClick:_[1]||(_[1]=Le=>z(s.downloadInfo?.web||""))},{icon:a(()=>[e(b(Mt))]),default:a(()=>[_[29]||(_[29]=c(" 前往下载页 ",-1))]),_:1},8,["disabled"])])]),d.value?N("",!0):(o(),S("div",Di,[e(K,{content:"确定要跳过此版本吗？跳过后将不再提示该版本的更新。若跳过后需要更新也可以前往设置页面进行更新哦~",theme:"warning",onConfirm:h},{default:a(()=>[e(J,{theme:"default",hover:"color",size:"small"},{default:a(()=>[..._[30]||(_[30]=[c(" 跳过此版本 ",-1)])]),_:1})]),_:1})]))])):N("",!0),L.value?(o(),S("div",Oi,[e(M,{theme:"primary",block:"",onClick:E},{default:a(()=>[..._[31]||(_[31]=[c("刷新页面",-1)])]),_:1})])):N("",!0),g.value?(o(),S("div",ji,[e(M,{variant:"outline",block:"",onClick:V},{default:a(()=>[..._[32]||(_[32]=[c("我知道了",-1)])]),_:1})])):N("",!0),y.value?(o(),S("div",Ni,[t("div",Ki,[e(M,{theme:"primary",block:"",onClick:p},{default:a(()=>[..._[33]||(_[33]=[c(" 前往实例列表管理 ",-1)])]),_:1}),e(M,{variant:"outline",style:{"margin-left":"0"},block:"",onClick:V},{default:a(()=>[..._[34]||(_[34]=[c(" 暂不更新 ",-1)])]),_:1})])])):N("",!0)]),_:1},8,["visible"])}}}),Gi=ue(qi,[["__scopeId","data-v-24684c9a"]]),Hi=ne({__name:"App",setup(s){const l=rt(),n=Ja(),u=se(()=>l.displayMode),i=window.matchMedia("(prefers-color-scheme: dark)"),d=f=>{l.setSystemTheme(f.matches?"dark":"light")};return Ie(()=>{n.checkAppUpdate(!1),i.addEventListener("change",d),l.setSystemTheme(i.matches?"dark":"light")}),Qe(()=>{i.removeEventListener("change",d)}),(f,r)=>{const m=v("router-view");return o(),S(ce,null,[e(m,{class:$e([u.value])},null,8,["class"]),e(Gi,{visible:b(n).showUpdateModal,"update-info":b(n).updateInfo,"download-info":b(n).downloadInfo,onClose:r[0]||(r[0]=g=>b(n).showUpdateModal=!1),onSkip:b(n).handleSkipVersion},null,8,["visible","update-info","download-info","onSkip"])],64)}}}),Ji=ue(Hi,[["__scopeId","data-v-579b9e12"]]),ba=ml(Ji);ba.use(pl);ba.use(ya);ba.use(ft);ba.mount("#app");console.log(`
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣤⣤⣶⣶⣤⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣴⣾⠿⠛⠋⠉⠩⣄⠘⢿⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⣿⡏⠑⠒⠀⠀⣀⣀⠀⠀⢹⠈⣿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣿⣷⡀⢀⣰⣿⡿⣿⣧⠀⠀⢡⣾⣧⣀⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⣿⣿⣿⣿⣯⣴⣿⠿⣄⣤⣾⡿⠟⠛⠛⠿⢿⣶⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣴⣶⠿⠛⠋⠙⣿⣏⠀⠀⢻⣿⣡⣀⣀⠀⠀⠀⠀⢹⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣾⠿⠋⠁⠀⣀⣤⣶⣾⣿⣿⣤⣤⣾⣿⠉⠉⠙⠻⣿⠆⢀⣾⡿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⡿⠋⠁⠀⣀⣴⣿⠿⠛⠉⠀⢀⣿⡿⠿⠟⢿⣆⠀⢀⣴⣯⣴⣿⠟⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⣠⡾⠋⠀⠀⣠⣾⠟⠋⠀⠀⠀⠀⠀⣈⣿⣷⣤⣴⣾⣿⣈⣻⣿⡟⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⣰⡿⠁⠀⣠⡾⠋⠁⠀⠀⢀⣠⣴⠶⠞⠛⠛⠋⠉⠉⠉⠉⠙⠛⠻⠷⣦⣤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠰⣿⠁⠀⠀⣿⣄⣀⣠⣴⡾⠛⠉⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⣿⠿⣶⣄⠀⠀⠀⢀⣠⡄⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠈⠛⠶⠶⢾⣿⠿⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢷⣄⠉⠙⠻⠿⠟⢹⡇⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⠟⠁⠀⠀⠀⠀⠀⠀⠀⢀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣄⠀⠀⠀⠀⠘⣿⣿⣦⣀⠀⠲⣾⣁⠀⠀⠀⠀⠀⡀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⢀⡾⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢹⣦⡀⠀⠀⠀⣿⡿⣿⣿⣿⡆⠀⠉⠛⠛⠛⠛⢻⡏⠀
⠀⠀⠀⠀⠀⠀⠀⣠⡾⠁⠀⠀⠀⠀⠀⠀⠀⠀⢀⡄⣸⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⣿⠛⢦⡀⠰⣿⣿⣿⣽⣿⡇⠀⠀⠀⠀⠀⢠⡿⠀⠀
⠀⠀⠀⠀⣀⣤⡾⢻⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠀⡏⠙⣷⡀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡇⠰⣽⣶⣄⠉⠻⣿⣿⣧⠀⠀⢀⣤⣾⠟⠁⠀⠀
⢰⣶⡾⠛⠋⠉⠀⠀⠀⠀⠀⢀⡀⠀⠀⠀⠀⠀⢸⣸⡇⠀⣨⣿⣾⡋⠀⠀⠀⠀⢀⠀⠀⣿⡀⠀⠈⠛⢷⣄⠈⠛⣿⡆⠀⠘⣿⡀⠀⠀⠀⠀
⠀⠙⠿⣦⣀⠀⠀⠀⠀⠀⠀⡾⠀⠀⠀⠀⠀⠀⣿⣿⠀⠀⠋⠀⠙⢿⣦⣀⠀⠀⠘⣷⣄⣹⣧⠀⠀⠀⠈⢻⣦⠀⠈⠋⠀⠀⠘⣧⠀⠀⠀⠀
⠀⠀⠀⠈⠛⠿⢶⡶⠃⠀⣰⠃⠀⠀⠀⠀⠀⢠⣿⠃⠀⠀⠀⠀⠀⠀⠉⠻⢷⣦⣤⣘⣿⡛⠛⠀⢀⣴⣶⣦⡹⣷⡀⠀⠀⠀⠀⠸⣧⠀⠀⠀
⠀⠀⠀⠀⠀⢠⡿⠃⠀⢀⡟⠀⠀⠀⠀⠀⠀⣼⣿⠀⠀⢀⣴⣿⣿⣷⡄⠀⠀⠈⠉⠉⠉⠉⠀⠀⢸⣿⣿⣿⣷⠻⣧⠀⠀⠀⠀⠀⢿⡆⠀⠀
⠀⠀⠀⠀⢰⣿⠁⠀⠀⢸⠁⠀⠀⠀⠀⠀⠈⠋⣿⠀⠀⠸⣿⣿⣿⣿⡷⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠛⠿⠟⠃⠀⢻⣧⠀⠀⠀⠀⠸⣧⠀⠀
⠀⠀⠀⠀⣿⡇⠀⠀⠀⣿⠀⠀⠀⠀⠀⠀⠀⠀⣿⠀⠀⠀⠉⠻⠿⠋⠀⠀⢠⡀⠀⠀⣀⣀⣀⣸⠇⠀⠀⠀⠀⠀⠈⢿⣧⠀⠀⠀⠀⣿⡀⠀
⠀⠀⠀⢰⣿⠁⠀⠀⢰⡏⠀⠀⠀⠀⠀⠀⠀⠀⢿⡀⠀⠀⠀⠀⠀⣸⠀⠀⠈⠛⠒⠛⠉⠈⠉⠀⠀⠀⠀⠀⠀⠀⠀⢸⡟⠀⠀⠀⠀⢸⡇⠀
⠀⠀⠀⢸⣿⠀⠀⠀⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⢸⡇⠀⠀⠀⠀⠚⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣿⠁⠀⠀⠀⠀⢸⣿⠀
⠀⠀⠀⢸⣿⠀⠀⠀⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⠘⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣀⣀⣀⣤⣶⡿⠋⣿⠀⠀⠀⠀⠀⠀⣿⠀
⠀⠀⠀⠘⣿⡄⠀⠀⢸⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀⢿⣧⣄⣀⣀⣀⣠⣤⣶⣶⣾⣿⣿⣿⣿⠿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠀⠀⣠⠀⠀⢠⣿⡄
⠀⠀⠀⠀⢻⣧⠀⠀⠸⣿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠈⣿⣿⣿⣟⠛⢻⡟⢻⡉⠉⣫⣀⠀⠀⠀⠉⠉⠛⠙⠿⣷⣿⡿⠁⢀⣰⡟⠀⠀⢸⣿⠀
⠀⠀⠀⠀⠈⢻⣧⡀⠀⠹⣷⡀⠀⠀⠀⠀⢠⠀⠀⠀⠘⣿⣿⣿⢻⡿⠀⠈⠷⠟⠁⠘⢾⣿⣶⣤⣶⣾⡇⠀⣿⣿⣤⣶⣿⣿⠃⠀⠀⣾⡟⠀
⠀⠀⠀⠀⠀⠈⠻⣷⣄⡀⠹⣷⣄⠀⠀⠀⢸⣷⣤⡀⠀⠈⢻⣿⣯⣤⠀⠀⣠⡀⠀⢀⣼⣿⣿⣿⣿⣟⠁⠐⠿⣿⣿⣿⣿⠋⠀⢀⣾⠟⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠈⠙⠿⣷⣮⣽⣷⣶⣤⣤⣿⣿⣿⣷⣶⣦⣭⣿⣿⣧⣠⠵⢯⡆⠚⣯⢿⠋⠛⠛⢫⣀⣠⣾⣿⢿⣿⣥⣤⠶⠛⠁⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠉⠉⢁⣾⣿⣿⣿⠿⠿⠿⠿⠻⢿⣿⣿⣷⣦⣤⣤⣀⣤⣤⣄⣶⣿⣿⡿⠟⠉⠀⠀⢻⡄⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣴⣿⣿⣿⣿⣿⡇⠀⠀⣀⡀⠈⢿⣧⠀⠉⠙⠛⠛⠛⠛⠛⠛⠉⠁⠀⠀⠀⠀⠀⠀⢿⡄⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣴⣿⣿⡏⠛⠉⢻⣿⣿⣿⣾⣿⣿⠀⢸⣿⠀⠀⠀⠀⠀⠙⠓⠢⠀⠀⠀⠀⠀⠸⠀⠀⠀⠘⣿⡄⠀⠀⠀⠀⠀`);console.log("人生得意须尽吃，莫使金箸空对月。 —— 派蒙");const Wi={class:"welcome-header"},Xi={class:"avatar-section"},Qi=["src"],Yi={class:"welcome-info"},Zi={class:"welcome-text"},er={class:"hitokoto-text"},tr=ne({__name:"Banner",setup(s){const l=Fe(),n=$("");async function u(){const i=`Every little creature in the world has their own piece of paradise.
Plants take root in the boundless earth, and their leaves grow toward the stars.`;try{const d=await Q.get({url:"/?c=a&c=b&c=c&c=d",baseURL:"https://v1.hitokoto.cn"});d&&d.hitokoto?n.value=`${d.hitokoto} —— 《${d.from}》${d.from_who?` (${d.from_who})`:""}`:n.value=i}catch(d){n.value=i,console.error("获取一言(Hitokoto)失败:",d)}}return Ie(()=>{u()}),(i,d)=>(o(),D(b(Oa),{shadow:"",bordered:!1,class:"welcome-card"},{default:a(()=>[t("div",Wi,[t("div",Xi,[t("img",{src:b(l).userInfo.avatar,alt:"头像",class:"user-avatar"},null,8,Qi)]),t("div",Yi,[t("h3",Zi,[e(b(dt),{name:"sunny",class:"welcome-icon"}),c(" 你好, "+I(b(l).userInfo.name),1)]),t("p",er,I(n.value),1)])])]),_:1}))}}),ar=ue(tr,[["__scopeId","data-v-bfba57a3"]]),sr=Fe();async function Wa(s){return await Q.post({url:"/api/instance/createServer",data:s})}async function lr(s,l=!1){return await Q.post({url:"/api/instance/delete",data:{id:s,deleteFiles:l}})}async function nr(){return await Q.get({url:"/api/instance/list"})}async function Bt(s,l){return await Q.post({url:"/api/instance/action",data:{id:s,action:l},timeout:60*1e3})}async function Qs(s){return await Q.get({url:"/api/instance/info",params:{id:s}})}async function or(s){return await Q.get({url:`/api/instance/settings/general/${s}`})}async function ir(s){return await Q.post({url:`/api/instance/settings/general/${s.id}`,data:s})}async function rr(s){return await Q.get({url:`/api/instance/backups/${s}`})}async function ur(){return await Q.get({url:"/api/instance/backups/all"})}async function Ea(s,l){return await Q.post({url:"/api/instance/backups/delete",data:{id:s,fileName:l}})}function Ta(s,l){const{baseUrl:n,token:u}=sr;return`${n||window.location.origin}/api/instance/backups/download?id=${s}&fileName=${encodeURIComponent(l)}&x-user-token=${u}`}async function Ys(s){return await Q.get({url:`/api/instance/players/online/${s}`})}async function dr(s){return await Q.get({url:`/api/instance/players/whitelist/${s}`})}async function cr(s,l){return await Q.post({url:`/api/instance/players/whitelist/add/${s}`,data:{name:l}})}async function mr(s,l){return await Q.post({url:`/api/instance/players/whitelist/remove/${s}`,data:{name:l}})}async function pr(s){return await Q.get({url:`/api/instance/players/ops/${s}`})}async function vr(s,l){return await Q.post({url:`/api/instance/players/ops/add/${s}`,data:{name:l}})}async function fr(s,l){return await Q.post({url:`/api/instance/players/ops/remove/${s}`,data:{name:l}})}async function gr(s){return await Q.get({url:`/api/instance/players/banplayer/${s}`})}async function _r(s,l,n){return await Q.post({url:`/api/instance/players/banplayer/add/${s}`,data:{name:l,reason:n}})}async function hr(s,l){return await Q.post({url:`/api/instance/players/banplayer/remove/${s}`,data:{name:l}})}async function yr(s){return await Q.get({url:`/api/instance/players/banip/${s}`})}async function br(s,l,n){return await Q.post({url:`/api/instance/players/banip/add/${s}`,data:{ip:l,reason:n}})}async function wr(s,l){return await Q.post({url:`/api/instance/players/banip/remove/${s}`,data:{ip:l}})}async function kr(s){return await Q.get({url:`/api/instance/players/history/${s}`})}async function $r(s){return await Q.get({url:`/api/instance/map/spawn/${s}`})}const sa=xt("instanceList",()=>{const s=$([]),l=$(0),n=$(0);async function u(){try{s.value=await nr(),l.value=s.value.length,n.value=s.value.filter(i=>i.status).length}catch(i){B.error("获取实例列表失败:"+i.message)}}return{instanceList:s,refreshInstanceList:u,totalInstanceCount:l,onlineInstanceCount:n}}),xr={class:"info-grid"},Ar={class:"info-item"},Cr={class:"info-label"},Sr={class:"info-value"},Ir={class:"info-item"},Vr={class:"info-label"},Mr={class:"info-value"},Ur={class:"info-item"},Lr={class:"info-label"},Br={class:"info-value truncate-value"},zr={class:"info-item"},Pr={class:"info-label"},Rr={class:"info-value truncate-value"},Er={class:"info-item"},Tr={class:"info-label"},Fr={class:"info-value truncate-value"},Dr={class:"info-item"},Or={class:"info-label"},jr={class:"info-value"},Nr={class:"info-item"},Kr={class:"info-label"},qr={class:"info-value truncate-value"},Gr={class:"info-item"},Hr={class:"info-label"},Jr={class:"info-value"},Wr=ne({__name:"InfoCard",setup(s){const l=Fe(),n=sa();return Ie(()=>{n.refreshInstanceList()}),(u,i)=>(o(),D(b(Oa),{shadow:"",bordered:!1,class:"system-info-card"},{default:a(()=>[t("div",xr,[t("div",Ar,[t("span",Cr,[e(b(dt),{name:"server"}),i[0]||(i[0]=t("span",null,"在线实例：",-1))]),t("span",Sr,I(b(n).onlineInstanceCount)+" / "+I(b(n).totalInstanceCount),1)]),t("div",Ir,[t("span",Vr,[e(b(dt),{name:"logo-codepen"}),i[1]||(i[1]=t("span",null,"NET环境：",-1))]),t("span",Mr,I(b(l).userInfo.systemInfo.netVersion),1)]),t("div",Ur,[t("span",Lr,[e(b(dt),{name:"dashboard"}),i[2]||(i[2]=t("span",null,"面板版本：",-1))]),e(b(Aa),{content:b(qt).version,"max-width":"400px"},{default:a(()=>[t("span",Br," v"+I(b(qt).version),1)]),_:1},8,["content"])]),t("div",zr,[t("span",Pr,[e(b(dt),{name:"cloud"}),i[3]||(i[3]=t("span",null,"节点版本：",-1))]),e(b(Aa),{content:`v${b(l).userInfo.version}`,"max-width":"400px"},{default:a(()=>[t("span",Rr," v"+I(b(l).userInfo.version),1)]),_:1},8,["content"])]),t("div",Er,[t("span",Tr,[e(b(dt),{name:"desktop"}),i[4]||(i[4]=t("span",null,"主机名：",-1))]),t("span",Fr,I(b(l).userInfo.systemInfo.hostname),1)]),t("div",Dr,[t("span",Or,[e(b(dt),{name:"system-code"}),i[5]||(i[5]=t("span",null,"系统类型：",-1))]),t("span",jr,I(b(l).userInfo.systemInfo.osType)+" ("+I(b(l).userInfo.systemInfo.osArchitecture)+")",1)]),t("div",Nr,[t("span",Kr,[e(b(dt),{name:"system-setting"}),i[6]||(i[6]=t("span",null,"系统版本：",-1))]),e(b(Aa),{content:b(l).userInfo.systemInfo.osVersion,"max-width":"400px"},{default:a(()=>[t("span",qr,I(b(l).userInfo.systemInfo.osVersion),1)]),_:1},8,["content"])]),t("div",Gr,[t("span",Hr,[e(b(dt),{name:"check-circle"}),i[7]||(i[7]=t("span",null,"版本匹配：",-1))]),t("span",Jr,[e(b(vl),{theme:b(qt).version.startsWith(b(l).userInfo.targetFrontendVersion.panel)?"success":"danger",variant:"light"},{default:a(()=>[c(I(b(qt).version.startsWith(b(l).userInfo.targetFrontendVersion.panel)?"正确匹配":"请更新"),1)]),_:1},8,["theme"])])])])]),_:1}))}}),Xr=ue(Wr,[["__scopeId","data-v-00dad172"]]),Qr={class:"monitor-dashboard"},Yr={class:"card-content"},Zr={class:"info-section"},eu={class:"value-group"},tu={class:"value"},au={class:"card-content"},su={class:"info-section"},lu={class:"value-group"},nu={class:"value"},ou={class:"sub-text"},iu=30,ru=ne({__name:"SystemStatus",setup(s){const l=Fe(),n=$(null),u=$(!1),i=$(null),d=$(null);let f=null,r=null;const m=Xe({cpu:0,memUsage:0,memUsed:0,memTotal:0}),g=[],y=[],L=[],A=z=>getComputedStyle(document.documentElement).getPropertyValue(z).trim()||"#999999",P=(z,p,V)=>({grid:{top:10,right:10,bottom:0,left:0,containLabel:!1},tooltip:{trigger:"axis",backgroundColor:"var(--td-bg-color-container)",borderColor:"var(--td-component-border)",textStyle:{color:"var(--td-text-color-primary)"},formatter:h=>{const E=h[0];return`${E.name}<br/><span style="color:${z}">●</span> ${p}: <b>${E.value}%</b>`}},xAxis:{type:"category",boundaryGap:!1,data:g,show:!1},yAxis:{type:"value",max:100,min:0,show:!1},series:[{name:p,type:"line",smooth:!0,showSymbol:!1,lineStyle:{width:2,color:z},areaStyle:{opacity:.2,color:new Gs(0,0,0,1,[{offset:0,color:z},{offset:1,color:"transparent"}])},data:V}]}),w=()=>{const z=A("--td-brand-color"),p=A("--td-success-color");i.value&&(f=da(i.value),f.setOption(P(z,"CPU",[]))),d.value&&(r=da(d.value),r.setOption(P(p,"Memory",[]))),window.addEventListener("resize",C)},C=()=>{f?.resize(),r?.resize()},k=async()=>{const{baseUrl:z,token:p}=l,V=new URL("/api/hubs/system",z||window.location.origin);p&&V.searchParams.append("x-user-token",p),n.value=new Lt().withUrl(V.toString(),{withCredentials:!1}).withAutomaticReconnect().build(),n.value.on("ReceiveSystemStats",h=>{m.cpu=h.cpu,m.memUsage=h.memUsage,m.memUsed=h.memUsed,m.memTotal=h.memTotal,g.length>=iu&&(g.shift(),y.shift(),L.shift()),g.push(h.timestamp),y.push(h.cpu),L.push(h.memUsage),f?.setOption({xAxis:{data:g},series:[{data:y}]}),r?.setOption({xAxis:{data:g},series:[{data:L}]})});try{await n.value.start(),u.value=!0,await n.value.invoke("JoinMonitor")}catch(h){console.error("SignalR 连接失败:",h)}n.value.onclose(()=>{u.value=!1})};return Ie(()=>{kt(()=>{setTimeout(()=>{w(),k()},100)})}),Qe(async()=>{if(window.removeEventListener("resize",C),n.value)try{await n.value.invoke("LeaveMonitor"),await n.value.stop()}catch(z){console.error(z)}f?.dispose(),r?.dispose()}),(z,p)=>{const V=v("t-tag"),h=v("t-card"),E=v("t-col"),F=v("t-row");return o(),S("div",Qr,[e(F,{gutter:[12,12]},{default:a(()=>[e(E,{xs:12,md:6},{default:a(()=>[e(h,{shadow:"",bordered:!1,class:"chart-card",size:"small"},{default:a(()=>[t("div",Yr,[t("div",Zr,[p[3]||(p[3]=t("div",{class:"label"},"CPU 使用率",-1)),t("div",eu,[t("span",tu,I(m.cpu),1),p[0]||(p[0]=t("span",{class:"unit"},"%",-1))]),u.value?(o(),D(V,{key:0,theme:"success",variant:"light",size:"small",class:"status-tag"},{default:a(()=>[...p[1]||(p[1]=[c(" 实时 ",-1)])]),_:1})):(o(),D(V,{key:1,theme:"danger",variant:"light",size:"small",class:"status-tag"},{default:a(()=>[...p[2]||(p[2]=[c(" 离线 ",-1)])]),_:1}))]),t("div",{ref_key:"cpuChartRef",ref:i,class:"chart-container"},null,512)])]),_:1})]),_:1}),e(E,{xs:12,md:6},{default:a(()=>[e(h,{shadow:"",bordered:!1,class:"chart-card",size:"small"},{default:a(()=>[t("div",au,[t("div",su,[p[5]||(p[5]=t("div",{class:"label"},"内存使用率",-1)),t("div",lu,[t("span",nu,I(m.memUsage),1),p[4]||(p[4]=t("span",{class:"unit"},"%",-1))]),t("div",ou,I((m.memUsed/1024).toFixed(1))+" / "+I((m.memTotal/1024).toFixed(1))+" GB ",1)]),t("div",{ref_key:"memChartRef",ref:d,class:"chart-container"},null,512)])]),_:1})]),_:1})]),_:1})])}}}),uu=ue(ru,[["__scopeId","data-v-e256825a"]]),du={class:"card-header"},cu={class:"announcement-wrapper"},mu=ne({__name:"Announcement",setup(s){const l=$(!0),n=$(""),u=Cs(),i=$(u.value?"dark":"light");be(u,()=>{i.value=u.value?"dark":"light"});async function d(){l.value=!0;const f=`## 🔴 公告加载失败
- 请检查网络连接或联系管理员。`;try{const r=await Q.get({url:"https://api.mslmc.cn/v3/query/notice?query=mslxNoticeMd"});r&&r.mslxNoticeMd?n.value=r.mslxNoticeMd:n.value=f}catch(r){console.error("获取公告失败:",r),n.value=f}finally{l.value=!1}}return Ie(()=>{d()}),(f,r)=>(o(),D(b(Oa),{shadow:"",bordered:!1,class:"announcement-card"},{title:a(()=>[t("div",du,[e(b(dt),{name:"system-messages"}),r[0]||(r[0]=t("span",null,"系统公告",-1))])]),default:a(()=>[e(b(fl),{loading:l.value,text:"加载中...",size:"small",style:{width:"100%"}},{default:a(()=>[t("div",cu,[e(b(Ss),{"editor-id":"announcement-preview","model-value":n.value,theme:i.value,class:"md-preview-wrapper"},null,8,["model-value","theme"])])]),_:1},8,["loading"])]),_:1}))}}),pu=ue(mu,[["__scopeId","data-v-0d5b602c"]]),vu=ne({__name:"index",setup(s){const l=Fe(),n=se(()=>l.userInfo?.username==="mslx");return(u,i)=>{const d=v("t-alert");return o(),S("div",null,[n.value?(o(),D(d,{key:0,theme:"warning",title:"安全风险提示",message:"检测到您当前正在使用默认账号 (mslx)。为了保障系统安全，请务必尽快修改用户名和密码！",style:{"margin-bottom":"16px"}},{operation:a(()=>[t("span",{style:{cursor:"pointer"},onClick:i[0]||(i[0]=f=>b(Me)("/settings"))},"去修改")]),_:1})):N("",!0),e(ar),e(Xr,{style:{"margin-top":"12px"}}),e(uu,{style:{"margin-top":"12px"}}),e(pu,{style:{"margin-top":"12px"}})])}}}),fu=Object.freeze(Object.defineProperty({__proto__:null,default:vu},Symbol.toStringTag,{value:"Module"})),gu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAACXBIWXMAAAsSAAALEgHS3X78AAADgklEQVR42u2dPWhTYRSGk2qlZKia+BMNFuJQERehuFiogoNSJ7tIi4MKFkELInapVYOIS8SlCqKoiwji5OhStLQOlUz+YUFrC2li7I26hGCwEbXrOTec5OKN93nWw/363S8PJ7w9yU0oBAAAASWsFdPXb1Q5ouZn+Oxp8XVu4XiCDQIgACAAIAAgAASQlVrU6+07aFp0bTTqq5v8WiwG/XWu0gEAAQABAAEAAQABYDkGWuPc5PiEWIttXCfWIpGIebP3L4+arjt28YpYK5VKYu3Rtaumv3f43IgnL5bzedF05nQAQABAAEAAQABAAKgxBr5781asbUl2mKKVVnOLXts6EmLt/XzWdADWWKrtRbuHeiKiNerRAQABAAEAAQABAAGgxhgY3xQXa/lc3hSt3CZ6WrwaOHlKrF0akePVhwuDttNp3WDay8NbN00RsZ6YqE0K6QCAAIAAgACAAIAAgABQy/8BtKyvoY18eyoF9dqJebn2aXrBtG4i9tN0Hz1OwbQXbTTtdv9WtFHx3Mc5OgAgACAAIAAgACAA1BID/wX97TmxVh4/L9a6OitibXW8zbSXeL4sR2RlL/3t8ppZZ4Un58Y4GBAAEAAQABAAEAB8GgPdJnPxWKUpDs6rfS7RAQABAAEAAQABAAGg+WJgy+0hc3zampoSa8XsrFj7dueIaa/flYmfxpoTD8RaNJGUL0x1q+vmlbNbGhyjAwACAAIAAgACAAJAvTGwkFts+KJaXNFizp8YqNT2HDoq1p70Nj7qhYx7eTX9XL5/p1Vdt+3MXdN+HKWmvcZ0AN4CAAEAAQABAAEgcDHQeqH2XbQf9+QfatS+w/cbbeLnfMkpV643Ry8JbXKp7UW7B7dpaEZ5rO2q46N0AEAAQABAAEAAQACok/DwcKoqFQ/07TfFQA0tIv6NieX/+sAzM/rjaryIei+nMnQAQABAAEAAQABAAFjGd08KtU7udo89E2ubk52mNRdmZ8Tai6G9dABAAEAAQABAAEAAQADg/wAuuI07sy7jYguvJ582fE3rL394Me6lAwACAAIAAgACAAJAg2Kg9slf7ZOmu7q7PIuJEo8H9vkqznqBF2dOB+AtABAAEAAQABAAiIE1smPndl/diN+mbF7gxZnTAXgLAAQABAAEAASAoBHWitrzg6B5SKdTYToAIAAgACAAIAAgAAAAAECQ+QUUBtshXi5agwAAAABJRU5ErkJggg==",_u="/assets/png/mslx-150px-Anvil.BV3t5jxS.png",hu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAACWElEQVR42u3dPS8EURQG4G1RU6GWoFUqRK9Ao1BoJRJ+gEgUG4XERyJRKIQIFYVE0Gn8rPUPzolc1+zOPG/yljs7e89Tnczu9notz9zsxKBmewKAACAACAACgAAgAMjQDPBoYyns2+l+2O/DtbCAAAAAAAAAAAAAAAAAAAAAAADA3w0wG1DW99eXsDv95bDZ9TNgnQcCAAAAAAAAAAAAAAAAAAAAQKsAZB8wW6SUDvBxcz3sx/1l2M/r87DZ+3d+kQQAAAAAAAAAAAAAAAAAAAAAAL9obSAPdxdhn6/Own5vb4XtPBAAAAAAAAAAAAAAAAAAAAAAWgVgcmpqELV0wLW/2PHVXw5bOsDaD4xkzeYDAAAAAAAAAAAAAAAAAAAAAAC/yfzC4iBqdgO1D6gUSNMDzK6fnS8AAAAAAAAAAAAAAAAAAAAAAPwngJvbp7BNAyldRJX+gEXpAI+OT8ICAAAAAAAAAAAAAAAAAAAAAMB/AshusDaQ2g+clA5wd+8gbHZ+2esBAAAAAAAAAAAAAAAAAAAAAGCYFkFNA6m9iKk94JHfBAIAAAAAAAAAAAAAAAAAAADQKgClA64NpOkB2QQCAAAAAAAAAAAAAAAAAAAAMEoAhh3Iyupq2GEfcHZ+Y2PjYRv/xxAAAAAAAAAAAAAAAAAAAAAAOgWgaSAZgKYXMVmzAWfnBwAAAAAAAAAAAAAAAAAAAAAAo5RSIKWLoNYvYgAAAAAAAAAAAAAAAAAAAAAAoEVApmdmw1rEAAAAAAAAAAAAAAAAAAAAAACAiIiIiIiIiHQwP/KhHMCviKP2AAAAAElFTkSuQmCC",yu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAABi0lEQVR42u3cMWoCQRSAYW9mkzYHECGFYJXCKrWVTYpcQwIpUliICAaLEDxASiHn2GIs070njMgy+33wyhWZ91fD6mgEAAAAAAAAANAzh5euRLOdx5M974QFgAAQAAJAAAgAAXA/p7euRJMteL+I57yLJ/t8GxIAAkAACAABIAAEwO0ucrIF1T6fLXgzjed7FY8NCwABIAAEgAAQAALgX3bA2fy+x1MbQLbg7PvZsAAQAAJAAAgAASAArvd37Eo0tT8Mqb1osiEBIAAEgAAQAAJAAPTnImn+8RBO7QslNiAABIAAEAACQAAIgP54/ZmVaJyQABAAAkAACAABIADasdg8lmickAAQAAJAAAgAASAA2pG9EOKEBIAAEAACQAAIAAHQDhdBAhCAAAQgAAEIQAACEIAABCAAAQzH8mtSonFCAkAACAABIAAEgABohz+IEIAABCAAAQhAAAIQgAAEIAABCGA4nj/HJRonJAAEgAAQAAJAAAiAdjytxyUaJyQABIAAEAACQAAIYEAu6/zodBuokO4AAAAASUVORK5CYII=",bu={class:"server-list-container"},wu={class:"page-header"},ku={class:"card-header"},$u={class:"status-badge"},xu={class:"card-content"},Au={class:"server-name text-ellipsis"},Cu={class:"server-info"},Su={class:"info-item"},Iu={class:"info-item id-tag"},Vu={class:"card-actions"},Mu={key:0,class:"empty-state"},Uu={class:"delete-dialog-body"},Lu={class:"checkbox-area"},Bu=ne({__name:"index",setup(s){const l=sa();Ie(()=>{l.refreshInstanceList()});const n=g=>{switch(g){case 1:return{label:"启动中",theme:"primary",icon:yl,loading:!0};case 2:return{label:"运行中",theme:"success",icon:fa,loading:!1};case 3:return{label:"停止中",theme:"warning",icon:hl,loading:!1};case 4:return{label:"重启中",theme:"primary",icon:Ze,loading:!0};default:return{label:"未启动",theme:"default",icon:_l,loading:!1}}},u=g=>{Me(`/instance/console/${g.id}`)},i=(g,y)=>{if(g.includes("http"))return g;switch(g){case"neoforge":return gu;case"forge":return _u;case"custom":return hu;case"server-icon":return new URL(`${localStorage.getItem(Pt)}/api/instance/icon/${y}.png?x-user-token=${localStorage.getItem(zt)}`,import.meta.url).href;default:return yu}},d=g=>g==="none"?"自定义模式":g.startsWith("@")?g.includes("neoforge")?"NeoForge":"Forge":g.replace(".jar",""),f=Xe({visible:!1,loading:!1,deleteFile:!1,item:null}),r=(g,y)=>{g.stopPropagation(),f.item=y,f.deleteFile=!1,f.loading=!1,f.visible=!0},m=async()=>{if(f.item){f.loading=!0;try{await lr(f.item.id,f.deleteFile),B.success("删除成功"),f.visible=!1,await l.refreshInstanceList()}catch(g){B.error("删除失败: "+g.message)}finally{f.loading=!1}}};return(g,y)=>{const L=v("t-button"),A=v("t-space"),P=v("t-loading"),w=v("t-avatar"),C=v("t-tag"),k=v("t-card"),z=v("t-col"),p=v("t-row"),V=v("t-empty"),h=v("t-checkbox"),E=v("t-dialog");return o(),S("div",bu,[t("div",wu,[y[5]||(y[5]=t("h2",{class:"title"},"服务端列表",-1)),e(A,null,{default:a(()=>[e(L,{theme:"primary",variant:"dashed",onClick:b(l).refreshInstanceList},{default:a(()=>[...y[3]||(y[3]=[c(" 刷新列表 ",-1)])]),_:1},8,["onClick"]),e(L,{theme:"primary",onClick:y[0]||(y[0]=F=>b(Me)("/instance/create"))},{default:a(()=>[...y[4]||(y[4]=[c(" 添加服务端 ",-1)])]),_:1})]),_:1})]),e(P,{loading:!1,text:"加载中...",fullscreen:""}),e(p,{gutter:[24,24]},{default:a(()=>[(o(!0),S(ce,null,fe(b(l).instanceList,F=>(o(),D(z,{key:F.id,xs:12,sm:6,md:4,lg:3,xl:3},{default:a(()=>[e(k,{class:$e(["server-card",`status-${F.status}`]),bordered:!1,onClick:R=>u(F)},{default:a(()=>[t("div",ku,[t("div",{class:$e(["icon-wrapper",`status-${F.status}`])},[e(w,{image:i(F.icon,F.id),size:"large",shape:"round",class:"server-icon"},null,8,["image"])],2),t("div",$u,[e(C,{theme:n(F.status).theme,variant:"light",shape:"round"},{icon:a(()=>[(o(),D(it(n(F.status).icon),{class:$e({"spin-icon":n(F.status).loading})},null,8,["class"]))]),default:a(()=>[c(" "+I(n(F.status).label),1)]),_:2},1032,["theme"])])]),t("div",xu,[t("h3",Au,I(F.name),1),t("div",Cu,[t("div",Su,[e(b(gl),{class:"info-icon"}),t("span",null,I(d(F.core)),1)]),t("div",Iu,[t("span",null,"#"+I(F.id),1)])])]),t("div",Vu,[y[6]||(y[6]=t("span",{class:"action-hint"},"点击管理",-1)),e(L,{shape:"circle",theme:"danger",variant:"text",class:"delete-btn",onClick:R=>r(R,F)},{default:a(()=>[e(b(mt))]),_:1},8,["onClick"])])]),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:1}),b(l).instanceList.length===0?(o(),S("div",Mu,[e(V,{description:"暂无服务端实例"})])):N("",!0),e(E,{visible:f.visible,"onUpdate:visible":y[2]||(y[2]=F=>f.visible=F),header:"确认删除",theme:"danger","confirm-btn":{content:"确认删除",loading:f.loading},onConfirm:m},{default:a(()=>[t("div",Uu,[t("p",null,[y[7]||(y[7]=c(" 您确定要删除服务端 ",-1)),t("strong",null,I(f.item?.name),1),c(" (ID: "+I(f.item?.id)+") 吗？ ",1)]),y[9]||(y[9]=t("p",{class:"warning-text"},"此操作不可恢复！",-1)),t("div",Lu,[e(h,{modelValue:f.deleteFile,"onUpdate:modelValue":y[1]||(y[1]=F=>f.deleteFile=F)},{default:a(()=>[...y[8]||(y[8]=[c("同时删除服务端文件数据",-1)])]),_:1},8,["modelValue"])])])]),_:1},8,["visible","confirm-btn"])])}}}),zu=ue(Bu,[["__scopeId","data-v-5b2fff09"]]),Pu=Object.freeze(Object.defineProperty({__proto__:null,default:zu},Symbol.toStringTag,{value:"Module"}));async function Ru(){return await Q.get({url:"/query/server_classify",baseURL:"https://api.mslmc.cn/v3"})}async function Eu(s){return await Q.get({url:`/query/available_versions/${s}`,baseURL:"https://api.mslmc.cn/v3"})}async function Tu(s,l){return await Q.get({url:`/download/server/${s}/${l}`,baseURL:"https://api.mslmc.cn/v3"})}const Fu={class:"core-selector-layout"},Du={class:"sidebar"},Ou={key:1,class:"category-list"},ju=["onClick"],Nu={class:"cat-icon"},Ku={class:"cat-info"},qu={class:"cat-name"},Gu={class:"cat-desc"},Hu={key:0,class:"cat-count"},Ju={class:"main-panel"},Wu={class:"panel-section"},Xu={class:"section-header"},Qu={class:"core-grid"},Yu=["onClick"],Zu={key:0,class:"empty-text"},ed={key:0,class:"panel-section"},td={class:"section-header"},ad={class:"section-title"},sd={class:"version-grid"},ld=["onClick"],nd={key:0,class:"empty-text"},od=ne({__name:"ServerCoreSelector",props:{visible:{type:Boolean}},emits:["update:visible","confirm"],setup(s,{emit:l}){const n=s,u=l,i=se({get:()=>n.visible,set:h=>u("update:visible",h)}),d=$(!1),f=$(!1),r=$({}),m=$("plugins"),g=$(""),y=$([]),L=$(""),A=[{key:"plugins",name:"插件服务端",desc:"支持 Bukkit/Spigot/Paper 插件",icon:"app",dataKey:"pluginsCore"},{key:"forge_hybrid",name:"NeoForge 系混合服务端",desc:"同时支持 Neoforge/Forge模组 和 插件",icon:"layers",dataKey:"pluginsAndModsCore_Forge"},{key:"fabric_hybrid",name:"Fabric 混合服务端",desc:"同时支持 Fabric模组 和 插件",icon:"cpu",dataKey:"pluginsAndModsCore_Fabric"},{key:"mod_forge",name:"NeoForge 模组服务端",desc:"纯 NeoForge/Forge 模组支持",icon:"tools",dataKey:"modsCore_Forge"},{key:"mod_fabric",name:"Fabric 模组服务端",desc:"纯 Fabric 模组支持",icon:"ai-tool",dataKey:"modsCore_Fabric"},{key:"vanilla",name:"原版服务端",desc:"Minecraft 官方原版核心",icon:"tea",dataKey:"vanillaCore"},{key:"bedrock",name:"基岩版第三方端",desc:"第三方的基岩版服务端",icon:"gift",dataKey:"bedrockCore"},{key:"proxy",name:"代理服务端",desc:"BungeeCord / Velocity 等 用于群组服",icon:"share",dataKey:"proxyCore"}],P=se(()=>{const h=A.find(E=>E.key===m.value);return!h||!r.value?[]:r.value[h.dataKey]||[]}),w=se(()=>L.value?P.value.filter(h=>h.toLowerCase().includes(L.value.toLowerCase())):P.value),C=async()=>{d.value=!0;try{const h=await Ru();Array.isArray(h)&&h.length>0?r.value=h[0]:h&&!Array.isArray(h)&&(r.value=h)}catch(h){B.error("获取服务端分类失败"),console.error(h)}finally{d.value=!1}},k=h=>{m.value=h,g.value="",y.value=[],L.value=""},z=h=>{g.value!==h&&(g.value=h,p(h))},p=async h=>{f.value=!0,y.value=[];try{const E=await Eu(h);Array.isArray(E)&&E.length>0?y.value=E[0].versionList||[]:E&&!Array.isArray(E)&&(y.value=E.versionList||[])}catch(E){B.error(`获取 ${h} 版本列表失败`),console.error(E)}finally{f.value=!1}},V=async h=>{const E=B.loading("正在获取核心版本信息...",0);try{const F=await Tu(g.value,h),R={core:g.value,version:h,url:F.url,sha256:F.sha256||"",filename:`${g.value}-${h}.jar`};B.close(E),u("confirm",R),i.value=!1}catch(F){B.close(E),B.error("获取核心的版本信息失败"),console.error(F)}};return be(()=>n.visible,h=>{h&&!r.value.pluginsCore&&C()}),(h,E)=>{const F=v("t-loading"),R=v("t-icon"),H=v("t-input"),q=v("t-divider"),U=v("t-button"),_=v("t-dialog");return o(),D(_,{visible:i.value,"onUpdate:visible":E[2]||(E[2]=x=>i.value=x),header:"选择服务端核心",width:"85%",top:"5vh",attach:"body",footer:!1,"destroy-on-close":"",class:"core-selector-dialog"},{default:a(()=>[t("div",Fu,[t("div",Du,[E[3]||(E[3]=t("div",{class:"sidebar-title"},"服务端分类",-1)),E[4]||(E[4]=t("div",{class:"sidebar-desc"},"选择您需要的服务端类型",-1)),d.value?(o(),D(F,{key:0,loading:d.value,size:"small",text:"加载分类中..."},null,8,["loading"])):(o(),S("div",Ou,[(o(),S(ce,null,fe(A,x=>t("div",{key:x.key,class:$e(["category-item",{active:m.value===x.key}]),onClick:M=>k(x.key)},[t("div",Nu,[e(R,{name:x.icon},null,8,["name"])]),t("div",Ku,[t("div",qu,I(x.name),1),t("div",Gu,I(x.desc),1),r.value[x.dataKey]?(o(),S("div",Hu,I(r.value[x.dataKey]?.length||0)+" 个核心 ",1)):N("",!0)])],10,ju)),64))]))]),t("div",Ju,[t("div",Wu,[t("div",Xu,[E[5]||(E[5]=t("div",{class:"section-title"},"选择服务端核心",-1)),e(H,{modelValue:L.value,"onUpdate:modelValue":E[0]||(E[0]=x=>L.value=x),placeholder:"搜索核心...",class:"search-input"},{"suffix-icon":a(()=>[e(R,{name:"search"})]),_:1},8,["modelValue"])]),t("div",Qu,[(o(!0),S(ce,null,fe(w.value,x=>(o(),S("div",{key:x,class:$e(["core-card",{active:g.value===x}]),onClick:M=>z(x)},[c(I(x)+" ",1),g.value===x?(o(),D(R,{key:0,name:"check",class:"check-icon"})):N("",!0)],10,Yu))),128)),w.value.length===0?(o(),S("div",Zu,"该分类下暂无核心")):N("",!0)])]),g.value?(o(),S("div",ed,[e(q),t("div",td,[t("div",ad,I(g.value)+" 版本列表",1),e(U,{size:"small",variant:"text",onClick:E[1]||(E[1]=x=>p(g.value))},{icon:a(()=>[e(R,{name:"refresh"})]),default:a(()=>[E[6]||(E[6]=c("刷新 ",-1))]),_:1})]),e(F,{loading:f.value,size:"small",text:"获取版本中...",class:"loading-wrapper"},{default:a(()=>[t("div",sd,[(o(!0),S(ce,null,fe(y.value,x=>(o(),S("div",{key:x,class:"version-item",onClick:M=>V(x)},I(x),9,ld))),128)),y.value.length===0&&!f.value?(o(),S("div",nd,"未找到该核心的版本信息")):N("",!0)])]),_:1},8,["loading"])])):N("",!0)])])]),_:1},8,["visible"])}}}),Xa=ue(od,[["__scopeId","data-v-9e97180c"]]);async function Qa(s,l){return await Q.get({url:"/query/jdk",baseURL:"https://api.mslmc.cn/v3",params:{os:s,arch:l}})}async function Ya(s=!1){return await Q.get({url:"/api/java/list",params:{refresh:s},timeout:60*1e3})}const id={class:"main-layout-container"},rd={class:"steps-aside"},ud={class:"main-content"},dd={key:0,class:"form-step-container"},cd={class:"step-content"},md={class:"step-content"},pd={style:{"margin-top":"6px",display:"flex","flex-direction":"column",gap:"6px"}},vd={style:{"margin-top":"4px",color:"var(--td-text-color-placeholder)","font-size":"12px"}},fd={style:{width:"100%"}},gd={class:"java-option-panel"},_d={key:0,class:"flex-row"},hd={class:"tip"},yd={key:1,class:"flex-row"},bd={key:2},wd={key:3},kd={class:"step-content"},$d={key:0,class:"online-select-area"},xd={class:"select-core-wrapper"},Ad={key:0,class:"selected-core-card"},Cd={class:"core-icon"},Sd={class:"core-info"},Id={class:"core-filename"},Vd={key:1,class:"online-select-area"},Md={class:"select-core-wrapper"},Ud={key:1,class:"uploading-state"},Ld={class:"core-filename"},Bd={key:2,class:"selected-core-card"},zd={class:"core-icon"},Pd={class:"core-info"},Rd={class:"core-filename"},Ed={class:"core-url"},Td={key:2,class:"online-select-area"},Fd={class:"step-content"},Dd={class:"step-content"},Od={class:"confirm-container"},jd={class:"confirm-header"},Nd={class:"server-icon-placeholder"},Kd={class:"server-title-info"},qd={class:"server-name"},Gd={class:"server-path"},Hd={class:"confirm-item"},Jd={class:"value-row"},Wd={class:"main-text"},Xd={key:0,class:"sub-text"},Qd={key:1,class:"sub-text"},Yd={class:"confirm-item"},Zd={class:"value-row"},ec={key:0,class:"main-text"},tc=["title"],ac={key:0,class:"sub-text text-truncate"},sc=["title"],lc={class:"confirm-item"},nc={class:"memory-viz"},oc={class:"mem-block"},ic={class:"mem-val"},rc={class:"mem-arrow"},uc={class:"mem-block"},dc={class:"mem-val"},cc={class:"confirm-item"},mc={key:0,class:"args-box"},pc={key:1,class:"sub-text"},vc={key:1,class:"step-content creation-progress"},fc={class:"progress-title"},gc={class:"log-time"},_c={class:"log-message"},hc={key:2,class:"result-success"},yc={class:"result-success-title"},bc=ne({__name:"QuickMode",setup(s){const l=Fe(),n=$(null),u=sa(),i=$(0),d=$(!1),f=$(!1),r=$(!1),m=$(0),g=$([]),y=$(null),L=$(null),A=$(null),P=$("online"),w=$(!1),C=$(null),k=$(!1),z=$(0),p=$(""),V=$(""),h=$("online"),E=$([]),F=$([]),R=$(""),H=$(""),q=async(T=!1)=>{try{T&&B.info("正在刷新Java版本列表(重新扫描耗时较长)...");const j=await Qa(l.userInfo.systemInfo.osType.toLowerCase().replace("os",""),l.userInfo.systemInfo.osArchitecture.toLowerCase());j&&Array.isArray(j)&&(E.value=j.map(le=>({label:`Java ${le}`,value:le})),E.value.length>0&&!R.value&&(R.value=E.value[1].value)),F.value=(await Ya(T)).map(le=>({label:`Java ${le.version}${le.is64Bit?"":" (32位)"} (${le.vendor} | ${le.path})`,value:le.path})),F.value.length>0&&(H.value=F.value[0].value),T&&B.success("已刷新Java版本列表")}catch(j){B.warning("获取在线Java版本失败"+j.message)}};Ie(()=>{q()});const U=$({name:"新建服务器",path:"",java:"",core:"",coreUrl:"",coreSha256:"",coreFileKey:"",packageFileKey:"",minM:1024,maxM:4096,args:""}),_=[{label:"GB",value:"GB"},{label:"MB",value:"MB"}],x=$("GB"),M=$("GB"),J=se({get:()=>x.value==="GB"?U.value.minM/1024:U.value.minM,set:T=>{U.value.minM=x.value==="GB"?Math.round(T*1024):T}}),W=se({get:()=>M.value==="GB"?U.value.maxM/1024:U.value.maxM,set:T=>{U.value.maxM=M.value==="GB"?Math.round(T*1024):T}});be([h,R,H],([T,j,le])=>{T==="env"?U.value.java="java":T==="custom"||T==="local"?U.value.java=le:T==="online"&&(U.value.java=j?`MSLX://Java/${j}`:""),U.value.java&&n.value?.validate({fields:["java"]})},{immediate:!0});const X=se(()=>({name:[{required:!0,message:"实例名称不能为空",trigger:"blur"}],java:[{required:!0,message:"请配置 Java 环境",trigger:"change"}],core:[{required:!0,message:"核心名称/文件不能为空",trigger:"change"}],coreUrl:[{validator:T=>{if(P.value==="online"){if(!T)return{result:!1,message:"请选择一个服务端核心",type:"error"};if(T&&!/^https?:\/\/.+/.test(T))return{result:!1,message:"下载地址必须以 http(s) 开头",type:"error"}}return!0},trigger:"change"}],coreFileKey:[{validator:T=>P.value==="manual"&&!T?{result:!1,message:"请上传核心文件",type:"error"}:!0,trigger:"change"}],minM:[{required:!0,min:1,message:"最小内存必须大于0",trigger:"blur"}],maxM:[{required:!0,min:1,message:"最大内存必须大于0",trigger:"blur"}]})),K=[["name","path"],["java"],["core","coreUrl","coreSha256","coreFileKey"],["minM","maxM","args"],[]],G=()=>{i.value>0&&(i.value-=1)},Le=async()=>{if(i.value===2){if(P.value==="online"){if(!U.value.coreUrl||!U.value.core){B.warning("请点击按钮选择一个服务端核心");return}}else if(P.value==="custom"){if(!U.value.core){B.warning("请输入核心文件名");return}}else if(!U.value.coreFileKey){B.warning("请先上传核心文件");return}}const T=await n.value.validate();if(T===!0){i.value<4&&(i.value+=1);return}const j=new Set(K[i.value]);Object.keys(T).some(Z=>j.has(Z))?B.warning("请检查当前步骤的输入"):i.value<4&&(i.value+=1)},ve=T=>{U.value.core=T.filename,U.value.coreUrl=T.url,U.value.coreSha256=T.sha256,U.value.coreFileKey="",B.success(`已选择: ${T.core} (${T.version})`),n.value.validate({fields:["core","coreUrl"]})},Re=()=>{C.value?.click()},he=T=>{if(T===0)return"0 B";const j=1024,le=["B","KB","MB","GB"],Z=Math.floor(Math.log(T)/Math.log(j));return parseFloat((T/Math.pow(j,Z)).toFixed(2))+" "+le[Z]},Se=async T=>{const j=T.target;if(!j.files||j.files.length===0)return;if(U.value.coreFileKey)try{await It(U.value.coreFileKey),console.log("旧临时文件已清理:",U.value.coreFileKey)}catch(te){console.warn("清理旧文件失败，可能文件已过期",te)}const le=j.files[0],Z=le.name;U.value.core=Z,U.value.coreUrl="",U.value.coreSha256="",U.value.coreFileKey="",p.value=Z,V.value=he(le.size),await ze(le),j.value=""};let Be=null;const ze=async T=>{Be&&Be.abort(),Be=new AbortController,k.value=!0,z.value=0;const le=T.size>200*1024*1024?50*1024*1024:5*1024*1024,Z=Math.ceil(T.size/le),te=4,O=5,ie=new Map;let ge=0;const ke=()=>{const we=Date.now();if(we-ge<100)return;ge=we;const xe=Array.from(ie.values()).reduce((Ue,Ve)=>Ue+Ve,0),Pe=Math.min(xe/T.size*98,98);z.value=Number(Pe.toFixed(1))};try{const xe=(await ea()).uploadId;if(!xe)throw new Error("无法获取上传凭证");const Pe=Array.from({length:Z},(ee,Ae)=>Ae),Ue=async ee=>{if(Be?.signal.aborted)throw new Error("已取消");const Ae=ee*le,Ke=Math.min(T.size,Ae+le),qe=T.slice(Ae,Ke);let je;for(let De=1;De<=O;De++){if(Be?.signal.aborted)throw new Error("已取消");try{await ta(xe,ee,qe,tt=>{tt&&tt.loaded&&(ie.set(ee,tt.loaded),ke())},Be?.signal),ie.set(ee,qe.size),ke();return}catch(tt){je=tt,ie.set(ee,0),ke(),De<O&&await new Promise(ye=>setTimeout(ye,1e3*De))}}throw new Error(`分片 ${ee} 失败: ${je?.message}`)},Ve=async()=>{for(;Pe.length>0&&!Be?.signal.aborted;){const ee=Pe.shift();ee!==void 0&&await Ue(ee)}},Ge=Array(Math.min(te,Z)).fill(null).map(()=>Ve());if(await Promise.all(Ge),Be?.signal.aborted)throw new Error("已取消");const Oe=(await aa(xe,Z)).uploadId;z.value=100,U.value.coreFileKey=Oe,B.success("核心文件上传成功！"),n.value?.validate({fields:["core","coreFileKey"]})}catch(we){if(we.message==="已取消")return;console.error(we),B.error(`上传失败: ${we.message||"未知错误"}`),U.value.core="",p.value="",z.value=0,U.value.coreFileKey&&(It(U.value.coreFileKey).catch(()=>{}),U.value.coreFileKey="")}finally{Be?.signal.aborted||(k.value=!1)}},de=async()=>{U.value.coreFileKey&&(await It(U.value.coreFileKey),U.value.coreFileKey="",U.value.core="",p.value="",B.success("文件已移除"))},me=async()=>{if(!(await n.value.validate()===!0)){B.warning("请检查表单所有内容");return}d.value=!0,g.value=[];const le={...U.value,path:U.value.path||null,coreUrl:U.value.coreUrl||null,coreSha256:U.value.coreSha256||null,coreFileKey:U.value.coreFileKey||null,args:U.value.args||null};P.value==="manual"?(le.coreUrl=null,le.coreSha256=null):le.coreFileKey=null;try{const te=(await Wa(le)).serverId;if(!te)throw new Error("服务器未返回 ServerId");L.value=te.toString(),f.value=!0,i.value=5,await Ee(L.value)}catch(Z){const te=Z.message||"创建请求失败，请检查网络或后端服务";B.error(te),d.value=!1}},Ee=async T=>{const{baseUrl:j,token:le}=l;let Z=!1;const te=new URL("/api/hubs/creationProgressHub",j||window.location.origin);te.searchParams.append("x-user-token",le),y.value=new Lt().withUrl(te.toString(),{withCredentials:!1}).configureLogging(Ft.Information).build();const O=(ie,ge=null)=>{g.value.push({time:new Date().toLocaleTimeString(),message:ie,progress:ge}),kt(()=>{A.value&&(A.value.scrollTop=A.value.scrollHeight)})};y.value.on("StatusUpdate",(ie,ge,ke)=>{ie.toString()===T&&(O(ge,ke),ke!==null&&ke>=0&&(m.value=ke),ke===100?(Z=!0,B.success("服务器创建成功！"),y.value?.stop(),f.value=!1,r.value=!0,i.value=6,d.value=!1,u.refreshInstanceList()):ke===-1&&(B.error(ge||"创建过程中发生未知错误"),y.value?.stop(),f.value=!1,d.value=!1,i.value=0))});try{await y.value.start(),O("已连接到实时进度服务..."),await y.value.invoke("TrackServer",T),O("已订阅任务，等待服务器响应...")}catch(ie){Z||(O(`SignalR 连接失败: ${ie.message}`,-1),B.error("无法连接到实时进度服务"),f.value=!1,d.value=!1,i.value=0)}};Qe(()=>{y.value?.stop(),Be&&Be.abort()});const oe=()=>{r.value=!1,i.value=0,U.value={...U.value,name:"新建服务器",core:"",coreUrl:"",coreSha256:"",path:"",args:"",coreFileKey:""},p.value="",P.value="online",h.value="online",H.value=""};return(T,j)=>{const le=v("t-step-item"),Z=v("t-steps"),te=v("t-input"),O=v("t-form-item"),ie=v("t-tag"),ge=v("t-space"),ke=v("t-icon"),we=v("t-alert"),xe=v("t-radio-button"),Pe=v("t-radio-group"),Ue=v("t-select"),Ve=v("t-button"),Ge=v("t-progress"),Ye=v("t-input-number"),Oe=v("t-col"),ee=v("t-row"),Ae=v("t-textarea"),Ke=v("t-divider"),qe=v("t-form"),je=v("t-list-item-meta"),De=v("t-list-item"),tt=v("t-list");return o(),S("div",null,[t("div",id,[t("div",rd,[e(Z,{layout:"vertical",style:{"margin-top":"16px"},current:i.value,status:"process",readonly:""},{default:a(()=>[e(le,{title:"基本信息",content:"填写实例名称和路径"}),e(le,{title:"Java 环境",content:"配置 Java 运行时"}),e(le,{title:"核心文件",content:"指定核心文件及下载"}),e(le,{title:"资源配置",content:"设置内存与 JVM 参数"}),e(le,{title:"确认信息",content:"核对并提交"}),e(le,{title:"创建实例",content:"提交并等待创建"}),e(le,{title:"完成",content:"查看创建结果"})]),_:1},8,["current"])]),t("div",ud,[!f.value&&!r.value?(o(),S("div",dd,[e(qe,{ref_key:"formRef",ref:n,data:U.value,rules:X.value,"label-align":"top",class:"step-form",onSubmit:me},{default:a(()=>[Je(t("div",cd,[e(O,{label:"实例名称",name:"name"},{default:a(()=>[e(te,{modelValue:U.value.name,"onUpdate:modelValue":j[0]||(j[0]=ye=>U.value.name=ye),placeholder:"为你的服务器起个名字"},null,8,["modelValue"])]),_:1}),e(O,{label:"实例路径",name:"path",help:b(l).userInfo.systemInfo.docker?"您正在使用Docker容器部署，为保数据安全，仅支持使用默认数据路径":"选填，留空将使用默认路径"},{default:a(()=>[e(te,{modelValue:U.value.path,"onUpdate:modelValue":j[1]||(j[1]=ye=>U.value.path=ye),disabled:b(l).userInfo.systemInfo.docker,placeholder:"例如: D:\\MyServer"},null,8,["modelValue","disabled"])]),_:1},8,["help"])],512),[[at,i.value===0]]),Je(t("div",md,[e(we,{theme:"info",title:"Java 版本选择指南"},{message:a(()=>[t("div",pd,[e(ge,{align:"center",size:12},{default:a(()=>[e(ie,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...j[20]||(j[20]=[c("MC 26.1 - 最新版本",-1)])]),_:1}),e(ie,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...j[21]||(j[21]=[c("Java 25",-1)])]),_:1})]),_:1}),e(ge,{align:"center",size:12},{default:a(()=>[e(ie,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...j[22]||(j[22]=[c("MC 1.20.5 - 1.21.11",-1)])]),_:1}),e(ie,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...j[23]||(j[23]=[c("Java 21",-1)])]),_:1})]),_:1}),e(ge,{align:"center",size:12},{default:a(()=>[e(ie,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...j[24]||(j[24]=[c("MC 1.18 - 1.20.4",-1)])]),_:1}),e(ie,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...j[25]||(j[25]=[c("Java 17",-1)])]),_:1})]),_:1}),e(ge,{align:"center",size:12},{default:a(()=>[e(ie,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...j[26]||(j[26]=[c("MC 1.17 / 1.17.1",-1)])]),_:1}),e(ie,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...j[27]||(j[27]=[c("Java 16",-1)])]),_:1})]),_:1}),e(ge,{align:"center",size:12},{default:a(()=>[e(ie,{theme:"default",variant:"outline",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...j[28]||(j[28]=[c("MC 1.13 - 更低版本",-1)])]),_:1}),e(ie,{theme:"default",variant:"light",shape:"round"},{default:a(()=>[...j[29]||(j[29]=[c("Java 8",-1)])]),_:1})]),_:1}),t("div",vd,[e(ke,{name:"info-circle",size:"small",style:{"margin-right":"4px"}}),j[30]||(j[30]=c(" 建议直接使用推荐版本，避免兼容性问题。 ",-1))])])]),_:1}),e(O,{label:"Java 来源",name:"java"},{default:a(()=>[t("div",fd,[e(Pe,{modelValue:h.value,"onUpdate:modelValue":j[2]||(j[2]=ye=>h.value=ye),variant:"default-filled"},{default:a(()=>[e(xe,{value:"online"},{default:a(()=>[...j[31]||(j[31]=[c("在线下载",-1)])]),_:1}),e(xe,{value:"local"},{default:a(()=>[...j[32]||(j[32]=[c("选择电脑上的 Java",-1)])]),_:1}),e(xe,{value:"env"},{default:a(()=>[...j[33]||(j[33]=[c("环境变量",-1)])]),_:1}),e(xe,{value:"custom"},{default:a(()=>[...j[34]||(j[34]=[c("自定义路径",-1)])]),_:1})]),_:1},8,["modelValue"]),t("div",gd,[h.value==="online"?(o(),S("div",_d,[e(Ue,{modelValue:R.value,"onUpdate:modelValue":j[3]||(j[3]=ye=>R.value=ye),options:E.value,placeholder:"请选择 Java 版本"},null,8,["modelValue","options"]),t("div",hd," 将下载并使用 Java "+I(R.value||"?")+" "+I(b(l).userInfo.systemInfo.osType.toLowerCase().replace("os",""))+" / "+I(b(l).userInfo.systemInfo.osArchitecture.toLowerCase()),1)])):N("",!0),h.value==="local"?(o(),S("div",yd,[e(Ue,{modelValue:H.value,"onUpdate:modelValue":j[4]||(j[4]=ye=>H.value=ye),options:F.value,placeholder:"请选择 Java 版本"},null,8,["modelValue","options"]),e(Ve,{variant:"outline",theme:"primary",onClick:j[5]||(j[5]=ye=>q(!0))},{default:a(()=>[...j[35]||(j[35]=[c("重新扫描",-1)])]),_:1})])):N("",!0),h.value==="env"?(o(),S("div",bd,[e(te,{"model-value":"java",readonly:"",disabled:""}),j[36]||(j[36]=t("div",{class:"tip"},"将使用系统环境变量中的 java 命令",-1))])):N("",!0),h.value==="custom"?(o(),S("div",wd,[e(te,{modelValue:H.value,"onUpdate:modelValue":j[6]||(j[6]=ye=>H.value=ye),placeholder:"例如: C:\\Program Files\\Java\\jdk-17\\bin\\java.exe"},null,8,["modelValue"])])):N("",!0)])])]),_:1})],512),[[at,i.value===1]]),Je(t("div",kd,[e(O,{label:"选择您的Minecraft开服使用的服务端核心"},{default:a(()=>[e(Pe,{modelValue:P.value,"onUpdate:modelValue":j[7]||(j[7]=ye=>P.value=ye),variant:"default-filled"},{default:a(()=>[e(xe,{value:"online"},{default:a(()=>[...j[37]||(j[37]=[c("在线下载 (推荐)",-1)])]),_:1}),e(xe,{value:"manual"},{default:a(()=>[...j[38]||(j[38]=[c("选择本地文件",-1)])]),_:1}),e(xe,{value:"custom"},{default:a(()=>[...j[39]||(j[39]=[c("自定义文件名",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),P.value==="online"?(o(),S("div",$d,[e(O,{label:"选择服务端核心",name:"coreUrl"},{default:a(()=>[t("div",xd,[e(Ve,{variant:"outline",onClick:j[8]||(j[8]=ye=>w.value=!0)},{icon:a(()=>[e(ke,{name:"cloud-download"})]),default:a(()=>[j[40]||(j[40]=c(" 点击打开服务端核心选择库 ",-1))]),_:1}),U.value.core?(o(),S("div",Ad,[t("div",Cd,[e(ke,{name:"check-circle-filled"})]),t("div",Sd,[t("div",Id,I(U.value.core),1),j[41]||(j[41]=t("div",{class:"core-url",title:"MSLX 将在稍后帮您自动下载此文件..."}," MSLX 将在稍后帮您自动下载此文件... ",-1))]),e(Ve,{shape:"circle",variant:"text",theme:"danger",onClick:j[9]||(j[9]=ye=>{U.value.core="",U.value.coreUrl=""})},{default:a(()=>[e(ke,{name:"close"})]),_:1})])):N("",!0)])]),_:1}),Je(t("input",{"onUpdate:modelValue":j[10]||(j[10]=ye=>U.value.coreSha256=ye),type:"hidden"},null,512),[[Is,U.value.coreSha256]])])):N("",!0),P.value==="manual"?(o(),S("div",Vd,[e(O,{label:"上传核心文件",name:"coreFileKey"},{default:a(()=>[t("div",Md,[t("input",{ref_key:"uploadInputRef",ref:C,accept:".jar",type:"file",style:{display:"none"},onChange:Se},null,544),!k.value&&!U.value.coreFileKey?(o(),D(Ve,{key:0,variant:"outline",onClick:Re},{icon:a(()=>[e(ke,{name:"upload"})]),default:a(()=>[j[42]||(j[42]=c(" 点击选择文件并上传 ",-1))]),_:1})):N("",!0),k.value?(o(),S("div",Ud,[t("div",Ld,"正在上传: "+I(p.value)+" ("+I(V.value)+")",1),e(Ge,{theme:"line",percentage:z.value},null,8,["percentage"]),j[43]||(j[43]=t("div",{class:"tip"},"别着急，喝杯茶🍵...",-1))])):N("",!0),U.value.coreFileKey&&!k.value?(o(),S("div",Bd,[t("div",zd,[e(ke,{name:"check-circle-filled"})]),t("div",Pd,[t("div",Rd,I(p.value),1),t("div",Ed,I(V.value)+" | 已上传准备就绪",1)]),e(Ve,{shape:"circle",variant:"text",theme:"primary",onClick:Re},{icon:a(()=>[e(ke,{name:"swap"})]),_:1}),e(Ve,{shape:"circle",variant:"text",theme:"danger",onClick:de},{icon:a(()=>[e(ke,{name:"delete"})]),_:1})])):N("",!0)])]),_:1})])):N("",!0),P.value==="custom"?(o(),S("div",Td,[e(we,{theme:"warning",message:"此模式通常用于服务器目录中已经存在核心文件，或者您打算稍后手动通过文件管理上传核心。",style:{"margin-bottom":"16px"}}),e(O,{label:"核心文件名",name:"core",help:"请确保文件名包含后缀，例如: server.jar"},{default:a(()=>[e(te,{modelValue:U.value.core,"onUpdate:modelValue":j[11]||(j[11]=ye=>U.value.core=ye),placeholder:"请输入核心文件名 (例如 server.jar)"},null,8,["modelValue"])]),_:1})])):N("",!0)],512),[[at,i.value===2]]),Je(t("div",Fd,[e(ee,{gutter:[16,24]},{default:a(()=>[e(Oe,{xs:12,span:6},{default:a(()=>[e(O,{label:"最小内存",name:"minM"},{default:a(()=>[e(ge,{size:8,style:{width:"100%"}},{default:a(()=>[e(Ye,{modelValue:J.value,"onUpdate:modelValue":j[12]||(j[12]=ye=>J.value=ye),min:0,"decimal-places":x.value==="GB"?1:0,placeholder:"Xms",theme:"column",style:{width:"100%"}},null,8,["modelValue","decimal-places"]),e(Ue,{modelValue:x.value,"onUpdate:modelValue":j[13]||(j[13]=ye=>x.value=ye),options:_,clearable:!1,style:{width:"80px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Oe,{xs:12,span:6},{default:a(()=>[e(O,{label:"最大内存",name:"maxM"},{default:a(()=>[e(ge,{size:8,style:{width:"100%"}},{default:a(()=>[e(Ye,{modelValue:W.value,"onUpdate:modelValue":j[14]||(j[14]=ye=>W.value=ye),min:0,"decimal-places":M.value==="GB"?1:0,placeholder:"Xmx",theme:"column",style:{width:"100%"}},null,8,["modelValue","decimal-places"]),e(Ue,{modelValue:M.value,"onUpdate:modelValue":j[15]||(j[15]=ye=>M.value=ye),options:_,clearable:!1,style:{width:"80px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(O,{label:"额外 JVM 参数 (可选)",name:"args",help:"例如: -XX:+UseG1GC",style:{"margin-top":"16px"}},{default:a(()=>[e(Ae,{modelValue:U.value.args,"onUpdate:modelValue":j[16]||(j[16]=ye=>U.value.args=ye),placeholder:"-XX:+UseG1GC"},null,8,["modelValue"])]),_:1})],512),[[at,i.value===3]]),Je(t("div",Dd,[t("div",Od,[t("div",jd,[t("div",Nd,[e(ke,{name:"server",size:"32px"})]),t("div",Kd,[t("div",qd,I(U.value.name),1),t("div",Gd,[e(ke,{name:"folder-open",size:"small"}),c(" "+I(U.value.path||"默认数据路径 (/DaemonData/Servers)"),1)])])]),e(Ke,{dashed:"",style:{margin:"16px 0"}}),e(ee,{gutter:[24,24]},{default:a(()=>[e(Oe,{span:6},{default:a(()=>[t("div",Hd,[j[47]||(j[47]=t("div",{class:"label"},"服务端核心",-1)),t("div",Jd,[t("span",Wd,I(U.value.core),1),P.value==="online"?(o(),D(ie,{key:0,theme:"primary",variant:"light",size:"small"},{default:a(()=>[...j[44]||(j[44]=[c(" 在线下载 ",-1)])]),_:1})):P.value==="manual"?(o(),D(ie,{key:1,theme:"warning",variant:"light",size:"small"},{default:a(()=>[...j[45]||(j[45]=[c(" 手动上传 ",-1)])]),_:1})):(o(),D(ie,{key:2,theme:"default",variant:"light",size:"small",shape:"round"},{default:a(()=>[...j[46]||(j[46]=[c("自定义",-1)])]),_:1}))]),P.value==="online"?(o(),S("div",Xd," 来源: MSL 镜像源 ("+I(U.value.coreUrl?"已匹配":"未匹配")+") ",1)):(o(),S("div",Qd,"大小: "+I(V.value||"未知"),1))])]),_:1}),e(Oe,{span:6},{default:a(()=>[t("div",Yd,[j[52]||(j[52]=t("div",{class:"label"},"Java 运行时",-1)),t("div",Zd,[h.value==="online"?(o(),S("span",ec," Java "+I(R.value),1)):(o(),S("span",{key:1,class:"main-text text-truncate",title:U.value.java},I(U.value.java),9,tc)),h.value==="online"?(o(),D(ie,{key:2,theme:"success",variant:"light",size:"small"},{default:a(()=>[...j[48]||(j[48]=[c(" 自动安装 ",-1)])]),_:1})):h.value==="local"?(o(),D(ie,{key:3,theme:"primary",variant:"light",size:"small",shape:"round"},{default:a(()=>[...j[49]||(j[49]=[c(" 本机环境 ",-1)])]),_:1})):h.value==="env"?(o(),D(ie,{key:4,theme:"warning",variant:"light",size:"small",shape:"round"},{default:a(()=>[...j[50]||(j[50]=[c(" 环境变量 ",-1)])]),_:1})):(o(),D(ie,{key:5,theme:"default",variant:"light",size:"small"},{default:a(()=>[...j[51]||(j[51]=[c("自定义路径",-1)])]),_:1}))]),h.value==="online"?(o(),S("div",ac," 将自动从镜像源下载并解压 JDK ")):(o(),S("div",{key:1,class:"sub-text text-truncate",title:U.value.java}," 本机环境: "+I(U.value.java),9,sc))])]),_:1}),e(Oe,{span:6},{default:a(()=>[t("div",lc,[j[55]||(j[55]=t("div",{class:"label"},"内存分配 (JVM)",-1)),t("div",nc,[t("div",oc,[j[53]||(j[53]=t("span",{class:"mem-label"},"初始 (Xms)",-1)),t("span",ic,I(J.value)+" "+I(x.value),1)]),t("div",rc,[e(ke,{name:"arrow-right"})]),t("div",uc,[j[54]||(j[54]=t("span",{class:"mem-label"},"最大 (Xmx)",-1)),t("span",dc,I(W.value)+" "+I(M.value),1)])])])]),_:1}),e(Oe,{span:6},{default:a(()=>[t("div",cc,[j[56]||(j[56]=t("div",{class:"label"},"启动参数",-1)),U.value.args?(o(),S("div",mc,I(U.value.args),1)):(o(),S("div",pc,"无额外参数"))])]),_:1})]),_:1}),e(we,{style:{"margin-top":"24px"},theme:"info"},{message:a(()=>[...j[57]||(j[57]=[c(" 确认无误后点击下方 ",-1),t("b",null,"提交创建",-1),c("，系统将自动开始下载资源并部署实例。 ",-1)])]),_:1})])],512),[[at,i.value===4]]),e(O,{class:"step-actions"},{default:a(()=>[i.value>0?(o(),D(Ve,{key:0,theme:"default",onClick:G},{default:a(()=>[...j[58]||(j[58]=[c("上一步",-1)])]),_:1})):N("",!0),i.value<4?(o(),D(Ve,{key:1,type:"button",onClick:Le},{default:a(()=>[...j[59]||(j[59]=[c("下一步",-1)])]),_:1})):N("",!0),i.value===4?(o(),D(Ve,{key:2,theme:"primary",type:"submit",loading:d.value},{default:a(()=>[...j[60]||(j[60]=[c(" 提交创建 ",-1)])]),_:1},8,["loading"])):N("",!0)]),_:1})]),_:1},8,["data","rules"])])):N("",!0),f.value?(o(),S("div",vc,[t("div",fc,"正在创建实例 ("+I(L.value)+")",1),j[61]||(j[61]=t("p",null,"请勿关闭此页面，创建过程可能需要几分钟...",-1)),e(Ge,{theme:"plump",percentage:m.value,label:`${m.value.toFixed(2)}%`},null,8,["percentage","label"]),t("div",{ref_key:"logContainerRef",ref:A,class:"log-container"},[e(tt,{split:!0},{default:a(()=>[(o(!0),S(ce,null,fe(g.value,(ye,gt)=>(o(),D(De,{key:gt},{default:a(()=>[e(je,null,{description:a(()=>[t("span",gc,"["+I(ye.time)+"]",1),t("span",_c,I(ye.message),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})],512)])):N("",!0),r.value?(o(),S("div",hc,[e(ke,{class:"result-success-icon",name:"check-circle"}),t("div",yc,"服务器 ("+I(L.value)+") 已创建成功",1),j[64]||(j[64]=t("div",{class:"result-success-describe"},"你现在可以去服务器列表启动它了",-1)),t("div",null,[e(Ve,{onClick:j[17]||(j[17]=()=>{oe(),b(Me)("/instance/list")})},{default:a(()=>[...j[62]||(j[62]=[c(" 返回服务端列表 ",-1)])]),_:1}),e(Ve,{theme:"default",onClick:j[18]||(j[18]=()=>{oe(),b(Me)(`/instance/console/${L.value}`)})},{default:a(()=>[...j[63]||(j[63]=[c(" 前往控制台 ",-1)])]),_:1})])])):N("",!0)])]),e(Xa,{visible:w.value,"onUpdate:visible":j[19]||(j[19]=ye=>w.value=ye),onConfirm:ve},null,8,["visible"])])}}}),wc=ue(bc,[["__scopeId","data-v-54704971"]]),kc={key:0},$c={key:1,class:"result-success"},xc={class:"result-success-title"},Ac=ne({__name:"CustomMode",setup(s){const l=Fe(),n=$(!1),u=$(0),i=$(null),d=Xe({name:"",path:null,java:"none",core:"none",coreUrl:"",coreSha256:"",coreFileKey:"",packageFileKey:"",minM:1027,maxM:1027,args:"",ignoreEula:!0}),f={name:[{required:!0,message:"请输入服务器名称",type:"error"}],args:[{required:!0,message:"请输入自定义启动参数",type:"error"}]},r=async({validateResult:g})=>{if(g===!0)try{const y=await Wa(d);u.value=y.serverId,B.success("创建成功"),n.value=!0}catch(y){B.error("创建失败！"+y.message)}else B.warning("请检查表单填写")},m=()=>{n.value=!1,Object.assign(d,{name:"新建服务器",path:null,java:"none",core:"none",packageFileKey:"",coreFileKey:"",coreUrl:"",coreSha256:"",minM:1027,maxM:1027,args:"",ignoreEula:!0})};return(g,y)=>{const L=v("t-input"),A=v("t-form-item"),P=v("t-textarea"),w=v("t-switch"),C=v("t-button"),k=v("t-space"),z=v("t-form"),p=v("t-icon");return o(),S("div",null,[n.value?(o(),S("div",$c,[e(p,{class:"result-success-icon",name:"check-circle"}),t("div",xc,"服务器 ("+I(u.value)+") 已创建成功",1),y[9]||(y[9]=t("div",{class:"result-success-describe"},"你现在可以去服务器列表启动它了",-1)),t("div",null,[e(C,{onClick:y[4]||(y[4]=()=>{m(),b(Me)("/instance/list")})},{default:a(()=>[...y[7]||(y[7]=[c(" 返回服务端列表 ",-1)])]),_:1}),e(C,{theme:"default",onClick:y[5]||(y[5]=()=>{m(),b(Me)(`/instance/console/${u.value}`)})},{default:a(()=>[...y[8]||(y[8]=[c(" 前往控制台 ",-1)])]),_:1})])])):(o(),S("div",kc,[e(z,{ref_key:"formRef",ref:i,rules:f,data:d,"label-align":"top",onSubmit:r},{default:a(()=>[e(A,{label:"服务器名称",name:"name"},{default:a(()=>[e(L,{modelValue:d.name,"onUpdate:modelValue":y[0]||(y[0]=V=>d.name=V),placeholder:"给你的服务器起一个名字"},null,8,["modelValue"])]),_:1}),e(A,{label:"存储路径(可选)",name:"path",help:b(l).userInfo.systemInfo.docker?"您正在使用Docker容器部署，为保数据安全，仅支持使用默认数据路径":"选填，留空将使用默认路径"},{default:a(()=>[e(L,{modelValue:d.path,"onUpdate:modelValue":y[1]||(y[1]=V=>d.path=V),disabled:b(l).userInfo.systemInfo.docker,placeholder:"请填写服务端保存位置"},null,8,["modelValue","disabled"])]),_:1},8,["help"]),e(A,{label:"启动指令",name:"args",help:"此模式不会自动帮您配置Java环境，您需要填写完整的启动命令。"},{default:a(()=>[e(P,{modelValue:d.args,"onUpdate:modelValue":y[2]||(y[2]=V=>d.args=V),placeholder:"start.bat...",autosize:{minRows:5,maxRows:25},class:"code-font-textarea"},null,8,["modelValue"])]),_:1}),e(A,{label:"忽略EULA提示",name:"args",help:"若您的实例并非MC服务器，可打开此选项"},{default:a(()=>[e(w,{modelValue:d.ignoreEula,"onUpdate:modelValue":y[3]||(y[3]=V=>d.ignoreEula=V),label:["已开启","已关闭"]},null,8,["modelValue"])]),_:1}),e(A,{style:{"margin-top":"20px"}},{default:a(()=>[e(k,null,{default:a(()=>[e(C,{theme:"primary",type:"submit"},{default:a(()=>[...y[6]||(y[6]=[c("提交创建",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]))])}}}),Cc=ue(Ac,[["__scopeId","data-v-8f0c5701"]]),Sc={class:"main-layout-container"},Ic={class:"steps-aside"},Vc={class:"main-content"},Mc={key:0,class:"form-step-container"},Uc={class:"step-content"},Lc={class:"step-content"},Bc={class:"select-core-wrapper"},zc={key:1,class:"uploading-state"},Pc={class:"core-filename"},Rc={key:2,class:"uploading-state"},Ec={key:3,class:"selected-core-card"},Tc={class:"core-icon"},Fc={class:"core-info"},Dc={class:"core-filename"},Oc={class:"core-url"},jc={class:"step-content"},Nc={key:0},Kc={key:1},qc={key:0,class:"online-select-area"},Gc={class:"select-core-wrapper"},Hc={key:0,class:"selected-core-card"},Jc={class:"core-icon"},Wc={class:"core-info"},Xc={class:"core-filename"},Qc={key:1,class:"online-select-area"},Yc={class:"step-content"},Zc={style:{"margin-top":"6px",display:"flex","flex-direction":"column",gap:"6px"}},em={style:{"margin-top":"4px",color:"var(--td-text-color-placeholder)","font-size":"12px"}},tm={style:{width:"100%"}},am={class:"java-option-panel"},sm={key:0,class:"flex-row"},lm={key:1,class:"flex-row"},nm={key:2},om={key:3},im={class:"step-content"},rm={class:"step-content"},um={class:"confirm-container"},dm={class:"confirm-header"},cm={class:"server-icon-placeholder"},mm={class:"server-title-info"},pm={class:"server-name"},vm={class:"server-path"},fm={class:"confirm-item"},gm={class:"value-row"},_m=["title"],hm={class:"sub-text"},ym={class:"confirm-item"},bm={class:"value-row"},wm=["title"],km={key:0,class:"sub-text"},$m={key:1,class:"sub-text"},xm={class:"confirm-item"},Am={class:"value-row"},Cm={key:0,class:"main-text"},Sm=["title"],Im={key:0,class:"sub-text text-truncate"},Vm={class:"confirm-item"},Mm={class:"memory-viz"},Um={class:"mem-block"},Lm={class:"mem-val"},Bm={class:"mem-arrow"},zm={class:"mem-block"},Pm={class:"mem-val"},Rm={class:"confirm-item"},Em={class:"args-box"},Tm={key:1,class:"step-content creation-progress"},Fm={class:"progress-title"},Dm={key:2,class:"result-success"},Om=ne({__name:"PackageMode",setup(s){const l=Fe(),n=$(null),u=sa(),i=$(0),d=$(!1),f=$(!1),r=$(!1),m=$(0),g=$([]),y=$(null),L=$(null),A=$(null),P=$("online"),w=$(!1),C=$([]),k=$(!1),z=$(""),p=$(null),V=$(!1),h=$(0),E=$(""),F=$(""),R=$("online"),H=$([]),q=$([]),U=$(""),_=$(""),x=async(te=!1)=>{try{te&&B.info("正在刷新Java版本列表...");const O=await Qa(l.userInfo.systemInfo.osType.toLowerCase().replace("os",""),l.userInfo.systemInfo.osArchitecture.toLowerCase());O&&Array.isArray(O)&&(H.value=O.map(ie=>({label:`Java ${ie}`,value:ie})),H.value.length>0&&!U.value&&(U.value=H.value[1].value)),q.value=(await Ya(te)).map(ie=>({label:`Java ${ie.version}${ie.is64Bit?"":" (32位)"} (${ie.vendor} | ${ie.path})`,value:ie.path})),q.value.length>0&&(_.value=q.value[0].value),te&&B.success("已刷新Java版本列表")}catch(O){B.warning("获取在线Java版本失败: "+O.message)}};Ie(()=>{x()});const M=$({name:"新建整合包服务器",path:"",java:"",core:"",coreUrl:"",coreSha256:"",coreFileKey:"",packageFileKey:"",minM:2048,maxM:6144,args:""}),J=$("GB"),W=$("GB"),X=[{label:"MB",value:"MB"},{label:"GB",value:"GB"}],K=se({get:()=>J.value==="GB"?M.value.minM/1024:M.value.minM,set:te=>{M.value.minM=J.value==="GB"?Math.round(te*1024):te}}),G=se({get:()=>W.value==="GB"?M.value.maxM/1024:M.value.maxM,set:te=>{M.value.maxM=W.value==="GB"?Math.round(te*1024):te}});be([R,U,_],([te,O,ie])=>{te==="env"?M.value.java="java":te==="custom"||te==="local"?M.value.java=ie:te==="online"&&(M.value.java=O?`MSLX://Java/${O}`:""),M.value.java&&n.value?.validate({fields:["java"]})},{immediate:!0});const Le=se(()=>({name:[{required:!0,message:"实例名称不能为空",trigger:"blur"}],packageFileKey:[{required:!0,message:"请上传整合包文件",trigger:"change"}],core:[{validator:te=>{if(C.value.length>0){if(!te)return{result:!1,message:"请选择一个启动Jar",type:"error"}}else{if(P.value==="online"&&!M.value.coreUrl)return{result:!1,message:"请选择服务端核心",type:"error"};if(P.value==="manual"&&!M.value.coreFileKey)return{result:!1,message:"请上传核心文件",type:"error"}}return!0},trigger:"change"}],java:[{required:!0,message:"请配置 Java 环境",trigger:"change"}],minM:[{required:!0,min:1,message:"必须大于0",trigger:"blur"}],maxM:[{required:!0,min:1,message:"必须大于0",trigger:"blur"}]})),ve=[["name","path"],["packageFileKey"],["core","coreUrl","coreFileKey"],["java"],["minM","maxM","args"],[]],Re=()=>{i.value>0&&(i.value-=1)},he=async()=>{if(i.value===1){if(!M.value.packageFileKey){B.warning("请先上传服务端整合包(Zip)");return}if(V.value||k.value){B.warning("请等待上传或分析完成");return}}if(i.value===2)if(C.value.length>0){if(!M.value.core){B.warning("请从列表中选择一个启动核心");return}}else{if(P.value==="online"&&(!M.value.coreUrl||!M.value.core)){B.warning("请选择一个服务端核心");return}if(P.value==="manual"&&!M.value.coreFileKey){B.warning("请上传核心文件");return}}const te=await n.value.validate();if(te===!0){i.value<5&&(i.value+=1);return}const O=new Set(ve[i.value]);Object.keys(te).some(ge=>O.has(ge))?B.warning("请检查当前步骤的输入"):i.value<5&&(i.value+=1)},Se=()=>{p.value?.click()},Be=te=>{if(te===0)return"0 B";const O=1024,ie=["B","KB","MB","GB"],ge=Math.floor(Math.log(te)/Math.log(O));return parseFloat((te/Math.pow(O,ge)).toFixed(2))+" "+ie[ge]},ze=async te=>{const O=te.target;if(!O.files||O.files.length===0)return;if(M.value.packageFileKey)try{await It(M.value.packageFileKey)}catch(ge){console.error(ge)}M.value.core="",C.value=[],z.value="";const ie=O.files[0];E.value=ie.name,F.value=Be(ie.size),await me(ie),O.value=""};let de=null;const me=async te=>{de&&de.abort(),de=new AbortController,V.value=!0,h.value=0;const ie=te.size>200*1024*1024?50*1024*1024:10*1024*1024,ge=Math.ceil(te.size/ie),ke=4,we=5,xe=new Map;let Pe=0;const Ue=()=>{const Ve=Date.now();if(Ve-Pe<100)return;Pe=Ve;const Ge=Array.from(xe.values()).reduce((Oe,ee)=>Oe+ee,0),Ye=Math.min(Ge/te.size*98,98);h.value=Number(Ye.toFixed(1))};try{const Ge=(await ea()).uploadId;if(!Ge)throw new Error("无法获取上传凭证");const Ye=Array.from({length:ge},(je,De)=>De),Oe=async je=>{if(de?.signal.aborted)throw new Error("已取消");const De=je*ie,tt=Math.min(te.size,De+ie),ye=te.slice(De,tt);let gt;for(let _t=1;_t<=we;_t++){if(de?.signal.aborted)throw new Error("已取消");try{await ta(Ge,je,ye,ot=>{ot&&ot.loaded&&(xe.set(je,ot.loaded),Ue())},de?.signal),xe.set(je,ye.size),Ue();return}catch(ot){gt=ot,xe.set(je,0),Ue(),_t<we&&await new Promise(At=>setTimeout(At,1e3*_t))}}throw new Error(`分片 ${je} 失败: ${gt?.message}`)},ee=async()=>{for(;Ye.length>0&&!de?.signal.aborted;){const je=Ye.shift();je!==void 0&&await Oe(je)}},Ae=Array(Math.min(ke,ge)).fill(null).map(()=>ee());if(await Promise.all(Ae),de?.signal.aborted)throw new Error("已取消");h.value=99;const qe=(await aa(Ge,ge)).uploadId;h.value=100,M.value.packageFileKey=qe,B.success("上传成功，正在分析整合包内容..."),await Ee(qe)}catch(Ve){if(Ve.message==="已取消")return;de?.abort(),console.error(Ve),B.error(`上传失败: ${Ve.message||"未知错误"}`),E.value="",h.value=0,M.value.packageFileKey&&(It(M.value.packageFileKey).catch(()=>{}),M.value.packageFileKey="")}finally{de?.signal.aborted||(V.value=!1)}},Ee=async te=>{k.value=!0;try{const O=await Do(te);C.value=O.jars||[],z.value=O.detectedRoot||"",O.count===1&&O.jars.length>0?(M.value.core=O.jars[0],B.success(`自动识别到服务端核心: ${O.jars[0]}`)):O.count>1?B.info(`整合包内检测到 ${O.count} 个服务端核心，请在下一步选择`):B.warning("未检测到整合包内存在服务端核心，请在下一步手动配置核心")}catch(O){B.error("整合包分析失败: "+O.message)}finally{k.value=!1}},oe=async()=>{M.value.packageFileKey&&(await It(M.value.packageFileKey),M.value.packageFileKey="",E.value="",C.value=[],M.value.core="",B.success("文件已移除"))},T=te=>{M.value.core=te.filename,M.value.coreUrl=te.url,M.value.coreSha256=te.sha256,M.value.coreFileKey="",B.success(`已选择: ${te.core} (${te.version})`)},j=async()=>{if(await n.value.validate()!==!0){B.warning("请检查表单所有内容");return}d.value=!0,g.value=[];const O={...M.value,path:M.value.path||null,coreUrl:M.value.coreUrl||null,coreSha256:M.value.coreSha256||null,coreFileKey:M.value.coreFileKey||null,args:M.value.args||null};C.value.length>0?(O.coreUrl=null,O.coreSha256=null,O.coreFileKey=null):P.value==="manual"?(O.coreUrl=null,O.coreSha256=null):O.coreFileKey=null;try{const ge=(await Wa(O)).serverId;if(!ge)throw new Error("服务器未返回 ServerId");L.value=ge.toString(),f.value=!0,i.value=6,await le(L.value)}catch(ie){B.error(ie.message||"创建请求失败"),d.value=!1}},le=async te=>{const{baseUrl:O,token:ie}=l,ge=new URL("/api/hubs/creationProgressHub",O||window.location.origin);ge.searchParams.append("x-user-token",ie),y.value=new Lt().withUrl(ge.toString(),{withCredentials:!1}).configureLogging(Ft.Information).build(),y.value.on("StatusUpdate",(ke,we,xe)=>{ke.toString()===te&&(g.value.push({time:new Date().toLocaleTimeString(),message:we,progress:xe}),kt(()=>{A.value&&(A.value.scrollTop=A.value.scrollHeight)}),xe!==null&&xe>=0&&(m.value=xe),xe===100?(B.success("服务器创建成功！"),y.value?.stop(),f.value=!1,r.value=!0,i.value=7,d.value=!1,u.refreshInstanceList()):xe===-1&&(B.error(we||"错误"),y.value?.stop(),f.value=!1,d.value=!1,i.value=0))});try{await y.value.start(),await y.value.invoke("TrackServer",te)}catch(ke){console.error("SignalR Error",ke)}};Qe(()=>{y.value?.stop()});const Z=()=>{r.value=!1,i.value=0,M.value={name:"新建整合包服务器",path:"",java:"",core:"",coreUrl:"",coreSha256:"",coreFileKey:"",packageFileKey:"",minM:2048,maxM:6144,args:""},C.value=[],E.value="",P.value="online",R.value="online"};return(te,O)=>{const ie=v("t-step-item"),ge=v("t-steps"),ke=v("t-input"),we=v("t-form-item"),xe=v("t-alert"),Pe=v("t-icon"),Ue=v("t-button"),Ve=v("t-progress"),Ge=v("t-loading"),Ye=v("t-radio"),Oe=v("t-radio-group"),ee=v("t-radio-button"),Ae=v("t-tag"),Ke=v("t-space"),qe=v("t-select"),je=v("t-input-number"),De=v("t-col"),tt=v("t-row"),ye=v("t-textarea"),gt=v("t-divider"),_t=v("t-form"),ot=v("t-list-item-meta"),At=v("t-list-item"),$a=v("t-list");return o(),S("div",null,[t("div",Sc,[t("div",Ic,[e(ge,{layout:"vertical",style:{"margin-top":"16px"},current:i.value,status:"process",readonly:""},{default:a(()=>[e(ie,{title:"基本信息",content:"填写实例名称"}),e(ie,{title:"上传整合包",content:"上传服务端 Zip 包"}),e(ie,{title:"核心配置",content:"确认启动的服务端核心"}),e(ie,{title:"Java 环境",content:"配置 Java 运行时"}),e(ie,{title:"资源配置",content:"设置内存参数"}),e(ie,{title:"确认信息",content:"核对并提交"}),e(ie,{title:"创建实例",content:"提交并等待解压"}),e(ie,{title:"完成",content:"查看结果"})]),_:1},8,["current"])]),t("div",Vc,[!f.value&&!r.value?(o(),S("div",Mc,[e(_t,{ref_key:"formRef",ref:n,data:M.value,rules:Le.value,"label-align":"top",class:"step-form",onSubmit:j},{default:a(()=>[Je(t("div",Uc,[e(we,{label:"实例名称",name:"name"},{default:a(()=>[e(ke,{modelValue:M.value.name,"onUpdate:modelValue":O[0]||(O[0]=Ce=>M.value.name=Ce),placeholder:"为你的服务器起个名字"},null,8,["modelValue"])]),_:1}),e(we,{label:"实例路径",name:"path",help:b(l).userInfo.systemInfo.docker?"您正在使用Docker容器部署，为保数据安全，仅支持使用默认数据路径":"选填，留空将使用默认路径"},{default:a(()=>[e(ke,{modelValue:M.value.path,"onUpdate:modelValue":O[1]||(O[1]=Ce=>M.value.path=Ce),disabled:b(l).userInfo.systemInfo.docker,placeholder:"例如: D:\\MyServer"},null,8,["modelValue","disabled"])]),_:1},8,["help"])],512),[[at,i.value===0]]),Je(t("div",Lc,[e(xe,{theme:"info",class:"mb-4"},{message:a(()=>[...O[18]||(O[18]=[c(" 请上传包含服务端文件的 ",-1),t("b",null,".zip",-1),c(" 压缩包。上传完成后系统将自动分析包内的服务端核心文件。 ",-1)])]),_:1}),e(we,{label:"上传服务端整合包 (Zip)",name:"packageFileKey"},{default:a(()=>[t("div",Bc,[t("input",{ref_key:"uploadInputRef",ref:p,accept:".zip",type:"file",style:{display:"none"},onChange:ze},null,544),!V.value&&!M.value.packageFileKey?(o(),D(Ue,{key:0,variant:"outline",onClick:Se},{icon:a(()=>[e(Pe,{name:"upload"})]),default:a(()=>[O[19]||(O[19]=c(" 点击选择 Zip 文件并上传 ",-1))]),_:1})):N("",!0),V.value?(o(),S("div",zc,[t("div",Pc,"正在上传: "+I(E.value)+" ("+I(F.value)+")",1),e(Ve,{theme:"line",percentage:h.value},null,8,["percentage"]),O[20]||(O[20]=t("div",{class:"tip"},"别着急，喝杯咖啡☕️...",-1))])):N("",!0),!V.value&&k.value?(o(),S("div",Rc,[e(Ge,{text:"正在分析压缩包结构...",size:"small"})])):N("",!0),M.value.packageFileKey&&!V.value&&!k.value?(o(),S("div",Ec,[t("div",Tc,[e(Pe,{name:"folder-zip"})]),t("div",Fc,[t("div",Dc,I(E.value),1),t("div",Oc,I(C.value.length>0?`发现 ${C.value.length} 个服务端核心文件`:"未发现服务端核心文件")+" "+I(z.value?`| 根目录: /${z.value}`:""),1)]),e(Ue,{shape:"circle",variant:"text",theme:"primary",onClick:Se},{icon:a(()=>[e(Pe,{name:"swap"})]),_:1}),e(Ue,{shape:"circle",variant:"text",theme:"danger",onClick:oe},{icon:a(()=>[e(Pe,{name:"delete"})]),_:1})])):N("",!0)])]),_:1})],512),[[at,i.value===1]]),Je(t("div",jc,[C.value.length>0?(o(),S("div",Nc,[e(xe,{theme:"success",class:"mb-4"},{message:a(()=>[...O[21]||(O[21]=[c("我们在压缩包中发现了以下服务端核心文件，请选择哪一个作为",-1),t("b",null,"启动核心",-1),c("。",-1)])]),_:1}),e(we,{label:"选择启动核心",name:"core"},{default:a(()=>[e(Oe,{modelValue:M.value.core,"onUpdate:modelValue":O[2]||(O[2]=Ce=>M.value.core=Ce),class:"vertical-radio-group"},{default:a(()=>[(o(!0),S(ce,null,fe(C.value,Ce=>(o(),S("div",{key:Ce,class:"jar-option-item"},[e(Ye,{value:Ce},{default:a(()=>[c(I(Ce),1)]),_:2},1032,["value"])]))),128))]),_:1},8,["modelValue"])]),_:1})])):(o(),S("div",Kc,[e(xe,{theme:"warning",class:"mb-4"},{message:a(()=>[...O[22]||(O[22]=[c("在上传的包中未发现服务端核心文件。请在此处下载一个服务端核心。",-1)])]),_:1}),e(we,{label:"补充服务端核心"},{default:a(()=>[e(Oe,{modelValue:P.value,"onUpdate:modelValue":O[3]||(O[3]=Ce=>P.value=Ce),variant:"default-filled"},{default:a(()=>[e(ee,{value:"online"},{default:a(()=>[...O[23]||(O[23]=[c("在线下载核心",-1)])]),_:1}),e(ee,{disabled:"",value:"manual"},{default:a(()=>[...O[24]||(O[24]=[c("自行上传(不支持)",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),P.value==="online"?(o(),S("div",qc,[e(we,{label:"选择服务端核心",name:"coreUrl"},{default:a(()=>[t("div",Gc,[e(Ue,{variant:"outline",onClick:O[4]||(O[4]=Ce=>w.value=!0)},{icon:a(()=>[e(Pe,{name:"cloud-download"})]),default:a(()=>[O[25]||(O[25]=c(" 打开核心库 ",-1))]),_:1}),M.value.core&&P.value==="online"?(o(),S("div",Hc,[t("div",Jc,[e(Pe,{name:"check-circle-filled"})]),t("div",Wc,[t("div",Xc,I(M.value.core),1),O[26]||(O[26]=t("div",{class:"core-url"},"将在创建时自动下载",-1))])])):N("",!0)])]),_:1})])):N("",!0),P.value==="manual"?(o(),S("div",Qc,[O[27]||(O[27]=t("div",{class:"tip-text"},"请在整合包解压后手动放入核心，或在此处不填写等待创建后手动上传。",-1)),e(xe,{theme:"error",message:"此模式下建议确保压缩包内包含核心，或者使用在线下载功能。"})])):N("",!0)]))],512),[[at,i.value===2]]),Je(t("div",Yc,[e(xe,{theme:"info",title:"Java 版本选择指南"},{message:a(()=>[t("div",Zc,[e(Ke,{align:"center",size:12},{default:a(()=>[e(Ae,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...O[28]||(O[28]=[c("MC 26.1 - 最新版本",-1)])]),_:1}),e(Ae,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...O[29]||(O[29]=[c("Java 25",-1)])]),_:1})]),_:1}),e(Ke,{align:"center",size:12},{default:a(()=>[e(Ae,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...O[30]||(O[30]=[c("MC 1.20.5 - 1.21.11",-1)])]),_:1}),e(Ae,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...O[31]||(O[31]=[c("Java 21",-1)])]),_:1})]),_:1}),e(Ke,{align:"center",size:12},{default:a(()=>[e(Ae,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...O[32]||(O[32]=[c("MC 1.18 - 1.20.4",-1)])]),_:1}),e(Ae,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...O[33]||(O[33]=[c("Java 17",-1)])]),_:1})]),_:1}),e(Ke,{align:"center",size:12},{default:a(()=>[e(Ae,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...O[34]||(O[34]=[c("MC 1.17 / 1.17.1",-1)])]),_:1}),e(Ae,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...O[35]||(O[35]=[c("Java 16",-1)])]),_:1})]),_:1}),e(Ke,{align:"center",size:12},{default:a(()=>[e(Ae,{theme:"default",variant:"outline",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...O[36]||(O[36]=[c("MC 1.13 - 更低版本",-1)])]),_:1}),e(Ae,{theme:"default",variant:"light",shape:"round"},{default:a(()=>[...O[37]||(O[37]=[c("Java 8",-1)])]),_:1})]),_:1}),t("div",em,[e(Pe,{name:"info-circle",size:"small",style:{"margin-right":"4px"}}),O[38]||(O[38]=c(" 建议直接使用推荐版本，避免兼容性问题。 ",-1))])])]),_:1}),e(we,{label:"Java 来源",name:"java"},{default:a(()=>[t("div",tm,[e(Oe,{modelValue:R.value,"onUpdate:modelValue":O[5]||(O[5]=Ce=>R.value=Ce),variant:"default-filled"},{default:a(()=>[e(ee,{value:"online"},{default:a(()=>[...O[39]||(O[39]=[c("在线下载",-1)])]),_:1}),e(ee,{value:"local"},{default:a(()=>[...O[40]||(O[40]=[c("本机 Java",-1)])]),_:1}),e(ee,{value:"env"},{default:a(()=>[...O[41]||(O[41]=[c("环境变量",-1)])]),_:1}),e(ee,{value:"custom"},{default:a(()=>[...O[42]||(O[42]=[c("自定义路径",-1)])]),_:1})]),_:1},8,["modelValue"]),t("div",am,[R.value==="online"?(o(),S("div",sm,[e(qe,{modelValue:U.value,"onUpdate:modelValue":O[6]||(O[6]=Ce=>U.value=Ce),options:H.value,placeholder:"请选择 Java 版本"},null,8,["modelValue","options"])])):N("",!0),R.value==="local"?(o(),S("div",lm,[e(qe,{modelValue:_.value,"onUpdate:modelValue":O[7]||(O[7]=Ce=>_.value=Ce),options:q.value,placeholder:"请选择 Java"},null,8,["modelValue","options"]),e(Ue,{variant:"text",onClick:O[8]||(O[8]=Ce=>x(!0))},{default:a(()=>[...O[43]||(O[43]=[c("刷新",-1)])]),_:1})])):N("",!0),R.value==="env"?(o(),S("div",nm,[e(ke,{"model-value":"java",readonly:"",disabled:""})])):N("",!0),R.value==="custom"?(o(),S("div",om,[e(ke,{modelValue:_.value,"onUpdate:modelValue":O[9]||(O[9]=Ce=>_.value=Ce),placeholder:"C:\\Path\\To\\java.exe"},null,8,["modelValue"])])):N("",!0)])])]),_:1})],512),[[at,i.value===3]]),Je(t("div",im,[e(tt,{gutter:[16,24]},{default:a(()=>[e(De,{xs:12,span:6},{default:a(()=>[e(we,{label:"最小内存",name:"minM"},{default:a(()=>[e(Ke,{size:8,style:{width:"100%"}},{default:a(()=>[e(je,{modelValue:K.value,"onUpdate:modelValue":O[10]||(O[10]=Ce=>K.value=Ce),min:0,"decimal-places":J.value==="GB"?1:0,placeholder:"Xms",theme:"column",style:{width:"100%"}},null,8,["modelValue","decimal-places"]),e(qe,{modelValue:J.value,"onUpdate:modelValue":O[11]||(O[11]=Ce=>J.value=Ce),options:X,clearable:!1,style:{width:"80px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(De,{xs:12,span:6},{default:a(()=>[e(we,{label:"最大内存",name:"maxM"},{default:a(()=>[e(Ke,{size:8,style:{width:"100%"}},{default:a(()=>[e(je,{modelValue:G.value,"onUpdate:modelValue":O[12]||(O[12]=Ce=>G.value=Ce),min:0,"decimal-places":W.value==="GB"?1:0,placeholder:"Xmx",theme:"column",style:{width:"100%"}},null,8,["modelValue","decimal-places"]),e(qe,{modelValue:W.value,"onUpdate:modelValue":O[13]||(O[13]=Ce=>W.value=Ce),options:X,clearable:!1,style:{width:"80px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(we,{label:"JVM 参数",name:"args",style:{"margin-top":"16px"}},{default:a(()=>[e(ye,{modelValue:M.value.args,"onUpdate:modelValue":O[14]||(O[14]=Ce=>M.value.args=Ce),placeholder:"-XX:+UseG1GC"},null,8,["modelValue"])]),_:1})],512),[[at,i.value===4]]),Je(t("div",rm,[t("div",um,[t("div",dm,[t("div",cm,[e(Pe,{name:"server",size:"32px"})]),t("div",mm,[t("div",pm,I(M.value.name),1),t("div",vm,[e(Pe,{name:"folder-open",size:"small"}),c(" "+I(M.value.path||"默认数据路径 (/DaemonData/Servers)"),1)])])]),e(gt,{dashed:"",style:{margin:"16px 0"}}),e(tt,{gutter:[24,24]},{default:a(()=>[e(De,{span:6},{default:a(()=>[t("div",fm,[O[45]||(O[45]=t("div",{class:"label"},"服务端整合包",-1)),t("div",gm,[t("span",{class:"main-text text-truncate",title:E.value},I(E.value),9,_m),e(Ae,{theme:"primary",variant:"light",size:"small"},{default:a(()=>[...O[44]||(O[44]=[c("ZIP",-1)])]),_:1})]),t("div",hm,"大小: "+I(F.value||"未知"),1)])]),_:1}),e(De,{span:6},{default:a(()=>[t("div",ym,[O[49]||(O[49]=t("div",{class:"label"},"启动核心 (Jar)",-1)),t("div",bm,[t("span",{class:"main-text text-truncate",title:M.value.core},I(M.value.core),9,wm),C.value.length>0?(o(),D(Ae,{key:0,theme:"success",variant:"light",size:"small"},{default:a(()=>[...O[46]||(O[46]=[c(" 整合包内核心 ",-1)])]),_:1})):P.value==="online"?(o(),D(Ae,{key:1,theme:"primary",variant:"light",size:"small"},{default:a(()=>[...O[47]||(O[47]=[c(" 在线下载 ",-1)])]),_:1})):(o(),D(Ae,{key:2,theme:"warning",variant:"light",size:"small"},{default:a(()=>[...O[48]||(O[48]=[c("手动配置",-1)])]),_:1}))]),C.value.length>0?(o(),S("div",km,"已从压缩包中选定启动文件")):P.value==="online"?(o(),S("div",$m," 来源: MSL 镜像源 ("+I(M.value.coreUrl?"已匹配":"未匹配")+") ",1)):N("",!0)])]),_:1}),e(De,{span:6},{default:a(()=>[t("div",xm,[O[53]||(O[53]=t("div",{class:"label"},"Java 运行时",-1)),t("div",Am,[R.value==="online"?(o(),S("span",Cm," Java "+I(U.value),1)):(o(),S("span",{key:1,class:"main-text text-truncate",title:M.value.java},I(M.value.java),9,Sm)),R.value==="online"?(o(),D(Ae,{key:2,theme:"success",variant:"light",size:"small"},{default:a(()=>[...O[50]||(O[50]=[c(" 自动安装 ",-1)])]),_:1})):R.value==="local"?(o(),D(Ae,{key:3,theme:"primary",variant:"light",size:"small"},{default:a(()=>[...O[51]||(O[51]=[c(" 本机环境 ",-1)])]),_:1})):(o(),D(Ae,{key:4,theme:"default",variant:"light",size:"small"},{default:a(()=>[...O[52]||(O[52]=[c("自定义",-1)])]),_:1}))]),R.value==="online"?(o(),S("div",Im," 将自动从镜像源下载并解压 JDK ")):N("",!0)])]),_:1}),e(De,{span:6},{default:a(()=>[t("div",Vm,[O[56]||(O[56]=t("div",{class:"label"},"内存分配 (JVM)",-1)),t("div",Mm,[t("div",Um,[O[54]||(O[54]=t("span",{class:"mem-label"},"初始 (Xms)",-1)),t("span",Lm,I(K.value)+" "+I(J.value),1)]),t("div",Bm,[e(Pe,{name:"arrow-right"})]),t("div",zm,[O[55]||(O[55]=t("span",{class:"mem-label"},"最大 (Xmx)",-1)),t("span",Pm,I(G.value)+" "+I(W.value),1)])])])]),_:1}),M.value.args?(o(),D(De,{key:0,span:12},{default:a(()=>[t("div",Rm,[O[57]||(O[57]=t("div",{class:"label"},"启动参数",-1)),t("div",Em,I(M.value.args),1)])]),_:1})):N("",!0)]),_:1}),e(xe,{style:{"margin-top":"24px"},theme:"info"},{message:a(()=>[...O[58]||(O[58]=[c(" 确认无误后点击下方 ",-1),t("b",null,"提交创建",-1),c("，系统自动部署服务端。 ",-1)])]),_:1})])],512),[[at,i.value===5]]),e(we,{class:"step-actions",style:{"margin-top":"16px"}},{default:a(()=>[i.value>0?(o(),D(Ue,{key:0,theme:"default",onClick:Re},{default:a(()=>[...O[59]||(O[59]=[c("上一步",-1)])]),_:1})):N("",!0),i.value<5?(o(),D(Ue,{key:1,type:"button",loading:V.value||k.value,onClick:he},{default:a(()=>[...O[60]||(O[60]=[c("下一步",-1)])]),_:1},8,["loading"])):N("",!0),i.value===5?(o(),D(Ue,{key:2,theme:"primary",type:"submit",loading:d.value},{default:a(()=>[...O[61]||(O[61]=[c("提交创建",-1)])]),_:1},8,["loading"])):N("",!0)]),_:1})]),_:1},8,["data","rules"])])):N("",!0),f.value?(o(),S("div",Tm,[t("div",Fm,"正在创建整合包实例 ("+I(L.value)+")",1),O[62]||(O[62]=t("p",null,"正在解压文件并配置环境...",-1)),e(Ve,{theme:"plump",percentage:m.value,label:`${m.value.toFixed(2)}%`},null,8,["percentage","label"]),t("div",{ref_key:"logContainerRef",ref:A,class:"log-container"},[e($a,{split:!0},{default:a(()=>[(o(!0),S(ce,null,fe(g.value,(Ce,ae)=>(o(),D(At,{key:ae},{default:a(()=>[e(ot,{description:`[${Ce.time}] ${Ce.message}`},null,8,["description"])]),_:2},1024))),128))]),_:1})],512)])):N("",!0),r.value?(o(),S("div",Dm,[e(Pe,{class:"result-success-icon",name:"check-circle"}),O[65]||(O[65]=t("div",{class:"result-success-title"},"整合包服务器已部署成功",-1)),O[66]||(O[66]=t("div",{class:"result-success-describe"},"文件已解压，环境已配置就绪",-1)),t("div",null,[e(Ue,{onClick:O[15]||(O[15]=()=>{Z(),b(Me)("/instance/list")})},{default:a(()=>[...O[63]||(O[63]=[c(" 返回服务端列表 ",-1)])]),_:1}),e(Ue,{theme:"default",onClick:O[16]||(O[16]=()=>{Z(),b(Me)(`/instance/console/${L.value}`)})},{default:a(()=>[...O[64]||(O[64]=[c(" 前往控制台 ",-1)])]),_:1})])])):N("",!0)])]),e(Xa,{visible:w.value,"onUpdate:visible":O[17]||(O[17]=Ce=>w.value=Ce),onConfirm:T},null,8,["visible"])])}}}),jm=ue(Om,[["__scopeId","data-v-dc20309d"]]),Nm=ne({__name:"index",setup(s){const l=$(1);return(n,u)=>{const i=v("t-tab-panel"),d=v("t-tabs"),f=v("t-card");return o(),S("div",null,[e(f,{direction:"vertical"},{default:a(()=>[e(d,{modelValue:l.value,"onUpdate:modelValue":u[0]||(u[0]=r=>l.value=r)},{default:a(()=>[e(i,{value:1,label:"快速模式","destroy-on-hide":!1},{default:a(()=>[e(wc,{style:{margin:"10px"}})]),_:1}),e(i,{value:2,label:"上传整合包模式","destroy-on-hide":!1},{default:a(()=>[e(jm,{style:{margin:"10px"}})]),_:1}),e(i,{value:3,label:"自定义模式","destroy-on-hide":!1},{default:a(()=>[e(Cc,{style:{margin:"10px"}})]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}}),Km=Object.freeze(Object.defineProperty({__proto__:null,default:Nm},Symbol.toStringTag,{value:"Module"})),qm={class:"backup-page-container"},Gm={class:"page-header"},Hm={key:0,class:"loading-wrapper"},Jm={key:1,class:"card-list"},Wm={class:"card-header"},Xm={class:"header-left"},Qm={class:"instance-info"},Ym={class:"instance-name"},Zm={class:"instance-core"},ep={class:"header-right"},tp={class:"path-section"},ap=["onClick"],sp={key:0,class:"backup-table-area"},lp={key:0,class:"table-toolbar"},np={class:"selected-count"},op={class:"file-name-cell"},ip=["title"],rp={class:"op-buttons"},up={key:1,class:"empty-backups"},dp=ne({__name:"index",setup(s){const l=$(!1),n=$([]),u=$(new Set),i=$({}),d=[{colKey:"row-select",type:"multiple",width:30,fixed:"left"},{colKey:"fileName",title:"文件名",ellipsis:!0},{colKey:"fileSizeStr",title:"大小",width:100},{colKey:"createTime",title:"创建时间",width:180},{colKey:"op",title:"操作",width:140,fixed:"right"}],f=se(()=>[...n.value].sort((C,k)=>{const z=C.backups&&C.backups.length>0,p=k.backups&&k.backups.length>0;return z&&!p?-1:!z&&p?1:C.id-k.id})),r=async()=>{l.value=!0;try{const w=await ur();n.value=w||[]}catch(w){B.error("获取备份列表失败"),console.error(w)}finally{l.value=!1}},m=w=>{u.value.has(w)?u.value.delete(w):u.value.add(w)},g=(w,C)=>{const k=Ta(w,C);window.open(k,"_blank")},y=async(w,C)=>{const k=st.confirm({header:"确认删除",body:`确定要删除选中的 ${C.length} 个备份文件吗？此操作不可恢复。`,theme:"danger",onConfirm:async()=>{k.hide();const z=B.loading("正在删除中...");try{const p=C.map(V=>Ea(w,V));await Promise.all(p),B.success("删除成功"),i.value[w]&&(i.value[w]=[]),await r()}catch(p){B.error("部分文件删除失败，请重试 "+p.message)}finally{B.close(z)}}})},L=(w,C)=>{y(w,[C])},A=w=>{const C=i.value[w];if(!C||C.length===0){B.warning("请先选择要删除的文件");return}y(w,C)},P=(w,{_row:C},k)=>{i.value={...i.value,[k]:w}};return Ie(()=>{r()}),(w,C)=>{const k=v("t-button"),z=v("t-loading"),p=v("t-tag"),V=v("t-table"),h=v("t-card");return o(),S("div",qm,[t("div",Gm,[C[1]||(C[1]=t("div",{class:"title-area"},[t("h2",{class:"page-title"},"实例备份管理"),t("p",{class:"page-desc"},"管理所有服务器实例的本地备份文件")],-1)),e(k,{theme:"primary",variant:"text",loading:l.value,onClick:r},{icon:a(()=>[e(b(Ze))]),default:a(()=>[C[0]||(C[0]=c(" 刷新列表 ",-1))]),_:1},8,["loading"])]),l.value&&n.value.length===0?(o(),S("div",Hm,[e(z,{text:"加载数据中...",size:"small"})])):(o(),S("div",Jm,[e(bl,{name:"list-anim"},{default:a(()=>[(o(!0),S(ce,null,fe(f.value,E=>(o(),S("div",{key:E.id,class:"instance-card-wrapper"},[e(h,{bordered:!1,class:$e(["instance-card",{"is-empty":!E.backups?.length}])},{default:a(()=>[t("div",Wm,[t("div",Xm,[e(p,{theme:"primary",variant:"light",shape:"mark"},{default:a(()=>[c("ID: "+I(E.id),1)]),_:2},1024),t("div",Qm,[t("h3",Ym,[e(b($t),{class:"icon-mr"}),c(" "+I(E.name),1)]),t("span",Zm,[e(b(Ut),{class:"icon-mr"}),c(" "+I(E.core),1)])])]),t("div",ep,[E.backups?.length?(o(),D(p,{key:0,theme:"success",variant:"outline"},{default:a(()=>[c(I(E.backups.length)+" 个备份 ",1)]),_:2},1024)):(o(),D(p,{key:1,theme:"default",disabled:""},{default:a(()=>[...C[2]||(C[2]=[c("无备份",-1)])]),_:1}))])]),t("div",tp,[t("div",{class:"path-toggle",onClick:F=>m(E.id)},[e(b(wl)),C[3]||(C[3]=t("span",{class:"label"},"存储路径",-1)),(o(),D(it(u.value.has(E.id)?b(kl):b($l)),{class:"toggle-icon"}))],8,ap),Je(t("div",{class:"path-content"},I(E.backupPath),513),[[at,u.value.has(E.id)]])]),E.backups?.length?(o(),S("div",sp,[i.value[E.id]?.length>0?(o(),S("div",lp,[t("span",np,"已选 "+I(i.value[E.id].length)+" 项",1),e(k,{theme:"danger",variant:"text",size:"small",onClick:F=>A(E.id)},{default:a(()=>[...C[4]||(C[4]=[c(" 批量删除 ",-1)])]),_:1},8,["onClick"])])):N("",!0),e(V,{"row-key":"fileName",data:E.backups,columns:d,"selected-row-keys":i.value[E.id]||[],size:"small",hover:!0,pagination:E.backups.length>5?{pageSize:5}:null,onSelectChange:(F,R)=>P(F,R,E.id)},{fileName:a(({row:F})=>[t("div",op,[C[5]||(C[5]=t("span",{class:"zip-icon"},"ZIP",-1)),t("span",{class:"text",title:F.fileName},I(F.fileName),9,ip)])]),op:a(({row:F})=>[t("div",rp,[e(k,{theme:"primary",variant:"text",size:"small",onClick:R=>g(E.id,F.fileName)},{icon:a(()=>[e(b(va))]),default:a(()=>[C[6]||(C[6]=c(" 下载 ",-1))]),_:1},8,["onClick"]),e(k,{theme:"danger",variant:"text",size:"small",onClick:R=>L(E.id,F.fileName)},{icon:a(()=>[e(b(mt))]),default:a(()=>[C[7]||(C[7]=c(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:2},1032,["data","columns","selected-row-keys","pagination","onSelectChange"])])):(o(),S("div",up,[...C[8]||(C[8]=[t("span",{class:"empty-text"},"当前实例暂无备份文件",-1)])]))]),_:2},1032,["class"])]))),128))]),_:1})]))])}}}),cp=ue(dp,[["__scopeId","data-v-02bc58e2"]]),mp=Object.freeze(Object.defineProperty({__proto__:null,default:cp},Symbol.toStringTag,{value:"Module"})),pp={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function vp(s,l){return o(),S("svg",pp,[...l[0]||(l[0]=[Dt('<g mask="url(#mask0_17_619)"><path fill="#97A3B7" d="M30 62h88v60H30z"></path><g filter="url(#filter0_f_17_619)"><path fill="#E3E6EB" d="M12 84h80v60H12z"></path></g><g filter="url(#filter1_f_17_619)"><path fill="#E3E6EB" d="M80 54h80v60H80z"></path></g><path fill="#fff" d="M46 105h32v2H46zM46 98h32v2H46zM46 88h16v2H46z"></path></g><path fill="currentcolor" d="M63 20h88v10H63z" opacity=".9"></path><mask id="a" width="88" height="50" x="63" y="30" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="currentcolor" d="M63 30h88v50H63z"></path></mask><g mask="url(#a)"><path fill="currentcolor" d="M63 30h88v50H63z"></path><g filter="url(#filter2_f_17_619)" opacity=".3"><path fill="#97A3B7" d="M30 62h88v60H30z"></path></g></g><path fill="#fff" fill-rule="evenodd" d="m95.686 40.858 10.278 10.277A4 4 0 0 1 107 51c2.213 0 4 1.786 4 4q-.002.538-.134 1.033l10.276 10.28-2.828 2.829-4.598-4.597A17.1 17.1 0 0 1 107 65.909c-7.273 0-13.484-4.524-16-10.91a17.3 17.3 0 0 1 5.696-7.472l-3.838-3.84zM99 55a8.003 8.003 0 0 0 12.063 6.892l-3.029-3.026q-.496.132-1.034.134c-2.213 0-4-1.787-4-4q.002-.538.134-1.034l-3.027-3.027A7.96 7.96 0 0 0 99 54.999m8-10.91c7.273 0 13.484 4.524 16 10.91a17.3 17.3 0 0 1-4.166 6.177l-4.105-4.105a8.003 8.003 0 0 0-9.801-9.8l-2.55-2.551c1.47-.41 3.02-.63 4.622-.63" clip-rule="evenodd"></path><path fill="#fff" d="M68 24h2v2h-2zM74 24h2v2h-2zM80 24h66v2H80z"></path><path fill="#fff" stroke="#000" d="m157 54 24.249 42h-48.498z"></path><path stroke="#000" d="M157 89V71"></path>',8)])])}const fs={render:vp},fp={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function gp(s,l){return o(),S("svg",fp,[...l[0]||(l[0]=[Dt('<g mask="url(#mask0_16559_24301)"><path fill="#97A3B7" d="M30 62h88v60H30z"></path><g filter="url(#filter0_f_16559_24301)"><path fill="#E3E6EB" d="M12 84h80v60H12z"></path></g><g filter="url(#filter1_f_16559_24301)"><path fill="#E3E6EB" d="M80 54h80v60H80z"></path></g><path stroke="#fff" stroke-width="2" d="m49 93-7 7 7 7M69 107l7-7-7-7M62.365 87.443l-6.73 25.114"></path></g><path fill="currentcolor" d="M63 20h88v10H63z" opacity=".9"></path><mask id="a" width="88" height="50" x="63" y="30" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="currentcolor" d="M63 30h88v50H63z"></path></mask><g mask="url(#a)"><path fill="currentcolor" d="M63 30h88v50H63z"></path><g filter="url(#filter2_f_16559_24301)" opacity=".3"><path fill="#97A3B7" d="M30 62h88v60H30z"></path></g></g><path fill="#fff" fill-rule="evenodd" d="M105.25 41c6.765 0 12.25 5.484 12.25 12.25 0 2.433-.709 4.7-1.932 6.606L121 65.288 117.288 69l-5.432-5.432a12.2 12.2 0 0 1-6.606 1.932C98.484 65.5 93 60.016 93 53.25S98.484 41 105.25 41m0 3.5a8.75 8.75 0 1 0 0 17.5 8.75 8.75 0 0 0 0-17.5" clip-rule="evenodd"></path><path fill="#fff" d="M68 24h2v2h-2zM74 24h2v2h-2zM80 24h66v2H80z"></path><path fill="#fff" fill-rule="evenodd" d="M153 56c-12.15 0-22 9.85-22 22 0 4.604 1.414 8.878 3.832 12.41L127 98.5l12.495-3.132A21.9 21.9 0 0 0 153 100c12.15 0 22-9.85 22-22s-9.85-22-22-22" clip-rule="evenodd"></path><path fill="#000" d="M131 78h.5zm3.832 12.41.359.348.284-.293-.23-.337zM127 98.5l-.359-.348-1.219 1.259 1.7-.426zm12.495-3.132.307-.394-.192-.15-.237.06zM153 100v.5zm22-22h-.5zm-43.5 0c0-11.874 9.626-21.5 21.5-21.5v-1c-12.426 0-22.5 10.074-22.5 22.5zm3.745 12.128A21.4 21.4 0 0 1 131.5 78h-1c0 4.708 1.446 9.08 3.919 12.693zm-.772-.066-7.832 8.09.718.696 7.832-8.09zm-7.351 8.923 12.494-3.132-.243-.97-12.495 3.132zM153 99.5c-4.976 0-9.555-1.69-13.198-4.526l-.615.789A22.4 22.4 0 0 0 153 100.5zM174.5 78c0 11.874-9.626 21.5-21.5 21.5v1c12.426 0 22.5-10.074 22.5-22.5zM153 56.5c11.874 0 21.5 9.626 21.5 21.5h1c0-12.426-10.074-22.5-22.5-22.5z"></path>',8)])])}const _p={render:gp},hp={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function yp(s,l){return o(),S("svg",hp,[...l[0]||(l[0]=[Dt('<g mask="url(#mask0_16559_24251)"><path fill="#97A3B7" d="m68 48 38.105 22v44L68 136l-38.105-22V70z"></path><g filter="url(#a)"><path fill="#E3E6EB" d="M46.391 92h80v60h-80z"></path></g><g filter="url(#b)"><path fill="#E3E6EB" d="M0 23h80v60H0z"></path></g></g><mask id="c" width="78" height="88" x="80" y="9" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="currentcolor" d="m119 9 38.105 22v44L119 97 80.895 75V31z"></path></mask><g mask="url(#c)"><path fill="currentcolor" fill-rule="evenodd" d="M80.895 31v44L119 97l38.105-22V31L119 53z" clip-rule="evenodd"></path><path fill="currentcolor" d="m119-35 38.105 22v44.5L119 53.5l-38.105-22V-13z" opacity=".9"></path><g filter="url(#d)" opacity=".3"><path fill="#97A3B7" d="m68 48 38.105 22v44L68 136l-38.105-22V70z"></path></g></g><path fill="#fff" stroke="#000" d="m143 68.822 4.867 17.053.133.466.469-.118 17.202-4.312-12.335 12.741-.337.348.337.348 12.335 12.741-17.202-4.312-.469-.118-.133.466L143 121.178l-4.867-17.053-.133-.466-.469.118-17.202 4.312 12.335-12.741.337-.348-.337-.348-12.335-12.741 17.202 4.312.469.118.133-.466z"></path><path fill="#fff" fill-rule="evenodd" d="m123.243 35.082 2.828-1.633-2.828-1.633-2.829 1.633zM119 32.632 121.828 31l-7.071-4.082-2.828 1.633zm8.485 3.267c-4.679 2.701-12.291 2.701-16.97 0-4.68-2.702-4.68-7.096 0-9.798s12.291-2.701 16.97 0c4.68 2.702 4.68 7.096 0 9.798m-19.799-11.43c-6.248 3.607-6.248 9.455 0 13.062s16.38 3.607 22.628 0 6.248-9.455 0-13.062-16.38-3.607-22.628 0M41.899 86.286l2.828 1.633v6.532L41.9 92.818zm12.02 6.94 2.829 1.634v6.532l-2.828-1.633zm-9.19 14.289-2.83-1.633.001 3.266 2.828 1.633zl9.192 5.307v3.266l2.828 1.633v-3.266l-2.828-1.633v-3.266l-9.192-5.307z" clip-rule="evenodd"></path><defs><filter id="a" width="180" height="160" x="-3.609" y="42" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_16559_24251" stdDeviation="25"></feGaussianBlur></filter><filter id="b" width="180" height="160" x="-50" y="-27" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_16559_24251" stdDeviation="25"></feGaussianBlur></filter><filter id="d" width="88.21" height="100" x="23.895" y="42" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_16559_24251" stdDeviation="3"></feGaussianBlur></filter></defs>',6)])])}const bp={render:yp},wp={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function kp(s,l){return o(),S("svg",wp,[...l[0]||(l[0]=[Dt('<g mask="url(#mask0_22_990)"><path fill="#97A3B7" fill-rule="evenodd" d="m144.569 105.61-48 27.712-48-27.712V83.712L96.57 56l48 27.713z" clip-rule="evenodd"></path><g filter="url(#filter0_f_22_990)"><path fill="#E3E6EB" d="M-3 33.999h80v60H-3z"></path></g><g filter="url(#filter1_f_22_990)"><path fill="#E3E6EB" d="M97 97.999h80v60H97z"></path></g></g><mask id="a" width="86" height="69" x="53" y="16" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="currentcolor" fill-rule="evenodd" d="m113.357 42.715 16.472-9.51a36 36 0 0 0-3.186-2.043c-5.375-3.104-11.92-5.147-18.885-6.139-4.209-5.562-10.18-8.898-17.324-8.828-6.755.087-15.486 5.746-21.507 14.365q-1.247.622-2.432 1.306c-14.378 8.3-16.94 20.75-7.473 30.065-1.035-5.805-.31-10.865 3.101-16.215-.058.632-.21 4.427-.232 5.067-.67 18.914 15.02 34.058 26.139 33.928 8.45-.1 15.565-5.013 20.319-12.631 6.214-1.231 12.089-3.294 17.094-6.183 13.476-7.78 16.567-19.182 9.104-28.268l-16.599 9.582c1.762 3.654.049 7.823-5.078 10.783-5.126 2.96-12.347 3.948-18.677 2.931-2.843-.469-5.522-1.342-7.74-2.622l-.049-.028zM78.655 53.773c-6.127-3.977-5.683-10.226 1.195-14.197s17.703-4.226 24.591-.69zM93.556 18.17c4.61-.04 8.728 2.405 11.94 6.57-8.447-.918-17.384-.326-25.523 1.765 3.699-5.124 8.471-8.275 13.583-8.335m-2.232 63.447c-5.853.068-10.971-3.926-14.377-10.332 8.845 2.342 18.925 2.775 28.427 1.317-3.756 5.52-8.714 8.951-14.05 9.015" clip-rule="evenodd"></path></mask><g mask="url(#a)"><path fill="currentcolor" fill-rule="evenodd" d="m113.357 42.715 16.472-9.51a36 36 0 0 0-3.186-2.043c-5.375-3.104-11.92-5.147-18.885-6.139-4.209-5.562-10.18-8.898-17.324-8.828-6.755.087-15.486 5.746-21.507 14.365q-1.247.622-2.432 1.306c-14.378 8.3-16.94 20.75-7.473 30.065-1.035-5.805-.31-10.865 3.101-16.215-.058.632-.21 4.427-.232 5.067-.67 18.914 15.02 34.058 26.139 33.928 8.45-.1 15.565-5.013 20.319-12.631 6.214-1.231 12.089-3.294 17.094-6.183 13.476-7.78 16.567-19.182 9.104-28.268l-16.599 9.582c1.762 3.654.049 7.823-5.078 10.783-5.126 2.96-12.347 3.948-18.677 2.931-2.843-.469-5.522-1.342-7.74-2.622l-.049-.028zM78.655 53.773c-6.127-3.977-5.683-10.226 1.195-14.197s17.703-4.226 24.591-.69zM93.556 18.17c4.61-.04 8.728 2.405 11.94 6.57-8.447-.918-17.384-.326-25.523 1.765 3.699-5.124 8.471-8.275 13.583-8.335m-2.232 63.447c-5.853.068-10.971-3.926-14.377-10.332 8.845 2.342 18.925 2.775 28.427 1.317-3.756 5.52-8.714 8.951-14.05 9.015" clip-rule="evenodd"></path><g filter="url(#filter2_f_22_990)" opacity=".3"><path fill="#97A3B7" d="m96.569 56 48 27.712v55.426l-48 27.712-48-27.712V83.712z"></path></g></g><circle cx="155" cy="78" r="22" fill="#fff" stroke="#000" transform="rotate(180 155 78)"></circle><path stroke="#000" d="M155 83V65"></path><path fill="#C4C4C4" stroke="#000" stroke-linejoin="round" stroke-width="2" d="M155 87h.004v.004H155z"></path><path stroke="#fff" stroke-width="2" d="M96.57 112V88M86.57 98l10-10 9.999 10"></path>',7)])])}const $p={render:kp},xp={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function Ap(s,l){return o(),S("svg",xp,[...l[0]||(l[0]=[Dt('<g mask="url(#mask0_21_716)"><path fill="#97A3B7" fill-rule="evenodd" d="M33 46.843 96.321 119l63.322-72.157C142.742 32 120.583 23 96.321 23 72.061 23 49.901 32 33 46.843" clip-rule="evenodd"></path><g filter="url(#filter0_f_21_716)"><path fill="#E3E6EB" d="M95 21h80v60H95z"></path></g><g filter="url(#filter1_f_21_716)"><path fill="#E3E6EB" d="M-7 43h80v60H-7z"></path></g></g><path fill="currentcolor" d="m72.812 63.688-3.157 3.157 6.246 6.247a50.3 50.3 0 0 0-12.713 8.151L96.321 119l11.913-13.575 6.413 6.412 3.157-3.157L80.45 71.326zM129.455 81.243l-15.318 17.455-28.74-28.74a50.4 50.4 0 0 1 10.924-1.19c12.695 0 24.29 4.709 33.134 12.475"></path><path fill="#fff" stroke="#000" d="m152 21.822 4.867 17.053.133.465.469-.117 17.202-4.312-12.335 12.741-.337.348.337.348 12.335 12.741-17.202-4.312-.469-.117-.133.465L152 74.178l-4.867-17.053-.133-.465-.469.117-17.202 4.312 12.335-12.741.337-.348-.337-.348-12.335-12.741 17.202 4.312.469.117.133-.465z"></path><path stroke="#fff" stroke-width="2" d="M101 31 90 42l11 11-8 8"></path>',4)])])}const Cp={render:Ap},Sp={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function Ip(s,l){return o(),S("svg",Sp,[...l[0]||(l[0]=[Dt('<mask id="a" width="78" height="88" x="80" y="9" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="currentColor" d="m119 9 38.105 22v44L119 97 80.895 75V31z"></path></mask><g mask="url(#a)"><path fill="currentColor" d="m119 9 38.105 22v44L119 97 80.895 75V31z"></path><g filter="url(#b)" opacity=".3"><path fill="#97A3B7" d="m68 48 38.105 22v44L68 136l-38.105-22V70z"></path></g></g><mask id="c" width="78" height="88" x="29" y="48" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="#97A3B7" d="m68 48 38.105 22v44L68 136l-38.105-22V70z"></path></mask><g mask="url(#c)"><path fill="#97A3B7" d="m68 48 38.105 22v44L68 136l-38.105-22V70z"></path><g filter="url(#d)"><path fill="#E3E6EB" d="M46.391 92h80v60h-80z"></path></g><g filter="url(#e)"><path fill="#E3E6EB" d="M0 23h80v60H0z"></path></g></g><path fill="#fff" d="m41.898 86.287 2.829 1.633v6.531l-2.828-1.632zM53.919 93.227l2.828 1.633v6.532l-2.828-1.633zM44.728 107.515l-2.829-1.633v3.266l2.829 1.633zl9.191 5.308v3.265l2.829 1.633v-3.266l-2.828-1.632v-3.266l-9.193-5.308z"></path><path fill="#fff" fill-rule="evenodd" d="M108.348 23.48c-2.16 2.51-1.813 5.903 1.047 8.08 3.265 2.486 8.568 2.447 11.845-.087 3.276-2.534 3.286-6.603.021-9.089-2.86-2.177-7.284-2.417-10.54-.74l5.202 3.96-2.373 1.836z" clip-rule="evenodd"></path><path fill="#fff" fill-rule="evenodd" d="m120.865 33.009 8.965 6.826 2.373-1.836-8.965-6.826q-.481.523-1.089.993-.608.468-1.284.843m-1.203-.916a8.5 8.5 0 0 0 1.305-.828 7.248 7.248 0 0 1 0 0 8.5 8.5 0 0 1-1.305.828" clip-rule="evenodd"></path><path fill="#fff" stroke="#181818" d="m144 70 24.249 42h-48.498z"></path><path stroke="#181818" d="M144 100V82"></path><path stroke="#181818" stroke-linejoin="round" stroke-width="2" d="M144 105h.004v.004H144z"></path><defs><filter id="b" width="88.21" height="100" x="23.895" y="42" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_216_313" stdDeviation="3"></feGaussianBlur></filter><filter id="d" width="180" height="160" x="-3.609" y="42" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_216_313" stdDeviation="25"></feGaussianBlur></filter><filter id="e" width="180" height="160" x="-50" y="-27" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_216_313" stdDeviation="25"></feGaussianBlur></filter></defs>',11)])])}const Vp={render:Ip},Mp={class:"result-container"},Up={class:"result-bg-img"},Lp={class:"result-title"},Bp={class:"result-tip"},zp=ne({__name:"index",props:{bgUrl:String,title:String,tip:String,type:String},setup(s){const l=s,n=se(()=>{switch(l.type){case"403":return fs;case"404":return _p;case"500":return bp;case"ie":return $p;case"wifi":return Cp;case"maintenance":return Vp;default:return fs}});return(u,i)=>(o(),S("div",Mp,[t("div",Up,[(o(),D(it(n.value)))]),t("div",Lp,I(s.title),1),t("div",Bp,I(s.tip),1),xl(u.$slots,"default",{},void 0)]))}}),gs=ue(zp,[["__scopeId","data-v-a2dee5ff"]]);async function Pp(s,l,n,u="toml"){return await Q.post({url:"/api/frp/add",data:{name:s,config:l,provider:n,format:u}})}async function Rp(s){return await Q.post({url:"/api/frp/delete",data:{id:s}})}function Ep(){return Q.get({url:"/api/frp/list"})}function _s(s,l){return Q.post({url:"/api/frp/action",data:{action:s,id:l}})}function Tp(s){return Q.get({url:"/api/frp/info",params:{id:s}})}function Fp(){return Q.get({url:"/api/frp/autostart"})}function Dp(s){return Q.post({url:"/api/frp/autostart",data:{frpIds:s}})}const Za=xt("tunnels",()=>{const s=$([]);async function l(){try{s.value=await Ep()}catch(n){B.error("获取Frp列表失败:"+n.message)}}return{frpList:s,getTunnels:l}}),Op={class:"dashboard-wrapper"},jp={class:"content-container"},Np={class:"page-header"},Kp=["onClick"],qp={class:"card-inner"},Gp={class:"header-row"},Hp={class:"icon-box"},Jp={class:"title-section"},Wp={class:"card-title"},Xp={class:"card-subtitle"},Qp={class:"tags-row"},Yp={class:"hover-action"},Zp={class:"auto-start-content"},ev={class:"tunnel-label"},tv={class:"tag"},av={class:"name"},sv={class:"id"},lv={key:0,class:"empty-tip"},nv=ne({__name:"index",setup(s){const l=Za(),n=$(!0),u=$(!1),i=Xe({visible:!1,loading:!1,submitting:!1,selectedIds:[]}),d=async()=>{i.visible=!0,i.loading=!0;try{l.frpList.length===0&&await l.getTunnels();const L=await Fp();i.selectedIds=L||[]}catch(L){B.error("获取自启动配置失败 "+L.message)}finally{i.loading=!1}},f=async()=>{i.submitting=!0;try{await Dp(i.selectedIds),B.success("自启动设置已更新"),i.visible=!1}catch(L){B.error("保存失败: "+L.message)}finally{i.submitting=!1}},r=L=>({toml:"primary",ini:"warning",cmd:"danger",json:"success"})[L]||"default";async function m(){try{n.value=!0,u.value=!1,await l.getTunnels()}catch(L){console.error(L),u.value=!0}finally{n.value=!1}}const g=L=>{Me(`/frp/console/${L.id}`)},y=L=>{const A=st.confirm({header:"确认删除隧道?",body:"删除后该隧道将无法恢复。确定要继续吗？",theme:"danger",onConfirm:async()=>{try{await Rp(L),B.success(`隧道 ${L} 删除成功`),await m(),A.hide()}catch(P){B.error(P.message)}},onClose:()=>{A.hide()}})};return Ie(()=>{m()}),(L,A)=>{const P=v("t-button"),w=v("t-space"),C=v("t-loading"),k=v("t-tag"),z=v("t-col"),p=v("t-row"),V=v("t-alert"),h=v("t-checkbox"),E=v("t-checkbox-group"),F=v("t-dialog");return o(),S("div",Op,[t("div",jp,[t("div",Np,[A[7]||(A[7]=t("h2",{class:"title"},"隧道列表",-1)),e(w,null,{default:a(()=>[e(P,{theme:"primary",variant:"dashed",onClick:m},{default:a(()=>[...A[4]||(A[4]=[c(" 刷新列表 ",-1)])]),_:1}),e(P,{theme:"default",variant:"outline",onClick:d},{default:a(()=>[...A[5]||(A[5]=[c(" 设置自启动 ",-1)])]),_:1}),e(P,{theme:"primary",onClick:A[0]||(A[0]=R=>b(Me)("/frp/create"))},{default:a(()=>[...A[6]||(A[6]=[c(" 创建隧道 ",-1)])]),_:1})]),_:1})]),n.value?(o(),D(C,{key:0,size:"medium",text:"加载中...",class:"loading-box"})):u.value?(o(),D(gs,{key:1,title:"获取数据失败",tip:"无法连接到服务器，请检查网络或稍后重试",type:"500"},{default:a(()=>[e(P,{onClick:m},{default:a(()=>[...A[8]||(A[8]=[c("重试",-1)])]),_:1})]),_:1})):b(l).frpList.length===0?(o(),D(gs,{key:2,title:"暂无隧道",tip:"您还没有创建任何 Frp 隧道，快去创建一个吧",type:"404"},{default:a(()=>[e(P,{onClick:A[1]||(A[1]=R=>b(Me)("/frp/create"))},{default:a(()=>[...A[9]||(A[9]=[c("创建隧道",-1)])]),_:1})]),_:1})):(o(),D(p,{key:3,gutter:[20,20]},{default:a(()=>[(o(!0),S(ce,null,fe(b(l).frpList,R=>(o(),D(z,{key:R.id,span:24,xs:12,sm:6,md:6,lg:4,xl:4},{default:a(()=>[t("div",{class:"design-card",onClick:H=>g(R)},[t("div",{class:"status-bar",style:nt({background:R.status?"var(--td-success-color)":"var(--td-component-stroke)"})},null,4),t("div",qp,[t("div",Gp,[t("div",Hp,[e(b($t))]),e(k,{variant:"light",theme:R.status?"success":"warning"},{default:a(()=>[c(I(R.status?"运行中":"未运行"),1)]),_:2},1032,["theme"])]),t("div",Jp,[t("h3",Wp,I(R.name),1),t("div",Xp,"ID: "+I(R.id),1)]),t("div",Qp,[e(k,{size:"small",variant:"light",shape:"round"},{icon:a(()=>[e(b(Ut))]),default:a(()=>[c(" "+I(R.service),1)]),_:2},1024),e(k,{size:"small",theme:r(R.configType),variant:"outline",shape:"round"},{default:a(()=>[c(I(R.configType),1)]),_:2},1032,["theme"]),e(P,{shape:"circle",theme:"danger",size:"small",onClick:[H=>y(R.id),St(()=>{},["stop"])]},{icon:a(()=>[e(b(mt))]),_:1},8,["onClick"])]),t("div",Yp,[e(b(Al))])])],8,Kp)]),_:2},1024))),128))]),_:1}))]),e(F,{visible:i.visible,"onUpdate:visible":A[3]||(A[3]=R=>i.visible=R),header:"设置开机自启动隧道",width:"600px","confirm-btn":{content:"保存设置",loading:i.submitting},onConfirm:f},{default:a(()=>[e(C,{loading:i.loading,text:"正在读取配置...",size:"small"},{default:a(()=>[t("div",Zp,[e(V,{theme:"info",message:"勾选的隧道将在守护进程启动时自动运行",style:{"margin-bottom":"16px"}}),e(E,{modelValue:i.selectedIds,"onUpdate:modelValue":A[2]||(A[2]=R=>i.selectedIds=R),class:"tunnel-checkbox-group"},{default:a(()=>[e(p,{gutter:[16,16]},{default:a(()=>[(o(!0),S(ce,null,fe(b(l).frpList,R=>(o(),D(z,{key:R.id,span:12},{default:a(()=>[e(h,{value:R.id,class:"tunnel-item"},{default:a(()=>[t("div",ev,[t("span",tv,[e(k,{theme:"primary"},{default:a(()=>[c(I(R.service),1)]),_:2},1024)]),t("span",av,I(R.name),1),t("span",sv,"#"+I(R.id),1)])]),_:2},1032,["value"])]),_:2},1024))),128))]),_:1})]),_:1},8,["modelValue"]),b(l).frpList.length===0?(o(),S("div",lv,"暂无可用隧道")):N("",!0)])]),_:1},8,["loading"])]),_:1},8,["visible","confirm-btn"])])}}}),ov=ue(nv,[["__scopeId","data-v-b798d09c"]]),iv=Object.freeze(Object.defineProperty({__proto__:null,default:ov},Symbol.toStringTag,{value:"Module"})),rv=Za();async function wa(s,l,n,u="toml"){await Pp(s,l,n,u),B.success("添加成功"),await rv.getTunnels(),Me("/frp/list")}const uv={class:"custom-frp-container"},dv=ne({__name:"Custom",setup(s){const l=$(null),n=Xe({name:"",type:"toml",content:""}),u={name:[{required:!0,message:"请输入隧道名称",type:"error"}],content:[{required:!0,message:"配置文件内容不能为空",type:"error"}]},i=async({validateResult:r})=>{r===!0?await wa(n.name,n.content,"Custom",n.type):B.warning("请检查表单填写")},d=()=>{B.info("表单已重置")},f=()=>{const r=n.content.trim();if(!r){B.warning("请先输入 INI 配置内容");return}const m={tls_enable:"transport.tls.enable",token:"auth.token",protocol:"transport.protocol",pool_count:"transport.poolCount",tcp_mux:"transport.tcpMux",login_fail_exit:"loginFailExit",custom_domains:"customDomains",locations:"locations",host_header_rewrite:"hostHeaderRewrite",role:"role",sk:"sk"};try{const g=r.split(/\r?\n/);let y="";const L={},A=[];let P=null;g.forEach(C=>{const k=C.trim();if(!k||k.startsWith("#")||k.startsWith(";"))return;const z=k.match(/^\[(.+)\]$/);if(z){y=z[1],y==="common"?P=null:(P={name:y},A.push(P));return}const p=k.match(/^([^=]+)=(.*)$/);if(p){const V=p[1].trim();let h=p[2].trim(),E=V;m[V]?E=m[V]:(E=E.replace(/_([a-z])/g,(F,R)=>R.toUpperCase()),E=E.replace(/Ip/g,"IP")),h==="true"?h=!0:h==="false"?h=!1:!isNaN(Number(h))&&h!==""?h=Number(h):h=String(h),y==="common"||!y?L[E]=h:P&&(P[E]=h)}});let w="";Object.entries(L).forEach(([C,k])=>{const z=typeof k=="string"?`"${k}"`:k;w+=`${C} = ${z}
`}),A.forEach(C=>{w+=`
[[proxies]]
`,Object.entries(C).forEach(([k,z])=>{const p=typeof z=="string"?`"${z}"`:z;w+=`${k} = ${p}
`})}),n.content=w.trim(),n.type="toml",B.success("已转换为 TOML")}catch(g){console.error(g),B.error("转换失败，请检查输入格式")}};return(r,m)=>{const g=v("t-input"),y=v("t-form-item"),L=v("t-radio-button"),A=v("t-radio-group"),P=v("t-button"),w=v("t-textarea"),C=v("t-space"),k=v("t-form"),z=v("t-card");return o(),S("div",uv,[e(z,{bordered:!1},{header:a(()=>[...m[3]||(m[3]=[t("span",{style:{"font-weight":"bold","font-size":"16px"}},"自定义 Frp 隧道",-1)])]),default:a(()=>[e(k,{ref_key:"formRef",ref:l,data:n,rules:u,"label-align":"top",onReset:d,onSubmit:i},{default:a(()=>[e(y,{label:"隧道名称",name:"name"},{default:a(()=>[e(g,{modelValue:n.name,"onUpdate:modelValue":m[0]||(m[0]=p=>n.name=p),placeholder:"请输入隧道名称"},null,8,["modelValue"])]),_:1}),e(y,{label:"配置类型",name:"type"},{default:a(()=>[e(A,{modelValue:n.type,"onUpdate:modelValue":m[1]||(m[1]=p=>n.type=p),variant:"default-filled"},{default:a(()=>[e(L,{value:"toml"},{default:a(()=>[...m[4]||(m[4]=[c("TOML",-1)])]),_:1}),e(L,{value:"ini"},{default:a(()=>[...m[5]||(m[5]=[c("INI",-1)])]),_:1})]),_:1},8,["modelValue"]),n.type==="ini"?(o(),D(P,{key:0,style:{"margin-left":"8px"},variant:"outline",theme:"primary",size:"small",onClick:f},{default:a(()=>[...m[6]||(m[6]=[c(" 一键转 TOML ",-1)])]),_:1})):N("",!0)]),_:1}),e(y,{label:"隧道配置内容",name:"content"},{default:a(()=>[e(w,{modelValue:n.content,"onUpdate:modelValue":m[2]||(m[2]=p=>n.content=p),placeholder:`serverAddr = "0.0.0.0"
serverPort = 1027

[[proxies]]
name = "nahida_tcp"
...`,autosize:{minRows:10,maxRows:25},class:"code-font-textarea"},null,8,["modelValue"])]),_:1}),e(y,null,{default:a(()=>[e(C,null,{default:a(()=>[e(P,{theme:"primary",type:"submit"},{default:a(()=>[...m[7]||(m[7]=[c("保存配置",-1)])]),_:1}),e(P,{theme:"default",variant:"base",type:"reset"},{default:a(()=>[...m[8]||(m[8]=[c("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})])}}}),cv=ue(dv,[["__scopeId","data-v-4ef2421f"]]);function ka(s){const l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let u=0;u<s;u++)n+=l.charAt(Math.floor(Math.random()*l.length));return n}function Zs(s){return new Date(s*1e3).toLocaleString()}function ma(){const s=window.location.hostname;return!!(s==="localhost"||s==="::1"||s==="[::1]"||/^(?:127|10)\.\d+\.\d+\.\d+$|^(?:172\.(?:1[6-9]|2\d|3[0-1]))\.\d+\.\d+$|^(?:192\.168)\.\d+\.\d+$/.test(s)||s.startsWith("fe80:")||s.startsWith("fc")||s.startsWith("fd")||s.endsWith(".local"))}const mv=(s,l="MSL Login",n=500,u=600)=>{if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return window.open(s,"_blank"),null;const d=window.screenLeft!==void 0?window.screenLeft:window.screenX,f=window.screenTop!==void 0?window.screenTop:window.screenY,r=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,m=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,g=r/window.screen.availWidth,y=(r-n)/2/g+d,L=(m-u)/2/g+f,A=`
    scrollbars=yes,
    width=${n/g},
    height=${u/g},
    top=${L},
    left=${y}
  `,P=window.open(s,l,A);return P&&P.focus(),P},pv={class:"custom-option-item"},vv={class:"node-name-text"},fv={class:"node-tag-group"},gv={class:"node-detail-area"},_v={class:"detail-tags-row"},hv={class:"remarks-box"},yv=ne({__name:"CreateTunnelDialog",props:{visible:{type:Boolean},token:{}},emits:["update:visible","success"],setup(s,{emit:l}){const n=s,u=l,i=$(!1),d=$(!1),f=$([]),r=Xe({nodeId:null,type:"tcp",localIP:"127.0.0.1",localPort:"25565",remotePort:"",name:"",remarks:"无",bindDomain:"",use_kcp:!1,extra_config:""}),m=se(()=>f.value.find(P=>P.id===r.nodeId)||null),g=se(()=>{const P=[{label:"免费节点",value:0,children:[]},{label:"高级节点",value:1,children:[]},{label:"超级节点",value:2,children:[]}];return f.value.forEach(w=>{const C=P.find(k=>k.value===w.allow_user_group);C&&C.children.push(w)}),P.filter(w=>w.children.length>0)}),y=()=>{if(m.value){const{min_open_port:P,max_open_port:w}=m.value;r.remotePort=(Math.floor(Math.random()*(w-P+1))+P).toString()}r.name=ka(8)},L=async()=>{i.value=!0;try{const P=await Q.get({url:"/api/frp/nodeList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${n.token}`}});P.code===200&&(f.value=P.data,n.visible&&f.value.length>0&&!r.nodeId&&(r.nodeId=f.value[0].id,y()))}catch(P){B.error("加载节点失败"+P.message)}finally{i.value=!1}};be(()=>n.visible,P=>{P&&(f.value.length>0?(r.nodeId||(r.nodeId=f.value[0].id),y()):L())});const A=async()=>{if(r.nodeId){d.value=!0;try{const P=await Q.post({url:"/api/frp/addTunnel",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${n.token}`},data:{id:r.nodeId,type:r.type,local_ip:r.localIP,local_port:r.localPort,remote_port:r.remotePort,name:r.name,remarks:r.remarks,bind_domain:r.bindDomain,use_kcp:m.value?.kcp_support===1?r.use_kcp:!1,extra_config:r.extra_config||null}});P.code===200?(B.success("创建成功"),u("success"),u("update:visible",!1)):B.error(P.msg)}finally{d.value=!1}}};return Ie(()=>{n.token&&L()}),(P,w)=>{const C=v("t-tag"),k=v("t-option"),z=v("t-option-group"),p=v("t-select"),V=v("t-col"),h=v("t-button"),E=v("t-row"),F=v("t-form-item"),R=v("t-input"),H=v("t-textarea"),q=v("t-form"),U=v("t-loading"),_=v("t-dialog");return o(),D(_,{attach:"body",visible:s.visible,header:"新建隧道",width:"580px","confirm-btn":{content:"提交创建",loading:d.value},onConfirm:A,onClose:w[10]||(w[10]=x=>u("update:visible",!1))},{default:a(()=>[e(U,{loading:i.value},{default:a(()=>[e(q,{data:r,"label-align":"right","label-width":100,class:"dialog-inner-form"},{default:a(()=>[e(F,{label:"选择节点",name:"nodeId"},{default:a(()=>[e(E,{gutter:8,style:{width:"100%"}},{default:a(()=>[e(V,{flex:"auto"},{default:a(()=>[e(p,{modelValue:r.nodeId,"onUpdate:modelValue":w[0]||(w[0]=x=>r.nodeId=x),placeholder:"请选择节点",onChange:y},{default:a(()=>[(o(!0),S(ce,null,fe(g.value,x=>(o(),D(z,{key:x.value,label:x.label},{default:a(()=>[(o(!0),S(ce,null,fe(x.children,M=>(o(),D(k,{key:M.id,value:M.id,label:M.node},{default:a(()=>[t("div",pv,[t("span",vv,I(M.node),1),t("div",fv,[e(C,{size:"small",variant:"outline",theme:"primary"},{default:a(()=>[c(I(M.bandwidth)+"M",1)]),_:2},1024),e(C,{size:"small",theme:M.status===1?"success":"danger"},{default:a(()=>[c(I(M.status===1?"在线":"离线"),1)]),_:2},1032,["theme"])])])]),_:2},1032,["value","label"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(V,{flex:"none"},{default:a(()=>[e(h,{variant:"outline",onClick:w[1]||(w[1]=x=>b(Me)("https://user.mslmc.net/frp/createTunnel"))},{default:a(()=>[...w[11]||(w[11]=[c(" 前往源站创建 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),m.value?(o(),D(F,{key:0,label:"节点详情"},{default:a(()=>[t("div",gv,[t("div",_v,[e(C,{size:"small",variant:"outline",theme:"primary"},{default:a(()=>[c(I(m.value.bandwidth)+"Mbps",1)]),_:1}),e(C,{size:"small",theme:m.value.need_real_name?"success":"warning"},{default:a(()=>[c(I(m.value.need_real_name?"需要实名认证":"无需实名认证"),1)]),_:1},8,["theme"]),e(C,{size:"small",theme:m.value.status===1?"success":"danger"},{default:a(()=>[c(" 节点状态："+I(m.value.status===1?"在线":"离线"),1)]),_:1},8,["theme"])]),t("div",hv,[t("pre",null,I(m.value.remarks||"此节点暂无备注"),1)])])]),_:1})):N("",!0),e(F,{label:"隧道类型"},{default:a(()=>[e(p,{modelValue:r.type,"onUpdate:modelValue":w[2]||(w[2]=x=>r.type=x)},{default:a(()=>[e(k,{label:"TCP",value:"tcp"}),m.value?.udp_support?(o(),D(k,{key:0,label:"UDP",value:"udp"})):N("",!0),m.value?.http_support?(o(),D(k,{key:1,label:"HTTP",value:"http"})):N("",!0),m.value?.http_support?(o(),D(k,{key:2,label:"HTTPS",value:"https"})):N("",!0)]),_:1},8,["modelValue"])]),_:1}),e(E,{gutter:[16,20]},{default:a(()=>[e(V,{xs:12,sm:6},{default:a(()=>[e(F,{label:"隧道名称"},{default:a(()=>[e(R,{modelValue:r.name,"onUpdate:modelValue":w[3]||(w[3]=x=>r.name=x)},null,8,["modelValue"])]),_:1})]),_:1}),e(V,{xs:12,sm:6},{default:a(()=>[e(F,{label:"远程端口"},{default:a(()=>[e(R,{modelValue:r.remotePort,"onUpdate:modelValue":w[4]||(w[4]=x=>r.remotePort=x)},{suffix:a(()=>[e(h,{variant:"text",size:"small",onClick:y},{default:a(()=>[...w[12]||(w[12]=[c("随机",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(V,{xs:12,sm:6},{default:a(()=>[e(F,{label:"本地IP"},{default:a(()=>[e(R,{modelValue:r.localIP,"onUpdate:modelValue":w[5]||(w[5]=x=>r.localIP=x)},null,8,["modelValue"])]),_:1})]),_:1}),e(V,{xs:12,sm:6},{default:a(()=>[e(F,{label:"本地端口"},{default:a(()=>[e(R,{modelValue:r.localPort,"onUpdate:modelValue":w[6]||(w[6]=x=>r.localPort=x)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),r.type.includes("http")?(o(),D(F,{key:1,label:"绑定域名",class:"spacing-item"},{default:a(()=>[e(R,{modelValue:r.bindDomain,"onUpdate:modelValue":w[7]||(w[7]=x=>r.bindDomain=x),placeholder:"输入已解析的域名"},null,8,["modelValue"])]),_:1})):N("",!0),e(F,{label:"备注说明",class:"spacing-item"},{default:a(()=>[e(R,{modelValue:r.remarks,"onUpdate:modelValue":w[8]||(w[8]=x=>r.remarks=x)},null,8,["modelValue"])]),_:1}),e(F,{label:"额外参数",class:"spacing-item"},{default:a(()=>[e(H,{modelValue:r.extra_config,"onUpdate:modelValue":w[9]||(w[9]=x=>r.extra_config=x),autosize:{minRows:2},placeholder:"选填，高级配置参数（不懂清留空！！！）"},null,8,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:1},8,["loading"])]),_:1},8,["visible","confirm-btn"])}}}),bv=ue(yv,[["__scopeId","data-v-a8b2caa6"]]),wv={key:0,class:"manager-container"},kv={class:"toolbar"},$v={class:"record-list"},xv={key:0,class:"empty-state"},Av={class:"card-main"},Cv={class:"domain-title"},Sv={class:"sub"},Iv={class:"root"},Vv={class:"info-badges"},Mv=["title"],Uv={key:0,class:"srv-helper"},Lv={class:"card-actions"},Bv={key:1,class:"form-container"},zv={class:"form-header"},Pv={class:"remark-display"},Rv={key:0,class:"prefix-hint"},Ev={class:"row-fields"},Tv={class:"form-actions"},Fv=ne({__name:"DomainManagerDialog",props:{visible:{type:Boolean},token:{},tunnels:{}},emits:["update:visible"],setup(s,{emit:l}){const n=s,u=l,i=$("list"),d=$("mc_srv"),f=$(!1),r=$(!1),m=$([]),g=$([]),y=$([]),L=$(null),A=Xe({id:0,domain_id:void 0,name:"",type:"A",record:""}),P=se(()=>n.tunnels?n.tunnels.filter(_=>_.type&&_.type.toUpperCase()==="TCP"):[]),w=se(()=>{const _=g.value.find(x=>x.id===A.domain_id);return _?_.remark:""}),C=async()=>{if(n.token){f.value=!0;try{await Promise.all([k(),z(),p()])}catch(_){console.error(_)}finally{f.value=!1}}},k=async()=>{const _=await Q.get({url:"/api/domain/dns/list",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${n.token}`}});_.code===200&&(m.value=_.data||[])},z=async()=>{const _=await Q.get({url:"/api/domain/list",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${n.token}`}});_.code===200&&(g.value=_.data||[])},p=async()=>{try{const _=await Q.get({url:"/api/frp/nodeList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${n.token}`}});_.code===200&&(y.value=_.data||[])}catch(_){console.error("Fetch nodes failed",_)}},V=_=>{const x=n.tunnels.find(M=>M.id===_);if(x){const M=y.value.find(W=>W.id===x.node_id),J=M?M.domain||M.ip:null;J?(A.record=`5 5 ${x.remote_port} ${J}`,B.success("已自动生成解析值")):(B.warning(`无法获取节点(ID:${x.node_id})地址，请手动填写`),A.record=`5 5 ${x.remote_port} 请输入节点地址`),A.type="SRV"}};Ie(()=>{n.visible&&n.token&&C()}),be(()=>n.visible,_=>{_&&(i.value="list",C())}),be(g,_=>{_.length>0&&A.domain_id===void 0&&A.id===0&&(A.domain_id=_[0].id)});const h=_=>_.type!=="SRV"?"":`${_.name.replace("_minecraft._tcp.","")}.${_.domain}`,E=()=>{i.value="form",d.value="mc_srv",L.value=null,A.id=0,A.name="",A.type="SRV",A.record="",g.value.length>0&&(A.domain_id=g.value[0].id)},F=_=>{i.value="form",d.value="custom",A.id=_.id,A.domain_id=Number(_.domain_id),A.name=_.name,A.type=_.type,A.record=_.record},R=()=>{i.value="list"},H=async()=>{const _=A.type.toUpperCase()==="SRV"||d.value==="mc_srv",x=_?/^[a-zA-Z0-9._-]+$/:/^[a-zA-Z0-9]+$/;let M=A.name;if(M.length<1)return B.warning("请输入子域名名称");if(!x.test(M))return B.warning(_?"SRV支持英文、数字、下划线及点":"普通解析仅支持英文数字");d.value==="mc_srv"&&A.id===0&&(M.startsWith("_minecraft._tcp.")||(M="_minecraft._tcp."+M),A.type="SRV"),r.value=!0;const J=A.id!==0?"/api/domain/dns/edit":"/api/domain/dns/add";try{const W=await Q.post({url:J,baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${n.token}`},data:{...A,name:M}});W.code===200?(B.success(W.msg||"操作成功"),await k(),i.value="list"):B.error(W.msg)}catch(W){B.error("请求失败: "+W.message)}finally{r.value=!1}},q=async _=>{const x=st.confirm({header:"确认删除",body:"确定要删除这条解析记录吗？删除后无法恢复。",onConfirm:async()=>{x.hide();try{const M=await Q.post({url:"/api/domain/dns/delete",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${n.token}`},data:{id:_}});M.code===200?(B.success("删除成功"),k()):B.error(M.msg)}catch(M){B.error(M.message)}}})},U=()=>{u("update:visible",!1)};return(_,x)=>{const M=v("t-button"),J=v("t-empty"),W=v("t-tag"),X=v("t-tooltip"),K=v("t-loading"),G=v("t-tab-panel"),Le=v("t-tabs"),ve=v("t-option"),Re=v("t-select"),he=v("t-form-item"),Se=v("t-input"),Be=v("t-form"),ze=v("t-dialog");return o(),D(ze,{visible:s.visible,header:i.value==="list"?"MSLFrp免费子域名管理":A.id===0?"创建新解析":"编辑解析",width:"650px",attach:"body",footer:!1,onClose:U},{default:a(()=>[i.value==="list"?(o(),S("div",wv,[t("div",kv,[e(M,{variant:"text",theme:"default",onClick:x[0]||(x[0]=de=>b(Me)("https://www.mslmc.cn/docs/proxy/server-no-port/"))},{icon:a(()=>[e(b(Vs))]),default:a(()=>[x[7]||(x[7]=c("查看文档 ",-1))]),_:1}),e(M,{theme:"primary",onClick:E},{icon:a(()=>[e(b(vt))]),default:a(()=>[x[8]||(x[8]=c("新建解析 ",-1))]),_:1})]),e(K,{loading:f.value,text:"加载中..."},{default:a(()=>[t("div",$v,[m.value.length===0?(o(),S("div",xv,[e(J,{title:"暂无解析记录",description:"点击上方按钮创建一个吧"})])):N("",!0),(o(!0),S(ce,null,fe(m.value,de=>(o(),S("div",{key:de.id,class:"record-card"},[t("div",Av,[t("div",Cv,[t("span",Sv,I(de.name),1),t("span",Iv,"."+I(de.domain),1)]),t("div",Vv,[e(W,{size:"small",theme:de.type==="SRV"?"warning":"primary",variant:"light"},{default:a(()=>[c(I(de.type),1)]),_:2},1032,["theme"]),t("span",{class:"record-value",title:de.record},I(de.record),9,Mv)]),de.type==="SRV"?(o(),S("div",Uv,[e(b(Mt)),t("span",null,[x[9]||(x[9]=c("地址: ",-1)),t("strong",null,I(h(de)),1)])])):N("",!0)]),t("div",Lv,[e(X,{content:"编辑"},{default:a(()=>[e(M,{shape:"circle",variant:"text",onClick:me=>F(de)},{icon:a(()=>[e(b(Ms))]),_:1},8,["onClick"])]),_:2},1024),e(X,{content:"删除"},{default:a(()=>[e(M,{shape:"circle",variant:"text",theme:"danger",onClick:me=>q(de.id)},{icon:a(()=>[e(b(mt))]),_:1},8,["onClick"])]),_:2},1024)])]))),128))])]),_:1},8,["loading"])])):(o(),S("div",Bv,[t("div",zv,[e(M,{variant:"text",size:"small",onClick:R},{icon:a(()=>[e(b(Us))]),default:a(()=>[x[10]||(x[10]=c(" 返回列表 ",-1))]),_:1})]),A.id===0?(o(),D(Le,{key:0,modelValue:d.value,"onUpdate:modelValue":x[1]||(x[1]=de=>d.value=de),class:"mode-tabs"},{default:a(()=>[e(G,{value:"mc_srv",label:"MC Java版隐藏端口"}),e(G,{value:"custom",label:"自定义解析"})]),_:1},8,["modelValue"])):N("",!0),e(Be,{"label-align":"top",data:A,class:"dns-form"},{default:a(()=>[e(he,{label:"选择域名后缀"},{default:a(()=>[e(Re,{modelValue:A.domain_id,"onUpdate:modelValue":x[2]||(x[2]=de=>A.domain_id=de),disabled:A.id!==0,placeholder:"请选择后缀",filterable:""},{default:a(()=>[(o(!0),S(ce,null,fe(g.value,de=>(o(),D(ve,{key:de.id,value:de.id,label:de.domain},{default:a(()=>[c(I(de.domain),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),w.value?(o(),D(he,{key:0,label:"备注"},{default:a(()=>[t("div",Pv,I(w.value),1)]),_:1})):N("",!0),e(he,{label:"子域名称",help:"起一个你喜欢的前缀即可"},{default:a(()=>[e(Se,{modelValue:A.name,"onUpdate:modelValue":x[3]||(x[3]=de=>A.name=de),placeholder:"例如: myserver"},{"prefix-icon":a(()=>[d.value==="mc_srv"&&A.id===0?(o(),S("span",Rv,"_minecraft._tcp.")):N("",!0)]),_:1},8,["modelValue"])]),_:1}),d.value==="mc_srv"&&A.id===0?(o(),D(he,{key:1,label:"选择隧道 (自动生成解析值)"},{default:a(()=>[e(Re,{modelValue:L.value,"onUpdate:modelValue":x[4]||(x[4]=de=>L.value=de),placeholder:"点击选择已有的 TCP 隧道",onChange:V},{default:a(()=>[(o(!0),S(ce,null,fe(P.value,de=>(o(),D(ve,{key:de.id,value:de.id,label:`${de.name} (端口: ${de.remote_port})`},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})):N("",!0),t("div",Ev,[e(he,{label:"记录类型",class:"half-width"},{default:a(()=>[e(Re,{modelValue:A.type,"onUpdate:modelValue":x[5]||(x[5]=de=>A.type=de)},{default:a(()=>[e(ve,{label:"A (IPv4)",value:"A"}),e(ve,{label:"CNAME (别名)",value:"CNAME"}),e(ve,{label:"AAAA (IPv6)",value:"AAAA"}),e(ve,{label:"SRV (服务记录)",value:"SRV"})]),_:1},8,["modelValue"])]),_:1}),e(he,{label:"解析记录值",class:"half-width"},{default:a(()=>[e(Se,{modelValue:A.record,"onUpdate:modelValue":x[6]||(x[6]=de=>A.record=de),placeholder:"例: 5 5 25565 node.mslmc.net"},null,8,["modelValue"])]),_:1})]),t("div",Tv,[e(M,{theme:"default",variant:"base",onClick:R},{default:a(()=>[...x[11]||(x[11]=[c("取消",-1)])]),_:1}),e(M,{theme:"primary",loading:r.value,onClick:H},{default:a(()=>[c(I(A.id===0?"立即创建":"保存修改"),1)]),_:1},8,["loading"])])]),_:1},8,["data"])]))]),_:1},8,["visible","header"])}}}),Dv=ue(Fv,[["__scopeId","data-v-e04d368f"]]),Ov={class:"page-container"},jv={key:0,class:"login-container"},Nv={class:"login-card"},Kv={class:"icon-wrapper"},qv={key:1,class:"dashboard-container"},Gv={class:"stat-item"},Hv={class:"value"},Jv={class:"stat-item"},Wv={class:"value"},Xv={class:"stat-item"},Qv={class:"value"},Yv={class:"stat-item"},Zv={class:"value date-text"},e1={class:"list-header"},t1={class:"tunnel-list"},a1=["onClick"],s1={class:"item-icon"},l1={class:"item-content"},n1={class:"item-title"},o1={class:"item-subtitle"},i1={class:"item-status"},r1={key:0,class:"empty-state"},u1={key:0,class:"detail-content"},d1={class:"detail-header"},c1={class:"remarks"},m1={class:"detail-grid"},p1={class:"val"},v1={class:"detail-grid"},f1={class:"val uppercase"},g1={class:"detail-grid"},_1={class:"val"},h1={class:"detail-grid"},y1={class:"val highlight"},b1={class:"detail-grid"},w1={class:"val"},k1={class:"detail-grid"},$1={class:"val"},x1={class:"action-area"},A1={key:1,class:"empty-detail"},C1=ne({__name:"index",setup(s){const l=$(!1),n=$(!1),u=()=>{z()},i=$("tKYvKk48Sq5kGAy12IJQxLEKhXx"),d=$(null),f=$(""),r=$(!1),m=$(null),g=$([]),y=$({}),L=$(null),A=se(()=>g.value.find(q=>q.id===L.value)||null),P=se(()=>A.value?y.value[A.value.node_id]||`未知节点 (${A.value.node_id})`:"");Ie(()=>{const q=localStorage.getItem("msl-user-token");q&&(f.value=q,z())}),Qe(()=>{d.value&&!d.value.closed&&d.value.close()});async function w(){B.info("正在跳转至MSL用户中心登录...");try{const q=ka(32),U=await Q.post({url:"/api/oauth/createAppLogin",baseURL:"https://user.mslmc.net",data:{appid:i.value,csrf:q}});U.data.ssid?(d.value=mv(U.data.url,"登录到您的MSL账户",600,600),setTimeout(()=>C(q,U.data.ssid),1e3)):B.error(U.msg)}catch(q){B.error(q.message)}}async function C(q,U){if(!d.value?.closed){try{const _=await Q.get({url:"/api/oauth/appLogin",baseURL:"https://user.mslmc.net",params:{csrf:q,ssid:U}});if(_.data.token){d.value&&d.value.close(),B.success("登录成功"),f.value=_.data.token,localStorage.setItem("msl-user-token",_.data.token),z();return}}catch(_){B.error("登录失败！"+_.message);return}setTimeout(()=>C(q,U),1e3)}}const k=q=>{if(q===0)return"0 B";const U=1024,_=["B","KB","MB","GB","TB"],x=Math.floor(Math.log(q)/Math.log(U));return parseFloat((q/Math.pow(U,x)).toFixed(2))+" "+_[x]};async function z(){r.value=!0;try{const[q,U]=await Promise.all([Q.get({url:"/api/frp/userInfo",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${f.value}`}}),Q.get({url:"/api/frp/nodeList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${f.value}`}})]);if(q.code===200)m.value=q.data;else{B.warning("登录已过期，请重新登录～"),f.value="",localStorage.removeItem("msl-user-token");return}if(U.code===200){const x={};U.data.forEach(M=>{x[M.id]=M.node}),y.value=x}const _=await Q.get({url:"/api/frp/getTunnelList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${f.value}`}});_.code===200&&(g.value=_.data,g.value.length>0&&(L.value=g.value[0].id))}catch(q){B.error("数据加载失败: "+q.message)}finally{r.value=!1}}const p=$(!1);async function V(){if(A.value){p.value=!0;try{const q=await Q.get({url:"/api/frp/getTunnelConfig",baseURL:"https://user.mslmc.net",params:{id:A.value.id},headers:{Authorization:`Bearer ${f.value}`}});q.code===200?await wa(A.value.name,q.data,"MSLFrp"):B.error(q.msg)}catch(q){B.error("获取配置失败: "+q.message)}p.value=!1}}const h=()=>{n.value=!0};async function E(){try{await Q.get({url:"/api/user/logout",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${f.value}`}}),f.value="",m.value=null,g.value=[],localStorage.removeItem("msl-user-token"),B.success("已退出登录")}catch(q){B.error("退出失败: "+q.message)}}async function F(){await z(),B.success("数据已更新")}const R=$(!1);async function H(){if(A.value){R.value=!0;try{const q=await Q.post({url:"/api/frp/deleteTunnel",baseURL:"https://user.mslmc.net",data:{id:A.value.id},headers:{Authorization:`Bearer ${f.value}`}});q.code===200?(B.success("隧道删除成功"),L.value=null,await z()):B.error(q.msg||"删除失败")}catch(q){B.error("操作失败: "+q.message)}finally{R.value=!1}}}return(q,U)=>{const _=v("t-button"),x=v("t-space"),M=v("t-loading"),J=v("t-tag"),W=v("t-popconfirm"),X=v("t-col"),K=v("t-row"),G=v("t-card"),Le=v("t-divider");return o(),S("div",Ov,[f.value===""?(o(),S("div",jv,[t("div",Nv,[t("div",Kv,[e(b(Rt),{size:"48px",style:{color:"var(--td-brand-color)"}})]),U[8]||(U[8]=t("h2",{class:"title"},"欢迎登录 MSLFrp",-1)),U[9]||(U[9]=t("p",{class:"subtitle"},"登录您的MSL账户以使用 MSLFrp 服务",-1)),e(x,{direction:"vertical",size:"medium",style:{width:"100%"}},{default:a(()=>[e(_,{block:"",theme:"primary",size:"large",onClick:w},{icon:a(()=>[e(b(Rt))]),default:a(()=>[U[6]||(U[6]=c(" 跳转用户中心登录 ",-1))]),_:1}),e(_,{theme:"default",variant:"outline",block:"",size:"large",onClick:U[0]||(U[0]=ve=>b(Me)("https://user.mslmc.net/register"))},{icon:a(()=>[e(b(Cl))]),default:a(()=>[U[7]||(U[7]=c(" 注册 MSL 账户 ",-1))]),_:1})]),_:1})])])):(o(),S("div",qv,[e(M,{attach:"#app-space",loading:r.value,text:"加载数据中..."},null,8,["loading"]),e(x,{id:"app-space",direction:"vertical",size:"large",style:{width:"100%"}},{default:a(()=>[m.value?(o(),D(G,{key:0,bordered:!1,title:"MSLFrp 用户信息",class:"info-card"},{actions:a(()=>[e(x,{size:"small"},{default:a(()=>[e(_,{variant:"outline",theme:"success",size:"small",onClick:U[1]||(U[1]=ve=>b(Me)("https://user.mslmc.net/store/buy"))},{default:a(()=>[...U[10]||(U[10]=[c(" 订阅会员服务 ",-1)])]),_:1}),e(J,{theme:"primary",variant:"light-outline"},{default:a(()=>[c(I(m.value.user_group_name),1)]),_:1}),e(W,{content:"确认退出登录吗？",onConfirm:E},{default:a(()=>[e(_,{variant:"outline",theme:"danger",size:"small"},{default:a(()=>[...U[11]||(U[11]=[c(" 退出登录 ",-1)])]),_:1})]),_:1})]),_:1})]),default:a(()=>[e(K,{gutter:[16,16]},{default:a(()=>[e(X,{xs:6,sm:3},{default:a(()=>[t("div",Gv,[U[12]||(U[12]=t("div",{class:"label"},"用户昵称",-1)),t("div",Hv,[c(I(m.value.name)+" ",1),e(J,{theme:m.value.realNameStatus?"success":"warning",variant:"dark",size:"small",style:{cursor:"pointer"},onClick:U[2]||(U[2]=ve=>b(Me)("https://user.mslmc.net/user/profile"))},{default:a(()=>[c(I(m.value.realNameStatus?"已实名":"未实名"),1)]),_:1},8,["theme"])])])]),_:1}),e(X,{xs:6,sm:3},{default:a(()=>[t("div",Jv,[U[13]||(U[13]=t("div",{class:"label"},"隧道限额",-1)),t("div",Wv,I(m.value.maxTunnelCount)+" 条",1)])]),_:1}),e(X,{xs:6,sm:3},{default:a(()=>[t("div",Xv,[U[14]||(U[14]=t("div",{class:"label"},"速率限制",-1)),t("div",Qv,I(m.value.boundLimit/1024*8)+" Mbps",1)])]),_:1}),e(X,{xs:6,sm:3},{default:a(()=>[t("div",Yv,[U[15]||(U[15]=t("div",{class:"label"},"会员到期时间",-1)),t("div",Zv,I(m.value.outdated===3749682420?"长期有效":b(Zs)(m.value.outdated)),1)])]),_:1})]),_:1})]),_:1})):N("",!0),e(K,{gutter:[16,16]},{default:a(()=>[e(X,{xs:12,md:5,lg:4},{default:a(()=>[e(G,{bordered:!1,class:"full-height-card"},{title:a(()=>[t("div",e1,[U[19]||(U[19]=t("span",null,"我的隧道",-1)),e(x,{size:"4px"},{default:a(()=>[e(_,{style:{"margin-left":"3px"},size:"small",variant:"text",loading:r.value,onClick:F},{icon:a(()=>[e(b(Ze))]),default:a(()=>[U[16]||(U[16]=c(" 刷新 ",-1))]),_:1},8,["loading"]),e(_,{size:"small",variant:"text",onClick:U[3]||(U[3]=ve=>l.value=!0)},{icon:a(()=>[e(b(Ut))]),default:a(()=>[U[17]||(U[17]=c(" 免费子域名 ",-1))]),_:1}),e(_,{size:"small",variant:"text",onClick:h},{icon:a(()=>[e(b(vt))]),default:a(()=>[U[18]||(U[18]=c(" 新建 ",-1))]),_:1})]),_:1})])]),default:a(()=>[t("div",t1,[(o(!0),S(ce,null,fe(g.value,ve=>(o(),S("div",{key:ve.id,class:$e(["tunnel-item",{active:L.value===ve.id}]),onClick:Re=>L.value=ve.id},[t("div",s1,[e(b($t))]),t("div",l1,[t("div",n1,I(ve.name),1),t("div",o1,I(y.value[ve.node_id]||`Node ${ve.node_id}`),1)]),t("div",i1,[ve.status===1?(o(),D(J,{key:0,theme:"success",variant:"light",size:"small"},{default:a(()=>[...U[20]||(U[20]=[c("在线",-1)])]),_:1})):(o(),D(J,{key:1,theme:"default",variant:"light",size:"small"},{default:a(()=>[...U[21]||(U[21]=[c("未启动",-1)])]),_:1}))])],10,a1))),128)),g.value.length===0?(o(),S("div",r1,"暂无隧道")):N("",!0)])]),_:1})]),_:1}),e(X,{xs:12,md:7,lg:8},{default:a(()=>[e(G,{bordered:!1,class:"full-height-card"},{title:a(()=>[...U[22]||(U[22]=[t("span",null,"隧道详情",-1)])]),actions:a(()=>[A.value?(o(),D(W,{key:0,content:"确认删除此隧道吗？",theme:"danger",placement:"bottom-right",onConfirm:H},{default:a(()=>[e(_,{theme:"danger",variant:"text",loading:R.value},{default:a(()=>[...U[23]||(U[23]=[c(" 删除隧道 ",-1)])]),_:1},8,["loading"])]),_:1})):N("",!0)]),default:a(()=>[A.value?(o(),S("div",u1,[t("div",d1,[t("h3",null,I(A.value.name),1),t("p",c1,I(A.value.remarks||"暂无备注"),1)]),e(Le),e(K,{gutter:[24,24]},{default:a(()=>[e(X,{span:6},{default:a(()=>[t("div",m1,[U[24]||(U[24]=t("span",{class:"label"},"所在节点",-1)),t("span",p1,I(P.value),1)])]),_:1}),e(X,{span:6},{default:a(()=>[t("div",v1,[U[25]||(U[25]=t("span",{class:"label"},"协议类型",-1)),t("span",f1,I(A.value.type),1)])]),_:1}),e(X,{span:6},{default:a(()=>[t("div",g1,[U[26]||(U[26]=t("span",{class:"label"},"本地地址",-1)),t("span",_1,I(A.value.local_ip)+":"+I(A.value.local_port),1)])]),_:1}),e(X,{span:6},{default:a(()=>[t("div",h1,[U[27]||(U[27]=t("span",{class:"label"},"远程端口",-1)),t("span",y1,I(A.value.remote_port),1)])]),_:1}),e(X,{span:6},{default:a(()=>[t("div",b1,[U[28]||(U[28]=t("span",{class:"label"},"今日流量",-1)),t("span",w1,I(k(A.value.today_traffic*1024*1024)),1)])]),_:1}),e(X,{span:6},{default:a(()=>[t("div",k1,[U[29]||(U[29]=t("span",{class:"label"},"总流量",-1)),t("span",$1,I(k(A.value.total_traffic*1024*1024)),1)])]),_:1})]),_:1}),e(Le),t("div",x1,[e(_,{theme:"primary",size:"large",loading:p.value,block:"",onClick:V},{icon:a(()=>[e(b(Ot))]),default:a(()=>[U[30]||(U[30]=c(" 使用此隧道 ",-1))]),_:1},8,["loading"])])])):(o(),S("div",A1,[e(b(Ut),{size:"48px",style:{color:"var(--td-text-color-disabled)"}}),U[31]||(U[31]=t("p",null,"请在左侧选择一个隧道查看详情",-1))]))]),_:1})]),_:1})]),_:1})]),_:1})])),n.value?(o(),D(bv,{key:2,visible:n.value,"onUpdate:visible":U[4]||(U[4]=ve=>n.value=ve),token:f.value,onSuccess:u},null,8,["visible","token"])):N("",!0),l.value?(o(),D(Dv,{key:3,visible:l.value,"onUpdate:visible":U[5]||(U[5]=ve=>l.value=ve),token:f.value,tunnels:g.value},null,8,["visible","token","tunnels"])):N("",!0)])}}}),S1=ue(C1,[["__scopeId","data-v-a5e7f491"]]);async function I1(){return await Q.get({url:"/query/p2p_server",baseURL:"https://api.mslmc.cn/v3"})}const V1={key:0},M1={key:1},U1={key:0},L1={key:1},B1={key:0},z1={key:1},P1=ne({__name:"MSLP2P",setup(s){const l=Xe({roomId:"",roomKey:"",bindPort:25565,isHoster:!0}),n={roomId:[{required:!0,message:"请输入房间号",type:"error"}],roomKey:[{required:!0,message:"请输入房间密钥",type:"error"}],bindPort:[{required:!0,message:"请输入绑定端口",type:"error"}]},u=async({validateResult:d})=>{d===!0?await i(l.isHoster,l.roomId,l.roomKey,l.bindPort):B.warning("请检查参数是否全部填写完成！")};async function i(d,f,r,m){try{const g=await I1();let y;d?y=`serverAddr = "${g.ip}"
serverPort = ${g.port}

[[proxies]]
name = "${f}"
type = "xtcp"
secretKey = "${r}"
localIP = "127.0.0.1"
localPort = ${m}`:y=`serverAddr = "${g.ip}"
serverPort = ${g.port}

[[visitors]]
name = "p2p_visitor"
type = "xtcp"
serverName = "${f}"
secretKey = "${r}"
bindAddr = "127.0.0.1"
bindPort = ${m}`,await wa(d?`「联机 - 房主」${f}`:`「联机 - 访客」${f}`,y,"MSL P2P")}catch(g){B.error(`创建联机隧道失败！${g.message}`)}}return(d,f)=>{const r=v("t-radio"),m=v("t-radio-group"),g=v("t-form-item"),y=v("t-input"),L=v("t-button"),A=v("t-form"),P=v("t-card");return o(),S("div",null,[e(P,{bordered:!1},{header:a(()=>[...f[5]||(f[5]=[t("span",{style:{"font-weight":"bold","font-size":"16px"}},"MSL P2P 联机隧道",-1)])]),default:a(()=>[e(A,{data:l,rules:n,"label-width":100,"label-align":"top","reset-type":"initial",onSubmit:u},{default:a(()=>[e(g,{label:"请选择联机类型",name:"isHoster"},{default:a(()=>[e(m,{modelValue:l.isHoster,"onUpdate:modelValue":f[0]||(f[0]=w=>l.isHoster=w)},{default:a(()=>[e(r,{value:!0},{default:a(()=>[...f[6]||(f[6]=[c("创建房间 - 房主",-1)])]),_:1}),e(r,{value:!1},{default:a(()=>[...f[7]||(f[7]=[c("加入房间 - 成员",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"房间号",name:"roomId"},{help:a(()=>[l.isHoster?(o(),S("span",V1,"建议填写您的QQ号码。")):(o(),S("span",M1,"请输入房间创建者提供的房间号。"))]),default:a(()=>[e(y,{modelValue:l.roomId,"onUpdate:modelValue":f[1]||(f[1]=w=>l.roomId=w),placeholder:"请输入房间号"},null,8,["modelValue"])]),_:1}),e(g,{label:"房间密钥",name:"roomKey"},{help:a(()=>[l.isHoster?(o(),S("span",U1,"随便写一个你喜欢的密钥。")):(o(),S("span",L1,"请输入房间创建者提供的密钥。"))]),default:a(()=>[e(y,{modelValue:l.roomKey,"onUpdate:modelValue":f[2]||(f[2]=w=>l.roomKey=w),placeholder:"请输入房间密钥"},null,8,["modelValue"]),l.isHoster?(o(),D(L,{key:0,theme:"default",variant:"base",style:{"margin-left":"5px"},onClick:f[3]||(f[3]=w=>{l.roomKey=b(ka)(16)})},{default:a(()=>[...f[8]||(f[8]=[c("随机生成",-1)])]),_:1})):N("",!0)]),_:1}),e(g,{label:"绑定端口",name:"bindPort"},{help:a(()=>[l.isHoster?(o(),S("span",B1,"请输入游戏内提示的开放联机端口。")):(o(),S("span",z1,"建议保持默认。"))]),default:a(()=>[e(y,{modelValue:l.bindPort,"onUpdate:modelValue":f[4]||(f[4]=w=>l.bindPort=w),placeholder:"请输入绑定端口"},null,8,["modelValue"])]),_:1}),e(g,{style:{"margin-top":"16px"}},{default:a(()=>[e(L,{theme:"primary",type:"submit"},{default:a(()=>[...f[9]||(f[9]=[c("添加隧道",-1)])]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})])}}}),R1={class:"custom-option-item"},E1={class:"node-name-text"},T1={class:"node-tag-group"},F1={class:"node-detail-area"},D1={class:"remarks-box"},O1=ne({__name:"CreateTunnelDialog",props:{visible:{type:Boolean},token:{}},emits:["update:visible","success"],setup(s,{emit:l}){const n=s,u=l,i=$(!1),d=$(!1),f=$([]),r=Xe({nodeId:null,proxyType:"tcp",localIp:"127.0.0.1",localPort:"25565",remotePort:"",proxyName:"",domain:""}),m=se(()=>f.value.find(P=>P.nodeId===r.nodeId)||null),g=se(()=>{const P=new Map;return f.value.forEach(w=>{const C=w.region||"unknown";if(!P.has(C)){let k=C;C==="oversea"?k="海外节点":C==="cn"?k="国内节点":k="默认节点",P.set(C,{label:k,value:C,children:[]})}P.get(C).children.push(w)}),Array.from(P.values())}),y=()=>{r.remotePort=(Math.floor(Math.random()*55536)+1e4).toString(),r.proxyName="MSLX_"+ka(6)},L=async()=>{i.value=!0;try{const P=await Q.get({url:"/auth/node/list",baseURL:"https://api.mefrp.com/api",headers:{Authorization:`Bearer ${n.token}`}},{withToken:!1});P&&(f.value=P.filter(w=>!w.isDisabled),n.visible&&f.value.length>0&&!r.nodeId&&(r.nodeId=f.value[0].nodeId,y()))}catch(P){B.error("加载节点失败: "+P.message)}finally{i.value=!1}};be(()=>n.visible,P=>{P&&(f.value.length>0?(r.nodeId||(r.nodeId=f.value[0].nodeId),y()):L())});const A=async()=>{if(!r.nodeId){B.warning("请选择一个节点");return}d.value=!0;try{await Q.post({url:"/auth/proxy/create",baseURL:"https://api.mefrp.com/api",headers:{Authorization:`Bearer ${n.token}`},data:{accessKey:"",headerXFromWhere:"",hostHeaderRewrite:"",proxyProtocolVersion:"",nodeId:r.nodeId,proxyName:r.proxyName,proxyType:r.proxyType,localIp:r.localIp,localPort:parseInt(r.localPort),remotePort:parseInt(r.remotePort),domain:r.domain,useCompression:!1,useEncryption:!1}},{withToken:!1}),B.success(`隧道 ${r.proxyName} 创建成功！`),u("success"),u("update:visible",!1)}catch(P){B.error("创建异常: "+P.message)}finally{d.value=!1}};return Ie(()=>{n.token&&L()}),(P,w)=>{const C=v("t-tag"),k=v("t-option"),z=v("t-option-group"),p=v("t-select"),V=v("t-form-item"),h=v("t-input"),E=v("t-col"),F=v("t-button"),R=v("t-row"),H=v("t-form"),q=v("t-loading"),U=v("t-dialog");return o(),D(U,{attach:"body",visible:s.visible,header:"新建 ME Frp 隧道",width:"580px","confirm-btn":{content:"提交创建",loading:d.value},onConfirm:A,onClose:w[7]||(w[7]=_=>u("update:visible",!1))},{default:a(()=>[e(q,{loading:i.value},{default:a(()=>[e(H,{data:r,"label-align":"right","label-width":100,class:"dialog-inner-form"},{default:a(()=>[e(V,{label:"选择节点",name:"nodeId"},{default:a(()=>[e(p,{modelValue:r.nodeId,"onUpdate:modelValue":w[0]||(w[0]=_=>r.nodeId=_),placeholder:"请选择节点",onChange:y},{default:a(()=>[(o(!0),S(ce,null,fe(g.value,_=>(o(),D(z,{key:_.value,label:_.label},{default:a(()=>[(o(!0),S(ce,null,fe(_.children,x=>(o(),D(k,{key:x.nodeId,value:x.nodeId,label:x.name},{default:a(()=>[t("div",R1,[t("span",E1,I(x.name),1),t("div",T1,[e(C,{size:"small",variant:"outline",theme:"primary"},{default:a(()=>[c(I(x.bandwidth||"未知带宽"),1)]),_:2},1024),e(C,{size:"small",theme:x.isOnline?"success":"danger"},{default:a(()=>[c(I(x.isOnline?"在线":"离线"),1)]),_:2},1032,["theme"])])])]),_:2},1032,["value","label"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),m.value?(o(),D(V,{key:0,label:"节点详情"},{default:a(()=>[t("div",F1,[t("div",D1,[t("pre",null,I(m.value.description||"此节点暂无备注"),1)])])]),_:1})):N("",!0),e(V,{label:"隧道类型"},{default:a(()=>[e(p,{modelValue:r.proxyType,"onUpdate:modelValue":w[1]||(w[1]=_=>r.proxyType=_)},{default:a(()=>[m.value?.allowType.includes("tcp")?(o(),D(k,{key:0,label:"TCP",value:"tcp"})):N("",!0),m.value?.allowType.includes("udp")?(o(),D(k,{key:1,label:"UDP",value:"udp"})):N("",!0),m.value?.allowType.includes("http")?(o(),D(k,{key:2,label:"HTTP",value:"http"})):N("",!0),m.value?.allowType.includes("https")?(o(),D(k,{key:3,label:"HTTPS",value:"https"})):N("",!0)]),_:1},8,["modelValue"])]),_:1}),e(R,{gutter:[16,20]},{default:a(()=>[e(E,{xs:12,sm:6},{default:a(()=>[e(V,{label:"隧道名称"},{default:a(()=>[e(h,{modelValue:r.proxyName,"onUpdate:modelValue":w[2]||(w[2]=_=>r.proxyName=_)},null,8,["modelValue"])]),_:1})]),_:1}),e(E,{xs:12,sm:6},{default:a(()=>[e(V,{label:"远程端口"},{default:a(()=>[e(h,{modelValue:r.remotePort,"onUpdate:modelValue":w[3]||(w[3]=_=>r.remotePort=_)},{suffix:a(()=>[e(F,{variant:"text",size:"small",onClick:y},{default:a(()=>[...w[8]||(w[8]=[c("随机",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(E,{xs:12,sm:6},{default:a(()=>[e(V,{label:"本地IP"},{default:a(()=>[e(h,{modelValue:r.localIp,"onUpdate:modelValue":w[4]||(w[4]=_=>r.localIp=_)},null,8,["modelValue"])]),_:1})]),_:1}),e(E,{xs:12,sm:6},{default:a(()=>[e(V,{label:"本地端口"},{default:a(()=>[e(h,{modelValue:r.localPort,"onUpdate:modelValue":w[5]||(w[5]=_=>r.localPort=_)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),r.proxyType.includes("http")?(o(),D(V,{key:1,label:"绑定域名",class:"spacing-item"},{default:a(()=>[e(h,{modelValue:r.domain,"onUpdate:modelValue":w[6]||(w[6]=_=>r.domain=_),placeholder:"输入绑定的域名"},null,8,["modelValue"])]),_:1})):N("",!0)]),_:1},8,["data"])]),_:1},8,["loading"])]),_:1},8,["visible","confirm-btn"])}}}),j1=ue(O1,[["__scopeId","data-v-e521e9da"]]),N1={class:"page-container"},K1={key:0,class:"login-container"},q1={class:"login-card"},G1={class:"icon-wrapper"},H1={class:"submit-btn-wrap"},J1={class:"submit-btn-wrap"},W1={class:"register-link"},X1={key:1,class:"dashboard-container"},Q1={class:"stat-item"},Y1={class:"value"},Z1={class:"stat-item"},ef={class:"value"},tf={class:"stat-item"},af={class:"value"},sf={class:"stat-item"},lf={class:"value"},nf={class:"list-header"},of={class:"tunnel-list"},rf=["onClick"],uf={class:"item-icon"},df={class:"item-content"},cf={class:"item-title"},mf={class:"item-subtitle"},pf={class:"item-status"},vf={key:0,class:"empty-state"},ff={key:0,class:"detail-content"},gf={class:"detail-header"},_f={class:"remarks"},hf={class:"detail-grid"},yf={class:"val"},bf={class:"detail-grid"},wf={class:"val"},kf={class:"detail-grid"},$f={class:"val highlight"},xf={class:"detail-grid"},Af={class:"action-area"},Cf={key:1,class:"empty-detail"},Sf=ne({__name:"index",setup(s){const l=$(!1),n=$(""),u=$(!1),i=$(null),d=$([]),f=$({}),r=$(null),m=$("password"),g=$({username:"",password:"",captchaCallback:"",token:""}),y=$(!1),L=()=>{p()},A=se(()=>d.value.find(_=>_.proxyId===r.value)||null),P=se(()=>A.value?f.value[A.value.nodeId]||`节点 (${A.value.nodeId})`:"");Ie(()=>{const _=localStorage.getItem("mefrp-user-token");_&&(n.value=_,p())});const w=()=>{const M=(window.screen.width-500)/2,J=(window.screen.height-600)/2;window.open("https://www.mefrp.com/3rdparty/captcha?client=MSLX","MEFrpCaptcha",`width=500,height=600,left=${M},top=${J},resizable=yes,scrollbars=yes,status=no,toolbar=no,menubar=no,location=no`),B.info("请在弹出的独立窗口中完成验证，并将获取到的验证码粘贴到下方")};async function C(){if(!g.value.username||!g.value.password||!g.value.captchaCallback){B.warning("请填写完整的账号、密码和验证码");return}y.value=!0;try{const x=atob(g.value.captchaCallback).split("||");if(x.length!==2)throw new Error("验证码格式错误");const M=await Q.post({url:"/public/login",baseURL:"https://api.mefrp.com/api",data:{username:g.value.username,password:g.value.password,vaptchaToken:x[0],vaptchaServer:x[1]}},{withToken:!1});M&&M.token?(B.success("登录成功"),await k(M.token)):B.error("登录失败：未获取到 Token")}catch(_){B.error("登录异常: "+_.message)}finally{y.value=!1}}async function k(_){const x=_||g.value.token;if(!x){B.warning("请输入Token");return}y.value=!0;try{const M=await Q.get({url:"/auth/user/info",baseURL:"https://api.mefrp.com/api",headers:{Authorization:`Bearer ${x}`}},{withToken:!1});M&&(B.success("Token验证成功"),n.value=x,localStorage.setItem("mefrp-user-token",x),i.value=M,await p())}catch(M){B.error("验证失败: "+M.message)}finally{y.value=!1}}const z=_=>{if(!_||_===0)return"0 B";const x=_*1024,M=1024,J=["B","KB","MB","GB","TB"],W=Math.floor(Math.log(x)/Math.log(M));return parseFloat((x/Math.pow(M,W)).toFixed(2))+" "+J[W]};async function p(){u.value=!0;try{const _=await Q.get({url:"/auth/user/info",baseURL:"https://api.mefrp.com/api",headers:{Authorization:`Bearer ${n.value}`}},{withToken:!1});if(_)i.value=_;else{F();return}const x=await Q.get({url:"/auth/proxy/list",baseURL:"https://api.mefrp.com/api",headers:{Authorization:`Bearer ${n.value}`}},{withToken:!1});if(x){const M={};(x.nodes||[]).forEach(J=>{M[J.nodeId]=J.name}),f.value=M,d.value=x.proxies||[],d.value.length>0&&!r.value&&(r.value=d.value[0].proxyId)}}catch(_){B.error("数据加载失败: "+_.message)}finally{u.value=!1}}const V=$(!1);async function h(){if(A.value){V.value=!0;try{const _=await Q.post({url:"/auth/proxy/config",baseURL:"https://api.mefrp.com/api",data:{proxyId:A.value.proxyId,format:"toml"},headers:{Authorization:`Bearer ${n.value}`}},{withToken:!1});_&&_.config?(await wa(A.value.proxyName,_.config,"ME Frp"),B.success("配置已成功加载")):B.error("获取配置失败")}catch(_){B.error("获取配置失败: "+_.message)}finally{V.value=!1}}}const E=()=>{l.value=!0};function F(){n.value="",i.value=null,d.value=[],r.value=null,localStorage.removeItem("mefrp-user-token"),B.success("已退出登录")}async function R(){await p(),B.success("数据已更新")}const H=()=>{const M=(window.screen.width-800)/2,J=(window.screen.height-600)/2;window.open(`https://www.mefrp.com/3rdparty/sign?client=MSL&&token=${n.value}`,"MEFrpSign",`width=800,height=600,left=${M},top=${J},resizable=yes,scrollbars=yes`),B.info("请在弹出的窗口中完成签到，完成后点击右上角刷新数据")},q=$(!1);async function U(){if(A.value){q.value=!0;try{await Q.post({url:"/auth/proxy/delete",baseURL:"https://api.mefrp.com/api",data:{proxyId:A.value.proxyId},headers:{Authorization:`Bearer ${n.value}`}},{withToken:!1}),B.success("隧道删除成功"),r.value=null,await p()}catch(_){B.error("删除失败: "+_.message)}finally{q.value=!1}}}return(_,x)=>{const M=v("t-tab-panel"),J=v("t-tabs"),W=v("t-input"),X=v("t-form-item"),K=v("t-button"),G=v("t-form"),Le=v("t-loading"),ve=v("t-tag"),Re=v("t-popconfirm"),he=v("t-space"),Se=v("t-col"),Be=v("t-row"),ze=v("t-card"),de=v("t-divider");return o(),S("div",N1,[n.value===""?(o(),S("div",K1,[t("div",q1,[t("div",G1,[e(b(Rt),{size:"56px",style:{color:"var(--td-brand-color)"}})]),x[12]||(x[12]=t("h2",{class:"title"},"登录 ME Frp",-1)),x[13]||(x[13]=t("p",{class:"subtitle"},"选择您的登录方式以接入服务",-1)),e(J,{modelValue:m.value,"onUpdate:modelValue":x[0]||(x[0]=me=>m.value=me),class:"custom-tabs"},{default:a(()=>[e(M,{value:"password",label:"账号密码登录"}),e(M,{value:"token",label:"Token 登录"})]),_:1},8,["modelValue"]),m.value==="password"?(o(),D(G,{key:0,data:g.value,class:"login-form","label-width":"0",onSubmit:C},{default:a(()=>[e(X,{name:"username"},{default:a(()=>[e(W,{modelValue:g.value.username,"onUpdate:modelValue":x[1]||(x[1]=me=>g.value.username=me),size:"large",placeholder:"请输入 ME Frp 账号",clearable:""},{"prefix-icon":a(()=>[e(b(Rt))]),_:1},8,["modelValue"])]),_:1}),e(X,{name:"password"},{default:a(()=>[e(W,{modelValue:g.value.password,"onUpdate:modelValue":x[2]||(x[2]=me=>g.value.password=me),size:"large",type:"password",placeholder:"请输入密码",clearable:""},{"prefix-icon":a(()=>[e(b(Zt))]),_:1},8,["modelValue"])]),_:1}),e(X,{name:"captchaCallback"},{default:a(()=>[e(W,{modelValue:g.value.captchaCallback,"onUpdate:modelValue":x[3]||(x[3]=me=>g.value.captchaCallback=me),size:"large",placeholder:"请粘贴获取到的验证码",clearable:""},{"prefix-icon":a(()=>[e(b(Ls))]),suffix:a(()=>[e(K,{variant:"text",size:"small",theme:"primary",onClick:w},{default:a(()=>[...x[8]||(x[8]=[c(" 获取验证码 ",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t("div",H1,[e(K,{block:"",theme:"primary",type:"submit",size:"large",loading:y.value},{default:a(()=>[...x[9]||(x[9]=[c("立即登录",-1)])]),_:1},8,["loading"])])]),_:1},8,["data"])):(o(),D(G,{key:1,data:g.value,class:"login-form","label-width":"0",onSubmit:x[5]||(x[5]=()=>k())},{default:a(()=>[e(X,{name:"token"},{default:a(()=>[e(W,{modelValue:g.value.token,"onUpdate:modelValue":x[4]||(x[4]=me=>g.value.token=me),size:"large",type:"password",placeholder:"请输入 ME Frp 账户 Token",clearable:""},{"prefix-icon":a(()=>[e(b(Sl))]),_:1},8,["modelValue"])]),_:1}),t("div",J1,[e(K,{block:"",theme:"primary",type:"submit",size:"large",loading:y.value},{default:a(()=>[...x[10]||(x[10]=[c("验证 Token",-1)])]),_:1},8,["loading"])])]),_:1},8,["data"])),t("div",W1,[e(K,{variant:"text",size:"small",onClick:x[6]||(x[6]=me=>b(Me)("https://www.mefrp.com/register"))},{default:a(()=>[...x[11]||(x[11]=[c("还没有账户？注册 ME Frp",-1)])]),_:1})])])])):(o(),S("div",X1,[e(Le,{attach:"#app-space",loading:u.value,text:"加载数据中..."},null,8,["loading"]),e(he,{id:"app-space",direction:"vertical",size:"large",style:{width:"100%"}},{default:a(()=>[i.value?(o(),D(ze,{key:0,bordered:!1,title:"ME Frp 用户信息",class:"info-card"},{actions:a(()=>[e(he,{size:"small"},{default:a(()=>[e(K,{variant:"outline",theme:"primary",size:"small",disabled:i.value.todaySigned,onClick:H},{default:a(()=>[c(I(i.value.todaySigned?"今日已签到":"每日签到"),1)]),_:1},8,["disabled"]),e(ve,{theme:"primary",variant:"light-outline"},{default:a(()=>[c(I(i.value.friendlyGroup),1)]),_:1}),e(Re,{content:"确认退出登录吗？",onConfirm:F},{default:a(()=>[e(K,{variant:"outline",theme:"danger",size:"small"},{default:a(()=>[...x[14]||(x[14]=[c(" 退出登录 ",-1)])]),_:1})]),_:1})]),_:1})]),default:a(()=>[e(Be,{gutter:[16,16]},{default:a(()=>[e(Se,{xs:6,sm:3},{default:a(()=>[t("div",Q1,[x[16]||(x[16]=t("div",{class:"label"},"用户昵称",-1)),t("div",Y1,[c(I(i.value.username)+" ",1),i.value.friendlyGroup!=="未实名"?(o(),D(ve,{key:0,theme:"success",variant:"dark",size:"small"},{default:a(()=>[...x[15]||(x[15]=[c("已实名",-1)])]),_:1})):N("",!0)])])]),_:1}),e(Se,{xs:6,sm:3},{default:a(()=>[t("div",Z1,[x[17]||(x[17]=t("div",{class:"label"},"隧道使用情况",-1)),t("div",ef,I(i.value.usedProxies)+" / "+I(i.value.maxProxies)+" 条",1)])]),_:1}),e(Se,{xs:6,sm:3},{default:a(()=>[t("div",tf,[x[18]||(x[18]=t("div",{class:"label"},"速率限制",-1)),t("div",af,I(i.value.outBound?Math.floor(i.value.outBound/128):0)+" Mbps",1)])]),_:1}),e(Se,{xs:6,sm:3},{default:a(()=>[t("div",sf,[x[19]||(x[19]=t("div",{class:"label"},"剩余流量",-1)),t("div",lf,I(z(i.value.traffic)),1)])]),_:1})]),_:1})]),_:1})):N("",!0),e(Be,{gutter:[16,16]},{default:a(()=>[e(Se,{xs:12,md:5,lg:4},{default:a(()=>[e(ze,{bordered:!1,class:"full-height-card"},{title:a(()=>[t("div",nf,[x[22]||(x[22]=t("span",null,"我的隧道",-1)),e(he,{size:"4px"},{default:a(()=>[e(K,{size:"small",variant:"text",loading:u.value,onClick:R},{icon:a(()=>[e(b(Ze))]),default:a(()=>[x[20]||(x[20]=c("刷新 ",-1))]),_:1},8,["loading"]),e(K,{size:"small",variant:"text",onClick:E},{icon:a(()=>[e(b(vt))]),default:a(()=>[x[21]||(x[21]=c("新建 ",-1))]),_:1})]),_:1})])]),default:a(()=>[t("div",of,[(o(!0),S(ce,null,fe(d.value,me=>(o(),S("div",{key:me.proxyId,class:$e(["tunnel-item",{active:r.value===me.proxyId}]),onClick:Ee=>r.value=me.proxyId},[t("div",uf,[e(b($t))]),t("div",df,[t("div",cf,I(me.proxyName),1),t("div",mf,I(f.value[me.nodeId]||`Node ${me.nodeId}`),1)]),t("div",pf,[me.isOnline?(o(),D(ve,{key:0,theme:"success",variant:"light",size:"small"},{default:a(()=>[...x[23]||(x[23]=[c("在线",-1)])]),_:1})):(o(),D(ve,{key:1,theme:"default",variant:"light",size:"small"},{default:a(()=>[...x[24]||(x[24]=[c("离线",-1)])]),_:1}))])],10,rf))),128)),d.value.length===0?(o(),S("div",vf,"暂无隧道")):N("",!0)])]),_:1})]),_:1}),e(Se,{xs:12,md:7,lg:8},{default:a(()=>[e(ze,{bordered:!1,class:"full-height-card"},{title:a(()=>[...x[25]||(x[25]=[t("span",null,"隧道详情",-1)])]),actions:a(()=>[A.value?(o(),D(Re,{key:0,content:"确认删除此隧道吗？",theme:"danger",placement:"bottom-right",onConfirm:U},{default:a(()=>[e(K,{theme:"danger",variant:"text",loading:q.value},{default:a(()=>[...x[26]||(x[26]=[c(" 删除隧道 ",-1)])]),_:1},8,["loading"])]),_:1})):N("",!0)]),default:a(()=>[A.value?(o(),S("div",ff,[t("div",gf,[t("h3",null,I(A.value.proxyName),1),t("p",_f,"隧道 ID: "+I(A.value.proxyId),1)]),e(de),e(Be,{gutter:[24,24]},{default:a(()=>[e(Se,{span:6},{default:a(()=>[t("div",hf,[x[27]||(x[27]=t("span",{class:"label"},"所在节点",-1)),t("span",yf,I(P.value),1)])]),_:1}),e(Se,{span:6},{default:a(()=>[t("div",bf,[x[28]||(x[28]=t("span",{class:"label"},"本地地址",-1)),t("span",wf,I(A.value.localIp)+":"+I(A.value.localPort),1)])]),_:1}),e(Se,{span:6},{default:a(()=>[t("div",kf,[x[29]||(x[29]=t("span",{class:"label"},"远程端口",-1)),t("span",$f,I(A.value.remotePort),1)])]),_:1}),e(Se,{span:6},{default:a(()=>[t("div",xf,[x[30]||(x[30]=t("span",{class:"label"},"当前状态",-1)),t("span",{class:"val",style:nt({color:A.value.isOnline?"var(--td-success-color)":""})},I(A.value.isOnline?"节点在线":"离线"),5)])]),_:1})]),_:1}),e(de),t("div",Af,[e(K,{theme:"primary",size:"large",loading:V.value,block:"",onClick:h},{icon:a(()=>[e(b(Ot))]),default:a(()=>[x[31]||(x[31]=c(" 启动此隧道映射 ",-1))]),_:1},8,["loading"])])])):(o(),S("div",Cf,[e(b(Ut),{size:"48px",style:{color:"var(--td-text-color-disabled)"}}),x[32]||(x[32]=t("p",null,"请在左侧选择一个隧道查看详情",-1))]))]),_:1})]),_:1})]),_:1})]),_:1})])),l.value?(o(),D(j1,{key:2,visible:l.value,"onUpdate:visible":x[7]||(x[7]=me=>l.value=me),token:n.value,onSuccess:L},null,8,["visible","token"])):N("",!0)])}}}),If=ue(Sf,[["__scopeId","data-v-43fd4708"]]),Vf=ne({__name:"index",setup(s){const l=$(1);return(n,u)=>{const i=v("t-tab-panel"),d=v("t-tabs"),f=v("t-card");return o(),S("div",null,[e(f,{direction:"vertical"},{default:a(()=>[e(d,{modelValue:l.value,"onUpdate:modelValue":u[0]||(u[0]=r=>l.value=r)},{default:a(()=>[e(i,{value:1,label:"MSLFrp","destroy-on-hide":!1},{default:a(()=>[e(S1,{style:{margin:"15px"}})]),_:1}),e(i,{value:2,label:"MSL 联机","destroy-on-hide":!1},{default:a(()=>[e(P1,{style:{margin:"15px"}})]),_:1}),e(i,{value:3,label:"ME Frp","destroy-on-hide":!1},{default:a(()=>[e(If,{style:{margin:"15px"}})]),_:1}),e(i,{value:888,label:"自定义配置","destroy-on-hide":!1},{default:a(()=>[e(cv,{style:{margin:"15px"}})]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}}),Mf=Object.freeze(Object.defineProperty({__proto__:null,default:Vf},Symbol.toStringTag,{value:"Module"})),Uf={class:"terminal-header"},Lf={class:"tab-title"},Bf=ne({__name:"ConsoleTerminal",props:{frpId:{}},emits:["update"],setup(s,{expose:l,emit:n}){const u=s,i=n,d=Fe(),f=$(null),r=$(null);let m=null,g=null,y=null,L=null,A=null;const P={dark:{background:"transparent",foreground:"#cccccc",cursor:"transparent",selectionBackground:"#264f78",black:"#000000",red:"#cd3131",green:"#0dbc79",yellow:"#e5e510",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"},light:{background:"transparent",foreground:"#333333",cursor:"transparent",selectionBackground:"#add6ff",black:"#000000",red:"#cd3131",green:"#00bc79",yellow:"#9d9d10",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#aeae11",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"}};pe.enabled=!0;const w=F=>F?(F=F.replace(/^(\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2}(\.\d{3})?)/,R=>pe.gray(R)),F=F.replace(/\[I\]/g,pe.green("[I]")),F=F.replace(/\[W\]/g,pe.yellow("[W]")),F=F.replace(/\[E\]/g,pe.red("[E]")),F=F.replace(/(success)/gi,R=>pe.bold.green(R)),F=F.replace(/(start|starting)/gi,R=>pe.blue(R)),F=F.replace(/(failed|error)/gi,R=>pe.bgRed.white(` ${R} `)),F=F.replace(/(:\d{4,5})/g,R=>pe.cyan(R)),F=F.replace(/(\[[0-9a-f]{8,}\])/g,R=>pe.magenta(R)),F):"",C=()=>{if(!r.value||!f.value)return;if(m){m.clear(),z();return}const F=document.documentElement.getAttribute("theme-mode")==="dark";m=new Ks({cursorBlink:!1,cursorStyle:"bar",fontSize:14,fontFamily:'"Maple Mono", "Maple Mono CN", "Cascadia Code", Consolas, Menlo, "PingFang SC", "Microsoft YaHei", monospace',lineHeight:1.4,theme:F?P.dark:P.light,allowTransparency:!0,disableStdin:!0,convertEol:!0}),g=new qs,m.loadAddon(g),m.open(r.value);const R=()=>{if(r.value&&r.value.clientWidth>0&&r.value.clientHeight>0)try{g?.fit(),m?.scrollToBottom()}catch(H){console.warn(H)}};y=new ResizeObserver(()=>window.requestAnimationFrame(R)),y.observe(f.value),setTimeout(R,100),z()},k=()=>{if(!m)return;const F=document.documentElement.getAttribute("theme-mode")==="dark";m.options.theme=F?P.dark:P.light},z=()=>{m?.writeln("\x1B[1;34m[System]\x1B[0m 正在初始化Frp控制台 ..."),m?.writeln(`\x1B[1;34m[System]\x1B[0m ID: ${u.frpId} | 状态: \x1B[32m已就绪！\x1B[0m`)},p=async()=>{if(A)try{await A.stop(),A=null}catch(F){console.error(F)}},V=async()=>{if(await p(),!u.frpId)return;const{baseUrl:F,token:R}=d,H=new URL("/api/hubs/frpLogsHub",F||window.location.origin);R&&H.searchParams.append("x-user-token",R),A=new Lt().withUrl(H.toString(),{withCredentials:!1}).configureLogging(Ft.Warning).withAutomaticReconnect([0,2e3,5e3,1e4,3e4]).build(),A.on("ReceiveLog",q=>{m?.writeln(w(q)),q.includes("[MSLX]")&&setTimeout(()=>{i("update")},2e3)}),A.onreconnecting(q=>{m?.writeln("\x1B[1;33m[System] 检测到连接中断，正在尝试重连...\x1B[0m"),console.warn("SignalR Reconnecting:",q)}),A.onreconnected(async()=>{m?.writeln("\x1B[1;32m[System] 网络已恢复，重新连接日志服务...\x1B[0m");try{await A?.invoke("JoinGroup",u.frpId),m?.writeln("\x1B[1;32m[System] 日志服务成功重新连接！\x1B[0m")}catch(q){m?.writeln(`\x1B[1;31m[Error] 重新连接日志服务失败: ${q.message}\x1B[0m`)}}),A.onclose(q=>{q&&(m?.writeln(`\x1B[1;31m[System] 日志服务连接已断开: ${q.message}\x1B[0m`),m?.writeln("\x1B[1;31m[System] 请刷新页面或检查网络连接。\x1B[0m"))});try{await A.start(),m?.writeln("\x1B[1;32m[System] 成功连接到Frpc日志服务\x1B[0m"),await A.invoke("JoinGroup",u.frpId)}catch(q){m?.writeln(`\x1B[1;31m[Error] 连接失败: ${q.message}\x1B[0m`)}};return l({writeln:F=>m?.writeln(F),clear:()=>{m?.clear(),z()}}),be(()=>u.frpId,async F=>{F&&(C(),await V())}),Ie(async()=>{await kt(),C(),L=new MutationObserver(k),L.observe(document.documentElement,{attributes:!0,attributeFilter:["theme-mode"]}),u.frpId&&await V()}),Qe(async()=>{L?.disconnect(),await p(),m?.dispose(),y?.disconnect()}),(F,R)=>(o(),S("div",{ref_key:"terminalWrapper",ref:f,class:"terminal-wrapper"},[t("div",Uf,[R[0]||(R[0]=t("div",{class:"dots"},[t("span",{class:"dot red"}),t("span",{class:"dot yellow"}),t("span",{class:"dot green"})],-1)),t("div",Lf,"MSLX - Frp 控制台 | "+I(s.frpId),1)]),t("div",{ref_key:"terminalBody",ref:r,class:"terminal-body"},null,512)],512))}}),zf=ue(Bf,[["__scopeId","data-v-71df361d"]]),ia=(s,l=!0,n="复制成功")=>new Promise((u,i)=>{navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(s).then(()=>{l&&B.success(n),u()}).catch(()=>{hs(s,l,n,u,i)}):hs(s,l,n,u,i)});function hs(s,l,n,u,i){try{const d=document.createElement("textarea");d.value=s,d.style.top="0",d.style.left="0",d.style.position="fixed",document.body.appendChild(d),d.focus(),d.select();const f=document.execCommand("copy");document.body.removeChild(d),f?(l&&B.success(n),u()):(l&&B.error("复制失败"),i(new Error("execCommand returned false")))}catch(d){l&&B.error("复制出错"),i(d)}}const Pf={class:"sidebar-content"},Rf={class:"control-header"},Ef={class:"control-actions"},Tf={class:"action-row"},Ff={class:"info-list"},Df={class:"info-item"},Of={class:"label"},jf={class:"value"},Nf={key:0,class:"proxy-header"},Kf={class:"info-item"},qf={class:"label"},Gf=["onClick"],Hf={class:"info-item"},Jf={class:"label"},Wf={class:"value highlight"},Xf={class:"info-item"},Qf={class:"label"},Yf=["onClick"],Zf={key:1,class:"info-item"},eg={class:"label"},tg=["onClick"],ag={class:"info-item"},sg={class:"label"},lg={class:"value"},ng={key:1,class:"info-item empty-state"},og={class:"value"},ig=ne({__name:"ControlPanel",props:{frpId:{},isRunning:{type:Boolean},loading:{type:Boolean},tunnelInfo:{}},emits:["start","stop","clear-log","edit-config"],setup(s){return(l,n)=>{const u=v("t-tag"),i=v("t-button"),d=v("t-card"),f=v("t-tooltip");return o(),S("div",Pf,[e(d,{class:"control-card",bordered:!1},{default:a(()=>[t("div",Rf,[t("div",{class:$e(["status-indicator",{running:s.isRunning}])},[n[4]||(n[4]=t("span",{class:"pulse"},null,-1)),c(I(s.isRunning?"Running":"Stopped"),1)],2),e(u,{theme:s.isRunning?"success":"default",variant:"light",shape:"round"},{default:a(()=>[c(I(s.isRunning?"正常运行":"未运行"),1)]),_:1},8,["theme"])]),t("div",Ef,[s.isRunning?(o(),D(i,{key:1,theme:"danger",size:"large",block:"",loading:s.loading,onClick:n[1]||(n[1]=r=>l.$emit("stop"))},{icon:a(()=>[e(b(pa))]),default:a(()=>[n[6]||(n[6]=c("停止服务 ",-1))]),_:1},8,["loading"])):(o(),D(i,{key:0,theme:"primary",size:"large",block:"",loading:s.loading,onClick:n[0]||(n[0]=r=>l.$emit("start"))},{icon:a(()=>[e(b(Ot))]),default:a(()=>[n[5]||(n[5]=c("启动服务 ",-1))]),_:1},8,["loading"])),t("div",Tf,[e(i,{class:"glass-btn",variant:"outline",theme:"warning",onClick:n[2]||(n[2]=r=>l.$emit("clear-log"))},{icon:a(()=>[e(b(Ze))]),default:a(()=>[n[7]||(n[7]=c("清空日志 ",-1))]),_:1}),e(i,{variant:"outline",theme:"default",onClick:n[3]||(n[3]=r=>l.$emit("edit-config"))},{icon:a(()=>[e(b(Il))]),default:a(()=>[n[8]||(n[8]=c("配置文件 ",-1))]),_:1})])])]),_:1}),e(d,{title:"隧道概览",class:"info-card",bordered:!1},{actions:a(()=>[s.tunnelInfo&&s.tunnelInfo.proxies&&s.tunnelInfo.proxies.length>0&&s.tunnelInfo.proxies.some(r=>r.type==="xtcp")?(o(),D(u,{key:0,variant:"light-outline",theme:"primary"},{default:a(()=>[...n[9]||(n[9]=[c("联机房间 - 房主",-1)])]),_:1})):s.tunnelInfo&&s.tunnelInfo.proxies&&s.tunnelInfo.proxies.length>0&&s.tunnelInfo.proxies.some(r=>r.type==="xtcp - Visitors")?(o(),D(u,{key:1,variant:"light-outline",theme:"primary"},{default:a(()=>[...n[10]||(n[10]=[c("联机房间 - 访客",-1)])]),_:1})):(o(),D(i,{key:2,shape:"circle",variant:"text"},{default:a(()=>[e(b(Et))]),_:1}))]),default:a(()=>[t("div",Ff,[t("div",Df,[t("div",Of,[e(b($t)),n[11]||(n[11]=c(" 隧道实例 ID",-1))]),t("div",jf,"#"+I(s.frpId),1)]),s.tunnelInfo&&s.tunnelInfo.proxies&&s.tunnelInfo.proxies.length>0?(o(!0),S(ce,{key:0},fe(s.tunnelInfo.proxies,(r,m)=>(o(),S("div",{key:m,class:"proxy-group"},[s.tunnelInfo.proxies.length>1?(o(),S("div",Nf,"配置 #"+I(m+1),1)):N("",!0),t("div",Kf,[t("div",qf,[e(b(Ut)),c(" "+I(r.type.includes("xtcp")?"房间号":"隧道名称"),1)]),e(f,{content:r.proxyName,placement:"top","show-arrow":"","destroy-on-close":""},{default:a(()=>[t("div",{onClick:g=>b(ia)(r.proxyName,!0,`${r.type.includes("xtcp")?"房间号":"隧道名称"}已复制！`),class:"value remote-addr pointer"},I(r.proxyName),9,Gf)]),_:2},1032,["content"])]),t("div",Hf,[t("div",Jf,[e(b(Vs)),n[12]||(n[12]=c(" 协议类型",-1))]),t("div",Wf,I(r.type.toUpperCase()),1)]),t("div",Xf,[t("div",Qf,[e(b(Mt)),c(" "+I(r.type.includes("xtcp")?"房间密钥":"连接地址"),1)]),e(f,{content:r.remoteAddressMain,placement:"top","show-arrow":"","destroy-on-close":""},{default:a(()=>[t("div",{class:"value remote-addr pointer",onClick:g=>b(ia)(r.remoteAddressMain,!0,`${r.type.includes("xtcp")?"房间密钥":"连接地址"}已复制！`)},I(r.remoteAddressMain||"获取中..."),9,Yf)]),_:2},1032,["content"])]),r.remoteAddressBackup&&r.remoteAddressBackup!==r.remoteAddressMain?(o(),S("div",Zf,[t("div",eg,[e(b(Mt)),n[13]||(n[13]=c(" 备用地址",-1))]),e(f,{content:r.remoteAddressBackup,placement:"top","show-arrow":"","destroy-on-close":""},{default:a(()=>[t("div",{class:"value remote-addr pointer",onClick:g=>b(ia)(r.remoteAddressBackup,!0,"备用连接地址已复制！")},I(r.remoteAddressBackup),9,tg)]),_:2},1032,["content"])])):N("",!0),t("div",ag,[t("div",sg,[e(b(Et)),n[14]||(n[14]=c(" 本地地址",-1))]),t("div",lg,I(r.localAddress),1)])]))),128)):(o(),S("div",ng,[n[15]||(n[15]=t("div",{class:"label"},"状态",-1)),t("div",og,I(s.loading?"正在加载配置...":"暂无详细信息"),1)]))])]),_:1})])}}}),rg=ue(ig,[["__scopeId","data-v-3a2669c8"]]),ug={class:"editor-container"},dg={class:"editor-status-bar"},cg={class:"mode-tag"},mg={class:"dialog-footer"},pg={class:"footer-left"},vg={class:"footer-right"},fg=ne({__name:"FileEditor",props:{visible:Boolean,fileName:String,content:String,loading:Boolean},emits:["update:visible","save"],setup(s,{emit:l}){const n=s,u=l,i=async()=>{if(!d.value)return;const A=n.fileName?.split(".").pop()?.toLowerCase();let P="",w=[];switch(A){case"json":P="json",w=[as,ss];break;case"yml":case"yaml":P="yaml",w=[Cn];break;case"js":case"ts":P="babel",w=[as,ss];break;case"css":case"less":case"scss":P="css",w=[An];break;case"html":case"xml":P="html",w=[xn];break;default:B.warning("该文件类型暂不支持自动格式化");return}try{const C=await $n.format(d.value,{parser:P,plugins:w,tabWidth:2,printWidth:80,semi:!0,singleQuote:!0});d.value=C,B.success("格式化成功")}catch(C){console.error(C),B.error(`格式化失败: 请检查语法错误
${C.message.split(`
`)[0]}`)}},d=$(""),f=$(!1);let r=null;const m=()=>{const A=document.documentElement.getAttribute("theme-mode");f.value=A==="dark"};Ie(()=>{m(),r=new MutationObserver(m),r.observe(document.documentElement,{attributes:!0,attributeFilter:["theme-mode"]})}),Qe(()=>{r?.disconnect()}),be(()=>n.content,A=>{d.value=A||""},{immediate:!0});const g=se(()=>{const A=[];switch(f.value&&A.push(vn),A.push(fn.phrases.of({Find:"查找内容...",Replace:"替换为...",next:"下一个",previous:"上一个",all:"选中所有","match case":"区分大小写","by word":"全字匹配",regexp:"正则表达式",replace:"替换","replace all":"替换全部",close:"关闭"})),n.fileName?.split(".").pop()?.toLowerCase()){case"json":A.push(kn());break;case"yml":case"yaml":A.push(wn());break;case"js":case"ts":A.push(bn());break;case"css":case"less":case"scss":A.push(yn());break;case"html":case"xml":A.push(hn());break;case"toml":case"ini":case"conf":A.push(gn.define(_n));break}return A}),y=()=>{u("update:visible",!1)},L=()=>{u("save",d.value)};return(A,P)=>{const w=v("t-button"),C=v("t-dialog");return o(),D(C,{visible:s.visible,header:`正在编辑: ${s.fileName}`,width:"90%",attach:"body",top:"1vh",class:"editor-dialog",onClose:y},{footer:a(()=>[t("div",mg,[t("div",pg,[e(w,{variant:"outline",theme:"default",onClick:i},{default:a(()=>[...P[1]||(P[1]=[c(" 自动格式化 ",-1)])]),_:1})]),t("div",vg,[e(w,{variant:"outline",onClick:y},{default:a(()=>[...P[2]||(P[2]=[c("取消",-1)])]),_:1}),e(w,{theme:"primary",loading:n.loading,onClick:L},{default:a(()=>[...P[3]||(P[3]=[c(" 保存 ",-1)])]),_:1},8,["loading"])])])]),default:a(()=>[t("div",ug,[e(b(Vl),{modelValue:d.value,"onUpdate:modelValue":P[0]||(P[0]=k=>d.value=k),placeholder:"文件内容为空...",style:{height:"70vh",fontSize:"14px"},autofocus:!0,"indent-with-tab":!0,"tab-size":2,extensions:g.value},null,8,["modelValue","extensions"])]),t("div",dg,[t("span",null,"行数: "+I(d.value.split(`
`).length),1),t("span",null,"长度: "+I(d.value.length),1),t("span",cg,I(f.value?"Dark Mode":"Light Mode"),1)])]),_:1},8,["visible","header"])}}}),el=ue(fg,[["__scopeId","data-v-8c0385d1"]]),gg={class:"console-page"},_g={class:"layout-container"},hg={class:"main-terminal-area"},yg={class:"sidebar-area"},bg=ne({__name:"index",setup(s){const l=Za(),n=et(),u=$(parseInt(n.params.frpId)||0),i=$(!1),d=$(!1),f=$(null),r=$(!1),m=$(""),g=$(""),y=$(!1),L=$(null);async function A(){if(u.value)try{f.value=await Tp(u.value),i.value=f.value.isRunning,await l.getTunnels()}catch(V){console.error("获取隧道信息失败",V),L.value?.writeln(`\x1B[1;31m[Error] 获取隧道信息失败: ${V}\x1B[0m`)}}const P=async()=>{d.value=!0;try{L.value?.writeln("\x1B[1;32m[System] 正在发送启动指令...\x1B[0m"),await _s("start",u.value),i.value=!0,B.success("启动指令已发送"),setTimeout(A,1500),L.value?.writeln("\x1B[1;35m\x1B[1m[TIPS] 注意：日志可能包含您的在线服务商的Token信息，若需要截图，请将关键信息打码处理！\x1B[0m")}catch(V){L.value?.writeln(`\x1B[1;31m[Error] Frpc启动失败: ${V.message}\x1B[0m`)}finally{d.value=!1}},w=async()=>{d.value=!0;try{L.value?.writeln("\x1B[1;32m[System] 正在发送停止指令...\x1B[0m"),await _s("stop",u.value),i.value=!1,B.warning("停止指令已发送"),setTimeout(A,1e3)}catch(V){L.value?.writeln(`\x1B[1;31m[Error] Frpc停止失败: ${V.message}\x1B[0m`)}finally{d.value=!1}},C=()=>{L.value?.clear()},k=()=>{const V=st.confirm({header:"警告",body:`直接编辑配置文件可能会导致服务无法启动或异常。正常情况在线服务商提供的配置文件也不能修改。请确保您了解配置文件的格式和内容。

是否继续？`,theme:"warning",onConfirm:async()=>{V.hide(),await z()}})},z=async()=>{const V=B.loading("正在读取配置文件...");try{let h="toml";const E=l.frpList.find(q=>q.id===u.value);E&&E.configType&&(h=E.configType.toLowerCase());const F=`frpc.${h}`,R=`${u.value}/${F}`,H=await ha(0,R);m.value=F,g.value=H,r.value=!0,B.close(V)}catch(h){B.close(V),B.error("读取配置文件失败: "+h.message),L.value?.writeln(`\x1B[1;31m[Error] 读取配置文件失败: ${h.message}\x1B[0m`)}},p=async V=>{y.value=!0;try{const h=`${u.value}/${m.value}`;await Ha(0,h,V),B.success("配置文件保存成功"),r.value=!1,L.value?.writeln("\x1B[1;32m[System] 配置文件已更新，请重启服务以生效。\x1B[0m")}catch(h){B.error("保存失败"),L.value?.writeln(`\x1B[1;31m[Error] 保存失败: ${h.message}\x1B[0m`)}finally{y.value=!1}};return be(()=>n.params.frpId,async V=>{n.name==="FrpConsole"&&V&&(u.value=parseInt(V),await A())}),Ie(()=>{u.value&&A()}),(V,h)=>(o(),S("div",gg,[t("div",_g,[t("div",hg,[e(zf,{ref_key:"terminalRef",ref:L,"frp-id":u.value,onUpdate:h[0]||(h[0]=E=>A())},null,8,["frp-id"])]),t("div",yg,[e(rg,{"frp-id":u.value,"is-running":i.value,loading:d.value,"tunnel-info":f.value,onStart:P,onStop:w,onClearLog:C,onEditConfig:k},null,8,["frp-id","is-running","loading","tunnel-info"])])]),e(el,{visible:r.value,"onUpdate:visible":h[1]||(h[1]=E=>r.value=E),"file-name":m.value,content:g.value,loading:y.value,onSave:p},null,8,["visible","file-name","content","loading"])]))}}),wg=ue(bg,[["__scopeId","data-v-d01d4c2c"]]),kg=Object.freeze(Object.defineProperty({__proto__:null,default:wg},Symbol.toStringTag,{value:"Module"})),la=xt("instanceHub",()=>{const s=Fe(),l=$(null),n=$(!1),u=$(null),i=$(0),d=$(0);let f=Promise.resolve();const r=$({cpu:0,memBytes:0,memPercent:0}),m=new Set,g=new Set,y=new Set,L=new Set,A=new Set,P=new Set,w=q=>{d.value=q},C=q=>(f=f.then(async()=>{if(i.value++,l.value?.state==="Connected"&&u.value===q)return;l.value&&await z(),u.value=q,d.value=0;const{baseUrl:U,token:_}=s,x=new URL("/api/hubs/instanceControlHub",U||window.location.origin);_&&x.searchParams.append("x-user-token",_);const M=new Lt().withUrl(x.toString(),{withCredentials:!1}).configureLogging(Ft.Warning).withAutomaticReconnect([0,2e3,5e3,1e4]).build();M.on("ReceiveLog",J=>{m.forEach(W=>W(J))}),M.on("RequireEULA",()=>{g.forEach(J=>J())}),M.on("CommandResult",(J,W)=>{y.forEach(X=>X(J,W))}),M.on("ReceiveStatus",(J,W,X)=>{if(String(J)!==String(q))return;let K=0;if(d.value>0){const G=d.value*1024*1024;K=X/G*100,K>100&&(K=100)}r.value={cpu:W,memBytes:X,memPercent:K}}),M.on("PlayerJoined",(J,W)=>{String(J)===String(q)&&L.forEach(X=>X(W))}),M.on("PlayerLeft",(J,W)=>{String(J)===String(q)&&A.forEach(X=>X(W))}),M.on("PlayerListCleared",J=>{String(J)===String(q)&&P.forEach(W=>W())}),M.onreconnecting(()=>m.forEach(J=>J("\x1B[1;31m[System] 连接中断，尝试重连...\x1B[0m"))),M.onreconnected(async()=>{m.forEach(J=>J("\x1B[1;32m[System] 网络恢复，重新加入会话...\x1B[0m"));try{await M.invoke("JoinGroup",q)}catch(J){console.error(J)}});try{await M.start(),await M.invoke("JoinGroup",q),l.value=M,n.value=!0,m.forEach(J=>J("\x1B[1;32m[System] 已连接到实例控制服务\x1B[0m"))}catch(J){n.value=!1,m.forEach(W=>W(`\x1B[1;31m[Error] 连接失败: ${J.message}\x1B[0m`)),u.value=null,l.value=null}}),f),k=()=>(f=f.then(async()=>{i.value>0&&i.value--,i.value===0&&await z()}),f),z=async()=>{if(l.value)try{l.value.state==="Connected"&&u.value&&await l.value.invoke("LeaveGroup",u.value),await l.value.stop()}catch(q){console.warn(q)}l.value=null,n.value=!1,u.value=null,d.value=0,r.value={cpu:0,memBytes:0,memPercent:0}};return{isConnected:n,stats:r,currentServerId:u,connect:C,disconnect:k,setMaxMemory:w,sendCommand:async q=>{if(!l.value||l.value.state!=="Connected"||!u.value)throw new Error("未连接到服务");await l.value.invoke("SendCommand",u.value,q)},onLog:q=>(m.add(q),()=>m.delete(q)),onEula:q=>(g.add(q),()=>m.delete(q)),onCommandResult:q=>(y.add(q),()=>y.delete(q)),onPlayerJoined:q=>(L.add(q),()=>L.delete(q)),onPlayerLeft:q=>(A.add(q),()=>A.delete(q)),onPlayerListCleared:q=>(P.add(q),()=>P.delete(q))}}),$g=jt();pe.enabled=!0;const xg=(s,l=-1)=>s?(l===-1&&(l=$g.settings.webPanelColorizeLogLevel),l===0?s:(s=s.replace(/\n/g,`\r
`),s.includes("Done")&&s.includes("!")&&(s=s.replace(/Done \((.*?)\)!/g,(n,u)=>`${pe.green.bold("Done")} (${pe.blue(u)})!`)),s=s.replace(/\b(Server started|Starting Server)\b/g,n=>pe.green.bold(n)),s=s.replace(/\b(IPv4 supported|IPv6 supported)\b/g,n=>pe.cyan(n)),s.startsWith("[System]")&&(s=s.replace(/^\[System]/,`[${pe.blue.bold("System")}]`)),s.includes("[MSLX]")&&(s=s.replace(/\[MSLX]/g,`[${pe.magenta.bold("MSLX")}]`)),s.includes("[MSLX-Backup]")&&(s=s.replace(/\[MSLX-Backup]/g,`[${pe.magenta.bold("MSLX-Backup")}]`)),s.includes("[MSLX-Daemon]")&&(s=s.replace(/\[MSLX-Daemon]/g,`[${pe.magenta.bold("MSLX-Daemon")}]`)),s.startsWith(">>>")&&(s=s.replace(/^>>>/,pe.red.bold(">>>"))),l===1?(s=s.replace(/^\[[^\]]+\s+(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]/,(u,i)=>{switch(i){case"INFO":return pe.green(u);case"WARN":case"WARNING":return pe.yellow(u);case"ERROR":case"FATAL":return pe.red(u);case"DEBUG":return pe.blue(u);default:return u}}),s=s.replace(/^\[\d{2}:\d{2}:\d{2}\]\s+\[[^/]+\/(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]/,(u,i)=>{switch(i){case"INFO":return pe.green(u);case"WARN":case"WARNING":return pe.yellow(u);case"ERROR":case"FATAL":return pe.red(u);default:return u}}),(u=>{const i=/\u001b\[(0;)?31m/.test(u),d=/\b(ERROR|Exception|Caused by|at)\b/i.test(u);return i||d})(s)||(s=s.replace(new RegExp("(?<=:\\s|^)\\s*([([][a-zA-Z0-9_\\-.\\s]+[)\\]])(?=\\s)","g"),u=>pe.cyan(u))),s):/\u001b\[[\d;]*m/.test(s)?(s=s.replace(/(https?:\/\/[^\s]+)/g,n=>pe.blue.underline(n)),s):(s=s.replace(/^\[(\d{2}:\d{2}:\d{2})\s+(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]:/,(n,u,i)=>{let d=i;switch(i){case"INFO":d=pe.green("INFO");break;case"WARN":case"WARNING":d=pe.yellow.bold("WARN");break;case"ERROR":case"FATAL":d=pe.red.bold(i);break;case"DEBUG":d=pe.blue("DEBUG");break}return`[${pe.gray(u)} ${d}]:`}),/^\[\d{2}:\d{2}:\d{2}\]/.test(s)&&(s=s.replace(/^\[(\d{2}:\d{2}:\d{2})\]/,(n,u)=>`[${pe.gray(u)}]`)),s=s.replace(/\[([^/]+)\/(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]/g,(n,u,i)=>{const d=pe.blue(u);let f=i;switch(i){case"INFO":f=pe.green("INFO");break;case"WARN":f=pe.yellow("WARN");break;case"ERROR":f=pe.red.bold("ERROR");break}return`[${d}/${f}]`}),s=s.replace(new RegExp("(?<=:\\s|^)\\s*\\[([a-zA-Z0-9_\\-.\\s]+)\\](?=\\s)","g"),(n,u)=>u==="System"||u.includes("MSLX")?n:` [${pe.bold.black(u)}]`),s=s.replace(/(https?:\/\/[^\s]+)/g,n=>pe.blue.underline(n)),s=s.replace(new RegExp("\\b\\d+\\.\\d+[\\w.+\\-@]*(?<!ms|s|MB|GB|KB|%)\\b","g"),n=>pe.magenta(n)),s=s.replace(/\b\d+(\.\d+)?\s?(ms|s|%|MB|GB|KB)\b/gi,n=>pe.blue(n)),s=s.replace(new RegExp("(\\u001b\\[[\\d;]*m)|((?<!\\d:\\d)(?<![.\\-+])\\b\\d+\\b(?![.\\-+])(?!\\s*:\\s*\\d))","g"),(n,u,i)=>{if(u)return n;if(i){if(i.length>=4&&i.length<=6)return pe.blue(i);if(i.length<=3)return pe.blue(i)}return n}),s=s.replace(/(\*:\d{1,5})/,n=>pe.blue.bold(n)),s=s.replace(/\b(Loaded|Saved|Starting|Started|Connected)\b/g,n=>pe.green(n)),s=s.replace(/\bDone\b(?!\u001b)/g,pe.green.bold("Done")),s=s.replace(/\b(Failed|Exception|Error|Caused by|Stopping|Closed)\b/g,n=>pe.red.bold(n)),s=s.replace(/\b(Loading|Preparing|Generating|Saving|Using|Running)\b/g,n=>pe.magenta(n)),s=s.replace(/\b(Minecraft|Paper|Velocity|Java)\b/gi,n=>pe.bold.black(n)),s=s.replace(/'minecraft:[a-z_]+'/g,n=>pe.magenta(n)),s))):"",Ag={class:"terminal-header"},Cg={class:"tab-title"},Sg={class:"terminal-footer"},Ig=ne({__name:"ServerTerminal",props:{serverId:{}},emits:["update"],setup(s,{expose:l,emit:n}){const u=s,i=n,d=la(),f=$(null),r=$(null);let m=null,g=null,y=null,L=null,A=null,P=null,w="";const C=$(""),k={dark:{background:"transparent",foreground:"#cccccc",cursor:"#cccccc",selectionBackground:"#264f78",black:"#000000",red:"#cd3131",green:"#0dbc79",yellow:"#e5e510",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"},light:{background:"transparent",foreground:"#333333",cursor:"#333333",selectionBackground:"#add6ff",black:"#000000",red:"#cd3131",green:"#00bc79",yellow:"#9d9d10",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f3d61a",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"}};pe.enabled=!0;const z=x=>xg(x),p=()=>{if(!r.value||!f.value)return;if(m){m.clear(),R();return}const x=document.documentElement.getAttribute("theme-mode")==="dark";m=new Ks({cursorBlink:!1,cursorStyle:"bar",fontSize:14,fontFamily:'"Maple Mono", "Maple Mono CN", "Cascadia Code", Consolas, Menlo, "PingFang SC", "Microsoft YaHei", monospace',lineHeight:1.4,theme:x?k.dark:k.light,allowTransparency:!0,convertEol:!0}),g=new qs,m.loadAddon(g),m.open(r.value),m.onData(J=>V(J));const M=()=>{if(r.value&&r.value.clientWidth>0&&r.value.clientHeight>0)try{g?.fit()}catch(J){console.warn(J)}};y=new ResizeObserver(()=>window.requestAnimationFrame(M)),y.observe(f.value),setTimeout(M,100),R()},V=async x=>{!m||!u.serverId||(x==="\r"?(m.write(`\r
`),w.trim()&&await E(w),w=""):x===""?w.length>0&&(w=w.slice(0,-1),m.write("\b \b")):x>=" "&&(w+=x,m.write(x)))},h=async()=>{if(!C.value)return;const x=C.value;m?.writeln(x),await E(x),C.value=""},E=async x=>{try{await d.sendCommand(x)}catch(M){m?.writeln(`\x1B[1;31m[Error] ${M.message}\x1B[0m`)}},F=()=>{if(!m)return;const x=document.documentElement.getAttribute("theme-mode")==="dark";m.options.theme=x?k.dark:k.light},R=()=>{m?.writeln("\x1B[1;34m[System]\x1B[0m 正在连接服务器控制台 ..."),m?.writeln(`\x1B[1;34m[System]\x1B[0m 实例 ID: ${u.serverId}`),m?.writeln("")},H=async()=>{u.serverId&&(A&&A(),A=d.onLog(x=>{m&&m.writeln(z(x)),x.startsWith("[MSLX]")&&i("update")}),P&&P(),P=d.onCommandResult((x,M)=>{x||m?.writeln(`\x1B[1;31m[System] 指令执行反馈: ${M}\x1B[0m`)}),await d.connect(u.serverId))},q=async()=>{A&&A(),P&&P(),await d.disconnect()};return l({writeln:x=>m?.writeln(x),clear:()=>{m?.clear(),R()}}),be(()=>u.serverId,async(x,M)=>{x!==M&&(await q(),p(),await H())}),Ie(async()=>{await kt(),p(),L=new MutationObserver(F),L.observe(document.documentElement,{attributes:!0,attributeFilter:["theme-mode"]}),await H()}),Qe(async()=>{L?.disconnect(),y?.disconnect(),m?.dispose(),await q()}),(x,M)=>(o(),S("div",{ref_key:"terminalWrapper",ref:f,class:"terminal-wrapper"},[t("div",Ag,[M[1]||(M[1]=t("div",{class:"dots"},[t("span",{class:"dot red"}),t("span",{class:"dot yellow"}),t("span",{class:"dot green"})],-1)),t("div",Cg,"MSLX 服务端控制台 | #"+I(s.serverId),1)]),t("div",{ref_key:"terminalBody",ref:r,class:"terminal-body"},null,512),t("div",Sg,[Je(t("input",{"onUpdate:modelValue":M[0]||(M[0]=J=>C.value=J),class:"cmd-input",placeholder:"发送控制台指令...",onKeyup:Ml(h,["enter"])},null,544),[[Is,C.value]]),t("button",{class:"send-btn",onClick:h},"发送")])],512))}}),Vg=ue(Ig,[["__scopeId","data-v-127ea751"]]),Mg={class:"settings-container"},Ug={class:"setting-item"},Lg={class:"setting-control"},Bg={class:"setting-item"},zg={class:"setting-info"},Pg={class:"desc"},Rg={class:"setting-control"},Eg={class:"setting-item"},Tg={class:"setting-control"},Fg={key:0,style:{"margin-top":"8px"}},Dg={class:"setting-item"},Og={class:"setting-info"},jg={class:"title"},Ng={class:"desc"},Kg={class:"setting-control"},qg={class:"setting-item"},Gg={class:"setting-control"},Hg={key:0,class:"core-tools-panel"},Jg={key:0,class:"upload-progress"},Wg={class:"setting-item"},Xg={class:"setting-control flex-row"},Qg={class:"memory-input-group"},Yg={class:"memory-input-group"},Zg={class:"setting-item"},e_={class:"setting-control flex-row"},t_={class:"setting-info-desc-only"},a_={style:{"font-size":"12px",color:"var(--td-text-color-placeholder)",cursor:"help"}},s_={class:"setting-item"},l_={class:"setting-control"},n_={key:0,style:{"margin-top":"8px"}},o_={key:2,class:"setting-group-title"},i_={key:3,class:"setting-item"},r_={class:"setting-control"},u_={key:0,style:{"margin-top":"8px"}},d_={class:"setting-item"},c_={class:"setting-control"},m_={class:"setting-item"},p_={class:"setting-control"},v_={class:"setting-item"},f_={class:"setting-control"},g_={class:"setting-item"},__={class:"setting-control"},h_={key:4,class:"setting-item"},y_={class:"setting-control"},b_={class:"setting-item"},w_={class:"setting-control"},k_={class:"setting-item"},$_={class:"setting-control"},x_={class:"setting-item"},A_={class:"setting-control"},C_={key:5,class:"setting-item"},S_={class:"setting-control"},I_={class:"setting-item"},V_={class:"setting-control flex-row"},M_={class:"setting-item"},U_={class:"setting-control flex-row"},L_={class:"form-actions"},B_={class:"progress-body"},z_={id:"update-log-box",class:"log-box"},P_={class:"time"},R_={key:0,class:"dialog-actions"},E_=ne({__name:"GeneralSettings",setup(s){const l=et(),n=Fe(),u=se(()=>{const oe=l.params.serverId;return oe?parseInt(oe):NaN}),i=$(null),d=$(!1),f=$(!1),r=$(!1),m=[{label:"UTF-8",value:"utf-8"},{label:"GBK",value:"gbk"}],g=$({id:u.value,name:"",base:"",java:"",core:"",minM:1024,maxM:4096,args:"",yggdrasilApiAddr:"",backupMaxCount:20,backupDelay:10,backupPath:"MSLX://Backup/Instance",monitorPlayers:!0,autoRestart:!1,forceAutoRestart:!0,ignoreEula:!1,runOnStartup:!1,inputEncoding:"utf-8",outputEncoding:"utf-8",fileEncoding:"utf-8",coreUrl:"",coreSha256:"",coreFileKey:""}),y=$("MB"),L=$("MB"),A=[{label:"MB",value:"MB"},{label:"GB",value:"GB"}],P=se({get:()=>{if(y.value==="GB"){const oe=g.value.minM/1024;return Math.round(oe*100)/100}return g.value.minM},set:oe=>{g.value.minM=y.value==="GB"?Math.round(oe*1024):oe}}),w=se({get:()=>{if(L.value==="GB"){const oe=g.value.maxM/1024;return Math.round(oe*100)/100}return g.value.maxM},set:oe=>{g.value.maxM=L.value==="GB"?Math.round(oe*1024):oe}}),C=$("custom"),k=$([]),z=$([]),p=$(""),V=$(""),h=async(oe=!1)=>{try{oe&&B.info("正在扫描 Java 环境...");const T=await Qa(n.userInfo.systemInfo.osType.toLowerCase().replace("os",""),n.userInfo.systemInfo.osArchitecture.toLowerCase());T&&Array.isArray(T)&&(k.value=T.map(le=>({label:`Java ${le} (在线)`,value:le})));const j=await Ya(oe);z.value=j.map(le=>({label:`Java ${le.version} (${le.path})`,value:le.path})),oe&&B.success("刷新成功")}catch(T){console.error(T)}};be([C,p,V],([oe,T,j])=>{oe==="none"?g.value.java="none":oe==="env"?g.value.java="java":oe==="custom"||oe==="local"?g.value.java=j:oe==="online"&&(g.value.java=T?`MSLX://Java/${T}`:"")});const E=$("MSLX://Backup/Instance"),F=$("");be([E,F],([oe,T])=>{oe==="custom"?g.value.backupPath=T:g.value.backupPath=oe});const R=$(""),H=$(""),q=[{label:"官方/离线模式 (无)",value:"none"},{label:"MSL 统一身份验证 (MSL Skin)",value:"https://skin.mslmc.net/api/yggdrasil"},{label:"LittleSkin",value:"https://littleskin.cn/api/yggdrasil"},{label:"自定义服务器",value:"custom"}];be([R,H],([oe,T])=>{oe==="none"?g.value.yggdrasilApiAddr="":oe==="custom"?g.value.yggdrasilApiAddr=T:g.value.yggdrasilApiAddr=oe});const U=$(!1),_=$(!1),x=$(null),M=$(!1),J=$(0),W=$(""),X=oe=>{g.value.core=oe.filename,g.value.coreUrl=oe.url,g.value.coreSha256=oe.sha256,g.value.coreFileKey="",U.value=!1,B.success(`已选择核心: ${oe.filename}，保存后将自动下载`)},K=()=>x.value?.click(),G=async oe=>{const T=oe.target;if(!T.files?.length)return;const j=T.files[0];if(g.value.coreFileKey)try{await It(g.value.coreFileKey)}catch{console.error("删除上传失败")}W.value=j.name,M.value=!0,J.value=0;try{const Z=(await ea()).uploadId,te=5*1024*1024,O=Math.ceil(j.size/te);for(let ge=0;ge<O;ge++){const ke=j.slice(ge*te,Math.min(j.size,(ge+1)*te));await ta(Z,ge,ke),J.value=Math.floor((ge+1)/O*100)}const ie=await aa(Z,O);g.value.coreFileKey=ie.uploadId,g.value.core=j.name,g.value.coreUrl="",B.success("文件上传就绪，保存后生效"),U.value=!1}catch(le){B.error(`上传失败: ${le.message}`)}finally{M.value=!1,T.value=""}},Le=()=>{r.value||Bs.warning({title:"风险操作",content:"修改实例路径会导致面板无法找到原有文件。请确保您已手动移动了文件，或您明确知道自己在做什么。",duration:5e3}),r.value=!r.value},ve=$(!1),Re=$(0),he=$([]),Se=$(null),Be=se(()=>C.value==="none"?{name:[{required:!0,message:"服务器名称不能为空",trigger:"blur"}],base:[{required:!0,message:"基础路径不能为空",trigger:"blur"}],args:[{required:!0,message:"自定义模式必须填写启动命令",trigger:"blur"}]}:{name:[{required:!0,message:"服务器名称不能为空",trigger:"blur"}],base:[{required:!0,message:"基础路径不能为空",trigger:"blur"}],java:[{required:!0,message:"Java 环境不能为空",trigger:"change"}],core:[{required:!0,message:"核心文件名不能为空",trigger:"change"}],minM:[{required:!0,message:"必填",trigger:"blur"}],maxM:[{required:!0,message:"必填",trigger:"blur"}]}),ze=async()=>{if(u.value){d.value=!0;try{await h(),g.value.id=u.value;const oe=await or(u.value);if(g.value={...g.value,...oe,coreUrl:"",coreFileKey:"",coreSha256:""},y.value=oe.minM>0&&oe.minM%1024===0?"GB":"MB",L.value=oe.maxM>0&&oe.maxM%1024===0?"GB":"MB",r.value=!1,oe.java==="none")C.value="none";else if(oe.java==="java")C.value="env";else if(oe.java.startsWith("MSLX://Java/"))C.value="online",p.value=oe.java.replace("MSLX://Java/","");else{const le=z.value.find(Z=>Z.value===oe.java);C.value=le?"local":"custom",V.value=oe.java}const T=oe.backupPath;T==="MSLX://Backup/Instance"||T==="MSLX://Backup/Data"?E.value=T:(E.value="custom",F.value=T);const j=oe.yggdrasilApiAddr;j?j==="https://skin.mslmc.net/api/yggdrasil"?R.value="https://skin.mslmc.net/api/yggdrasil":j==="https://littleskin.cn/api/yggdrasil"?R.value="https://littleskin.cn/api/yggdrasil":(R.value="custom",H.value=j):R.value="none"}catch(oe){B.error("获取配置失败: "+oe.message)}finally{d.value=!1}}};be(()=>l.params.serverId,oe=>{l.name==="InstanceConsole"&&oe&&ze()}),Ie(ze);const de=async()=>{if(await i.value?.validate()===!0&&!(C.value!=="none"&&(g.value.coreUrl||g.value.coreFileKey)&&!await new Promise(le=>{const Z=st.confirm({header:"确认变更核心文件?",body:"检测到您上传或选择了新的核心文件，这将覆盖服务器现有的部署。",theme:"warning",onConfirm:()=>{Z.hide(),le(!0)},onClose:()=>{Z.hide(),le(!1)}})}))){C.value==="none"&&(g.value.core="none",g.value.minM=1027,g.value.maxM=1102,g.value.java="none",g.value.coreUrl="",g.value.coreFileKey="",g.value.coreSha256=""),f.value=!0;try{const T=await ir(g.value);T.data?.needListen??T.needListen?me():(B.success("配置已保存"),f.value=!1,ze())}catch(T){B.error(T.message||"保存失败"),f.value=!1}}},me=async()=>{ve.value=!0,Re.value=0,he.value=[];const{baseUrl:oe,token:T}=n,j=new URL("/api/hubs/updateProgressHub",oe||window.location.origin);j.searchParams.append("x-user-token",T),Se.value=new Lt().withUrl(j.toString(),{withCredentials:!1}).configureLogging(Ft.None).build(),Se.value.on("UpdateStatus",(le,Z,te)=>{he.value.push({time:new Date().toLocaleTimeString(),msg:te?`[错误] ${le}`:le}),kt(()=>{const O=document.getElementById("update-log-box");O&&(O.scrollTop=O.scrollHeight)}),Z>=0&&(Re.value=Number(Z.toFixed(1))),Z===100&&(B.success("更新完成"),Ee(!0))});try{await Se.value.start(),await Se.value.invoke("JoinGroup",u.value.toString())}catch{he.value.push({time:"-",msg:"连接失败"})}},Ee=(oe=!1)=>{Se.value?.stop(),setTimeout(()=>{ve.value=!1,f.value=!1,oe&&ze()},1e3)};return Qe(()=>{Se.value?.stop()}),(oe,T)=>{const j=v("t-input"),le=v("t-button"),Z=v("t-tooltip"),te=v("t-select"),O=v("t-textarea"),ie=v("t-alert"),ge=v("t-icon"),ke=v("t-col"),we=v("t-row"),xe=v("t-progress"),Pe=v("t-space"),Ue=v("t-input-number"),Ve=v("t-switch"),Ge=v("t-form"),Ye=v("t-loading"),Oe=v("t-dialog");return o(),S("div",Mg,[e(Ye,{loading:d.value,"show-overlay":""},{default:a(()=>[e(Ge,{ref_key:"formRef",ref:i,data:g.value,rules:Be.value,"label-width":"0",onSubmit:de},{default:a(()=>[T[63]||(T[63]=t("div",{class:"setting-group-title"},"基础设置",-1)),t("div",Ug,[T[35]||(T[35]=t("div",{class:"setting-info"},[t("div",{class:"title"},"服务器名称"),t("div",{class:"desc"},"在面板列表中显示的别名，支持中文")],-1)),t("div",Lg,[e(j,{modelValue:g.value.name,"onUpdate:modelValue":T[0]||(T[0]=ee=>g.value.name=ee),placeholder:"请输入名称"},null,8,["modelValue"])])]),t("div",Bg,[t("div",zg,[T[36]||(T[36]=t("div",{class:"title"},"实例路径",-1)),t("div",Pg,[t("span",{class:$e({"text-warning":r.value})},I(r.value?"警告：修改路径可能导致无法找到原文件":"服务器文件的物理存储路径，非必要请勿修改"),3)])]),t("div",Rg,[e(j,{modelValue:g.value.base,"onUpdate:modelValue":T[1]||(T[1]=ee=>g.value.base=ee),disabled:!r.value},{suffix:a(()=>[e(Z,{content:r.value?"点击锁定":"点击解锁编辑 (慎重)"},{default:a(()=>[e(le,{variant:"text",shape:"square",onClick:Le},{icon:a(()=>[r.value?(o(),D(b(Ul),{key:0,style:{color:"var(--td-warning-color)"}})):(o(),D(b(Zt),{key:1}))]),_:1})]),_:1},8,["content"])]),_:1},8,["modelValue","disabled"])])]),T[64]||(T[64]=t("div",{class:"setting-group-title"},"运行模式",-1)),t("div",Eg,[T[37]||(T[37]=t("div",{class:"setting-info"},[t("div",{class:"title"},"启动方式"),t("div",{class:"desc"},"选择使用 Java 启动 Minecraft，或使用自定义命令启动其他程序 (如 Bedrock, Python 等)")],-1)),t("div",Tg,[e(te,{modelValue:C.value,"onUpdate:modelValue":T[2]||(T[2]=ee=>C.value=ee),options:[{label:"MSLX 在线下载 (Java)",value:"online"},{label:"使用本地版本 (Java)",value:"local"},{label:"自定义路径 (Java)",value:"custom"},{label:"环境变量 (Java)",value:"env"},{label:"自定义命令 (无Java)",value:"none"}]},null,8,["modelValue"]),C.value!=="none"?(o(),S("div",Fg,[C.value==="online"?(o(),D(te,{key:0,modelValue:p.value,"onUpdate:modelValue":T[3]||(T[3]=ee=>p.value=ee),options:k.value,placeholder:"请选择版本",filterable:""},null,8,["modelValue","options"])):N("",!0),C.value==="local"?(o(),D(te,{key:1,modelValue:V.value,"onUpdate:modelValue":T[4]||(T[4]=ee=>V.value=ee),options:z.value,placeholder:"选择已识别的 Java"},null,8,["modelValue","options"])):N("",!0),C.value==="custom"?(o(),D(j,{key:2,modelValue:V.value,"onUpdate:modelValue":T[5]||(T[5]=ee=>V.value=ee),placeholder:"输入 java 可执行文件完整路径"},null,8,["modelValue"])):N("",!0)])):N("",!0)])]),t("div",Dg,[t("div",Og,[t("div",jg,I(C.value==="none"?"启动命令 (Command)":"启动参数 (JVM Args)"),1),t("div",Ng,I(C.value==="none"?"完全自定义的启动命令。程序将直接执行此段内容，不依赖 Java 环境。":"传递给 Java 的启动参数，如 GC 策略 (例如 -XX:+UseG1GC)"),1)]),t("div",Kg,[e(O,{modelValue:g.value.args,"onUpdate:modelValue":T[6]||(T[6]=ee=>g.value.args=ee),autosize:{minRows:2,maxRows:4},placeholder:C.value==="none"?"例如: ./bedrock_server_x64":"无特殊需求请留空"},null,8,["modelValue","placeholder"])])]),C.value!=="none"?(o(),S(ce,{key:0},[T[41]||(T[41]=t("div",{class:"setting-group-title"},"核心管理",-1)),t("div",qg,[T[40]||(T[40]=t("div",{class:"setting-info"},[t("div",{class:"title"},"服务端核心文件"),t("div",{class:"desc"},[c(" 指定启动的 Jar 文件名。如果文件已存在于目录中，直接输入文件名即可。 "),t("br"),c("需要更新核心？点击下方“文件工具” ")])],-1)),t("div",Gg,[e(j,{modelValue:g.value.core,"onUpdate:modelValue":T[8]||(T[8]=ee=>g.value.core=ee),placeholder:"例如 server.jar"},{suffix:a(()=>[e(le,{variant:"text",theme:"primary",size:"small",onClick:T[7]||(T[7]=ee=>U.value=!U.value)},{default:a(()=>[c(I(U.value?"收起工具":"文件工具"),1)]),_:1})]),_:1},8,["modelValue"]),U.value?(o(),S("div",Hg,[e(Pe,{direction:"vertical",style:{width:"100%"}},{default:a(()=>[e(ie,{theme:"info",message:"在此处操作会自动下载/上传文件，并填入上方的文件名。"}),e(we,{gutter:12},{default:a(()=>[e(ke,{span:6},{default:a(()=>[e(le,{block:"",variant:"outline",onClick:T[9]||(T[9]=ee=>_.value=!0)},{icon:a(()=>[e(ge,{name:"cloud-download"})]),default:a(()=>[T[38]||(T[38]=c(" 从版本库下载 ",-1))]),_:1})]),_:1}),e(ke,{span:6},{default:a(()=>[e(le,{block:"",variant:"outline",loading:M.value,onClick:K},{icon:a(()=>[e(ge,{name:"upload"})]),default:a(()=>[T[39]||(T[39]=c(" 上传本地文件 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1}),t("input",{ref_key:"uploadInputRef",ref:x,type:"file",accept:".jar",hidden:"",onChange:G},null,544),M.value?(o(),S("div",Jg,[t("span",null,"正在上传: "+I(W.value),1),e(xe,{theme:"line",percentage:J.value},null,8,["percentage"])])):N("",!0)]),_:1})])):N("",!0)])])],64)):N("",!0),C.value!=="none"?(o(),S(ce,{key:1},[T[44]||(T[44]=t("div",{class:"setting-group-title"},"资源限制",-1)),t("div",Wg,[T[43]||(T[43]=t("div",{class:"setting-info"},[t("div",{class:"title"},"内存分配"),t("div",{class:"desc"},"设置 Java 堆内存大小 (Xms / Xmx)")],-1)),t("div",Xg,[t("div",Qg,[e(Ue,{modelValue:P.value,"onUpdate:modelValue":T[10]||(T[10]=ee=>P.value=ee),min:0,"decimal-places":y.value==="GB"?1:0,placeholder:"Xms",theme:"normal",class:"input-left"},null,8,["modelValue","decimal-places"]),e(te,{modelValue:y.value,"onUpdate:modelValue":T[11]||(T[11]=ee=>y.value=ee),options:A,clearable:!1,class:"select-right"},null,8,["modelValue"])]),T[42]||(T[42]=t("span",{class:"separator"},"-",-1)),t("div",Yg,[e(Ue,{modelValue:w.value,"onUpdate:modelValue":T[12]||(T[12]=ee=>w.value=ee),min:0,"decimal-places":L.value==="GB"?1:0,placeholder:"Xmx",theme:"normal",class:"input-left"},null,8,["modelValue","decimal-places"]),e(te,{modelValue:L.value,"onUpdate:modelValue":T[13]||(T[13]=ee=>L.value=ee),options:A,clearable:!1,class:"select-right"},null,8,["modelValue"])])])])],64)):N("",!0),T[65]||(T[65]=t("div",{class:"setting-group-title"},"备份设置",-1)),t("div",Zg,[T[47]||(T[47]=t("div",{class:"setting-info"},[t("div",{class:"title"},"备份策略"),t("div",{class:"desc"},"设置自动备份保留的最大数量，以及触发备份的延迟时间")],-1)),t("div",e_,[e(Ue,{modelValue:g.value.backupMaxCount,"onUpdate:modelValue":T[14]||(T[14]=ee=>g.value.backupMaxCount=ee),min:1,max:100,placeholder:"保留份数",theme:"column",style:{width:"140px"},suffix:"份"},null,8,["modelValue"]),T[45]||(T[45]=t("span",{class:"separator"},"/",-1)),e(Ue,{modelValue:g.value.backupDelay,"onUpdate:modelValue":T[15]||(T[15]=ee=>g.value.backupDelay=ee),min:0,placeholder:"延迟时间",theme:"column",style:{width:"140px"},suffix:"秒"},null,8,["modelValue"])]),t("div",t_,[e(Z,{content:"MSLX 向服务器发送 save-all 指令后，会等待指定的秒数，确保数据完全写入硬盘后再开始打包备份。"},{default:a(()=>[t("span",a_,[e(ge,{name:"help-circle"}),T[46]||(T[46]=c(" 什么是延迟时间？ ",-1))])]),_:1})])]),t("div",s_,[T[48]||(T[48]=t("div",{class:"setting-info"},[t("div",{class:"title"},"备份存放路径"),t("div",{class:"desc"},"选择备份文件存储的位置。推荐存储在实例文件夹外部以免误删。")],-1)),t("div",l_,[e(te,{modelValue:E.value,"onUpdate:modelValue":T[16]||(T[16]=ee=>E.value=ee),options:[{label:"实例文件夹内 (Instance)",value:"MSLX://Backup/Instance"},{label:"全局数据目录 (Data)",value:"MSLX://Backup/Data"},{label:"自定义绝对路径",value:"custom"}]},null,8,["modelValue"]),E.value==="custom"?(o(),S("div",n_,[e(j,{modelValue:F.value,"onUpdate:modelValue":T[17]||(T[17]=ee=>F.value=ee),placeholder:"输入备份存放的绝对路径"},null,8,["modelValue"])])):N("",!0)])]),C.value!=="none"?(o(),S("div",o_,"外置登录")):N("",!0),C.value!=="none"?(o(),S("div",i_,[T[49]||(T[49]=t("div",{class:"setting-info"},[t("div",{class:"title"},"Yggdrasil API"),t("div",{class:"desc"},"选择认证服务器。留空则表示使用官方正版登录 (或离线模式)。")],-1)),t("div",r_,[e(te,{modelValue:R.value,"onUpdate:modelValue":T[18]||(T[18]=ee=>R.value=ee),options:q},null,8,["modelValue"]),R.value==="custom"?(o(),S("div",u_,[e(j,{modelValue:H.value,"onUpdate:modelValue":T[19]||(T[19]=ee=>H.value=ee),placeholder:"输入 Authlib-Injector API 地址"},null,8,["modelValue"])])):N("",!0)])])):N("",!0),T[66]||(T[66]=t("div",{class:"setting-group-title"},"高级设置",-1)),t("div",d_,[T[50]||(T[50]=t("div",{class:"setting-info"},[t("div",{class:"title"},"停止服务器指令"),t("div",{class:"desc"},"设置正常停止时所发送的指令，默认为stop"),t("div",{class:"desc"},"设置为^c为发送Ctrl C (在部分环境可能无法发送成功)")],-1)),t("div",c_,[e(j,{modelValue:g.value.stopCommand,"onUpdate:modelValue":T[20]||(T[20]=ee=>g.value.stopCommand=ee),placeholder:"请输入停止指令"},null,8,["modelValue"])])]),t("div",m_,[T[51]||(T[51]=t("div",{class:"setting-info"},[t("div",{class:"title"},"日志原彩显示"),t("div",{class:"desc"},"开启此选项后，将注入相关环境变量，以让MC终端日志输出原有的色彩样式"),t("div",{class:"desc"},"此功能可以和日志染色功能搭配使用")],-1)),t("div",p_,[e(Ve,{modelValue:g.value.allowOriginASCIIColors,"onUpdate:modelValue":T[21]||(T[21]=ee=>g.value.allowOriginASCIIColors=ee),label:["已开启","已关闭"]},null,8,["modelValue"])])]),t("div",v_,[T[52]||(T[52]=t("div",{class:"setting-info"},[t("div",{class:"title"},"玩家监控"),t("div",{class:"desc"},"开启此选项后，MSLX将自动为您监控在线的玩家列表"),t("div",{class:"desc"},"以及使用可视化黑白名单/管理员等功能")],-1)),t("div",f_,[e(Ve,{modelValue:g.value.monitorPlayers,"onUpdate:modelValue":T[22]||(T[22]=ee=>g.value.monitorPlayers=ee),label:["已开启","已关闭"]},null,8,["modelValue"])])]),t("div",g_,[T[53]||(T[53]=t("div",{class:"setting-info"},[t("div",{class:"title"},"自动重启"),t("div",{class:"desc"},"当服务器崩溃或意外停止时尝试自动重启"),t("div",{class:"desc"},"熔断机制: 若5分钟内尝试重启次数达到 5 次，则停止尝试重启")],-1)),t("div",__,[e(Ve,{modelValue:g.value.autoRestart,"onUpdate:modelValue":T[23]||(T[23]=ee=>g.value.autoRestart=ee),label:["已开启","已关闭"]},null,8,["modelValue"])])]),g.value.autoRestart?(o(),S("div",h_,[T[54]||(T[54]=t("div",{class:"setting-info"},[t("div",{class:"title"},"强制自动重启"),t("div",{class:"desc"},"开启此功能后，就算服务器是正常退出的也会强制重启(正常退出 => 退出代码 0)"),t("div",{class:"desc"},"不影响手动在面板关闭服务器")],-1)),t("div",y_,[e(Ve,{modelValue:g.value.forceAutoRestart,"onUpdate:modelValue":T[24]||(T[24]=ee=>g.value.forceAutoRestart=ee),label:["已开启","已关闭"]},null,8,["modelValue"])])])):N("",!0),t("div",b_,[T[55]||(T[55]=t("div",{class:"setting-info"},[t("div",{class:"title"},"关服强制结束时间"),t("div",{class:"desc"},"设置在发出Stop指令或关服请求后，等待多久后强制结束进程"),t("div",{class:"desc"},"可设置10 - 120 s")],-1)),t("div",w_,[e(Ue,{modelValue:g.value.forceExitDelay,"onUpdate:modelValue":T[25]||(T[25]=ee=>g.value.forceExitDelay=ee)},null,8,["modelValue"])])]),t("div",k_,[T[56]||(T[56]=t("div",{class:"setting-info"},[t("div",{class:"title"},"忽略EULA提示"),t("div",{class:"desc"},"若您的实例并非MC服务器，可打开此选项")],-1)),t("div",$_,[e(Ve,{modelValue:g.value.ignoreEula,"onUpdate:modelValue":T[26]||(T[26]=ee=>g.value.ignoreEula=ee),label:["已开启","已关闭"]},null,8,["modelValue"])])]),t("div",x_,[T[57]||(T[57]=t("div",{class:"setting-info"},[t("div",{class:"title"},"随守护进程启动"),t("div",{class:"desc"},"当物理机开机/面板启动时，自动启动此实例")],-1)),t("div",A_,[e(Ve,{modelValue:g.value.runOnStartup,"onUpdate:modelValue":T[27]||(T[27]=ee=>g.value.runOnStartup=ee),label:["已开启","已关闭"]},null,8,["modelValue"])])]),C.value!=="none"?(o(),S("div",C_,[T[58]||(T[58]=t("div",{class:"setting-info"},[t("div",{class:"title"},"强制Java使用UTF8"),t("div",{class:"desc"},"此功能可以解决部分游戏内中文乱码的问题（特别是Windows系统上）"),t("div",{class:"desc"},[c("开启此功能后请务必将下面的"),t("b",null,"文件编码"),c("设置设置为"),t("b",null,"UTF-8")])],-1)),t("div",S_,[e(Ve,{modelValue:g.value.forceJvmUTF8,"onUpdate:modelValue":T[28]||(T[28]=ee=>g.value.forceJvmUTF8=ee),label:["已开启","已关闭"]},null,8,["modelValue"])])])):N("",!0),t("div",I_,[T[59]||(T[59]=t("div",{class:"setting-info"},[t("div",{class:"title"},"控制台编码"),t("div",{class:"desc"},"设置输入输出流的字符集，乱码时请尝试切换")],-1)),t("div",V_,[e(te,{modelValue:g.value.inputEncoding,"onUpdate:modelValue":T[29]||(T[29]=ee=>g.value.inputEncoding=ee),options:m,label:"输入",style:{width:"140px"}},null,8,["modelValue"]),e(te,{modelValue:g.value.outputEncoding,"onUpdate:modelValue":T[30]||(T[30]=ee=>g.value.outputEncoding=ee),options:m,label:"输出",style:{width:"140px"}},null,8,["modelValue"])])]),t("div",M_,[T[60]||(T[60]=t("div",{class:"setting-info"},[t("div",{class:"title"},"文件编码"),t("div",{class:"desc"},"设置文件编辑和保存时的编码格式，乱码时请尝试切换。(一般Windows是GBK，其他是UTF-8。)")],-1)),t("div",U_,[e(te,{modelValue:g.value.fileEncoding,"onUpdate:modelValue":T[31]||(T[31]=ee=>g.value.fileEncoding=ee),options:m,style:{width:"140px"}},null,8,["modelValue"])])]),t("div",L_,[e(le,{theme:"primary",type:"submit",size:"large",loading:f.value},{default:a(()=>[...T[61]||(T[61]=[c("保存设置",-1)])]),_:1},8,["loading"]),e(le,{theme:"default",variant:"base",size:"large",onClick:ze},{default:a(()=>[...T[62]||(T[62]=[c("重置更改",-1)])]),_:1})])]),_:1},8,["data","rules"])]),_:1},8,["loading"]),e(Xa,{visible:_.value,"onUpdate:visible":T[32]||(T[32]=ee=>_.value=ee),onConfirm:X},null,8,["visible"]),e(Oe,{visible:ve.value,"onUpdate:visible":T[34]||(T[34]=ee=>ve.value=ee),header:"正在应用更新",footer:!1,"close-on-overlay-click":!1,"close-btn":!1,width:"600px"},{default:a(()=>[t("div",B_,[e(xe,{theme:"plump",percentage:Re.value,label:`${Re.value}%`},null,8,["percentage","label"]),t("div",z_,[(o(!0),S(ce,null,fe(he.value,(ee,Ae)=>(o(),S("div",{key:Ae,class:"log-line"},[t("span",P_,I(ee.time),1),c(" "+I(ee.msg),1)]))),128))]),Re.value===100?(o(),S("div",R_,[e(le,{theme:"primary",onClick:T[33]||(T[33]=ee=>ve.value=!1)},{default:a(()=>[...T[67]||(T[67]=[c("关闭并刷新",-1)])]),_:1})])):N("",!0)])]),_:1},8,["visible"])])}}}),T_=ue(E_,[["__scopeId","data-v-14ff3f31"]]),F_={class:"uploader-container"},D_={key:0,class:"drop-text"},O_={key:1,class:"drop-text"},j_={class:"drop-actions"},N_={key:0,class:"queue-actions"},K_={class:"queue-info"},q_={key:0},G_={class:"btn-group"},H_={key:1,class:"file-list"},J_={class:"file-icon-wrapper"},W_={class:"file-content"},X_={class:"file-header"},Q_=["title"],Y_={class:"meta"},Z_={key:0,class:"error"},eh={key:1},th={class:"size"},ah=["title"],sh={class:"progress-wrapper"},lh={class:"file-action"},nh=ne({__name:"FileUploader",props:{visible:{type:Boolean},instanceId:{},currentPath:{},allowFolder:{type:Boolean,default:!0}},emits:["update:visible","success"],setup(s,{emit:l}){const n=s,u=l,i=$([]),d=$(!1),f=$(!1),r=$(!1),m=$(),g=$(),y=_=>{const x=_.split(".").pop()?.toLowerCase();return["png","jpg","jpeg","gif","ico","webp"].includes(x||"")?{icon:Ps,color:"var(--td-success-color)"}:["jar","zip","rar","7z","tar","gz"].includes(x||"")?{icon:Sa,color:"#722ed1"}:["js","ts","py","java","c","cpp","cs","json","yml","yaml","xml","html","css","properties","conf","sh","bat"].includes(x||"")?{icon:Et,color:"var(--td-warning-color)"}:["log","txt","md","lock"].includes(x||"")?{icon:Ia,color:"var(--td-gray-color-6)"}:["db","db-wal","dat"].includes(x||"")?{icon:Bl,color:"var(--td-gray-color-8)"}:{icon:Ht,color:"var(--td-brand-color)"}},L=_=>_.split("/").pop()||_,A=_=>{const x=_.lastIndexOf("/");return x!==-1?_.substring(0,x):""},P=se(()=>{if(i.value.length===0)return 0;const _=i.value.reduce((x,M)=>x+M.progress,0);return Math.floor(_/i.value.length)}),w=se(()=>i.value.some(_=>_.status==="pending"||_.status==="error")),C=()=>m.value?.click(),k=()=>g.value?.click(),z=_=>{const x=_.target;if(x.files&&x.files.length>0){const J=Array.from(x.files).map(W=>({file:W,path:W.webkitRelativePath||W.name}));E(J)}x.value=""},p=async _=>{r.value=!1;const x=_.dataTransfer?.items;if(!x)return;const M=[],J=Array.from(x).map(W=>W.webkitGetAsEntry()).filter(W=>W!==null);for(const W of J)W&&await V(W,M);E(M)},V=async(_,x)=>{if(_.isFile){const M=await new Promise((W,X)=>_.file(W,X)),J=_.fullPath.startsWith("/")?_.fullPath.slice(1):_.fullPath;x.push({file:M,path:J})}else if(_.isDirectory)if(n.allowFolder){const M=_.createReader(),J=await h(M);for(const W of J)await V(W,x)}else B.error("此处不支持上传文件夹")},h=async _=>{let x=[];const M=async()=>{const J=await new Promise((W,X)=>_.readEntries(W,X));J.length>0&&(x=x.concat(J),await M())};return await M(),x},E=_=>{_.forEach(({file:x,path:M})=>{i.value.some(J=>J.path===M&&J.file.size===x.size&&J.status!=="error")||i.value.push({id:Math.random().toString(36).substring(2),file:x,path:M,status:"pending",progress:0,speed:""})})},F=async()=>{if(d.value)return;d.value=!0,f.value=!1;const _=3,x=i.value.filter(M=>M.status==="pending"||M.status==="error");for(let M=0;M<x.length&&!(f.value&&i.value.length===0);M+=_){const W=x.slice(M,M+_).filter(X=>i.value.some(K=>K.id===X.id));W.length>0&&await Promise.all(W.map(X=>R(X)))}d.value=!1,!f.value&&i.value.length>0&&i.value.every(M=>M.status==="success")&&(B.success("上传完成"),u("success"))},R=async _=>{_.status="uploading",_.progress=0,_.abortController=new AbortController;const x=Date.now();let M=0;try{const W=(await ea()).uploadId,K=_.file.size>200*1024*1024?50*1024*1024:10*1024*1024,G=Math.ceil(_.file.size/K),Le=4,ve=5,Re=Array.from({length:G},(me,Ee)=>Ee),he=new Map,Se=()=>{const me=Date.now();if(me-M<100)return;M=me;const Ee=Array.from(he.values()).reduce((j,le)=>j+le,0),oe=Math.min(Ee/_.file.size*95,95);_.progress=Number(oe.toFixed(1));const T=(me-x)/1e3;if(T>0){const j=Ee/1024/1024/T;_.speed=j.toFixed(1)+" MB/s"}},Be=async me=>{if(_.abortController?.signal.aborted)throw new Error("已取消");const Ee=me*K,oe=Math.min(_.file.size,Ee+K),T=_.file.slice(Ee,oe);let j;for(let le=1;le<=ve;le++){if(_.abortController?.signal.aborted)throw new Error("已取消");try{await ta(W,me,T,Z=>{Z&&Z.loaded&&(he.set(me,Z.loaded),Se())},_.abortController?.signal),he.set(me,T.size),Se();return}catch(Z){j=Z,le<ve&&(he.set(me,0),Se(),await new Promise(te=>setTimeout(te,1e3*le)))}}throw j||new Error(`分片 ${me} 失败`)},ze=async()=>{for(;Re.length>0&&!_.abortController?.signal.aborted;){const me=Re.shift();if(me===void 0)break;await Be(me)}},de=Array(Math.min(Le,G)).fill(null).map(()=>ze());if(await Promise.all(de),_.abortController.signal.aborted)throw new Error("已取消");_.status="merging",_.speed="合并中...",_.progress=98,await aa(W,G),await qo(n.instanceId,W,_.path,n.currentPath),_.status="success",_.progress=100,_.speed="完成"}catch(J){J.message==="已取消"||_.abortController?.signal.aborted?(_.status="pending",_.speed="已取消",_.progress=0):(_.status="error",_.errorMsg=J.message||"失败")}},H=_=>{i.value[_].abortController?.abort(),i.value.splice(_,1)},q=()=>{i.value=i.value.filter(_=>_.status!=="success")},U=()=>u("update:visible",!1);return Qe(()=>i.value.forEach(_=>_.abortController?.abort())),(_,x)=>{const M=v("t-button"),J=v("t-progress"),W=v("t-dialog");return o(),D(W,{visible:s.visible,header:"批量上传文件",width:"650px",footer:!1,onClose:U},{default:a(()=>[t("input",{ref_key:"fileInputRef",ref:m,type:"file",multiple:"",style:{display:"none"},onChange:z},null,544),t("input",{ref_key:"folderInputRef",ref:g,type:"file",webkitdirectory:"",style:{display:"none"},onChange:z},null,544),t("div",F_,[t("div",{class:$e(["drop-zone",{active:r.value}]),onDragover:x[0]||(x[0]=St(X=>r.value=!0,["prevent"])),onDragleave:x[1]||(x[1]=St(X=>r.value=!1,["prevent"])),onDrop:St(p,["prevent"])},[e(b(zs),{size:"40px",style:{color:"var(--td-brand-color)"}}),n.allowFolder?(o(),S("p",D_,"拖入文件或文件夹")):N("",!0),n.allowFolder?N("",!0):(o(),S("p",O_,"拖入文件")),t("div",j_,[e(M,{variant:"outline",size:"small",onClick:C},{icon:a(()=>[e(b(Ht))]),default:a(()=>[x[2]||(x[2]=c(" 选择文件",-1))]),_:1}),n.allowFolder?(o(),D(M,{key:0,variant:"outline",size:"small",onClick:k},{icon:a(()=>[e(b(Tt))]),default:a(()=>[x[3]||(x[3]=c(" 选择文件夹",-1))]),_:1})):N("",!0)])],34),i.value.length>0?(o(),S("div",N_,[t("span",K_,[c(" 队列: "+I(i.value.length)+" 个 | ",1),d.value?(o(),S("span",q_,"总进度 "+I(P.value)+"%",1)):N("",!0)]),t("div",G_,[e(M,{theme:"primary",size:"small",disabled:!w.value||d.value,onClick:F},{icon:a(()=>[e(b(Ot))]),default:a(()=>[c(" "+I(d.value?"上传中...":"开始上传"),1)]),_:1},8,["disabled"]),e(M,{variant:"text",size:"small",onClick:q},{icon:a(()=>[e(b(Ll))]),default:a(()=>[x[4]||(x[4]=c(" 清空已完成",-1))]),_:1})])])):N("",!0),i.value.length>0?(o(),S("div",H_,[(o(!0),S(ce,null,fe(i.value,(X,K)=>(o(),S("div",{key:X.id,class:"file-item"},[t("div",J_,[(o(),D(it(y(L(X.path)).icon),{style:nt({color:y(L(X.path)).color})},null,8,["style"]))]),t("div",W_,[t("div",X_,[t("div",{class:"name",title:L(X.path)},I(L(X.path)),9,Q_),t("div",Y_,[X.status==="error"?(o(),S("span",Z_,I(X.errorMsg),1)):(o(),S("span",eh,I(X.speed),1)),t("span",th,I((X.file.size/1024/1024).toFixed(2))+" MB",1)])]),A(X.path)?(o(),S("div",{key:0,class:"file-path",title:A(X.path)},[e(b(Tt),{size:"10px"}),c(" "+I(A(X.path))+"/ ",1)],8,ah)):N("",!0),t("div",sh,[e(J,{percentage:X.progress,status:X.status==="error"?"error":X.status==="success"?"success":"active",size:"small",label:!1},null,8,["percentage","status"])])]),t("div",lh,[X.status!=="success"?(o(),D(M,{key:0,shape:"circle",variant:"text",size:"small",onClick:G=>H(K)},{default:a(()=>[e(b(ga))]),_:1},8,["onClick"])):(o(),D(b(fa),{key:1,style:{color:"var(--td-success-color)","font-size":"18px"}}))])]))),128))])):N("",!0)])]),_:1},8,["visible"])}}}),tl=ue(nh,[["__scopeId","data-v-890b3931"]]),oh={class:"pm-container"},ih={class:"header-section"},rh={class:"mode-switcher"},uh={key:0,class:"error-alert-bar"},dh={class:"toolbar"},ch={class:"left-actions"},mh={key:0,class:"bulk-actions"},ph={class:"selected-count"},vh={class:"right-search"},fh={class:"table-wrapper"},gh={style:{display:"flex","align-items":"center",gap:"8px"}},_h={class:"empty-state"},hh={class:"tips-footer"},yh=ne({__name:"ModsPluginsManager",setup(s){const l=et(),n=parseInt(l.params.serverId),u=$("mods"),i=$(!1),d=$([]),f=$(""),r=$([]),m=$(""),g=se(()=>{if(!f.value)return d.value;const V=f.value.toLowerCase();return d.value.filter(h=>h.name.toLowerCase().includes(V))}),y=se(()=>[{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{title:"文件名",colKey:"name",sorter:(V,h)=>V.name.localeCompare(h.name),ellipsis:!0},{title:"状态",colKey:"status",width:100},{title:"操作",colKey:"op",width:180,fixed:"right",align:"right"}]),L=async(V=!1)=>{i.value=!0,r.value=[],m.value="";try{const h=await Pa(n,u.value,V),E=(h.clientJarFiles||[]).map(H=>({name:H,status:"enabled",isClient:!0})),F=(h.jarFiles||[]).map(H=>({name:H,status:"enabled"})),R=(h.disableJarFiles||[]).map(H=>({name:H,status:"disabled"}));d.value=[...E,...F,...R],V&&E.length>0?(r.value=E.map(H=>H.name),B.success(`检测到 ${E.length} 个客户端模组`)):V&&B.info("未检测到仅客户端模组")}catch(h){const E=h.message||"获取列表失败";m.value=E,d.value=[]}finally{i.value=!1}},A=async(V,h)=>{if(h.length===0)return;const E={enable:"启用",disable:"禁用",delete:"删除"},F=async()=>{try{i.value=!0;const R=await Yo(n,u.value,V,h),{successCount:H,failCount:q}=R||{};q>0?B.warning(`操作完成：成功 ${H} 个，失败 ${q} 个`):B.success(`成功${E[V]} ${H} 个文件`),await L()}catch(R){B.error(R.message||"操作失败"),i.value=!1}};if(V==="delete"){const R=st.confirm({header:`确认删除 ${h.length} 个文件?`,body:"此操作不可逆，文件将被永久删除。",theme:"danger",onConfirm:()=>{R.hide(),F()}})}else await F()},P=V=>{u.value=V,L()},w=V=>{const h=V.status==="enabled"?"disable":"enable";A(h,[V.name])},C=V=>{const h=r.value;A(V,h)},k=$(!1),z=()=>{k.value=!0},p=()=>{k.value=!1,L()};return Ie(()=>{L()}),be(()=>l.params.serverId,V=>{V&&location.reload()}),(V,h)=>{const E=v("t-radio-button"),F=v("t-radio-group"),R=v("t-alert"),H=v("t-button"),q=v("t-input"),U=v("t-tag"),_=v("t-switch"),x=v("t-popconfirm"),M=v("t-space"),J=v("t-table");return o(),S("div",oh,[t("div",ih,[h[13]||(h[13]=t("div",{class:"setting-group-title"}," 资源管理 ",-1)),t("div",rh,[e(F,{modelValue:u.value,"onUpdate:modelValue":h[0]||(h[0]=W=>u.value=W),variant:"default-filled",onChange:P},{default:a(()=>[e(E,{value:"mods"},{icon:a(()=>[e(b(Va))]),default:a(()=>[h[11]||(h[11]=c(" 模组 (Mods) ",-1))]),_:1}),e(E,{value:"plugins"},{icon:a(()=>[e(b(Jt))]),default:a(()=>[h[12]||(h[12]=c(" 插件 (Plugins) ",-1))]),_:1})]),_:1},8,["modelValue"])])]),m.value?(o(),S("div",uh,[e(R,{theme:"error",message:m.value,closeable:"",onClose:h[2]||(h[2]=W=>m.value="")},{operation:a(()=>[t("span",{style:{cursor:"pointer","margin-left":"8px"},onClick:h[1]||(h[1]=W=>L(!1))},"重试")]),_:1},8,["message"])])):N("",!0),t("div",dh,[t("div",ch,[e(H,{theme:"primary",disabled:m.value!=="",onClick:z},{icon:a(()=>[e(b(Ma))]),default:a(()=>[h[14]||(h[14]=c(" 上传文件 ",-1))]),_:1},8,["disabled"]),u.value==="mods"?(o(),D(H,{key:0,disabled:m.value!=="",variant:"outline",loading:i.value,onClick:h[3]||(h[3]=W=>L(!0))},{icon:a(()=>[e(b(ra))]),default:a(()=>[h[15]||(h[15]=c(" 检测客户端模组 ",-1))]),_:1},8,["disabled","loading"])):N("",!0),e(H,{variant:"outline",loading:i.value,onClick:h[4]||(h[4]=W=>L(!1))},{icon:a(()=>[e(b(Ze))]),_:1},8,["loading"]),e(Yt,{name:"fade"},{default:a(()=>[r.value.length>0?(o(),S("div",mh,[h[19]||(h[19]=t("div",{class:"divider"},null,-1)),t("span",ph,"已选 "+I(r.value.length)+" 项",1),e(H,{size:"small",variant:"text",theme:"success",onClick:h[5]||(h[5]=W=>C("enable"))},{default:a(()=>[...h[16]||(h[16]=[c("启用",-1)])]),_:1}),e(H,{size:"small",variant:"text",theme:"warning",onClick:h[6]||(h[6]=W=>C("disable"))},{default:a(()=>[...h[17]||(h[17]=[c("禁用",-1)])]),_:1}),e(H,{size:"small",variant:"text",theme:"danger",onClick:h[7]||(h[7]=W=>C("delete"))},{default:a(()=>[...h[18]||(h[18]=[c("删除",-1)])]),_:1})])):N("",!0)]),_:1})]),t("div",vh,[e(q,{modelValue:f.value,"onUpdate:modelValue":h[8]||(h[8]=W=>f.value=W),placeholder:"搜索文件名...",clearable:""},{"prefix-icon":a(()=>[e(b(ra))]),_:1},8,["modelValue"])])]),t("div",fh,[e(J,{"selected-row-keys":r.value,"onUpdate:selectedRowKeys":h[9]||(h[9]=W=>r.value=W),pagination:{defaultPageSize:20,total:g.value.length,showJumper:!0,defaultCurrent:1},data:g.value,columns:y.value,"row-key":"name",loading:i.value,hover:"",stripe:"",class:"custom-table"},{name:a(({row:W})=>[t("div",gh,[t("span",null,I(W.name),1),W.isClient?(o(),D(U,{key:0,theme:"warning",variant:"light",size:"small"},{default:a(()=>[...h[20]||(h[20]=[c(" 客户端 ",-1)])]),_:1})):N("",!0)])]),status:a(({row:W})=>[W.status==="enabled"?(o(),D(U,{key:0,theme:"success",variant:"light"},{icon:a(()=>[e(b(Vt))]),default:a(()=>[h[21]||(h[21]=c(" 已启用 ",-1))]),_:1})):(o(),D(U,{key:1,theme:"default",variant:"light",style:{color:"var(--td-text-color-placeholder)"}},{icon:a(()=>[e(b(ga))]),default:a(()=>[h[22]||(h[22]=c(" 已禁用 ",-1))]),_:1}))]),op:a(({row:W})=>[e(M,{size:"small"},{default:a(()=>[e(_,{"model-value":W.status==="enabled",loading:i.value,size:"medium",onChange:X=>w(W)},{label:a(X=>[c(I(X.value?"开":"关"),1)]),_:1},8,["model-value","loading","onChange"]),e(x,{content:"确定要删除此文件吗？",theme:"danger",onConfirm:X=>A("delete",[W.name])},{default:a(()=>[e(H,{variant:"text",theme:"danger",shape:"square"},{default:a(()=>[e(b(mt))]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)]),empty:a(()=>[t("div",_h,[u.value==="mods"?(o(),D(b(Va),{key:0,size:"48px",style:{color:"var(--td-gray-color-4)"}})):(o(),D(b(Jt),{key:1,size:"48px",style:{color:"var(--td-gray-color-4)"}})),t("p",null,I(`暂无${u.value==="mods"?"模组":"插件"}文件`),1)])]),_:1},8,["selected-row-keys","pagination","data","columns","loading"])]),t("div",hh,[t("p",null,"提示："+I(u.value==="mods"?"模组":"插件")+"文件存放于服务器根目录的 /"+I(u.value)+" 文件夹下。",1),h[23]||(h[23]=t("p",null,"禁用文件后，会在文件名后添加 .disabled 后缀，服务器将忽略该文件。",-1))]),e(tl,{visible:k.value,"onUpdate:visible":h[10]||(h[10]=W=>k.value=W),"instance-id":b(n),"current-path":u.value,"allow-folder":!1,onSuccess:p},null,8,["visible","instance-id","current-path"])])}}}),bh=ue(yh,[["__scopeId","data-v-c8641ed4"]]),ys=[{key:"motd",label:"服务器标语",desc:"显示在多人游戏列表中的服务器介绍信息，支持颜色代码，不支持中文。",type:"string"},{key:"server-port",label:"服务器端口",desc:"默认为 25565。如果要在一台机器运行多个服务器，必须修改此端口。",type:"number"},{key:"max-players",label:"最大玩家数",desc:"服务器同时允许在线的最大玩家数量。",type:"number"},{key:"online-mode",label:"正版验证",desc:"开启后将验证玩家的正版账号。如果使用离线/皮肤站，请关闭此项。",type:"boolean"},{key:"white-list",label:"启用白名单",desc:"开启后只有在白名单内的玩家才能进入服务器。",type:"boolean"},{key:"enforce-whitelist",label:"强制白名单",desc:"开启后，当玩家不在白名单时，即使已在线也会被踢出（通常用于维护时重新加载白名单）。",type:"boolean"},{key:"level-name",label:"存档文件夹名称",desc:"服务器读取的世界存档文件夹名称（默认为 world）。",type:"string"},{key:"gamemode",label:"默认游戏模式",desc:"新玩家进入服务器时的默认模式。",type:"select",options:[{label:"生存 (Survival)",value:"survival"},{label:"创造 (Creative)",value:"creative"},{label:"冒险 (Adventure)",value:"adventure"},{label:"旁观 (Spectator)",value:"spectator"}]},{key:"force-gamemode",label:"强制游戏模式",desc:"开启后，玩家每次加入服务器都会被重置为默认游戏模式。",type:"boolean"},{key:"difficulty",label:"难度",desc:"世界的游戏难度设置。",type:"select",options:[{label:"和平 (Peaceful)",value:"peaceful"},{label:"简单 (Easy)",value:"easy"},{label:"普通 (Normal)",value:"normal"},{label:"困难 (Hard)",value:"hard"}]},{key:"hardcore",label:"极限模式",desc:"开启后，玩家死亡将被封禁。",type:"boolean"},{key:"allow-flight",label:"允许飞行",desc:"允许生存模式下的玩家飞行（防止被服务端反作弊踢出）。",type:"boolean"},{key:"spawn-protection",label:"出生点保护半径",desc:"出生点周围多少格内禁止非 OP 破坏。设为 0 可禁用。",type:"number"},{key:"player-idle-timeout",label:"挂机踢出时间",desc:"玩家闲置多少分钟后被自动踢出。0 为不限制。",type:"number"},{key:"level-seed",label:"世界种子",desc:"生成世界使用的种子，留空则随机生成。",type:"string"},{key:"level-type",label:"世界类型",desc:"例如 minecraft:normal, minecraft:flat, minecraft:amplified。",type:"string"},{key:"generate-structures",label:"生成结构",desc:"是否生成村庄、地牢等结构。",type:"boolean"},{key:"generator-settings",label:"生成器设置",desc:"用于自定义超平坦或特定生成器的 JSON 参数。",type:"string"},{key:"max-world-size",label:"世界边界半径",desc:"设置世界边界（World Border）的最大半径。",type:"number"},{key:"simulation-distance",label:"模拟距离",desc:"服务器实际运算实体/作物生长的区块半径（3-32）。",type:"number"},{key:"view-distance",label:"视距",desc:"客户端可以看见的区块半径。数值过大显著增加内存和带宽消耗。",type:"number"},{key:"entity-broadcast-range-percentage",label:"实体广播范围百分比",desc:"控制客户端能看到实体的距离系数（100表示默认）。",type:"number"},{key:"max-tick-time",label:"最大刻耗时 (Watchdog)",desc:"一刻的最长处理毫秒数。超过此数值服务器将强制关闭以防卡死。设为 -1 可禁用。",type:"number"},{key:"network-compression-threshold",label:"网络压缩阈值",desc:"数据包超过此字节数时进行压缩。设为 -1 禁用压缩。推荐保持默认 256。",type:"number"},{key:"rate-limit",label:"数据包限制",desc:"如果玩家发送数据包过快，将被踢出。0 为禁用。",type:"number"},{key:"use-native-transport",label:"使用原生传输优化",desc:"Linux 环境下是否启用 Epoll 优化网络性能。",type:"boolean"},{key:"prevent-proxy-connections",label:"防止代理连接",desc:"是否尝试阻止通过 VPN 或代理的连接（ISP/AS 号判断）。",type:"boolean"},{key:"sync-chunk-writes",label:"同步区块写入",desc:"开启后区块写入完成后才继续逻辑，数据更安全但可能掉帧；关闭可能提升性能。",type:"boolean"},{key:"region-file-compression",label:"区块文件压缩格式",desc:"用于保存区块的压缩算法。",type:"select",options:[{label:"Deflate (默认)",value:"deflate"},{label:"LZ4 (更快)",value:"lz4"},{label:"不压缩 (None)",value:"none"}]},{key:"max-chained-neighbor-updates",label:"最大连锁更新数",desc:"限制红石/方块连锁更新的数量以防止崩服。",type:"number"},{key:"log-ips",label:"控制台记录 IP",desc:"是否在控制台日志中显示玩家连接的 IP 地址。",type:"boolean"},{key:"hide-online-players",label:"隐藏在线玩家列表",desc:"开启后，服务器列表中将不显示具体的玩家名单。",type:"boolean"},{key:"enable-status",label:"启用状态查询",desc:"是否允许外部（如服务器列表网站）查询服务器状态。",type:"boolean"},{key:"accepts-transfers",label:"接受服务器传送",desc:"是否允许玩家从其他服务器无缝传送到此服务器。",type:"boolean"},{key:"pause-when-empty-seconds",label:"空载暂停时间",desc:"服务器内无玩家多少秒后暂停游戏循环（省资源）。-1 为不暂停。",type:"number"},{key:"op-permission-level",label:"OP 权限等级",desc:"设置 OP 的默认权限级别。",type:"select",options:[{label:"1 - 无视出生点保护",value:1},{label:"2 - 使用单机指令 (gamemode等)",value:2},{label:"3 - 多人管理 (kick/ban/op)",value:3},{label:"4 - 系统管理 (stop/save)",value:4}]},{key:"function-permission-level",label:"函数权限等级",desc:"数据包(Datapack)中函数的默认执行权限等级。",type:"number"},{key:"enforce-secure-profile",label:"强制安全配置 (签名)",desc:"强制玩家拥有官方签名的公钥（聊天报告相关）。离线服建议关闭。",type:"boolean"},{key:"enable-code-of-conduct",label:"启用行为准则提示",desc:"是否向玩家展示行为准则链接（遥测相关）。",type:"boolean"},{key:"bug-report-link",label:"Bug 反馈链接",desc:"自定义玩家遇到错误时显示的反馈网址。",type:"string"},{key:"resource-pack",label:"资源包下载地址",desc:"玩家进入服务器时提示下载的资源包直链 URL。",type:"string"},{key:"require-resource-pack",label:"强制资源包",desc:"开启后，拒绝下载资源包的玩家将被踢出。",type:"boolean"},{key:"resource-pack-sha1",label:"资源包 SHA1",desc:"资源包文件的 SHA-1 校验码，用于验证完整性和缓存。",type:"string"},{key:"resource-pack-prompt",label:"资源包提示语",desc:"下载资源包时向玩家显示的自定义消息（Json 格式）。",type:"string"},{key:"initial-enabled-packs",label:"初始启用数据包",desc:"世界生成时默认启用的数据包列表（逗号分隔）。",type:"string"},{key:"initial-disabled-packs",label:"初始禁用数据包",desc:"世界生成时默认禁用的数据包列表。",type:"string"},{key:"enable-rcon",label:"启用 RCON",desc:"开启远程控制台协议，允许外部工具发送指令。",type:"boolean"},{key:"rcon.port",label:"RCON 端口",desc:"RCON 监听端口（默认为 25575）。",type:"number"},{key:"rcon.password",label:"RCON 密码",desc:"连接 RCON 必须的密码。请设置复杂的密码。",type:"string"},{key:"broadcast-rcon-to-ops",label:"向 OP 广播 RCON",desc:"当 RCON 执行指令时，是否通知在线的 OP。",type:"boolean"},{key:"enable-query",label:"启用 Query",desc:"开启 GameSpy4 协议，用于获取服务器详细信息。",type:"boolean"},{key:"query.port",label:"Query 端口",desc:"Query 协议监听端口（默认为 25565）。",type:"number"},{key:"broadcast-console-to-ops",label:"向 OP 广播控制台",desc:"控制台执行的指令输出是否发给在线 OP。",type:"boolean"},{key:"enable-jmx-monitoring",label:"启用 JMX 监控",desc:"开启 Java JMX 性能监控（通常用于开发调试）。",type:"boolean"},{key:"management-server-enabled",label:"启用管理后台",desc:"是否启用 Minecraft 官方定义的管理服务器接口。",type:"boolean"},{key:"management-server-port",label:"管理后台端口",desc:"管理接口监听的端口。",type:"number"},{key:"management-server-host",label:"管理后台主机",desc:"管理接口绑定的主机名/IP。",type:"string"},{key:"management-server-allowed-origins",label:"管理后台允许源",desc:"允许访问管理接口的 Origin 列表。",type:"string"},{key:"server-ip",label:"服务器绑定 IP",desc:"指定服务器绑定的本地网卡 IP。留空表示监听所有网卡（0.0.0.0）。",type:"string"},{key:"debug",label:"调试模式",desc:"开启后控制台将输出更多调试信息。",type:"boolean"},{key:"text-filtering-config",label:"文本过滤配置",desc:"用于文本过滤服务的 API 配置。",type:"string"},{key:"status-heartbeat-interval",label:"状态心跳间隔",desc:"服务器向客户端发送状态心跳的间隔（0 为默认）。",type:"number"}],wh={class:"settings-container"},kh={class:"page-header"},$h={class:"config-list"},xh={key:0,class:"empty-tip"},Ah={class:"setting-info"},Ch={class:"title"},Sh={class:"key-name-row"},Ih={key:0,class:"key-name"},Vh={key:0,class:"desc"},Mh={class:"setting-control"},Uh={class:"form-actions"},Lh=ne({__name:"ServerProperties",setup(s){const l=et(),n=$(0),u=$(!1),i=$(!1),d=$({}),f=$(""),r=C=>{const k={};return C.split(`
`).forEach(p=>{const V=p.trim();if(!V||V.startsWith("#"))return;const h=V.indexOf("=");if(h!==-1){const E=V.substring(0,h).trim(),F=V.substring(h+1).trim();k[E]=F}}),k},m=C=>{let k=`#Minecraft server properties
#${new Date().toString()}
`;const z=ys.map(V=>V.key),p=Object.keys(C);return z.forEach(V=>{Object.prototype.hasOwnProperty.call(C,V)&&(k+=`${V}=${C[V]}
`)}),p.forEach(V=>{z.includes(V)||(k+=`${V}=${C[V]}
`)}),k},g=async()=>{if(n.value){u.value=!0;try{const C=await ha(n.value,"server.properties");C&&(f.value=C,d.value=r(C))}catch(C){B.error(`读取配置文件失败: ${C.message}`)}finally{u.value=!1}}},y=async()=>{i.value=!0;try{const C=m(d.value);await Ha(n.value,"server.properties",C),B.success("配置文件已保存"),g()}catch(C){B.error(`保存失败: ${C.message}`)}finally{i.value=!1}},L=se(()=>{const C=[],k=d.value,z=new Set(Object.keys(k));return ys.forEach(p=>{z.has(p.key)&&(C.push(p),z.delete(p.key))}),z.forEach(p=>{C.push({key:p,label:p,desc:"未收录的配置项",type:A(k[p]),isUnknown:!0})}),C}),A=C=>C==="true"||C==="false"?"boolean":!isNaN(Number(C))&&C!==""?"number":"string",P=(C,k)=>{const z=d.value[C];return z===void 0?k==="boolean"?!1:"":k==="boolean"?z==="true":k==="number"?Number(z):z},w=(C,k,z)=>{d.value[C]=String(k)};return be(()=>l.params.serverId,C=>{l.name==="InstanceConsole"&&C&&(n.value=parseInt(C),g())},{immediate:!0}),(C,k)=>{const z=v("t-button"),p=v("t-space"),V=v("t-switch"),h=v("t-select"),E=v("t-input-number"),F=v("t-input"),R=v("t-loading");return o(),S("div",wh,[t("div",kh,[k[1]||(k[1]=t("div",{class:"section-title"},"Server.properties 配置编辑器",-1)),e(p,null,{default:a(()=>[e(z,{variant:"text",shape:"square",loading:u.value,onClick:g},{icon:a(()=>[e(b(Ze))]),_:1},8,["loading"]),e(z,{theme:"primary",loading:i.value,onClick:y},{icon:a(()=>[e(b(Rs))]),default:a(()=>[k[0]||(k[0]=c(" 保存配置 ",-1))]),_:1},8,["loading"])]),_:1})]),e(R,{loading:u.value,text:"正在读取配置文件..."},{default:a(()=>[t("div",$h,[!u.value&&L.value.length===0?(o(),S("div",xh," 无法找到配置项或文件为空 ")):N("",!0),(o(!0),S(ce,null,fe(L.value,H=>(o(),S("div",{key:H.key,class:$e(["setting-item",{"unknown-item":H.isUnknown}])},[t("div",Ah,[t("div",Ch,I(H.label),1),t("div",Sh,[H.isUnknown?N("",!0):(o(),S("span",Ih,I(H.key),1))]),H.isUnknown?N("",!0):(o(),S("div",Vh,I(H.desc||"暂无描述"),1))]),t("div",Mh,[H.type==="boolean"?(o(),D(V,{key:0,"model-value":P(H.key,"boolean"),"onUpdate:modelValue":q=>w(H.key,q,"boolean")},null,8,["model-value","onUpdate:modelValue"])):H.type==="select"?(o(),D(h,{key:1,"model-value":P(H.key,"string"),options:H.options,placeholder:"请选择","onUpdate:modelValue":q=>w(H.key,q,"string")},null,8,["model-value","options","onUpdate:modelValue"])):H.type==="number"?(o(),D(E,{key:2,"model-value":P(H.key,"number"),theme:"column",style:{width:"100%"},"onUpdate:modelValue":q=>w(H.key,q,"number")},null,8,["model-value","onUpdate:modelValue"])):(o(),D(F,{key:3,"model-value":P(H.key,"string"),placeholder:"未设置","onUpdate:modelValue":q=>w(H.key,q,"string")},null,8,["model-value","onUpdate:modelValue"]))])],2))),128))])]),_:1},8,["loading"]),t("div",Uh,[e(z,{theme:"primary",size:"large",loading:i.value,onClick:y},{default:a(()=>[...k[2]||(k[2]=[c("保存设置",-1)])]),_:1},8,["loading"]),e(z,{theme:"default",variant:"base",size:"large",onClick:g},{default:a(()=>[...k[3]||(k[3]=[c("重置更改",-1)])]),_:1})])])}}}),Bh=ue(Lh,[["__scopeId","data-v-6dfcc71c"]]);async function zh(s){return await Q.get({url:`/api/instance/tasks/list/${s}`})}async function Ph(s,l,n,u,i,d){return await Q.post({url:"/api/instance/tasks/create",data:{instanceId:s,name:l,cron:n,payload:u,type:i,enable:d}})}async function Rh(s,l,n,u,i,d,f){return await Q.post({url:"/api/instance/tasks/update",data:{instanceId:s,id:l,name:n,cron:u,payload:i,type:d,enable:f}})}async function Eh(s){return await Q.post({url:`/api/instance/tasks/delete/${s}`})}const Th={class:"cron-gen-container"},Fh={class:"mode-switch"},Dh={key:0,class:"mode-content novice-panel"},Oh={class:"novice-input-group"},jh={key:1,class:"mode-content pro-panel"},Nh={class:"tab-scroll-area"},Kh={key:0,class:"specific-box"},qh={class:"result-area"},Gh={class:"cron-display"},Hh={class:"code-box"},Jh={class:"next-runs"},Wh={class:"runs-title"},Xh={key:0,class:"error-msg"},Qh={key:1,class:"runs-list"},Yh={class:"index"},Zh=ne({__name:"CronGenerator",props:{visible:{type:Boolean,default:!1},initialValue:{type:String,default:""}},emits:["update:visible","confirm"],setup(s,{emit:l}){const n=s,u=l,i=$("novice"),d=$(10),f=$("minute"),r=[{label:"秒",value:"second"},{label:"分钟",value:"minute"},{label:"小时",value:"hour"},{label:"天",value:"day"}],m=$("second"),g=[{label:"秒",value:"second",min:0,max:59},{label:"分",value:"minute",min:0,max:59},{label:"时",value:"hour",min:0,max:23},{label:"日",value:"day",min:1,max:31},{label:"月",value:"month",min:1,max:12},{label:"周",value:"week",min:1,max:7}],y=$({second:{type:"every",start:0,step:1,specifics:[]},minute:{type:"every",start:0,step:1,specifics:[]},hour:{type:"every",start:0,step:1,specifics:[]},day:{type:"every",start:1,step:1,specifics:[]},month:{type:"every",start:1,step:1,specifics:[]},week:{type:"any",start:1,step:1,specifics:[]}}),L=[{label:"周日",value:1},{label:"周一",value:2},{label:"周二",value:3},{label:"周三",value:4},{label:"周四",value:5},{label:"周五",value:6},{label:"周六",value:7}],A=se(()=>{const h=(_,x="*")=>{const M=y.value[_];return _==="week"&&M.type==="any"||_==="week"&&y.value.day.type!=="every"||_==="day"&&y.value.week.type!=="any"?"?":M.type==="every"?"*":M.type==="interval"?`${M.start}/${M.step}`:M.type==="specific"?M.specifics.length===0?_==="day"||_==="month"?"1":"0":M.specifics.sort((J,W)=>J-W).join(","):x},E=h("second"),F=h("minute"),R=h("hour"),H=h("day"),q=h("month"),U=h("week","?");return`${E} ${F} ${R} ${H} ${q} ${U}`}),P=se(()=>{const h=d.value;switch(f.value){case"second":return`*/${h} * * * * *`;case"minute":return`0 */${h} * * * *`;case"hour":return`0 0 */${h} * * ?`;case"day":return`0 0 0 */${h} * ?`;default:return"* * * * * *"}}),w=se(()=>i.value==="novice"?P.value:A.value),C=$([]),k=$(""),z=()=>{try{const h=pn.CronExpressionParser.parse(w.value,{currentDate:new Date});C.value=h.take(5).map(E=>new Date(E.toString()).toLocaleString()),k.value=""}catch{k.value="无法解析当前 Cron 表达式，请检查规则是否冲突",C.value=[]}};be(w,()=>{z()},{immediate:!0}),be(()=>n.visible,h=>{h&&n.initialValue&&(i.value="pro",z())});const p=()=>{if(k.value){B.warning("当前表达式无效，无法保存");return}u("confirm",w.value),u("update:visible",!1)},V=h=>{const E=g.find(R=>R.value===h);if(!E)return[];const F=[];for(let R=E.min;R<=E.max;R++)F.push({label:R.toString(),value:R});return F};return(h,E)=>{const F=v("t-radio-button"),R=v("t-radio-group"),H=v("t-input-number"),q=v("t-select"),U=v("t-alert"),_=v("t-radio"),x=v("t-checkbox-group"),M=v("t-tab-panel"),J=v("t-tabs"),W=v("t-tag"),X=v("t-dialog");return o(),D(X,{visible:s.visible,header:"Cron 表达式生成器",width:"700px",top:"5vh",onClose:E[4]||(E[4]=K=>u("update:visible",!1)),onConfirm:p},{default:a(()=>[t("div",Th,[t("div",Fh,[e(R,{modelValue:i.value,"onUpdate:modelValue":E[0]||(E[0]=K=>i.value=K),variant:"default-filled"},{default:a(()=>[e(F,{value:"novice"},{default:a(()=>[...E[5]||(E[5]=[c("🚀 新手模式",-1)])]),_:1}),e(F,{value:"pro"},{default:a(()=>[...E[6]||(E[6]=[c("🛠️ 专业模式",-1)])]),_:1})]),_:1},8,["modelValue"])]),i.value==="novice"?(o(),S("div",Dh,[t("div",Oh,[E[7]||(E[7]=t("span",null,"每隔",-1)),e(H,{modelValue:d.value,"onUpdate:modelValue":E[1]||(E[1]=K=>d.value=K),min:1,theme:"column",style:{width:"100px"}},null,8,["modelValue"]),e(q,{modelValue:f.value,"onUpdate:modelValue":E[2]||(E[2]=K=>f.value=K),options:r,style:{width:"100px"}},null,8,["modelValue"]),E[8]||(E[8]=t("span",null,"执行一次",-1))]),e(U,{theme:"info",style:{"margin-top":"16px"}},{message:a(()=>[...E[9]||(E[9]=[c(" 此模式适用于简单的周期性任务。如果需要“每周五上午10点”等复杂规则，请切换到",-1),t("b",null,"专业模式",-1),c("。 ",-1)])]),_:1})])):(o(),S("div",jh,[e(J,{modelValue:m.value,"onUpdate:modelValue":E[3]||(E[3]=K=>m.value=K)},{default:a(()=>[(o(),S(ce,null,fe(g,K=>e(M,{key:K.value,value:K.value,label:K.label},{default:a(()=>[t("div",Nh,[e(R,{modelValue:y.value[K.value].type,"onUpdate:modelValue":G=>y.value[K.value].type=G,direction:"vertical"},{default:a(()=>[e(_,{value:"every"},{default:a(()=>[c(I(K.value==="week"?"不指定 (?)":`每${K.label} (*)`),1)]),_:2},1024),K.value!=="week"?(o(),D(_,{key:0,value:"interval"},{default:a(()=>[E[10]||(E[10]=c(" 周期: 从 ",-1)),e(H,{modelValue:y.value[K.value].start,"onUpdate:modelValue":G=>y.value[K.value].start=G,min:K.min,max:K.max,size:"small",theme:"column",style:{width:"60px"}},null,8,["modelValue","onUpdate:modelValue","min","max"]),c(" "+I(K.label)+"开始，每 ",1),e(H,{modelValue:y.value[K.value].step,"onUpdate:modelValue":G=>y.value[K.value].step=G,min:1,max:K.max,size:"small",theme:"column",style:{width:"60px"}},null,8,["modelValue","onUpdate:modelValue","max"]),c(" "+I(K.label)+"执行一次 ",1)]),_:2},1024)):N("",!0),K.value!=="week"?(o(),D(_,{key:1,value:"specific"},{default:a(()=>[c("指定: 选择具体的"+I(K.label),1)]),_:2},1024)):N("",!0),K.value==="week"?(o(),D(_,{key:2,value:"specific"},{default:a(()=>[...E[11]||(E[11]=[c("指定周几",-1)])]),_:1})):N("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),y.value[K.value].type==="specific"?(o(),S("div",Kh,[e(x,{modelValue:y.value[K.value].specifics,"onUpdate:modelValue":G=>y.value[K.value].specifics=G,options:K.value==="week"?L:V(K.value),class:"grid-checkbox"},null,8,["modelValue","onUpdate:modelValue","options"])])):N("",!0)])]),_:2},1032,["value","label"])),64))]),_:1},8,["modelValue"])])),t("div",qh,[t("div",Gh,[E[14]||(E[14]=t("span",{class:"label"},"当前表达式:",-1)),t("div",Hh,[c(I(w.value)+" ",1),k.value?(o(),D(W,{key:1,theme:"danger",variant:"light",size:"small"},{default:a(()=>[e(b(xs)),E[13]||(E[13]=c(" 无效",-1))]),_:1})):(o(),D(W,{key:0,theme:"success",variant:"light",size:"small"},{default:a(()=>[e(b(Vt)),E[12]||(E[12]=c(" 有效",-1))]),_:1}))])]),t("div",Jh,[t("div",Wh,[e(b(pt)),E[15]||(E[15]=c(" 最近 5 次运行时间预测:",-1))]),k.value?(o(),S("div",Xh,I(k.value),1)):(o(),S("ul",Qh,[(o(!0),S(ce,null,fe(C.value,(K,G)=>(o(),S("li",{key:G},[t("span",Yh,"#"+I(G+1),1),c(" "+I(K),1)]))),128))]))])])])]),_:1},8,["visible"])}}}),ey=ue(Zh,[["__scopeId","data-v-b81cfe41"]]),Kt="https://mslx.mslmc.cn",Xt={cron:`${Kt}/docs/server-config/crons`,style:`${Kt}/docs/style/webpanel/`,style_log_colorizer:`${Kt}/docs/style/webpanel/#%E7%BB%88%E7%AB%AF%E6%97%A5%E5%BF%97%E6%9F%93%E8%89%B2%E7%AD%89%E7%BA%A7%E9%85%8D%E7%BD%AE`,remote_access:`${Kt}/docs/config/remote-access/`,msl_oauth:`${Kt}/docs/config/msl-oauth`},ty={class:"page-container"},ay={class:"page-header"},sy={key:0,class:"create-container"},ly={class:"container-header"},ny={class:"title"},oy={class:"setting-item"},iy={class:"setting-control"},ry={class:"setting-item"},uy={class:"setting-control"},dy={class:"setting-item"},cy={class:"setting-control"},my={key:0,class:"setting-item"},py={class:"setting-info"},vy={class:"title"},fy={class:"desc"},gy={class:"setting-control"},_y={class:"setting-item"},hy={class:"setting-control"},yy={class:"form-actions"},by={class:"task-list"},wy={key:0,class:"empty-state"},ky={class:"card-left"},$y={class:"task-header-row"},xy={class:"task-name"},Ay={class:"task-meta-row"},Cy={class:"cron-display"},Sy=["title"],Iy={class:"card-right"},Vy=ne({__name:"CronTasks",setup(s){const l=et(),n=se(()=>parseInt(l.params.serverId)),u=$([]),i=$(!1),d=$(!1),f=$(null),r=$(!1),m=$(null),g=$(!1),y=$({id:"",name:"",cron:"",type:"command",payload:"",enable:!0}),L=[{label:"发送命令 (Command)",value:"command"},{label:"备份存档 (Backup)",value:"backup"},{label:"开启服务器 (Start)",value:"start"},{label:"停止服务器 (Stop)",value:"stop"},{label:"重启服务器 (Restart)",value:"restart"}],A={name:[{required:!0,message:"必填",trigger:"blur"}],cron:[{required:!0,message:"必填",trigger:"blur"}],type:[{required:!0,message:"必选",trigger:"change"}],payload:[{validator:F=>y.value.type==="command"&&!F?{result:!1,message:"命令内容不能为空",type:"error"}:!0,trigger:"blur"}]},P=async()=>{if(n.value){i.value=!0;try{const F=await zh(n.value);u.value=F||[]}catch(F){B.error(F.message||"获取列表失败")}finally{i.value=!1}}},w=()=>{d.value||(y.value={id:"",name:"",cron:"",type:"command",payload:"",enable:!0},f.value=null,d.value=!0)},C=F=>{y.value={id:F.id,name:F.name,cron:F.cron,type:F.type.toLowerCase(),payload:F.payload,enable:F.enable},f.value=F.id,d.value=!0,window.scrollTo({top:0,behavior:"smooth"})},k=()=>{d.value=!1,f.value=null},z=async()=>{if(await m.value?.validate()===!0){r.value=!0;try{f.value?(await Rh(n.value,y.value.id,y.value.name,y.value.cron,y.value.payload,y.value.type,y.value.enable),B.success("更新成功")):(await Ph(n.value,y.value.name,y.value.cron,y.value.payload,y.value.type,y.value.enable),B.success("创建成功")),k(),P()}catch(R){B.error(R.message||"操作失败")}finally{r.value=!1}}},p=F=>{const R=st.confirm({header:"确认删除?",body:`确定删除任务 "${F.name}" 吗？`,theme:"danger",onConfirm:async()=>{try{await Eh(F.id),B.success("已删除"),P(),R.hide()}catch(H){B.error(H.message)}},onClose:()=>R.hide()})},V=F=>{y.value.cron=F},h=F=>{const R=F.toLowerCase();return R==="start"?Ot:R==="stop"?pa:R==="restart"?Ze:Et},E=F=>{const R=F.toLowerCase();return R==="start"?"success":R==="stop"?"danger":R==="restart"?"warning":"primary"};return be(()=>n.value,P),Ie(P),(F,R)=>{const H=v("t-button"),q=v("t-space"),U=v("t-input"),_=v("t-select"),x=v("t-textarea"),M=v("t-switch"),J=v("t-form"),W=v("t-tag"),X=v("t-loading");return o(),S("div",ty,[t("div",ay,[R[10]||(R[10]=t("div",{class:"section-title"},"定时计划任务",-1)),e(q,null,{default:a(()=>[d.value?N("",!0):(o(),D(H,{key:0,theme:"default",onClick:R[0]||(R[0]=K=>b(Me)(b(Xt).cron))},{icon:a(()=>[e(b(ua))]),default:a(()=>[R[8]||(R[8]=c(" 使用文档 ",-1))]),_:1})),d.value?N("",!0):(o(),D(H,{key:1,theme:"primary",onClick:w},{icon:a(()=>[e(b(vt))]),default:a(()=>[R[9]||(R[9]=c(" 创建新任务 ",-1))]),_:1}))]),_:1})]),e(Yt,{name:"slide-fade"},{default:a(()=>[d.value?(o(),S("div",sy,[t("div",ly,[t("span",ny,I(f.value?"编辑任务":"创建新任务"),1),e(H,{size:"small",variant:"text",onClick:k},{default:a(()=>[e(b(Da))]),_:1})]),e(J,{ref_key:"formRef",ref:m,data:y.value,rules:A,"label-width":"0"},{default:a(()=>[t("div",oy,[R[11]||(R[11]=t("div",{class:"setting-info"},[t("div",{class:"title"},"任务名称"),t("div",{class:"desc"},"给这个计划任务起个容易识别的名字，例如“每日自动重启”")],-1)),t("div",iy,[e(U,{modelValue:y.value.name,"onUpdate:modelValue":R[1]||(R[1]=K=>y.value.name=K),placeholder:"请输入任务名称"},null,8,["modelValue"])])]),t("div",ry,[R[13]||(R[13]=t("div",{class:"setting-info"},[t("div",{class:"title"},"触发规则 (Cron)"),t("div",{class:"desc"},"使用 Cron 表达式定义执行时间。支持秒级精度 (秒 分 时 日 月 周)")],-1)),t("div",uy,[e(U,{modelValue:y.value.cron,"onUpdate:modelValue":R[2]||(R[2]=K=>y.value.cron=K),placeholder:"例如: 0 0 12 * * ?"},null,8,["modelValue"]),e(H,{variant:"outline",theme:"default",onClick:R[3]||(R[3]=K=>g.value=!0)},{default:a(()=>[...R[12]||(R[12]=[c(" 表达式生成器 ",-1)])]),_:1})])]),t("div",dy,[R[14]||(R[14]=t("div",{class:"setting-info"},[t("div",{class:"title"},"执行操作"),t("div",{class:"desc"},"选择触发时要执行的动作类型")],-1)),t("div",cy,[e(_,{modelValue:y.value.type,"onUpdate:modelValue":R[4]||(R[4]=K=>y.value.type=K),options:L},null,8,["modelValue"])])]),y.value.type==="command"||y.value.type==="restart"?(o(),S("div",my,[t("div",py,[t("div",vy,I(y.value.type==="restart"?"重启提示语":"控制台命令"),1),t("div",fy,I(y.value.type==="restart"?"重启前发送给全服玩家的倒计时提示消息":"不需要加 /，直接输入命令内容"),1)]),t("div",gy,[e(x,{modelValue:y.value.payload,"onUpdate:modelValue":R[5]||(R[5]=K=>y.value.payload=K),autosize:{minRows:2,maxRows:5},placeholder:"请输入内容..."},null,8,["modelValue"])])])):N("",!0),t("div",_y,[R[15]||(R[15]=t("div",{class:"setting-info"},[t("div",{class:"title"},"启用状态"),t("div",{class:"desc"},"暂时禁用此任务而不删除它")],-1)),t("div",hy,[e(M,{modelValue:y.value.enable,"onUpdate:modelValue":R[6]||(R[6]=K=>y.value.enable=K)},null,8,["modelValue"])])]),t("div",yy,[e(H,{theme:"primary",loading:r.value,onClick:z},{icon:a(()=>[e(b(Rs))]),default:a(()=>[c(" "+I(f.value?"保存修改":"立即创建"),1)]),_:1},8,["loading"]),e(H,{theme:"default",variant:"base",onClick:k},{default:a(()=>[...R[16]||(R[16]=[c("取消",-1)])]),_:1})])]),_:1},8,["data"])])):N("",!0)]),_:1}),e(X,{loading:i.value,"show-overlay":""},{default:a(()=>[t("div",by,[u.value.length===0&&!i.value?(o(),S("div",wy,"暂无任务，请点击上方创建")):N("",!0),(o(!0),S(ce,null,fe(u.value,K=>(o(),S("div",{key:K.id,class:"task-card"},[t("div",ky,[t("div",$y,[e(W,{size:"small",theme:K.enable?"success":"warning",variant:"light",class:"status-tag"},{default:a(()=>[c(I(K.enable?"运行中":"已暂停"),1)]),_:2},1032,["theme"]),t("span",xy,I(K.name),1)]),t("div",Ay,[e(W,{size:"small",variant:"outline",theme:E(K.type),style:{"margin-right":"8px"}},{icon:a(()=>[(o(),D(it(h(K.type))))]),default:a(()=>[c(" "+I(K.type.toUpperCase()),1)]),_:2},1032,["theme"]),t("span",Cy,[e(b(pt)),c(" "+I(K.cron),1)])]),K.payload?(o(),S("div",{key:0,class:"task-payload",title:K.payload},I(K.payload),9,Sy)):N("",!0)]),t("div",Iy,[e(H,{variant:"text",theme:"primary",onClick:G=>C(K)},{icon:a(()=>[e(b(Ms))]),default:a(()=>[R[17]||(R[17]=c(" 编辑 ",-1))]),_:1},8,["onClick"]),e(H,{variant:"text",theme:"danger",onClick:G=>p(K)},{icon:a(()=>[e(b(mt))]),default:a(()=>[R[18]||(R[18]=c(" 删除 ",-1))]),_:1},8,["onClick"])])]))),128))])]),_:1},8,["loading"]),e(ey,{visible:g.value,"onUpdate:visible":R[7]||(R[7]=K=>g.value=K),"initial-value":y.value.cron,onConfirm:V},null,8,["visible","initial-value"])])}}}),My=ue(Vy,[["__scopeId","data-v-98dd2a72"]]),Uy={class:"settings-container"},Ly={class:"setting-item"},By={class:"setting-info"},zy={class:"desc"},Py={class:"setting-control"},Ry={key:0,class:"bulk-action-bar"},Ey={class:"selected-text"},Ty={class:"backup-table-wrapper"},Fy={class:"file-name-cell"},Dy={class:"time-cell"},Oy=ne({__name:"BackupManager",setup(s){const l=et(),n=se(()=>{const w=l.params.serverId;return w?parseInt(w):NaN}),u=$(!1),i=$([]),d=$([]),f=[{colKey:"row-select",type:"multiple",width:20,fixed:"left"},{colKey:"fileName",title:"文件名",ellipsis:!0,width:200},{colKey:"fileSizeStr",title:"文件大小",width:120},{colKey:"createTime",title:"备份时间",width:180},{colKey:"op",title:"操作",fixed:"right",width:140}],r=w=>new Promise(C=>setTimeout(C,w)),m=async()=>{if(n.value){u.value=!0,d.value=[];try{const w=await rr(n.value);i.value=w.data||w}catch(w){B.error("获取备份列表失败: "+w.message)}finally{u.value=!1}}},g=w=>{d.value=w},y=w=>{const C=st.confirm({header:"确认删除备份?",body:`您确定要永久删除文件 "${w.fileName}" 吗？此操作不可恢复。`,theme:"danger",onConfirm:async()=>{C.hide();try{await Ea(n.value,w.fileName),B.success("删除成功"),await m()}catch(k){B.error(k.message||"删除失败")}},onClose:()=>{C.hide()}})},L=w=>{try{const C=Ta(n.value,w.fileName);window.open(C,"_blank")}catch(C){B.error("下载失败！"+C.message)}},A=()=>{const w=d.value.length;w!==0&&(B.info(`开始下载 ${w} 个文件，请注意允许浏览器弹窗...`),d.value.forEach((C,k)=>{setTimeout(()=>{const z=Ta(n.value,C);window.open(z,"_blank")},k*1e3)}))},P=()=>{const w=d.value.length;if(w===0)return;const C=st.confirm({header:"确认批量删除?",body:`您选中了 ${w} 个备份文件。删除后无法恢复，确定要继续吗？`,theme:"danger",onConfirm:async()=>{C.hide(),u.value=!0;let k=0,z=0,p=null;try{for(const[V,h]of d.value.entries()){p&&B.close(p),p=B.loading(`正在删除 ${h} (${V+1}/${w})...`,0);try{await Ea(n.value,h),k++}catch(E){z++,console.error(`删除 ${h} 失败`,E)}V<w-1&&await r(800)}}finally{p&&B.close(p),u.value=!1,z===0?B.success(`批量删除完成，共删除 ${k} 个文件`):B.warning(`批量操作完成：成功 ${k} 个，失败 ${z} 个`),await m()}},onClose:()=>{C.hide()}})};return be(()=>l.params.serverId,w=>{w&&m()}),Ie(()=>{m()}),(w,C)=>{const k=v("t-button"),z=v("t-tooltip"),p=v("t-space"),V=v("t-table");return o(),S("div",Uy,[C[10]||(C[10]=t("div",{class:"setting-group-title"},"备份管理",-1)),t("div",Ly,[t("div",By,[C[4]||(C[4]=t("div",{class:"title"},"存档快照",-1)),t("div",zy,[C[0]||(C[0]=c(" 查看和管理服务器的自动或手动备份。建议定期下载重要备份到本地保存。 ",-1)),C[1]||(C[1]=t("br",null,null,-1)),C[2]||(C[2]=c(" 当前共有 ",-1)),t("b",null,I(i.value.length),1),C[3]||(C[3]=c(" 个备份文件。最大保存备份文件的数量需要在实例设置中配置。 ",-1))])]),t("div",Py,[e(Yt,{name:"fade",mode:"out-in"},{default:a(()=>[d.value.length>0?(o(),S("div",Ry,[C[7]||(C[7]=t("div",{class:"bar-separator"},null,-1)),t("span",Ey,"已选 "+I(d.value.length)+" 项",1),e(k,{variant:"text",theme:"primary",onClick:A},{default:a(()=>[...C[5]||(C[5]=[c(" 下载 ",-1)])]),_:1}),e(k,{variant:"text",theme:"danger",onClick:P},{default:a(()=>[...C[6]||(C[6]=[c(" 删除 ",-1)])]),_:1})])):(o(),D(k,{key:1,theme:"primary",variant:"outline",onClick:m},{icon:a(()=>[e(b(Ze))]),default:a(()=>[C[8]||(C[8]=c(" 刷新列表 ",-1))]),_:1}))]),_:1})])]),t("div",Ty,[e(V,{"row-key":"fileName",data:i.value,columns:f,loading:u.value,"selected-row-keys":d.value,stripe:"",hover:"",class:"custom-table",onSelectChange:g},{fileName:a(({row:h})=>[t("div",Fy,[e(b(Ht),{style:{"margin-right":"6px",color:"var(--td-brand-color)"}}),t("span",null,I(h.fileName),1)])]),createTime:a(({row:h})=>[t("div",Dy,[e(b(pt),{style:{"margin-right":"6px",color:"var(--td-text-color-placeholder)"}}),c(" "+I(h.createTime),1)])]),op:a(({row:h})=>[e(p,null,{default:a(()=>[e(z,{content:"下载备份"},{default:a(()=>[e(k,{variant:"text",shape:"square",theme:"primary",onClick:E=>L(h)},{default:a(()=>[e(b(va))]),_:1},8,["onClick"])]),_:2},1024),e(z,{content:"删除备份"},{default:a(()=>[e(k,{variant:"text",shape:"square",theme:"danger",onClick:E=>y(h)},{default:a(()=>[e(b(mt))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),empty:a(()=>[...C[9]||(C[9]=[t("div",{class:"empty-state"},"暂无备份记录",-1)])]),_:1},8,["data","loading","selected-row-keys"])])])}}}),jy=ue(Oy,[["__scopeId","data-v-e5d92c81"]]),Ny={class:"layout-container"},Ky={class:"sidebar"},qy=["onClick"],Gy={class:"nav-text"},Hy={class:"main-content"},Jy={key:0,class:"panel-wrapper"},Wy={key:1,class:"panel-wrapper"},Xy={key:2,class:"panel-wrapper"},Qy={key:3,class:"panel-wrapper"},Yy={key:4,class:"panel-wrapper"},Zy=ne({__name:"InstanceSettings",setup(s,{expose:l}){const n=$(!1),u=$(0),i=[{label:"实例设置",icon:_a},{label:"插件/模组",icon:zl},{label:"服务器属性",icon:Pl},{label:"定时任务",icon:pt},{label:"备份管理",icon:Rl}];return l({open:()=>{n.value=!0}}),(f,r)=>{const m=v("t-dialog");return o(),D(m,{visible:n.value,"onUpdate:visible":r[0]||(r[0]=g=>n.value=g),header:"实例配置",width:"90%",top:"3vh",attach:"body",footer:!1,class:"settings-dialog"},{default:a(()=>[t("div",Ny,[t("div",Ky,[(o(),S(ce,null,fe(i,(g,y)=>t("div",{key:y,class:$e(["nav-item",{active:u.value===y}]),onClick:L=>u.value=y},[(o(),D(it(g.icon),{class:"nav-icon"})),t("span",Gy,I(g.label),1)],10,qy)),64))]),t("div",Hy,[u.value===0?(o(),S("div",Jy,[e(T_)])):N("",!0),u.value===1?(o(),S("div",Wy,[e(bh)])):N("",!0),u.value===2?(o(),S("div",Xy,[e(Bh,{"instance-id":21})])):N("",!0),u.value===3?(o(),S("div",Qy,[e(My)])):N("",!0),u.value===4?(o(),S("div",Yy,[e(jy)])):N("",!0)])])]),_:1},8,["visible"])}}}),eb=ue(Zy,[["__scopeId","data-v-5ce426cf"]]),tb={class:"monitor-container"},ab={class:"status-header"},sb={class:"status-text"},lb={class:"monitor-content"},nb={class:"monitor-block"},ob={class:"info-item"},ib={class:"label"},rb={class:"value"},ub={class:"monitor-block"},db={class:"info-item"},cb={class:"label"},mb={class:"value"},pb={key:0,class:"sub-val"},na=20,vb=ne({__name:"InstanceMonitor",props:{serverId:{},maxMemory:{},isRunning:{type:Boolean}},setup(s){const l=s,n=la(),u=$(null),i=$(null);let d=null,f=null;const r=$(new Array(na).fill(0)),m=$(new Array(na).fill(0)),g=se(()=>l.maxMemory>0),y=(k,z,p=100)=>({grid:{top:4,right:0,bottom:4,left:0},xAxis:{type:"category",show:!1,boundaryGap:!1},yAxis:{type:"value",min:0,max:p===null?void 0:p,show:!1},series:[{type:"line",data:z,smooth:!0,showSymbol:!1,lineStyle:{width:2,color:k},areaStyle:{color:new Gs(0,0,0,1,[{offset:0,color:k.replace(")",", 0.2)").replace("rgb","rgba")},{offset:1,color:"transparent"}])}}]}),L=()=>{const k=getComputedStyle(document.documentElement),z=k.getPropertyValue("--td-brand-color").trim()||"#0052d9",p=k.getPropertyValue("--td-warning-color").trim()||"#e37318";if(u.value&&(d=da(u.value),d.setOption(y(z,r.value,100))),i.value){f=da(i.value);const V=g.value?100:null;f.setOption(y(p,m.value,V))}window.addEventListener("resize",A)},A=()=>{d?.resize(),f?.resize()},P=se(()=>{const k=n.stats.memBytes/1024/1024;return k>1024?`${(k/1024).toFixed(2)} GB`:`${k.toFixed(0)} MB`}),w=async()=>{l.isRunning&&l.serverId&&(n.setMaxMemory(l.maxMemory),await n.connect(l.serverId))},C=async()=>{await n.disconnect()};return be(()=>l.maxMemory,k=>{if(n.setMaxMemory(k),f){const z=k>0?100:null;f.setOption({yAxis:{max:z===null?void 0:z}})}},{immediate:!0}),be(()=>n.stats,k=>{if(!(!l.isRunning||n.currentServerId!==l.serverId)){if(r.value.push(k.cpu),r.value.length>na&&r.value.shift(),g.value)m.value.push(k.memPercent);else{const z=k.memBytes/1024/1024;m.value.push(z)}m.value.length>na&&m.value.shift(),d?.setOption({series:[{data:r.value}]}),f?.setOption({series:[{data:m.value}]})}},{deep:!0}),be(()=>l.isRunning,async k=>{k?kt(()=>{A(),w()}):(r.value.fill(0),m.value.fill(0),d?.setOption({series:[{data:r.value}]}),f?.setOption({series:[{data:m.value}]}),await C())}),be(()=>l.serverId,async(k,z)=>{k!==z&&(await C(),l.isRunning&&await w())}),Ie(async()=>{await kt(),L(),l.isRunning&&await w()}),Qe(async()=>{window.removeEventListener("resize",A),await C(),d?.dispose(),f?.dispose()}),(k,z)=>(o(),S("div",tb,[t("div",ab,[t("span",sb,[b(n).isConnected?(o(),D(b(es),{key:0,style:{color:"var(--td-success-color)"}})):(o(),D(b(es),{key:1,style:{color:"var(--td-text-color-disabled)"}})),c(" "+I(b(n).isConnected?"连接正常":"正在连接数据流..."),1)]),t("div",{class:$e(["monitor-dot",{active:b(n).isConnected&&s.isRunning}])},null,2)]),t("div",lb,[t("div",nb,[t("div",ob,[t("div",ib,[e(b(Ua)),z[0]||(z[0]=c(" CPU 使用率",-1))]),t("div",rb,I(b(n).stats.cpu.toFixed(1))+" %",1)]),t("div",{ref_key:"cpuChartRef",ref:u,class:"chart-wrapper"},null,512)]),z[2]||(z[2]=t("div",{class:"divider"},null,-1)),t("div",ub,[t("div",db,[t("div",cb,[e(b(El)),z[1]||(z[1]=c(" 内存使用",-1))]),t("div",mb,[c(I(P.value)+" ",1),g.value?(o(),S("span",pb," ("+I(b(n).stats.memPercent.toFixed(1))+"%) ",1)):N("",!0)])]),t("div",{ref_key:"memChartRef",ref:i,class:"chart-wrapper"},null,512)])])]))}}),fb=ue(vb,[["__scopeId","data-v-ddbf668d"]]);async function gb(s){return await Q.get({url:"/api/tools/ai/usage",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${s}`}})}async function _b(s){return await Q.get({url:"/api/tools/ai/models",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${s}`}})}async function hb(s,l,n,u,i,d){return l===""&&(l=null),n===""&&(n=null),await Q.post({url:"/api/tools/ai/analysis",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${s}`},data:{mods:l,plugins:n,core:u,logs:i,model:d,usemd:!0},timeout:300*1e3})}const yb={class:"analysis-container"},bb={class:"panel-left"},wb={class:"form-group"},kb={class:"model-option-item"},$b={class:"form-group"},xb={class:"form-group"},Ab={class:"env-tabs"},Cb={class:"form-group flex-grow"},Sb={class:"action-bar"},Ib={class:"panel-right"},Vb={class:"panel-header"},Mb={class:"stats-tags"},Ub={class:"report-content"},Lb=ne({__name:"LogAnalysis",props:{visible:{type:Boolean},serverId:{}},emits:["update:visible","submit"],setup(s,{emit:l}){const n=et(),u=s,i=l,d=Xe({coreVersion:"",envType:"mods",modsList:"",pluginsList:"",logContent:"",result:"> ✨ 等待日志分析开始······",selectedModel:"Qwen/Qwen3-14B"}),f=$([]),r=Xe({max:0,today:0,extra:0,lastTime:0}),m=$(!1),g=$(!1),y=$(!1);async function L(){const z=await gb(localStorage.getItem("msl-user-token"));if(z.code===200)r.max=z.data.max_per_day,r.extra=z.data.extra_tokens,r.lastTime=z.data.last_use_time,r.today=z.data.today_usage;else{B.error("MSL账号未登录或已失效，请重新登录！"),Me("/frp/create");return}}async function A(){try{g.value=!0,await L();try{const p=await _b(localStorage.getItem("msl-user-token")||"");p.code===200&&(f.value=p.data,!d.selectedModel&&f.value.length>0&&(d.selectedModel=f.value[0].name))}catch(p){B.error("获取模型列表失败"+p.message)}const z=await Qs(u.serverId);d.coreVersion=z.core;try{const p=await Pa(u.serverId,"mods",!1);d.modsList=(p.jarFiles||[]).join(`
`),d.envType="mods"}catch{d.modsList=""}try{const p=await Pa(u.serverId,"plugins",!1);d.pluginsList=(p.jarFiles||[]).join(`
`),d.modsList==""&&(d.envType="plugins")}catch{d.pluginsList=""}try{d.logContent=await ha(u.serverId,"logs/latest.log")}catch{}}catch(z){B.error(z.message)}g.value=!1}be(()=>u.visible,z=>{n.name==="InstanceConsole"&&(m.value=z,z&&A())});const P=()=>{i("update:visible",!1)};async function w(){if(d.logContent){if(!d.selectedModel){B.warning("请先选择分析模型");return}y.value=!0,d.result="> ⌛️ 分析日志中··· 请稍等";try{const z=await hb(localStorage.getItem("msl-user-token"),d.modsList,d.pluginsList,d.coreVersion,d.logContent,d.selectedModel);d.result=z.data.content}catch(z){d.result=`> ❌ 分析出现错误: ${z.message}`}y.value=!1,await L()}}const C=Cs(),k=$(C.value?"dark":"light");return be(C,()=>{k.value=C.value?"dark":"light"}),(z,p)=>{const V=v("t-tag"),h=v("t-option"),E=v("t-select"),F=v("t-input"),R=v("t-radio-button"),H=v("t-radio-group"),q=v("t-textarea"),U=v("t-button"),_=v("t-loading"),x=v("t-dialog");return o(),D(x,{visible:m.value,"onUpdate:visible":p[6]||(p[6]=M=>m.value=M),width:"90%",top:"3vh",footer:!1,"close-on-overlay-click":!1,class:"log-analysis-dialog",onClose:P},{header:a(()=>[...p[7]||(p[7]=[t("div",{class:"dialog-title"},[t("span",{style:{display:"flex","align-items":"center",gap:"8px"}}," AI 错误日志分析 ")],-1)])]),default:a(()=>[e(_,{loading:g.value},{default:a(()=>[t("div",yb,[t("div",bb,[t("div",wb,[p[8]||(p[8]=t("div",{class:"label"},"选择分析模型",-1)),e(E,{modelValue:d.selectedModel,"onUpdate:modelValue":p[0]||(p[0]=M=>d.selectedModel=M),placeholder:"请选择AI模型",filterable:""},{default:a(()=>[(o(!0),S(ce,null,fe(f.value,M=>(o(),D(h,{key:M.name,value:M.name,label:M.name},{default:a(()=>[t("div",kb,[t("span",null,I(M.name),1),e(V,{size:"small",variant:"light",theme:"default"},{default:a(()=>[c(" 倍率: "+I(M.rate)+"x ",1)]),_:2},1024)])]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),t("div",$b,[p[9]||(p[9]=t("div",{class:"label"},"服务端核心/版本",-1)),e(F,{modelValue:d.coreVersion,"onUpdate:modelValue":p[1]||(p[1]=M=>d.coreVersion=M),readonly:"",placeholder:"例如: Arclight 1.21.1"},{"prefix-icon":a(()=>[e(b(Jt))]),_:1},8,["modelValue"])]),t("div",xb,[p[12]||(p[12]=t("div",{class:"label"},"环境列表",-1)),t("div",Ab,[e(H,{modelValue:d.envType,"onUpdate:modelValue":p[2]||(p[2]=M=>d.envType=M),variant:"default-filled",class:"custom-radio-group"},{default:a(()=>[e(R,{value:"mods"},{default:a(()=>[e(b(Jt),{class:"mr-1"}),p[10]||(p[10]=c(" 模组 (Mods) ",-1))]),_:1}),e(R,{value:"plugins"},{default:a(()=>[e(b(Va),{class:"mr-1"}),p[11]||(p[11]=c(" 插件 (Plugins) ",-1))]),_:1})]),_:1},8,["modelValue"])]),Je(e(q,{modelValue:d.modsList,"onUpdate:modelValue":p[3]||(p[3]=M=>d.modsList=M),readonly:"",autosize:{minRows:4,maxRows:6},placeholder:"暂无模组数据...",class:"mt-2 readonly-textarea"},null,8,["modelValue"]),[[at,d.envType==="mods"]]),Je(e(q,{modelValue:d.pluginsList,"onUpdate:modelValue":p[4]||(p[4]=M=>d.pluginsList=M),readonly:"",autosize:{minRows:4,maxRows:6},placeholder:"暂无插件数据...",class:"mt-2 readonly-textarea"},null,8,["modelValue"]),[[at,d.envType==="plugins"]])]),t("div",Cb,[p[13]||(p[13]=t("div",{class:"label"},"错误日志内容",-1)),e(q,{modelValue:d.logContent,"onUpdate:modelValue":p[5]||(p[5]=M=>d.logContent=M),placeholder:"没找到有效日志，您可以手动粘贴日志......",class:"log-textarea"},null,8,["modelValue"])]),t("div",Sb,[e(U,{loading:y.value,block:"",theme:"primary",size:"large",onClick:w},{icon:a(()=>[e(b(Tl))]),default:a(()=>[p[14]||(p[14]=c(" 开始 AI 诊断 ",-1))]),_:1},8,["loading"])])]),t("div",Ib,[t("div",Vb,[p[15]||(p[15]=t("span",{class:"title"},"AI 分析报告",-1)),t("div",Mb,[e(V,{theme:"default",variant:"light",size:"small"},{icon:a(()=>[e(b(Fl))]),default:a(()=>[c(" 今日: "+I(r.today)+" / "+I(r.max),1)]),_:1}),e(V,{theme:"primary",variant:"light",size:"small"},{icon:a(()=>[e(b(Ht))]),default:a(()=>[c(" 额外: "+I(r.extra),1)]),_:1}),e(V,{theme:"warning",variant:"light",size:"small"},{icon:a(()=>[e(b(pt))]),default:a(()=>[c(" 上次: "+I(b(Zs)(r.lastTime)),1)]),_:1})])]),t("div",Ub,[e(b(Ss),{"editor-id":"report-preview","model-value":d.result,theme:k.value,class:"md-preview-wrapper"},null,8,["model-value","theme"])])])])]),_:1},8,["loading"])]),_:1},8,["visible"])}}}),Bb=ue(Lb,[["__scopeId","data-v-23739d50"]]),zb={class:"dialog-body-container"},Pb={class:"global-toolbar"},Rb={class:"panel-content"},Eb={class:"custom-item-layout"},Tb={class:"player-info"},Fb={class:"name"},Db={class:"player-actions"},Ob={key:1,class:"empty-state"},jb={class:"panel-content"},Nb={class:"custom-item-layout"},Kb={class:"player-info"},qb={class:"info-text"},Gb={class:"name"},Hb={class:"sub-text"},Jb={class:"player-actions"},Wb={key:1,class:"empty-state"},Xb={class:"panel-content"},Qb={class:"input-toolbar"},Yb={class:"custom-item-layout"},Zb={class:"player-info"},e0={class:"name"},t0={class:"player-actions"},a0={key:1,class:"empty-state"},s0={class:"panel-content"},l0={class:"input-toolbar"},n0={key:0},o0={class:"input-toolbar"},i0={class:"custom-item-layout"},r0={class:"player-info",style:{"align-items":"flex-start"}},u0={class:"info-text"},d0={class:"name",style:{color:"var(--td-error-color)"}},c0={class:"sub-text",style:{"white-space":"normal"}},m0={class:"player-actions"},p0={key:1,class:"empty-state"},v0={key:1},f0={class:"input-toolbar"},g0={class:"custom-item-layout"},_0={class:"player-info info-text"},h0={class:"name",style:{color:"var(--td-error-color)"}},y0={class:"sub-text",style:{"white-space":"normal"}},b0={class:"player-actions"},w0={key:1,class:"empty-state"},k0={class:"panel-content"},$0={class:"input-toolbar"},x0={class:"custom-item-layout"},A0={class:"player-info"},C0={class:"name"},S0={class:"player-actions"},I0={key:1,class:"empty-state"},V0=ne({__name:"PlayerManagerDialog",props:{visible:{type:Boolean},serverId:{},isRunning:{type:Boolean}},emits:["update:visible"],setup(s,{emit:l}){const n=et(),u=s,i=l,d=la(),f=$("online"),r=$("player"),m=$(!1),g=$("command"),y=$([]),L=$([]),A=$([]),P=$([]),w=$([]),C=$([]),k=$(""),z=$(""),p=$(""),V=$(""),h=$("");be(()=>u.isRunning,K=>{K?g.value="command":g.value="api"},{immediate:!0}),be([()=>u.visible,f,r],async([K])=>{n.name!=="InstanceConsole"||!K||E()});const E=async()=>{m.value=!0;try{f.value==="online"&&u.isRunning?y.value=await Ys(u.serverId):f.value==="history"?L.value=await kr(u.serverId):f.value==="whitelist"?A.value=await dr(u.serverId):f.value==="ops"?P.value=await pr(u.serverId):f.value==="banned"&&(r.value==="player"?w.value=await gr(u.serverId):C.value=await yr(u.serverId))}catch(K){B.error(`获取数据失败: ${K.message}`)}finally{m.value=!1}},F=async(K,G,Le)=>{try{g.value==="command"&&u.isRunning?(await d.sendCommand(G),B.success("已发送指令"),setTimeout(()=>E(),1e3)):(await K(),B.success(Le),E())}catch(ve){B.error(`操作失败: ${ve.message}`)}},R=async(K,G)=>{if(!u.isRunning)return B.warning("实例未运行");try{await d.sendCommand(K),B.success(G),setTimeout(()=>E(),1500)}catch(Le){B.error(`执行失败: ${Le.message}`)}},H=async(K=z.value)=>{if(!K)return B.warning("请输入玩家ID");await F(()=>vr(u.serverId,K),`op ${K}`,"添加管理员成功"),K===z.value&&(z.value="")},q=async K=>{await F(()=>fr(u.serverId,K),`deop ${K}`,"移除管理员成功")},U=async(K=k.value)=>{if(!K)return B.warning("请输入玩家ID");await F(()=>cr(u.serverId,K),`whitelist add ${K}`,"添加白名单成功"),K===k.value&&(k.value="")},_=async K=>{await F(()=>mr(u.serverId,K),`whitelist remove ${K}`,"移除白名单成功")},x=async(K=p.value)=>{if(!K)return B.warning("请输入玩家ID");const G=V.value?` ${V.value}`:"";await F(()=>_r(u.serverId,K,V.value),`ban ${K}${G}`,"封禁玩家成功"),K===p.value&&(p.value="",V.value="")},M=async K=>{await F(()=>hr(u.serverId,K),`pardon ${K}`,"解封玩家成功")},J=async()=>{if(!h.value)return B.warning("请输入IP地址");const K=V.value?` ${V.value}`:"";await F(()=>br(u.serverId,h.value,V.value),`ban-ip ${h.value}${K}`,"封禁IP成功"),h.value="",V.value=""},W=async K=>{await F(()=>wr(u.serverId,K),`pardon-ip ${K}`,"解封IP成功")},X=()=>i("update:visible",!1);return(K,G)=>{const Le=v("t-radio-button"),ve=v("t-radio-group"),Re=v("t-tooltip"),he=v("t-button"),Se=v("t-avatar"),Be=v("t-space"),ze=v("t-list-item"),de=v("t-list"),me=v("t-tab-panel"),Ee=v("t-input"),oe=v("t-tag"),T=v("t-popconfirm"),j=v("t-tabs"),le=v("t-dialog");return o(),D(le,{attach:"body",visible:s.visible,header:"玩家管理",width:"min(800px, 95vw)",placement:"center",footer:!1,onClose:X},{default:a(()=>[t("div",zb,[t("div",Pb,[e(Re,{content:"指令模式直接与服务端交互，API模式直接修改配置文件",placement:"bottom"},{default:a(()=>[e(ve,{modelValue:g.value,"onUpdate:modelValue":G[0]||(G[0]=Z=>g.value=Z),variant:"default-filled",size:"small",disabled:!s.isRunning},{default:a(()=>[e(Le,{value:"api"},{default:a(()=>[...G[15]||(G[15]=[c("API 模式",-1)])]),_:1}),e(Le,{value:"command"},{default:a(()=>[...G[16]||(G[16]=[c("指令优先",-1)])]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),e(he,{variant:"text",theme:"primary",size:"small",loading:m.value,onClick:E},{icon:a(()=>[e(b(Ze))]),default:a(()=>[G[17]||(G[17]=c(" 刷新 ",-1))]),_:1},8,["loading"])]),e(j,{modelValue:f.value,"onUpdate:modelValue":G[14]||(G[14]=Z=>f.value=Z),theme:"card",class:"manager-tabs"},{default:a(()=>[e(me,{value:"online",label:"在线玩家"},{label:a(()=>[e(b(Es),{style:{"margin-right":"4px"}}),G[18]||(G[18]=c(" 在线玩家",-1))]),default:a(()=>[t("div",Rb,[y.value.length>0?(o(),D(de,{key:0,split:!0,class:"custom-list"},{default:a(()=>[(o(!0),S(ce,null,fe(y.value,Z=>(o(),D(ze,{key:Z,class:"custom-list-item"},{default:a(()=>[t("div",Eb,[t("div",Tb,[e(Se,{shape:"round",image:`https://minotar.net/helm/${Z}/32.png`},null,8,["image"]),t("span",Fb,I(Z),1)]),t("div",Db,[e(Be,{class:"action-space","break-line":""},{default:a(()=>[e(he,{size:"small",variant:"text",theme:"primary",onClick:te=>H(Z)},{default:a(()=>[...G[19]||(G[19]=[c("设为 OP",-1)])]),_:1},8,["onClick"]),e(he,{size:"small",variant:"text",theme:"warning",onClick:te=>q(Z)},{default:a(()=>[...G[20]||(G[20]=[c("撤销 OP",-1)])]),_:1},8,["onClick"]),e(he,{size:"small",variant:"text",theme:"success",onClick:te=>U(Z)},{default:a(()=>[...G[21]||(G[21]=[c("加白",-1)])]),_:1},8,["onClick"]),e(he,{size:"small",variant:"text",theme:"danger",onClick:te=>R(`kick ${Z} 被管理员踢出`,`已踢出 ${Z}`)},{default:a(()=>[...G[22]||(G[22]=[c("踢出",-1)])]),_:1},8,["onClick"]),e(he,{size:"small",variant:"text",theme:"danger",onClick:te=>x(Z)},{default:a(()=>[...G[23]||(G[23]=[c("封禁",-1)])]),_:1},8,["onClick"])]),_:2},1024)])])]),_:2},1024))),128))]),_:1})):(o(),S("div",Ob,[e(b(Dl),{size:"48px",style:{color:"var(--td-text-color-placeholder)","margin-bottom":"12px"}}),t("p",null,I(s.isRunning?"当前没有玩家在线":"服务器未运行"),1)]))])]),_:1}),e(me,{value:"history",label:"历史玩家"},{label:a(()=>[e(b(pt),{style:{"margin-right":"4px"}}),G[24]||(G[24]=c(" 历史玩家",-1))]),default:a(()=>[t("div",jb,[L.value.length>0?(o(),D(de,{key:0,split:!0,class:"custom-list"},{default:a(()=>[(o(!0),S(ce,null,fe(L.value,Z=>(o(),D(ze,{key:Z.uuid,class:"custom-list-item"},{default:a(()=>[t("div",Nb,[t("div",Kb,[e(Se,{shape:"round",image:`https://minotar.net/helm/${Z.name}/32.png`},null,8,["image"]),t("div",qb,[t("span",Gb,I(Z.name),1),t("span",Hb,"UUID: "+I(Z.uuid.split("-")[0])+"...",1)])]),t("div",Jb,[e(Be,{class:"action-space","break-line":""},{default:a(()=>[e(he,{size:"small",variant:"text",theme:"primary",onClick:te=>H(Z.name)},{default:a(()=>[...G[25]||(G[25]=[c("设为 OP",-1)])]),_:1},8,["onClick"]),e(he,{size:"small",variant:"text",theme:"success",onClick:te=>U(Z.name)},{default:a(()=>[...G[26]||(G[26]=[c("加白名单",-1)])]),_:1},8,["onClick"]),e(he,{size:"small",variant:"text",theme:"danger",onClick:te=>x(Z.name)},{default:a(()=>[...G[27]||(G[27]=[c("封禁",-1)])]),_:1},8,["onClick"])]),_:2},1024)])])]),_:2},1024))),128))]),_:1})):(o(),S("div",Wb,"无历史登录记录"))])]),_:1}),e(me,{value:"ops",label:"管理员"},{label:a(()=>[e(b(Ls),{style:{"margin-right":"4px"}}),G[28]||(G[28]=c(" 管理员",-1))]),default:a(()=>[t("div",Xb,[t("div",Qb,[e(Ee,{modelValue:z.value,"onUpdate:modelValue":G[1]||(G[1]=Z=>z.value=Z),placeholder:"输入玩家游戏ID",onEnter:G[2]||(G[2]=Z=>H()),clearable:""},null,8,["modelValue"]),e(he,{theme:"primary",onClick:G[3]||(G[3]=Z=>H())},{icon:a(()=>[e(b(vt))]),default:a(()=>[G[29]||(G[29]=c(" 添加",-1))]),_:1})]),P.value.length>0?(o(),D(de,{key:0,split:!0,class:"custom-list"},{default:a(()=>[(o(!0),S(ce,null,fe(P.value,Z=>(o(),D(ze,{key:Z.uuid,class:"custom-list-item"},{default:a(()=>[t("div",Yb,[t("div",Zb,[e(Se,{shape:"round",image:`https://minotar.net/helm/${Z.name}/32.png`},null,8,["image"]),t("span",e0,[c(I(Z.name)+" ",1),e(oe,{theme:"success",variant:"light",size:"small"},{default:a(()=>[c("等级: "+I(Z.level),1)]),_:2},1024)])]),t("div",t0,[e(T,{content:"确定要撤销该管理员吗？",theme:"danger",onConfirm:te=>q(Z.name)},{default:a(()=>[e(he,{size:"small",variant:"text",theme:"danger"},{icon:a(()=>[e(b(mt))]),default:a(()=>[G[30]||(G[30]=c(" 移除",-1))]),_:1})]),_:1},8,["onConfirm"])])])]),_:2},1024))),128))]),_:1})):(o(),S("div",a0,"暂无管理员记录"))])]),_:1}),e(me,{value:"banned",label:"黑名单"},{label:a(()=>[e(b(ga),{style:{"margin-right":"4px"}}),G[31]||(G[31]=c(" 黑名单",-1))]),default:a(()=>[t("div",s0,[t("div",l0,[e(ve,{modelValue:r.value,"onUpdate:modelValue":G[4]||(G[4]=Z=>r.value=Z),variant:"default-filled"},{default:a(()=>[e(Le,{value:"player"},{default:a(()=>[...G[32]||(G[32]=[c("玩家封禁",-1)])]),_:1}),e(Le,{value:"ip"},{default:a(()=>[...G[33]||(G[33]=[c("IP 封禁",-1)])]),_:1})]),_:1},8,["modelValue"])]),r.value==="player"?(o(),S("div",n0,[t("div",o0,[e(Ee,{modelValue:p.value,"onUpdate:modelValue":G[5]||(G[5]=Z=>p.value=Z),placeholder:"输入玩家ID",style:{flex:"1"},clearable:""},null,8,["modelValue"]),e(Ee,{modelValue:V.value,"onUpdate:modelValue":G[6]||(G[6]=Z=>V.value=Z),placeholder:"理由(可选)",style:{flex:"1.5"},clearable:""},null,8,["modelValue"]),e(he,{theme:"danger",onClick:G[7]||(G[7]=Z=>x())},{icon:a(()=>[e(b(vt))]),default:a(()=>[G[34]||(G[34]=c(" 封禁",-1))]),_:1})]),w.value.length>0?(o(),D(de,{key:0,split:!0,class:"custom-list"},{default:a(()=>[(o(!0),S(ce,null,fe(w.value,Z=>(o(),D(ze,{key:Z.uuid,class:"custom-list-item"},{default:a(()=>[t("div",i0,[t("div",r0,[e(Se,{size:"small",shape:"round",image:`https://minotar.net/helm/${Z.name}/32.png`},null,8,["image"]),t("div",u0,[t("span",d0,I(Z.name),1),t("span",c0,"理由: "+I(Z.reason),1)])]),t("div",m0,[e(T,{content:"确定要解封吗？",theme:"warning",onConfirm:te=>M(Z.name)},{default:a(()=>[e(he,{size:"small",variant:"text",theme:"primary"},{default:a(()=>[...G[35]||(G[35]=[c(" 解封",-1)])]),_:1})]),_:1},8,["onConfirm"])])])]),_:2},1024))),128))]),_:1})):(o(),S("div",p0,"暂无被封禁的玩家"))])):(o(),S("div",v0,[t("div",f0,[e(Ee,{modelValue:h.value,"onUpdate:modelValue":G[8]||(G[8]=Z=>h.value=Z),placeholder:"输入IP地址",style:{flex:"1"},clearable:""},null,8,["modelValue"]),e(Ee,{modelValue:V.value,"onUpdate:modelValue":G[9]||(G[9]=Z=>V.value=Z),placeholder:"理由(可选)",style:{flex:"1.5"},clearable:""},null,8,["modelValue"]),e(he,{theme:"danger",onClick:G[10]||(G[10]=Z=>J())},{icon:a(()=>[e(b(vt))]),default:a(()=>[G[36]||(G[36]=c(" 封禁IP",-1))]),_:1})]),C.value.length>0?(o(),D(de,{key:0,split:!0,class:"custom-list"},{default:a(()=>[(o(!0),S(ce,null,fe(C.value,Z=>(o(),D(ze,{key:Z.ip,class:"custom-list-item"},{default:a(()=>[t("div",g0,[t("div",_0,[t("span",h0,I(Z.ip),1),t("span",y0,"理由: "+I(Z.reason),1)]),t("div",b0,[e(T,{content:"确定要解封该IP吗？",theme:"warning",onConfirm:te=>W(Z.ip)},{default:a(()=>[e(he,{size:"small",variant:"text",theme:"primary"},{default:a(()=>[...G[37]||(G[37]=[c(" 解封",-1)])]),_:1})]),_:1},8,["onConfirm"])])])]),_:2},1024))),128))]),_:1})):(o(),S("div",w0,"暂无被封禁的IP"))]))])]),_:1}),e(me,{value:"whitelist",label:"白名单"},{label:a(()=>[e(b(Ts),{style:{"margin-right":"4px"}}),G[38]||(G[38]=c(" 白名单",-1))]),default:a(()=>[t("div",k0,[t("div",$0,[e(Ee,{modelValue:k.value,"onUpdate:modelValue":G[11]||(G[11]=Z=>k.value=Z),placeholder:"输入玩家ID",onEnter:G[12]||(G[12]=Z=>U()),clearable:""},null,8,["modelValue"]),e(he,{theme:"primary",onClick:G[13]||(G[13]=Z=>U())},{icon:a(()=>[e(b(vt))]),default:a(()=>[G[39]||(G[39]=c(" 添加",-1))]),_:1})]),A.value.length>0?(o(),D(de,{key:0,split:!0,class:"custom-list"},{default:a(()=>[(o(!0),S(ce,null,fe(A.value,Z=>(o(),D(ze,{key:Z.uuid,class:"custom-list-item"},{default:a(()=>[t("div",x0,[t("div",A0,[e(Se,{shape:"round",image:`https://minotar.net/helm/${Z.name}/32.png`},null,8,["image"]),t("span",C0,I(Z.name),1)]),t("div",S0,[e(T,{content:"移出白名单？",theme:"danger",onConfirm:te=>_(Z.name)},{default:a(()=>[e(he,{size:"small",variant:"text",theme:"danger"},{icon:a(()=>[e(b(mt))]),default:a(()=>[G[40]||(G[40]=c(" 移除",-1))]),_:1})]),_:1},8,["onConfirm"])])])]),_:2},1024))),128))]),_:1})):(o(),S("div",I0,"白名单为空"))])]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["visible"])}}}),M0=ue(V0,[["__scopeId","data-v-3da0b440"]]),U0={class:"header-row"},L0={class:"title"},B0={key:0,class:"count"},z0={class:"content-area"},P0=["src"],R0={key:1,class:"empty-text"},E0={key:1,class:"empty-text"},T0=ne({__name:"PlayerListCard",props:{serverId:{},status:{}},setup(s){const l=s,n=la(),u=$([]),i=$(!1);let d=null,f=null,r=null;const m=[{content:"设为管理员",value:"op"},{content:"取消管理员",value:"deop"},{content:"踢出服务器",value:"kick",theme:"warning"},{content:"封禁玩家",value:"ban",theme:"error"},{content:"加入白名单",value:"whitelist add"}],g=async()=>{if(l.status!==2){u.value=[];return}try{u.value=await Ys(l.serverId)}catch(P){console.error("拉取在线玩家失败:",P)}},y=()=>{d=n.onPlayerJoined?.(P=>{u.value.includes(P)||u.value.push(P)}),f=n.onPlayerLeft?.(P=>{u.value=u.value.filter(w=>w!==P)}),r=n.onPlayerListCleared?.(()=>{u.value=[]})},L=()=>{d?.(),f?.(),r?.()};be(()=>l.status,P=>{P===2?g():u.value=[]}),be(()=>l.serverId,()=>{g()}),Ie(()=>{g(),y()}),Qe(()=>{L()});const A=async(P,w)=>{const C=P.value,z=`${C} ${w}${C==="kick"||C==="ban"?C==="kick"?" 您被控制台踢出了服务器":"您被控制台封禁了":""}`;try{switch(await n.sendCommand(z),C){case"kick":B.success(`已将 ${w} 踢出服务器`);break;case"ban":B.success(`已将 ${w} 封禁`);break;case"op":B.success(`已将 ${w} 设置为服务器管理员`);break;case"deop":B.success(`已取消 ${w} 为服务器管理员`);break;case"whitelist add":B.success(`已将 ${w} 添加到白名单`);break;default:B.success(`针对 ${w} 的指令已发送`);break}}catch(p){B.error(`执行失败: ${p.message}`)}};return(P,w)=>{const C=v("t-button"),k=v("t-tag"),z=v("t-dropdown"),p=v("t-space"),V=v("t-card");return o(),D(V,{bordered:!1,class:"player-list-card"},{default:a(()=>[t("div",U0,[t("div",L0,[e(b(Ts)),w[2]||(w[2]=c(" 在线玩家 ",-1)),s.status===2?(o(),S("span",B0,"("+I(u.value.length)+")",1)):N("",!0)]),e(C,{size:"small",variant:"text",theme:"primary",onClick:w[0]||(w[0]=h=>i.value=!0),disabled:s.status===0},{icon:a(()=>[e(b(_a))]),default:a(()=>[w[3]||(w[3]=c("管理 ",-1))]),_:1},8,["disabled"])]),t("div",z0,[s.status===2?(o(),S(ce,{key:0},[u.value.length>0?(o(),D(p,{key:0,"break-line":"",size:"small"},{default:a(()=>[(o(!0),S(ce,null,fe(u.value,h=>(o(),D(z,{key:h,options:m,trigger:"click",placement:"bottom-left",onClick:E=>A(E,h)},{default:a(()=>[e(k,{class:"player-tag",variant:"light",hoverable:""},{icon:a(()=>[t("img",{src:`https://minotar.net/helm/${h}/16.png`,class:"player-avatar"},null,8,P0)]),default:a(()=>[c(" "+I(h),1)]),_:2},1024)]),_:2},1032,["options","onClick"]))),128))]),_:1})):(o(),S("div",R0,"当前无人在线"))],64)):(o(),S("div",E0,"服务器未运行"))]),e(M0,{visible:i.value,"onUpdate:visible":w[1]||(w[1]=h=>i.value=h),"server-id":s.serverId,"is-running":s.status===2},null,8,["visible","server-id","is-running"])]),_:1})}}}),F0=ue(T0,[["__scopeId","data-v-86fd1435"]]),D0=["src","onLoad"],O0={class:"map-controls"},j0={class:"coord-item"},N0={class:"value"},K0={class:"coord-item"},q0={class:"value"},G0={class:"coord-item"},H0={class:"value"},J0=ne({__name:"MapRender",props:{visible:{type:Boolean},serverId:{}},emits:["update:visible"],setup(s,{emit:l}){const n=s,u=l,i=Fe(),{baseUrl:d,token:f}=i,r=$(1),m=$(0),g=$(0);let y=!1,L=0,A=0;const P=$(0),w=$(0),C=$([]),k=se(()=>{const U=-m.value/r.value,_=-g.value/r.value;return{blockX:Math.round(U),blockZ:Math.round(_),regionX:Math.round(U/512),regionZ:Math.round(_/512)}}),z=(U,_)=>{m.value=-U*r.value,g.value=-_*r.value,h()},p=()=>{const U=Number(P.value)||0,_=Number(w.value)||0;z(U,_)},V=async()=>{try{const U=await $r(n.serverId);P.value=U.x,w.value=U.z,z(U.x,U.z)}catch(U){console.error("获取出生点失败，回退到 0,0",U),P.value=0,w.value=0,z(0,0)}},h=()=>{const U=k.value.regionX,_=k.value.regionZ,x=[];for(let M=-1;M<=1;M++)for(let J=-1;J<=1;J++){const W=U+M,X=_+J,K=`${W}_${X}`;if(!C.value.find(G=>G.key===K)){const G=M*M+J*J;x.push({x:W,z:X,key:K,distance:G})}}x.sort((M,J)=>M.distance-J.distance),x.forEach(M=>{const W=`${d||""}/api/instance/map/${n.serverId}/${M.x}/${M.z}?x-user-token=${f}`;C.value.push({x:M.x,z:M.z,key:M.key,src:W,loaded:!1})})};be(()=>n.visible,U=>{U?(r.value=1,C.value=[],V()):C.value=[]});const E=U=>{y=!0,L=U.clientX-m.value,A=U.clientY-g.value},F=U=>{y&&(m.value=U.clientX-L,g.value=U.clientY-A,h())},R=()=>{y=!1},H=U=>{U.preventDefault();const _=U.deltaY>0?-.1:.1,x=Math.min(Math.max(.2,r.value+_),5),M=x/r.value;m.value=m.value*M,g.value=g.value*M,r.value=x,h()},q=()=>u("update:visible",!1);return(U,_)=>{const x=v("t-input"),M=v("t-button"),J=v("t-space"),W=v("t-dialog");return o(),D(W,{attach:"body",visible:s.visible,header:"世界地图查看器",width:"min(1000px, 95vw)",placement:"center",footer:!1,onClose:q},{default:a(()=>[t("div",{class:"map-viewport",onWheel:H,onMousedown:E,onMousemove:F,onMouseup:R,onMouseleave:R},[t("div",{class:"map-layer",style:nt({transform:`translate(${m.value}px, ${g.value}px) scale(${r.value})`})},[(o(!0),S(ce,null,fe(C.value,X=>(o(),S("div",{key:X.key,class:"tile-wrapper",style:nt({left:`${X.x*512}px`,top:`${X.z*512}px`})},[t("img",{src:X.src,class:$e(["pixel-map-tile",{"is-loaded":X.loaded}]),onLoad:K=>X.loaded=!0,alt:"tile",draggable:"false"},null,42,D0)],4))),128)),_[4]||(_[4]=t("div",{class:"center-crosshair"},null,-1))],4),t("div",{class:"search-panel",onMousedown:_[2]||(_[2]=St(()=>{},["stop"])),onWheel:_[3]||(_[3]=St(()=>{},["stop"]))},[e(J,{align:"center",size:"small"},{default:a(()=>[e(x,{modelValue:P.value,"onUpdate:modelValue":_[0]||(_[0]=X=>P.value=X),type:"number",placeholder:"X 坐标",style:{width:"100px"},onEnter:p},null,8,["modelValue"]),e(x,{modelValue:w.value,"onUpdate:modelValue":_[1]||(_[1]=X=>w.value=X),type:"number",placeholder:"Z 坐标",style:{width:"100px"},onEnter:p},null,8,["modelValue"]),e(M,{theme:"primary",onClick:p},{icon:a(()=>[e(b(Ol))]),default:a(()=>[_[5]||(_[5]=c(" 定位 ",-1))]),_:1}),e(M,{variant:"outline",theme:"default",onClick:V,title:"回到世界出生点"},{icon:a(()=>[e(b(Fs))]),_:1})]),_:1})],32),t("div",O0,[t("div",j0,[_[6]||(_[6]=t("span",{class:"label"},"方块坐标 (Block):",-1)),t("span",N0,"X: "+I(k.value.blockX)+", Z: "+I(k.value.blockZ),1)]),t("div",K0,[_[7]||(_[7]=t("span",{class:"label"},"区块区号 (Region):",-1)),t("span",q0,"r."+I(k.value.regionX)+"."+I(k.value.regionZ),1)]),t("div",G0,[_[8]||(_[8]=t("span",{class:"label"},"缩放倍率:",-1)),t("span",H0,I(Math.round(r.value*100))+"%",1)]),_[9]||(_[9]=t("div",{class:"helper-text"},"🖱️ 滚轮缩放 | 按住拖拽",-1))])],32)]),_:1},8,["visible"])}}}),W0=ue(J0,[["__scopeId","data-v-fabb0038"]]),X0={class:"sidebar-content"},Q0={class:"control-header"},Y0={class:"control-actions"},Z0={key:0,class:"running-action-group"},e2={class:"action-row"},t2={class:"card-content-area"},a2={key:0,class:"info-list"},s2={class:"info-item"},l2={class:"label"},n2={class:"value"},o2={class:"info-item"},i2={class:"label"},r2={class:"value"},u2={class:"info-item"},d2={class:"label"},c2={class:"value"},m2={class:"info-item"},p2={class:"label"},v2={class:"value"},f2={class:"info-item"},g2={class:"label"},_2={class:"value"},h2={class:"info-item"},y2={class:"label"},b2={class:"value"},w2={class:"info-item"},k2={class:"label"},$2={class:"value"},x2={key:1,class:"info-item"},A2={class:"label"},C2={class:"info-item"},S2={class:"label"},I2={class:"value"},V2={key:1,class:"monitor-view"},M2={key:1,class:"monitor-placeholder"},U2=ne({__name:"ServerControlPanel",props:{serverId:{},status:{},loading:{type:Boolean},serverInfo:{}},emits:["start","stop","clear-log","refresh-info","backup","force-exit","restart"],setup(s,{emit:l}){const n=s,u=l,i=se(()=>{switch(n.status){case 1:return{text:"Starting",label:"启动中",theme:"primary",pulse:!0};case 2:return{text:"Running",label:"运行中",theme:"success",pulse:!0};case 3:return{text:"Stopping",label:"停止中",theme:"warning",pulse:!0};case 4:return{text:"Restarting",label:"重启中",theme:"primary",pulse:!0};default:return{text:"Stopped",label:"已停止",theme:"default",pulse:!1}}}),d=$(!1),f=$(!1),r=$(null),m=$("info"),g=()=>{r.value?.open()},y=()=>{u("refresh-info")},L=$(0);let A=null;const P=C=>{if(!C)return 0;const k=C.match(/^(?:(\d+)\.)?(\d{1,2}):(\d{2}):(\d{2})(?:\.\d+)?$/);return k?parseInt(k[1]||"0",10)*86400+parseInt(k[2])*3600+parseInt(k[3])*60+parseInt(k[4]):0},w=se(()=>{if(L.value<=0)return"00:00:00";const C=Math.floor(L.value/86400),k=new Date(L.value*1e3).toISOString().substr(11,8);return C>0?`${C}天 ${k}`:k});return be(()=>n.serverInfo?.uptime,C=>C&&(L.value=P(C)),{immediate:!0}),be(()=>n.status,C=>{C===2?A||(A=window.setInterval(()=>L.value++,1e3)):A&&(clearInterval(A),A=null)},{immediate:!0}),Qe(()=>{A&&clearInterval(A)}),(C,k)=>{const z=v("t-tag"),p=v("t-button"),V=v("t-popconfirm"),h=v("t-dropdown-item"),E=v("t-dropdown-menu"),F=v("t-dropdown"),R=v("t-card"),H=v("t-radio-button"),q=v("t-radio-group");return o(),S("div",X0,[e(R,{bordered:!1,class:"control-card"},{default:a(()=>[t("div",Q0,[t("div",{class:$e(["status-indicator",i.value.theme])},[k[12]||(k[12]=t("span",{class:"pulse"},null,-1)),c(I(i.value.text),1)],2),e(z,{theme:i.value.theme,variant:"light",shape:"round"},{default:a(()=>[c(I(i.value.label),1)]),_:1},8,["theme"])]),t("div",Y0,[s.status===0?(o(),D(p,{key:0,theme:"primary",size:"large",block:"",loading:s.loading,onClick:k[0]||(k[0]=U=>{C.$emit("clear-log"),C.$emit("start")})},{icon:a(()=>[e(b(Ot))]),default:a(()=>[k[13]||(k[13]=c("启动实例 ",-1))]),_:1},8,["loading"])):(o(),S(ce,{key:1},[s.status===2&&!s.loading?(o(),S("div",Z0,[e(V,{content:"确定要停止该实例吗？",onConfirm:k[1]||(k[1]=U=>C.$emit("stop"))},{default:a(()=>[e(p,{class:"stop-btn",theme:"danger",size:"large"},{icon:a(()=>[e(b(pa))]),default:a(()=>[k[14]||(k[14]=c(" 停止 ",-1))]),_:1})]),_:1}),e(V,{content:"确定要重启该实例吗？",onConfirm:k[2]||(k[2]=U=>C.$emit("restart"))},{default:a(()=>[e(p,{theme:"warning",size:"large",shape:"square"},{icon:a(()=>[e(b(Ze))]),_:1})]),_:1})])):N("",!0),s.status===3||s.status===4||s.loading?(o(),D(V,{key:1,content:"确定要强制结束吗？可能会导致数据丢失！",onConfirm:k[3]||(k[3]=U=>C.$emit("force-exit"))},{default:a(()=>[e(p,{class:"force-kill-btn glass-btn",theme:s.loading?"primary":"danger",variant:"outline",block:"",loading:s.loading},{icon:a(()=>[s.loading?N("",!0):(o(),D(b(ga),{key:0}))]),default:a(()=>[c(" "+I(s.loading?"正在处理...":"强制结束"),1)]),_:1},8,["theme","loading"])]),_:1})):N("",!0)],64)),t("div",e2,[e(p,{class:"glass-btn",variant:"outline",block:"",onClick:k[4]||(k[4]=U=>b(Me)(`/instance/files/${s.serverId}`))},{icon:a(()=>[e(b(Tt))]),default:a(()=>[k[15]||(k[15]=c("文件管理 ",-1))]),_:1}),e(p,{class:"glass-btn",variant:"outline",block:"",onClick:g},{icon:a(()=>[e(b(_a))]),default:a(()=>[k[16]||(k[16]=c("实例设置 ",-1))]),_:1})]),e(F,{trigger:"click","min-column-width":120,placement:"bottom"},{default:a(()=>[e(p,{theme:"primary",class:"glass-btn",variant:"outline",block:""},{icon:a(()=>[e(b(Ds))]),default:a(()=>[k[17]||(k[17]=c("更多功能 ",-1))]),_:1}),e(E,null,{default:a(()=>[e(h,{onClick:k[5]||(k[5]=U=>C.$emit("clear-log"))},{"prefix-icon":a(()=>[e(b(Ze))]),default:a(()=>[k[18]||(k[18]=c(" 清空日志 ",-1))]),_:1}),e(h,{disabled:s.status!==2||s.loading,onClick:k[6]||(k[6]=U=>C.$emit("backup"))},{"prefix-icon":a(()=>[e(b(Ut))]),default:a(()=>[k[19]||(k[19]=c(" 立即备份 ",-1))]),_:1},8,["disabled"]),e(h,{onClick:k[7]||(k[7]=U=>f.value=!0)},{"prefix-icon":a(()=>[e(b(jl))]),default:a(()=>[k[20]||(k[20]=c(" 世界渲染图 ",-1))]),_:1}),e(h,{onClick:k[8]||(k[8]=U=>d.value=!0)},{"prefix-icon":a(()=>[e(b(Nl))]),default:a(()=>[k[21]||(k[21]=c(" 日志分析 ",-1))]),_:1})]),_:1})]),_:1})])]),_:1}),e(R,{bordered:!1,title:"实例概览",class:"info-card"},{actions:a(()=>[e(q,{modelValue:m.value,"onUpdate:modelValue":k[9]||(k[9]=U=>m.value=U),variant:"default-filled",size:"small"},{default:a(()=>[e(H,{value:"info"},{default:a(()=>[e(b(Wl)),k[22]||(k[22]=c(" 详情",-1))]),_:1}),e(H,{value:"monitor"},{default:a(()=>[e(b(Xl)),k[23]||(k[23]=c(" 监控",-1))]),_:1})]),_:1},8,["modelValue"])]),default:a(()=>[t("div",t2,[m.value==="info"?(o(),S("div",a2,[t("div",s2,[t("div",l2,[e(b(Kl)),k[24]||(k[24]=c(" 实例名称",-1))]),t("div",n2,I(s.serverInfo?.name),1)]),s.serverInfo?.java!=="none"?(o(),S(ce,{key:0},[t("div",o2,[t("div",i2,[e(b(Ua)),k[25]||(k[25]=c(" 内存限制",-1))]),t("div",r2,I(s.serverInfo?.maxM)+" MB",1)]),k[31]||(k[31]=t("div",{class:"proxy-group"},null,-1)),t("div",u2,[t("div",d2,[e(b(ql)),k[26]||(k[26]=c(" 运行端口",-1))]),t("div",c2,I(s.serverInfo?.mcConfig?.serverPort),1)]),t("div",m2,[t("div",p2,[e(b(Gl)),k[27]||(k[27]=c(" 游戏难度",-1))]),t("div",v2,[e(z,{theme:"primary"},{default:a(()=>[c(I(s.serverInfo?.mcConfig?.difficulty),1)]),_:1})])]),t("div",f2,[t("div",g2,[e(b(Hl)),k[28]||(k[28]=c(" 游戏模式",-1))]),t("div",_2,[e(z,null,{default:a(()=>[c(I(s.serverInfo?.mcConfig?.gamemode),1)]),_:1})])]),t("div",h2,[t("div",y2,[e(b(Tt)),k[29]||(k[29]=c(" 游戏地图",-1))]),t("div",b2,I(s.serverInfo?.mcConfig?.levelName),1)]),t("div",w2,[t("div",k2,[e(b(Jl)),k[30]||(k[30]=c(" 正版验证",-1))]),t("div",$2,[e(z,{theme:s.serverInfo?.mcConfig?.onlineMode==="true"?"success":"warning"},{default:a(()=>[c(I(s.serverInfo?.mcConfig?.onlineMode==="true"?"开启":"关闭"),1)]),_:1},8,["theme"])])])],64)):(o(),S("div",x2,[t("div",A2,[e(b(Ua)),k[32]||(k[32]=c(" 模式",-1))]),k[33]||(k[33]=t("div",{class:"value"},"自定义模式",-1))])),k[35]||(k[35]=t("div",{class:"proxy-group"},null,-1)),t("div",C2,[t("div",S2,[e(b(pt)),k[34]||(k[34]=c(" 运行时长",-1))]),t("div",I2,I(s.status===2?w.value:"--:--:--"),1)])])):m.value==="monitor"?(o(),S("div",V2,[s.serverInfo&&s.status!==0?(o(),D(fb,{key:0,"server-id":s.serverId,"is-running":s.status===2,"max-memory":s.serverInfo.java==="none"?0:s.serverInfo.maxM||4096},null,8,["server-id","is-running","max-memory"])):(o(),S("div",M2,"实例未运行"))])):N("",!0)])]),_:1}),s.serverInfo?.monitorPlayers?(o(),D(F0,{key:0,"server-id":s.serverId,status:s.status},null,8,["server-id","status"])):N("",!0),e(eb,{ref_key:"settingsRef",ref:r,"server-id":s.serverId,onSuccess:y},null,8,["server-id"]),e(Bb,{visible:d.value,"onUpdate:visible":k[10]||(k[10]=U=>d.value=U),"server-id":s.serverId},null,8,["visible","server-id"]),e(W0,{visible:f.value,"onUpdate:visible":k[11]||(k[11]=U=>f.value=U),"server-id":s.serverId},null,8,["visible","server-id"])])}}}),L2=ue(U2,[["__scopeId","data-v-505907a4"]]),B2={class:"console-page"},z2={class:"layout-container"},P2={class:"main-terminal-area"},R2={class:"sidebar-area"},E2={style:{"line-height":"1.6"}},T2={style:{"margin-bottom":"12px"}},F2=ne({__name:"index",setup(s){const l=et(),n=sa(),u=la(),i=$(parseInt(l.params.serverId)||0),d=$(0),f=$(!1),r=$(null),m=$(null);async function g(){if(i.value)try{f.value=!0;const V=await Qs(i.value);await n.refreshInstanceList(),d.value=V.status,r.value=V,f.value=!1}catch(V){m.value?.writeln(`\x1B[1;31m[Error] 获取实例信息失败: ${V.message}\x1B[0m`),f.value=!1}}const y=async()=>{f.value=!0;try{m.value?.writeln("\x1B[1;32m[System] 正在发送启动指令...\x1B[0m"),await Bt(i.value,"start"),B.success("实例启动指令已发送"),f.value=!1}catch(V){m.value?.writeln(`\x1B[1;31m[Error] 启动失败: ${V.message}\x1B[0m`),f.value=!1,d.value=0}},L=async()=>{f.value=!0,d.value=3;try{m.value?.writeln("\x1B[1;32m[System] 正在发送停止指令...\x1B[0m"),await Bt(i.value,"stop"),B.warning("实例停止指令已发送"),f.value=!1,n.refreshInstanceList()}catch(V){m.value?.writeln(`\x1B[1;31m[Error] 停止失败: ${V.message}\x1B[0m`),f.value=!1}},A=async()=>{f.value=!0,d.value=3;try{m.value?.writeln("\x1B[1;32m[System] 正在发送强制退出指令...\x1B[0m"),await Bt(i.value,"forceExit"),B.warning("强制退出指令已发送"),f.value=!1}catch(V){m.value?.writeln(`\x1B[1;31m[Error] 强制退出失败: ${V.message}\x1B[0m`),f.value=!1}},P=async()=>{f.value=!0,d.value=4;try{m.value?.writeln("\x1B[1;32m[System] 正在发送重启指令...\x1B[0m"),await Bt(i.value,"restart"),B.warning("重启执行成功"),f.value=!1,d.value=2}catch(V){m.value?.writeln(`\x1B[1;31m[Error] 重启失败: ${V.message}\x1B[0m`),f.value=!1}},w=async()=>{try{m.value?.writeln("\x1B[1;32m[System] 正在发送备份任务...\x1B[0m"),await Bt(i.value,"backup"),B.success("备份任务启动中···"),f.value=!1}catch(V){m.value?.writeln(`\x1B[1;31m[Error] 备份任务启动失败: ${V.message}\x1B[0m`)}},C=()=>{m.value?.clear()},k=$(!1),z=async()=>{i.value&&(u.onEula(()=>{k.value=!0}),await u.connect(i.value))},p=async V=>{try{k.value=!1,await Bt(i.value,`agreeEula?${V}`),B.success(V?"已发送同意请求":"已发送请求")}catch(h){B.error(h.message||"发送失败")}};return be(()=>l.params.serverId,async V=>{l.name==="InstanceConsole"&&V&&(i.value=parseInt(V),await g())}),Ie(async()=>{i.value&&(await g(),await z())}),(V,h)=>{const E=v("t-link"),F=v("t-dialog");return o(),S("div",B2,[t("div",z2,[t("div",P2,[e(Vg,{ref_key:"terminalRef",ref:m,"server-id":i.value,onUpdate:h[0]||(h[0]=R=>g())},null,8,["server-id"])]),t("div",R2,[e(L2,{"server-id":i.value,status:d.value,loading:f.value,"server-info":r.value,onStart:y,onStop:L,onBackup:w,onClearLog:C,onForceExit:A,onRestart:P},null,8,["server-id","status","loading","server-info"])])]),e(F,{visible:k.value,"onUpdate:visible":h[1]||(h[1]=R=>k.value=R),header:"是否同意EULA","confirm-btn":{content:"同意",theme:"primary"},"cancel-btn":{content:"不同意",theme:"default"},onConfirm:h[2]||(h[2]=R=>p(!0)),onCancel:h[3]||(h[3]=R=>p(!1))},{default:a(()=>[t("div",E2,[t("p",T2,[h[5]||(h[5]=c(" 开启Minecraft服务器需要您同意 ",-1)),h[6]||(h[6]=t("strong",null,"EULA",-1)),h[7]||(h[7]=c(" ！",-1)),e(E,{theme:"primary",underline:""},{default:a(()=>[...h[4]||(h[4]=[c(" (https://aka.ms/minecrafteula)",-1)])]),_:1})]),h[8]||(h[8]=t("p",{style:{"margin-bottom":"12px"}},[t("strong",{style:{color:"#e34d59"}},"请您务必认真仔细阅读！")],-1)),h[9]||(h[9]=t("p",{style:{"margin-bottom":"12px"}},[t("strong",null,"注意："),c("不论您选择是或否，服务器都会在您操作后继续运行。")],-1)),h[10]||(h[10]=t("p",{style:{"margin-bottom":"12px",color:"#f59a23"}},[c(" ⚠️ 如果您"),t("strong",null,"未同意 EULA"),c("，服务器可能会在运行时自动关闭！ ")],-1)),h[11]||(h[11]=t("p",{style:{"margin-top":"16px"}},[c("💡 提示：如要在每次启动实例时忽略此提示，请在"),t("strong",null,"设置"),c("里进行配置。")],-1))])]),_:1},8,["visible"])])}}}),D2=ue(F2,[["__scopeId","data-v-e85241cf"]]),O2=Object.freeze(Object.defineProperty({__proto__:null,default:D2},Symbol.toStringTag,{value:"Module"})),j2={class:"image-wrapper"},N2=["src","alt"],K2={key:1,class:"loading-placeholder"},q2=ne({__name:"ImagePreview",props:{visible:{type:Boolean},fileName:{},imageBlobUrl:{}},emits:["update:visible"],setup(s,{emit:l}){const n=l,u=()=>{n("update:visible",!1)};return(i,d)=>{const f=v("t-dialog");return o(),D(f,{visible:s.visible,header:s.fileName,footer:!1,width:"auto",top:"10vh",class:"image-preview-dialog",onClose:u},{default:a(()=>[t("div",j2,[s.imageBlobUrl?(o(),S("img",{key:0,src:s.imageBlobUrl,alt:s.fileName},null,8,N2)):(o(),S("div",K2,"加载中..."))])]),_:1},8,["visible","header"])}}}),G2=ue(q2,[["__scopeId","data-v-9d5acf17"]]),H2={key:0,class:"compress-form"},J2={class:"file-list-preview"},W2={class:"actions"},X2={key:1,class:"progress-view"},Q2={class:"status-icon"},Y2={class:"status-text"},Z2=ne({__name:"FileCompressor",props:{visible:{type:Boolean},instanceId:{},currentPath:{},files:{}},emits:["update:visible","success"],setup(s,{emit:l}){const n=s,u=l,i=$(""),d=$("idle"),f=$(0),r=$("");let m=null;be(()=>n.visible,P=>{P?(d.value="idle",f.value=0,r.value="",n.files.length>0&&(i.value=`${n.files[0]}_packed.zip`)):g()});const g=()=>{m&&(clearInterval(m),m=null)},y=async()=>{if(!i.value.trim()){B.warning("请输入压缩包名称");return}let P=i.value;P.endsWith(".zip")||(P+=".zip"),d.value="processing",f.value=0,r.value="正在提交任务...";try{const C=(await Ho(n.instanceId,n.files,P,n.currentPath)).taskId;if(C)L(C);else throw new Error("未获取到任务ID")}catch(w){d.value="error",r.value=w.message||"提交失败"}},L=P=>{m=window.setInterval(async()=>{try{const w=await Jo(P);f.value=w.progress,r.value=w.message,w.status==="success"?(g(),d.value="success",f.value=100,setTimeout(()=>{u("success"),u("update:visible",!1)},1e3)):w.status==="error"&&(g(),d.value="error")}catch(w){console.error(w)}},1e3)},A=()=>{d.value==="processing"&&B.warning("后台任务仍在进行中，关闭窗口不会取消任务"),g(),u("update:visible",!1)};return Qe(()=>g()),(P,w)=>{const C=v("t-input"),k=v("t-button"),z=v("t-loading"),p=v("t-progress"),V=v("t-dialog");return o(),D(V,{visible:s.visible,header:d.value==="idle"?"创建压缩包":"正在压缩",footer:!1,"close-on-overlay-click":!1,width:"480px",onClose:A},{default:a(()=>[d.value==="idle"?(o(),S("div",H2,[t("div",J2,[w[1]||(w[1]=c(" 即将压缩 ",-1)),t("span",null,I(s.files.length),1),w[2]||(w[2]=c(" 个文件/文件夹 ",-1))]),e(C,{modelValue:i.value,"onUpdate:modelValue":w[0]||(w[0]=h=>i.value=h),placeholder:"请输入文件名",suffix:".zip",autofocus:"",onEnter:y},null,8,["modelValue"]),t("div",W2,[e(k,{theme:"default",variant:"text",onClick:A},{default:a(()=>[...w[3]||(w[3]=[c("取消",-1)])]),_:1}),e(k,{theme:"primary",onClick:y},{default:a(()=>[...w[4]||(w[4]=[c("开始压缩",-1)])]),_:1})])])):(o(),S("div",X2,[t("div",Q2,[d.value==="processing"?(o(),D(z,{key:0})):d.value==="success"?(o(),D(b(fa),{key:1,style:{color:"var(--td-success-color)","font-size":"40px"}})):d.value==="error"?(o(),D(b(Os),{key:2,style:{color:"var(--td-error-color)","font-size":"40px"}})):N("",!0)]),t("div",Y2,I(r.value),1),e(p,{theme:"plump",percentage:f.value,status:d.value==="error"?"error":d.value==="success"?"success":"active"},null,8,["percentage","status"])]))]),_:1},8,["visible","header"])}}}),ew=ue(Z2,[["__scopeId","data-v-da286579"]]),tw={class:"decompress-container"},aw={class:"file-info"},sw={class:"value"},lw={key:0,class:"form-item"},nw={key:1,class:"switch-row"},ow={key:2,class:"progress-area"},iw={class:"status-header"},rw={class:"status-text"},uw={class:"status-percent"},dw={key:3,class:"actions"},cw=ne({__name:"FileDecompress",props:{visible:{type:Boolean},instanceId:{},currentPath:{},fileName:{}},emits:["update:visible","success"],setup(s,{emit:l}){const n=s,u=l,i=se({get:()=>n.visible,set:p=>u("update:visible",p)}),d=$("auto"),f=$(!0),r=$(!1),m=$(0),g=$(""),y=$("");let L=null;const A=[{label:"自动检测 (推荐)",value:"auto"},{label:"UTF-8 (Linux/Mac通用)",value:"utf-8"},{label:"GBK (Windows传统)",value:"gbk"}],P=()=>{d.value="auto",f.value=!0,r.value=!1,m.value=0,g.value="",y.value="",L&&(clearInterval(L),L=null)};be(()=>n.visible,p=>{p&&P()});const w=()=>{L&&(clearInterval(L),L=null)},C=async()=>{if(!r.value)try{r.value=!0,g.value="正在提交任务...";const p=await Wo(n.instanceId,n.fileName,n.currentPath,d.value,f.value);if(p&&p.taskId)y.value=p.taskId,L=window.setInterval(k,1e3);else throw new Error("未能获取任务ID")}catch(p){B.error(p.message||"提交失败"),r.value=!1}},k=async()=>{if(y.value)try{const p=await Xo(y.value);m.value=p.progress||0,g.value=p.message,p.status==="success"?(w(),B.success("解压成功"),m.value=100,setTimeout(()=>{i.value=!1,u("success")},800)):p.status==="error"&&(w(),r.value=!1,B.error(p.message||"解压出错"))}catch(p){console.error("轮询失败",p)}},z=()=>{r.value&&m.value<100&&B.warning("解压正在后台进行中"),w(),i.value=!1};return(p,V)=>{const h=v("t-select"),E=v("t-switch"),F=v("t-progress"),R=v("t-button"),H=v("t-dialog");return o(),D(H,{visible:i.value,"onUpdate:visible":V[2]||(V[2]=q=>i.value=q),header:"解压文件",footer:!1,"close-on-overlay-click":!r.value,"on-close":z,width:"480px"},{default:a(()=>[t("div",tw,[t("div",aw,[V[3]||(V[3]=t("span",{class:"label"},"目标文件：",-1)),t("span",sw,I(s.fileName),1)]),r.value?N("",!0):(o(),S("div",lw,[V[4]||(V[4]=t("span",{class:"label"},"文件名编码",-1)),e(h,{modelValue:d.value,"onUpdate:modelValue":V[0]||(V[0]=q=>d.value=q),options:A},null,8,["modelValue"])])),r.value?N("",!0):(o(),S("div",nw,[V[5]||(V[5]=t("div",{class:"switch-info"},[t("span",{class:"switch-label"},"创建同名文件夹"),t("span",{class:"switch-tip"},"推荐开启，防止文件散乱在当前目录")],-1)),e(E,{modelValue:f.value,"onUpdate:modelValue":V[1]||(V[1]=q=>f.value=q)},null,8,["modelValue"])])),r.value?(o(),S("div",ow,[t("div",iw,[t("span",rw,I(g.value),1),t("span",uw,I(m.value)+"%",1)]),e(F,{theme:"line",percentage:m.value,label:!1,status:m.value===100?"success":"active"},null,8,["percentage","status"])])):N("",!0),r.value?N("",!0):(o(),S("div",dw,[e(R,{variant:"outline",onClick:z},{default:a(()=>[...V[6]||(V[6]=[c("取消",-1)])]),_:1}),e(R,{theme:"primary",onClick:C},{default:a(()=>[...V[7]||(V[7]=[c("开始解压",-1)])]),_:1})]))])]),_:1},8,["visible","close-on-overlay-click"])}}}),mw=ue(cw,[["__scopeId","data-v-9c603684"]]),pw={class:"permission-form"},vw={class:"presets"},fw={class:"preset-list"},gw={key:0,class:"preset-desc"},_w={key:1,class:"preset-desc"},hw={key:2,class:"preset-desc"},yw=ne({__name:"FilePermission",props:{visible:{type:Boolean},instanceId:{},currentPath:{},targets:{}},emits:["update:visible","success"],setup(s,{emit:l}){const n=s,u=l,i=$({mode:"755"}),d=$(!1),f=[{label:"755 (推荐: 所有者读写执/他人读执)",value:"755"},{label:"777 (全开: 所有权限)",value:"777"},{label:"644 (普通文件: 读写/读)",value:"644"}],r=se(()=>n.targets.length===1?`修改权限 - ${n.targets[0].name}`:`批量修改权限 (${n.targets.length} 项)`);be(()=>n.visible,L=>{L&&n.targets.length>0&&(n.targets.length===1&&n.targets[0].mode&&n.targets[0].mode!=="Unknown"?i.value.mode=n.targets[0].mode:i.value.mode="755")});const m=()=>{u("update:visible",!1),d.value=!1},g=async()=>{if(!i.value.mode||!/^[0-7]{3}$/.test(i.value.mode)){B.warning("请输入正确的3位八进制权限码 (如 755)");return}d.value=!0;let L=0,A=0;try{for(const P of n.targets)try{await Qo(y,P.fullPath,i.value.mode),L++}catch(w){A++,console.error(w)}A===0?B.success("权限修改成功"):B.warning(`完成: 成功 ${L} 个, 失败 ${A} 个`),u("success"),m()}catch(P){B.error(P.message||"请求失败")}finally{d.value=!1}},y=n.instanceId;return(L,A)=>{const P=v("t-input"),w=v("t-form-item"),C=v("t-tag"),k=v("t-dialog");return o(),D(k,{visible:s.visible,header:r.value,"confirm-btn":{content:"保存修改",loading:d.value},"on-close":m,"on-confirm":g,width:"480px"},{default:a(()=>[t("div",pw,[e(w,{label:"权限代码","required-mark":""},{default:a(()=>[e(P,{modelValue:i.value.mode,"onUpdate:modelValue":A[0]||(A[0]=z=>i.value.mode=z),placeholder:"例如: 755",tips:"请输入3位八进制数字 (Linux Chmod)"},null,8,["modelValue"])]),_:1}),t("div",vw,[A[1]||(A[1]=t("div",{class:"preset-label"},"快捷设置：",-1)),t("div",fw,[(o(),S(ce,null,fe(f,z=>e(C,{key:z.value,variant:"light-outline",theme:"primary",class:"preset-tag",style:{cursor:"pointer"},onClick:p=>i.value.mode=z.value},{default:a(()=>[c(I(z.value),1)]),_:2},1032,["onClick"])),64))]),i.value.mode==="755"?(o(),S("div",gw,"适合可执行程序、脚本或文件夹")):N("",!0),i.value.mode==="644"?(o(),S("div",_w,"适合普通配置文件、日志等")):N("",!0),i.value.mode==="777"?(o(),S("div",hw,"允许任何人写入 (不安全)")):N("",!0)])])]),_:1},8,["visible","header","confirm-btn"])}}}),bw=ue(yw,[["__scopeId","data-v-6dc7353c"]]),ww={class:"file-manager-wrapper"},kw={class:"toolbar"},$w={class:"breadcrumb-area"},xw={class:"actions-area"},Aw={key:0},Cw={key:0},Sw={key:0},Iw={class:"table-wrapper"},Vw=["onClick"],Mw={class:"name-text"},Uw={class:"op-actions"},Lw={key:0,class:"selection-bar"},Bw={key:0,class:"selection-info"},zw={key:1,class:"selection-info"},Pw={class:"selection-actions"},Rw={key:0},Ew={key:0},Tw={key:0},Fw={key:0},Dw={key:0},Ow={key:0},jw={key:1,class:"selection-bar clipboard-bar"},Nw={class:"selection-info"},Kw={key:0},qw={key:1},Gw={class:"selection-actions"},Hw=ne({__name:"index",setup(s){const l=et(),n=Qt(),u=se(()=>Number(l.params.serverFilesId)),i=Fe(),d=$(!1),f=$([]),r=$(""),m=$([]),g=$(window.innerWidth),y=se(()=>g.value<768),L=$(!1),A=$(!1),P=$(!1),w=$(!1),C=$(!1),k=$(!1),z=$(!1),p=$(!1),V=$(!1),h=$(""),E=$(""),F=$(""),R=$(!1),H=$(""),q=$(""),U=$(""),_=$(""),x=$(null),M=$([]),J=$(""),W=$([]),X=()=>{g.value=window.innerWidth},K=ae=>{const Y=ae.split(".").pop()?.toLowerCase();return["png","jpg","jpeg","gif","ico","webp","bmp","svg"].includes(Y||"")},G=ae=>{const Y=ae.split(".").pop()?.toLowerCase();return["zip","jar"].includes(Y||"")},Le=ae=>{if(ae.type==="folder"){const _e=ae.name.toLowerCase();return _e==="config"||_e==="settings"?{icon:_a,color:"var(--td-warning-color)"}:_e.startsWith("world")||_e==="level"?{icon:en,color:"var(--td-success-color)"}:["plugins","mods","libraries"].includes(_e)?{icon:Jt,color:"var(--td-brand-color)"}:["logs","crash-reports","cache","temp"].includes(_e)?{icon:Tt,color:"var(--td-gray-color-6)"}:{icon:Tt,color:"var(--td-brand-color)"}}const Y=ae.name.split(".").pop()?.toLowerCase();return["png","jpg","jpeg","gif","ico","webp"].includes(Y||"")?{icon:Ps,color:"var(--td-success-color)"}:["jar","zip","rar","7z","tar","gz"].includes(Y||"")?{icon:Sa,color:"#722ed1"}:["yml","yaml","json","properties","toml","xml","conf","sh","bat","cmd"].includes(Y||"")?{icon:Et,color:"var(--td-warning-color)"}:["log","txt","md","lock"].includes(Y||"")?{icon:Ia,color:"var(--td-gray-color-6)"}:{icon:Ht,color:"var(--td-text-color-secondary)"}},ve=se(()=>f.value.some(ae=>ae.permission&&ae.permission!=="")),Re=se(()=>{const ae={colKey:"row-select",type:"multiple",width:y.value?34:40},Y={colKey:"name",title:"文件名",ellipsis:!0,width:"auto"},_e={colKey:"operation",title:"操作",width:y.value?50:80,align:"center",fixed:y.value?"right":void 0};return y.value?[ae,Y,_e]:[ae,Y,{colKey:"size",title:"大小",width:100,align:"right"},...ve.value?[{colKey:"permission",title:"权限",width:80,align:"center"}]:[],{colKey:"lastModified",title:"修改时间",width:180,align:"center"},_e]}),he=se(()=>{const ae=r.value.split("/").filter(Ne=>Ne),Y=[{name:"根目录",path:""}];let _e="";return ae.forEach(Ne=>{_e=_e?`${_e}/${Ne}`:Ne,Y.push({name:Ne,path:_e})}),Y}),Se=se(()=>m.value.length>0),Be=ae=>{if(ae===0)return"-";const Y=["B","KB","MB","GB","TB"];let _e=0;for(;ae>=1024&&_e<Y.length-1;)ae/=1024,_e++;return`${ae.toFixed(1)} ${Y[_e]}`},ze=ae=>ae?new Date(ae).toLocaleString():"-",de=async()=>{d.value=!0,m.value=[];try{const ae=await Oo(u.value,r.value);f.value=ae||[]}catch(ae){console.error(ae)}finally{d.value=!1}},me=async ae=>{q.value&&(window.URL.revokeObjectURL(q.value),q.value="");const Y=r.value?`${r.value}/${ae}`:ae,_e=B.loading("正在加载图片...");try{const Ne=await Go(u.value,Y);if(!(Ne instanceof Blob))throw new Error("无效数据");q.value=window.URL.createObjectURL(Ne),H.value=ae,A.value=!0,B.close(_e)}catch{B.close(_e),B.error("加载失败")}},Ee=async(ae,Y=!1)=>{if(Y){E.value=ae,F.value="",L.value=!0;return}if(K(ae)){me(ae);return}const _e=r.value?`${r.value}/${ae}`:ae,Ne=B.loading("正在读取文件...");try{const lt=await ha(u.value,_e);E.value=ae,F.value=lt,L.value=!0,B.close(Ne)}catch(lt){B.close(Ne),B.error("读取失败: "+lt.message)}},oe=()=>{U.value="",P.value=!0},T=()=>{if(!U.value.trim()){B.warning("请输入文件名");return}P.value=!1,Ee(U.value,!0)},j=async ae=>{R.value=!0;try{const Y=r.value?`${r.value}/${E.value}`:E.value;await Ha(u.value,Y,ae),B.success("保存成功"),L.value=!1,we()}catch{B.error("保存失败")}finally{R.value=!1}},le=()=>{h.value="",V.value=!0},Z=async()=>{if(!h.value.trim()){B.warning("请输入文件夹名称");return}try{await jo(u.value,r.value,h.value),B.success("文件夹创建成功"),V.value=!1,we()}catch(ae){B.error(`创建失败: ${ae.message||"未知错误"}`)}},te=ae=>{x.value={name:ae.name,fullPath:r.value?`${r.value}/${ae.name}`:ae.name},_.value=ae.name,w.value=!0},O=async()=>{if(!_.value||!x.value)return;const ae=r.value?`${r.value}/${_.value}`:_.value;try{await No(u.value,x.value.fullPath,ae),B.success("重命名成功"),w.value=!1,we()}catch{B.error("重命名失败")}},ie=ae=>{let Y=[];if(ae?Y=[ae.name]:Y=[...m.value],Y.length===0)return;const _e=st.confirm({header:"确认删除",body:`确定要永久删除这 ${Y.length} 项吗？`,theme:"danger",onConfirm:async()=>{try{const Ne=Y.map(lt=>r.value?`${r.value}/${lt}`:lt);await Ko(u.value,Ne),B.success("删除成功"),m.value=[],we(),_e.hide()}catch{B.error("删除失败")}}})},ge=ae=>{if(ae.type==="folder"){const Y=r.value===""?"":"/";r.value=`${r.value}${Y}${ae.name}`}else K(ae.name)?me(ae.name):Ee(ae.name)},ke=ae=>{r.value=ae},we=()=>de(),xe=async ae=>{let Y=[];if(ae?Y=[ae.name]:Y=[...m.value],Y.length===0)return;const{baseUrl:_e,token:Ne}=i,lt=_e.endsWith("/")?_e.slice(0,-1):_e;for(const ht of Y){if(f.value.find(ut=>ut.name===ht)?.type==="folder"){B.warning(`暂不支持下载文件夹: ${ht} 请压缩后再下载！`);continue}const He=r.value?`${r.value}/${ht}`:ht;try{const ut=new URL(`${lt||window.location.origin}/api/files/instance/${u.value}/download`);ut.searchParams.append("path",He),ut.searchParams.append("x-user-token",Ne);const yt=document.createElement("a");yt.href=ut.toString(),yt.style.display="none",yt.download=ht,document.body.appendChild(yt),yt.click(),document.body.removeChild(yt)}catch(ut){console.error(ut),B.error(`创建下载链接失败: ${ht}`)}}ae||(m.value=[])},Pe=()=>{m.value.length!==0&&(M.value=[...m.value],k.value=!0)},Ue=()=>{m.value=[],we()},Ve=ae=>{J.value=ae.name,z.value=!0},Ge=()=>{we()},Ye=ae=>{if(W.value=[],ae)W.value.push({name:ae.name,fullPath:r.value?`${r.value}/${ae.name}`:ae.name,mode:ae.permission||"755"});else{if(m.value.length===0)return;m.value.forEach(Y=>{const _e=f.value.find(Ne=>Ne.name===Y);_e&&W.value.push({name:_e.name,fullPath:r.value?`${r.value}/${_e.name}`:_e.name,mode:_e.permission||"755"})})}p.value=!0},Oe=()=>{m.value=[],we()},ee=()=>we(),Ae=$([]),Ke=$("copy"),qe=$(""),je=se(()=>Ae.value.length>0),De=se(()=>r.value===qe.value),tt=()=>{if(m.value.length===0)return;const ae=m.value.map(Y=>r.value?`${r.value}/${Y}`:Y);Ae.value=ae,Ke.value="copy",qe.value=r.value,m.value=[],B.info(`已复制 ${ae.length} 项，请前往目标目录粘贴`)},ye=()=>{if(m.value.length===0)return;const ae=m.value.map(Y=>r.value?`${r.value}/${Y}`:Y);Ae.value=ae,Ke.value="move",qe.value=r.value,m.value=[],B.info(`已剪切 ${ae.length} 项，请前往目标目录粘贴`)},gt=()=>{Ae.value=[],qe.value="",B.info("已取消操作")},_t=async()=>{if(Ae.value.length===0)return;const ae=B.loading("正在粘贴中...");try{Ke.value==="copy"?await Zo(u.value,Ae.value,r.value):await ei(u.value,Ae.value,r.value),B.success("粘贴成功"),Ae.value=[],we()}catch(Y){B.error(`粘贴失败: ${Y.message||"未知错误"}`)}finally{B.close(ae)}},ot=$(""),At=$("name"),$a=[{label:"名称 (A-Z)",value:"name"},{label:"时间 (最新)",value:"time"},{label:"大小 (从大到小)",value:"size"}],Ce=se(()=>{let ae=[...f.value];if(ot.value){const Y=ot.value.toLowerCase();ae=ae.filter(_e=>_e.name.toLowerCase().includes(Y))}return ae.sort((Y,_e)=>{if(Y.type==="folder"&&_e.type!=="folder")return-1;if(Y.type!=="folder"&&_e.type==="folder")return 1;switch(At.value){case"name":return Y.name.localeCompare(_e.name,"zh-CN",{numeric:!0});case"time":return new Date(_e.lastModified).getTime()-new Date(Y.lastModified).getTime();case"size":return _e.size-Y.size;default:return 0}}),ae});return be(r,ae=>{n.replace({query:{...l.query,path:ae||void 0}}),de()}),be(u,()=>{l.name==="InstanceFiles"&&(r.value="",m.value=[],de())}),Ie(()=>{const ae=l.query.path;window.addEventListener("resize",X),ae?r.value=ae:de()}),Qe(()=>{window.removeEventListener("resize",X)}),(ae,Y)=>{const _e=v("t-breadcrumb-item"),Ne=v("t-breadcrumb"),lt=v("t-input"),ht=v("t-select"),He=v("t-button"),ut=v("t-dropdown"),yt=v("t-tag"),sl=v("t-table"),ll=v("t-card"),xa=v("t-dialog");return o(),S("div",ww,[e(ll,{bordered:!1,class:"file-manager-card"},{default:a(()=>[t("div",kw,[t("div",$w,[e(Ne,{"max-item-width":y.value?"80px":"150px"},{default:a(()=>[(o(!0),S(ce,null,fe(he.value,(re,Nt)=>(o(),D(_e,{key:Nt,class:"crumb-item",onClick:O3=>ke(re.path)},$s({default:a(()=>[c(" "+I(re.name),1)]),_:2},[Nt===0?{name:"icon",fn:a(()=>[e(b(Fs))]),key:"0"}:void 0]),1032,["onClick"]))),128))]),_:1},8,["max-item-width"])]),t("div",xw,[e(lt,{modelValue:ot.value,"onUpdate:modelValue":Y[0]||(Y[0]=re=>ot.value=re),placeholder:"搜索文件...",style:nt({width:y.value?"120px":"200px"})},{"prefix-icon":a(()=>[e(b(ra))]),_:1},8,["modelValue","style"]),e(ht,{modelValue:At.value,"onUpdate:modelValue":Y[1]||(Y[1]=re=>At.value=re),options:$a,style:nt({width:y.value?"110px":"140px"}),placeholder:"排序"},{prefixIcon:a(()=>[e(b(Ql))]),_:1},8,["modelValue","style"]),e(He,{variant:"outline",size:"medium",onClick:Y[2]||(Y[2]=re=>b(Me)(`/instance/console/${u.value}`))},{icon:a(()=>[e(b(Us))]),default:a(()=>[y.value?N("",!0):(o(),S("span",Aw,"控制台"))]),_:1}),e(ut,{options:[{content:"新建文件",value:"file",onClick:oe},{content:"新建文件夹",value:"folder",onClick:le}]},{default:a(()=>[e(He,{variant:"outline",size:"medium"},{icon:a(()=>[e(b(Yl))]),default:a(()=>[y.value?N("",!0):(o(),S("span",Cw,"新建"))]),_:1})]),_:1},8,["options"]),e(He,{theme:"primary",size:"medium",onClick:Y[3]||(Y[3]=re=>C.value=!0)},{icon:a(()=>[e(b(zs))]),default:a(()=>[y.value?N("",!0):(o(),S("span",Sw,"上传"))]),_:1}),e(He,{variant:"outline",size:"medium",onClick:we},{icon:a(()=>[e(b(Ze))]),_:1})])]),t("div",Iw,[e(sl,{"selected-row-keys":m.value,"onUpdate:selectedRowKeys":Y[4]||(Y[4]=re=>m.value=re),data:Ce.value,columns:Re.value,"row-key":"name",loading:d.value,hover:!0,size:"medium",class:"file-table"},{name:a(({row:re})=>[t("div",{class:"file-name-cell",onClick:St(Nt=>ge(re),["stop"])},[(o(),D(it(Le(re).icon),{class:"file-icon",style:nt({color:Le(re).color})},null,8,["style"])),t("span",Mw,I(re.name),1)],8,Vw)]),size:a(({row:re})=>[c(I(Be(re.size)),1)]),permission:a(({row:re})=>[re.permission?(o(),D(yt,{key:0,variant:"light",size:"small"},{default:a(()=>[c(I(re.permission),1)]),_:2},1024)):N("",!0)]),lastModified:a(({row:re})=>[c(I(ze(re.lastModified)),1)]),operation:a(({row:re})=>[t("div",Uw,[e(ut,{placement:y.value?"bottom-right":"bottom",options:[{content:"解压",value:"decompress",onClick:()=>Ve(re),show:G(re.name)&&re.type!=="folder"},{content:K(re.name)?"预览":"编辑",value:"edit",onClick:()=>K(re.name)?me(re.name):Ee(re.name),disabled:re.type==="folder"||G(re.name)},{content:"权限",value:"permission",onClick:()=>Ye(re),show:ve.value},{content:"下载",value:"download",onClick:()=>xe(re)},{content:"重命名",value:"rename",onClick:()=>te(re)},{content:"删除",value:"delete",theme:"error",onClick:()=>ie(re)}].filter(Nt=>Nt.show!==!1)},{default:a(()=>[e(He,{variant:"text",shape:"square",size:"medium"},{default:a(()=>[e(b(Ds))]),_:1})]),_:1},8,["placement","options"])])]),empty:a(()=>[...Y[24]||(Y[24]=[t("div",{class:"empty-state"},"暂无文件",-1)])]),_:1},8,["selected-row-keys","data","columns","loading"])])]),_:1}),e(Yt,{name:"slide-up"},{default:a(()=>[Se.value?(o(),S("div",Lw,[y.value?(o(),S("div",zw,[t("span",null,I(m.value.length),1)])):(o(),S("div",Bw,[Y[25]||(Y[25]=c(" 已选 ",-1)),t("span",null,I(m.value.length),1),Y[26]||(Y[26]=c(" 项 ",-1))])),t("div",Pw,[e(He,{size:"small",variant:"text",theme:"primary",onClick:Y[5]||(Y[5]=re=>tt())},{icon:a(()=>[e(b(js))]),default:a(()=>[y.value?N("",!0):(o(),S("span",Rw,"复制"))]),_:1}),e(He,{size:"small",variant:"text",theme:"primary",onClick:Y[6]||(Y[6]=re=>ye())},{icon:a(()=>[e(b(Zl))]),default:a(()=>[y.value?N("",!0):(o(),S("span",Ew,"剪切"))]),_:1}),e(He,{size:"small",variant:"text",theme:"primary",onClick:Y[7]||(Y[7]=re=>Pe())},{icon:a(()=>[e(b(Sa))]),default:a(()=>[y.value?N("",!0):(o(),S("span",Tw,"压缩"))]),_:1}),e(He,{size:"small",variant:"text",theme:"primary",onClick:Y[8]||(Y[8]=re=>xe())},{icon:a(()=>[e(b(va))]),default:a(()=>[y.value?N("",!0):(o(),S("span",Fw,"下载"))]),_:1}),ve.value?(o(),D(He,{key:0,size:"small",variant:"text",theme:"primary",onClick:Y[9]||(Y[9]=re=>Ye())},{icon:a(()=>[e(b(Zt))]),default:a(()=>[y.value?N("",!0):(o(),S("span",Dw,"权限"))]),_:1})):N("",!0),e(He,{size:"small",variant:"text",theme:"danger",onClick:Y[10]||(Y[10]=re=>ie())},{icon:a(()=>[e(b(mt))]),default:a(()=>[y.value?N("",!0):(o(),S("span",Ow,"删除"))]),_:1}),e(He,{size:"small",variant:"text",onClick:Y[11]||(Y[11]=re=>m.value=[])},{default:a(()=>[...Y[27]||(Y[27]=[c("取消",-1)])]),_:1})])])):je.value?(o(),S("div",jw,[t("div",Nw,[Ke.value==="copy"?(o(),S("span",Kw,"准备复制")):(o(),S("span",qw,"准备移动")),t("span",null,I(Ae.value.length),1),Y[28]||(Y[28]=c(" 项 ",-1))]),t("div",Gw,[e(He,{theme:"primary",disabled:De.value,onClick:_t},{icon:a(()=>[e(b(Ia))]),default:a(()=>[Y[29]||(Y[29]=c(" 粘贴在此处 ",-1))]),_:1},8,["disabled"]),e(He,{variant:"text",theme:"default",onClick:gt},{icon:a(()=>[e(b(Da))]),default:a(()=>[Y[30]||(Y[30]=c(" 取消 ",-1))]),_:1})])])):N("",!0)]),_:1}),e(el,{visible:L.value,"onUpdate:visible":Y[12]||(Y[12]=re=>L.value=re),"file-name":E.value,content:F.value,loading:R.value,onSave:j},null,8,["visible","file-name","content","loading"]),e(xa,{visible:P.value,"onUpdate:visible":Y[14]||(Y[14]=re=>P.value=re),header:"新建文件","on-confirm":T},{default:a(()=>[e(lt,{modelValue:U.value,"onUpdate:modelValue":Y[13]||(Y[13]=re=>U.value=re),placeholder:"输入文件名",autofocus:!0,onEnter:T},null,8,["modelValue"])]),_:1},8,["visible"]),e(xa,{visible:w.value,"onUpdate:visible":Y[16]||(Y[16]=re=>w.value=re),header:"重命名","on-confirm":O},{default:a(()=>[e(lt,{modelValue:_.value,"onUpdate:modelValue":Y[15]||(Y[15]=re=>_.value=re),placeholder:"输入新名称",autofocus:!0,onEnter:O},null,8,["modelValue"])]),_:1},8,["visible"]),e(tl,{visible:C.value,"onUpdate:visible":Y[17]||(Y[17]=re=>C.value=re),"instance-id":u.value,"current-path":r.value,onSuccess:ee},null,8,["visible","instance-id","current-path"]),e(G2,{visible:A.value,"onUpdate:visible":Y[18]||(Y[18]=re=>A.value=re),"file-name":H.value,"image-blob-url":q.value},null,8,["visible","file-name","image-blob-url"]),e(ew,{visible:k.value,"onUpdate:visible":Y[19]||(Y[19]=re=>k.value=re),"instance-id":u.value,"current-path":r.value,files:M.value,onSuccess:Ue},null,8,["visible","instance-id","current-path","files"]),e(mw,{visible:z.value,"onUpdate:visible":Y[20]||(Y[20]=re=>z.value=re),"instance-id":u.value,"current-path":r.value,"file-name":J.value,onSuccess:Ge},null,8,["visible","instance-id","current-path","file-name"]),e(bw,{visible:p.value,"onUpdate:visible":Y[21]||(Y[21]=re=>p.value=re),"instance-id":u.value,"current-path":r.value,targets:W.value,onSuccess:Oe},null,8,["visible","instance-id","current-path","targets"]),e(xa,{visible:V.value,"onUpdate:visible":Y[23]||(Y[23]=re=>V.value=re),header:"新建文件夹","on-confirm":Z},{default:a(()=>[e(lt,{modelValue:h.value,"onUpdate:modelValue":Y[22]||(Y[22]=re=>h.value=re),placeholder:"输入文件夹名称",autofocus:!0,onEnter:Z},null,8,["modelValue"])]),_:1},8,["visible"])])}}}),Jw=ue(Hw,[["__scopeId","data-v-9f616c19"]]),Ww=Object.freeze(Object.defineProperty({__proto__:null,default:Jw},Symbol.toStringTag,{value:"Module"})),Xw=ne({name:"FrameBlank"});function Qw(s,l,n,u,i,d){return o(),S("div")}const Yw=ue(Xw,[["render",Qw]]),Zw=Object.freeze(Object.defineProperty({__proto__:null,default:Yw},Symbol.toStringTag,{value:"Module"}));function bs(){return Q.get({url:"/api/user/me"})}function ws(s){return Q.post({url:"/api/user/me/update",data:s})}function ek(){return Q.get({url:"/api/admin/user/list"})}function tk(s){return Q.post({url:"/api/admin/user/create",data:s})}function ak(s,l){return Q.post({url:`/api/admin/user/update/${s}`,data:l})}function sk(s){return Q.post({url:`/api/admin/user/delete/${s}`})}const lk={class:"user-manage"},nk={class:"toolbar"},ok={class:"left-action"},ik={class:"right-search"},rk={class:"user-info-cell"},uk={class:"text-info"},dk={class:"nickname"},ck={class:"username"},mk={key:0,class:"time-text"},pk={key:1,class:"time-placeholder"},vk={class:"op-buttons"},fk=ne({__name:"index",setup(s){const l=$(!1),n=$([]),u=$(""),i=Fe(),d=$(!1),f=$("create"),r=$(!1),m=Xe({id:"",username:"",name:"",password:"",role:"admin",resetApiKey:!1}),g={username:[{required:!0,message:"请输入用户名",type:"error"}],role:[{required:!0,message:"请选择角色",type:"error"}],password:[{validator:z=>f.value==="create"&&!z?{result:!1,message:"创建用户时密码必填",type:"error"}:!0}]},y=se(()=>[{colKey:"info",title:"用户信息",width:200,fixed:"left",cell:"info-slot"},{colKey:"role",title:"角色",width:100,cell:"role-slot"},{colKey:"lastLogin",title:"最后登录",width:180,cell:"time-slot",className:"hidden-xs"},{colKey:"op",title:"操作",width:140,fixed:"right",cell:"op-slot"}]),L=se(()=>{if(!u.value)return n.value;const z=u.value.toLowerCase();return n.value.filter(p=>p.username.toLowerCase().includes(z)||p.name&&p.name.toLowerCase().includes(z))}),A=async()=>{l.value=!0;try{const z=await ek();n.value=z}catch(z){B.error(z.message||"获取用户列表失败")}finally{l.value=!1}},P=()=>{f.value="create",m.id="",m.username="",m.name="",m.password="",m.role="admin",m.resetApiKey=!1,d.value=!0},w=z=>{f.value="edit",m.id=z.id,m.username=z.username,m.name=z.name,m.password="",m.role=z.role,m.resetApiKey=!1,d.value=!0},C=async({validateResult:z})=>{if(z===!0){r.value=!0;try{f.value==="create"?(await tk({username:m.username,password:m.password,name:m.name,role:m.role}),B.success("用户创建成功")):(await ak(m.id,{name:m.name,password:m.password||void 0,role:m.role,resetApiKey:m.resetApiKey}),B.success("用户更新成功")),d.value=!1,A()}catch(p){B.error(p.message||"操作失败")}finally{r.value=!1}}},k=z=>{const p=st.confirm({header:"删除警告",body:`确定要删除用户 "${z.username}" 吗？此操作不可恢复。`,theme:"danger",onConfirm:async()=>{try{p.hide(),await sk(z.id),B.success("删除成功"),A()}catch(V){B.error(V.message||"删除失败")}}})};return Ie(()=>{A()}),(z,p)=>{const V=v("t-button"),h=v("t-input"),E=v("t-avatar"),F=v("t-tag"),R=v("t-divider"),H=v("t-table"),q=v("t-card"),U=v("t-form-item"),_=v("t-radio-button"),x=v("t-radio-group"),M=v("t-checkbox"),J=v("t-form"),W=v("t-dialog");return o(),S("div",lk,[e(q,{bordered:!1,class:"main-card"},{default:a(()=>[t("div",nk,[t("div",ok,[e(V,{theme:"primary",onClick:P},{icon:a(()=>[e(b(vt))]),default:a(()=>[p[7]||(p[7]=c(" 新增用户 ",-1))]),_:1})]),t("div",ik,[e(h,{modelValue:u.value,"onUpdate:modelValue":p[0]||(p[0]=X=>u.value=X),placeholder:"搜索用户名或昵称",clearable:""},{"prefix-icon":a(()=>[e(b(ra))]),_:1},8,["modelValue"]),e(V,{variant:"text",shape:"square",onClick:A},{icon:a(()=>[e(b(Ze))]),_:1})])]),e(H,{"row-key":"id",data:L.value,columns:y.value,loading:l.value,hover:!0,pagination:{defaultPageSize:20,total:L.value.length,showJumper:!0},class:"user-table","table-layout":"auto"},{"info-slot":a(({row:X})=>[t("div",rk,[e(E,{image:X.avatar,size:"40px",shape:"circle","hide-on-load-failed":!1},{default:a(()=>[c(I(X.name?X.name[0].toUpperCase():"U"),1)]),_:2},1032,["image"]),t("div",uk,[t("div",dk,I(X.name||"未设置昵称"),1),t("div",ck,"@"+I(X.username),1)])])]),"role-slot":a(({row:X})=>[X.role==="admin"?(o(),D(F,{key:0,theme:"success",variant:"light",size:"small",shape:"round"},{default:a(()=>[...p[8]||(p[8]=[c("管理员",-1)])]),_:1})):(o(),D(F,{key:1,theme:"primary",variant:"light",size:"small",shape:"round"},{default:a(()=>[...p[9]||(p[9]=[c("普通用户",-1)])]),_:1}))]),"time-slot":a(({row:X})=>[X.lastLoginTime?(o(),S("span",mk,I(new Date(X.lastLoginTime).toLocaleString()),1)):(o(),S("span",pk,"从未登录"))]),"op-slot":a(({row:X})=>[t("div",vk,[e(V,{variant:"text",theme:"primary",size:"small",onClick:K=>w(X)},{default:a(()=>[...p[10]||(p[10]=[c(" 编辑 ",-1)])]),_:1},8,["onClick"]),e(R,{layout:"vertical"}),e(V,{variant:"text",theme:"danger",size:"small",disabled:X.id===b(i).userInfo.id||X.username==="admin",onClick:K=>k(X)},{default:a(()=>[...p[11]||(p[11]=[c(" 删除 ",-1)])]),_:1},8,["disabled","onClick"])])]),_:1},8,["data","columns","loading","pagination"])]),_:1}),e(W,{visible:d.value,"onUpdate:visible":p[6]||(p[6]=X=>d.value=X),header:f.value==="create"?"新增用户":"编辑用户","confirm-btn":{content:"提交",loading:r.value},"on-confirm":()=>z.$refs.formRef.submit(),width:"480px"},{default:a(()=>[e(J,{ref:"formRef",data:m,rules:g,"label-align":"top",onSubmit:C},{default:a(()=>[e(U,{label:"用户名",name:"username"},{default:a(()=>[e(h,{modelValue:m.username,"onUpdate:modelValue":p[1]||(p[1]=X=>m.username=X),placeholder:"登录账号",disabled:f.value==="edit"},null,8,["modelValue","disabled"])]),_:1}),e(U,{label:"昵称",name:"name"},{default:a(()=>[e(h,{modelValue:m.name,"onUpdate:modelValue":p[2]||(p[2]=X=>m.name=X),placeholder:"显示名称"},null,8,["modelValue"])]),_:1}),e(U,{label:"角色",name:"role"},{default:a(()=>[e(x,{modelValue:m.role,"onUpdate:modelValue":p[3]||(p[3]=X=>m.role=X),variant:"default-filled"},{default:a(()=>[e(_,{value:"user",disabled:""},{default:a(()=>[...p[12]||(p[12]=[c("普通用户",-1)])]),_:1}),e(_,{value:"admin"},{default:a(()=>[...p[13]||(p[13]=[c("管理员",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(U,{label:"密码",name:"password",help:f.value==="edit"?"留空则不修改密码":""},{default:a(()=>[e(h,{modelValue:m.password,"onUpdate:modelValue":p[4]||(p[4]=X=>m.password=X),type:"password",placeholder:"设置密码",autocomplete:"new-password"},null,8,["modelValue"])]),_:1},8,["help"]),f.value==="edit"?(o(),D(U,{key:0,label:"API 密钥"},{default:a(()=>[e(M,{modelValue:m.resetApiKey,"onUpdate:modelValue":p[5]||(p[5]=X=>m.resetApiKey=X)},{default:a(()=>[...p[14]||(p[14]=[c("重置该用户的 API Key",-1)])]),_:1},8,["modelValue"])]),_:1})):N("",!0)]),_:1},8,["data"])]),_:1},8,["visible","header","confirm-btn","on-confirm"])])}}}),gk=ue(fk,[["__scopeId","data-v-d4b06059"]]),_k=Object.freeze(Object.defineProperty({__proto__:null,default:gk},Symbol.toStringTag,{value:"Module"})),hk={class:"profile-header"},yk={class:"avatar-col"},bk={class:"info-col"},wk={class:"main-row"},kk={class:"nickname"},$k={class:"sub-row"},xk={class:"username"},Ak={key:0,class:"last-login"},Ck={key:0,class:"bound-status"},Sk={key:1},Ik=ne({__name:"UserProfileCard",setup(s,{expose:l}){const n=Fe(),u=$(!1),i=$(!1),d=$(!1),f=$(""),r=$(""),m=$("qq"),g=Xe({id:"",username:"",name:"",avatar:"",role:"",apiKey:"",lastLoginTime:"",openMSLID:""}),y=Xe({changePassword:!1,newPassword:"",confirmPassword:""}),L=async()=>{u.value=!0;try{const V=await bs();Object.assign(g,V),f.value=V.username;const h=V.avatar&&V.avatar.match(/nk=(\d+)/);h&&h[1]?(m.value="qq",r.value=h[1]):m.value="custom"}catch(V){B.error(V.message||"用户加载失败")}finally{u.value=!1}};be(r,V=>{m.value==="qq"&&V&&(g.avatar=`https://q.qlogo.cn/g?b=qq&nk=${V}&s=640`)});const A=V=>{V==="qq"&&r.value&&(g.avatar=`https://q.qlogo.cn/g?b=qq&nk=${r.value}&s=640`)},P=()=>{g.apiKey&&navigator.clipboard.writeText(g.apiKey).then(()=>{B.success("API Key 已复制")})},w=()=>{const V=st.confirm({header:"重置 API 密钥",theme:"warning",body:"重置后，所有使用旧 Key 的外部工具将立即失效，确定要继续吗？",onConfirm:async()=>{try{V.hide(),await ws({resetApiKey:!0}),B.success("API Key 重置成功");const h=await bs();g.apiKey=h.apiKey}catch(h){B.error(h.message||"重置失败")}}})},C=async()=>{if(y.changePassword){if(!y.newPassword){B.warning("请输入新密码");return}if(y.newPassword!==y.confirmPassword){B.error("两次输入的密码不一致");return}}const V=g.username!==f.value,h=y.changePassword&&!!y.newPassword;i.value=!0;try{const E={username:g.username,name:g.name,avatar:g.avatar,password:h?y.newPassword:void 0,resetApiKey:!1};await ws(E),y.changePassword=!1,y.newPassword="",y.confirmPassword="",f.value=g.username,B.success("个人信息保存成功"),V||h?st.alert({header:"重新登录",body:"账号或密码已变更，请重新登录以生效。",confirmBtn:"去登录",onConfirm:async()=>{await n.logout(),window.location.reload()}}):await n.getUserInfo()}catch(E){B.error(E.message)}finally{i.value=!1}};l({initData:L});const k=$(!1),z=async()=>{k.value=!0;try{const V=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);localStorage.setItem("oauth_state",V);const h=`${window.location.origin}/oauth/callback?mode=bind`,E=await Q.get({url:"/api/auth/oauth/url",params:{state:V,callback:h}});E&&E.url?window.location.href=E.url:(B.error(E.message||"获取绑定地址失败"),k.value=!1)}catch(V){B.error(V.message||"请求失败"),k.value=!1}},p=()=>{const V=st.confirm({header:"解除绑定",theme:"warning",body:"确定要解除与 MSL 账户的绑定吗？解绑后您将无法使用 MSL 账户快捷登录。",onConfirm:async()=>{try{V.hide(),await Q.post({url:"/api/auth/oauth/unbind"}),B.success("解绑成功"),await L()}catch(h){B.error(h.message||"解绑失败")}}})};return(V,h)=>{const E=v("t-avatar"),F=v("t-tag"),R=v("t-divider"),H=v("t-radio-button"),q=v("t-radio-group"),U=v("t-input"),_=v("t-space"),x=v("t-form-item"),M=v("t-button"),J=v("t-switch"),W=v("t-form"),X=v("t-card");return o(),D(X,{bordered:!1,loading:u.value,class:"settings-card"},{default:a(()=>[t("div",hk,[t("div",yk,[e(E,{image:g.avatar,size:"80px",shape:"circle",class:"user-avatar-shadow"},{default:a(()=>[c(I(g.name?g.name.slice(0,1).toUpperCase():"U"),1)]),_:1},8,["image"])]),t("div",bk,[t("div",wk,[t("span",kk,I(g.name||"未设置昵称"),1),g.role==="admin"?(o(),D(F,{key:0,theme:"success",variant:"light",size:"small",shape:"round"},{default:a(()=>[...h[8]||(h[8]=[c("管理员",-1)])]),_:1})):(o(),D(F,{key:1,theme:"primary",variant:"light",size:"small",shape:"round"},{default:a(()=>[...h[9]||(h[9]=[c("普通用户",-1)])]),_:1}))]),t("div",$k,[t("span",xk,"@"+I(g.username),1),g.lastLoginTime?(o(),S("span",Ak,[e(b(pt)),c(" "+I(new Date(g.lastLoginTime).toLocaleString()),1)])):N("",!0)])])]),e(R),e(W,{ref:"userForm",data:g,"label-width":100,"label-align":"left",onSubmit:C},{default:a(()=>[e(x,{label:"头像设置"},{default:a(()=>[e(_,{direction:"vertical",style:{width:"100%"}},{default:a(()=>[e(q,{modelValue:m.value,"onUpdate:modelValue":h[0]||(h[0]=K=>m.value=K),variant:"default-filled",onChange:A},{default:a(()=>[e(H,{value:"qq"},{default:a(()=>[e(b(tn)),h[10]||(h[10]=c(" QQ头像",-1))]),_:1}),e(H,{value:"custom"},{default:a(()=>[e(b(Mt)),h[11]||(h[11]=c(" 链接",-1))]),_:1})]),_:1},8,["modelValue"]),m.value==="qq"?(o(),D(U,{key:0,modelValue:r.value,"onUpdate:modelValue":h[1]||(h[1]=K=>r.value=K),placeholder:"输入QQ号自动获取",type:"number"},{"prefix-icon":a(()=>[e(b(Es))]),_:1},8,["modelValue"])):(o(),D(U,{key:1,modelValue:g.avatar,"onUpdate:modelValue":h[2]||(h[2]=K=>g.avatar=K),placeholder:"输入图片 URL 链接"},{"prefix-icon":a(()=>[e(b(an))]),_:1},8,["modelValue"]))]),_:1})]),_:1}),e(x,{label:"用户昵称",name:"name"},{default:a(()=>[e(U,{modelValue:g.name,"onUpdate:modelValue":h[3]||(h[3]=K=>g.name=K),placeholder:"显示的名称"},null,8,["modelValue"])]),_:1}),e(x,{label:"登录账号",name:"username"},{default:a(()=>[e(U,{modelValue:g.username,"onUpdate:modelValue":h[4]||(h[4]=K=>g.username=K),placeholder:"登录唯一标识"},null,8,["modelValue"])]),_:1}),e(x,{label:"API Key",help:"用于MSLX桌面版/第三方工具连接的凭证，请妥善保管"},{default:a(()=>[e(U,{value:g.apiKey,type:d.value?"text":"password",readonly:"",placeholder:"点击重置生成 Key"},{suffix:a(()=>[e(M,{variant:"text",size:"small",onClick:P},{icon:a(()=>[e(b(js))]),_:1}),e(M,{variant:"text",theme:"danger",size:"small",onClick:w},{icon:a(()=>[e(b(Ze))]),_:1})]),_:1},8,["value","type"])]),_:1}),b(ma)()?N("",!0):(o(),D(R,{key:0,dashed:""})),b(ma)()?N("",!0):(o(),D(x,{key:1,label:"MSL 账户绑定",help:"绑定后可使用 MSL 账户直接登录本控制台"},{default:a(()=>[g.openMSLID&&g.openMSLID!=="0"?(o(),S("div",Ck,[e(F,{theme:"success",variant:"light",size:"medium"},{icon:a(()=>[e(b(Vt))]),default:a(()=>[c(" 已绑定 (MSL UID: "+I(g.openMSLID)+") ",1)]),_:1}),e(M,{theme:"danger",variant:"text",size:"small",style:{"margin-left":"12px"},onClick:p},{default:a(()=>[...h[12]||(h[12]=[c(" 解除绑定 ",-1)])]),_:1})])):(o(),S("div",Sk,[e(M,{theme:"primary",variant:"outline",loading:k.value,onClick:z},{icon:a(()=>[e(b(Mt))]),default:a(()=>[h[13]||(h[13]=c(" 绑定 MSL 账户 ",-1))]),_:1},8,["loading"])]))]),_:1})),e(R,{dashed:""}),e(x,{label:"修改密码"},{default:a(()=>[e(J,{modelValue:y.changePassword,"onUpdate:modelValue":h[5]||(h[5]=K=>y.changePassword=K)},null,8,["modelValue"])]),_:1}),y.changePassword?(o(),S(ce,{key:2},[e(x,{label:"新密码","required-mark":""},{default:a(()=>[e(U,{modelValue:y.newPassword,"onUpdate:modelValue":h[6]||(h[6]=K=>y.newPassword=K),type:"password",placeholder:"请输入新密码"},{"prefix-icon":a(()=>[e(b(Zt))]),_:1},8,["modelValue"])]),_:1}),e(x,{label:"确认密码","required-mark":""},{default:a(()=>[e(U,{modelValue:y.confirmPassword,"onUpdate:modelValue":h[7]||(h[7]=K=>y.confirmPassword=K),type:"password",placeholder:"请再次输入新密码"},{"prefix-icon":a(()=>[e(b(Vt))]),_:1},8,["modelValue"])]),_:1})],64)):N("",!0),e(x,null,{default:a(()=>[e(M,{theme:"primary",type:"submit",loading:i.value,block:"",class:"action-btn"},{default:a(()=>[...h[14]||(h[14]=[c(" 保存个人资料 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["data"])]),_:1},8,["loading"])}}}),Vk=ue(Ik,[["__scopeId","data-v-66f1e979"]]),Mk={key:1},Uk={class:"status-label"},Lk=ne({__name:"SystemSettingsCard",emits:["refresh"],setup(s,{expose:l,emit:n}){const u=Ja(),i=$(!1),d=$(!1),f=Xe({fireWallBanLocalAddr:!1,openWebConsoleOnLaunch:!0,neoForgeInstallerMirrors:"MSL Mirrors",listenHost:"localhost",listenPort:1027,oAuthMSLClientID:"",oAuthMSLClientSecret:""}),r=[{label:"官方源 (较慢)",value:"Official"},{label:"MSL镜像源 (推荐)",value:"MSL Mirrors"},{label:"MSL镜像源 - 备用",value:"MSL Mirrors Backup"}],m=n,g=async()=>{i.value=!0;try{const P=await Ro();Object.assign(f,P)}catch(P){B.error(P.message||"系统设置加载失败")}finally{i.value=!1}},y=async()=>{d.value=!0;try{await Eo(f),B.success("系统设置保存成功")}catch(P){B.error(P.message)}finally{d.value=!1}},L=()=>{g(),m("refresh")};l({initData:g});const A=$("");return Ie(()=>{A.value=`${window.location.origin}/oauth/callback`}),(P,w)=>{const C=v("t-button"),k=v("t-form-item"),z=v("t-switch"),p=v("t-select"),V=v("t-divider"),h=v("t-input"),E=v("t-icon"),F=v("t-space"),R=v("t-col"),H=v("t-row"),q=v("t-form"),U=v("t-card");return o(),D(U,{bordered:!1,title:"系统偏好设置",loading:i.value,class:"settings-card"},{actions:a(()=>[e(C,{theme:"primary",variant:"text",size:"small",onClick:L},{default:a(()=>[...w[11]||(w[11]=[c("刷新数据",-1)])]),_:1})]),default:a(()=>[e(q,{ref:"sysForm",data:f,"label-width":120,"label-align":"left",onSubmit:y},{default:a(()=>[w[18]||(w[18]=t("div",{class:"group-title"},"守护进程",-1)),e(k,{label:"软件更新",style:{"margin-top":"6px"}},{default:a(()=>[e(C,{theme:"default",loading:b(u).loading,onClick:w[0]||(w[0]=_=>b(u).checkAppUpdate(!0))},{icon:a(()=>[e(b(As))]),default:a(()=>[w[12]||(w[12]=c(" 检查更新 ",-1))]),_:1},8,["loading"])]),_:1}),e(k,{label:"自动打开控制台",help:"MSLX 守护进程启动成功后，是否自动登录网页端控制台。"},{default:a(()=>[e(z,{modelValue:f.openWebConsoleOnLaunch,"onUpdate:modelValue":w[1]||(w[1]=_=>f.openWebConsoleOnLaunch=_)},null,8,["modelValue"])]),_:1}),e(k,{label:"安装镜像源",help:"选择在自动安装 NeoForge / Forge 时所使用的镜像源。",style:{"margin-top":"6px"}},{default:a(()=>[e(p,{modelValue:f.neoForgeInstallerMirrors,"onUpdate:modelValue":w[2]||(w[2]=_=>f.neoForgeInstallerMirrors=_),options:r},null,8,["modelValue"])]),_:1}),b(ma)()?N("",!0):(o(),D(V,{key:0,dashed:""})),b(ma)()?N("",!0):(o(),S("div",Mk,[w[14]||(w[14]=t("div",{class:"group-title"},"MSL OAuth 2.0",-1)),e(k,{label:"Client ID",style:{"margin-top":"6px"}},{default:a(()=>[e(h,{modelValue:f.oAuthMSLClientID,"onUpdate:modelValue":w[3]||(w[3]=_=>f.oAuthMSLClientID=_),placeholder:"请输入 Client ID"},{"prefix-icon":a(()=>[e(b($t))]),_:1},8,["modelValue"])]),_:1}),e(k,{label:"Client Secret",help:"配置MSL OAuth 2.0后即可使用您的MSL账号一键登录您的MSLX控制台。",style:{"margin-top":"16px"}},{default:a(()=>[e(h,{modelValue:f.oAuthMSLClientSecret,"onUpdate:modelValue":w[4]||(w[4]=_=>f.oAuthMSLClientSecret=_),type:"password",placeholder:"请输入 Client Secret"},{"prefix-icon":a(()=>[e(b(ts))]),_:1},8,["modelValue"])]),_:1}),e(k,{label:"回调地址",help:"请将此地址复制并填入 MSL用户中心 OAuth应用配置的 [回调地址] 中",style:{"margin-top":"16px"}},{default:a(()=>[e(h,{value:A.value,readonly:"",placeholder:"正在获取当前域名..."},{"prefix-icon":a(()=>[e(b(Mt))]),suffix:a(()=>[e(C,{variant:"text",shape:"square",onClick:w[5]||(w[5]=_=>b(ia)(A.value,!0,"回调地址复制成功"))},{default:a(()=>[e(E,{name:"file-copy"})]),_:1})]),_:1},8,["value"])]),_:1}),e(k,{style:{"margin-top":"6px"},label:"配置教程"},{default:a(()=>[e(F,{align:"center"},{default:a(()=>[e(C,{theme:"default",onClick:w[6]||(w[6]=_=>b(Me)(b(Xt).msl_oauth))},{icon:a(()=>[e(b(ua))]),default:a(()=>[w[13]||(w[13]=c(" 配置MSL账号快捷登录教程",-1))]),_:1})]),_:1})]),_:1})])),e(V,{dashed:""}),w[19]||(w[19]=t("div",{class:"group-title"},"网络与安全",-1)),e(k,{label:"禁止本地访问",help:"开启后将禁止本地回环地址访问，增强安全性。"},{default:a(()=>[e(F,{align:"center"},{default:a(()=>[e(z,{modelValue:f.fireWallBanLocalAddr,"onUpdate:modelValue":w[7]||(w[7]=_=>f.fireWallBanLocalAddr=_)},null,8,["modelValue"]),t("span",Uk,I(f.fireWallBanLocalAddr?"已开启":"已关闭"),1)]),_:1})]),_:1}),e(k,{label:"监听地址设置",help:"设置MSLX守护进程的监听地址。(需要重启守护进程生效,若不明白这是干什么的请一定不要修改！)",style:{"margin-top":"6px"}},{default:a(()=>[e(H,{gutter:16,style:{width:"100%"}},{default:a(()=>[e(R,{span:6},{default:a(()=>[e(h,{modelValue:f.listenHost,"onUpdate:modelValue":w[8]||(w[8]=_=>f.listenHost=_),placeholder:"localhost"},{"prefix-icon":a(()=>[e(b($t))]),_:1},8,["modelValue"])]),_:1}),e(R,{span:4,style:{display:"flex","align-items":"center"}},{default:a(()=>[w[15]||(w[15]=t("span",{style:{"margin-right":"8px",color:"var(--td-text-color-secondary)"}},":",-1)),e(h,{modelValue:f.listenPort,"onUpdate:modelValue":w[9]||(w[9]=_=>f.listenPort=_),placeholder:"1027",style:{width:"120px"}},{"prefix-icon":a(()=>[e(b(ts))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(k,{style:{"margin-top":"6px"},label:"远程访问"},{default:a(()=>[e(F,{align:"center"},{default:a(()=>[e(C,{theme:"default",onClick:w[10]||(w[10]=_=>b(Me)(b(Xt).remote_access))},{icon:a(()=>[e(b(ua))]),default:a(()=>[w[16]||(w[16]=c(" 配置远程访问说明",-1))]),_:1})]),_:1})]),_:1}),e(k,null,{default:a(()=>[e(C,{theme:"primary",type:"submit",loading:d.value,block:"",class:"action-btn"},{default:a(()=>[...w[17]||(w[17]=[c(" 保存系统设置 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["data"])]),_:1},8,["loading"])}}}),Bk=ue(Lk,[["__scopeId","data-v-65f913a9"]]),zk=ne({__name:"WebPanelStyleCard",setup(s){const l=jt(),n=async(u,i)=>{const d=u[0]?.raw||u.raw;if(!d)return;const f=await l.uploadImage(d);f&&(l.settings[i]=f)};return(u,i)=>{const d=v("t-button"),f=v("t-upload"),r=v("t-input"),m=v("t-form-item"),g=v("t-divider"),y=v("t-slider"),L=v("t-col"),A=v("t-row"),P=v("t-option"),w=v("t-select"),C=v("t-space"),k=v("t-form"),z=v("t-card");return o(),D(z,{bordered:!1,title:"面板自定义样式",description:"背景图相关的样式需要在面板左上角的样式面板中启用背景美化才会生效哦！",loading:b(l).loading,class:"settings-card"},{actions:a(()=>[e(d,{theme:"default",onClick:i[0]||(i[0]=p=>b(Me)(b(Xt).style))},{icon:a(()=>[e(b(ua))]),default:a(()=>[i[13]||(i[13]=c(" 设置文档",-1))]),_:1})]),default:a(()=>[e(k,{data:b(l).settings,"label-width":120,"label-align":"left",onSubmit:b(l).saveSettings},{default:a(()=>[i[16]||(i[16]=t("div",{class:"group-title"},"背景图片设置",-1)),e(m,{label:"浅色背景",help:"留空则使用默认的背景图哦～"},{default:a(()=>[e(r,{modelValue:b(l).settings.webPanelStyleLightBackground,"onUpdate:modelValue":i[2]||(i[2]=p=>b(l).settings.webPanelStyleLightBackground=p),placeholder:"输入完整URL地址或者在右边上传图片"},{suffix:a(()=>[e(f,{theme:"custom",action:"","auto-upload":!1,"show-file-list":!1,accept:"image/png, image/jpeg, image/webp",onChange:i[1]||(i[1]=p=>n(p,"webPanelStyleLightBackground"))},{default:a(()=>[e(d,{variant:"text",shape:"square"},{default:a(()=>[e(b(Ma))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(m,{label:"深色背景"},{default:a(()=>[e(r,{modelValue:b(l).settings.webPanelStyleDarkBackground,"onUpdate:modelValue":i[4]||(i[4]=p=>b(l).settings.webPanelStyleDarkBackground=p),placeholder:"输入完整URL地址或者在右边上传图片"},{suffix:a(()=>[e(f,{theme:"custom","auto-upload":!1,"show-file-list":!1,accept:"image/png, image/jpeg, image/webp",onChange:i[3]||(i[3]=p=>n(p,"webPanelStyleDarkBackground"))},{default:a(()=>[e(d,{variant:"text",shape:"square"},{default:a(()=>[e(b(Ma))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(g,{dashed:""}),i[17]||(i[17]=t("div",{class:"group-title"},"透明度调整 (0.1 - 1.0)",-1)),e(A,{gutter:[32,16]},{default:a(()=>[e(L,{xs:24,sm:12,md:6},{default:a(()=>[e(m,{label:"浅色背景透明度"},{default:a(()=>[e(y,{modelValue:b(l).settings.webPanelStyleLightBackgroundOpacity,"onUpdate:modelValue":i[5]||(i[5]=p=>b(l).settings.webPanelStyleLightBackgroundOpacity=p),min:.1,max:1,step:.01,"tooltip-props":{theme:"light"}},null,8,["modelValue"])]),_:1})]),_:1}),e(L,{xs:24,sm:12,md:6},{default:a(()=>[e(m,{label:"浅色组件透明度"},{default:a(()=>[e(y,{modelValue:b(l).settings.webPanelStyleLightComponentsOpacity,"onUpdate:modelValue":i[6]||(i[6]=p=>b(l).settings.webPanelStyleLightComponentsOpacity=p),min:.1,max:1,step:.01,"tooltip-props":{theme:"light"}},null,8,["modelValue"])]),_:1})]),_:1}),e(L,{xs:24,sm:12,md:6},{default:a(()=>[e(m,{label:"深色背景透明度"},{default:a(()=>[e(y,{modelValue:b(l).settings.webPanelStyleDarkBackgroundOpacity,"onUpdate:modelValue":i[7]||(i[7]=p=>b(l).settings.webPanelStyleDarkBackgroundOpacity=p),min:.1,max:1,step:.01},null,8,["modelValue"])]),_:1})]),_:1}),e(L,{xs:24,sm:12,md:6},{default:a(()=>[e(m,{label:"深色组件透明度"},{default:a(()=>[e(y,{modelValue:b(l).settings.webPanelStyleDarkComponentsOpacity,"onUpdate:modelValue":i[8]||(i[8]=p=>b(l).settings.webPanelStyleDarkComponentsOpacity=p),min:.1,max:1,step:.01},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(g,{dashed:""}),i[18]||(i[18]=t("div",{class:"group-title"},"终端设置(毛玻璃强度/染色设置)",-1)),e(A,{gutter:[32,16]},{default:a(()=>[e(L,{xs:24,sm:12,md:6},{default:a(()=>[e(m,{label:"浅色模式模糊度"},{default:a(()=>[e(y,{modelValue:b(l).settings.webpPanelTerminalBlurLight,"onUpdate:modelValue":i[9]||(i[9]=p=>b(l).settings.webpPanelTerminalBlurLight=p),min:0,max:50,step:1,"input-number-props":{theme:"column",style:"width: 65px"}},{label:a(({value:p})=>[c(I(p)+"px ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(L,{xs:24,sm:12,md:6},{default:a(()=>[e(m,{label:"深色模式模糊度"},{default:a(()=>[e(y,{modelValue:b(l).settings.webpPanelTerminalBlurDark,"onUpdate:modelValue":i[10]||(i[10]=p=>b(l).settings.webpPanelTerminalBlurDark=p),min:0,max:50,step:1,"input-number-props":{theme:"column",style:"width: 65px"}},{label:a(({value:p})=>[c(I(p)+"px ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(L,{xs:24,sm:12,md:6},{default:a(()=>[e(C,null,{default:a(()=>[e(m,{label:"日志染色等级"},{default:a(()=>[e(w,{modelValue:b(l).settings.webPanelColorizeLogLevel,"onUpdate:modelValue":i[11]||(i[11]=p=>b(l).settings.webPanelColorizeLogLevel=p)},{default:a(()=>[e(P,{label:"不染色",value:0}),e(P,{label:"简约染色",value:1}),e(P,{label:"增强染色",value:2})]),_:1},8,["modelValue"])]),_:1}),e(d,{theme:"default",onClick:i[12]||(i[12]=p=>b(Me)(b(Xt).style_log_colorizer))},{icon:a(()=>[e(b(sn))]),default:a(()=>[i[14]||(i[14]=c(" 有什么区别？",-1))]),_:1})]),_:1})]),_:1})]),_:1}),e(m,{style:{"margin-top":"24px"}},{default:a(()=>[e(d,{theme:"primary",type:"submit",loading:b(l).submitLoading,block:"",class:"action-btn"},{default:a(()=>[...i[15]||(i[15]=[c(" 应用样式设置 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["data","onSubmit"])]),_:1},8,["loading"])}}}),Pk=ue(zk,[["__scopeId","data-v-e0f02fd5"]]),Rk={class:"settings-page"},Ek=ne({__name:"index",setup(s){const l=jt(),n=$(),u=$(),i=async()=>{const d=[];n.value&&d.push(n.value.initData()),u.value&&d.push(u.value.initData()),d.push(l.fetchSettings()),await Promise.all(d)};return Ie(()=>{i()}),(d,f)=>{const r=v("t-space");return o(),S("div",Rk,[e(r,{direction:"vertical",size:"large",style:{width:"100%"}},{default:a(()=>[e(Vk,{ref_key:"userCardRef",ref:n},null,512),e(Bk,{ref_key:"sysCardRef",ref:u,onRefresh:i},null,512),e(Pk)]),_:1})])}}}),Tk=ue(Ek,[["__scopeId","data-v-5abf49f6"]]),Fk=Object.freeze(Object.defineProperty({__proto__:null,default:Tk},Symbol.toStringTag,{value:"Module"}));async function Dk(){return await Q.get({url:"/build.json",baseURL:"/",params:{t:Date.now()}})}async function Ok(){return await Q.get({url:"/query/changelogs?software=MSLX",baseURL:"https://api.mslmc.cn/v3"})}const jk="/assets/jpg/mslx-aowu.BKxkpLYR.jpg",Nk={class:"construction-container"},Kk={class:"content-wrapper"},qk={class:"description"},Gk={class:"progress-decoration"},Hk={class:"action-area"},Jk={width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",style:{"margin-right":"4px"}},Wk=ne({__name:"HurryUpppppppp",setup(s){const l=$(0),n=$(!1),u=["开发者收到了你的怨念！(╯°□°）╯︵ ┻━┻","正在疯狂敲击键盘中... 🔥","生产队的驴都不敢这么歇！🐴","别催了别催了，头发已经掉光了！👴","再催就把 Bug 变成 Feature！🐛","服务器正在冒烟... 💥","正在与 Bug 进行殊死搏斗！⚔️","不要急，我在试图理解我昨晚写的代码... 🤔","进度条：99%... (卡住了) 🚫","键盘冒火星子了！灭火器准备！🧯","新建文件夹 (2) - 最终版 - 绝对不改版.zip 📁","404 Developer Not Found 🤖","已读不回 (假的，正在改) 📱","正在向虚空终端请求算力... 🧠","画饼中，请稍后... 🥞","再催我就去提瓦特大陆摸鱼了！🎣","纳西妲说她想吃枣椰蜜糖，没空写代码！🍬","正在虚空终端检索：《如何 1 秒写完代码》... 🧠","知识与你分享，但 Bug 不行！📖","再催？再催就把你关进净善宫陪我一起加班！🏰","陷入了改 Bug 的花神诞祭轮回... 第168次尝试... 🔄","别急，代码还在梦境里生长呢 💤","所有的代码，皆是智慧的结晶（大概）✨","我要去上个厕所，把写不完的焦虑通通冲走！🚽","兰那罗说这行代码它不想修，它想去唱歌 🎶","或许... 我们可以用罐装知识把功能直接灌进去？🤔","这虽然是痛痛，但也是成长的过程... (指修Bug) 🩹"],i=se(()=>l.value===0?"这里正在进行一项神秘的大工程...":l.value<5?"工期正在加急！":l.value<10?"好痛！别点啦！":"呜呜呜，错啦，这就去写代码！😭"),d=()=>{l.value++,n.value=!0,setTimeout(()=>{n.value=!1},500);let f=u[Math.floor(Math.random()*u.length)];l.value>20?(f="键盘已经被敲烂了！求放过！🆘",B.error(f)):B.success(f)};return(f,r)=>{const m=v("t-progress"),g=v("t-button");return o(),S("div",Nk,[t("div",Kk,[t("div",{class:$e(["image-box",{"shake-anim":n.value}])},[...r[0]||(r[0]=[t("img",{src:jk,alt:"施工中",class:"mascot-img"},null,-1),t("div",{class:"halo"},null,-1)])],2),r[2]||(r[2]=t("h1",{class:"main-title"},"嗷呜！Ｏ(≧口≦)Ｏ",-1)),t("p",qk,I(i.value),1),t("div",Gk,[e(m,{theme:"plump",percentage:30+l.value%70,label:!1,status:"active"},null,8,["percentage"])]),t("div",Hk,[e(g,{theme:"primary",size:"large",shape:"round",variant:"base",class:"urge-btn",onClick:d},{icon:a(()=>[(o(),S("svg",Jk,[...r[1]||(r[1]=[t("path",{d:"M8.5 1L2 9h5v6l6.5-8h-5V1z"},null,-1)])]))]),default:a(()=>[c(" 催更 ("+I(l.value)+") ",1)]),_:1})])])])}}}),Xk=ue(Wk,[["__scopeId","data-v-d8b4c962"]]),Qk={class:"about-page"},Yk={class:"intro-header"},Zk={class:"logo-area"},e$={class:"dev-card"},t$={class:"dev-info"},a$={class:"dev-name"},s$={class:"dev-role"},l$=["title"],n$={class:"dev-card"},o$={class:"dev-info"},i$={class:"dev-name"},r$={class:"dev-role",style:{background:"var(--td-success-color-1)",color:"var(--td-success-color-7)"}},u$=["title"],d$={key:0,class:"history-timeline"},c$={class:"timeline-content"},m$={style:{display:"flex","align-items":"center",gap:"8px","margin-bottom":"8px"}},p$={class:"commit-time",style:{"margin-bottom":"0"}},v$={class:"msg",style:{"white-space":"pre-wrap","margin-bottom":"0"}},f$={key:1,style:{"text-align":"center",color:"var(--td-text-color-placeholder)",padding:"20px"}},g$={key:0,class:"build-summary"},_$={class:"info-block"},h$={class:"value version"},y$={class:"info-block"},b$={class:"value time"},w$={class:"info-block"},k$=["title"],$$={class:"sub-value"},x$={class:"info-block"},A$={class:"value framework"},C$={key:1,class:"details-collapse"},S$={class:"panel-header"},I$={class:"history-timeline"},V$={class:"timeline-content"},M$={class:"commit-time"},U$={class:"msg"},L$={class:"meta"},B$={class:"hash"},z$={class:"panel-header"},P$={class:"deps-grid"},R$={class:"dep-item"},E$=["title"],T$=ne({__name:"index",setup(s){const l=[{name:"xiaoyu",role:"Core Developer",avatar:"https://q.qlogo.cn/headimg_dl?dst_uin=1791123970&spec=640&img_type=jpg",desc:"核心开发者"},{name:"Weheal",role:"Core Developer",avatar:"https://q.qlogo.cn/headimg_dl?dst_uin=2035582067&spec=640&img_type=jpg",desc:"核心开发者"}],n=[{name:"GuHanDuRen",role:"Alpha Tester",avatar:"https://q.qlogo.cn/headimg_dl?dst_uin=2778318425&spec=640&img_type=jpg",desc:"最早期内部功能测试"},{name:"邱息",role:"Beta Tester",avatar:"https://q.qlogo.cn/headimg_dl?dst_uin=3687624214&spec=640&img_type=jpg",desc:"提供了宝贵的建议"},{name:"Nebula琳",role:"Beta Tester",avatar:"https://q.qlogo.cn/headimg_dl?dst_uin=3770298358&spec=640&img_type=jpg",desc:"提供了宝贵的建议"},{name:"MSLX Beta 群友们",role:"Members",avatar:"https://p.qlogo.cn/gh/839645854/839645854/0",desc:"感谢各位内测群的群友们！"}],u=$(!0),i=$(null),d=$(!0),f=$([]),r=async()=>{try{u.value=!0,i.value=await Dk()}catch(y){console.error(y),B.warning("无法加载构建信息")}finally{u.value=!1}},m=async()=>{try{d.value=!0;const y=await Ok();y&&(f.value=y)}catch(y){console.error("获取更新日志失败:",y)}finally{d.value=!1}},g=se(()=>i.value?.dependencies?Object.entries(i.value.dependencies).map(([y,L])=>({name:y,version:L})):[]);return Ie(()=>{r(),m()}),(y,L)=>{const A=v("t-card"),P=v("t-avatar"),w=v("t-col"),C=v("t-row"),k=v("t-tag"),z=v("t-timeline-item"),p=v("t-timeline"),V=v("t-divider"),h=v("t-collapse-panel"),E=v("t-collapse"),F=v("t-space");return o(),S("div",Qk,[e(F,{direction:"vertical",size:"large",style:{width:"100%"}},{default:a(()=>[e(A,{bordered:!1,class:"intro-card"},{default:a(()=>[t("div",Yk,[t("div",Zk,[e(b($t),{class:"logo-icon"}),L[0]||(L[0]=t("h1",{class:"project-title"},"关于 MSLX",-1))])]),L[1]||(L[1]=t("div",{class:"intro-text"},[t("p",null,[t("strong",null,"MSLX"),c(" 是由 "),t("strong",null,"MSL 原班团队 MSLTeam"),c(" 倾力打造的全新一代开服工具。 基于 "),t("strong",null,".NET Core 10.0"),c(" 环境。 ")]),t("p",null,[c(" 它传承了 MSL 经典的 UI 设计语言，旨在让操作零门槛——无论是老用户还是新伙伴，都能即刻上手，极速部署您的 MC 服务器。 MSLX 不仅 "),t("strong",null,"完美支持跨平台"),c(" (Windows / macOS / Linux) 运行，相比前代，更引入了强大的 "),t("strong",null,"远程访问"),c(" 功能，让管理更自由。 ")])],-1))]),_:1}),e(A,{bordered:!1,title:"开发团队"},{default:a(()=>[L[2]||(L[2]=t("p",{class:"about-desc"},"感谢以下开发者对本项目的杰出贡献：",-1)),e(C,{gutter:[16,16]},{default:a(()=>[(o(),S(ce,null,fe(l,R=>e(w,{key:R.name,span:3,xs:12,sm:6},{default:a(()=>[t("div",e$,[e(P,{image:R.avatar,size:"56px",shape:"circle",class:"dev-avatar"},null,8,["image"]),t("div",t$,[t("div",a$,I(R.name),1),t("div",s$,I(R.role),1),t("div",{class:"dev-desc",title:R.desc},I(R.desc),9,l$)])])]),_:2},1024)),64))]),_:1})]),_:1}),e(A,{bordered:!1,title:"催更？"},{default:a(()=>[e(Xk)]),_:1}),e(A,{bordered:!1,title:"鸣谢"},{default:a(()=>[L[3]||(L[3]=t("p",{class:"about-desc"},"特别感谢参与内测并提供反馈的伙伴们：",-1)),e(C,{gutter:[16,16]},{default:a(()=>[(o(),S(ce,null,fe(n,R=>e(w,{key:R.name,span:3,xs:12,sm:4,md:4,lg:3},{default:a(()=>[t("div",n$,[e(P,{image:R.avatar,size:"56px",shape:"circle",class:"dev-avatar"},null,8,["image"]),t("div",o$,[t("div",i$,I(R.name),1),t("div",r$,I(R.role),1),t("div",{class:"dev-desc",title:R.desc},I(R.desc),9,u$)])])]),_:2},1024)),64))]),_:1})]),_:1}),e(A,{bordered:!1,title:"更新日志",loading:d.value},{default:a(()=>[f.value.length>0?(o(),S("div",d$,[e(p,null,{default:a(()=>[(o(!0),S(ce,null,fe(f.value,(R,H)=>(o(),D(z,{key:H,"dot-color":"primary"},{default:a(()=>[t("div",c$,[t("div",m$,[e(k,{size:"small",variant:"light",theme:"primary"},{default:a(()=>[c(I(R.version),1)]),_:2},1024),t("div",p$,[e(b(pt),{style:{"margin-right":"4px","font-size":"12px"}}),c(" "+I(R.time),1)])]),t("div",v$,I(R.changes),1)])]),_:2},1024))),128))]),_:1})])):d.value?N("",!0):(o(),S("div",f$," 暂无更新日志 "))]),_:1},8,["loading"]),e(A,{bordered:!1,title:"构建信息",loading:u.value},{actions:a(()=>[i.value?(o(),D(k,{key:0,theme:"success",variant:"light"},{icon:a(()=>[e(b(Vt))]),default:a(()=>[L[4]||(L[4]=c(" 构建成功 ",-1))]),_:1})):N("",!0)]),default:a(()=>[i.value?(o(),S("div",g$,[e(C,{gutter:[16,16],style:{"align-items":"stretch"}},{default:a(()=>[e(w,{span:3,xs:12,sm:6},{default:a(()=>[t("div",_$,[L[5]||(L[5]=t("div",{class:"label"},"当前版本",-1)),t("div",h$,I(i.value.version),1)])]),_:1}),e(w,{span:3,xs:12,sm:6},{default:a(()=>[t("div",y$,[L[6]||(L[6]=t("div",{class:"label"},"构建时间",-1)),t("div",b$,[e(b(pt)),c(" "+I(i.value.buildTime),1)])])]),_:1}),e(w,{span:3,xs:12,sm:6},{default:a(()=>[t("div",w$,[L[7]||(L[7]=t("div",{class:"label"},"最新提交",-1)),t("div",{class:"value commit",title:i.value.commitMsg},[e(b(ln)),c(" "+I(i.value.commitId.substring(0,7)),1)],8,k$),t("div",$$,"by "+I(i.value.commitAuthor),1)])]),_:1}),e(w,{span:3,xs:12,sm:6},{default:a(()=>[t("div",x$,[L[10]||(L[10]=t("div",{class:"label"},"核心框架",-1)),t("div",A$,[L[8]||(L[8]=t("span",{class:"dotnet"},".NET 10.0",-1)),e(V,{layout:"vertical"}),L[9]||(L[9]=t("span",{class:"vue"},"Vue 3.x",-1))])])]),_:1})]),_:1})])):N("",!0),i.value?(o(),S("div",C$,[e(E,{borderless:!0},{default:a(()=>[e(h,{value:"history"},{header:a(()=>[t("div",S$,[e(b(nn)),L[11]||(L[11]=c(" 提交日志 (Commit History)",-1))])]),default:a(()=>[t("div",I$,[e(p,null,{default:a(()=>[(o(!0),S(ce,null,fe(i.value.history,R=>(o(),D(z,{key:R.commitId,"dot-color":"primary"},{default:a(()=>[t("div",V$,[t("div",M$,I(R.commitTime),1),t("div",U$,I(R.commitMsg),1),t("div",L$,[e(k,{size:"small",style:{padding:"0"}},{default:a(()=>[e(b(Rt)),c(" "+I(R.commitAuthor),1)]),_:2},1024),t("span",B$,"#"+I(R.commitId.substring(0,7)),1)])])]),_:2},1024))),128))]),_:1})])]),_:1}),e(h,{value:"dependencies"},{header:a(()=>[t("div",z$,[e(b(Et)),L[12]||(L[12]=c(" 核心依赖 (Dependencies)",-1))])]),default:a(()=>[t("div",P$,[e(C,{gutter:[12,12]},{default:a(()=>[(o(!0),S(ce,null,fe(g.value,R=>(o(),D(w,{key:R.name,span:3,xs:12,sm:6,md:4},{default:a(()=>[t("div",R$,[t("span",{class:"dep-name",title:R.name},I(R.name),9,E$),e(k,{size:"small",variant:"light-outline"},{default:a(()=>[c(I(R.version),1)]),_:2},1024)])]),_:2},1024))),128))]),_:1})])]),_:1})]),_:1})])):N("",!0)]),_:1},8,["loading"])]),_:1})])}}}),F$=ue(T$,[["__scopeId","data-v-92efe470"]]),D$=Object.freeze(Object.defineProperty({__proto__:null,default:F$},Symbol.toStringTag,{value:"Module"})),O$={key:0,class:"loading-wrapper"},j$={key:1,class:"input-group"},N$={class:"check-container"},K$={class:"btn-wrapper"},q$={key:0,class:"msl-login-wrapper"},G$={class:"reset-guide"},H$={class:"guide-item"},J$={class:"guide-title"},W$={class:"guide-item"},X$={class:"guide-title"},Q$="remembered_url",ks="remembered_username",Y$=ne({__name:"Login",setup(s){const l=Fe(),n=Ja(),u=Qt(),i=et(),d=$(!1),f=$(!1),r=$(!1),m=$(!1),g=$(!0),y=$(!1),L=Xe({url:localStorage.getItem(Q$)||"",username:localStorage.getItem(ks)||"",password:"",checked:!!localStorage.getItem(ks)}),A=$(),P=se(()=>{const z={username:[{required:!0,message:"请输入用户名",type:"error"}],password:[{required:!0,message:"请输入密码",type:"error"}]};return m.value||(z.url=[{required:!0,message:"请输入服务器地址",type:"error"}]),z}),w=async()=>{g.value=!0,await l.checkConnection("")?(m.value=!0,L.url=""):m.value=!1;try{(await Q.get({url:"/api/auth/oauth/status"})).allowOAuth&&(f.value=!0),g.value=!1}catch{g.value=!1}},C=async({validateResult:z})=>{if(z===!0){d.value=!0;try{await l.login({url:m.value?"":L.url,username:L.username,password:L.password,checked:L.checked}),B.success("登录成功");const p=i.query.redirect,V=p?decodeURIComponent(p):"/dashboard/base";u.push(V),Bs.success({content:`欢迎回来！${l.userInfo.name}`,title:"MSLX 控制台"}),n.checkAppUpdate(!1)}catch(p){B.error(p.message||"登录失败，请检查账号密码")}finally{d.value=!1}}},k=async()=>{try{d.value=!0;const z=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);localStorage.setItem("oauth_state",z);const p=`${window.location.origin}/oauth/callback?mode=login`,V=await Q.get({url:"/api/auth/oauth/url",params:{state:z,callback:p}});if(V&&V.url)window.location.href=V.url;else throw new Error(V.message||"获取授权地址失败")}catch(z){B.error(z.message||"无法连接到认证服务器"),d.value=!1}};return Ie(()=>{w()}),(z,p)=>{const V=v("t-loading"),h=v("t-icon"),E=v("t-input"),F=v("t-form-item"),R=v("t-checkbox"),H=v("t-link"),q=v("t-button"),U=v("t-form"),_=v("t-divider"),x=v("t-alert"),M=v("t-dialog");return o(),S("div",null,[e(U,{ref_key:"form",ref:A,class:"login-form",data:L,rules:P.value,"label-width":"0",onSubmit:C},{default:a(()=>[g.value?(o(),S("div",O$,[e(V,{text:"正在连接服务...",size:"small"})])):(o(),S("div",j$,[m.value?N("",!0):(o(),D(F,{key:0,name:"url"},{default:a(()=>[e(E,{modelValue:L.url,"onUpdate:modelValue":p[0]||(p[0]=J=>L.url=J),size:"large",placeholder:"服务器地址 (如 localhost:1027)",class:"glass-input"},{"prefix-icon":a(()=>[e(h,{name:"server"})]),_:1},8,["modelValue"])]),_:1})),e(F,{name:"username"},{default:a(()=>[e(E,{modelValue:L.username,"onUpdate:modelValue":p[1]||(p[1]=J=>L.username=J),size:"large",placeholder:"请输入用户名",class:"glass-input"},{"prefix-icon":a(()=>[e(h,{name:"user"})]),_:1},8,["modelValue"])]),_:1}),e(F,{name:"password"},{default:a(()=>[e(E,{modelValue:L.password,"onUpdate:modelValue":p[3]||(p[3]=J=>L.password=J),size:"large",type:r.value?"text":"password",placeholder:"请输入密码",class:"glass-input"},{"prefix-icon":a(()=>[e(h,{name:"lock-on"})]),"suffix-icon":a(()=>[e(h,{name:r.value?"browse":"browse-off",style:{cursor:"pointer"},onClick:p[2]||(p[2]=J=>r.value=!r.value)},null,8,["name"])]),_:1},8,["modelValue","type"])]),_:1})])),t("div",N$,[e(R,{modelValue:L.checked,"onUpdate:modelValue":p[4]||(p[4]=J=>L.checked=J)},{default:a(()=>[...p[7]||(p[7]=[c("记住用户名",-1)])]),_:1},8,["modelValue"]),e(H,{theme:"primary",hover:"color",onClick:p[5]||(p[5]=J=>y.value=!0)},{default:a(()=>[...p[8]||(p[8]=[c(" 忘记密码？ ",-1)])]),_:1})]),e(F,{class:"btn-container"},{default:a(()=>[t("div",K$,[e(q,{block:"",size:"large",type:"submit",class:"login-btn",loading:d.value},{default:a(()=>[...p[9]||(p[9]=[c(" 登 录 ",-1)])]),_:1},8,["loading"]),f.value?(o(),S("div",q$,[t("a",{class:"msl-link-btn",onClick:k},[e(h,{name:"user-transmit"}),p[10]||(p[10]=t("span",null,"使用 MSL 账户登录",-1))])])):N("",!0)])]),_:1})]),_:1},8,["data","rules"]),e(M,{visible:y.value,"onUpdate:visible":p[6]||(p[6]=J=>y.value=J),header:"找回或重置密码",footer:!1,width:"480px",attach:"body"},{default:a(()=>[t("div",G$,[t("div",H$,[t("div",J$,[e(h,{name:"user-talk"}),p[11]||(p[11]=c(" 方式一：联系管理员",-1))]),p[12]||(p[12]=t("p",{class:"guide-desc"},"如果系统中存在其他管理员账号，请联系对应人员协助您在后台重置密码。",-1))]),e(_,{dashed:"",style:{margin:"16px 0"}}),t("div",W$,[t("div",X$,[e(h,{name:"refresh"}),p[13]||(p[13]=c(" 方式二：初始化默认账户",-1))]),p[15]||(p[15]=t("p",{class:"guide-desc"},"若无法联系其他管理员，请在服务器端删除以下配置文件：",-1)),p[16]||(p[16]=t("div",{class:"code-block"},"DaemonData/Configs/UserList.json",-1)),t("p",null,[e(x,{style:{"margin-top":"10px"}},{default:a(()=>[...p[14]||(p[14]=[c("操作提示：删除该文件后，请",-1),t("strong",null,"重启守护进程",-1),c("。系统将自动重新创建包含默认账号密码的初始文件。",-1)])]),_:1})])])])]),_:1},8,["visible"])])}}}),Z$=ue(Y$,[["__scopeId","data-v-b95f4e77"]]),e3={class:"login-header"},t3={class:"logo"},a3={class:"operations-container"},s3=ne({__name:"Header",setup(s){const l=rt(),n=()=>{l.updateConfig({showSettingPanel:!0})},u=()=>{window.open("https://github.com/MSLTeam/MSLX")},i=()=>{window.open("https://mslx.mslmc.cn")};return(d,f)=>{const r=v("t-icon"),m=v("t-button");return o(),S("header",e3,[t("span",t3,[t("img",{src:Ka,class:$e(`${b(Te)}-side-nav-logo-img`),alt:"logo"},null,2),f[0]||(f[0]=t("span",null," MSLX 管理中心 ",-1))]),t("div",a3,[e(m,{theme:"default",shape:"square",variant:"text",onClick:u},{default:a(()=>[e(r,{name:"logo-github",class:"icon"})]),_:1}),e(m,{theme:"default",shape:"square",variant:"text",onClick:i},{default:a(()=>[e(r,{name:"help-circle",class:"icon"})]),_:1}),e(m,{theme:"default",shape:"square",variant:"text",onClick:n},{default:a(()=>[e(r,{name:"setting",class:"icon"})]),_:1})])])}}}),al=ue(s3,[["__scopeId","data-v-a538553e"]]),l3={class:"login-content"},n3={class:"login-container"},o3={class:"copyright"},i3={class:"welcome-content"},r3={class:"account-card"},u3={class:"info-row"},d3={class:"label"},c3={class:"info-row"},m3={class:"label"},p3={name:"LoginIndex"},v3=ne({...p3,setup(s){const l=jt(),n=Fe(),u=(r,m)=>r?r.startsWith("http")?r:`${n.baseUrl||window.location.origin}/api/static/images/${r}`:m,i=se(()=>{const r=l.settings;return{"--custom-bg-light":`url('${u(r.webPanelStyleLightBackground,qa)}')`,"--custom-bg-dark":`url('${u(r.webPanelStyleDarkBackground,Ga)}')`}}),d=$(!1),f=()=>{d.value=!1;const r=new URL(window.location.href);r.searchParams.delete("initialize"),window.history.replaceState({},"",r)};return Ie(()=>{l.fetchSettings(),new URLSearchParams(window.location.search).get("initialize")==="true"&&(d.value=!0)}),(r,m)=>{const g=v("t-alert"),y=v("t-button"),L=v("t-dialog");return o(),S("div",{class:"login-wrapper",style:nt(i.value)},[e(al,{class:"login-header-fixed"}),t("div",l3,[t("div",n3,[m[1]||(m[1]=t("div",{class:"title-container"},[t("h1",{class:"title"},"连接到 MSLX"),t("p",{class:"sub-title"},"网页管理中心")],-1)),e(Z$),t("footer",o3,"Copyright @ 2021-"+I(new Date().getFullYear())+" MSLTeam",1)])]),e(Na,{class:"tdesign-setting-outside"}),e(L,{visible:d.value,"onUpdate:visible":m[0]||(m[0]=A=>d.value=A),footer:!1,"close-btn":!0,width:"480px",attach:"body",class:"welcome-dialog","on-close":f},{header:a(()=>[...m[2]||(m[2]=[t("div",{class:"dialog-header-row"},[t("span",{class:"emoji-icon"},"🎉"),t("span",{class:"header-text"},"欢迎使用 MSLX 开服器")],-1)])]),default:a(()=>[t("div",i3,[e(g,{theme:"success",class:"security-alert"},{message:a(()=>[...m[3]||(m[3]=[c(" 您似乎是第一次使用？请查阅以下信息，然后开始享受您的MC开服之旅吧～ ",-1)])]),_:1}),t("div",r3,[t("div",u3,[t("span",d3,[e(b(Rt)),m[4]||(m[4]=c(" 默认账户:",-1))]),m[5]||(m[5]=t("span",{class:"value highlight"},"mslx",-1))]),t("div",c3,[t("span",m3,[e(b(Zt)),m[6]||(m[6]=c(" 默认密码:",-1))]),m[7]||(m[7]=t("span",{class:"value mono"},"请在MSLX守护进程端控制台查看",-1))])]),e(g,{theme:"warning",class:"security-alert"},{message:a(()=>[...m[8]||(m[8]=[c(" 安全提醒：请登录后",-1),t("b",null,[t("u",null,"立即修改默认的账户名和密码")],-1),c("，保障您的服务安全。 ",-1)])]),_:1}),e(y,{block:"",theme:"primary",size:"large",variant:"base",onClick:f},{icon:a(()=>[e(b(Vt))]),default:a(()=>[m[9]||(m[9]=c(" 我已知晓，立即登录 ",-1))]),_:1})])]),_:1},8,["visible"])],4)}}}),f3=ue(v3,[["__scopeId","data-v-786dd78b"]]),g3=Object.freeze(Object.defineProperty({__proto__:null,default:f3},Symbol.toStringTag,{value:"Module"})),_3={class:"login-panel"},h3={class:"login-container"},y3={class:"callback-content"},b3={key:0,class:"status-box"},w3={class:"loading-icon-wrapper"},k3={class:"tip-text"},$3={key:1,class:"status-box success"},x3={class:"desc"},A3={class:"sub-desc"},C3={class:"btn-group"},S3={key:2,class:"status-box error"},I3={class:"error-msg-box"},V3={class:"btn-group"},M3={class:"copyright"},U3=ne({__name:"index",setup(s){const l=et(),n=Qt(),u=Fe(),i=jt(),d=(z,p)=>z?z.startsWith("http")?z:`${u.baseUrl||window.location.origin}/api/static/images/${z}`:p,f=se(()=>{const z=i.settings;return{"--custom-bg-light":`url('${d(z.webPanelStyleLightBackground,qa)}')`,"--custom-bg-dark":`url('${d(z.webPanelStyleDarkBackground,Ga)}')`}}),r=$("loading"),m=$("正在验证身份..."),g=$(""),y=$(""),L=$(3),A=async()=>{const{code:z,state:p,mode:V}=l.query;if(!z||!p){r.value="error",g.value="无效的回调参数，缺少 Code 或 State。";return}const h=localStorage.getItem("oauth_state");if(localStorage.removeItem("oauth_state"),p!==h){r.value="error",g.value="安全校验失败 (State Mismatch)，请求可能被篡改。";return}try{if(V==="login")await P(z);else if(V==="bind")await w(z);else throw new Error("未知的操作模式")}catch(E){r.value="error",g.value=E.message||"处理请求时发生未知错误"}},P=async z=>{m.value="正在登录 MSLX...";try{const p=await Q.post({url:"/api/auth/oauth/login",data:{code:z}});await u.loginByOAuth(p),r.value="success",y.value=`欢迎回来，${u.userInfo.name||p.data.userInfo?.name}`,C("/dashboard/base")}catch(p){r.value="error",g.value=p.message}},w=async z=>{m.value="正在绑定 MSL 账号...";try{await Q.post({url:"/api/auth/oauth/bind",data:{code:z}}),r.value="success",y.value="账号绑定成功！",await u.getUserInfo(),C("/settings")}catch(p){B.error(p.message)}},C=z=>{const p=setInterval(()=>{L.value--,L.value<=0&&(clearInterval(p),Me(z))},1e3)},k=()=>{Me("/login")};return Ie(()=>{i.fetchSettings(),A()}),(z,p)=>{const V=v("t-loading"),h=v("t-button");return o(),S("div",{class:"login-wrapper",style:nt(f.value)},[e(al,{class:"login-header-fixed"}),t("div",_3,[t("div",h3,[p[5]||(p[5]=t("div",{class:"title-container"},[t("h1",{style:{"margin-bottom":"10px"},class:"title"},"MSL 统一身份认证")],-1)),t("div",y3,[r.value==="loading"?(o(),S("div",b3,[t("div",w3,[e(V,{size:"large"})]),t("p",k3,I(m.value),1)])):r.value==="success"?(o(),S("div",$3,[e(b(fa),{class:"icon-success"}),p[2]||(p[2]=t("h2",{class:"status-title"},"操作成功",-1)),t("p",x3,I(y.value),1),t("p",A3,I(L.value)+" 秒后自动跳转...",1),t("div",C3,[e(h,{block:"",size:"large",class:"login-btn",onClick:p[0]||(p[0]=E=>b(n).push("/dashboard/base"))},{default:a(()=>[...p[1]||(p[1]=[c(" 立即进入 ",-1)])]),_:1})])])):(o(),S("div",S3,[e(b(Os),{class:"icon-error"}),p[4]||(p[4]=t("h2",{class:"status-title"},"操作失败",-1)),t("div",I3,I(g.value),1),t("div",V3,[e(h,{block:"",size:"large",class:"login-btn",onClick:k},{default:a(()=>[...p[3]||(p[3]=[c(" 返回登录页 ",-1)])]),_:1})])]))]),t("footer",M3,"Copyright @ 2021-"+I(new Date().getFullYear())+" MSLTeam",1)])]),e(Na,{class:"tdesign-setting-outside"})],4)}}}),L3=ue(U3,[["__scopeId","data-v-4a099a27"]]),B3=Object.freeze(Object.defineProperty({__proto__:null,default:L3},Symbol.toStringTag,{value:"Module"})),z3={class:"result-content"},P3={class:"result-container"},R3={class:"action-box"},E3={class:"copyright"},T3=ne({__name:"index",setup(s){const l=rt(),n=se(()=>l.displayMode);return(u,i)=>{const d=v("t-button");return o(),S("div",{class:$e(["result-wrapper",n.value])},[t("div",z3,[t("div",P3,[i[2]||(i[2]=t("div",{class:"result-info"},[t("h1",{class:"code"},"404"),t("h2",{class:"title"},"掉出了这个世界......"),t("p",{class:"desc"},[c("越过基岩的边界，只剩无尽的黑夜，"),t("br"),c("请点击重生，寻回原本的世界。")])],-1)),t("div",R3,[e(d,{theme:"primary",size:"large",block:"",class:"home-btn",onClick:i[0]||(i[0]=f=>b(Me)("/"))},{default:a(()=>[...i[1]||(i[1]=[c(" 返回主页 ",-1)])]),_:1})]),t("footer",E3,"Copyright @ 2021-"+I(new Date().getFullYear())+" MSLTeam",1)])])],2)}}}),F3=ue(T3,[["__scopeId","data-v-86bbfa54"]]),D3=Object.freeze(Object.defineProperty({__proto__:null,default:F3},Symbol.toStringTag,{value:"Module"}));
