import{a as T,u as F}from"./vue-router.f8VyOqpO.js";import{L as z}from"./Header.DiNtpnUR.js";import{u as D,T as N,r as b,c as y,_ as R}from"./index.DjdW_re9.js";import{a as U,e as V}from"./tdesign-icons-vue-next.o89AUH_k.js";import{M as $}from"./tdesign-vue-next.ClIZ97Cx.js";import{D as q,F as n,R as A,b0 as w,aX as u,aY as p,G as r,a$ as s,b5 as l,ap as v,b2 as x,ao as S}from"./index.CWeK9ocq.js";import"./pinia.CwCJD8HV.js";import"./pinia-plugin-persistedstate_561243483b11dd07f5acf9e797fda690.n2tMOXAx.js";import"./tvision-color.COTpcftn.js";import"./chroma-js.RLxBGt-u.js";import"./bezier-easing.qwUZoLR4.js";import"./lodash.C2dUGbaG.js";import"./axios.R-lXtGyY.js";import"./qs.2H4whylj.js";import"./side-channel.D4adRIkF.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.C4p7aaXq.js";import"./cron-parser.BHsRiybt.js";import"./luxon.BVaPVz1w.js";import"./side-channel-list.Mptt8X3N.js";import"./side-channel-map.DhhAKOp2.js";import"./get-intrinsic.DZF4l_-S.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.GRuZvLsk.js";import"./dunder-proto.BfGlLUzx.js";import"./call-bind-apply-helpers.DPbVMkjK.js";import"./function-bind.CHqF18-c.js";import"./hasown.B1sN64jK.js";import"./call-bound.DTRAK3sj.js";import"./side-channel-weakmap.CTWfHcrJ.js";import"./nprogress.BFWi6Yo1.js";import"./core-js-pure.DN77qAGa.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./lodash-es.ClUTdtmA.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";const E={class:"login-wrapper"},O={class:"login-panel"},X={class:"login-container"},Y={class:"callback-content"},G={key:0,class:"status-box"},H={class:"loading-icon-wrapper"},P={class:"tip-text"},j={key:1,class:"status-box success"},J={class:"desc"},K={class:"sub-desc"},Q={class:"btn-group"},W={key:2,class:"status-box error"},Z={class:"error-msg-box"},tt={class:"btn-group"},st={class:"copyright"},ot=q({__name:"index",setup(et){const k=T(),C=F(),d=D(),a=n("loading"),m=n("正在验证身份..."),i=n(""),g=n(""),_=n(3),M=async()=>{const{code:o,state:t,mode:e}=k.query;if(!o||!t){a.value="error",i.value="无效的回调参数，缺少 Code 或 State。";return}const c=localStorage.getItem("oauth_state");if(localStorage.removeItem("oauth_state"),t!==c){a.value="error",i.value="安全校验失败 (State Mismatch)，请求可能被篡改。";return}try{if(e==="login")await I(o);else if(e==="bind")await L(o);else throw new Error("未知的操作模式")}catch(f){a.value="error",i.value=f.message||"处理请求时发生未知错误"}},I=async o=>{var t;m.value="正在登录 MSLX...";try{const e=await b.post({url:"/api/auth/oauth/login",data:{code:o}});await d.loginByOAuth(e),a.value="success",g.value=`欢迎回来，${d.userInfo.name||((t=e.data.userInfo)==null?void 0:t.name)}`,h("/dashboard/base")}catch(e){a.value="error",i.value=e.message}},L=async o=>{m.value="正在绑定 MSL 账号...";try{await b.post({url:"/api/auth/oauth/bind",data:{code:o}}),a.value="success",g.value="账号绑定成功！",await d.getUserInfo(),h("/settings")}catch(t){$.error(t.message)}},h=o=>{const t=setInterval(()=>{_.value--,_.value<=0&&(clearInterval(t),y(o))},1e3)},B=()=>{y("/login")};return A(()=>{M()}),(o,t)=>{const e=w("t-loading"),c=w("t-button");return p(),u("div",E,[r(z,{class:"login-header-fixed"}),s("div",O,[s("div",X,[t[5]||(t[5]=s("div",{class:"title-container"},[s("h1",{style:{"margin-bottom":"10px"},class:"title"},"MSL 统一身份认证")],-1)),s("div",Y,[a.value==="loading"?(p(),u("div",G,[s("div",H,[r(e,{size:"large"})]),s("p",P,l(m.value),1)])):a.value==="success"?(p(),u("div",j,[r(v(U),{class:"icon-success"}),t[2]||(t[2]=s("h2",{class:"status-title"},"操作成功",-1)),s("p",J,l(g.value),1),s("p",K,l(_.value)+" 秒后自动跳转...",1),s("div",Q,[r(c,{block:"",size:"large",class:"login-btn",onClick:t[0]||(t[0]=f=>v(C).push("/dashboard/base"))},{default:x(()=>[...t[1]||(t[1]=[S(" 立即进入 ",-1)])]),_:1})])])):(p(),u("div",W,[r(v(V),{class:"icon-error"}),t[4]||(t[4]=s("h2",{class:"status-title"},"操作失败",-1)),s("div",Z,l(i.value),1),s("div",tt,[r(c,{block:"",size:"large",class:"login-btn",onClick:B},{default:x(()=>[...t[3]||(t[3]=[S(" 返回登录页 ",-1)])]),_:1})])]))]),s("footer",st,"Copyright @ 2021-"+l(new Date().getFullYear())+" MSLTeam",1)])]),r(N,{class:"tdesign-setting-outside"})])}}}),Ht=R(ot,[["__scopeId","data-v-fa1e4e34"]]);export{Ht as default};
