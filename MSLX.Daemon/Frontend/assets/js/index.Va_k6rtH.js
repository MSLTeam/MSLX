import{u as G,a as H}from"./vue-router.f8VyOqpO.js";import{u as K,a as W,r as U,_ as R,T as J}from"./index.Do1noIT9.js";import{M,N as Q}from"./tdesign-vue-next.ClIZ97Cx.js";import{D as I,F as p,W as Z,K as ee,R as E,b0 as r,aX as b,aY as w,G as o,b2 as a,a$ as t,b1 as te,b6 as V,ao as n,b5 as oe,ap as C}from"./index.CWeK9ocq.js";import{L as se}from"./Header.iCq7CoE-.js";import{a7 as ae,a8 as le,a2 as re}from"./tdesign-icons-vue-next.o89AUH_k.js";import"./pinia.CwCJD8HV.js";import"./pinia-plugin-persistedstate_561243483b11dd07f5acf9e797fda690.n2tMOXAx.js";import"./tvision-color.COTpcftn.js";import"./chroma-js.RLxBGt-u.js";import"./bezier-easing.qwUZoLR4.js";import"./lodash.C2dUGbaG.js";import"./axios.R-lXtGyY.js";import"./qs.XiX0Mm1J.js";import"./side-channel.D5_e29f9.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.C4p7aaXq.js";import"./cron-parser.BHsRiybt.js";import"./luxon.BVaPVz1w.js";import"./side-channel-list.Mptt8X3N.js";import"./side-channel-map.Ce19al5R.js";import"./get-intrinsic.DR3xEH2x.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.DDnjtmUu.js";import"./dunder-proto.BNaYEbSf.js";import"./call-bind-apply-helpers.WnuMKP1p.js";import"./function-bind.CHqF18-c.js";import"./hasown.B1sN64jK.js";import"./call-bound.Dbz9IhIv.js";import"./side-channel-weakmap.BlDgri06.js";import"./nprogress.BFWi6Yo1.js";import"./core-js-pure.DN77qAGa.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./lodash-es.ClUTdtmA.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";const ne={key:0,class:"loading-wrapper"},ie={key:1,class:"input-group"},ue={class:"check-container"},de={class:"btn-wrapper"},me={key:0,class:"msl-login-wrapper"},ce={class:"reset-guide"},pe={class:"guide-item"},ge={class:"guide-title"},fe={class:"guide-item"},_e={class:"guide-title"},ve="remembered_url",$="remembered_username",we=I({__name:"Login",setup(z){const d=K(),k=W(),_=G(),s=H(),m=p(!1),h=p(!1),v=p(!1),g=p(!1),y=p(!0),S=p(!1),l=Z({url:localStorage.getItem(ve)||"",username:localStorage.getItem($)||"",password:"",checked:!!localStorage.getItem($)}),D=p(),B=ee(()=>{const i={username:[{required:!0,message:"è¯·è¾“å…¥ç”¨æˆ·å",type:"error"}],password:[{required:!0,message:"è¯·è¾“å…¥å¯†ç ",type:"error"}]};return g.value||(i.url=[{required:!0,message:"è¯·è¾“å…¥æœåŠ¡å™¨åœ°å€",type:"error"}]),i}),N=async()=>{y.value=!0,await d.checkConnection("")?(g.value=!0,l.url=""):g.value=!1;try{(await U.get({url:"/api/auth/oauth/status"})).allowOAuth&&(h.value=!0),y.value=!1}catch{y.value=!1}},q=async({validateResult:i})=>{if(i===!0){m.value=!0;try{await d.login({url:g.value?"":l.url,username:l.username,password:l.password,checked:l.checked}),M.success("ç™»å½•æˆåŠŸ");const e=s.query.redirect,c=e?decodeURIComponent(e):"/dashboard/base";_.push(c),Q.success({content:`æ¬¢è¿å›æ¥ï¼${d.userInfo.name}`,title:"MSLX æ§åˆ¶å°"}),k.checkAppUpdate(!1)}catch(e){M.error(e.message||"ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥è´¦å·å¯†ç ")}finally{m.value=!1}}},P=async()=>{try{m.value=!0;const i=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);localStorage.setItem("oauth_state",i);const e=`${window.location.origin}/oauth/callback?mode=login`,c=await U.get({url:"/api/auth/oauth/url",params:{state:i,callback:e}});if(c&&c.url)window.location.href=c.url;else throw new Error(c.message||"è·å–æˆæƒåœ°å€å¤±è´¥")}catch(i){M.error(i.message||"æ— æ³•è¿æ¥åˆ°è®¤è¯æœåŠ¡å™¨"),m.value=!1}};return E(()=>{N()}),(i,e)=>{const c=r("t-loading"),f=r("t-icon"),L=r("t-input"),x=r("t-form-item"),X=r("t-checkbox"),T=r("t-link"),A=r("t-button"),F=r("t-form"),O=r("t-divider"),j=r("t-alert"),Y=r("t-dialog");return w(),b("div",null,[o(F,{ref_key:"form",ref:D,class:"login-form",data:l,rules:B.value,"label-width":"0",onSubmit:q},{default:a(()=>[y.value?(w(),b("div",ne,[o(c,{text:"æ­£åœ¨è¿æ¥æœåŠ¡...",size:"small"})])):(w(),b("div",ie,[g.value?V("",!0):(w(),te(x,{key:0,name:"url"},{default:a(()=>[o(L,{modelValue:l.url,"onUpdate:modelValue":e[0]||(e[0]=u=>l.url=u),size:"large",placeholder:"æœåŠ¡å™¨åœ°å€ (å¦‚ localhost:1027)",class:"glass-input"},{"prefix-icon":a(()=>[o(f,{name:"server"})]),_:1},8,["modelValue"])]),_:1})),o(x,{name:"username"},{default:a(()=>[o(L,{modelValue:l.username,"onUpdate:modelValue":e[1]||(e[1]=u=>l.username=u),size:"large",placeholder:"è¯·è¾“å…¥ç”¨æˆ·å",class:"glass-input"},{"prefix-icon":a(()=>[o(f,{name:"user"})]),_:1},8,["modelValue"])]),_:1}),o(x,{name:"password"},{default:a(()=>[o(L,{modelValue:l.password,"onUpdate:modelValue":e[3]||(e[3]=u=>l.password=u),size:"large",type:v.value?"text":"password",placeholder:"è¯·è¾“å…¥å¯†ç ",class:"glass-input"},{"prefix-icon":a(()=>[o(f,{name:"lock-on"})]),"suffix-icon":a(()=>[o(f,{name:v.value?"browse":"browse-off",style:{cursor:"pointer"},onClick:e[2]||(e[2]=u=>v.value=!v.value)},null,8,["name"])]),_:1},8,["modelValue","type"])]),_:1})])),t("div",ue,[o(X,{modelValue:l.checked,"onUpdate:modelValue":e[4]||(e[4]=u=>l.checked=u)},{default:a(()=>[...e[7]||(e[7]=[n("è®°ä½ç”¨æˆ·å",-1)])]),_:1},8,["modelValue"]),o(T,{theme:"primary",hover:"color",onClick:e[5]||(e[5]=u=>S.value=!0)},{default:a(()=>[...e[8]||(e[8]=[n(" å¿˜è®°å¯†ç ï¼Ÿ ",-1)])]),_:1})]),o(x,{class:"btn-container"},{default:a(()=>[t("div",de,[o(A,{block:"",size:"large",type:"submit",class:"login-btn",loading:m.value},{default:a(()=>[...e[9]||(e[9]=[n(" ç™» å½• ",-1)])]),_:1},8,["loading"]),h.value?(w(),b("div",me,[t("a",{class:"msl-link-btn",onClick:P},[o(f,{name:"user-transmit"}),e[10]||(e[10]=t("span",null,"ä½¿ç”¨ MSL è´¦æˆ·ç™»å½•",-1))])])):V("",!0)])]),_:1})]),_:1},8,["data","rules"]),o(Y,{visible:S.value,"onUpdate:visible":e[6]||(e[6]=u=>S.value=u),header:"æ‰¾å›æˆ–é‡ç½®å¯†ç ",footer:!1,width:"480px",attach:"body"},{default:a(()=>[t("div",ce,[t("div",pe,[t("div",ge,[o(f,{name:"user-talk"}),e[11]||(e[11]=n(" æ–¹å¼ä¸€ï¼šè”ç³»ç®¡ç†å‘˜",-1))]),e[12]||(e[12]=t("p",{class:"guide-desc"},"å¦‚æœç³»ç»Ÿä¸­å­˜åœ¨å…¶ä»–ç®¡ç†å‘˜è´¦å·ï¼Œè¯·è”ç³»å¯¹åº”äººå‘˜ååŠ©æ‚¨åœ¨åå°é‡ç½®å¯†ç ã€‚",-1))]),o(O,{dashed:"",style:{margin:"16px 0"}}),t("div",fe,[t("div",_e,[o(f,{name:"refresh"}),e[13]||(e[13]=n(" æ–¹å¼äºŒï¼šåˆå§‹åŒ–é»˜è®¤è´¦æˆ·",-1))]),e[15]||(e[15]=t("p",{class:"guide-desc"},"è‹¥æ— æ³•è”ç³»å…¶ä»–ç®¡ç†å‘˜ï¼Œè¯·åœ¨æœåŠ¡å™¨ç«¯åˆ é™¤ä»¥ä¸‹é…ç½®æ–‡ä»¶ï¼š",-1)),e[16]||(e[16]=t("div",{class:"code-block"},"DaemonData/Configs/UserList.json",-1)),t("p",null,[o(j,{style:{"margin-top":"10px"}},{default:a(()=>[...e[14]||(e[14]=[n("æ“ä½œæç¤ºï¼šåˆ é™¤è¯¥æ–‡ä»¶åï¼Œè¯·",-1),t("strong",null,"é‡å¯å®ˆæŠ¤è¿›ç¨‹",-1),n("ã€‚ç³»ç»Ÿå°†è‡ªåŠ¨é‡æ–°åˆ›å»ºåŒ…å«é»˜è®¤è´¦å·å¯†ç çš„åˆå§‹æ–‡ä»¶ã€‚",-1)])]),_:1})])])])]),_:1},8,["visible"])])}}}),be=R(we,[["__scopeId","data-v-b95f4e77"]]),ke={class:"login-wrapper"},he={class:"login-content"},ye={class:"login-container"},xe={class:"copyright"},Se={class:"welcome-content"},Le={class:"account-card"},Me={class:"info-row"},Ce={class:"label"},Ue={class:"info-row"},Ve={class:"label"},$e={name:"LoginIndex"},Re=I({...$e,setup(z){const d=p(!1),k=()=>{d.value=!1;const _=new URL(window.location.href);_.searchParams.delete("initialize"),window.history.replaceState({},"",_)};return E(()=>{new URLSearchParams(window.location.search).get("initialize")==="true"&&(d.value=!0)}),(_,s)=>{const m=r("t-alert"),h=r("t-button"),v=r("t-dialog");return w(),b("div",ke,[o(se,{class:"login-header-fixed"}),t("div",he,[t("div",ye,[s[1]||(s[1]=t("div",{class:"title-container"},[t("h1",{class:"title"},"è¿æ¥åˆ° MSLX"),t("p",{class:"sub-title"},"ç½‘é¡µç®¡ç†ä¸­å¿ƒ")],-1)),o(be),t("footer",xe,"Copyright @ 2021-"+oe(new Date().getFullYear())+" MSLTeam",1)])]),o(J,{class:"tdesign-setting-outside"}),o(v,{visible:d.value,"onUpdate:visible":s[0]||(s[0]=g=>d.value=g),footer:!1,"close-btn":!0,width:"480px",attach:"body",class:"welcome-dialog","on-close":k},{header:a(()=>[...s[2]||(s[2]=[t("div",{class:"dialog-header-row"},[t("span",{class:"emoji-icon"},"ğŸ‰"),t("span",{class:"header-text"},"æ¬¢è¿ä½¿ç”¨ MSLX å¼€æœå™¨")],-1)])]),default:a(()=>[t("div",Se,[o(m,{theme:"success",class:"security-alert"},{message:a(()=>[...s[3]||(s[3]=[n(" æ‚¨ä¼¼ä¹æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Ÿè¯·æŸ¥é˜…ä»¥ä¸‹ä¿¡æ¯ï¼Œç„¶åå¼€å§‹äº«å—æ‚¨çš„MCå¼€æœä¹‹æ—…å§ï½ ",-1)])]),_:1}),t("div",Le,[t("div",Me,[t("span",Ce,[o(C(ae)),s[4]||(s[4]=n(" é»˜è®¤è´¦æˆ·:",-1))]),s[5]||(s[5]=t("span",{class:"value highlight"},"mslx",-1))]),t("div",Ue,[t("span",Ve,[o(C(le)),s[6]||(s[6]=n(" é»˜è®¤å¯†ç :",-1))]),s[7]||(s[7]=t("span",{class:"value mono"},"è¯·åœ¨MSLXå®ˆæŠ¤è¿›ç¨‹ç«¯æ§åˆ¶å°æŸ¥çœ‹",-1))])]),o(m,{theme:"warning",class:"security-alert"},{message:a(()=>[...s[8]||(s[8]=[n(" å®‰å…¨æé†’ï¼šè¯·ç™»å½•å",-1),t("b",null,[t("u",null,"ç«‹å³ä¿®æ”¹é»˜è®¤çš„è´¦æˆ·åå’Œå¯†ç ")],-1),n("ï¼Œä¿éšœæ‚¨çš„æœåŠ¡å®‰å…¨ã€‚ ",-1)])]),_:1}),o(h,{block:"",theme:"primary",size:"large",variant:"base",onClick:k},{icon:a(()=>[o(C(re))]),default:a(()=>[s[9]||(s[9]=n(" æˆ‘å·²çŸ¥æ™“ï¼Œç«‹å³ç™»å½• ",-1))]),_:1})])]),_:1},8,["visible"])])}}}),kt=R(Re,[["__scopeId","data-v-59aa3632"]]);export{kt as default};
