import{d as ne,o as r,b as C,n as we,e as te,f as Vt,h as t,r as w,i as ke,j as qs,w as Ns,k as v,l as j,m as a,p as e,F as pe,q as ye,s as st,t as M,u as O,v as jt,x as vs,y,z as _,A as Sa,T as aa,K as Gs,B as Qe,C as Wt,D as gt,M as P,E as be,G as Hs,H as Js,I as Ws,J as Xs,L as Je,N as Ia,O as yt,P as sa,Q as fs,R as gs,S as _s,U as bt,V as wt,W as Mt,X as Qs,Y as Ys,Z as at,_ as Va,$ as va,a0 as Zs,a1 as vt,a2 as He,a3 as hs,a4 as en,a5 as ys,a6 as na,a7 as tn,a8 as an,a9 as Lt,aa as Xe,ab as et,ac as bs,ad as Ut,ae as sn,af as Ct,ag as Ft,ah as Pt,ai as nn,aj as tt,ak as ws,al as la,am as ks,an as $s,ao as Qt,ap as ln,aq as lt,ar as Kt,as as on,at as St,au as rn,av as un,aw as dn,ax as oa,ay as As,az as xs,aA as Yt,aB as It,aC as cn,aD as Ma,aE as Cs,aF as ga,aG as _a,aH as mn,aI as ha,aJ as Tt,aK as ya,aL as ba,aM as Ss,aN as ft,aO as Zt,aP as La,aQ as pn,aR as vn,aS as Na,aT as wa,aU as fn,aV as gn,aW as _n,aX as Is,aY as hn,aZ as yn,a_ as bn,a$ as wn,b0 as kn,b1 as $n,b2 as An,b3 as xn,b4 as Vs,b5 as Cn,b6 as Sn,b7 as Ms,b8 as In,b9 as Vn,ba as Mn,bb as Ln,bc as Un,bd as Ga,be as Bn,bf as Rn,bg as En,bh as Pn}from"./mslx-core.DHSuHabF.js";import{a3 as ka,a4 as Ls,a5 as zn,a6 as pt,a7 as Fn,a8 as Tn,a9 as _t,aa as Dn,ab as On,ac as jn,ad as zt,ae as ue,af as Us,ag as Bs,ah as Kn}from"./mslx-libs.CtNnKmhB.js";import{i as ea,L as Rs}from"./mslx-charts.D_tlMl6R.js";import{o as qn,a as Nn,d as Gn,t as Hn,h as Jn,e as Wn,j as Xn,y as Qn,f as Yn}from"./mslx-editor.PmEM2eUG.js";import{H as Zn,w as el,_ as tl,K as Ha,T as Ja,C as al}from"./mslx-formatter.B-70lPdB.js";const sl="modulepreload",nl=function(s){return"/"+s},Wa={},Ge=function(n,l,c){let o=Promise.resolve();if(l&&l.length>0){let d=function(m){return Promise.all(m.map(b=>Promise.resolve(b).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),u=f?.nonce||f?.getAttribute("nonce");o=d(l.map(m=>{if(m=nl(m),m in Wa)return;Wa[m]=!0;const b=m.endsWith(".css"),S=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${S}`))return;const k=document.createElement("link");if(k.rel=b?"stylesheet":sl,b||(k.as="script"),k.crossOrigin="",k.href=m,u&&k.setAttribute("nonce",u),document.head.appendChild(k),b)return new Promise((I,g)=>{k.addEventListener("load",I),k.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${m}`)))})}))}function i(f){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=f,window.dispatchEvent(u),!u.defaultPrevented)throw f}return o.then(f=>{for(const u of f||[])u.status==="rejected"&&i(u.reason);return n().catch(i)})},ll=["src"],ol=ne({__name:"index",props:{url:String,type:{type:String,default:"layout"}},setup(s){const n=s,l=te(()=>{const{type:c}=n;return["thumbnail-container",{"thumbnail-circle":c==="circle","thumbnail-layout":c==="layout"}]});return(c,o)=>(r(),C("img",{class:we(l.value),src:s.url},null,10,ll))}}),oe=(s,n)=>{const l=s.__vccOpts||s;for(const[c,o]of n)l[c]=o;return l},rl=oe(ol,[["__scopeId","data-v-bc3a7420"]]),il={DEFAULT:{"--td-brand-color":"#0052d9","--td-brand-color-1":"#f2f3ff","--td-brand-color-2":"#d9e1ff","--td-brand-color-3":"#b5c7ff","--td-brand-color-4":"#8eabff","--td-brand-color-5":"#618dff","--td-brand-color-6":"#366ef4","--td-brand-color-7":"#0052d9","--td-brand-color-8":"#003cab","--td-brand-color-9":"#002a7c","--td-brand-color-10":"#001a57"},CYAN:{"--td-brand-color":"#0594FA","--td-brand-color-1":"#d7eefe","--td-brand-color-2":"#aeddfd","--td-brand-color-3":"#84cafd","--td-brand-color-4":"#58b8fc","--td-brand-color-5":"#29a4fb","--td-brand-color-6":"#0594FA","--td-brand-color-7":"#29a4fb","--td-brand-color-8":"#0594FA","--td-brand-color-9":"#0378df","--td-brand-color-10":"#01409b"},GREEN:{"--td-brand-color":"#00A870","--td-brand-color-1":"#8dffd9","--td-brand-color-2":"#00f2a2","--td-brand-color-3":"#00dc92","--td-brand-color-4":"#00c583","--td-brand-color-5":"#00A870","--td-brand-color-6":"#009a5d","--td-brand-color-7":"#00c583","--td-brand-color-8":"#00A870","--td-brand-color-9":"#009a5d","--td-brand-color-10":"#004a14"},ORANGE:{"--td-brand-color":"#ED7B2F","--td-brand-color-1":"#fce5d7","--td-brand-color-2":"#f8cdaf","--td-brand-color-3":"#f4b285","--td-brand-color-4":"#f19659","--td-brand-color-5":"#ED7B2F","--td-brand-color-6":"#e75510","--td-brand-color-7":"#f19659","--td-brand-color-8":"#ED7B2F","--td-brand-color-9":"#e75510","--td-brand-color-10":"#7f0a02"},RED:{"--td-brand-color":"#E34D59","--td-brand-color-1":"#fbe5e7","--td-brand-color-2":"#f7ccd0","--td-brand-color-3":"#f3b2b8","--td-brand-color-4":"#ef989f","--td-brand-color-5":"#ea7b84","--td-brand-color-6":"#E34D59","--td-brand-color-7":"#ea7b84","--td-brand-color-8":"#E34D59","--td-brand-color-9":"#e42c3a","--td-brand-color-10":"#8d0309"},PINK:{"--td-brand-color":"#ED49B4","--td-brand-color-1":"#fce5f4","--td-brand-color-2":"#facae9","--td-brand-color-3":"#f7aede","--td-brand-color-4":"#f491d2","--td-brand-color-5":"#f172c5","--td-brand-color-6":"#ED49B4","--td-brand-color-7":"#f172c5","--td-brand-color-8":"#ED49B4","--td-brand-color-9":"#e80f9d","--td-brand-color-10":"#8f025e"},PURPLE:{"--td-brand-color":"#834EC2","--td-brand-color-1":"#eee6f7","--td-brand-color-2":"#ddceee","--td-brand-color-3":"#ccb6e6","--td-brand-color-4":"#bb9edc","--td-brand-color-5":"#ab87d5","--td-brand-color-6":"#9a6fce","--td-brand-color-7":"#9a6fce","--td-brand-color-8":"#834EC2","--td-brand-color-9":"#783ac3","--td-brand-color-10":"#4c1397"},YELLOW:{"--td-brand-color":"#EBB105","--td-brand-color-1":"#fde9ab","--td-brand-color-2":"#fbd152","--td-brand-color-3":"#EBB105","--td-brand-color-4":"#dda204","--td-brand-color-5":"#ca8d03","--td-brand-color-6":"#b67803","--td-brand-color-7":"#fbd152","--td-brand-color-8":"#EBB105","--td-brand-color-9":"#dda204","--td-brand-color-10":"#603100"}},Es={textColor:"rgba(0, 0, 0, 0.9)",placeholderColor:"rgba(0, 0, 0, 0.35)",borderColor:"#dcdcdc",containerColor:"#fff"},ul={textColor:"rgba(255, 255, 255, 0.9)",placeholderColor:"rgba(255, 255, 255, 0.35)",borderColor:"#5e5e5e",containerColor:"#242424"};function dl(s){return s.replace(/([A-Z])/g,"_$1").toUpperCase()}function cl(s,n){const l=/^#[A-F\d]{6}$/i.test(s)?s:dl(s);return n[l||"DEFAULT"]}function ml(s,n,l){const c=l==="dark";let o=n.indexOf(s);return c&&(n.reverse().map(f=>{const[u,d,m]=ka.colorTransform(f,"hex","hsl");return ka.colorTransform([u,Number(d)-4,m],"hsl","hex")}),o=5,n[0]=`${n[o]}20`),{"--td-brand-color":n[o],"--td-brand-color-1":n[0],"--td-brand-color-2":n[1],"--td-brand-color-3":n[2],"--td-brand-color-4":n[3],"--td-brand-color-5":n[4],"--td-brand-color-6":n[5],"--td-brand-color-7":o>0?n[o-1]:s,"--td-brand-color-8":n[o],"--td-brand-color-9":o>8?s:n[o+1],"--td-brand-color-10":n[9]}}function pl(s,n,l){const o=l==="dark"?`:root[theme-color='${s}'][theme-mode='dark']`:`:root[theme-color='${s}']`,i=document.createElement("style");i.type="text/css",i.innerText=`${o}{
    --td-brand-color: ${n["--td-brand-color"]};
    --td-brand-color-1: ${n["--td-brand-color-1"]};
    --td-brand-color-2: ${n["--td-brand-color-2"]};
    --td-brand-color-3: ${n["--td-brand-color-3"]};
    --td-brand-color-4: ${n["--td-brand-color-4"]};
    --td-brand-color-5: ${n["--td-brand-color-5"]};
    --td-brand-color-6: ${n["--td-brand-color-6"]};
    --td-brand-color-7: ${n["--td-brand-color-7"]};
    --td-brand-color-8: ${n["--td-brand-color-8"]};
    --td-brand-color-9: ${n["--td-brand-color-9"]};
    --td-brand-color-10: ${n["--td-brand-color-10"]};
  }`,document.head.appendChild(i)}const vl="conic-gradient(from 90deg at 50% 50%, #FF0000 -19.41deg, #FF0000 18.76deg, #FF8A00 59.32deg, #FFE600 99.87deg, #14FF00 141.65deg, #00A3FF 177.72deg, #0500FF 220.23deg, #AD00FF 260.13deg, #FF00C7 300.69deg, #FF0000 340.59deg, #FF0000 378.76deg)",fl=ne({__name:"index",props:{value:{type:String}},setup(s){const n=Ze(),l=s,c=te(()=>{const{value:o}=l,{colorList:i}=n;return{background:o!=="dynamic"?cl(o,i)["--td-brand-color"]:vl}});return(o,i)=>(r(),C("div",{style:Vt(c.value),class:"color-container"},null,4))}}),Xa=oe(fl,[["__scopeId","data-v-e8478b14"]]),Ua={showFooter:!0,isSidebarCompact:!1,showBreadcrumb:!1,mode:"auto",layout:"side",splitMenu:!1,isFooterAside:!1,isSidebarFixed:!0,isHeaderFixed:!0,showHeader:!0,backgroundTheme:"blueGrey",brandTheme:"default",enableCustomTheme:!1},gl={xmlns:"http://www.w3.org/2000/svg",width:"88",height:"48",fill:"none"};function _l(s,n){return r(),C("svg",gl,[...n[0]||(n[0]=[t("path",{fill:"#13161B",d:"M0 0h88v48H0z"},null,-1),t("path",{fill:"#949EAA","fill-rule":"evenodd",d:"M52.533 26.87q-.748.129-1.533.13a9 9 0 0 1-8.533-11.87A9 9 0 0 0 44 33a9 9 0 0 0 8.533-6.13","clip-rule":"evenodd"},null,-1)])])}const hl={render:_l},yl={xmlns:"http://www.w3.org/2000/svg",width:"88",height:"48",fill:"none"};function bl(s,n){return r(),C("svg",yl,[...n[0]||(n[0]=[t("path",{fill:"var(--td-component-border)",d:"M0 0h88v48H0z"},null,-1),t("path",{fill:"var(--td-text-color-primary)","fill-rule":"evenodd",d:"M44 20.583a3.417 3.417 0 1 0 0 6.833 3.417 3.417 0 0 0 0-6.833M39.083 24a4.917 4.917 0 1 1 9.834 0 4.917 4.917 0 0 1-9.834 0M43.25 17.333v-2.5h1.5v2.5zM48.184 18.755l1.767-1.767 1.06 1.06-1.767 1.768zM50.667 23.25h2.5v1.5h-2.5zM49.244 28.184l1.768 1.767-1.06 1.06-1.768-1.767zM44.75 30.666v2.5h-1.5v-2.5zM39.816 29.244l-1.767 1.768-1.061-1.061 1.767-1.768zM37.333 24.75h-2.5v-1.5h2.5zM38.756 19.816l-1.768-1.768 1.06-1.06 1.768 1.767z","clip-rule":"evenodd"},null,-1)])])}const wl={render:bl},kl={xmlns:"http://www.w3.org/2000/svg",width:"88",height:"48",fill:"none"};function $l(s,n){return r(),C("svg",kl,[...n[0]||(n[0]=[t("path",{fill:"var(--td-component-border)",d:"M0 0h88v48H0z"},null,-1),t("path",{fill:"var(--td-text-color-primary)",d:"M42.863 14.052v2.708h1.625v-2.708z"},null,-1),t("path",{fill:"var(--td-text-color-primary)","fill-rule":"evenodd",d:"M38.349 23.982a5.326 5.326 0 1 1 10.653 0 5.326 5.326 0 0 1-10.653 0m5.326-3.701a3.701 3.701 0 1 0 0 7.403 3.701 3.701 0 0 0 0-7.403M52.208 26.781h-2.621l-2.06 6.699 1.552.478.511-1.661h2.614l.511 1.66 1.554-.477zm-.503 3.89-.697-2.265h-.221l-.697 2.266z","clip-rule":"evenodd"},null,-1),t("path",{fill:"var(--td-text-color-primary)",d:"m48.208 18.3 1.915-1.914 1.149 1.15-1.915 1.914zM53.606 23.17h-2.709v1.625h2.709zM44.488 31.205v2.708h-1.625v-2.708zM37.228 31.579l1.915-1.915-1.15-1.15-1.914 1.916zM36.453 24.795h-2.708V23.17h2.708zM36.079 17.535l1.915 1.915 1.149-1.15-1.915-1.914z"},null,-1)])])}const Al={render:$l},xl={class:"setting-container"},Cl={style:{textAlign:"center",marginTop:"8px"}},Sl={class:"setting-item-row"},Il={class:"setting-layout-drawer"},Vl=ne({__name:"setting",setup(s){const n=Ze(),l=w(window.innerWidth),c=te(()=>l.value<480),o=te(()=>c.value?"85%":"408px"),i=()=>{l.value=window.innerWidth},f=["side","top"],u=["default","cyan","green","yellow","orange","red","pink","purple","dynamic"],d=[{type:"auto",text:"跟随系统"},{type:"light",text:"明亮"},{type:"dark",text:"暗黑"}],b=w({...(()=>{const p={...Ua};for(const A in p)Object.prototype.hasOwnProperty.call(p,A)&&(p[A]=n[A]);return p})()});c.value&&b.value.layout==="side"&&(b.value.layout="top");const S=w(!1),k=te({get(){return n.showSettingPanel},set(p){n.updateConfig({showSettingPanel:p})}}),I=p=>{const A=ka.getPaletteByGradation({colors:[p],step:10})[0],{mode:h}=n,F=ml(p,A,h);n.addColor({[p]:F}),n.updateConfig({...b.value,brandTheme:p}),pl(p,F,h)};ke(()=>{const p=document.querySelector(".dynamic-color-btn");p&&p.addEventListener("click",()=>{S.value=!0}),window.addEventListener("resize",i)}),qs(()=>{window.removeEventListener("resize",i)});const g=(p,A)=>{!p&&A.trigger==="document"&&(S.value=p)},V=p=>p==="light"?wl:p==="dark"?hl:Al,E=()=>{n.updateConfig({showSettingPanel:!1})},B=p=>`https://tdesign.gtimg.com/tdesign-pro/setting/${p}.png`;return Ns(()=>{n.updateConfig(b.value)}),(p,A)=>{const h=v("t-radio-button"),F=v("t-radio-group"),T=v("t-switch"),x=v("t-color-picker-panel"),N=v("t-popup"),G=v("t-form"),R=v("t-drawer");return r(),j(R,{visible:k.value,"onUpdate:visible":A[4]||(A[4]=$=>k.value=$),size:o.value,footer:!1,header:"面板样式","close-btn":!0,class:"setting-drawer-container",onCloseBtnClick:E},{default:a(()=>[t("div",xl,[e(G,{ref:"form",data:b.value,"label-align":"left"},{default:a(()=>[A[6]||(A[6]=t("div",{class:"setting-group-title"},"主题模式",-1)),e(F,{modelValue:b.value.mode,"onUpdate:modelValue":A[0]||(A[0]=$=>b.value.mode=$)},{default:a(()=>[(r(),C(pe,null,ye(d,($,L)=>t("div",{key:L,class:"setting-layout-drawer"},[t("div",null,[(r(),j(h,{key:L,value:$.type},{default:a(()=>[(r(),j(st(V($.type))))]),_:2},1032,["value"])),t("p",Cl,M($.text),1)])])),64))]),_:1},8,["modelValue"]),A[7]||(A[7]=t("div",{class:"setting-group-title"},"个性化",-1)),t("div",Sl,[A[5]||(A[5]=t("span",{class:"setting-item-label"},"开启背景美化",-1)),e(T,{modelValue:b.value.enableCustomTheme,"onUpdate:modelValue":A[1]||(A[1]=$=>b.value.enableCustomTheme=$)},null,8,["modelValue"])]),A[8]||(A[8]=t("div",{class:"setting-group-title"},"主题色",-1)),e(F,{modelValue:b.value.brandTheme,"onUpdate:modelValue":A[2]||(A[2]=$=>b.value.brandTheme=$)},{default:a(()=>[(r(!0),C(pe,null,ye(u.slice(0,u.length-1),($,L)=>(r(),C("div",{key:L,class:"setting-layout-drawer"},[(r(),j(h,{key:L,value:$,class:"setting-layout-color-group"},{default:a(()=>[e(Xa,{value:$},null,8,["value"])]),_:2},1032,["value"]))]))),128)),t("div",Il,[e(N,{"destroy-on-close":"","expand-animation":"",placement:"bottom-right",trigger:"click",visible:S.value,"overlay-style":{padding:0},onVisibleChange:g},{content:a(()=>[e(x,{"on-change":I,"color-modes":["monochrome"],format:"HEX","swatch-colors":[]})]),default:a(()=>[e(h,{value:u[u.length-1],class:"setting-layout-color-group dynamic-color-btn"},{default:a(()=>[e(Xa,{value:u[u.length-1]},null,8,["value"])]),_:1},8,["value"])]),_:1},8,["visible"])])]),_:1},8,["modelValue"]),A[9]||(A[9]=t("div",{class:"setting-group-title"},"导航布局",-1)),e(F,{modelValue:b.value.layout,"onUpdate:modelValue":A[3]||(A[3]=$=>b.value.layout=$)},{default:a(()=>[(r(),C(pe,null,ye(f,($,L)=>t("div",{key:L,class:"setting-layout-drawer"},[(r(),j(h,{key:L,value:$},{default:a(()=>[e(rl,{src:B($)},null,8,["src"])]),_:2},1032,["value"]))])),64))]),_:1},8,["modelValue"])]),_:1},8,["data"])])]),_:1},8,["visible","size"])}}}),Ba=oe(Vl,[["__scopeId","data-v-9f31e17e"]]),Me="mslx-webpanel",At="mslx-web-token",xt="mslx-base-url",Ml={class:"menu-text"},Ll={class:"menu-text"},Ul=ne({name:"MenuContent",__name:"MenuContent",props:{navData:{type:Array,default:()=>[]},isHorizontal:{type:Boolean,default:!1},maxItemCount:{type:Number,default:3}},setup(s){const n=s,l=te(()=>ta()),c=te(()=>{const{navData:k}=n;return f(k)}),o=te(()=>n.isHorizontal?c.value.slice(0,n.maxItemCount):c.value),i=te(()=>n.isHorizontal?c.value.slice(n.maxItemCount):[]),f=(k,I)=>k?(k.sort((g,V)=>(g.meta?.orderNo||0)-(V.meta?.orderNo||0)),k.map(g=>{const V=I&&!g.path.includes(I)?`${I}/${g.path}`:g.path;return{path:V,title:g.meta?.title,icon:g.meta?.icon||"",children:f(g.children,V),meta:g.meta,redirect:g.redirect}}).filter(g=>g.meta&&g.meta.hidden!==!0)):[],u=k=>{const{frameSrc:I,frameBlank:g}=k.meta;return I&&g?I.match(/(http|https):\/\/([\w.]+\/?)\S*/):null},d=k=>l.value.startsWith(k.path)?l.value:k.meta?.single?k.redirect:k.path,m=k=>k.icon&&typeof k.icon=="string",b=k=>Ls(k.icon)&&typeof k.icon.render=="function"?{can:!0,render:k.icon.render}:{can:!1,render:null},S=k=>{window.open(k)};return(k,I)=>{const g=v("t-icon"),V=v("t-menu-item"),E=v("menu-content",!0),B=v("t-submenu");return r(),C("div",{id:"menu-wrapper",class:we(["modern-menu-wrapper",{"is-horizontal":s.isHorizontal}])},[(r(!0),C(pe,null,ye(o.value,p=>(r(),C(pe,{key:p.path},[!p.children||!p.children.length||p.meta?.single?(r(),C(pe,{key:0},[u(p)?(r(),j(V,{key:0,name:p.path,value:d(p),class:"modern-menu-item",onClick:A=>S(u(p)[0])},{icon:a(()=>[m(p)?(r(),j(g,{key:0,name:p.icon},null,8,["name"])):b(p).can?(r(),j(st(b(p).render),{key:1,class:"t-icon"})):O("",!0)]),default:a(()=>[t("span",Ml,M(p.title),1)]),_:2},1032,["name","value","onClick"])):(r(),j(V,{key:1,name:p.path,value:d(p),to:p.path,class:"modern-menu-item"},{icon:a(()=>[m(p)?(r(),j(g,{key:0,name:p.icon},null,8,["name"])):b(p).can?(r(),j(st(b(p).render),{key:1,class:"t-icon"})):O("",!0)]),default:a(()=>[t("span",Ll,M(p.title),1)]),_:2},1032,["name","value","to"]))],64)):(r(),j(B,{key:1,name:p.path,value:p.path,title:p.title,class:"modern-submenu"},{icon:a(()=>[m(p)?(r(),j(g,{key:0,name:p.icon},null,8,["name"])):b(p).can?(r(),j(st(b(p).render),{key:1,class:"t-icon"})):O("",!0)]),default:a(()=>[p.children?(r(),j(E,{key:0,"nav-data":p.children,"is-horizontal":!1},null,8,["nav-data"])):O("",!0)]),_:2},1032,["name","value","title"]))],64))),128)),s.isHorizontal&&i.value.length>0?(r(),j(B,{key:0,name:"more-menu",title:"更多",class:"modern-submenu"},{icon:a(()=>[e(g,{name:"ellipsis"})]),default:a(()=>[e(E,{"nav-data":i.value,"is-horizontal":!1},null,8,["nav-data"])]),_:1})):O("",!0)],2)}}}),$a=oe(Ul,[["__scopeId","data-v-3b61b27d"]]),Ra="/assets/png/mslx-logo.BqgIBdpC.png",Bl=["src"],Rl={key:1,class:"header-operate-left show-on-mobile"},El={class:"operations-container"},Pl={class:"header-user-account",style:{"margin-left":"6px"}},zl=ne({__name:"Header",props:{theme:{type:String,default:"light"},layout:{type:String,default:"top"},showLogo:{type:Boolean,default:!0},menu:{type:Array,default:()=>[]},isFixed:{type:Boolean,default:!1},isCompact:{type:Boolean,default:!1},maxLevel:{type:Number,default:3}},setup(s){const n=Fe(),l=s,c=jt(),o=Ze(),i=()=>{o.updateConfig({showSettingPanel:!0})},f=te(()=>ta()),u=te(()=>[`${Me}-header-layout`]),d=te(()=>{const{isFixed:V,layout:E,isCompact:B}=l;return[{[`${Me}-header-menu`]:!V,[`${Me}-header-menu-fixed`]:V,[`${Me}-header-menu-fixed-side`]:E==="side"&&V,[`${Me}-header-menu-fixed-side-compact`]:E==="side"&&V&&B}]}),m=()=>{o.updateConfig({isSidebarCompact:!o.isSidebarCompact})},b=V=>{c.push(V)},S=V=>{V&&c.push(V)},k=()=>{c.push({path:"/login",query:{redirect:encodeURIComponent(c.currentRoute.value.fullPath)}})},I=()=>{window.open("https://github.com/MSLTeam/MSLX")},g=()=>{window.open("https://mslx.mslmc.cn")};return(V,E)=>{const B=v("t-icon"),p=v("t-button"),A=v("t-menu"),h=v("t-popup"),F=v("t-tooltip"),T=v("t-dropdown-item"),x=v("t-dropdown-menu"),N=v("t-avatar"),G=v("t-dropdown"),R=v("t-head-menu");return r(),C("div",{class:we(u.value)},[e(R,{class:we(d.value),theme:s.theme,"expand-type":"popup",value:f.value},vs({logo:a(()=>[s.showLogo?(r(),C("span",{key:0,class:we(`${y(Me)}-side-nav-logo-wrapper`),onClick:E[0]||(E[0]=$=>b("/dashboard/base"))},[t("img",{style:{width:"32px"},src:y(Ra),class:we(`${y(Me)}-side-nav-logo-img`),alt:"logo"},null,10,Bl),t("span",{style:{"margin-left":"8px","font-size":"18px","font-weight":"bold","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap"},class:we(`${y(Me)}-side-nav-logo-text hide-on-mobile`)}," MSLX 管理中心 ",2)],2)):O("",!0),s.layout=="side"?(r(),C("div",Rl,[e(p,{theme:"default",shape:"square",variant:"text",onClick:m},{default:a(()=>[e(B,{class:"collapsed-icon",name:"view-list"})]),_:1})])):O("",!0)]),operations:a(()=>[t("div",El,[e(F,{placement:"bottom",content:"代码仓库",class:"hide-on-mobile"},{default:a(()=>[e(p,{theme:"default",shape:"square",variant:"text",onClick:I},{default:a(()=>[e(B,{name:"logo-github"})]),_:1})]),_:1}),e(F,{placement:"bottom",content:"帮助文档",class:"hide-on-mobile"},{default:a(()=>[e(p,{theme:"default",shape:"square",variant:"text",onClick:g},{default:a(()=>[e(B,{name:"help-circle"})]),_:1})]),_:1}),e(G,{"min-column-width":135,trigger:"click"},{dropdown:a(()=>[e(x,null,{default:a(()=>[e(T,{class:"operations-dropdown-container-item",onClick:E[1]||(E[1]=$=>b("/settings"))},{default:a(()=>[e(B,{name:"user-circle"}),E[2]||(E[2]=_("个人中心 ",-1))]),_:1}),e(T,{class:"operations-dropdown-container-item",onClick:k},{default:a(()=>[e(B,{name:"poweroff"}),E[3]||(E[3]=_("退出登录 ",-1))]),_:1})]),_:1})]),default:a(()=>[e(p,{class:"header-user-btn",theme:"default",variant:"text"},{icon:a(()=>[e(N,{image:y(n).userInfo.avatar},null,8,["image"])]),suffix:a(()=>[e(B,{name:"chevron-down"})]),default:a(()=>[t("div",Pl,M(y(n).userInfo.name),1)]),_:1})]),_:1}),e(G,{"min-column-width":135,trigger:"click",class:"show-on-mobile"},{dropdown:a(()=>[e(x,null,{default:a(()=>[e(T,{class:"operations-dropdown-container-item",onClick:I},{default:a(()=>[e(B,{name:"logo-github"}),E[4]||(E[4]=_("代码仓库 ",-1))]),_:1}),e(T,{class:"operations-dropdown-container-item",onClick:g},{default:a(()=>[e(B,{name:"help-circle"}),E[5]||(E[5]=_("帮助文档 ",-1))]),_:1}),e(T,{class:"operations-dropdown-container-item",onClick:i},{default:a(()=>[e(B,{name:"setting"}),E[6]||(E[6]=_("系统设置 ",-1))]),_:1})]),_:1})]),default:a(()=>[e(p,{theme:"default",shape:"square",variant:"text"},{default:a(()=>[e(B,{name:"more"})]),_:1})]),_:1}),e(F,{placement:"bottom",content:"系统设置",class:"hide-on-mobile"},{default:a(()=>[e(p,{theme:"default",shape:"square",variant:"text",onClick:i},{default:a(()=>[e(B,{name:"setting"})]),_:1})]),_:1})])]),_:2},[s.layout!=="side"?{name:"default",fn:a(()=>[e($a,{class:"header-menu hide-on-mobile","nav-data":s.menu,"is-horizontal":!0},null,8,["nav-data"]),e(h,{placement:"bottom-left",class:"show-on-mobile header-menu-mobile-popup","overlay-style":{padding:"0",width:"100%",marginTop:"2px",boxShadow:"none",borderTop:"1px solid var(--td-border-level-1-color)"}},{content:a(()=>[e(A,{value:f.value,theme:s.theme,"expand-mutex":"",style:{width:"100vw"},onChange:S},{default:a(()=>[e($a,{"nav-data":s.menu},null,8,["nav-data"])]),_:1},8,["value","theme"])]),default:a(()=>[e(p,{style:{"margin-left":"-16px"},theme:"default",shape:"square",variant:"text"},{default:a(()=>[e(B,{name:"app"})]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["class","theme","value"])],2)}}}),Fl=oe(zl,[["__scopeId","data-v-f5039bf3"]]),Qa=ne({__name:"LayoutHeader",setup(s){const n=Dt(),l=Ze(),{routers:c}=Sa(n),o=te(()=>l.layout==="mix"?l.splitMenu?c.value.map(i=>({...i,children:[]})):[]:c.value);return(i,f)=>y(l).showHeader?(r(),j(Fl,{key:0,"show-logo":y(l).showHeaderLogo,theme:y(l).displayMode,layout:y(l).layout,"is-fixed":y(l).isHeaderFixed,menu:o.value,"is-compact":y(l).isSidebarCompact},null,8,["show-logo","theme","layout","is-fixed","menu","is-compact"])):O("",!0)}}),Tl={};function Dl(s,n){const l=v("router-view");return r(),j(l,null,{default:a(({Component:c})=>[e(aa,{name:"fade",mode:"out-in"},{default:a(()=>[(r(),j(Gs,null,[(r(),j(st(c)))],1024))]),_:2},1024)]),_:1})}const Ol=oe(Tl,[["render",Dl],["__scopeId","data-v-6214f40c"]]),jl=ne({__name:"Breadcrumb",setup(s){const n=te(()=>{const l=Qe(),c=l.path.split("/");return c.shift(),c.reduce((i,f,u)=>(l.matched[u]?.meta?.hiddenBreadcrumb||Object.values(l.params).includes(f)||i.push({path:f,to:i[u-1]?`/${i[u-1].path}/${f}`:`/${f}`,title:l.matched[u]?.meta?.title??f}),i),[])});return(l,c)=>{const o=v("t-breadcrumbItem"),i=v("t-breadcrumb");return r(),j(i,{"max-item-width":"150",class:"tdesign-breadcrumb"},{default:a(()=>[(r(!0),C(pe,null,ye(n.value,f=>(r(),j(o,{key:f.to,to:f.to},{default:a(()=>[_(M(f.title),1)]),_:2},1032,["to"]))),128))]),_:1})}}}),Kl=oe(jl,[["__scopeId","data-v-b4121266"]]),ql={class:"glass-capsule design-card"},Nl={class:"copyright"},Gl=ne({__name:"Footer",setup(s){return(n,l)=>(r(),C("footer",{class:we(`${y(Me)}-footer-centered-lite`)},[t("div",ql,[l[0]||(l[0]=t("span",{class:"brand"},"MSLX-WEBPANEL",-1)),l[1]||(l[1]=t("span",{class:"divider"},"/",-1)),l[2]||(l[2]=t("span",{class:"brand"},"MSLTEAM",-1)),l[3]||(l[3]=t("span",{class:"divider"},"/",-1)),t("span",Nl,"© 2021-"+M(new Date().getFullYear()),1)])],2))}}),Hl=oe(Gl,[["__scopeId","data-v-05d9fb24"]]),Ya=ne({__name:"LayoutContent",setup(s){const n=Ze();return(l,c)=>{const o=v("t-content"),i=v("t-footer"),f=v("t-layout");return r(),j(f,{class:we(`${y(Me)}-layout`)},{default:a(()=>[e(o,{class:we(`${y(Me)}-content-layout`)},{default:a(()=>[y(n).showBreadcrumb?(r(),j(Kl,{key:0})):O("",!0),e(Ol)]),_:1},8,["class"]),y(n).showFooter?(r(),j(i,{key:0,class:we(`${y(Me)}-footer-layout`)},{default:a(()=>[e(Hl)]),_:1},8,["class"])):O("",!0)]),_:1},8,["class"])}}}),Jl="mslx-webpanel",Wl="1.1.6",Xl={dev:"vite --mode development","dev:linux":"vite --mode development","build:test":"vite build --mode test",build:"vue-tsc --noEmit && vite build --mode release && node generate-build-info.js",preview:"vite preview",lint:"eslint --ext .vue,.js,.jsx,.ts,.tsx ./ --max-warnings 0","lint:fix":"eslint --ext .vue,.js,jsx,.ts,.tsx ./ --max-warnings 0 --fix",stylelint:"stylelint src/**/*.{html,vue,sass,less}","stylelint:fix":"stylelint --fix src/**/*.{html,vue,vss,sass,less}",prepare:`node -e "if(require('fs').existsSync('.git')){process.exit(1)}" || is-ci || husky install`,"site:preview":"npm run build && cp -r dist _site",test:'echo "no test specified,work in process"',"test:coverage":'echo "no test:coverage specified,work in process"'},Ql={"@codemirror/lang-javascript":"^6.2.4","@codemirror/lang-json":"^6.0.2","@codemirror/lang-yaml":"^6.1.2","@codemirror/language":"^6.12.1","@codemirror/legacy-modes":"^6.5.2","@codemirror/state":"^6.5.2","@codemirror/theme-one-dark":"^6.1.3","@codemirror/view":"^6.39.2","@eslint/js":"^9.38.0","@microsoft/signalr":"^10.0.0","@vueuse/core":"^14.0.0","@xterm/addon-fit":"^0.11.0","@xterm/xterm":"^5.6.0-beta.143","ansi-colors":"^4.1.3",axios:"^1.13.1","cron-parser":"^5.4.0",dayjs:"^1.11.11",echarts:"^5.5.1",lodash:"4.17.23","md-editor-v3":"^6.1.0",nprogress:"^0.2.0",pinia:"^2.1.7","pinia-plugin-persistedstate":"^3.2.1","qrcode.vue":"^3.4.1",qs:"6.14.1","tdesign-icons-vue-next":"^0.4.1","tdesign-vue-next":"^1.17.1","tvision-color":"^1.6.0","typescript-eslint":"^8.46.2",vue:"^3.4.31","vue-clipboard3":"^2.0.0","vue-codemirror":"^6.1.1","vue-router":"^4.4.0"},Yl={"@commitlint/cli":"^19.3.0","@commitlint/config-conventional":"^19.2.2","@types/lodash":"^4.17.23","@types/qs":"^6.9.15","@types/ws":"^8.5.10","@typescript-eslint/eslint-plugin":"^8.46.2","@typescript-eslint/parser":"^8.46.2","@vitejs/plugin-vue":"^6.0.3","@vitejs/plugin-vue-jsx":"^5.1.3","@vue/compiler-sfc":"^3.4.31","@vue/eslint-config-typescript":"^14.6.0",commitizen:"^4.3.0","cz-conventional-changelog":"^3.3.0",eslint:"^9.38.0","eslint-config-prettier":"^9.1.0","eslint-plugin-import":"^2.32.0","eslint-plugin-prettier":"^5.1.3","eslint-plugin-vue":"^10.7.0","eslint-plugin-vue-scoped-css":"^2.12.0",husky:"^9.1.1",less:"^4.2.0","lint-staged":"^15.2.7",prettier:"^3.3.3",stylelint:"^16.25.0","stylelint-less":"^3.0.0","stylelint-order":"^6.0.4",typescript:"^5.5.3",vite:"^7.3.1","vite-svg-loader":"^5.1.0","vue-tsc":"^2.0.26"},Zl={commitizen:{path:"./node_modules/cz-conventional-changelog"}},eo="MSLX Web Panel",Et={name:Jl,version:Wl,scripts:Xl,dependencies:Ql,devDependencies:Yl,config:Zl,"lint-staged":{"*.{js,jsx,vue,ts,tsx}":["prettier --write","npm run lint:fix","git add ."],"*.{html,vue,vss,sass,less}":["npm run stylelint:fix","git add ."]},description:eo},to=["src"],ao={class:"version-container"},so=991,no=ne({__name:"SideNav",props:{menu:{type:Array,default:()=>[]},showLogo:{type:Boolean,default:!0},isFixed:{type:Boolean,default:!0},layout:{type:String,default:""},headerHeight:{type:String,default:"64px"},theme:{type:String,default:"light"},isCompact:{type:Boolean,default:!1}},setup(s){const n=s,l=te(()=>Ze().isSidebarCompact),c=te(()=>ta()),o=te(()=>{const S=ta(),k=S.substring(0,S.lastIndexOf("/")),I=qo();return zn(I,k===""?[]:[k])}),i=te(()=>{const{isCompact:S}=n;return[`${Me}-sidebar-layout`,{[`${Me}-sidebar-compact`]:S}]}),f=te(()=>{const{showLogo:S,isFixed:k,layout:I}=n;return[`${Me}-side-nav`,{[`${Me}-side-nav-no-logo`]:!S,[`${Me}-side-nav-no-fixed`]:!k,[`${Me}-side-nav-mix-fixed`]:I==="mix"&&k}]}),u=jt(),d=Ze(),m=()=>{const S=window.innerWidth<=so;d.updateConfig({isSidebarCompact:S})};ke(()=>{m(),window.onresize=()=>{m()}});const b=()=>{u.push("/dashboard/base")};return(S,k)=>{const I=v("t-menu");return r(),C("div",{class:we(i.value)},[e(I,{class:we(f.value),theme:s.theme,value:c.value,collapsed:l.value,"default-expanded":o.value},{logo:a(()=>[s.showLogo?(r(),C("span",{key:0,class:we(`${y(Me)}-side-nav-logo-wrapper`),style:Vt(l.value?"display: flex; justify-content: center; width: 100%;":"display: flex; align-items: center; justify-content: flex-start; width: 100%;"),onClick:b},[t("img",{style:{width:"32px","margin-right":"8px"},src:y(Ra),class:we(`${y(Me)}-side-nav-logo-img`),alt:"logo"},null,10,to),l.value?O("",!0):(r(),C("span",{key:0,style:{"font-size":"18px","font-weight":"bold","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap"},class:we(`${y(Me)}-side-nav-logo-text`)}," MSLX 管理中心 ",2))],6)):O("",!0)]),operations:a(()=>[t("span",ao,M(l.value?"":"MSLX Web Panel")+" "+M(y(Et).version),1)]),default:a(()=>[e($a,{"nav-data":s.menu},null,8,["nav-data"])]),_:1},8,["class","theme","value","collapsed","default-expanded"]),t("div",{class:we(`${y(Me)}-side-nav-placeholder${l.value?"-hidden":""}`)},null,2)],2)}}}),Za=ne({__name:"LayoutSideNav",setup(s){const n=Qe(),l=Dt(),c=Ze(),{routers:o}=Sa(l),i=te(()=>{const{layout:f,splitMenu:u}=c;let d=o.value;return f==="mix"&&u&&d.forEach(m=>{n.path.indexOf(m.path)===0&&(d=m.children.map(b=>({...b,path:`${m.path}/${b.path}`})))}),d});return(f,u)=>y(c).showSidebar?(r(),j(no,{key:0,"show-logo":y(c).showSidebarLogo,layout:y(c).layout,"is-fixed":y(c).isSidebarFixed,menu:i.value,theme:y(c).displayMode,"is-compact":y(c).isSidebarCompact},null,8,["show-logo","layout","is-fixed","menu","theme","is-compact"])):O("",!0)}}),lo="/assets/jpg/mslx-bg_light_new.CL71WzMj.jpg",oo="/assets/jpg/mslx-bg_night_new.CfCwUDBl.jpg";let mt=new Map;const es=s=>[s.method,s.url].join("&");class ro{addPending(n){this.removePending(n);const l=es(n);n.cancelToken=n.cancelToken||new Wt.CancelToken(c=>{mt.has(l)||mt.set(l,c)})}removeAllPending(){mt.forEach(n=>{n&&pt(n)&&n()}),mt.clear()}removePending(n){const l=es(n);if(mt.has(l)){const c=mt.get(l);c&&c(l),mt.delete(l)}}reset(){mt=new Map}}class io{instance;options;constructor(n){this.options=n,this.instance=Wt.create(n),this.setupInterceptors()}createAxios(n){this.instance=Wt.create(n)}getTransform(){const{transform:n}=this.options;return n}getAxios(){return this.instance}configAxios(n){this.instance&&this.createAxios(n)}setHeader(n){this.instance&&Object.assign(this.instance.defaults.headers,n)}setupInterceptors(){const n=this.getTransform();if(!n)return;const{requestInterceptors:l,requestInterceptorsCatch:c,responseInterceptors:o,responseInterceptorsCatch:i}=n,f=new ro;this.instance.interceptors.request.use(u=>{const{headers:{ignoreRepeatRequest:d}}=u;return(d??this.options.requestOptions?.ignoreRepeatRequest)||f.addPending(u),l&&pt(l)&&(u=l(u,this.options)),u},void 0),c&&pt(c)&&this.instance.interceptors.request.use(void 0,c),this.instance.interceptors.response.use(u=>(u&&f.removePending(u.config),o&&pt(o)&&(u=o(u)),u),void 0),i&&pt(i)&&this.instance.interceptors.response.use(void 0,i)}supportFormData(n){const l=n.headers||this.options.headers;return(l?.["Content-Type"]||l?.["content-type"])!=="application/x-www-form-urlencoded;charset=UTF-8"||!Reflect.has(n,"data")||n.method?.toUpperCase()==="GET"?n:{...n,data:Fn.stringify(n.data,{arrayFormat:"brackets"})}}get(n,l){return this.request({...n,method:"GET"},l)}post(n,l){return this.request({...n,method:"POST"},l)}put(n,l){return this.request({...n,method:"PUT"},l)}delete(n,l){return this.request({...n,method:"DELETE"},l)}patch(n,l){return this.request({...n,method:"PATCH"},l)}async request(n,l){let c=Tn(n);const o=this.getTransform(),{requestOptions:i}=this.options,f={...i,...l},{beforeRequestHook:u,requestCatchHook:d,transformRequestHook:m}=o||{};return u&&pt(u)&&(c=u(c,f)),c.requestOptions=f,c=this.supportFormData(c),new Promise((b,S)=>{this.instance.request(n.retryCount?n:c).then(k=>{if(m&&pt(m)){try{const I=m(k,f);b(I)}catch(I){S(I||new Error("请求错误!"))}return}b(k)}).catch(k=>{if(d&&pt(d)){S(d(k,f));return}Wt.isAxiosError(k),S(k)})})}}const uo="YYYY-MM-DD HH:mm:ss";function ts(s,n=!1){if(!s)return n?"":{};const l=new Date().getTime();return n?`?_t=${l}`:{_t:l}}function Aa(s){if(Object.prototype.toString.call(s)==="[object Object]")for(const n in s){if(s[n]&&s[n]._isAMomentObject&&(s[n]=s[n].format(uo)),_t(n)){const l=s[n];if(l)try{s[n]=_t(l)?l.trim():l}catch(c){throw new Error(c)}}Ls(s[n])&&Aa(s[n])}}function co(s,n){let l="";for(const c in n)l+=`${c}=${encodeURIComponent(n[c])}&`;return l=l.replace(/&$/,""),/\?$/.test(s)?s+l:s.replace(/\/?$/,"?")+l}const mo={transformRequestHook:(s,n)=>{const{isTransformResponse:l,isReturnNativeResponse:c}=n,o=s.config.method?.toLowerCase();if(s.status===204||o==="put"||o==="patch"||c)return s;if(!l)return s.data;const{data:i}=s;if(!i)throw new Error("请求接口错误");if(i&&Reflect.has(i,"code")&&Reflect.has(i,"message")){const{code:u,message:d}=i;if(u===200)return i.data;throw new Error(d||`请求接口错误, 错误码: ${u}`)}else return i},beforeRequestHook:(s,n)=>{const{apiUrl:l,isJoinPrefix:c,urlPrefix:o,joinParamsToUrl:i,formatDate:f,joinTime:u=!0}=n;c&&o&&_t(o)&&(s.url=`${o}${s.url}`),l&&_t(l)&&!s.baseURL&&(s.url=`${l}${s.url}`);const d=s.params||{},m=s.data||!1;return f&&m&&!_t(m)&&Aa(m),s.method?.toUpperCase()==="GET"?_t(d)?(s.url=`${s.url+d}${ts(u,!0)}`,s.params=void 0):s.params=Object.assign(d||{},ts(u,!1)):_t(d)?(s.url+=d,s.params=void 0):(f&&Aa(d),Reflect.has(s,"data")&&s.data&&(Object.keys(s.data).length>0||m instanceof FormData)?(s.data=m,s.params=d):(s.data=d,s.params=void 0),i&&(s.url=co(s.url,{...s.params,...s.data}))),s},requestInterceptors:(s,n)=>{const l=localStorage.getItem(At),c=localStorage.getItem(xt);return c&&!/^(https?:)?\/\//.test(s.url||"")&&!s.baseURL&&(s.baseURL=c),l&&s?.requestOptions?.withToken!==!1&&(s.headers.hasAuthorization()||(s.headers["x-user-token"]=l)),s},responseInterceptors:s=>s,responseInterceptorsCatch:s=>{const{response:n}=s;if(n&&n.data){const c=n.data?.message;return c?Promise.reject(new Error(c)):Promise.reject(s)}return Promise.reject(s)}};function po(s){return new io(Dn({authenticationScheme:"",timeout:10*1e3,withCredentials:!1,headers:{"Content-Type":"application/json;charset=UTF-8"},transform:mo,requestOptions:{apiUrl:"",isJoinPrefix:!0,urlPrefix:"",isReturnNativeResponse:!1,isTransformResponse:!0,joinParamsToUrl:!1,formatDate:!0,joinTime:!1,ignoreRepeatRequest:!0,withToken:!0,retry:{count:3,delay:1e3}}},{}))}const Q=po();function vo(){return Q.get({url:"/api/settings"})}function fo(s){return Q.post({url:"/api/settings",data:s})}function go(s){return Q.post({url:"/api/settings/webpanel/style",data:s})}function _o(){return Q.get({url:"/api/settings/webpanel/style"})}async function qt(){return await Q.post({url:"/api/files/upload/init"})}async function Nt(s,n,l,c,o){const i=new FormData;return i.append("index",n.toString()),i.append("file",l),await Q.post({url:`/api/files/upload/chunk/${s}`,data:i,headers:{"Content-Type":"multipart/form-data"},timeout:300*1e3,onUploadProgress:c,signal:o})}async function Gt(s,n){return await Q.post({url:`/api/files/upload/finish/${s}`,data:{totalChunks:n},timeout:120*1e3})}async function ht(s){return await Q.post({url:`/api/files/upload/delete/${s}`})}async function ho(s){return await Q.get({url:`/api/files/upload/inspect/${s}`,timeout:60*1e3})}async function yo(s,n=""){return await Q.get({url:`/api/files/instance/${s}/lists`,params:{path:n}})}async function ra(s,n){return await Q.get({url:`/api/files/instance/${s}/content`,params:{path:n}})}function Ea(s,n,l){return Q.post({url:`/api/files/instance/${s}/content`,data:{path:n,content:l}})}function bo(s,n,l){return Q.post({url:`/api/files/instance/${s}/directory`,data:{path:n,name:l}})}function wo(s,n,l){return Q.post({url:`/api/files/instance/${s}/rename`,data:{oldPath:n,newPath:l}})}function ko(s,n){return Q.post({url:`/api/files/instance/${s}/delete`,data:{paths:n}})}function $o(s,n,l,c){return Q.post({url:`/api/files/instance/${s}/upload`,data:{uploadId:n,fileName:l,currentPath:c}})}function Ao(s,n){return Q.get({url:`/api/files/instance/${s}/download`,params:{path:n},responseType:"blob"})}function xo(s,n,l,c){return Q.post({url:`/api/files/instance/${s}/compress`,data:{sources:n,targetName:l,currentPath:c}})}function Co(s){return Q.get({url:`/api/files/task/compress/${s}`})}function So(s,n,l,c="utf-8",o=!0){return Q.post({url:`/api/files/instance/${s}/decompress`,data:{fileName:n,currentPath:l,encoding:c,createSubFolder:o}})}function Io(s){return Q.get({url:`/api/files/task/decompress/${s}`})}async function Vo(s,n,l){return await Q.post({url:`/api/files/instance/${s}/chmod`,data:{path:n,mode:l}})}async function xa(s,n,l){return await Q.get({url:`/api/files/pm/instance/${s}/list?${l?"checkClient=true":""}`,params:{mode:n}})}async function Mo(s,n,l,c){return await Q.post({url:`/api/files/pm/instance/${s}/set`,data:{mode:n,action:l,targets:c}})}function Lo(s,n,l){return Q.post({url:`/api/files/instance/${s}/copy`,data:{sourcePaths:n,targetPath:l},timeout:120*1e3})}function Uo(s,n,l){return Q.post({url:`/api/files/instance/${s}/move`,data:{sourcePaths:n,targetPath:l},timeout:120*1e3})}function Bo(s,n){return Q.post({url:"api/static/images/upload",data:{fileKey:s,fileName:n}})}const ia=gt("webpanel",{state:()=>({settings:{webPanelStyleDarkBackgroundOpacity:1,webPanelStyleDarkComponentsOpacity:.4,webpPanelTerminalBlurDark:5,webPanelStyleLightBackground:"",webPanelStyleLightBackgroundOpacity:1,webPanelStyleLightComponentsOpacity:.6,webpPanelTerminalBlurLight:5,webPanelStyleDarkBackground:"",webPanelColorizeLogLevel:1},loading:!1,submitLoading:!1}),actions:{async fetchSettings(){this.loading=!0;try{const s=await _o();this.settings=s}catch(s){console.error("获取面板样式失败",s)}finally{this.loading=!1}},async saveSettings(){this.submitLoading=!0;try{await go(this.settings),P.success("面板样式保存成功")}catch(s){P.error("保存失败: "+s.message)}finally{this.submitLoading=!1}},async uploadImage(s){if(!s)return P.error("文件对象无效"),null;if(!["image/png","image/jpeg","image/webp"].includes(s.type))return P.error("仅支持 PNG, JPG, WEBP 格式的图片"),null;if(!(s.size/1024/1024<10))return P.error("图片大小不能超过 10MB"),null;try{const{uploadId:c}=await qt();return await Nt(c,1,s),await Gt(c,1),await Bo(c,s.name),P.success(`上传成功: ${s.name}`),s.name}catch(c){return P.error("上传失败: "+(c.message||"网络错误")),null}}},persist:{key:"webpanel-style-storage",paths:["settings"]}}),Ro=ne({__name:"index",setup(s){const n=Qe(),l=Ze(),c=Fe(),o=ia(),i=Sa(l),f=(b,S)=>b?b.startsWith("http")?b:`${c.baseUrl||window.location.origin}/api/static/images/${b}`:S,u=te(()=>{const b=o.settings,S=f(b.webPanelStyleLightBackground,lo),k=f(b.webPanelStyleDarkBackground,oo);return{"--bg-img-light":`url('${S}')`,"--bg-img-dark":`url('${k}')`,"--bg-op-light":b.webPanelStyleLightBackgroundOpacity,"--bg-op-dark":b.webPanelStyleDarkBackgroundOpacity,"--comp-op-light":b.webPanelStyleLightComponentsOpacity,"--comp-op-dark":b.webPanelStyleDarkComponentsOpacity,"--term-blur-light":`${b.webpPanelTerminalBlurLight??5}px`,"--term-blur-dark":`${b.webpPanelTerminalBlurDark??5}px`}}),d=te(()=>l.enableCustomTheme),m=te(()=>[{"t-layout--with-sider":l.showSidebar}]);return ke(()=>{o.fetchSettings()}),be(()=>n.path,()=>{document.querySelector(`.${Me}-layout`).scrollTo({top:0,behavior:"smooth"})}),(b,S)=>{const k=v("t-aside"),I=v("t-header"),g=v("t-content"),V=v("t-layout");return r(),C("div",{class:we(["global-layout-bg",{"custom-theme-enabled":d.value}]),style:Vt(u.value)},[y(i).layout.value==="side"?(r(),j(V,{key:"side",class:we(m.value)},{default:a(()=>[e(k,null,{default:a(()=>[e(Za)]),_:1}),e(V,null,{default:a(()=>[e(I,null,{default:a(()=>[e(Qa)]),_:1}),e(g,null,{default:a(()=>[e(Ya)]),_:1})]),_:1})]),_:1},8,["class"])):(r(),j(V,{key:"no-side"},{default:a(()=>[e(I,null,{default:a(()=>[e(Qa)]),_:1}),e(V,{class:we(m.value)},{default:a(()=>[e(Za),e(Ya)]),_:1},8,["class"])]),_:1})),e(Ba)],6)}}}),nt=oe(Ro,[["__scopeId","data-v-85d874ec"]]),Eo=[{path:"/dashboard",redirect:"/dashboard/base",component:nt,name:"dashboard",meta:{title:"仪表盘",icon:"dashboard"},children:[{path:"base",name:"DashboardBaseIndex",component:()=>Ge(()=>Promise.resolve().then(()=>Mi),void 0),meta:{title:"仪表盘",hidden:!0}}]},{path:"/instance",component:nt,name:"instance",meta:{title:"服务端管理",icon:"server"},children:[{path:"list",name:"InstanceList",component:()=>Ge(()=>Promise.resolve().then(()=>Xi),void 0),meta:{title:"服务端列表",icon:"grid-view"}},{path:"create",name:"InstanceCreate",component:()=>Ge(()=>Promise.resolve().then(()=>Qd),void 0),meta:{title:"创建服务端",icon:"add"}}]},{path:"/frp",component:nt,name:"frp",meta:{title:"隧道管理",icon:"rocket"},children:[{path:"list",name:"FrpList",component:()=>Ge(()=>Promise.resolve().then(()=>Gc),void 0),meta:{title:"隧道列表",icon:"format-vertical-align-left"}},{path:"create",name:"FrpCreate",component:()=>Ge(()=>Promise.resolve().then(()=>kp),void 0),meta:{title:"创建隧道",icon:"add"}}]}],Po=Object.freeze(Object.defineProperty({__proto__:null,default:Eo},Symbol.toStringTag,{value:"Module"})),zo=[{path:"/frp/console",component:nt,meta:{hidden:!0},children:[{path:":frpId",name:"FrpConsole",component:()=>Ge(()=>Promise.resolve().then(()=>vv),void 0),meta:{title:"隧道控制台",hidden:!0,activeMenu:"/frp/list"}}]},{path:"/instance/console",component:nt,meta:{hidden:!0},children:[{path:":serverId",name:"InstanceConsole",component:()=>Ge(()=>Promise.resolve().then(()=>th),void 0),meta:{title:"服务器控制台",hidden:!0,activeMenu:"/instance/list"}}]},{path:"/instance/files",component:nt,meta:{hidden:!0},children:[{path:":serverFilesId",name:"InstanceFiles",component:()=>Ge(()=>Promise.resolve().then(()=>uy),void 0),meta:{title:"文件管理",hidden:!0,activeMenu:"/instance/list"}}]}],Fo=Object.freeze(Object.defineProperty({__proto__:null,default:zo},Symbol.toStringTag,{value:"Module"})),as=()=>Ge(()=>Promise.resolve().then(()=>py),void 0),To=[{path:"/frame",name:"Frame",component:nt,redirect:"/frame/doc",meta:{icon:"earth",title:"链接"},children:[{path:"MSLX",name:"MSLX",component:as,meta:{frameSrc:"https://mslx.mslmc.cn",frameBlank:!0,title:"MSLX 文档",icon:"book"}},{path:"MSLUser",name:"MSLUser",component:as,meta:{frameSrc:"https://user.mslmc.net",frameBlank:!0,title:"MSL 用户中心",icon:"user-arrow-left"}}]}],Do=Object.freeze(Object.defineProperty({__proto__:null,default:To},Symbol.toStringTag,{value:"Module"})),Oo=[{path:"/users",component:nt,name:"usersBase",meta:{title:"用户管理",icon:"user"},children:[{path:"",name:"users",component:()=>Ge(()=>Promise.resolve().then(()=>Ly),void 0),meta:{title:"用户管理",hidden:!0}}]},{path:"/settings",component:nt,name:"settingsBase",meta:{title:"设置",icon:"setting"},children:[{path:"",name:"settings",component:()=>Ge(()=>Promise.resolve().then(()=>Yy),void 0),meta:{title:"设置",hidden:!0}}]},{path:"/about",component:nt,name:"aboutBase",meta:{title:"关于面板",icon:"info-circle"},children:[{path:"",name:"about",component:()=>Ge(()=>Promise.resolve().then(()=>qb),void 0),meta:{title:"关于面板",hidden:!0}}]}],jo=Object.freeze(Object.defineProperty({__proto__:null,default:Oo},Symbol.toStringTag,{value:"Module"})),ss=Object.assign({"./modules/base.ts":Po,"./modules/components.ts":Fo,"./modules/iframe.ts":Do,"./modules/others.ts":jo}),Ps=[];Object.keys(ss).forEach(s=>{const n=ss[s].default||{},l=Array.isArray(n)?[...n]:[n];Ps.push(...l)});const Ca=[...Ps],Ko=[{path:"/login",name:"login",component:()=>Ge(()=>Promise.resolve().then(()=>w0),void 0)},{path:"/oauth/callback",name:"oauth",component:()=>Ge(()=>Promise.resolve().then(()=>T0),void 0)},{path:"/",redirect:"/dashboard/base"},{path:"/404",name:"404",component:()=>Ge(()=>Promise.resolve().then(()=>G0),void 0)},{path:"/:w+",name:"404Page",redirect:"/404"}],zs=[...Ko,...Ca],qo=()=>{const s=[];return zs.forEach(n=>{n.meta&&n.meta.expanded&&s.push(n.path),n.children&&n.children.length>0&&n.children.filter(l=>l.meta&&l.meta.expanded).forEach(l=>{s.push(n.path),s.push(`${n.path}/${l.path}`)})}),On(s)},ta=(s=3)=>{const n=it.currentRoute.value;return n.path?n.meta?.activeMenu?n.meta.activeMenu:n.path.split("/").filter((l,c)=>c<=s&&c>0).map(l=>`/${l}`).join(""):""};function Ae(s){s.includes("http")?window.open(s):it.replace(s)}const it=Hs({history:Js(),routes:zs,scrollBehavior(){return{el:"#app",top:0,behavior:"smooth"}}});function No(s,n){const l=[],c=[];return s.forEach(o=>{const i=[];o.children?.forEach(f=>{const u=f.meta?.roleCode||f.name;n.indexOf(u)!==-1?i.push(f):c.push(f)}),i.length>0&&(o.children=i,l.push(o))}),{accessedRouters:l,removeRoutes:c}}const Dt=gt("permission",{state:()=>({whiteListRouters:["/login","/oauth/callback"],routers:[],removeRoutes:[],dynamicRoutesAdded:[]}),actions:{async initRoutes(s){this.clearRoutes();let n=[],l=[];if(s.includes("all"))n=Ca;else{const o=No(Ca,s);n=o.accessedRouters,l=o.removeRoutes}const c=[];n.forEach(o=>{it.addRoute(o),o.name&&c.push(o.name)}),this.routers=n,this.removeRoutes=l,this.dynamicRoutesAdded=c},async clearRoutes(){this.dynamicRoutesAdded.forEach(n=>{it.hasRoute(n)&&it.removeRoute(n)}),this.routers=[],this.removeRoutes=[],this.dynamicRoutesAdded=[]}}});function Go(){return Dt(ua)}const ns="remembered_url",ls="remembered_username",fa={name:"",username:"",avatar:"",id:"",version:"",systemInfo:{netVersion:"",osType:"",osVersion:"",osArchitecture:"",hostname:""},targetFrontendVersion:{desktop:"",panel:""},roles:[]},Fe=gt("user",{state:()=>({token:localStorage.getItem(At)||"",baseUrl:localStorage.getItem(xt)||window.location.origin,userInfo:{...fa}}),getters:{roles:s=>s.userInfo?.roles||[]},actions:{async checkConnection(s){let n=s;s&&!/^(https?:)?\/\//.test(s)&&(n=`http://${s}`);try{return await Q.get({url:"/api/ping",baseURL:n||void 0,timeout:3e3}),!0}catch{return!1}},async login(s){const{url:n,username:l,password:c,checked:o}=s;let i=n;i&&!/^(https?:)?\/\//.test(i)&&(i=`http://${i}`);const f=i||"";try{const u=await Q.post({url:"/api/auth/login",baseURL:f,data:{username:l,password:c}});this.token=u.token,this.baseUrl=f,localStorage.setItem(At,u.token),localStorage.setItem(xt,f),o?(localStorage.setItem(ns,n||""),localStorage.setItem(ls,l)):(localStorage.removeItem(ns),localStorage.removeItem(ls)),await this.getUserInfo()}catch(u){throw console.error("Login failed:",u),u}},async loginByOAuth(s){try{this.token=s.token,localStorage.setItem(At,s.token),this.baseUrl||(this.baseUrl=window.location.origin,localStorage.setItem(xt,this.baseUrl)),await this.getUserInfo()}catch(n){throw console.error("OAuth登录失败:",n),n}},async getUserInfo(){if(this.token)try{const s=await Q.get({url:"/api/status"});this.userInfo={...fa,...s,name:s.user||s.username,roles:["all"]},await Dt().initRoutes(this.userInfo.roles)}catch(s){console.error("Get user info failed:",s),await this.logout(),Ae("/login")}},async logout(){await Dt().clearRoutes(),localStorage.removeItem(At),localStorage.removeItem(xt),this.token="",this.baseUrl="",this.userInfo={...fa}},async removeToken(){this.token=""}},persist:{afterRestore:s=>{s.store.token&&s.store.getUserInfo()}}});function Fs(){return Fe(ua)}const Ho={...Ua,showSettingPanel:!1,colorList:il,chartColors:Es,systemTheme:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"},Ze=gt("setting",{state:()=>Ho,getters:{showSidebar:s=>s.layout!=="top",showSidebarLogo:s=>s.layout==="side",showHeaderLogo:s=>s.layout!=="side",displayMode:s=>s.mode==="auto"?s.systemTheme:s.mode},actions:{async changeMode(s){let n=s;s==="auto"&&(n=this.systemTheme);const l=n==="dark";document.documentElement.setAttribute("theme-mode",l?"dark":""),this.chartColors=l?ul:Es},setSystemTheme(s){this.systemTheme=s,this.mode==="auto"&&this.changeMode("auto")},changeBrandTheme(s){document.documentElement.setAttribute("theme-color",s)},addColor(s){this.colorList={...this.colorList,...s}},updateConfig(s){for(const n in s)s[n]!==void 0&&(this[n]=s[n]),n==="mode"&&this.changeMode(s[n]),n==="brandTheme"&&this.changeBrandTheme(s[n])}},persist:{paths:[...jn(Ua),"colorList","chartColors"]}});async function Jo(){return Q.get({url:"/api/update/info"})}async function Wo(){return Q.get({url:"/api/update/download"})}async function Xo(){return Q.post({url:"/api/update"})}const Pa=gt("update",()=>{const s=w(!1),n=w(null),l=w(null),c=w(!1);return{showUpdateModal:s,updateInfo:n,downloadInfo:l,loading:c,checkAppUpdate:async(f=!1)=>{if(!c.value){c.value=!0;try{const d=await Jo();if(d&&d.needUpdate){if(!f&&localStorage.getItem("mslx-skip-version")===d.latestVersion){console.log(`[Update] 用户已跳过版本 ${d.latestVersion}`);return}n.value=d;try{const m=await Wo();l.value=m}catch(m){console.error("获取下载链接失败",m),l.value={web:"",file:""}}s.value=!0,f&&P.success("发现新版本！")}else f&&P.success("当前已是最新版本")}catch(u){console.error("[Update] 检查更新失败:",u),f&&P.error("检查更新失败，请检查网络日志")}finally{c.value=!1}}},handleSkipVersion:()=>{n.value?.latestVersion&&(localStorage.setItem("mslx-skip-version",n.value.latestVersion),P.success("已跳过该版本，下次将不再提醒"),s.value=!1)}}}),ua=Ws();ua.use(Xs());zt.configure({showSpinner:!1});it.beforeEach(async(s,n,l)=>{window.document.title=s.meta.title?`${s.meta.title} | MSLX 控制台`:"MSLX 控制台",zt.start();const c=Fs(),o=Go(),{whiteListRouters:i}=o,{token:f}=c;if(f){if(s.path==="/login"||s.path==="/oauth/callback"){l();return}const{roles:u}=c;if(u&&u.length>0)l();else try{await c.getUserInfo();const{roles:d}=c;await o.initRoutes(d),it.hasRoute(s.name)?l():l("/")}catch(d){P.error(d),l({path:"/login",query:{redirect:encodeURIComponent(s.fullPath)}}),zt.done()}}else i.indexOf(s.path)!==-1?l():l({path:"/login",query:{redirect:encodeURIComponent(s.fullPath)}}),zt.done()});it.afterEach(s=>{s.path==="/login"&&Fs().logout(),zt.done()});const Qo={class:"modal-header"},Yo={class:"header-content"},Zo={class:"title-row"},er={class:"version-row"},tr={class:"modal-body"},ar={key:0,class:"status-container success"},sr={key:1,class:"status-container docker-warn"},nr={key:2,class:"status-container server-running-warn"},lr={class:"warn-icon-wrapper"},or={key:3,class:"status-container permission-wait"},rr={key:4,class:"status-container updating"},ir={key:0,class:"error-box"},ur={class:"progress-info"},dr={class:"speed"},cr={key:5},mr={style:{margin:"4px 0 0 0","line-height":"1.6"}},pr={class:"log-scroll-area"},vr={class:"log-text"},fr={key:0,class:"modal-footer"},gr={class:"primary-actions"},_r={class:"secondary-grid"},hr={key:0,class:"sub-actions"},yr={key:1,class:"modal-footer"},br={key:2,class:"modal-footer"},wr={key:3,class:"modal-footer"},kr={class:"primary-actions"},$r=ne({__name:"UpdateModal",props:{visible:{type:Boolean},updateInfo:{},downloadInfo:{}},emits:["close","skip","success"],setup(s,{emit:n}){const l=s,c=n,o=Fe(),i=w(!1),f=w(0),u=w("0 KB/s"),d=w("准备中..."),m=w(!1),b=w(!1),S=w(!1),k=w("");let I=null;const g=te(()=>l.updateInfo?.status==="beta"),V=te(()=>{const R=o.userInfo?.systemInfo?.osType||"";return R.includes("macOS")||R.includes("OSX")}),E=te(()=>(o.userInfo?.systemInfo?.osType||"").toLowerCase().includes("linux")),B=R=>{R&&window.open(R,"_blank")},p=()=>{c("close"),Ae("/instance/list")},A=()=>{if(i.value&&!S.value){P.warning("正在更新中，请勿关闭窗口");return}T(),c("close")},h=()=>{c("skip")},F=()=>{window.location.reload()},T=async()=>{if(I){try{await I.stop()}catch(R){console.error("Stop Hub Error:",R)}I=null}},x=async()=>{await T();const{baseUrl:R,token:$}=o,L=new URL("/api/hubs/daemonUpdate",R||window.location.origin);$&&L.searchParams.append("x-user-token",$),I=new wt().withUrl(L.toString(),{withCredentials:!1}).configureLogging(Mt.Warning).withAutomaticReconnect([0,2e3,5e3,1e4]).build(),I.on("UpdateProgress",U=>{f.value=U.progress||0,u.value=U.speed||"",U.stage==="permission_check"?d.value="等待服务端确认权限...":U.stage==="restarting"?(console.log("[Update] 收到重启信号，准备轮询..."),d.value="服务正在重启...",T(),setTimeout(()=>{G()},3e3)):d.value=U.status||"正在处理..."}),I.on("UpdateFailed",U=>{i.value=!1,k.value=U||"更新失败",T()}),I.onclose(U=>{I&&(i.value&&f.value>=100?setTimeout(()=>{G()},6e3):U&&(i.value=!1,k.value=`连接断开: ${U.message}`))});try{await I.start()}catch(U){k.value=`连接更新服务失败: ${U.message}`,i.value=!1}},N=async()=>{if(!i.value){i.value=!0,m.value=!1,b.value=!1,k.value="",f.value=0,S.value=!1,await x();try{await Xo()}catch(R){i.value=!1,T();const $=R.message||"";$.includes("Docker")||$.includes("容器")?m.value=!0:$.includes("运行")&&($.includes("服务器")||$.includes("实例"))?b.value=!0:k.value=$||"请求更新失败，请检查网络或日志"}}},G=async()=>{d.value="服务正在重启，请稍候...";const R=async()=>{try{return await Q.get({url:"/api/ping",timeout:3e3}),!0}catch{return!1}},$=60;let L=0;const U=setInterval(async()=>{L++,await R()?(clearInterval(U),i.value=!1,S.value=!0,d.value="更新成功！",T(),setTimeout(()=>c("success"),1e3)):L>$&&(clearInterval(U),i.value=!1,k.value="服务重启超时，请手动刷新页面检查状态。",T())},2e3)};return Je(()=>{T()}),(R,$)=>{const L=v("t-tag"),U=v("t-button"),Z=v("t-alert"),W=v("t-progress"),J=v("t-link"),H=v("t-popconfirm"),he=v("t-dialog");return r(),j(he,{visible:l.visible,header:!1,footer:!1,"close-on-overlay-click":!1,"close-btn":!1,width:"500px",class:"update-modal","destroy-on-close":"",onClose:A},{default:a(()=>[t("div",Qo,[t("div",Yo,[t("div",Zo,[t("h3",null,M(S.value?"更新完成":"发现新版本"),1),g.value?(r(),j(L,{key:0,theme:"warning",variant:"light"},{default:a(()=>[...$[2]||($[2]=[_("Beta",-1)])]),_:1})):(r(),j(L,{key:1,theme:"success",variant:"light"},{default:a(()=>[...$[3]||($[3]=[_("Release",-1)])]),_:1}))]),t("div",er,[e(L,{variant:"outline",size:"small"},{default:a(()=>[_(M(s.updateInfo?.currentVersion),1)]),_:1}),$[4]||($[4]=t("span",{class:"arrow"},"→",-1)),e(L,{theme:"primary",variant:"light-outline",size:"small"},{default:a(()=>[_(M(s.updateInfo?.latestVersion),1)]),_:1})])]),i.value?O("",!0):(r(),j(U,{key:0,variant:"text",shape:"circle",onClick:A},{icon:a(()=>[e(y(Ia))]),_:1}))]),t("div",tr,[S.value?(r(),C("div",ar,[e(y(yt),{size:"48px",class:"success-icon"}),$[5]||($[5]=t("p",null,[t("b",null,"MSLX守护进程端"),_("已成功更新至最新版本")],-1)),$[6]||($[6]=t("p",{class:"sub-text"},"请刷新页面以加载最新功能",-1))])):m.value?(r(),C("div",sr,[e(Z,{theme:"warning",title:"检测到 Docker 环境",message:"当前程序运行在 Docker 容器内，不支持热更新。请使用以下命令更新："}),$[7]||($[7]=t("div",{class:"code-block"},"docker pull docker.mslmc.cn/xiaoyululu/mslx-daemon:latest && docker-compose up -d",-1))])):b.value?(r(),C("div",nr,[t("div",lr,[e(y(sa),{size:"48px",style:{color:"var(--td-warning-color)"}})]),$[8]||($[8]=t("p",{class:"warn-title"},"无法开始更新",-1)),$[9]||($[9]=t("p",{class:"warn-desc"},[_(" 检测到当前有服务器实例正在运行。 "),t("br"),_("为了防止数据丢失，请先停止所有实例。 ")],-1))])):d.value.includes("等待服务端确认权限")?(r(),C("div",or,[...$[10]||($[10]=[t("p",{class:"warn-title"},"请在服务端确认权限",-1),t("p",{class:"warn-desc"},[_(" macOS 系统已弹出提示： "),t("br"),t("strong",null,"“MSLX-Daemon 想要控制应用程序 终端.app”"),_(),t("br"),_("请务必点击 "),t("strong",null,"【好/OK】"),_(" 以继续更新。 ")],-1)])])):i.value||k.value?(r(),C("div",rr,[k.value?(r(),C("div",ir,[e(y(fs),{style:{color:"var(--td-error-color)"}}),t("span",null,M(k.value),1)])):(r(),C(pe,{key:1},[t("div",ur,[t("span",null,M(d.value),1),t("span",dr,M(u.value),1)]),e(W,{theme:"plump",percentage:f.value,status:f.value>=100?"active":"success"},null,8,["percentage","status"])],64))])):(r(),C("div",cr,[V.value?(r(),j(Z,{key:0,theme:"warning",variant:"outline",class:"macos-alert"},{message:a(()=>[...$[11]||($[11]=[t("strong",null,"macOS 用户请注意：",-1),t("br",null,null,-1),_("受 Apple 安全机制 (Gatekeeper) 限制，更新重启后应用可能无法自动启动。如遇此情况，请前往「系统设置 > 隐私与安全性」手动允许应用运行。 ",-1)])]),_:1})):O("",!0),E.value?(r(),j(Z,{key:1,theme:"info",variant:"outline",class:"macos-alert"},{message:a(()=>[$[17]||($[17]=t("strong",null,"Linux 用户提示：",-1)),t("ul",mr,[t("li",null,[$[13]||($[13]=_(" 如使用一键脚本部署，推荐优先参考 ",-1)),e(J,{theme:"primary",href:"https://mslx.mslmc.cn/docs/install/linux/",target:"_blank",style:{"vertical-align":"baseline"}},{default:a(()=>[...$[12]||($[12]=[_(" 官方文档 ",-1)])]),_:1}),$[14]||($[14]=_(" 使用脚本进行更新。 ",-1))]),$[15]||($[15]=t("li",null,[_(" 若启用 "),t("strong",null,"Systemd"),_(" 托管，请确保服务名称为 "),t("code",null,"mslx"),_("，否则自动更新后可能无法自动重启。 ")],-1)),$[16]||($[16]=t("li",null,"如果更新完成后仍然是旧版本，请尝试手动重启服务或手动更新！",-1))])]),_:1})):O("",!0),$[18]||($[18]=t("div",{class:"log-title"},"更新内容：",-1)),t("div",pr,[t("div",vr,M(s.updateInfo?.log||"暂无详细日志"),1)])]))]),!S.value&&!m.value&&!b.value?(r(),C("div",fr,[t("div",gr,[e(U,{theme:"primary",block:"",loading:i.value,disabled:i.value,onClick:N},{icon:a(()=>[e(y(gs))]),default:a(()=>[_(" "+M(i.value?"正在更新...":"立即更新"),1)]),_:1},8,["loading","disabled"]),t("div",_r,[e(U,{variant:"outline",disabled:!s.downloadInfo?.file||i.value,onClick:$[0]||($[0]=Te=>B(s.downloadInfo?.file||""))},{icon:a(()=>[e(y(_s))]),default:a(()=>[$[19]||($[19]=_(" 下载新版本 ",-1))]),_:1},8,["disabled"]),e(U,{variant:"dashed",disabled:!s.downloadInfo?.web||i.value,onClick:$[1]||($[1]=Te=>B(s.downloadInfo?.web||""))},{icon:a(()=>[e(y(bt))]),default:a(()=>[$[20]||($[20]=_(" 前往下载页 ",-1))]),_:1},8,["disabled"])])]),i.value?O("",!0):(r(),C("div",hr,[e(H,{content:"确定要跳过此版本吗？跳过后将不再提示该版本的更新。若跳过后需要更新也可以前往设置页面进行更新哦~",theme:"warning",onConfirm:h},{default:a(()=>[e(J,{theme:"default",hover:"color",size:"small"},{default:a(()=>[...$[21]||($[21]=[_(" 跳过此版本 ",-1)])]),_:1})]),_:1})]))])):O("",!0),S.value?(r(),C("div",yr,[e(U,{theme:"primary",block:"",onClick:F},{default:a(()=>[...$[22]||($[22]=[_("刷新页面",-1)])]),_:1})])):O("",!0),m.value?(r(),C("div",br,[e(U,{variant:"outline",block:"",onClick:A},{default:a(()=>[...$[23]||($[23]=[_("我知道了",-1)])]),_:1})])):O("",!0),b.value?(r(),C("div",wr,[t("div",kr,[e(U,{theme:"primary",block:"",onClick:p},{default:a(()=>[...$[24]||($[24]=[_(" 前往实例列表管理 ",-1)])]),_:1}),e(U,{variant:"outline",style:{"margin-left":"0"},block:"",onClick:A},{default:a(()=>[...$[25]||($[25]=[_(" 暂不更新 ",-1)])]),_:1})])])):O("",!0)]),_:1},8,["visible"])}}}),Ar=oe($r,[["__scopeId","data-v-a1f85172"]]),xr=ne({__name:"App",setup(s){const n=Ze(),l=Pa(),c=te(()=>n.displayMode),o=window.matchMedia("(prefers-color-scheme: dark)"),i=f=>{n.setSystemTheme(f.matches?"dark":"light")};return ke(()=>{l.checkAppUpdate(!1),o.addEventListener("change",i),n.setSystemTheme(o.matches?"dark":"light")}),Je(()=>{o.removeEventListener("change",i)}),(f,u)=>{const d=v("router-view");return r(),C(pe,null,[e(d,{class:we([c.value])},null,8,["class"]),e(Ar,{visible:y(l).showUpdateModal,"update-info":y(l).updateInfo,"download-info":y(l).downloadInfo,onClose:u[0]||(u[0]=m=>y(l).showUpdateModal=!1),onSkip:y(l).handleSkipVersion},null,8,["visible","update-info","download-info","onSkip"])],64)}}}),Cr=oe(xr,[["__scopeId","data-v-579b9e12"]]),da=Qs(Cr);da.use(Ys);da.use(ua);da.use(it);da.mount("#app");console.log(`
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣤⣤⣶⣶⣤⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣴⣾⠿⠛⠋⠉⠩⣄⠘⢿⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⣿⡏⠑⠒⠀⠀⣀⣀⠀⠀⢹⠈⣿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣿⣷⡀⢀⣰⣿⡿⣿⣧⠀⠀⢡⣾⣧⣀⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⣿⣿⣿⣿⣯⣴⣿⠿⣄⣤⣾⡿⠟⠛⠛⠿⢿⣶⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣴⣶⠿⠛⠋⠙⣿⣏⠀⠀⢻⣿⣡⣀⣀⠀⠀⠀⠀⢹⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣾⠿⠋⠁⠀⣀⣤⣶⣾⣿⣿⣤⣤⣾⣿⠉⠉⠙⠻⣿⠆⢀⣾⡿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⡿⠋⠁⠀⣀⣴⣿⠿⠛⠉⠀⢀⣿⡿⠿⠟⢿⣆⠀⢀⣴⣯⣴⣿⠟⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⣠⡾⠋⠀⠀⣠⣾⠟⠋⠀⠀⠀⠀⠀⣈⣿⣷⣤⣴⣾⣿⣈⣻⣿⡟⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⣰⡿⠁⠀⣠⡾⠋⠁⠀⠀⢀⣠⣴⠶⠞⠛⠛⠋⠉⠉⠉⠉⠙⠛⠻⠷⣦⣤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠰⣿⠁⠀⠀⣿⣄⣀⣠⣴⡾⠛⠉⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⣿⠿⣶⣄⠀⠀⠀⢀⣠⡄⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠈⠛⠶⠶⢾⣿⠿⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢷⣄⠉⠙⠻⠿⠟⢹⡇⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⠟⠁⠀⠀⠀⠀⠀⠀⠀⢀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣄⠀⠀⠀⠀⠘⣿⣿⣦⣀⠀⠲⣾⣁⠀⠀⠀⠀⠀⡀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⢀⡾⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢹⣦⡀⠀⠀⠀⣿⡿⣿⣿⣿⡆⠀⠉⠛⠛⠛⠛⢻⡏⠀
⠀⠀⠀⠀⠀⠀⠀⣠⡾⠁⠀⠀⠀⠀⠀⠀⠀⠀⢀⡄⣸⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⣿⠛⢦⡀⠰⣿⣿⣿⣽⣿⡇⠀⠀⠀⠀⠀⢠⡿⠀⠀
⠀⠀⠀⠀⣀⣤⡾⢻⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠀⡏⠙⣷⡀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡇⠰⣽⣶⣄⠉⠻⣿⣿⣧⠀⠀⢀⣤⣾⠟⠁⠀⠀
⢰⣶⡾⠛⠋⠉⠀⠀⠀⠀⠀⢀⡀⠀⠀⠀⠀⠀⢸⣸⡇⠀⣨⣿⣾⡋⠀⠀⠀⠀⢀⠀⠀⣿⡀⠀⠈⠛⢷⣄⠈⠛⣿⡆⠀⠘⣿⡀⠀⠀⠀⠀
⠀⠙⠿⣦⣀⠀⠀⠀⠀⠀⠀⡾⠀⠀⠀⠀⠀⠀⣿⣿⠀⠀⠋⠀⠙⢿⣦⣀⠀⠀⠘⣷⣄⣹⣧⠀⠀⠀⠈⢻⣦⠀⠈⠋⠀⠀⠘⣧⠀⠀⠀⠀
⠀⠀⠀⠈⠛⠿⢶⡶⠃⠀⣰⠃⠀⠀⠀⠀⠀⢠⣿⠃⠀⠀⠀⠀⠀⠀⠉⠻⢷⣦⣤⣘⣿⡛⠛⠀⢀⣴⣶⣦⡹⣷⡀⠀⠀⠀⠀⠸⣧⠀⠀⠀
⠀⠀⠀⠀⠀⢠⡿⠃⠀⢀⡟⠀⠀⠀⠀⠀⠀⣼⣿⠀⠀⢀⣴⣿⣿⣷⡄⠀⠀⠈⠉⠉⠉⠉⠀⠀⢸⣿⣿⣿⣷⠻⣧⠀⠀⠀⠀⠀⢿⡆⠀⠀
⠀⠀⠀⠀⢰⣿⠁⠀⠀⢸⠁⠀⠀⠀⠀⠀⠈⠋⣿⠀⠀⠸⣿⣿⣿⣿⡷⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠛⠿⠟⠃⠀⢻⣧⠀⠀⠀⠀⠸⣧⠀⠀
⠀⠀⠀⠀⣿⡇⠀⠀⠀⣿⠀⠀⠀⠀⠀⠀⠀⠀⣿⠀⠀⠀⠉⠻⠿⠋⠀⠀⢠⡀⠀⠀⣀⣀⣀⣸⠇⠀⠀⠀⠀⠀⠈⢿⣧⠀⠀⠀⠀⣿⡀⠀
⠀⠀⠀⢰⣿⠁⠀⠀⢰⡏⠀⠀⠀⠀⠀⠀⠀⠀⢿⡀⠀⠀⠀⠀⠀⣸⠀⠀⠈⠛⠒⠛⠉⠈⠉⠀⠀⠀⠀⠀⠀⠀⠀⢸⡟⠀⠀⠀⠀⢸⡇⠀
⠀⠀⠀⢸⣿⠀⠀⠀⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⢸⡇⠀⠀⠀⠀⠚⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣿⠁⠀⠀⠀⠀⢸⣿⠀
⠀⠀⠀⢸⣿⠀⠀⠀⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⠘⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣀⣀⣀⣤⣶⡿⠋⣿⠀⠀⠀⠀⠀⠀⣿⠀
⠀⠀⠀⠘⣿⡄⠀⠀⢸⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀⢿⣧⣄⣀⣀⣀⣠⣤⣶⣶⣾⣿⣿⣿⣿⠿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠀⠀⣠⠀⠀⢠⣿⡄
⠀⠀⠀⠀⢻⣧⠀⠀⠸⣿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠈⣿⣿⣿⣟⠛⢻⡟⢻⡉⠉⣫⣀⠀⠀⠀⠉⠉⠛⠙⠿⣷⣿⡿⠁⢀⣰⡟⠀⠀⢸⣿⠀
⠀⠀⠀⠀⠈⢻⣧⡀⠀⠹⣷⡀⠀⠀⠀⠀⢠⠀⠀⠀⠘⣿⣿⣿⢻⡿⠀⠈⠷⠟⠁⠘⢾⣿⣶⣤⣶⣾⡇⠀⣿⣿⣤⣶⣿⣿⠃⠀⠀⣾⡟⠀
⠀⠀⠀⠀⠀⠈⠻⣷⣄⡀⠹⣷⣄⠀⠀⠀⢸⣷⣤⡀⠀⠈⢻⣿⣯⣤⠀⠀⣠⡀⠀⢀⣼⣿⣿⣿⣿⣟⠁⠐⠿⣿⣿⣿⣿⠋⠀⢀⣾⠟⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠈⠙⠿⣷⣮⣽⣷⣶⣤⣤⣿⣿⣿⣷⣶⣦⣭⣿⣿⣧⣠⠵⢯⡆⠚⣯⢿⠋⠛⠛⢫⣀⣠⣾⣿⢿⣿⣥⣤⠶⠛⠁⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠉⠉⢁⣾⣿⣿⣿⠿⠿⠿⠿⠻⢿⣿⣿⣷⣦⣤⣤⣀⣤⣤⣄⣶⣿⣿⡿⠟⠉⠀⠀⢻⡄⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣴⣿⣿⣿⣿⣿⡇⠀⠀⣀⡀⠈⢿⣧⠀⠉⠙⠛⠛⠛⠛⠛⠛⠉⠁⠀⠀⠀⠀⠀⠀⢿⡄⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣴⣿⣿⡏⠛⠉⢻⣿⣿⣿⣾⣿⣿⠀⢸⣿⠀⠀⠀⠀⠀⠙⠓⠢⠀⠀⠀⠀⠀⠸⠀⠀⠀⠘⣿⡄⠀⠀⠀⠀⠀`);console.log("人生得意须尽吃，莫使金箸空对月。 —— 派蒙");const Sr={class:"welcome-header"},Ir={class:"avatar-section"},Vr=["src"],Mr={class:"welcome-info"},Lr={class:"welcome-text"},Ur={class:"hitokoto-text"},Br=ne({__name:"Banner",setup(s){const n=Fe(),l=w("");async function c(){const o=`Every little creature in the world has their own piece of paradise.
Plants take root in the boundless earth, and their leaves grow toward the stars.`;try{const i=await Q.get({url:"/?c=a&c=b&c=c&c=d",baseURL:"https://v1.hitokoto.cn"});i&&i.hitokoto?l.value=`${i.hitokoto} —— 《${i.from}》${i.from_who?` (${i.from_who})`:""}`:l.value=o}catch(i){l.value=o,console.error("获取一言(Hitokoto)失败:",i)}}return ke(()=>{c()}),(o,i)=>(r(),j(y(Va),{shadow:"",bordered:!1,class:"welcome-card"},{default:a(()=>[t("div",Sr,[t("div",Ir,[t("img",{src:y(n).userInfo.avatar,alt:"头像",class:"user-avatar"},null,8,Vr)]),t("div",Mr,[t("h3",Lr,[e(y(at),{name:"sunny",class:"welcome-icon"}),_(" 你好, "+M(y(n).userInfo.name),1)]),t("p",Ur,M(l.value),1)])])]),_:1}))}}),Rr=oe(Br,[["__scopeId","data-v-bfba57a3"]]);async function za(s){return await Q.post({url:"/api/instance/createServer",data:s})}async function Er(s,n=!1){return await Q.post({url:"/api/instance/delete",data:{id:s,deleteFiles:n}})}async function Pr(){return await Q.get({url:"/api/instance/list"})}async function $t(s,n){return await Q.post({url:"/api/instance/action",data:{id:s,action:n},timeout:60*1e3})}async function Ts(s){return await Q.get({url:"/api/instance/info",params:{id:s}})}async function zr(s){return await Q.get({url:`/api/instance/settings/general/${s}`})}async function Fr(s){return await Q.post({url:`/api/instance/settings/general/${s.id}`,data:s})}const Ht=gt("instanceList",()=>{const s=w([]),n=w(0),l=w(0);async function c(){try{s.value=await Pr(),n.value=s.value.length,l.value=s.value.filter(o=>o.status).length}catch(o){P.error("获取实例列表失败:"+o.message)}}return{instanceList:s,refreshInstanceList:c,totalInstanceCount:n,onlineInstanceCount:l}}),Tr={class:"info-grid"},Dr={class:"info-item"},Or={class:"info-label"},jr={class:"info-value"},Kr={class:"info-item"},qr={class:"info-label"},Nr={class:"info-value"},Gr={class:"info-item"},Hr={class:"info-label"},Jr={class:"info-value truncate-value"},Wr={class:"info-item"},Xr={class:"info-label"},Qr={class:"info-value truncate-value"},Yr={class:"info-item"},Zr={class:"info-label"},ei={class:"info-value truncate-value"},ti={class:"info-item"},ai={class:"info-label"},si={class:"info-value"},ni={class:"info-item"},li={class:"info-label"},oi={class:"info-value truncate-value"},ri={class:"info-item"},ii={class:"info-label"},ui={class:"info-value"},di=ne({__name:"InfoCard",setup(s){const n=Fe(),l=Ht();return ke(()=>{l.refreshInstanceList()}),(c,o)=>(r(),j(y(Va),{shadow:"",bordered:!1,class:"system-info-card"},{default:a(()=>[t("div",Tr,[t("div",Dr,[t("span",Or,[e(y(at),{name:"server"}),o[0]||(o[0]=t("span",null,"在线实例：",-1))]),t("span",jr,M(y(l).onlineInstanceCount)+" / "+M(y(l).totalInstanceCount),1)]),t("div",Kr,[t("span",qr,[e(y(at),{name:"logo-codepen"}),o[1]||(o[1]=t("span",null,"NET环境：",-1))]),t("span",Nr,M(y(n).userInfo.systemInfo.netVersion),1)]),t("div",Gr,[t("span",Hr,[e(y(at),{name:"dashboard"}),o[2]||(o[2]=t("span",null,"面板版本：",-1))]),e(y(va),{content:y(Et).version,"max-width":"400px"},{default:a(()=>[t("span",Jr,M(y(Et).version),1)]),_:1},8,["content"])]),t("div",Wr,[t("span",Xr,[e(y(at),{name:"cloud"}),o[3]||(o[3]=t("span",null,"节点版本：",-1))]),e(y(va),{content:`v${y(n).userInfo.version}`,"max-width":"400px"},{default:a(()=>[t("span",Qr," v"+M(y(n).userInfo.version),1)]),_:1},8,["content"])]),t("div",Yr,[t("span",Zr,[e(y(at),{name:"desktop"}),o[4]||(o[4]=t("span",null,"主机名：",-1))]),t("span",ei,M(y(n).userInfo.systemInfo.hostname),1)]),t("div",ti,[t("span",ai,[e(y(at),{name:"system-code"}),o[5]||(o[5]=t("span",null,"系统类型：",-1))]),t("span",si,M(y(n).userInfo.systemInfo.osType)+" ("+M(y(n).userInfo.systemInfo.osArchitecture)+")",1)]),t("div",ni,[t("span",li,[e(y(at),{name:"system-setting"}),o[6]||(o[6]=t("span",null,"系统版本：",-1))]),e(y(va),{content:y(n).userInfo.systemInfo.osVersion,"max-width":"400px"},{default:a(()=>[t("span",oi,M(y(n).userInfo.systemInfo.osVersion),1)]),_:1},8,["content"])]),t("div",ri,[t("span",ii,[e(y(at),{name:"check-circle"}),o[7]||(o[7]=t("span",null,"版本匹配：",-1))]),t("span",ui,[e(y(Zs),{theme:y(n).userInfo.targetFrontendVersion.panel===y(Et).version?"success":"danger",variant:"light"},{default:a(()=>[_(M(y(n).userInfo.targetFrontendVersion.panel===y(Et).version?"正确匹配":"请更新"),1)]),_:1},8,["theme"])])])])]),_:1}))}}),ci=oe(di,[["__scopeId","data-v-e21be5b0"]]),mi={class:"monitor-dashboard"},pi={class:"card-content"},vi={class:"info-section"},fi={class:"value-group"},gi={class:"value"},_i={class:"card-content"},hi={class:"info-section"},yi={class:"value-group"},bi={class:"value"},wi={class:"sub-text"},ki=30,$i=ne({__name:"SystemStatus",setup(s){const n=Fe(),l=w(null),c=w(!1),o=w(null),i=w(null);let f=null,u=null;const d=He({cpu:0,memUsage:0,memUsed:0,memTotal:0}),m=[],b=[],S=[],k=B=>getComputedStyle(document.documentElement).getPropertyValue(B).trim()||"#999999",I=(B,p,A)=>({grid:{top:10,right:10,bottom:0,left:0,containLabel:!1},tooltip:{trigger:"axis",backgroundColor:"var(--td-bg-color-container)",borderColor:"var(--td-component-border)",textStyle:{color:"var(--td-text-color-primary)"},formatter:h=>{const F=h[0];return`${F.name}<br/><span style="color:${B}">●</span> ${p}: <b>${F.value}%</b>`}},xAxis:{type:"category",boundaryGap:!1,data:m,show:!1},yAxis:{type:"value",max:100,min:0,show:!1},series:[{name:p,type:"line",smooth:!0,showSymbol:!1,lineStyle:{width:2,color:B},areaStyle:{opacity:.2,color:new Rs(0,0,0,1,[{offset:0,color:B},{offset:1,color:"transparent"}])},data:A}]}),g=()=>{const B=k("--td-brand-color"),p=k("--td-success-color");o.value&&(f=ea(o.value),f.setOption(I(B,"CPU",[]))),i.value&&(u=ea(i.value),u.setOption(I(p,"Memory",[]))),window.addEventListener("resize",V)},V=()=>{f?.resize(),u?.resize()},E=async()=>{const{baseUrl:B,token:p}=n,A=new URL("/api/hubs/system",B||window.location.origin);p&&A.searchParams.append("x-user-token",p),l.value=new wt().withUrl(A.toString(),{withCredentials:!1}).withAutomaticReconnect().build(),l.value.on("ReceiveSystemStats",h=>{d.cpu=h.cpu,d.memUsage=h.memUsage,d.memUsed=h.memUsed,d.memTotal=h.memTotal,m.length>=ki&&(m.shift(),b.shift(),S.shift()),m.push(h.timestamp),b.push(h.cpu),S.push(h.memUsage),f?.setOption({xAxis:{data:m},series:[{data:b}]}),u?.setOption({xAxis:{data:m},series:[{data:S}]})});try{await l.value.start(),c.value=!0,await l.value.invoke("JoinMonitor")}catch(h){console.error("SignalR 连接失败:",h)}l.value.onclose(()=>{c.value=!1})};return ke(()=>{vt(()=>{setTimeout(()=>{g(),E()},100)})}),Je(async()=>{if(window.removeEventListener("resize",V),l.value)try{await l.value.invoke("LeaveMonitor"),await l.value.stop()}catch(B){console.error(B)}f?.dispose(),u?.dispose()}),(B,p)=>{const A=v("t-tag"),h=v("t-card"),F=v("t-col"),T=v("t-row");return r(),C("div",mi,[e(T,{gutter:[12,12]},{default:a(()=>[e(F,{xs:12,md:6},{default:a(()=>[e(h,{shadow:"",bordered:!1,class:"chart-card",size:"small"},{default:a(()=>[t("div",pi,[t("div",vi,[p[3]||(p[3]=t("div",{class:"label"},"CPU 使用率",-1)),t("div",fi,[t("span",gi,M(d.cpu),1),p[0]||(p[0]=t("span",{class:"unit"},"%",-1))]),c.value?(r(),j(A,{key:0,theme:"success",variant:"light",size:"small",class:"status-tag"},{default:a(()=>[...p[1]||(p[1]=[_(" 实时 ",-1)])]),_:1})):(r(),j(A,{key:1,theme:"danger",variant:"light",size:"small",class:"status-tag"},{default:a(()=>[...p[2]||(p[2]=[_(" 离线 ",-1)])]),_:1}))]),t("div",{ref_key:"cpuChartRef",ref:o,class:"chart-container"},null,512)])]),_:1})]),_:1}),e(F,{xs:12,md:6},{default:a(()=>[e(h,{shadow:"",bordered:!1,class:"chart-card",size:"small"},{default:a(()=>[t("div",_i,[t("div",hi,[p[5]||(p[5]=t("div",{class:"label"},"内存使用率",-1)),t("div",yi,[t("span",bi,M(d.memUsage),1),p[4]||(p[4]=t("span",{class:"unit"},"%",-1))]),t("div",wi,M((d.memUsed/1024).toFixed(1))+" / "+M((d.memTotal/1024).toFixed(1))+" GB ",1)]),t("div",{ref_key:"memChartRef",ref:i,class:"chart-container"},null,512)])]),_:1})]),_:1})]),_:1})])}}}),Ai=oe($i,[["__scopeId","data-v-4c938660"]]),xi={class:"card-header"},Ci={class:"announcement-wrapper"},Si=ne({__name:"Announcement",setup(s){const n=w(!0),l=w(""),c=hs(),o=w(c.value?"dark":"light");be(c,()=>{o.value=c.value?"dark":"light"});async function i(){n.value=!0;const f=`## 🔴 公告加载失败
- 请检查网络连接或联系管理员。`;try{const u=await Q.get({url:"https://api.mslmc.cn/v3/query/notice?query=mslxNoticeMd"});u&&u.mslxNoticeMd?l.value=u.mslxNoticeMd:l.value=f}catch(u){console.error("获取公告失败:",u),l.value=f}finally{n.value=!1}}return ke(()=>{i()}),(f,u)=>(r(),j(y(Va),{shadow:"",bordered:!1,class:"announcement-card"},{title:a(()=>[t("div",xi,[e(y(at),{name:"system-messages"}),u[0]||(u[0]=t("span",null,"系统公告",-1))])]),default:a(()=>[e(y(en),{loading:n.value,text:"加载中...",size:"small",style:{width:"100%"}},{default:a(()=>[t("div",Ci,[e(y(ys),{"editor-id":"announcement-preview","model-value":l.value,theme:o.value,class:"md-preview-wrapper"},null,8,["model-value","theme"])])]),_:1},8,["loading"])]),_:1}))}}),Ii=oe(Si,[["__scopeId","data-v-a0056e46"]]),Vi=ne({__name:"index",setup(s){const n=Fe(),l=te(()=>n.userInfo?.username==="mslx");return(c,o)=>{const i=v("t-alert");return r(),C("div",null,[l.value?(r(),j(i,{key:0,theme:"warning",title:"安全风险提示",message:"检测到您当前正在使用默认账号 (mslx)。为了保障系统安全，请务必尽快修改用户名和密码！",style:{"margin-bottom":"16px"}},{operation:a(()=>[t("span",{style:{cursor:"pointer"},onClick:o[0]||(o[0]=f=>y(Ae)("/settings"))},"去修改")]),_:1})):O("",!0),e(Rr),e(ci,{style:{"margin-top":"12px"}}),e(Ai,{style:{"margin-top":"12px"}}),e(Ii,{style:{"margin-top":"12px"}})])}}}),Mi=Object.freeze(Object.defineProperty({__proto__:null,default:Vi},Symbol.toStringTag,{value:"Module"})),Li="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAACXBIWXMAAAsSAAALEgHS3X78AAADgklEQVR42u2dPWhTYRSGk2qlZKia+BMNFuJQERehuFiogoNSJ7tIi4MKFkELInapVYOIS8SlCqKoiwji5OhStLQOlUz+YUFrC2li7I26hGCwEbXrOTec5OKN93nWw/363S8PJ7w9yU0oBAAAASWsFdPXb1Q5ouZn+Oxp8XVu4XiCDQIgACAAIAAgAASQlVrU6+07aFp0bTTqq5v8WiwG/XWu0gEAAQABAAEAAQABYDkGWuPc5PiEWIttXCfWIpGIebP3L4+arjt28YpYK5VKYu3Rtaumv3f43IgnL5bzedF05nQAQABAAEAAQABAAKgxBr5781asbUl2mKKVVnOLXts6EmLt/XzWdADWWKrtRbuHeiKiNerRAQABAAEAAQABAAGgxhgY3xQXa/lc3hSt3CZ6WrwaOHlKrF0akePVhwuDttNp3WDay8NbN00RsZ6YqE0K6QCAAIAAgACAAIAAgABQy/8BtKyvoY18eyoF9dqJebn2aXrBtG4i9tN0Hz1OwbQXbTTtdv9WtFHx3Mc5OgAgACAAIAAgACAA1BID/wX97TmxVh4/L9a6OitibXW8zbSXeL4sR2RlL/3t8ppZZ4Un58Y4GBAAEAAQABAAEAB8GgPdJnPxWKUpDs6rfS7RAQABAAEAAQABAAGg+WJgy+0hc3zampoSa8XsrFj7dueIaa/flYmfxpoTD8RaNJGUL0x1q+vmlbNbGhyjAwACAAIAAgACAAJAvTGwkFts+KJaXNFizp8YqNT2HDoq1p70Nj7qhYx7eTX9XL5/p1Vdt+3MXdN+HKWmvcZ0AN4CAAEAAQABAAEgcDHQeqH2XbQf9+QfatS+w/cbbeLnfMkpV643Ry8JbXKp7UW7B7dpaEZ5rO2q46N0AEAAQABAAEAAQACok/DwcKoqFQ/07TfFQA0tIv6NieX/+sAzM/rjaryIei+nMnQAQABAAEAAQABAAFjGd08KtU7udo89E2ubk52mNRdmZ8Tai6G9dABAAEAAQABAAEAAQADg/wAuuI07sy7jYguvJ582fE3rL394Me6lAwACAAIAAgACAAJAg2Kg9slf7ZOmu7q7PIuJEo8H9vkqznqBF2dOB+AtABAAEAAQABAAiIE1smPndl/diN+mbF7gxZnTAXgLAAQABAAEAASAoBHWitrzg6B5SKdTYToAIAAgACAAIAAgAAAAAECQ+QUUBtshXi5agwAAAABJRU5ErkJggg==",Ui="/assets/png/mslx-150px-Anvil.BV3t5jxS.png",Bi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAACWElEQVR42u3dPS8EURQG4G1RU6GWoFUqRK9Ao1BoJRJ+gEgUG4XERyJRKIQIFYVE0Gn8rPUPzolc1+zOPG/yljs7e89Tnczu9notz9zsxKBmewKAACAACAACgAAgAMjQDPBoYyns2+l+2O/DtbCAAAAAAAAAAAAAAAAAAAAAAADA3w0wG1DW99eXsDv95bDZ9TNgnQcCAAAAAAAAAAAAAAAAAAAAQKsAZB8wW6SUDvBxcz3sx/1l2M/r87DZ+3d+kQQAAAAAAAAAAAAAAAAAAAAAAL9obSAPdxdhn6/Own5vb4XtPBAAAAAAAAAAAAAAAAAAAAAAWgVgcmpqELV0wLW/2PHVXw5bOsDaD4xkzeYDAAAAAAAAAAAAAAAAAAAAAAC/yfzC4iBqdgO1D6gUSNMDzK6fnS8AAAAAAAAAAAAAAAAAAAAAAPwngJvbp7BNAyldRJX+gEXpAI+OT8ICAAAAAAAAAAAAAAAAAAAAAMB/AshusDaQ2g+clA5wd+8gbHZ+2esBAAAAAAAAAAAAAAAAAAAAAGCYFkFNA6m9iKk94JHfBAIAAAAAAAAAAAAAAAAAAADQKgClA64NpOkB2QQCAAAAAAAAAAAAAAAAAAAAMEoAhh3Iyupq2GEfcHZ+Y2PjYRv/xxAAAAAAAAAAAAAAAAAAAAAAOgWgaSAZgKYXMVmzAWfnBwAAAAAAAAAAAAAAAAAAAAAAo5RSIKWLoNYvYgAAAAAAAAAAAAAAAAAAAAAAoEVApmdmw1rEAAAAAAAAAAAAAAAAAAAAAACAiIiIiIiIiHQwP/KhHMCviKP2AAAAAElFTkSuQmCC",Ri="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAABi0lEQVR42u3cMWoCQRSAYW9mkzYHECGFYJXCKrWVTYpcQwIpUliICAaLEDxASiHn2GIs070njMgy+33wyhWZ91fD6mgEAAAAAAAAANAzh5euRLOdx5M974QFgAAQAAJAAAgAAXA/p7euRJMteL+I57yLJ/t8GxIAAkAACAABIAAEwO0ucrIF1T6fLXgzjed7FY8NCwABIAAEgAAQAALgX3bA2fy+x1MbQLbg7PvZsAAQAAJAAAgAASAArvd37Eo0tT8Mqb1osiEBIAAEgAAQAAJAAPTnImn+8RBO7QslNiAABIAAEAACQAAIgP54/ZmVaJyQABAAAkAACAABIADasdg8lmickAAQAAJAAAgAASAA2pG9EOKEBIAAEAACQAAIAAHQDhdBAhCAAAQgAAEIQAACEIAABCAAAQzH8mtSonFCAkAACAABIAAEgABohz+IEIAABCAAAQhAAAIQgAAEIAABCGA4nj/HJRonJAAEgAAQAAJAAAiAdjytxyUaJyQABIAAEAACQAAIYEAu6/zodBuokO4AAAAASUVORK5CYII=",Ei={class:"server-list-container"},Pi={class:"page-header"},zi={class:"card-header"},Fi={class:"status-badge"},Ti={class:"card-content"},Di={class:"server-name text-ellipsis"},Oi={class:"server-info"},ji={class:"info-item"},Ki={class:"info-item id-tag"},qi={class:"card-actions"},Ni={key:0,class:"empty-state"},Gi={class:"delete-dialog-body"},Hi={class:"checkbox-area"},Ji=ne({__name:"index",setup(s){const n=Ht();ke(()=>{n.refreshInstanceList()});const l=d=>{Ae(`/instance/console/${d.id}`)},c=(d,m)=>{if(d.includes("http"))return d;switch(d){case"neoforge":return Li;case"forge":return Ui;case"custom":return Bi;case"server-icon":return new URL(`${localStorage.getItem(xt)}/api/instance/icon/${m}.png?x-user-token=${localStorage.getItem(At)}`,import.meta.url).href;default:return Ri}},o=d=>d==="none"?"自定义模式":d.startsWith("@")?d.includes("neoforge")?"NeoForge":"Forge":d.replace(".jar",""),i=He({visible:!1,loading:!1,deleteFile:!1,item:null}),f=(d,m)=>{d.stopPropagation(),i.item=m,i.deleteFile=!1,i.loading=!1,i.visible=!0},u=async()=>{if(i.item){i.loading=!0;try{await Er(i.item.id,i.deleteFile),P.success("删除成功"),i.visible=!1,await n.refreshInstanceList()}catch(d){P.error("删除失败: "+d.message)}finally{i.loading=!1}}};return(d,m)=>{const b=v("t-button"),S=v("t-space"),k=v("t-loading"),I=v("t-avatar"),g=v("t-tag"),V=v("t-card"),E=v("t-col"),B=v("t-row"),p=v("t-empty"),A=v("t-checkbox"),h=v("t-dialog");return r(),C("div",Ei,[t("div",Pi,[m[5]||(m[5]=t("h2",{class:"title"},"服务端列表",-1)),e(S,null,{default:a(()=>[e(b,{theme:"primary",variant:"dashed",onClick:y(n).refreshInstanceList},{default:a(()=>[...m[3]||(m[3]=[_(" 刷新列表 ",-1)])]),_:1},8,["onClick"]),e(b,{theme:"primary",onClick:m[0]||(m[0]=F=>y(Ae)("/instance/create"))},{default:a(()=>[...m[4]||(m[4]=[_(" 添加服务端 ",-1)])]),_:1})]),_:1})]),e(k,{loading:!1,text:"加载中...",fullscreen:""}),e(B,{gutter:[24,24]},{default:a(()=>[(r(!0),C(pe,null,ye(y(n).instanceList,F=>(r(),j(E,{key:F.id,xs:12,sm:6,md:4,lg:3,xl:3},{default:a(()=>[e(V,{class:we(["server-card",{"status-running":F.status}]),bordered:!1,onClick:T=>l(F)},{default:a(()=>[t("div",zi,[t("div",{class:we(["icon-wrapper",{"is-running":F.status}])},[e(I,{image:c(F.icon,F.id),size:"large",shape:"round",class:"server-icon"},null,8,["image"])],2),t("div",Fi,[F.status?(r(),j(g,{key:0,theme:"success",variant:"light",shape:"round"},{icon:a(()=>[e(y(na))]),default:a(()=>[m[6]||(m[6]=_(" 运行中 ",-1))]),_:1})):(r(),j(g,{key:1,theme:"default",variant:"light",shape:"round"},{icon:a(()=>[e(y(tn))]),default:a(()=>[m[7]||(m[7]=_(" 未启动 ",-1))]),_:1}))])]),t("div",Ti,[t("h3",Di,M(F.name),1),t("div",Oi,[t("div",ji,[e(y(an),{class:"info-icon"}),t("span",null,M(o(F.core)),1)]),t("div",Ki,[t("span",null,"#"+M(F.id),1)])])]),t("div",qi,[m[8]||(m[8]=t("span",{class:"action-hint"},"点击管理",-1)),e(b,{shape:"circle",theme:"danger",variant:"text",class:"delete-btn",onClick:T=>f(T,F)},{default:a(()=>[e(y(Lt))]),_:1},8,["onClick"])])]),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:1}),y(n).instanceList.length===0?(r(),C("div",Ni,[e(p,{description:"暂无服务端实例"})])):O("",!0),e(h,{visible:i.visible,"onUpdate:visible":m[2]||(m[2]=F=>i.visible=F),header:"确认删除",theme:"danger","confirm-btn":{content:"确认删除",loading:i.loading},onConfirm:u},{default:a(()=>[t("div",Gi,[t("p",null,[m[9]||(m[9]=_(" 您确定要删除服务端 ",-1)),t("strong",null,M(i.item?.name),1),_(" (ID: "+M(i.item?.id)+") 吗？ ",1)]),m[11]||(m[11]=t("p",{class:"warning-text"},"此操作不可恢复！",-1)),t("div",Hi,[e(A,{modelValue:i.deleteFile,"onUpdate:modelValue":m[1]||(m[1]=F=>i.deleteFile=F)},{default:a(()=>[...m[10]||(m[10]=[_("同时删除服务端文件数据",-1)])]),_:1},8,["modelValue"])])])]),_:1},8,["visible","confirm-btn"])])}}}),Wi=oe(Ji,[["__scopeId","data-v-f9bac3c4"]]),Xi=Object.freeze(Object.defineProperty({__proto__:null,default:Wi},Symbol.toStringTag,{value:"Module"}));async function Qi(){return await Q.get({url:"/query/server_classify",baseURL:"https://api.mslmc.cn/v3"})}async function Yi(s){return await Q.get({url:`/query/available_versions/${s}`,baseURL:"https://api.mslmc.cn/v3"})}async function Zi(s,n){return await Q.get({url:`/download/server/${s}/${n}`,baseURL:"https://api.mslmc.cn/v3"})}const eu={class:"core-selector-layout"},tu={class:"sidebar"},au={key:1,class:"category-list"},su=["onClick"],nu={class:"cat-icon"},lu={class:"cat-info"},ou={class:"cat-name"},ru={class:"cat-desc"},iu={key:0,class:"cat-count"},uu={class:"main-panel"},du={class:"panel-section"},cu={class:"section-header"},mu={class:"core-grid"},pu=["onClick"],vu={key:0,class:"empty-text"},fu={key:0,class:"panel-section"},gu={class:"section-header"},_u={class:"section-title"},hu={class:"version-grid"},yu=["onClick"],bu={key:0,class:"empty-text"},wu=ne({__name:"ServerCoreSelector",props:{visible:{type:Boolean}},emits:["update:visible","confirm"],setup(s,{emit:n}){const l=s,c=n,o=te({get:()=>l.visible,set:h=>c("update:visible",h)}),i=w(!1),f=w(!1),u=w({}),d=w("plugins"),m=w(""),b=w([]),S=w(""),k=[{key:"plugins",name:"插件服务端",desc:"支持 Bukkit/Spigot/Paper 插件",icon:"app",dataKey:"pluginsCore"},{key:"forge_hybrid",name:"NeoForge 系混合服务端",desc:"同时支持 Neoforge/Forge模组 和 插件",icon:"layers",dataKey:"pluginsAndModsCore_Forge"},{key:"fabric_hybrid",name:"Fabric 混合服务端",desc:"同时支持 Fabric模组 和 插件",icon:"cpu",dataKey:"pluginsAndModsCore_Fabric"},{key:"mod_forge",name:"NeoForge 模组服务端",desc:"纯 NeoForge/Forge 模组支持",icon:"tools",dataKey:"modsCore_Forge"},{key:"mod_fabric",name:"Fabric 模组服务端",desc:"纯 Fabric 模组支持",icon:"ai-tool",dataKey:"modsCore_Fabric"},{key:"vanilla",name:"原版服务端",desc:"Minecraft 官方原版核心",icon:"tea",dataKey:"vanillaCore"},{key:"bedrock",name:"基岩版第三方端",desc:"第三方的基岩版服务端",icon:"gift",dataKey:"bedrockCore"},{key:"proxy",name:"代理服务端",desc:"BungeeCord / Velocity 等 用于群组服",icon:"share",dataKey:"proxyCore"}],I=te(()=>{const h=k.find(F=>F.key===d.value);return!h||!u.value?[]:u.value[h.dataKey]||[]}),g=te(()=>S.value?I.value.filter(h=>h.toLowerCase().includes(S.value.toLowerCase())):I.value),V=async()=>{i.value=!0;try{const h=await Qi();Array.isArray(h)&&h.length>0?u.value=h[0]:h&&!Array.isArray(h)&&(u.value=h)}catch(h){P.error("获取服务端分类失败"),console.error(h)}finally{i.value=!1}},E=h=>{d.value=h,m.value="",b.value=[],S.value=""},B=h=>{m.value!==h&&(m.value=h,p(h))},p=async h=>{f.value=!0,b.value=[];try{const F=await Yi(h);Array.isArray(F)&&F.length>0?b.value=F[0].versionList||[]:F&&!Array.isArray(F)&&(b.value=F.versionList||[])}catch(F){P.error(`获取 ${h} 版本列表失败`),console.error(F)}finally{f.value=!1}},A=async h=>{const F=P.loading("正在获取核心版本信息...",0);try{const T=await Zi(m.value,h),x={core:m.value,version:h,url:T.url,sha256:T.sha256||"",filename:`${m.value}-${h}.jar`};P.close(F),c("confirm",x),o.value=!1}catch(T){P.close(F),P.error("获取核心的版本信息失败"),console.error(T)}};return be(()=>l.visible,h=>{h&&!u.value.pluginsCore&&V()}),(h,F)=>{const T=v("t-loading"),x=v("t-icon"),N=v("t-input"),G=v("t-divider"),R=v("t-button"),$=v("t-dialog");return r(),j($,{visible:o.value,"onUpdate:visible":F[2]||(F[2]=L=>o.value=L),header:"选择服务端核心",width:"85%",top:"5vh",attach:"body",footer:!1,"destroy-on-close":"",class:"core-selector-dialog"},{default:a(()=>[t("div",eu,[t("div",tu,[F[3]||(F[3]=t("div",{class:"sidebar-title"},"服务端分类",-1)),F[4]||(F[4]=t("div",{class:"sidebar-desc"},"选择您需要的服务端类型",-1)),i.value?(r(),j(T,{key:0,loading:i.value,size:"small",text:"加载分类中..."},null,8,["loading"])):(r(),C("div",au,[(r(),C(pe,null,ye(k,L=>t("div",{key:L.key,class:we(["category-item",{active:d.value===L.key}]),onClick:U=>E(L.key)},[t("div",nu,[e(x,{name:L.icon},null,8,["name"])]),t("div",lu,[t("div",ou,M(L.name),1),t("div",ru,M(L.desc),1),u.value[L.dataKey]?(r(),C("div",iu,M(u.value[L.dataKey]?.length||0)+" 个核心 ",1)):O("",!0)])],10,su)),64))]))]),t("div",uu,[t("div",du,[t("div",cu,[F[5]||(F[5]=t("div",{class:"section-title"},"选择服务端核心",-1)),e(N,{modelValue:S.value,"onUpdate:modelValue":F[0]||(F[0]=L=>S.value=L),placeholder:"搜索核心...",class:"search-input"},{"suffix-icon":a(()=>[e(x,{name:"search"})]),_:1},8,["modelValue"])]),t("div",mu,[(r(!0),C(pe,null,ye(g.value,L=>(r(),C("div",{key:L,class:we(["core-card",{active:m.value===L}]),onClick:U=>B(L)},[_(M(L)+" ",1),m.value===L?(r(),j(x,{key:0,name:"check",class:"check-icon"})):O("",!0)],10,pu))),128)),g.value.length===0?(r(),C("div",vu,"该分类下暂无核心")):O("",!0)])]),m.value?(r(),C("div",fu,[e(G),t("div",gu,[t("div",_u,M(m.value)+" 版本列表",1),e(R,{size:"small",variant:"text",onClick:F[1]||(F[1]=L=>p(m.value))},{icon:a(()=>[e(x,{name:"refresh"})]),default:a(()=>[F[6]||(F[6]=_("刷新 ",-1))]),_:1})]),e(T,{loading:f.value,size:"small",text:"获取版本中...",class:"loading-wrapper"},{default:a(()=>[t("div",hu,[(r(!0),C(pe,null,ye(b.value,L=>(r(),C("div",{key:L,class:"version-item",onClick:U=>A(L)},M(L),9,yu))),128)),b.value.length===0&&!f.value?(r(),C("div",bu,"未找到该核心的版本信息")):O("",!0)])]),_:1},8,["loading"])])):O("",!0)])])]),_:1},8,["visible"])}}}),Fa=oe(wu,[["__scopeId","data-v-9e97180c"]]);async function Ta(s,n){return await Q.get({url:"/query/jdk",baseURL:"https://api.mslmc.cn/v3",params:{os:s,arch:n}})}async function Da(s=!1){return await Q.get({url:"/api/java/list",params:{refresh:s},timeout:60*1e3})}const ku={class:"main-layout-container"},$u={class:"steps-aside"},Au={class:"main-content"},xu={key:0,class:"form-step-container"},Cu={class:"step-content"},Su={class:"step-content"},Iu={style:{width:"100%"}},Vu={class:"java-option-panel"},Mu={key:0,class:"flex-row"},Lu={class:"tip"},Uu={key:1,class:"flex-row"},Bu={key:2},Ru={key:3},Eu={class:"step-content"},Pu={key:0,class:"online-select-area"},zu={class:"select-core-wrapper"},Fu={key:0,class:"selected-core-card"},Tu={class:"core-icon"},Du={class:"core-info"},Ou={class:"core-filename"},ju={key:1,class:"online-select-area"},Ku={class:"select-core-wrapper"},qu={key:1,class:"uploading-state"},Nu={class:"core-filename"},Gu={key:2,class:"selected-core-card"},Hu={class:"core-icon"},Ju={class:"core-info"},Wu={class:"core-filename"},Xu={class:"core-url"},Qu={key:2,class:"online-select-area"},Yu={class:"step-content"},Zu={key:1,class:"step-content creation-progress"},ed={class:"progress-title"},td={class:"log-time"},ad={class:"log-message"},sd={key:2,class:"result-success"},nd={class:"result-success-title"},ld=ne({__name:"QuickMode",setup(s){const n=Fe(),l=w(null),c=Ht(),o=w(0),i=w(!1),f=w(!1),u=w(!1),d=w(0),m=w([]),b=w(null),S=w(null),k=w(null),I=w("online"),g=w(!1),V=w(null),E=w(!1),B=w(0),p=w(""),A=w(""),h=w("online"),F=w([]),T=w([]),x=w(""),N=w(""),G=async(z=!1)=>{try{z&&P.info("正在刷新Java版本列表(重新扫描耗时较长)...");const K=await Ta(n.userInfo.systemInfo.osType.toLowerCase().replace("os",""),n.userInfo.systemInfo.osArchitecture.toLowerCase());K&&Array.isArray(K)&&(F.value=K.map(ae=>({label:`Java ${ae}`,value:ae})),F.value.length>0&&!x.value&&(x.value=F.value[1].value)),T.value=(await Da(z)).map(ae=>({label:`Java ${ae.version}${ae.is64Bit?"":" (32位)"} (${ae.vendor} | ${ae.path})`,value:ae.path})),T.value.length>0&&(N.value=T.value[0].value),z&&P.success("已刷新Java版本列表")}catch(K){P.warning("获取在线Java版本失败"+K.message)}};ke(()=>{G()});const R=w({name:"新建服务器",path:"",java:"",core:"",coreUrl:"",coreSha256:"",coreFileKey:"",packageFileKey:"",minM:1024,maxM:4096,args:""}),$=[{label:"GB",value:"GB"},{label:"MB",value:"MB"}],L=w("GB"),U=w("GB"),Z=te({get:()=>L.value==="GB"?R.value.minM/1024:R.value.minM,set:z=>{R.value.minM=L.value==="GB"?Math.round(z*1024):z}}),W=te({get:()=>U.value==="GB"?R.value.maxM/1024:R.value.maxM,set:z=>{R.value.maxM=U.value==="GB"?Math.round(z*1024):z}});be([h,x,N],([z,K,ae])=>{z==="env"?R.value.java="java":z==="custom"||z==="local"?R.value.java=ae:z==="online"&&(R.value.java=K?`MSLX://Java/${K}`:""),R.value.java&&l.value?.validate({fields:["java"]})},{immediate:!0});const J=te(()=>({name:[{required:!0,message:"实例名称不能为空",trigger:"blur"}],java:[{required:!0,message:"请配置 Java 环境",trigger:"change"}],core:[{required:!0,message:"核心名称/文件不能为空",trigger:"change"}],coreUrl:[{validator:z=>{if(I.value==="online"){if(!z)return{result:!1,message:"请选择一个服务端核心",type:"error"};if(z&&!/^https?:\/\/.+/.test(z))return{result:!1,message:"下载地址必须以 http(s) 开头",type:"error"}}return!0},trigger:"change"}],coreFileKey:[{validator:z=>I.value==="manual"&&!z?{result:!1,message:"请上传核心文件",type:"error"}:!0,trigger:"change"}],minM:[{required:!0,min:1,message:"最小内存必须大于0",trigger:"blur"}],maxM:[{required:!0,min:1,message:"最大内存必须大于0",trigger:"blur"}]})),H=[["name","path"],["java"],["core","coreUrl","coreSha256","coreFileKey"],["minM","maxM","args"]],he=()=>{o.value>0&&(o.value-=1)},Te=async()=>{if(o.value===2){if(I.value==="online"){if(!R.value.coreUrl||!R.value.core){P.warning("请点击按钮选择一个服务端核心");return}}else if(I.value==="custom"){if(!R.value.core){P.warning("请输入核心文件名");return}}else if(!R.value.coreFileKey){P.warning("请先上传核心文件");return}}const z=await l.value.validate();if(z===!0){o.value<3&&(o.value+=1);return}const K=new Set(H[o.value]);Object.keys(z).some(me=>K.has(me))?P.warning("请检查当前步骤的输入"):o.value<3&&(o.value+=1)},ge=z=>{R.value.core=z.filename,R.value.coreUrl=z.url,R.value.coreSha256=z.sha256,R.value.coreFileKey="",P.success(`已选择: ${z.core} (${z.version})`),l.value.validate({fields:["core","coreUrl"]})},Re=()=>{V.value?.click()},Ue=z=>{if(z===0)return"0 B";const K=1024,ae=["B","KB","MB","GB"],me=Math.floor(Math.log(z)/Math.log(K));return parseFloat((z/Math.pow(K,me)).toFixed(2))+" "+ae[me]},Ee=async z=>{const K=z.target;if(!K.files||K.files.length===0)return;if(R.value.coreFileKey)try{await ht(R.value.coreFileKey),console.log("旧临时文件已清理:",R.value.coreFileKey)}catch(ee){console.warn("清理旧文件失败，可能文件已过期",ee)}const ae=K.files[0],me=ae.name;R.value.core=me,R.value.coreUrl="",R.value.coreSha256="",R.value.coreFileKey="",p.value=me,A.value=Ue(ae.size),await je(ae),K.value=""};let Be=null;const je=async z=>{Be&&Be.abort(),Be=new AbortController,E.value=!0,B.value=0;const ae=z.size>200*1024*1024?50*1024*1024:5*1024*1024,me=Math.ceil(z.size/ae),ee=4,D=5,ie=new Map;let ce=0;const $e=()=>{const ve=Date.now();if(ve-ce<100)return;ce=ve;const fe=Array.from(ie.values()).reduce((xe,Ie)=>xe+Ie,0),Ce=Math.min(fe/z.size*98,98);B.value=Number(Ce.toFixed(1))};try{const fe=(await qt()).uploadId;if(!fe)throw new Error("无法获取上传凭证");const Ce=Array.from({length:me},(Y,Ve)=>Ve),xe=async Y=>{if(Be?.signal.aborted)throw new Error("已取消");const Ve=Y*ae,Ye=Math.min(z.size,Ve+ae),Ne=z.slice(Ve,Ye);let Pe;for(let de=1;de<=D;de++){if(Be?.signal.aborted)throw new Error("已取消");try{await Nt(fe,Y,Ne,We=>{We&&We.loaded&&(ie.set(Y,We.loaded),$e())},Be?.signal),ie.set(Y,Ne.size),$e();return}catch(We){Pe=We,ie.set(Y,0),$e(),de<D&&await new Promise(ut=>setTimeout(ut,1e3*de))}}throw new Error(`分片 ${Y} 失败: ${Pe?.message}`)},Ie=async()=>{for(;Ce.length>0&&!Be?.signal.aborted;){const Y=Ce.shift();Y!==void 0&&await xe(Y)}},Oe=Array(Math.min(ee,me)).fill(null).map(()=>Ie());if(await Promise.all(Oe),Be?.signal.aborted)throw new Error("已取消");const qe=(await Gt(fe,me)).uploadId;B.value=100,R.value.coreFileKey=qe,P.success("核心文件上传成功！"),l.value?.validate({fields:["core","coreFileKey"]})}catch(ve){if(ve.message==="已取消")return;console.error(ve),P.error(`上传失败: ${ve.message||"未知错误"}`),R.value.core="",p.value="",B.value=0,R.value.coreFileKey&&(ht(R.value.coreFileKey).catch(()=>{}),R.value.coreFileKey="")}finally{Be?.signal.aborted||(E.value=!1)}},re=async()=>{R.value.coreFileKey&&(await ht(R.value.coreFileKey),R.value.coreFileKey="",R.value.core="",p.value="",P.success("文件已移除"))},Se=async()=>{if(!(await l.value.validate()===!0)){P.warning("请检查表单所有内容");return}i.value=!0,m.value=[];const ae={...R.value,path:R.value.path||null,coreUrl:R.value.coreUrl||null,coreSha256:R.value.coreSha256||null,coreFileKey:R.value.coreFileKey||null,args:R.value.args||null};I.value==="manual"?(ae.coreUrl=null,ae.coreSha256=null):ae.coreFileKey=null;try{const ee=(await za(ae)).serverId;if(!ee)throw new Error("服务器未返回 ServerId");S.value=ee.toString(),f.value=!0,o.value=4,await De(S.value)}catch(me){const ee=me.message||"创建请求失败，请检查网络或后端服务";P.error(ee),i.value=!1}},De=async z=>{const{baseUrl:K,token:ae}=n;let me=!1;const ee=new URL("/api/hubs/creationProgressHub",K||window.location.origin);ee.searchParams.append("x-user-token",ae),b.value=new wt().withUrl(ee.toString(),{withCredentials:!1}).configureLogging(Mt.Information).build();const D=(ie,ce=null)=>{m.value.push({time:new Date().toLocaleTimeString(),message:ie,progress:ce}),vt(()=>{k.value&&(k.value.scrollTop=k.value.scrollHeight)})};b.value.on("StatusUpdate",(ie,ce,$e)=>{ie.toString()===z&&(D(ce,$e),$e!==null&&$e>=0&&(d.value=$e),$e===100?(me=!0,P.success("服务器创建成功！"),b.value?.stop(),f.value=!1,u.value=!0,o.value=5,i.value=!1,c.refreshInstanceList()):$e===-1&&(P.error(ce||"创建过程中发生未知错误"),b.value?.stop(),f.value=!1,i.value=!1,o.value=0))});try{await b.value.start(),D("已连接到实时进度服务..."),await b.value.invoke("TrackServer",z),D("已订阅任务，等待服务器响应...")}catch(ie){me||(D(`SignalR 连接失败: ${ie.message}`,-1),P.error("无法连接到实时进度服务"),f.value=!1,i.value=!1,o.value=0)}};Je(()=>{b.value?.stop(),Be&&Be.abort()});const se=()=>{u.value=!1,o.value=0,R.value={...R.value,name:"新建服务器",core:"",coreUrl:"",coreSha256:"",path:"",args:"",coreFileKey:""},p.value="",I.value="online",h.value="online",N.value=""};return(z,K)=>{const ae=v("t-step-item"),me=v("t-steps"),ee=v("t-input"),D=v("t-form-item"),ie=v("t-alert"),ce=v("t-radio-button"),$e=v("t-radio-group"),ve=v("t-select"),fe=v("t-button"),Ce=v("t-icon"),xe=v("t-progress"),Ie=v("t-input-number"),Oe=v("t-space"),Ke=v("t-col"),qe=v("t-row"),Y=v("t-textarea"),Ve=v("t-form"),Ye=v("t-list-item-meta"),Ne=v("t-list-item"),Pe=v("t-list");return r(),C("div",null,[t("div",ku,[t("div",$u,[e(me,{layout:"vertical",style:{"margin-top":"16px"},current:o.value,status:"process",readonly:""},{default:a(()=>[e(ae,{title:"基本信息",content:"填写实例名称和路径"}),e(ae,{title:"Java 环境",content:"配置 Java 运行时"}),e(ae,{title:"核心文件",content:"指定核心文件及下载"}),e(ae,{title:"资源配置",content:"设置内存与 JVM 参数"}),e(ae,{title:"创建实例",content:"提交并等待创建"}),e(ae,{title:"完成",content:"查看创建结果"})]),_:1},8,["current"])]),t("div",Au,[!f.value&&!u.value?(r(),C("div",xu,[e(Ve,{ref_key:"formRef",ref:l,data:R.value,rules:J.value,"label-align":"top",class:"step-form",onSubmit:Se},{default:a(()=>[Xe(t("div",Cu,[e(D,{label:"实例名称",name:"name"},{default:a(()=>[e(ee,{modelValue:R.value.name,"onUpdate:modelValue":K[0]||(K[0]=de=>R.value.name=de),placeholder:"为你的服务器起个名字"},null,8,["modelValue"])]),_:1}),e(D,{label:"实例路径",name:"path",help:"选填，留空将使用默认路径"},{default:a(()=>[e(ee,{modelValue:R.value.path,"onUpdate:modelValue":K[1]||(K[1]=de=>R.value.path=de),placeholder:"例如: D:\\MyServer"},null,8,["modelValue"])]),_:1})],512),[[et,o.value===0]]),Xe(t("div",Su,[e(ie,{theme:"info",title:"如何选择 Java 版本?",class:"java-alert"},{message:a(()=>[...K[20]||(K[20]=[t("p",null,"不同的 Minecraft 版本需要不同的 Java 版本。",-1),t("ul",null,[t("li",null,[_("建议直接使用 "),t("b",null,"推荐版本"),_(" 超出版本可能存在兼容性问题。")]),t("li",null,"MC 26.1 - 最新版: 需要 Java 25 或更高版本。"),t("li",null,"MC 1.20.5 - 1.21.10: 需要 Java 21 或更高版本。"),t("li",null,"MC 1.18 - 1.20.4: 需要 Java 17 或更高版本。"),t("li",null,"MC 1.17/1.17.1: 需要 Java 16。"),t("li",null,"MC 1.13 - 1.16.5: 需要 Java 8 / 11。"),t("li",null,"MC 1.12.2 及以下: 需要 Java 8。")],-1)])]),_:1}),e(D,{label:"Java 来源",name:"java"},{default:a(()=>[t("div",Iu,[e($e,{modelValue:h.value,"onUpdate:modelValue":K[2]||(K[2]=de=>h.value=de),variant:"default-filled"},{default:a(()=>[e(ce,{value:"online"},{default:a(()=>[...K[21]||(K[21]=[_("在线下载",-1)])]),_:1}),e(ce,{value:"local"},{default:a(()=>[...K[22]||(K[22]=[_("选择电脑上的 Java",-1)])]),_:1}),e(ce,{value:"env"},{default:a(()=>[...K[23]||(K[23]=[_("环境变量",-1)])]),_:1}),e(ce,{value:"custom"},{default:a(()=>[...K[24]||(K[24]=[_("自定义路径",-1)])]),_:1})]),_:1},8,["modelValue"]),t("div",Vu,[h.value==="online"?(r(),C("div",Mu,[e(ve,{modelValue:x.value,"onUpdate:modelValue":K[3]||(K[3]=de=>x.value=de),options:F.value,placeholder:"请选择 Java 版本"},null,8,["modelValue","options"]),t("div",Lu," 将下载并使用 Java "+M(x.value||"?")+" "+M(y(n).userInfo.systemInfo.osType.toLowerCase().replace("os",""))+" / "+M(y(n).userInfo.systemInfo.osArchitecture.toLowerCase()),1)])):O("",!0),h.value==="local"?(r(),C("div",Uu,[e(ve,{modelValue:N.value,"onUpdate:modelValue":K[4]||(K[4]=de=>N.value=de),options:T.value,placeholder:"请选择 Java 版本"},null,8,["modelValue","options"]),e(fe,{variant:"outline",theme:"primary",onClick:K[5]||(K[5]=de=>G(!0))},{default:a(()=>[...K[25]||(K[25]=[_("重新扫描",-1)])]),_:1})])):O("",!0),h.value==="env"?(r(),C("div",Bu,[e(ee,{"model-value":"java",readonly:"",disabled:""}),K[26]||(K[26]=t("div",{class:"tip"},"将使用系统环境变量中的 java 命令",-1))])):O("",!0),h.value==="custom"?(r(),C("div",Ru,[e(ee,{modelValue:N.value,"onUpdate:modelValue":K[6]||(K[6]=de=>N.value=de),placeholder:"例如: C:\\Program Files\\Java\\jdk-17\\bin\\java.exe"},null,8,["modelValue"])])):O("",!0)])])]),_:1})],512),[[et,o.value===1]]),Xe(t("div",Eu,[e(D,{label:"选择您的Minecraft开服使用的服务端核心"},{default:a(()=>[e($e,{modelValue:I.value,"onUpdate:modelValue":K[7]||(K[7]=de=>I.value=de),variant:"default-filled"},{default:a(()=>[e(ce,{value:"online"},{default:a(()=>[...K[27]||(K[27]=[_("在线下载 (推荐)",-1)])]),_:1}),e(ce,{value:"manual"},{default:a(()=>[...K[28]||(K[28]=[_("选择本地文件",-1)])]),_:1}),e(ce,{value:"custom"},{default:a(()=>[...K[29]||(K[29]=[_("自定义文件名",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),I.value==="online"?(r(),C("div",Pu,[e(D,{label:"选择服务端核心",name:"coreUrl"},{default:a(()=>[t("div",zu,[e(fe,{variant:"outline",onClick:K[8]||(K[8]=de=>g.value=!0)},{icon:a(()=>[e(Ce,{name:"cloud-download"})]),default:a(()=>[K[30]||(K[30]=_(" 点击打开服务端核心选择库 ",-1))]),_:1}),R.value.core?(r(),C("div",Fu,[t("div",Tu,[e(Ce,{name:"check-circle-filled"})]),t("div",Du,[t("div",Ou,M(R.value.core),1),K[31]||(K[31]=t("div",{class:"core-url",title:"MSLX 将在稍后帮您自动下载此文件..."}," MSLX 将在稍后帮您自动下载此文件... ",-1))]),e(fe,{shape:"circle",variant:"text",theme:"danger",onClick:K[9]||(K[9]=de=>{R.value.core="",R.value.coreUrl=""})},{default:a(()=>[e(Ce,{name:"close"})]),_:1})])):O("",!0)])]),_:1}),Xe(t("input",{"onUpdate:modelValue":K[10]||(K[10]=de=>R.value.coreSha256=de),type:"hidden"},null,512),[[bs,R.value.coreSha256]])])):O("",!0),I.value==="manual"?(r(),C("div",ju,[e(D,{label:"上传核心文件",name:"coreFileKey"},{default:a(()=>[t("div",Ku,[t("input",{ref_key:"uploadInputRef",ref:V,accept:".jar",type:"file",style:{display:"none"},onChange:Ee},null,544),!E.value&&!R.value.coreFileKey?(r(),j(fe,{key:0,variant:"outline",onClick:Re},{icon:a(()=>[e(Ce,{name:"upload"})]),default:a(()=>[K[32]||(K[32]=_(" 点击选择文件并上传 ",-1))]),_:1})):O("",!0),E.value?(r(),C("div",qu,[t("div",Nu,"正在上传: "+M(p.value)+" ("+M(A.value)+")",1),e(xe,{theme:"line",percentage:B.value},null,8,["percentage"]),K[33]||(K[33]=t("div",{class:"tip"},"别着急，喝杯茶🍵...",-1))])):O("",!0),R.value.coreFileKey&&!E.value?(r(),C("div",Gu,[t("div",Hu,[e(Ce,{name:"check-circle-filled"})]),t("div",Ju,[t("div",Wu,M(p.value),1),t("div",Xu,M(A.value)+" | 已上传准备就绪",1)]),e(fe,{shape:"circle",variant:"text",theme:"primary",onClick:Re},{icon:a(()=>[e(Ce,{name:"swap"})]),_:1}),e(fe,{shape:"circle",variant:"text",theme:"danger",onClick:re},{icon:a(()=>[e(Ce,{name:"delete"})]),_:1})])):O("",!0)])]),_:1})])):O("",!0),I.value==="custom"?(r(),C("div",Qu,[e(ie,{theme:"warning",message:"此模式通常用于服务器目录中已经存在核心文件，或者您打算稍后手动通过文件管理上传核心。",style:{"margin-bottom":"16px"}}),e(D,{label:"核心文件名",name:"core",help:"请确保文件名包含后缀，例如: server.jar"},{default:a(()=>[e(ee,{modelValue:R.value.core,"onUpdate:modelValue":K[11]||(K[11]=de=>R.value.core=de),placeholder:"请输入核心文件名 (例如 server.jar)"},null,8,["modelValue"])]),_:1})])):O("",!0)],512),[[et,o.value===2]]),Xe(t("div",Yu,[e(qe,{gutter:[16,24]},{default:a(()=>[e(Ke,{xs:12,span:6},{default:a(()=>[e(D,{label:"最小内存",name:"minM"},{default:a(()=>[e(Oe,{size:8,style:{width:"100%"}},{default:a(()=>[e(Ie,{modelValue:Z.value,"onUpdate:modelValue":K[12]||(K[12]=de=>Z.value=de),min:0,"decimal-places":L.value==="GB"?1:0,placeholder:"Xms",theme:"column",style:{width:"100%"}},null,8,["modelValue","decimal-places"]),e(ve,{modelValue:L.value,"onUpdate:modelValue":K[13]||(K[13]=de=>L.value=de),options:$,clearable:!1,style:{width:"80px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Ke,{xs:12,span:6},{default:a(()=>[e(D,{label:"最大内存",name:"maxM"},{default:a(()=>[e(Oe,{size:8,style:{width:"100%"}},{default:a(()=>[e(Ie,{modelValue:W.value,"onUpdate:modelValue":K[14]||(K[14]=de=>W.value=de),min:0,"decimal-places":U.value==="GB"?1:0,placeholder:"Xmx",theme:"column",style:{width:"100%"}},null,8,["modelValue","decimal-places"]),e(ve,{modelValue:U.value,"onUpdate:modelValue":K[15]||(K[15]=de=>U.value=de),options:$,clearable:!1,style:{width:"80px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(D,{label:"额外 JVM 参数 (可选)",name:"args",help:"例如: -XX:+UseG1GC",style:{"margin-top":"16px"}},{default:a(()=>[e(Y,{modelValue:R.value.args,"onUpdate:modelValue":K[16]||(K[16]=de=>R.value.args=de),placeholder:"-XX:+UseG1GC"},null,8,["modelValue"])]),_:1})],512),[[et,o.value===3]]),e(D,{class:"step-actions"},{default:a(()=>[o.value>0?(r(),j(fe,{key:0,theme:"default",onClick:he},{default:a(()=>[...K[34]||(K[34]=[_("上一步",-1)])]),_:1})):O("",!0),o.value<3?(r(),j(fe,{key:1,type:"button",onClick:Te},{default:a(()=>[...K[35]||(K[35]=[_("下一步",-1)])]),_:1})):O("",!0),o.value===3?(r(),j(fe,{key:2,theme:"primary",type:"submit",loading:i.value},{default:a(()=>[...K[36]||(K[36]=[_(" 提交创建 ",-1)])]),_:1},8,["loading"])):O("",!0)]),_:1})]),_:1},8,["data","rules"])])):O("",!0),f.value?(r(),C("div",Zu,[t("div",ed,"正在创建实例 ("+M(S.value)+")",1),K[37]||(K[37]=t("p",null,"请勿关闭此页面，创建过程可能需要几分钟...",-1)),e(xe,{theme:"plump",percentage:d.value,label:`${d.value.toFixed(2)}%`},null,8,["percentage","label"]),t("div",{ref_key:"logContainerRef",ref:k,class:"log-container"},[e(Pe,{split:!0},{default:a(()=>[(r(!0),C(pe,null,ye(m.value,(de,We)=>(r(),j(Ne,{key:We},{default:a(()=>[e(Ye,null,{description:a(()=>[t("span",td,"["+M(de.time)+"]",1),t("span",ad,M(de.message),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})],512)])):O("",!0),u.value?(r(),C("div",sd,[e(Ce,{class:"result-success-icon",name:"check-circle"}),t("div",nd,"服务器 ("+M(S.value)+") 已创建成功",1),K[40]||(K[40]=t("div",{class:"result-success-describe"},"你现在可以去服务器列表启动它了",-1)),t("div",null,[e(fe,{onClick:K[17]||(K[17]=()=>{se(),y(Ae)("/instance/list")})},{default:a(()=>[...K[38]||(K[38]=[_(" 返回服务端列表 ",-1)])]),_:1}),e(fe,{theme:"default",onClick:K[18]||(K[18]=()=>{se(),y(Ae)(`/instance/console/${S.value}`)})},{default:a(()=>[...K[39]||(K[39]=[_(" 前往控制台 ",-1)])]),_:1})])])):O("",!0)])]),e(Fa,{visible:g.value,"onUpdate:visible":K[19]||(K[19]=de=>g.value=de),onConfirm:ge},null,8,["visible"])])}}}),od=oe(ld,[["__scopeId","data-v-d0718991"]]),rd={key:0},id={key:1,class:"result-success"},ud={class:"result-success-title"},dd=ne({__name:"CustomMode",setup(s){const n=w(!1),l=w(0),c=w(null),o=He({name:"",path:null,java:"none",core:"none",coreUrl:"",coreSha256:"",coreFileKey:"",packageFileKey:"",minM:1027,maxM:1027,args:"",ignoreEula:!0}),i={name:[{required:!0,message:"请输入服务器名称",type:"error"}],args:[{required:!0,message:"请输入自定义启动参数",type:"error"}]},f=async({validateResult:d})=>{if(d===!0)try{const m=await za(o);l.value=m.serverId,P.success("创建成功"),n.value=!0}catch(m){P.error("创建失败！"+m.message)}else P.warning("请检查表单填写")},u=()=>{n.value=!1,Object.assign(o,{name:"新建服务器",path:null,java:"none",core:"none",packageFileKey:"",coreFileKey:"",coreUrl:"",coreSha256:"",minM:1027,maxM:1027,args:"",ignoreEula:!0})};return(d,m)=>{const b=v("t-input"),S=v("t-form-item"),k=v("t-textarea"),I=v("t-switch"),g=v("t-button"),V=v("t-space"),E=v("t-form"),B=v("t-icon");return r(),C("div",null,[n.value?(r(),C("div",id,[e(B,{class:"result-success-icon",name:"check-circle"}),t("div",ud,"服务器 ("+M(l.value)+") 已创建成功",1),m[9]||(m[9]=t("div",{class:"result-success-describe"},"你现在可以去服务器列表启动它了",-1)),t("div",null,[e(g,{onClick:m[4]||(m[4]=()=>{u(),y(Ae)("/instance/list")})},{default:a(()=>[...m[7]||(m[7]=[_(" 返回服务端列表 ",-1)])]),_:1}),e(g,{theme:"default",onClick:m[5]||(m[5]=()=>{u(),y(Ae)(`/instance/console/${l.value}`)})},{default:a(()=>[...m[8]||(m[8]=[_(" 前往控制台 ",-1)])]),_:1})])])):(r(),C("div",rd,[e(E,{ref_key:"formRef",ref:c,rules:i,data:o,"label-align":"top",onSubmit:f},{default:a(()=>[e(S,{label:"服务器名称",name:"name"},{default:a(()=>[e(b,{modelValue:o.name,"onUpdate:modelValue":m[0]||(m[0]=p=>o.name=p),placeholder:"给你的服务器起一个名字"},null,8,["modelValue"])]),_:1}),e(S,{label:"存储路径(可选)",name:"path",help:"不填写将使用默认的保存路径。"},{default:a(()=>[e(b,{modelValue:o.path,"onUpdate:modelValue":m[1]||(m[1]=p=>o.path=p),placeholder:"请填写服务端保存位置"},null,8,["modelValue"])]),_:1}),e(S,{label:"启动指令",name:"args",help:"此模式不会自动帮您配置Java环境，您需要填写完整的启动命令。"},{default:a(()=>[e(k,{modelValue:o.args,"onUpdate:modelValue":m[2]||(m[2]=p=>o.args=p),placeholder:"start.bat...",autosize:{minRows:5,maxRows:25},class:"code-font-textarea"},null,8,["modelValue"])]),_:1}),e(S,{label:"忽略EULA提示",name:"args",help:"若您的实例并非MC服务器，可打开此选项"},{default:a(()=>[e(I,{modelValue:o.ignoreEula,"onUpdate:modelValue":m[3]||(m[3]=p=>o.ignoreEula=p),label:["已开启","已关闭"]},null,8,["modelValue"])]),_:1}),e(S,{style:{"margin-top":"20px"}},{default:a(()=>[e(V,null,{default:a(()=>[e(g,{theme:"primary",type:"submit"},{default:a(()=>[...m[6]||(m[6]=[_("提交创建",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]))])}}}),cd=oe(dd,[["__scopeId","data-v-74d65900"]]),md={class:"main-layout-container"},pd={class:"steps-aside"},vd={class:"main-content"},fd={key:0,class:"form-step-container"},gd={class:"step-content"},_d={class:"step-content"},hd={class:"select-core-wrapper"},yd={key:1,class:"uploading-state"},bd={class:"core-filename"},wd={key:2,class:"uploading-state"},kd={key:3,class:"selected-core-card"},$d={class:"core-icon"},Ad={class:"core-info"},xd={class:"core-filename"},Cd={class:"core-url"},Sd={class:"step-content"},Id={key:0},Vd={key:1},Md={key:0,class:"online-select-area"},Ld={class:"select-core-wrapper"},Ud={key:0,class:"selected-core-card"},Bd={class:"core-icon"},Rd={class:"core-info"},Ed={class:"core-filename"},Pd={key:1,class:"online-select-area"},zd={class:"step-content"},Fd={style:{width:"100%"}},Td={class:"java-option-panel"},Dd={key:0,class:"flex-row"},Od={key:1,class:"flex-row"},jd={key:2},Kd={key:3},qd={class:"step-content"},Nd={key:1,class:"step-content creation-progress"},Gd={class:"progress-title"},Hd={key:2,class:"result-success"},Jd=ne({__name:"PackageMode",setup(s){const n=Fe(),l=w(null),c=Ht(),o=w(0),i=w(!1),f=w(!1),u=w(!1),d=w(0),m=w([]),b=w(null),S=w(null),k=w(null),I=w("online"),g=w(!1),V=w([]),E=w(!1),B=w(""),p=w(null),A=w(!1),h=w(0),F=w(""),T=w(""),x=w("online"),N=w([]),G=w([]),R=w(""),$=w(""),L=async(ee=!1)=>{try{ee&&P.info("正在刷新Java版本列表...");const D=await Ta(n.userInfo.systemInfo.osType.toLowerCase().replace("os",""),n.userInfo.systemInfo.osArchitecture.toLowerCase());D&&Array.isArray(D)&&(N.value=D.map(ie=>({label:`Java ${ie}`,value:ie})),N.value.length>0&&!R.value&&(R.value=N.value[1].value)),G.value=(await Da(ee)).map(ie=>({label:`Java ${ie.version}${ie.is64Bit?"":" (32位)"} (${ie.vendor} | ${ie.path})`,value:ie.path})),G.value.length>0&&($.value=G.value[0].value),ee&&P.success("已刷新Java版本列表")}catch(D){P.warning("获取在线Java版本失败: "+D.message)}};ke(()=>{L()});const U=w({name:"新建整合包服务器",path:"",java:"",core:"",coreUrl:"",coreSha256:"",coreFileKey:"",packageFileKey:"",minM:2048,maxM:6144,args:""}),Z=w("GB"),W=w("GB"),J=[{label:"MB",value:"MB"},{label:"GB",value:"GB"}],H=te({get:()=>Z.value==="GB"?U.value.minM/1024:U.value.minM,set:ee=>{U.value.minM=Z.value==="GB"?Math.round(ee*1024):ee}}),he=te({get:()=>W.value==="GB"?U.value.maxM/1024:U.value.maxM,set:ee=>{U.value.maxM=W.value==="GB"?Math.round(ee*1024):ee}});be([x,R,$],([ee,D,ie])=>{ee==="env"?U.value.java="java":ee==="custom"||ee==="local"?U.value.java=ie:ee==="online"&&(U.value.java=D?`MSLX://Java/${D}`:""),U.value.java&&l.value?.validate({fields:["java"]})},{immediate:!0});const Te=te(()=>({name:[{required:!0,message:"实例名称不能为空",trigger:"blur"}],packageFileKey:[{required:!0,message:"请上传整合包文件",trigger:"change"}],core:[{validator:ee=>{if(V.value.length>0){if(!ee)return{result:!1,message:"请选择一个启动Jar",type:"error"}}else{if(I.value==="online"&&!U.value.coreUrl)return{result:!1,message:"请选择服务端核心",type:"error"};if(I.value==="manual"&&!U.value.coreFileKey)return{result:!1,message:"请上传核心文件",type:"error"}}return!0},trigger:"change"}],java:[{required:!0,message:"请配置 Java 环境",trigger:"change"}],minM:[{required:!0,min:1,message:"必须大于0",trigger:"blur"}],maxM:[{required:!0,min:1,message:"必须大于0",trigger:"blur"}]})),ge=[["name","path"],["packageFileKey"],["core","coreUrl","coreFileKey"],["java"],["minM","maxM","args"]],Re=()=>{o.value>0&&(o.value-=1)},Ue=async()=>{if(o.value===1){if(!U.value.packageFileKey){P.warning("请先上传服务端整合包(Zip)");return}if(A.value||E.value){P.warning("请等待上传或分析完成");return}}if(o.value===2)if(V.value.length>0){if(!U.value.core){P.warning("请从列表中选择一个启动核心");return}}else{if(I.value==="online"&&(!U.value.coreUrl||!U.value.core)){P.warning("请选择一个服务端核心");return}if(I.value==="manual"&&!U.value.coreFileKey){P.warning("请上传核心文件");return}}const ee=await l.value.validate();if(ee===!0){o.value<4&&(o.value+=1);return}const D=new Set(ge[o.value]);Object.keys(ee).some(ce=>D.has(ce))?P.warning("请检查当前步骤的输入"):o.value<4&&(o.value+=1)},Ee=()=>{p.value?.click()},Be=ee=>{if(ee===0)return"0 B";const D=1024,ie=["B","KB","MB","GB"],ce=Math.floor(Math.log(ee)/Math.log(D));return parseFloat((ee/Math.pow(D,ce)).toFixed(2))+" "+ie[ce]},je=async ee=>{const D=ee.target;if(!D.files||D.files.length===0)return;if(U.value.packageFileKey)try{await ht(U.value.packageFileKey)}catch(ce){console.error(ce)}U.value.core="",V.value=[],B.value="";const ie=D.files[0];F.value=ie.name,T.value=Be(ie.size),await Se(ie),D.value=""};let re=null;const Se=async ee=>{re&&re.abort(),re=new AbortController,A.value=!0,h.value=0;const ie=ee.size>200*1024*1024?50*1024*1024:10*1024*1024,ce=Math.ceil(ee.size/ie),$e=4,ve=5,fe=new Map;let Ce=0;const xe=()=>{const Ie=Date.now();if(Ie-Ce<100)return;Ce=Ie;const Oe=Array.from(fe.values()).reduce((qe,Y)=>qe+Y,0),Ke=Math.min(Oe/ee.size*98,98);h.value=Number(Ke.toFixed(1))};try{const Oe=(await qt()).uploadId;if(!Oe)throw new Error("无法获取上传凭证");const Ke=Array.from({length:ce},(Pe,de)=>de),qe=async Pe=>{if(re?.signal.aborted)throw new Error("已取消");const de=Pe*ie,We=Math.min(ee.size,de+ie),ut=ee.slice(de,We);let kt;for(let dt=1;dt<=ve;dt++){if(re?.signal.aborted)throw new Error("已取消");try{await Nt(Oe,Pe,ut,X=>{X&&X.loaded&&(fe.set(Pe,X.loaded),xe())},re?.signal),fe.set(Pe,ut.size),xe();return}catch(X){kt=X,fe.set(Pe,0),xe(),dt<ve&&await new Promise(q=>setTimeout(q,1e3*dt))}}throw new Error(`分片 ${Pe} 失败: ${kt?.message}`)},Y=async()=>{for(;Ke.length>0&&!re?.signal.aborted;){const Pe=Ke.shift();Pe!==void 0&&await qe(Pe)}},Ve=Array(Math.min($e,ce)).fill(null).map(()=>Y());if(await Promise.all(Ve),re?.signal.aborted)throw new Error("已取消");h.value=99;const Ne=(await Gt(Oe,ce)).uploadId;h.value=100,U.value.packageFileKey=Ne,P.success("上传成功，正在分析整合包内容..."),await De(Ne)}catch(Ie){if(Ie.message==="已取消")return;re?.abort(),console.error(Ie),P.error(`上传失败: ${Ie.message||"未知错误"}`),F.value="",h.value=0,U.value.packageFileKey&&(ht(U.value.packageFileKey).catch(()=>{}),U.value.packageFileKey="")}finally{re?.signal.aborted||(A.value=!1)}},De=async ee=>{E.value=!0;try{const D=await ho(ee);V.value=D.jars||[],B.value=D.detectedRoot||"",D.count===1&&D.jars.length>0?(U.value.core=D.jars[0],P.success(`自动识别到服务端核心: ${D.jars[0]}`)):D.count>1?P.info(`整合包内检测到 ${D.count} 个服务端核心，请在下一步选择`):P.warning("未检测到整合包内存在服务端核心，请在下一步手动配置核心")}catch(D){P.error("整合包分析失败: "+D.message)}finally{E.value=!1}},se=async()=>{U.value.packageFileKey&&(await ht(U.value.packageFileKey),U.value.packageFileKey="",F.value="",V.value=[],U.value.core="",P.success("文件已移除"))},z=ee=>{U.value.core=ee.filename,U.value.coreUrl=ee.url,U.value.coreSha256=ee.sha256,U.value.coreFileKey="",P.success(`已选择: ${ee.core} (${ee.version})`)},K=async()=>{if(await l.value.validate()!==!0){P.warning("请检查表单所有内容");return}i.value=!0,m.value=[];const D={...U.value,path:U.value.path||null,coreUrl:U.value.coreUrl||null,coreSha256:U.value.coreSha256||null,coreFileKey:U.value.coreFileKey||null,args:U.value.args||null};V.value.length>0?(D.coreUrl=null,D.coreSha256=null,D.coreFileKey=null):I.value==="manual"?(D.coreUrl=null,D.coreSha256=null):D.coreFileKey=null;try{const ce=(await za(D)).serverId;if(!ce)throw new Error("服务器未返回 ServerId");S.value=ce.toString(),f.value=!0,o.value=5,await ae(S.value)}catch(ie){P.error(ie.message||"创建请求失败"),i.value=!1}},ae=async ee=>{const{baseUrl:D,token:ie}=n,ce=new URL("/api/hubs/creationProgressHub",D||window.location.origin);ce.searchParams.append("x-user-token",ie),b.value=new wt().withUrl(ce.toString(),{withCredentials:!1}).configureLogging(Mt.Information).build(),b.value.on("StatusUpdate",($e,ve,fe)=>{$e.toString()===ee&&(m.value.push({time:new Date().toLocaleTimeString(),message:ve,progress:fe}),vt(()=>{k.value&&(k.value.scrollTop=k.value.scrollHeight)}),fe!==null&&fe>=0&&(d.value=fe),fe===100?(P.success("服务器创建成功！"),b.value?.stop(),f.value=!1,u.value=!0,o.value=6,i.value=!1,c.refreshInstanceList()):fe===-1&&(P.error(ve||"错误"),b.value?.stop(),f.value=!1,i.value=!1,o.value=0))});try{await b.value.start(),await b.value.invoke("TrackServer",ee)}catch($e){console.error("SignalR Error",$e)}};Je(()=>{b.value?.stop()});const me=()=>{u.value=!1,o.value=0,U.value={name:"新建整合包服务器",path:"",java:"",core:"",coreUrl:"",coreSha256:"",coreFileKey:"",packageFileKey:"",minM:2048,maxM:6144,args:""},V.value=[],F.value="",I.value="online",x.value="online"};return(ee,D)=>{const ie=v("t-step-item"),ce=v("t-steps"),$e=v("t-input"),ve=v("t-form-item"),fe=v("t-alert"),Ce=v("t-icon"),xe=v("t-button"),Ie=v("t-progress"),Oe=v("t-loading"),Ke=v("t-radio"),qe=v("t-radio-group"),Y=v("t-radio-button"),Ve=v("t-select"),Ye=v("t-input-number"),Ne=v("t-space"),Pe=v("t-col"),de=v("t-row"),We=v("t-textarea"),ut=v("t-form"),kt=v("t-list-item-meta"),dt=v("t-list-item"),X=v("t-list");return r(),C("div",null,[t("div",md,[t("div",pd,[e(ce,{layout:"vertical",style:{"margin-top":"16px"},current:o.value,status:"process",readonly:""},{default:a(()=>[e(ie,{title:"基本信息",content:"填写实例名称"}),e(ie,{title:"上传整合包",content:"上传服务端 Zip 包"}),e(ie,{title:"核心配置",content:"确认启动的服务端核心"}),e(ie,{title:"Java 环境",content:"配置 Java 运行时"}),e(ie,{title:"资源配置",content:"设置内存参数"}),e(ie,{title:"创建实例",content:"提交并等待解压"}),e(ie,{title:"完成",content:"查看结果"})]),_:1},8,["current"])]),t("div",vd,[!f.value&&!u.value?(r(),C("div",fd,[e(ut,{ref_key:"formRef",ref:l,data:U.value,rules:Te.value,"label-align":"top",class:"step-form",onSubmit:K},{default:a(()=>[Xe(t("div",gd,[e(ve,{label:"实例名称",name:"name"},{default:a(()=>[e($e,{modelValue:U.value.name,"onUpdate:modelValue":D[0]||(D[0]=q=>U.value.name=q),placeholder:"为你的服务器起个名字"},null,8,["modelValue"])]),_:1}),e(ve,{label:"实例路径",name:"path",help:"选填，留空将使用默认路径"},{default:a(()=>[e($e,{modelValue:U.value.path,"onUpdate:modelValue":D[1]||(D[1]=q=>U.value.path=q),placeholder:"例如: D:\\MyServer"},null,8,["modelValue"])]),_:1})],512),[[et,o.value===0]]),Xe(t("div",_d,[e(fe,{theme:"info",class:"mb-4"},{message:a(()=>[...D[18]||(D[18]=[_(" 请上传包含服务端文件的 ",-1),t("b",null,".zip",-1),_(" 压缩包。上传完成后系统将自动分析包内的服务端核心文件。 ",-1)])]),_:1}),e(ve,{label:"上传服务端整合包 (Zip)",name:"packageFileKey"},{default:a(()=>[t("div",hd,[t("input",{ref_key:"uploadInputRef",ref:p,accept:".zip",type:"file",style:{display:"none"},onChange:je},null,544),!A.value&&!U.value.packageFileKey?(r(),j(xe,{key:0,variant:"outline",onClick:Ee},{icon:a(()=>[e(Ce,{name:"upload"})]),default:a(()=>[D[19]||(D[19]=_(" 点击选择 Zip 文件并上传 ",-1))]),_:1})):O("",!0),A.value?(r(),C("div",yd,[t("div",bd,"正在上传: "+M(F.value)+" ("+M(T.value)+")",1),e(Ie,{theme:"line",percentage:h.value},null,8,["percentage"]),D[20]||(D[20]=t("div",{class:"tip"},"别着急，喝杯咖啡☕️...",-1))])):O("",!0),!A.value&&E.value?(r(),C("div",wd,[e(Oe,{text:"正在分析压缩包结构...",size:"small"})])):O("",!0),U.value.packageFileKey&&!A.value&&!E.value?(r(),C("div",kd,[t("div",$d,[e(Ce,{name:"folder-zip"})]),t("div",Ad,[t("div",xd,M(F.value),1),t("div",Cd,M(V.value.length>0?`发现 ${V.value.length} 个服务端核心文件`:"未发现服务端核心文件")+" "+M(B.value?`| 根目录: /${B.value}`:""),1)]),e(xe,{shape:"circle",variant:"text",theme:"primary",onClick:Ee},{icon:a(()=>[e(Ce,{name:"swap"})]),_:1}),e(xe,{shape:"circle",variant:"text",theme:"danger",onClick:se},{icon:a(()=>[e(Ce,{name:"delete"})]),_:1})])):O("",!0)])]),_:1})],512),[[et,o.value===1]]),Xe(t("div",Sd,[V.value.length>0?(r(),C("div",Id,[e(fe,{theme:"success",class:"mb-4"},{message:a(()=>[...D[21]||(D[21]=[_("我们在压缩包中发现了以下服务端核心文件，请选择哪一个作为",-1),t("b",null,"启动核心",-1),_("。",-1)])]),_:1}),e(ve,{label:"选择启动核心",name:"core"},{default:a(()=>[e(qe,{modelValue:U.value.core,"onUpdate:modelValue":D[2]||(D[2]=q=>U.value.core=q),class:"vertical-radio-group"},{default:a(()=>[(r(!0),C(pe,null,ye(V.value,q=>(r(),C("div",{key:q,class:"jar-option-item"},[e(Ke,{value:q},{default:a(()=>[_(M(q),1)]),_:2},1032,["value"])]))),128))]),_:1},8,["modelValue"])]),_:1})])):(r(),C("div",Vd,[e(fe,{theme:"warning",class:"mb-4"},{message:a(()=>[...D[22]||(D[22]=[_("在上传的包中未发现服务端核心文件。请在此处下载一个服务端核心。",-1)])]),_:1}),e(ve,{label:"补充服务端核心"},{default:a(()=>[e(qe,{modelValue:I.value,"onUpdate:modelValue":D[3]||(D[3]=q=>I.value=q),variant:"default-filled"},{default:a(()=>[e(Y,{value:"online"},{default:a(()=>[...D[23]||(D[23]=[_("在线下载核心",-1)])]),_:1}),e(Y,{disabled:"",value:"manual"},{default:a(()=>[...D[24]||(D[24]=[_("自行上传(不支持)",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),I.value==="online"?(r(),C("div",Md,[e(ve,{label:"选择服务端核心",name:"coreUrl"},{default:a(()=>[t("div",Ld,[e(xe,{variant:"outline",onClick:D[4]||(D[4]=q=>g.value=!0)},{icon:a(()=>[e(Ce,{name:"cloud-download"})]),default:a(()=>[D[25]||(D[25]=_(" 打开核心库 ",-1))]),_:1}),U.value.core&&I.value==="online"?(r(),C("div",Ud,[t("div",Bd,[e(Ce,{name:"check-circle-filled"})]),t("div",Rd,[t("div",Ed,M(U.value.core),1),D[26]||(D[26]=t("div",{class:"core-url"},"将在创建时自动下载",-1))])])):O("",!0)])]),_:1})])):O("",!0),I.value==="manual"?(r(),C("div",Pd,[D[27]||(D[27]=t("div",{class:"tip-text"},"请在整合包解压后手动放入核心，或在此处不填写等待创建后手动上传。",-1)),e(fe,{theme:"error",message:"此模式下建议确保压缩包内包含核心，或者使用在线下载功能。"})])):O("",!0)]))],512),[[et,o.value===2]]),Xe(t("div",zd,[e(fe,{theme:"info",title:"如何选择 Java 版本?",class:"java-alert"},{message:a(()=>[...D[28]||(D[28]=[t("p",null,"不同的 Minecraft 版本需要不同的 Java 版本。",-1),t("ul",null,[t("li",null,[_("建议直接使用 "),t("b",null,"推荐版本"),_(" 超出版本可能存在兼容性问题。")]),t("li",null,"MC 26.1 - 最新版: 需要 Java 25 或更高版本。"),t("li",null,"MC 1.20.5 - 1.21.10: 需要 Java 21 或更高版本。"),t("li",null,"MC 1.18 - 1.20.4: 需要 Java 17 或更高版本。"),t("li",null,"MC 1.17/1.17.1: 需要 Java 16。"),t("li",null,"MC 1.13 - 1.16.5: 需要 Java 8 / 11。"),t("li",null,"MC 1.12.2 及以下: 需要 Java 8。")],-1)])]),_:1}),e(ve,{label:"Java 来源",name:"java"},{default:a(()=>[t("div",Fd,[e(qe,{modelValue:x.value,"onUpdate:modelValue":D[5]||(D[5]=q=>x.value=q),variant:"default-filled"},{default:a(()=>[e(Y,{value:"online"},{default:a(()=>[...D[29]||(D[29]=[_("在线下载",-1)])]),_:1}),e(Y,{value:"local"},{default:a(()=>[...D[30]||(D[30]=[_("本机 Java",-1)])]),_:1}),e(Y,{value:"env"},{default:a(()=>[...D[31]||(D[31]=[_("环境变量",-1)])]),_:1}),e(Y,{value:"custom"},{default:a(()=>[...D[32]||(D[32]=[_("自定义路径",-1)])]),_:1})]),_:1},8,["modelValue"]),t("div",Td,[x.value==="online"?(r(),C("div",Dd,[e(Ve,{modelValue:R.value,"onUpdate:modelValue":D[6]||(D[6]=q=>R.value=q),options:N.value,placeholder:"请选择 Java 版本"},null,8,["modelValue","options"])])):O("",!0),x.value==="local"?(r(),C("div",Od,[e(Ve,{modelValue:$.value,"onUpdate:modelValue":D[7]||(D[7]=q=>$.value=q),options:G.value,placeholder:"请选择 Java"},null,8,["modelValue","options"]),e(xe,{variant:"text",onClick:D[8]||(D[8]=q=>L(!0))},{default:a(()=>[...D[33]||(D[33]=[_("刷新",-1)])]),_:1})])):O("",!0),x.value==="env"?(r(),C("div",jd,[e($e,{"model-value":"java",readonly:"",disabled:""})])):O("",!0),x.value==="custom"?(r(),C("div",Kd,[e($e,{modelValue:$.value,"onUpdate:modelValue":D[9]||(D[9]=q=>$.value=q),placeholder:"C:\\Path\\To\\java.exe"},null,8,["modelValue"])])):O("",!0)])])]),_:1})],512),[[et,o.value===3]]),Xe(t("div",qd,[e(de,{gutter:[16,24]},{default:a(()=>[e(Pe,{xs:12,span:6},{default:a(()=>[e(ve,{label:"最小内存",name:"minM"},{default:a(()=>[e(Ne,{size:8,style:{width:"100%"}},{default:a(()=>[e(Ye,{modelValue:H.value,"onUpdate:modelValue":D[10]||(D[10]=q=>H.value=q),min:0,"decimal-places":Z.value==="GB"?1:0,placeholder:"Xms",theme:"column",style:{width:"100%"}},null,8,["modelValue","decimal-places"]),e(Ve,{modelValue:Z.value,"onUpdate:modelValue":D[11]||(D[11]=q=>Z.value=q),options:J,clearable:!1,style:{width:"80px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Pe,{xs:12,span:6},{default:a(()=>[e(ve,{label:"最大内存",name:"maxM"},{default:a(()=>[e(Ne,{size:8,style:{width:"100%"}},{default:a(()=>[e(Ye,{modelValue:he.value,"onUpdate:modelValue":D[12]||(D[12]=q=>he.value=q),min:0,"decimal-places":W.value==="GB"?1:0,placeholder:"Xmx",theme:"column",style:{width:"100%"}},null,8,["modelValue","decimal-places"]),e(Ve,{modelValue:W.value,"onUpdate:modelValue":D[13]||(D[13]=q=>W.value=q),options:J,clearable:!1,style:{width:"80px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(ve,{label:"JVM 参数",name:"args",style:{"margin-top":"16px"}},{default:a(()=>[e(We,{modelValue:U.value.args,"onUpdate:modelValue":D[14]||(D[14]=q=>U.value.args=q),placeholder:"-XX:+UseG1GC"},null,8,["modelValue"])]),_:1})],512),[[et,o.value===4]]),e(ve,{class:"step-actions",style:{"margin-top":"16px"}},{default:a(()=>[o.value>0?(r(),j(xe,{key:0,theme:"default",onClick:Re},{default:a(()=>[...D[34]||(D[34]=[_("上一步",-1)])]),_:1})):O("",!0),o.value<4?(r(),j(xe,{key:1,type:"button",loading:A.value||E.value,onClick:Ue},{default:a(()=>[...D[35]||(D[35]=[_("下一步",-1)])]),_:1},8,["loading"])):O("",!0),o.value===4?(r(),j(xe,{key:2,theme:"primary",type:"submit",loading:i.value},{default:a(()=>[...D[36]||(D[36]=[_("提交创建",-1)])]),_:1},8,["loading"])):O("",!0)]),_:1})]),_:1},8,["data","rules"])])):O("",!0),f.value?(r(),C("div",Nd,[t("div",Gd,"正在创建整合包实例 ("+M(S.value)+")",1),D[37]||(D[37]=t("p",null,"正在解压文件并配置环境...",-1)),e(Ie,{theme:"plump",percentage:d.value,label:`${d.value.toFixed(2)}%`},null,8,["percentage","label"]),t("div",{ref_key:"logContainerRef",ref:k,class:"log-container"},[e(X,{split:!0},{default:a(()=>[(r(!0),C(pe,null,ye(m.value,(q,_e)=>(r(),j(dt,{key:_e},{default:a(()=>[e(kt,{description:`[${q.time}] ${q.message}`},null,8,["description"])]),_:2},1024))),128))]),_:1})],512)])):O("",!0),u.value?(r(),C("div",Hd,[e(Ce,{class:"result-success-icon",name:"check-circle"}),D[40]||(D[40]=t("div",{class:"result-success-title"},"整合包服务器已部署成功",-1)),D[41]||(D[41]=t("div",{class:"result-success-describe"},"文件已解压，环境已配置就绪",-1)),t("div",null,[e(xe,{onClick:D[15]||(D[15]=()=>{me(),y(Ae)("/instance/list")})},{default:a(()=>[...D[38]||(D[38]=[_(" 返回服务端列表 ",-1)])]),_:1}),e(xe,{theme:"default",onClick:D[16]||(D[16]=()=>{me(),y(Ae)(`/instance/console/${S.value}`)})},{default:a(()=>[...D[39]||(D[39]=[_(" 前往控制台 ",-1)])]),_:1})])])):O("",!0)])]),e(Fa,{visible:g.value,"onUpdate:visible":D[17]||(D[17]=q=>g.value=q),onConfirm:z},null,8,["visible"])])}}}),Wd=oe(Jd,[["__scopeId","data-v-7bca9b51"]]),Xd=ne({__name:"index",setup(s){const n=w(1);return(l,c)=>{const o=v("t-tab-panel"),i=v("t-tabs"),f=v("t-card");return r(),C("div",null,[e(f,{direction:"vertical"},{default:a(()=>[e(i,{modelValue:n.value,"onUpdate:modelValue":c[0]||(c[0]=u=>n.value=u)},{default:a(()=>[e(o,{value:1,label:"快速模式","destroy-on-hide":!1},{default:a(()=>[e(od,{style:{margin:"10px"}})]),_:1}),e(o,{value:2,label:"上传整合包模式","destroy-on-hide":!1},{default:a(()=>[e(Wd,{style:{margin:"10px"}})]),_:1}),e(o,{value:3,label:"自定义模式","destroy-on-hide":!1},{default:a(()=>[e(cd,{style:{margin:"10px"}})]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}}),Qd=Object.freeze(Object.defineProperty({__proto__:null,default:Xd},Symbol.toStringTag,{value:"Module"})),Yd={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function Zd(s,n){return r(),C("svg",Yd,[...n[0]||(n[0]=[Ut('<g mask="url(#mask0_17_619)"><path fill="#97A3B7" d="M30 62h88v60H30z"></path><g filter="url(#filter0_f_17_619)"><path fill="#E3E6EB" d="M12 84h80v60H12z"></path></g><g filter="url(#filter1_f_17_619)"><path fill="#E3E6EB" d="M80 54h80v60H80z"></path></g><path fill="#fff" d="M46 105h32v2H46zM46 98h32v2H46zM46 88h16v2H46z"></path></g><path fill="currentcolor" d="M63 20h88v10H63z" opacity=".9"></path><mask id="a" width="88" height="50" x="63" y="30" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="currentcolor" d="M63 30h88v50H63z"></path></mask><g mask="url(#a)"><path fill="currentcolor" d="M63 30h88v50H63z"></path><g filter="url(#filter2_f_17_619)" opacity=".3"><path fill="#97A3B7" d="M30 62h88v60H30z"></path></g></g><path fill="#fff" fill-rule="evenodd" d="m95.686 40.858 10.278 10.277A4 4 0 0 1 107 51c2.213 0 4 1.786 4 4q-.002.538-.134 1.033l10.276 10.28-2.828 2.829-4.598-4.597A17.1 17.1 0 0 1 107 65.909c-7.273 0-13.484-4.524-16-10.91a17.3 17.3 0 0 1 5.696-7.472l-3.838-3.84zM99 55a8.003 8.003 0 0 0 12.063 6.892l-3.029-3.026q-.496.132-1.034.134c-2.213 0-4-1.787-4-4q.002-.538.134-1.034l-3.027-3.027A7.96 7.96 0 0 0 99 54.999m8-10.91c7.273 0 13.484 4.524 16 10.91a17.3 17.3 0 0 1-4.166 6.177l-4.105-4.105a8.003 8.003 0 0 0-9.801-9.8l-2.55-2.551c1.47-.41 3.02-.63 4.622-.63" clip-rule="evenodd"></path><path fill="#fff" d="M68 24h2v2h-2zM74 24h2v2h-2zM80 24h66v2H80z"></path><path fill="#fff" stroke="#000" d="m157 54 24.249 42h-48.498z"></path><path stroke="#000" d="M157 89V71"></path>',8)])])}const os={render:Zd},ec={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function tc(s,n){return r(),C("svg",ec,[...n[0]||(n[0]=[Ut('<g mask="url(#mask0_16559_24301)"><path fill="#97A3B7" d="M30 62h88v60H30z"></path><g filter="url(#filter0_f_16559_24301)"><path fill="#E3E6EB" d="M12 84h80v60H12z"></path></g><g filter="url(#filter1_f_16559_24301)"><path fill="#E3E6EB" d="M80 54h80v60H80z"></path></g><path stroke="#fff" stroke-width="2" d="m49 93-7 7 7 7M69 107l7-7-7-7M62.365 87.443l-6.73 25.114"></path></g><path fill="currentcolor" d="M63 20h88v10H63z" opacity=".9"></path><mask id="a" width="88" height="50" x="63" y="30" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="currentcolor" d="M63 30h88v50H63z"></path></mask><g mask="url(#a)"><path fill="currentcolor" d="M63 30h88v50H63z"></path><g filter="url(#filter2_f_16559_24301)" opacity=".3"><path fill="#97A3B7" d="M30 62h88v60H30z"></path></g></g><path fill="#fff" fill-rule="evenodd" d="M105.25 41c6.765 0 12.25 5.484 12.25 12.25 0 2.433-.709 4.7-1.932 6.606L121 65.288 117.288 69l-5.432-5.432a12.2 12.2 0 0 1-6.606 1.932C98.484 65.5 93 60.016 93 53.25S98.484 41 105.25 41m0 3.5a8.75 8.75 0 1 0 0 17.5 8.75 8.75 0 0 0 0-17.5" clip-rule="evenodd"></path><path fill="#fff" d="M68 24h2v2h-2zM74 24h2v2h-2zM80 24h66v2H80z"></path><path fill="#fff" fill-rule="evenodd" d="M153 56c-12.15 0-22 9.85-22 22 0 4.604 1.414 8.878 3.832 12.41L127 98.5l12.495-3.132A21.9 21.9 0 0 0 153 100c12.15 0 22-9.85 22-22s-9.85-22-22-22" clip-rule="evenodd"></path><path fill="#000" d="M131 78h.5zm3.832 12.41.359.348.284-.293-.23-.337zM127 98.5l-.359-.348-1.219 1.259 1.7-.426zm12.495-3.132.307-.394-.192-.15-.237.06zM153 100v.5zm22-22h-.5zm-43.5 0c0-11.874 9.626-21.5 21.5-21.5v-1c-12.426 0-22.5 10.074-22.5 22.5zm3.745 12.128A21.4 21.4 0 0 1 131.5 78h-1c0 4.708 1.446 9.08 3.919 12.693zm-.772-.066-7.832 8.09.718.696 7.832-8.09zm-7.351 8.923 12.494-3.132-.243-.97-12.495 3.132zM153 99.5c-4.976 0-9.555-1.69-13.198-4.526l-.615.789A22.4 22.4 0 0 0 153 100.5zM174.5 78c0 11.874-9.626 21.5-21.5 21.5v1c12.426 0 22.5-10.074 22.5-22.5zM153 56.5c11.874 0 21.5 9.626 21.5 21.5h1c0-12.426-10.074-22.5-22.5-22.5z"></path>',8)])])}const ac={render:tc},sc={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function nc(s,n){return r(),C("svg",sc,[...n[0]||(n[0]=[Ut('<g mask="url(#mask0_16559_24251)"><path fill="#97A3B7" d="m68 48 38.105 22v44L68 136l-38.105-22V70z"></path><g filter="url(#a)"><path fill="#E3E6EB" d="M46.391 92h80v60h-80z"></path></g><g filter="url(#b)"><path fill="#E3E6EB" d="M0 23h80v60H0z"></path></g></g><mask id="c" width="78" height="88" x="80" y="9" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="currentcolor" d="m119 9 38.105 22v44L119 97 80.895 75V31z"></path></mask><g mask="url(#c)"><path fill="currentcolor" fill-rule="evenodd" d="M80.895 31v44L119 97l38.105-22V31L119 53z" clip-rule="evenodd"></path><path fill="currentcolor" d="m119-35 38.105 22v44.5L119 53.5l-38.105-22V-13z" opacity=".9"></path><g filter="url(#d)" opacity=".3"><path fill="#97A3B7" d="m68 48 38.105 22v44L68 136l-38.105-22V70z"></path></g></g><path fill="#fff" stroke="#000" d="m143 68.822 4.867 17.053.133.466.469-.118 17.202-4.312-12.335 12.741-.337.348.337.348 12.335 12.741-17.202-4.312-.469-.118-.133.466L143 121.178l-4.867-17.053-.133-.466-.469.118-17.202 4.312 12.335-12.741.337-.348-.337-.348-12.335-12.741 17.202 4.312.469.118.133-.466z"></path><path fill="#fff" fill-rule="evenodd" d="m123.243 35.082 2.828-1.633-2.828-1.633-2.829 1.633zM119 32.632 121.828 31l-7.071-4.082-2.828 1.633zm8.485 3.267c-4.679 2.701-12.291 2.701-16.97 0-4.68-2.702-4.68-7.096 0-9.798s12.291-2.701 16.97 0c4.68 2.702 4.68 7.096 0 9.798m-19.799-11.43c-6.248 3.607-6.248 9.455 0 13.062s16.38 3.607 22.628 0 6.248-9.455 0-13.062-16.38-3.607-22.628 0M41.899 86.286l2.828 1.633v6.532L41.9 92.818zm12.02 6.94 2.829 1.634v6.532l-2.828-1.633zm-9.19 14.289-2.83-1.633.001 3.266 2.828 1.633zl9.192 5.307v3.266l2.828 1.633v-3.266l-2.828-1.633v-3.266l-9.192-5.307z" clip-rule="evenodd"></path><defs><filter id="a" width="180" height="160" x="-3.609" y="42" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_16559_24251" stdDeviation="25"></feGaussianBlur></filter><filter id="b" width="180" height="160" x="-50" y="-27" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_16559_24251" stdDeviation="25"></feGaussianBlur></filter><filter id="d" width="88.21" height="100" x="23.895" y="42" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_16559_24251" stdDeviation="3"></feGaussianBlur></filter></defs>',6)])])}const lc={render:nc},oc={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function rc(s,n){return r(),C("svg",oc,[...n[0]||(n[0]=[Ut('<g mask="url(#mask0_22_990)"><path fill="#97A3B7" fill-rule="evenodd" d="m144.569 105.61-48 27.712-48-27.712V83.712L96.57 56l48 27.713z" clip-rule="evenodd"></path><g filter="url(#filter0_f_22_990)"><path fill="#E3E6EB" d="M-3 33.999h80v60H-3z"></path></g><g filter="url(#filter1_f_22_990)"><path fill="#E3E6EB" d="M97 97.999h80v60H97z"></path></g></g><mask id="a" width="86" height="69" x="53" y="16" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="currentcolor" fill-rule="evenodd" d="m113.357 42.715 16.472-9.51a36 36 0 0 0-3.186-2.043c-5.375-3.104-11.92-5.147-18.885-6.139-4.209-5.562-10.18-8.898-17.324-8.828-6.755.087-15.486 5.746-21.507 14.365q-1.247.622-2.432 1.306c-14.378 8.3-16.94 20.75-7.473 30.065-1.035-5.805-.31-10.865 3.101-16.215-.058.632-.21 4.427-.232 5.067-.67 18.914 15.02 34.058 26.139 33.928 8.45-.1 15.565-5.013 20.319-12.631 6.214-1.231 12.089-3.294 17.094-6.183 13.476-7.78 16.567-19.182 9.104-28.268l-16.599 9.582c1.762 3.654.049 7.823-5.078 10.783-5.126 2.96-12.347 3.948-18.677 2.931-2.843-.469-5.522-1.342-7.74-2.622l-.049-.028zM78.655 53.773c-6.127-3.977-5.683-10.226 1.195-14.197s17.703-4.226 24.591-.69zM93.556 18.17c4.61-.04 8.728 2.405 11.94 6.57-8.447-.918-17.384-.326-25.523 1.765 3.699-5.124 8.471-8.275 13.583-8.335m-2.232 63.447c-5.853.068-10.971-3.926-14.377-10.332 8.845 2.342 18.925 2.775 28.427 1.317-3.756 5.52-8.714 8.951-14.05 9.015" clip-rule="evenodd"></path></mask><g mask="url(#a)"><path fill="currentcolor" fill-rule="evenodd" d="m113.357 42.715 16.472-9.51a36 36 0 0 0-3.186-2.043c-5.375-3.104-11.92-5.147-18.885-6.139-4.209-5.562-10.18-8.898-17.324-8.828-6.755.087-15.486 5.746-21.507 14.365q-1.247.622-2.432 1.306c-14.378 8.3-16.94 20.75-7.473 30.065-1.035-5.805-.31-10.865 3.101-16.215-.058.632-.21 4.427-.232 5.067-.67 18.914 15.02 34.058 26.139 33.928 8.45-.1 15.565-5.013 20.319-12.631 6.214-1.231 12.089-3.294 17.094-6.183 13.476-7.78 16.567-19.182 9.104-28.268l-16.599 9.582c1.762 3.654.049 7.823-5.078 10.783-5.126 2.96-12.347 3.948-18.677 2.931-2.843-.469-5.522-1.342-7.74-2.622l-.049-.028zM78.655 53.773c-6.127-3.977-5.683-10.226 1.195-14.197s17.703-4.226 24.591-.69zM93.556 18.17c4.61-.04 8.728 2.405 11.94 6.57-8.447-.918-17.384-.326-25.523 1.765 3.699-5.124 8.471-8.275 13.583-8.335m-2.232 63.447c-5.853.068-10.971-3.926-14.377-10.332 8.845 2.342 18.925 2.775 28.427 1.317-3.756 5.52-8.714 8.951-14.05 9.015" clip-rule="evenodd"></path><g filter="url(#filter2_f_22_990)" opacity=".3"><path fill="#97A3B7" d="m96.569 56 48 27.712v55.426l-48 27.712-48-27.712V83.712z"></path></g></g><circle cx="155" cy="78" r="22" fill="#fff" stroke="#000" transform="rotate(180 155 78)"></circle><path stroke="#000" d="M155 83V65"></path><path fill="#C4C4C4" stroke="#000" stroke-linejoin="round" stroke-width="2" d="M155 87h.004v.004H155z"></path><path stroke="#fff" stroke-width="2" d="M96.57 112V88M86.57 98l10-10 9.999 10"></path>',7)])])}const ic={render:rc},uc={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function dc(s,n){return r(),C("svg",uc,[...n[0]||(n[0]=[Ut('<g mask="url(#mask0_21_716)"><path fill="#97A3B7" fill-rule="evenodd" d="M33 46.843 96.321 119l63.322-72.157C142.742 32 120.583 23 96.321 23 72.061 23 49.901 32 33 46.843" clip-rule="evenodd"></path><g filter="url(#filter0_f_21_716)"><path fill="#E3E6EB" d="M95 21h80v60H95z"></path></g><g filter="url(#filter1_f_21_716)"><path fill="#E3E6EB" d="M-7 43h80v60H-7z"></path></g></g><path fill="currentcolor" d="m72.812 63.688-3.157 3.157 6.246 6.247a50.3 50.3 0 0 0-12.713 8.151L96.321 119l11.913-13.575 6.413 6.412 3.157-3.157L80.45 71.326zM129.455 81.243l-15.318 17.455-28.74-28.74a50.4 50.4 0 0 1 10.924-1.19c12.695 0 24.29 4.709 33.134 12.475"></path><path fill="#fff" stroke="#000" d="m152 21.822 4.867 17.053.133.465.469-.117 17.202-4.312-12.335 12.741-.337.348.337.348 12.335 12.741-17.202-4.312-.469-.117-.133.465L152 74.178l-4.867-17.053-.133-.465-.469.117-17.202 4.312 12.335-12.741.337-.348-.337-.348-12.335-12.741 17.202 4.312.469.117.133-.465z"></path><path stroke="#fff" stroke-width="2" d="M101 31 90 42l11 11-8 8"></path>',4)])])}const cc={render:dc},mc={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function pc(s,n){return r(),C("svg",mc,[...n[0]||(n[0]=[Ut('<mask id="a" width="78" height="88" x="80" y="9" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="currentColor" d="m119 9 38.105 22v44L119 97 80.895 75V31z"></path></mask><g mask="url(#a)"><path fill="currentColor" d="m119 9 38.105 22v44L119 97 80.895 75V31z"></path><g filter="url(#b)" opacity=".3"><path fill="#97A3B7" d="m68 48 38.105 22v44L68 136l-38.105-22V70z"></path></g></g><mask id="c" width="78" height="88" x="29" y="48" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="#97A3B7" d="m68 48 38.105 22v44L68 136l-38.105-22V70z"></path></mask><g mask="url(#c)"><path fill="#97A3B7" d="m68 48 38.105 22v44L68 136l-38.105-22V70z"></path><g filter="url(#d)"><path fill="#E3E6EB" d="M46.391 92h80v60h-80z"></path></g><g filter="url(#e)"><path fill="#E3E6EB" d="M0 23h80v60H0z"></path></g></g><path fill="#fff" d="m41.898 86.287 2.829 1.633v6.531l-2.828-1.632zM53.919 93.227l2.828 1.633v6.532l-2.828-1.633zM44.728 107.515l-2.829-1.633v3.266l2.829 1.633zl9.191 5.308v3.265l2.829 1.633v-3.266l-2.828-1.632v-3.266l-9.193-5.308z"></path><path fill="#fff" fill-rule="evenodd" d="M108.348 23.48c-2.16 2.51-1.813 5.903 1.047 8.08 3.265 2.486 8.568 2.447 11.845-.087 3.276-2.534 3.286-6.603.021-9.089-2.86-2.177-7.284-2.417-10.54-.74l5.202 3.96-2.373 1.836z" clip-rule="evenodd"></path><path fill="#fff" fill-rule="evenodd" d="m120.865 33.009 8.965 6.826 2.373-1.836-8.965-6.826q-.481.523-1.089.993-.608.468-1.284.843m-1.203-.916a8.5 8.5 0 0 0 1.305-.828 7.248 7.248 0 0 1 0 0 8.5 8.5 0 0 1-1.305.828" clip-rule="evenodd"></path><path fill="#fff" stroke="#181818" d="m144 70 24.249 42h-48.498z"></path><path stroke="#181818" d="M144 100V82"></path><path stroke="#181818" stroke-linejoin="round" stroke-width="2" d="M144 105h.004v.004H144z"></path><defs><filter id="b" width="88.21" height="100" x="23.895" y="42" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_216_313" stdDeviation="3"></feGaussianBlur></filter><filter id="d" width="180" height="160" x="-3.609" y="42" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_216_313" stdDeviation="25"></feGaussianBlur></filter><filter id="e" width="180" height="160" x="-50" y="-27" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_216_313" stdDeviation="25"></feGaussianBlur></filter></defs>',11)])])}const vc={render:pc},fc={class:"result-container"},gc={class:"result-bg-img"},_c={class:"result-title"},hc={class:"result-tip"},yc=ne({__name:"index",props:{bgUrl:String,title:String,tip:String,type:String},setup(s){const n=s,l=te(()=>{switch(n.type){case"403":return os;case"404":return ac;case"500":return lc;case"ie":return ic;case"wifi":return cc;case"maintenance":return vc;default:return os}});return(c,o)=>(r(),C("div",fc,[t("div",gc,[(r(),j(st(l.value)))]),t("div",_c,M(s.title),1),t("div",hc,M(s.tip),1),sn(c.$slots,"default",{},void 0)]))}}),rs=oe(yc,[["__scopeId","data-v-a2dee5ff"]]);async function bc(s,n,l,c="toml"){return await Q.post({url:"/api/frp/add",data:{name:s,config:n,provider:l,format:c}})}async function wc(s){return await Q.post({url:"/api/frp/delete",data:{id:s}})}function kc(){return Q.get({url:"/api/frp/list"})}function is(s,n){return Q.post({url:"/api/frp/action",data:{action:s,id:n}})}function $c(s){return Q.get({url:"/api/frp/info",params:{id:s}})}function Ac(){return Q.get({url:"/api/frp/autostart"})}function xc(s){return Q.post({url:"/api/frp/autostart",data:{frpIds:s}})}const Oa=gt("tunnels",()=>{const s=w([]);async function n(){try{s.value=await kc()}catch(l){P.error("获取Frp列表失败:"+l.message)}}return{frpList:s,getTunnels:n}}),Cc={class:"dashboard-wrapper"},Sc={class:"content-container"},Ic={class:"page-header"},Vc=["onClick"],Mc={class:"card-inner"},Lc={class:"header-row"},Uc={class:"icon-box"},Bc={class:"title-section"},Rc={class:"card-title"},Ec={class:"card-subtitle"},Pc={class:"tags-row"},zc={class:"hover-action"},Fc={class:"auto-start-content"},Tc={class:"tunnel-label"},Dc={class:"tag"},Oc={class:"name"},jc={class:"id"},Kc={key:0,class:"empty-tip"},qc=ne({__name:"index",setup(s){const n=Oa(),l=w(!0),c=w(!1),o=He({visible:!1,loading:!1,submitting:!1,selectedIds:[]}),i=async()=>{o.visible=!0,o.loading=!0;try{n.frpList.length===0&&await n.getTunnels();const S=await Ac();o.selectedIds=S||[]}catch(S){P.error("获取自启动配置失败 "+S.message)}finally{o.loading=!1}},f=async()=>{o.submitting=!0;try{await xc(o.selectedIds),P.success("自启动设置已更新"),o.visible=!1}catch(S){P.error("保存失败: "+S.message)}finally{o.submitting=!1}},u=S=>({toml:"primary",ini:"warning",cmd:"danger",json:"success"})[S]||"default";async function d(){try{l.value=!0,c.value=!1,await n.getTunnels()}catch(S){console.error(S),c.value=!0}finally{l.value=!1}}const m=S=>{Ae(`/frp/console/${S.id}`)},b=S=>{const k=tt.confirm({header:"确认删除隧道?",body:"删除后该隧道将无法恢复。确定要继续吗？",theme:"danger",onConfirm:async()=>{try{await wc(S),P.success(`隧道 ${S} 删除成功`),await d(),k.hide()}catch(I){P.error(I.message)}},onClose:()=>{k.hide()}})};return ke(()=>{d()}),(S,k)=>{const I=v("t-button"),g=v("t-space"),V=v("t-loading"),E=v("t-tag"),B=v("t-col"),p=v("t-row"),A=v("t-alert"),h=v("t-checkbox"),F=v("t-checkbox-group"),T=v("t-dialog");return r(),C("div",Cc,[t("div",Sc,[t("div",Ic,[k[7]||(k[7]=t("h2",{class:"title"},"隧道列表",-1)),e(g,null,{default:a(()=>[e(I,{theme:"primary",variant:"dashed",onClick:d},{default:a(()=>[...k[4]||(k[4]=[_(" 刷新列表 ",-1)])]),_:1}),e(I,{theme:"default",variant:"outline",onClick:i},{default:a(()=>[...k[5]||(k[5]=[_(" 设置自启动 ",-1)])]),_:1}),e(I,{theme:"primary",onClick:k[0]||(k[0]=x=>y(Ae)("/frp/create"))},{default:a(()=>[...k[6]||(k[6]=[_(" 创建隧道 ",-1)])]),_:1})]),_:1})]),l.value?(r(),j(V,{key:0,size:"medium",text:"加载中...",class:"loading-box"})):c.value?(r(),j(rs,{key:1,title:"获取数据失败",tip:"无法连接到服务器，请检查网络或稍后重试",type:"500"},{default:a(()=>[e(I,{onClick:d},{default:a(()=>[...k[8]||(k[8]=[_("重试",-1)])]),_:1})]),_:1})):y(n).frpList.length===0?(r(),j(rs,{key:2,title:"暂无隧道",tip:"您还没有创建任何 Frp 隧道，快去创建一个吧",type:"404"},{default:a(()=>[e(I,{onClick:k[1]||(k[1]=x=>y(Ae)("/frp/create"))},{default:a(()=>[...k[9]||(k[9]=[_("创建隧道",-1)])]),_:1})]),_:1})):(r(),j(p,{key:3,gutter:[20,20]},{default:a(()=>[(r(!0),C(pe,null,ye(y(n).frpList,x=>(r(),j(B,{key:x.id,span:24,xs:12,sm:6,md:6,lg:4,xl:4},{default:a(()=>[t("div",{class:"design-card",onClick:N=>m(x)},[t("div",{class:"status-bar",style:Vt({background:x.status?"var(--td-success-color)":"var(--td-component-stroke)"})},null,4),t("div",Mc,[t("div",Lc,[t("div",Uc,[e(y(Ct))]),e(E,{variant:"light",theme:x.status?"success":"warning"},{default:a(()=>[_(M(x.status?"运行中":"未运行"),1)]),_:2},1032,["theme"])]),t("div",Bc,[t("h3",Rc,M(x.name),1),t("div",Ec,"ID: "+M(x.id),1)]),t("div",Pc,[e(E,{size:"small",variant:"light",shape:"round"},{icon:a(()=>[e(y(Ft))]),default:a(()=>[_(" "+M(x.service),1)]),_:2},1024),e(E,{size:"small",theme:u(x.configType),variant:"outline",shape:"round"},{default:a(()=>[_(M(x.configType),1)]),_:2},1032,["theme"]),e(I,{shape:"circle",theme:"danger",size:"small",onClick:[N=>b(x.id),Pt(()=>{},["stop"])]},{icon:a(()=>[e(y(Lt))]),_:1},8,["onClick"])]),t("div",zc,[e(y(nn))])])],8,Vc)]),_:2},1024))),128))]),_:1}))]),e(T,{visible:o.visible,"onUpdate:visible":k[3]||(k[3]=x=>o.visible=x),header:"设置开机自启动隧道",width:"600px","confirm-btn":{content:"保存设置",loading:o.submitting},onConfirm:f},{default:a(()=>[e(V,{loading:o.loading,text:"正在读取配置...",size:"small"},{default:a(()=>[t("div",Fc,[e(A,{theme:"info",message:"勾选的隧道将在守护进程启动时自动运行",style:{"margin-bottom":"16px"}}),e(F,{modelValue:o.selectedIds,"onUpdate:modelValue":k[2]||(k[2]=x=>o.selectedIds=x),class:"tunnel-checkbox-group"},{default:a(()=>[e(p,{gutter:[16,16]},{default:a(()=>[(r(!0),C(pe,null,ye(y(n).frpList,x=>(r(),j(B,{key:x.id,span:12},{default:a(()=>[e(h,{value:x.id,class:"tunnel-item"},{default:a(()=>[t("div",Tc,[t("span",Dc,[e(E,{theme:"primary"},{default:a(()=>[_(M(x.service),1)]),_:2},1024)]),t("span",Oc,M(x.name),1),t("span",jc,"#"+M(x.id),1)])]),_:2},1032,["value"])]),_:2},1024))),128))]),_:1})]),_:1},8,["modelValue"]),y(n).frpList.length===0?(r(),C("div",Kc,"暂无可用隧道")):O("",!0)])]),_:1},8,["loading"])]),_:1},8,["visible","confirm-btn"])])}}}),Nc=oe(qc,[["__scopeId","data-v-b798d09c"]]),Gc=Object.freeze(Object.defineProperty({__proto__:null,default:Nc},Symbol.toStringTag,{value:"Module"})),Hc=Oa();async function ja(s,n,l,c="toml"){await bc(s,n,l,c),P.success("添加成功"),await Hc.getTunnels(),Ae("/frp/list")}const Jc={class:"custom-frp-container"},Wc=ne({__name:"Custom",setup(s){const n=w(null),l=He({name:"",type:"toml",content:""}),c={name:[{required:!0,message:"请输入隧道名称",type:"error"}],content:[{required:!0,message:"配置文件内容不能为空",type:"error"}]},o=async({validateResult:u})=>{u===!0?await ja(l.name,l.content,"Custom",l.type):P.warning("请检查表单填写")},i=()=>{P.info("表单已重置")},f=()=>{const u=l.content.trim();if(!u){P.warning("请先输入 INI 配置内容");return}const d={tls_enable:"transport.tls.enable",token:"auth.token",protocol:"transport.protocol",pool_count:"transport.poolCount",tcp_mux:"transport.tcpMux",login_fail_exit:"loginFailExit",custom_domains:"customDomains",locations:"locations",host_header_rewrite:"hostHeaderRewrite",role:"role",sk:"sk"};try{const m=u.split(/\r?\n/);let b="";const S={},k=[];let I=null;m.forEach(V=>{const E=V.trim();if(!E||E.startsWith("#")||E.startsWith(";"))return;const B=E.match(/^\[(.+)\]$/);if(B){b=B[1],b==="common"?I=null:(I={name:b},k.push(I));return}const p=E.match(/^([^=]+)=(.*)$/);if(p){const A=p[1].trim();let h=p[2].trim(),F=A;d[A]?F=d[A]:(F=F.replace(/_([a-z])/g,(T,x)=>x.toUpperCase()),F=F.replace(/Ip/g,"IP")),h==="true"?h=!0:h==="false"?h=!1:!isNaN(Number(h))&&h!==""?h=Number(h):h=String(h),b==="common"||!b?S[F]=h:I&&(I[F]=h)}});let g="";Object.entries(S).forEach(([V,E])=>{const B=typeof E=="string"?`"${E}"`:E;g+=`${V} = ${B}
`}),k.forEach(V=>{g+=`
[[proxies]]
`,Object.entries(V).forEach(([E,B])=>{const p=typeof B=="string"?`"${B}"`:B;g+=`${E} = ${p}
`})}),l.content=g.trim(),l.type="toml",P.success("已转换为 TOML")}catch(m){console.error(m),P.error("转换失败，请检查输入格式")}};return(u,d)=>{const m=v("t-input"),b=v("t-form-item"),S=v("t-radio-button"),k=v("t-radio-group"),I=v("t-button"),g=v("t-textarea"),V=v("t-space"),E=v("t-form"),B=v("t-card");return r(),C("div",Jc,[e(B,{bordered:!1},{header:a(()=>[...d[3]||(d[3]=[t("span",{style:{"font-weight":"bold","font-size":"16px"}},"自定义 Frp 隧道",-1)])]),default:a(()=>[e(E,{ref_key:"formRef",ref:n,data:l,rules:c,"label-align":"top",onReset:i,onSubmit:o},{default:a(()=>[e(b,{label:"隧道名称",name:"name"},{default:a(()=>[e(m,{modelValue:l.name,"onUpdate:modelValue":d[0]||(d[0]=p=>l.name=p),placeholder:"请输入隧道名称"},null,8,["modelValue"])]),_:1}),e(b,{label:"配置类型",name:"type"},{default:a(()=>[e(k,{modelValue:l.type,"onUpdate:modelValue":d[1]||(d[1]=p=>l.type=p),variant:"default-filled"},{default:a(()=>[e(S,{value:"toml"},{default:a(()=>[...d[4]||(d[4]=[_("TOML",-1)])]),_:1}),e(S,{value:"ini"},{default:a(()=>[...d[5]||(d[5]=[_("INI",-1)])]),_:1})]),_:1},8,["modelValue"]),l.type==="ini"?(r(),j(I,{key:0,style:{"margin-left":"8px"},variant:"outline",theme:"primary",size:"small",onClick:f},{default:a(()=>[...d[6]||(d[6]=[_(" 一键转 TOML ",-1)])]),_:1})):O("",!0)]),_:1}),e(b,{label:"隧道配置内容",name:"content"},{default:a(()=>[e(g,{modelValue:l.content,"onUpdate:modelValue":d[2]||(d[2]=p=>l.content=p),placeholder:`serverAddr = "0.0.0.0"
serverPort = 1027

[[proxies]]
name = "nahida_tcp"
...`,autosize:{minRows:10,maxRows:25},class:"code-font-textarea"},null,8,["modelValue"])]),_:1}),e(b,null,{default:a(()=>[e(V,null,{default:a(()=>[e(I,{theme:"primary",type:"submit"},{default:a(()=>[...d[7]||(d[7]=[_("保存配置",-1)])]),_:1}),e(I,{theme:"default",variant:"base",type:"reset"},{default:a(()=>[...d[8]||(d[8]=[_("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})])}}}),Xc=oe(Wc,[["__scopeId","data-v-4ef2421f"]]);function Ka(s){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let l="";for(let c=0;c<s;c++)l+=n.charAt(Math.floor(Math.random()*n.length));return l}function Ds(s){return new Date(s*1e3).toLocaleString()}const Qc=(s,n="MSL Login",l=500,c=600)=>{if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return window.open(s,"_blank"),null;const i=window.screenLeft!==void 0?window.screenLeft:window.screenX,f=window.screenTop!==void 0?window.screenTop:window.screenY,u=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,d=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,m=u/window.screen.availWidth,b=(u-l)/2/m+i,S=(d-c)/2/m+f,k=`
    scrollbars=yes,
    width=${l/m},
    height=${c/m},
    top=${S},
    left=${b}
  `,I=window.open(s,n,k);return I&&I.focus(),I},Yc={class:"custom-option-item"},Zc={class:"node-name-text"},em={class:"node-tag-group"},tm={class:"node-detail-area"},am={class:"detail-tags-row"},sm={class:"remarks-box"},nm=ne({__name:"CreateTunnelDialog",props:{visible:{type:Boolean},token:{}},emits:["update:visible","success"],setup(s,{emit:n}){const l=s,c=n,o=w(!1),i=w(!1),f=w([]),u=He({nodeId:null,type:"tcp",localIP:"127.0.0.1",localPort:"25565",remotePort:"",name:"",remarks:"无",bindDomain:"",use_kcp:!1,extra_config:""}),d=te(()=>f.value.find(I=>I.id===u.nodeId)||null),m=te(()=>{const I=[{label:"免费节点",value:0,children:[]},{label:"高级节点",value:1,children:[]},{label:"超级节点",value:2,children:[]}];return f.value.forEach(g=>{const V=I.find(E=>E.value===g.allow_user_group);V&&V.children.push(g)}),I.filter(g=>g.children.length>0)}),b=()=>{if(d.value){const{min_open_port:I,max_open_port:g}=d.value;u.remotePort=(Math.floor(Math.random()*(g-I+1))+I).toString()}u.name=Ka(8)},S=async()=>{o.value=!0;try{const I=await Q.get({url:"/api/frp/nodeList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${l.token}`}});I.code===200&&(f.value=I.data,l.visible&&f.value.length>0&&!u.nodeId&&(u.nodeId=f.value[0].id,b()))}catch(I){P.error("加载节点失败"+I.message)}finally{o.value=!1}};be(()=>l.visible,I=>{I&&(f.value.length>0?(u.nodeId||(u.nodeId=f.value[0].id),b()):S())});const k=async()=>{if(u.nodeId){i.value=!0;try{const I=await Q.post({url:"/api/frp/addTunnel",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${l.token}`},data:{id:u.nodeId,type:u.type,local_ip:u.localIP,local_port:u.localPort,remote_port:u.remotePort,name:u.name,remarks:u.remarks,bind_domain:u.bindDomain,use_kcp:d.value?.kcp_support===1?u.use_kcp:!1,extra_config:u.extra_config||null}});I.code===200?(P.success("创建成功"),c("success"),c("update:visible",!1)):P.error(I.msg)}finally{i.value=!1}}};return ke(()=>{l.token&&S()}),(I,g)=>{const V=v("t-tag"),E=v("t-option"),B=v("t-option-group"),p=v("t-select"),A=v("t-col"),h=v("t-button"),F=v("t-row"),T=v("t-form-item"),x=v("t-input"),N=v("t-textarea"),G=v("t-form"),R=v("t-loading"),$=v("t-dialog");return r(),j($,{attach:"body",visible:s.visible,header:"新建隧道",width:"580px","confirm-btn":{content:"提交创建",loading:i.value},onConfirm:k,onClose:g[10]||(g[10]=L=>c("update:visible",!1))},{default:a(()=>[e(R,{loading:o.value},{default:a(()=>[e(G,{data:u,"label-align":"right","label-width":100,class:"dialog-inner-form"},{default:a(()=>[e(T,{label:"选择节点",name:"nodeId"},{default:a(()=>[e(F,{gutter:8,style:{width:"100%"}},{default:a(()=>[e(A,{flex:"auto"},{default:a(()=>[e(p,{modelValue:u.nodeId,"onUpdate:modelValue":g[0]||(g[0]=L=>u.nodeId=L),placeholder:"请选择节点",onChange:b},{default:a(()=>[(r(!0),C(pe,null,ye(m.value,L=>(r(),j(B,{key:L.value,label:L.label},{default:a(()=>[(r(!0),C(pe,null,ye(L.children,U=>(r(),j(E,{key:U.id,value:U.id,label:U.node},{default:a(()=>[t("div",Yc,[t("span",Zc,M(U.node),1),t("div",em,[e(V,{size:"small",variant:"outline",theme:"primary"},{default:a(()=>[_(M(U.bandwidth)+"M",1)]),_:2},1024),e(V,{size:"small",theme:U.status===1?"success":"danger"},{default:a(()=>[_(M(U.status===1?"在线":"离线"),1)]),_:2},1032,["theme"])])])]),_:2},1032,["value","label"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(A,{flex:"none"},{default:a(()=>[e(h,{variant:"outline",onClick:g[1]||(g[1]=L=>y(Ae)("https://user.mslmc.net/frp/createTunnel"))},{default:a(()=>[...g[11]||(g[11]=[_(" 前往源站创建 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),d.value?(r(),j(T,{key:0,label:"节点详情"},{default:a(()=>[t("div",tm,[t("div",am,[e(V,{size:"small",variant:"outline",theme:"primary"},{default:a(()=>[_(M(d.value.bandwidth)+"Mbps",1)]),_:1}),e(V,{size:"small",theme:d.value.need_real_name?"success":"warning"},{default:a(()=>[_(M(d.value.need_real_name?"需要实名认证":"无需实名认证"),1)]),_:1},8,["theme"]),e(V,{size:"small",theme:d.value.status===1?"success":"danger"},{default:a(()=>[_(" 节点状态："+M(d.value.status===1?"在线":"离线"),1)]),_:1},8,["theme"])]),t("div",sm,[t("pre",null,M(d.value.remarks||"此节点暂无备注"),1)])])]),_:1})):O("",!0),e(T,{label:"隧道类型"},{default:a(()=>[e(p,{modelValue:u.type,"onUpdate:modelValue":g[2]||(g[2]=L=>u.type=L)},{default:a(()=>[e(E,{label:"TCP",value:"tcp"}),d.value?.udp_support?(r(),j(E,{key:0,label:"UDP",value:"udp"})):O("",!0),d.value?.http_support?(r(),j(E,{key:1,label:"HTTP",value:"http"})):O("",!0),d.value?.http_support?(r(),j(E,{key:2,label:"HTTPS",value:"https"})):O("",!0)]),_:1},8,["modelValue"])]),_:1}),e(F,{gutter:[16,20]},{default:a(()=>[e(A,{xs:12,sm:6},{default:a(()=>[e(T,{label:"隧道名称"},{default:a(()=>[e(x,{modelValue:u.name,"onUpdate:modelValue":g[3]||(g[3]=L=>u.name=L)},null,8,["modelValue"])]),_:1})]),_:1}),e(A,{xs:12,sm:6},{default:a(()=>[e(T,{label:"远程端口"},{default:a(()=>[e(x,{modelValue:u.remotePort,"onUpdate:modelValue":g[4]||(g[4]=L=>u.remotePort=L)},{suffix:a(()=>[e(h,{variant:"text",size:"small",onClick:b},{default:a(()=>[...g[12]||(g[12]=[_("随机",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(A,{xs:12,sm:6},{default:a(()=>[e(T,{label:"本地IP"},{default:a(()=>[e(x,{modelValue:u.localIP,"onUpdate:modelValue":g[5]||(g[5]=L=>u.localIP=L)},null,8,["modelValue"])]),_:1})]),_:1}),e(A,{xs:12,sm:6},{default:a(()=>[e(T,{label:"本地端口"},{default:a(()=>[e(x,{modelValue:u.localPort,"onUpdate:modelValue":g[6]||(g[6]=L=>u.localPort=L)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),u.type.includes("http")?(r(),j(T,{key:1,label:"绑定域名",class:"spacing-item"},{default:a(()=>[e(x,{modelValue:u.bindDomain,"onUpdate:modelValue":g[7]||(g[7]=L=>u.bindDomain=L),placeholder:"输入已解析的域名"},null,8,["modelValue"])]),_:1})):O("",!0),e(T,{label:"备注说明",class:"spacing-item"},{default:a(()=>[e(x,{modelValue:u.remarks,"onUpdate:modelValue":g[8]||(g[8]=L=>u.remarks=L)},null,8,["modelValue"])]),_:1}),e(T,{label:"额外参数",class:"spacing-item"},{default:a(()=>[e(N,{modelValue:u.extra_config,"onUpdate:modelValue":g[9]||(g[9]=L=>u.extra_config=L),autosize:{minRows:2},placeholder:"选填，高级配置参数（不懂清留空！！！）"},null,8,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:1},8,["loading"])]),_:1},8,["visible","confirm-btn"])}}}),lm=oe(nm,[["__scopeId","data-v-a8b2caa6"]]),om={key:0,class:"manager-container"},rm={class:"toolbar"},im={class:"record-list"},um={key:0,class:"empty-state"},dm={class:"card-main"},cm={class:"domain-title"},mm={class:"sub"},pm={class:"root"},vm={class:"info-badges"},fm=["title"],gm={key:0,class:"srv-helper"},_m={class:"card-actions"},hm={key:1,class:"form-container"},ym={class:"form-header"},bm={class:"remark-display"},wm={key:0,class:"prefix-hint"},km={class:"row-fields"},$m={class:"form-actions"},Am=ne({__name:"DomainManagerDialog",props:{visible:{type:Boolean},token:{},tunnels:{}},emits:["update:visible"],setup(s,{emit:n}){const l=s,c=n,o=w("list"),i=w("mc_srv"),f=w(!1),u=w(!1),d=w([]),m=w([]),b=w([]),S=w(null),k=He({id:0,domain_id:void 0,name:"",type:"A",record:""}),I=te(()=>l.tunnels?l.tunnels.filter($=>$.type&&$.type.toUpperCase()==="TCP"):[]),g=te(()=>{const $=m.value.find(L=>L.id===k.domain_id);return $?$.remark:""}),V=async()=>{if(l.token){f.value=!0;try{await Promise.all([E(),B(),p()])}catch($){console.error($)}finally{f.value=!1}}},E=async()=>{const $=await Q.get({url:"/api/domain/dns/list",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${l.token}`}});$.code===200&&(d.value=$.data||[])},B=async()=>{const $=await Q.get({url:"/api/domain/list",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${l.token}`}});$.code===200&&(m.value=$.data||[])},p=async()=>{try{const $=await Q.get({url:"/api/frp/nodeList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${l.token}`}});$.code===200&&(b.value=$.data||[])}catch($){console.error("Fetch nodes failed",$)}},A=$=>{const L=l.tunnels.find(U=>U.id===$);if(L){const U=b.value.find(W=>W.id===L.node_id),Z=U?U.domain||U.ip:null;Z?(k.record=`5 5 ${L.remote_port} ${Z}`,P.success("已自动生成解析值")):(P.warning(`无法获取节点(ID:${L.node_id})地址，请手动填写`),k.record=`5 5 ${L.remote_port} 请输入节点地址`),k.type="SRV"}};ke(()=>{l.visible&&l.token&&V()}),be(()=>l.visible,$=>{$&&(o.value="list",V())}),be(m,$=>{$.length>0&&k.domain_id===void 0&&k.id===0&&(k.domain_id=$[0].id)});const h=$=>$.type!=="SRV"?"":`${$.name.replace("_minecraft._tcp.","")}.${$.domain}`,F=()=>{o.value="form",i.value="mc_srv",S.value=null,k.id=0,k.name="",k.type="SRV",k.record="",m.value.length>0&&(k.domain_id=m.value[0].id)},T=$=>{o.value="form",i.value="custom",k.id=$.id,k.domain_id=Number($.domain_id),k.name=$.name,k.type=$.type,k.record=$.record},x=()=>{o.value="list"},N=async()=>{const $=k.type.toUpperCase()==="SRV"||i.value==="mc_srv",L=$?/^[a-zA-Z0-9._-]+$/:/^[a-zA-Z0-9]+$/;let U=k.name;if(U.length<1)return P.warning("请输入子域名名称");if(!L.test(U))return P.warning($?"SRV支持英文、数字、下划线及点":"普通解析仅支持英文数字");i.value==="mc_srv"&&k.id===0&&(U.startsWith("_minecraft._tcp.")||(U="_minecraft._tcp."+U),k.type="SRV"),u.value=!0;const Z=k.id!==0?"/api/domain/dns/edit":"/api/domain/dns/add";try{const W=await Q.post({url:Z,baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${l.token}`},data:{...k,name:U}});W.code===200?(P.success(W.msg||"操作成功"),await E(),o.value="list"):P.error(W.msg)}catch(W){P.error("请求失败: "+W.message)}finally{u.value=!1}},G=async $=>{const L=tt.confirm({header:"确认删除",body:"确定要删除这条解析记录吗？删除后无法恢复。",onConfirm:async()=>{L.hide();try{const U=await Q.post({url:"/api/domain/dns/delete",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${l.token}`},data:{id:$}});U.code===200?(P.success("删除成功"),E()):P.error(U.msg)}catch(U){P.error(U.message)}}})},R=()=>{c("update:visible",!1)};return($,L)=>{const U=v("t-button"),Z=v("t-empty"),W=v("t-tag"),J=v("t-tooltip"),H=v("t-loading"),he=v("t-tab-panel"),Te=v("t-tabs"),ge=v("t-option"),Re=v("t-select"),Ue=v("t-form-item"),Ee=v("t-input"),Be=v("t-form"),je=v("t-dialog");return r(),j(je,{visible:s.visible,header:o.value==="list"?"MSLFrp免费子域名管理":k.id===0?"创建新解析":"编辑解析",width:"650px",attach:"body",footer:!1,onClose:R},{default:a(()=>[o.value==="list"?(r(),C("div",om,[t("div",rm,[e(U,{variant:"text",theme:"default",onClick:L[0]||(L[0]=re=>y(Ae)("https://www.mslmc.cn/docs/proxy/server-no-port/"))},{icon:a(()=>[e(y(ws))]),default:a(()=>[L[7]||(L[7]=_("查看文档 ",-1))]),_:1}),e(U,{theme:"primary",onClick:F},{icon:a(()=>[e(y(la))]),default:a(()=>[L[8]||(L[8]=_("新建解析 ",-1))]),_:1})]),e(H,{loading:f.value,text:"加载中..."},{default:a(()=>[t("div",im,[d.value.length===0?(r(),C("div",um,[e(Z,{title:"暂无解析记录",description:"点击上方按钮创建一个吧"})])):O("",!0),(r(!0),C(pe,null,ye(d.value,re=>(r(),C("div",{key:re.id,class:"record-card"},[t("div",dm,[t("div",cm,[t("span",mm,M(re.name),1),t("span",pm,"."+M(re.domain),1)]),t("div",vm,[e(W,{size:"small",theme:re.type==="SRV"?"warning":"primary",variant:"light"},{default:a(()=>[_(M(re.type),1)]),_:2},1032,["theme"]),t("span",{class:"record-value",title:re.record},M(re.record),9,fm)]),re.type==="SRV"?(r(),C("div",gm,[e(y(bt)),t("span",null,[L[9]||(L[9]=_("地址: ",-1)),t("strong",null,M(h(re)),1)])])):O("",!0)]),t("div",_m,[e(J,{content:"编辑"},{default:a(()=>[e(U,{shape:"circle",variant:"text",onClick:Se=>T(re)},{icon:a(()=>[e(y(ks))]),_:1},8,["onClick"])]),_:2},1024),e(J,{content:"删除"},{default:a(()=>[e(U,{shape:"circle",variant:"text",theme:"danger",onClick:Se=>G(re.id)},{icon:a(()=>[e(y(Lt))]),_:1},8,["onClick"])]),_:2},1024)])]))),128))])]),_:1},8,["loading"])])):(r(),C("div",hm,[t("div",ym,[e(U,{variant:"text",size:"small",onClick:x},{icon:a(()=>[e(y($s))]),default:a(()=>[L[10]||(L[10]=_(" 返回列表 ",-1))]),_:1})]),k.id===0?(r(),j(Te,{key:0,modelValue:i.value,"onUpdate:modelValue":L[1]||(L[1]=re=>i.value=re),class:"mode-tabs"},{default:a(()=>[e(he,{value:"mc_srv",label:"MC Java版隐藏端口"}),e(he,{value:"custom",label:"自定义解析"})]),_:1},8,["modelValue"])):O("",!0),e(Be,{"label-align":"top",data:k,class:"dns-form"},{default:a(()=>[e(Ue,{label:"选择域名后缀"},{default:a(()=>[e(Re,{modelValue:k.domain_id,"onUpdate:modelValue":L[2]||(L[2]=re=>k.domain_id=re),disabled:k.id!==0,placeholder:"请选择后缀",filterable:""},{default:a(()=>[(r(!0),C(pe,null,ye(m.value,re=>(r(),j(ge,{key:re.id,value:re.id,label:re.domain},{default:a(()=>[_(M(re.domain),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),g.value?(r(),j(Ue,{key:0,label:"备注"},{default:a(()=>[t("div",bm,M(g.value),1)]),_:1})):O("",!0),e(Ue,{label:"子域名称",help:"起一个你喜欢的前缀即可"},{default:a(()=>[e(Ee,{modelValue:k.name,"onUpdate:modelValue":L[3]||(L[3]=re=>k.name=re),placeholder:"例如: myserver"},{"prefix-icon":a(()=>[i.value==="mc_srv"&&k.id===0?(r(),C("span",wm,"_minecraft._tcp.")):O("",!0)]),_:1},8,["modelValue"])]),_:1}),i.value==="mc_srv"&&k.id===0?(r(),j(Ue,{key:1,label:"选择隧道 (自动生成解析值)"},{default:a(()=>[e(Re,{modelValue:S.value,"onUpdate:modelValue":L[4]||(L[4]=re=>S.value=re),placeholder:"点击选择已有的 TCP 隧道",onChange:A},{default:a(()=>[(r(!0),C(pe,null,ye(I.value,re=>(r(),j(ge,{key:re.id,value:re.id,label:`${re.name} (端口: ${re.remote_port})`},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})):O("",!0),t("div",km,[e(Ue,{label:"记录类型",class:"half-width"},{default:a(()=>[e(Re,{modelValue:k.type,"onUpdate:modelValue":L[5]||(L[5]=re=>k.type=re)},{default:a(()=>[e(ge,{label:"A (IPv4)",value:"A"}),e(ge,{label:"CNAME (别名)",value:"CNAME"}),e(ge,{label:"AAAA (IPv6)",value:"AAAA"}),e(ge,{label:"SRV (服务记录)",value:"SRV"})]),_:1},8,["modelValue"])]),_:1}),e(Ue,{label:"解析记录值",class:"half-width"},{default:a(()=>[e(Ee,{modelValue:k.record,"onUpdate:modelValue":L[6]||(L[6]=re=>k.record=re),placeholder:"例: 5 5 25565 node.mslmc.net"},null,8,["modelValue"])]),_:1})]),t("div",$m,[e(U,{theme:"default",variant:"base",onClick:x},{default:a(()=>[...L[11]||(L[11]=[_("取消",-1)])]),_:1}),e(U,{theme:"primary",loading:u.value,onClick:N},{default:a(()=>[_(M(k.id===0?"立即创建":"保存修改"),1)]),_:1},8,["loading"])])]),_:1},8,["data"])]))]),_:1},8,["visible","header"])}}}),xm=oe(Am,[["__scopeId","data-v-e04d368f"]]),Cm={class:"page-container"},Sm={key:0,class:"login-container"},Im={class:"login-card"},Vm={class:"icon-wrapper"},Mm={key:1,class:"dashboard-container"},Lm={class:"stat-item"},Um={class:"value"},Bm={class:"stat-item"},Rm={class:"value"},Em={class:"stat-item"},Pm={class:"value"},zm={class:"stat-item"},Fm={class:"value date-text"},Tm={class:"list-header"},Dm={class:"tunnel-list"},Om=["onClick"],jm={class:"item-icon"},Km={class:"item-content"},qm={class:"item-title"},Nm={class:"item-subtitle"},Gm={class:"item-status"},Hm={key:0,class:"empty-state"},Jm={key:0,class:"detail-content"},Wm={class:"detail-header"},Xm={class:"remarks"},Qm={class:"detail-grid"},Ym={class:"val"},Zm={class:"detail-grid"},ep={class:"val uppercase"},tp={class:"detail-grid"},ap={class:"val"},sp={class:"detail-grid"},np={class:"val highlight"},lp={class:"detail-grid"},op={class:"val"},rp={class:"detail-grid"},ip={class:"val"},up={class:"action-area"},dp={key:1,class:"empty-detail"},cp=ne({__name:"index",setup(s){const n=w(!1),l=w(!1),c=()=>{B()},o=w("tKYvKk48Sq5kGAy12IJQxLEKhXx"),i=w(null),f=w(""),u=w(!1),d=w(null),m=w([]),b=w({}),S=w(null),k=te(()=>m.value.find(G=>G.id===S.value)||null),I=te(()=>k.value?b.value[k.value.node_id]||`未知节点 (${k.value.node_id})`:"");ke(()=>{const G=localStorage.getItem("msl-user-token");G&&(f.value=G,B())}),Je(()=>{i.value&&!i.value.closed&&i.value.close()});async function g(){P.info("正在跳转至MSL用户中心登录...");try{const G=Ka(32),R=await Q.post({url:"/api/oauth/createAppLogin",baseURL:"https://user.mslmc.net",data:{appid:o.value,csrf:G}});R.data.ssid?(i.value=Qc(R.data.url,"登录到您的MSL账户",600,600),setTimeout(()=>V(G,R.data.ssid),1e3)):P.error(R.msg)}catch(G){P.error(G.message)}}async function V(G,R){if(!i.value?.closed){try{const $=await Q.get({url:"/api/oauth/appLogin",baseURL:"https://user.mslmc.net",params:{csrf:G,ssid:R}});if($.data.token){i.value&&i.value.close(),P.success("登录成功"),f.value=$.data.token,localStorage.setItem("msl-user-token",$.data.token),B();return}}catch($){P.error("登录失败！"+$.message);return}setTimeout(()=>V(G,R),1e3)}}const E=G=>{if(G===0)return"0 B";const R=1024,$=["B","KB","MB","GB","TB"],L=Math.floor(Math.log(G)/Math.log(R));return parseFloat((G/Math.pow(R,L)).toFixed(2))+" "+$[L]};async function B(){u.value=!0;try{const[G,R]=await Promise.all([Q.get({url:"/api/frp/userInfo",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${f.value}`}}),Q.get({url:"/api/frp/nodeList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${f.value}`}})]);if(G.code===200)d.value=G.data;else{P.warning("登录已过期，请重新登录～"),f.value="",localStorage.removeItem("msl-user-token");return}if(R.code===200){const L={};R.data.forEach(U=>{L[U.id]=U.node}),b.value=L}const $=await Q.get({url:"/api/frp/getTunnelList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${f.value}`}});$.code===200&&(m.value=$.data,m.value.length>0&&(S.value=m.value[0].id))}catch(G){P.error("数据加载失败: "+G.message)}finally{u.value=!1}}const p=w(!1);async function A(){if(k.value){p.value=!0;try{const G=await Q.get({url:"/api/frp/getTunnelConfig",baseURL:"https://user.mslmc.net",params:{id:k.value.id},headers:{Authorization:`Bearer ${f.value}`}});G.code===200?await ja(k.value.name,G.data,"MSLFrp"):P.error(G.msg)}catch(G){P.error("获取配置失败: "+G.message)}p.value=!1}}const h=()=>{l.value=!0};async function F(){try{await Q.get({url:"/api/user/logout",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${f.value}`}}),f.value="",d.value=null,m.value=[],localStorage.removeItem("msl-user-token"),P.success("已退出登录")}catch(G){P.error("退出失败: "+G.message)}}async function T(){await B(),P.success("数据已更新")}const x=w(!1);async function N(){if(k.value){x.value=!0;try{const G=await Q.post({url:"/api/frp/deleteTunnel",baseURL:"https://user.mslmc.net",data:{id:k.value.id},headers:{Authorization:`Bearer ${f.value}`}});G.code===200?(P.success("隧道删除成功"),S.value=null,await B()):P.error(G.msg||"删除失败")}catch(G){P.error("操作失败: "+G.message)}finally{x.value=!1}}}return(G,R)=>{const $=v("t-button"),L=v("t-space"),U=v("t-loading"),Z=v("t-tag"),W=v("t-popconfirm"),J=v("t-col"),H=v("t-row"),he=v("t-card"),Te=v("t-divider");return r(),C("div",Cm,[f.value===""?(r(),C("div",Sm,[t("div",Im,[t("div",Vm,[e(y(Qt),{size:"48px",style:{color:"var(--td-brand-color)"}})]),R[8]||(R[8]=t("h2",{class:"title"},"欢迎登录 MSLFrp",-1)),R[9]||(R[9]=t("p",{class:"subtitle"},"登录您的MSL账户以使用 MSLFrp 服务",-1)),e(L,{direction:"vertical",size:"medium",style:{width:"100%"}},{default:a(()=>[e($,{block:"",theme:"primary",size:"large",onClick:g},{icon:a(()=>[e(y(Qt))]),default:a(()=>[R[6]||(R[6]=_(" 跳转用户中心登录 ",-1))]),_:1}),e($,{theme:"default",variant:"outline",block:"",size:"large",onClick:R[0]||(R[0]=ge=>y(Ae)("https://user.mslmc.net/register"))},{icon:a(()=>[e(y(ln))]),default:a(()=>[R[7]||(R[7]=_(" 注册 MSL 账户 ",-1))]),_:1})]),_:1})])])):(r(),C("div",Mm,[e(U,{attach:"#app-space",loading:u.value,text:"加载数据中..."},null,8,["loading"]),e(L,{id:"app-space",direction:"vertical",size:"large",style:{width:"100%"}},{default:a(()=>[d.value?(r(),j(he,{key:0,bordered:!1,title:"MSLFrp 用户信息",class:"info-card"},{actions:a(()=>[e(L,{size:"small"},{default:a(()=>[e($,{variant:"outline",theme:"success",size:"small",onClick:R[1]||(R[1]=ge=>y(Ae)("https://user.mslmc.net/store/buy"))},{default:a(()=>[...R[10]||(R[10]=[_(" 订阅会员服务 ",-1)])]),_:1}),e(Z,{theme:"primary",variant:"light-outline"},{default:a(()=>[_(M(d.value.user_group_name),1)]),_:1}),e(W,{content:"确认退出登录吗？",onConfirm:F},{default:a(()=>[e($,{variant:"outline",theme:"danger",size:"small"},{default:a(()=>[...R[11]||(R[11]=[_(" 退出登录 ",-1)])]),_:1})]),_:1})]),_:1})]),default:a(()=>[e(H,{gutter:[16,16]},{default:a(()=>[e(J,{xs:6,sm:3},{default:a(()=>[t("div",Lm,[R[12]||(R[12]=t("div",{class:"label"},"用户昵称",-1)),t("div",Um,[_(M(d.value.name)+" ",1),e(Z,{theme:d.value.realNameStatus?"success":"warning",variant:"dark",size:"small",style:{cursor:"pointer"},onClick:R[2]||(R[2]=ge=>y(Ae)("https://user.mslmc.net/user/profile"))},{default:a(()=>[_(M(d.value.realNameStatus?"已实名":"未实名"),1)]),_:1},8,["theme"])])])]),_:1}),e(J,{xs:6,sm:3},{default:a(()=>[t("div",Bm,[R[13]||(R[13]=t("div",{class:"label"},"隧道限额",-1)),t("div",Rm,M(d.value.maxTunnelCount)+" 条",1)])]),_:1}),e(J,{xs:6,sm:3},{default:a(()=>[t("div",Em,[R[14]||(R[14]=t("div",{class:"label"},"速率限制",-1)),t("div",Pm,M(d.value.boundLimit/1024*8)+" Mbps",1)])]),_:1}),e(J,{xs:6,sm:3},{default:a(()=>[t("div",zm,[R[15]||(R[15]=t("div",{class:"label"},"会员到期时间",-1)),t("div",Fm,M(d.value.outdated===3749682420?"长期有效":y(Ds)(d.value.outdated)),1)])]),_:1})]),_:1})]),_:1})):O("",!0),e(H,{gutter:[16,16]},{default:a(()=>[e(J,{xs:12,md:5,lg:4},{default:a(()=>[e(he,{bordered:!1,class:"full-height-card"},{title:a(()=>[t("div",Tm,[R[19]||(R[19]=t("span",null,"我的隧道",-1)),e(L,{size:"4px"},{default:a(()=>[e($,{style:{"margin-left":"3px"},size:"small",variant:"text",loading:u.value,onClick:T},{icon:a(()=>[e(y(lt))]),default:a(()=>[R[16]||(R[16]=_(" 刷新 ",-1))]),_:1},8,["loading"]),e($,{size:"small",variant:"text",onClick:R[3]||(R[3]=ge=>n.value=!0)},{icon:a(()=>[e(y(Ft))]),default:a(()=>[R[17]||(R[17]=_(" 免费子域名 ",-1))]),_:1}),e($,{size:"small",variant:"text",onClick:h},{icon:a(()=>[e(y(la))]),default:a(()=>[R[18]||(R[18]=_(" 新建 ",-1))]),_:1})]),_:1})])]),default:a(()=>[t("div",Dm,[(r(!0),C(pe,null,ye(m.value,ge=>(r(),C("div",{key:ge.id,class:we(["tunnel-item",{active:S.value===ge.id}]),onClick:Re=>S.value=ge.id},[t("div",jm,[e(y(Ct))]),t("div",Km,[t("div",qm,M(ge.name),1),t("div",Nm,M(b.value[ge.node_id]||`Node ${ge.node_id}`),1)]),t("div",Gm,[ge.status===1?(r(),j(Z,{key:0,theme:"success",variant:"light",size:"small"},{default:a(()=>[...R[20]||(R[20]=[_("在线",-1)])]),_:1})):(r(),j(Z,{key:1,theme:"default",variant:"light",size:"small"},{default:a(()=>[...R[21]||(R[21]=[_("未启动",-1)])]),_:1}))])],10,Om))),128)),m.value.length===0?(r(),C("div",Hm,"暂无隧道")):O("",!0)])]),_:1})]),_:1}),e(J,{xs:12,md:7,lg:8},{default:a(()=>[e(he,{bordered:!1,class:"full-height-card"},{title:a(()=>[...R[22]||(R[22]=[t("span",null,"隧道详情",-1)])]),actions:a(()=>[k.value?(r(),j(W,{key:0,content:"确认删除此隧道吗？",theme:"danger",placement:"bottom-right",onConfirm:N},{default:a(()=>[e($,{theme:"danger",variant:"text",loading:x.value},{default:a(()=>[...R[23]||(R[23]=[_(" 删除隧道 ",-1)])]),_:1},8,["loading"])]),_:1})):O("",!0)]),default:a(()=>[k.value?(r(),C("div",Jm,[t("div",Wm,[t("h3",null,M(k.value.name),1),t("p",Xm,M(k.value.remarks||"暂无备注"),1)]),e(Te),e(H,{gutter:[24,24]},{default:a(()=>[e(J,{span:6},{default:a(()=>[t("div",Qm,[R[24]||(R[24]=t("span",{class:"label"},"所在节点",-1)),t("span",Ym,M(I.value),1)])]),_:1}),e(J,{span:6},{default:a(()=>[t("div",Zm,[R[25]||(R[25]=t("span",{class:"label"},"协议类型",-1)),t("span",ep,M(k.value.type),1)])]),_:1}),e(J,{span:6},{default:a(()=>[t("div",tp,[R[26]||(R[26]=t("span",{class:"label"},"本地地址",-1)),t("span",ap,M(k.value.local_ip)+":"+M(k.value.local_port),1)])]),_:1}),e(J,{span:6},{default:a(()=>[t("div",sp,[R[27]||(R[27]=t("span",{class:"label"},"远程端口",-1)),t("span",np,M(k.value.remote_port),1)])]),_:1}),e(J,{span:6},{default:a(()=>[t("div",lp,[R[28]||(R[28]=t("span",{class:"label"},"今日流量",-1)),t("span",op,M(E(k.value.today_traffic*1024*1024)),1)])]),_:1}),e(J,{span:6},{default:a(()=>[t("div",rp,[R[29]||(R[29]=t("span",{class:"label"},"总流量",-1)),t("span",ip,M(E(k.value.total_traffic*1024*1024)),1)])]),_:1})]),_:1}),e(Te),t("div",up,[e($,{theme:"primary",size:"large",loading:p.value,block:"",onClick:A},{icon:a(()=>[e(y(Kt))]),default:a(()=>[R[30]||(R[30]=_(" 使用此隧道 ",-1))]),_:1},8,["loading"])])])):(r(),C("div",dp,[e(y(Ft),{size:"48px",style:{color:"var(--td-text-color-disabled)"}}),R[31]||(R[31]=t("p",null,"请在左侧选择一个隧道查看详情",-1))]))]),_:1})]),_:1})]),_:1})]),_:1})])),l.value?(r(),j(lm,{key:2,visible:l.value,"onUpdate:visible":R[4]||(R[4]=ge=>l.value=ge),token:f.value,onSuccess:c},null,8,["visible","token"])):O("",!0),n.value?(r(),j(xm,{key:3,visible:n.value,"onUpdate:visible":R[5]||(R[5]=ge=>n.value=ge),token:f.value,tunnels:m.value},null,8,["visible","token","tunnels"])):O("",!0)])}}}),mp=oe(cp,[["__scopeId","data-v-a5e7f491"]]);async function pp(){return await Q.get({url:"/query/p2p_server",baseURL:"https://api.mslmc.cn/v3"})}const vp={key:0},fp={key:1},gp={key:0},_p={key:1},hp={key:0},yp={key:1},bp=ne({__name:"MSLP2P",setup(s){const n=He({roomId:"",roomKey:"",bindPort:25565,isHoster:!0}),l={roomId:[{required:!0,message:"请输入房间号",type:"error"}],roomKey:[{required:!0,message:"请输入房间密钥",type:"error"}],bindPort:[{required:!0,message:"请输入绑定端口",type:"error"}]},c=async({validateResult:i})=>{i===!0?await o(n.isHoster,n.roomId,n.roomKey,n.bindPort):P.warning("请检查参数是否全部填写完成！")};async function o(i,f,u,d){try{const m=await pp();let b;i?b=`serverAddr = "${m.ip}"
serverPort = ${m.port}

[[proxies]]
name = "${f}"
type = "xtcp"
secretKey = "${u}"
localIP = "127.0.0.1"
localPort = ${d}`:b=`serverAddr = "${m.ip}"
serverPort = ${m.port}

[[visitors]]
name = "p2p_visitor"
type = "xtcp"
serverName = "${f}"
secretKey = "${u}"
bindAddr = "127.0.0.1"
bindPort = ${d}`,await ja(i?`「联机 - 房主」${f}`:`「联机 - 访客」${f}`,b,"MSL P2P")}catch(m){P.error(`创建联机隧道失败！${m.message}`)}}return(i,f)=>{const u=v("t-radio"),d=v("t-radio-group"),m=v("t-form-item"),b=v("t-input"),S=v("t-button"),k=v("t-form"),I=v("t-card");return r(),C("div",null,[e(I,{bordered:!1},{header:a(()=>[...f[5]||(f[5]=[t("span",{style:{"font-weight":"bold","font-size":"16px"}},"MSL P2P 联机隧道",-1)])]),default:a(()=>[e(k,{data:n,rules:l,"label-width":100,"label-align":"top","reset-type":"initial",onSubmit:c},{default:a(()=>[e(m,{label:"请选择联机类型",name:"isHoster"},{default:a(()=>[e(d,{modelValue:n.isHoster,"onUpdate:modelValue":f[0]||(f[0]=g=>n.isHoster=g)},{default:a(()=>[e(u,{value:!0},{default:a(()=>[...f[6]||(f[6]=[_("创建房间 - 房主",-1)])]),_:1}),e(u,{value:!1},{default:a(()=>[...f[7]||(f[7]=[_("加入房间 - 成员",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(m,{label:"房间号",name:"roomId"},{help:a(()=>[n.isHoster?(r(),C("span",vp,"建议填写您的QQ号码。")):(r(),C("span",fp,"请输入房间创建者提供的房间号。"))]),default:a(()=>[e(b,{modelValue:n.roomId,"onUpdate:modelValue":f[1]||(f[1]=g=>n.roomId=g),placeholder:"请输入房间号"},null,8,["modelValue"])]),_:1}),e(m,{label:"房间密钥",name:"roomKey"},{help:a(()=>[n.isHoster?(r(),C("span",gp,"随便写一个你喜欢的密钥。")):(r(),C("span",_p,"请输入房间创建者提供的密钥。"))]),default:a(()=>[e(b,{modelValue:n.roomKey,"onUpdate:modelValue":f[2]||(f[2]=g=>n.roomKey=g),placeholder:"请输入房间密钥"},null,8,["modelValue"]),n.isHoster?(r(),j(S,{key:0,theme:"default",variant:"base",style:{"margin-left":"5px"},onClick:f[3]||(f[3]=g=>{n.roomKey=y(Ka)(16)})},{default:a(()=>[...f[8]||(f[8]=[_("随机生成",-1)])]),_:1})):O("",!0)]),_:1}),e(m,{label:"绑定端口",name:"bindPort"},{help:a(()=>[n.isHoster?(r(),C("span",hp,"请输入游戏内提示的开放联机端口。")):(r(),C("span",yp,"建议保持默认。"))]),default:a(()=>[e(b,{modelValue:n.bindPort,"onUpdate:modelValue":f[4]||(f[4]=g=>n.bindPort=g),placeholder:"请输入绑定端口"},null,8,["modelValue"])]),_:1}),e(m,{style:{"margin-top":"16px"}},{default:a(()=>[e(S,{theme:"primary",type:"submit"},{default:a(()=>[...f[9]||(f[9]=[_("添加隧道",-1)])]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})])}}}),wp=ne({__name:"index",setup(s){const n=w(1);return(l,c)=>{const o=v("t-tab-panel"),i=v("t-tabs"),f=v("t-card");return r(),C("div",null,[e(f,{direction:"vertical"},{default:a(()=>[e(i,{modelValue:n.value,"onUpdate:modelValue":c[0]||(c[0]=u=>n.value=u)},{default:a(()=>[e(o,{value:1,label:"MSLFrp","destroy-on-hide":!1},{default:a(()=>[e(mp,{style:{margin:"15px"}})]),_:1}),e(o,{value:2,label:"MSL 联机","destroy-on-hide":!1},{default:a(()=>[e(bp,{style:{margin:"15px"}})]),_:1}),e(o,{value:3,label:"自定义Frp","destroy-on-hide":!1},{default:a(()=>[e(Xc,{style:{margin:"15px"}})]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}}),kp=Object.freeze(Object.defineProperty({__proto__:null,default:wp},Symbol.toStringTag,{value:"Module"})),$p={class:"terminal-header"},Ap={class:"tab-title"},xp=ne({__name:"ConsoleTerminal",props:{frpId:{}},emits:["update"],setup(s,{expose:n,emit:l}){const c=s,o=l,i=Fe(),f=w(null),u=w(null);let d=null,m=null,b=null,S=null,k=null;const I={dark:{background:"transparent",foreground:"#cccccc",cursor:"transparent",selectionBackground:"#264f78",black:"#000000",red:"#cd3131",green:"#0dbc79",yellow:"#e5e510",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"},light:{background:"transparent",foreground:"#333333",cursor:"transparent",selectionBackground:"#add6ff",black:"#000000",red:"#cd3131",green:"#00bc79",yellow:"#9d9d10",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"}};ue.enabled=!0;const g=T=>T?(T=T.replace(/^(\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2}(\.\d{3})?)/,x=>ue.gray(x)),T=T.replace(/\[I\]/g,ue.green("[I]")),T=T.replace(/\[W\]/g,ue.yellow("[W]")),T=T.replace(/\[E\]/g,ue.red("[E]")),T=T.replace(/(success)/gi,x=>ue.bold.green(x)),T=T.replace(/(start|starting)/gi,x=>ue.blue(x)),T=T.replace(/(failed|error)/gi,x=>ue.bgRed.white(` ${x} `)),T=T.replace(/(:\d{4,5})/g,x=>ue.cyan(x)),T=T.replace(/(\[[0-9a-f]{8,}\])/g,x=>ue.magenta(x)),T):"",V=()=>{if(!u.value||!f.value)return;if(d){d.clear(),B();return}const T=document.documentElement.getAttribute("theme-mode")==="dark";d=new Us({cursorBlink:!1,cursorStyle:"bar",fontSize:14,fontFamily:'"Maple Mono", "Maple Mono CN", "Cascadia Code", Consolas, Menlo, "PingFang SC", "Microsoft YaHei", monospace',lineHeight:1.4,theme:T?I.dark:I.light,allowTransparency:!0,disableStdin:!0,convertEol:!0}),m=new Bs,d.loadAddon(m),d.open(u.value);const x=()=>{if(u.value&&u.value.clientWidth>0&&u.value.clientHeight>0)try{m?.fit(),d?.scrollToBottom()}catch(N){console.warn(N)}};b=new ResizeObserver(()=>window.requestAnimationFrame(x)),b.observe(f.value),setTimeout(x,100),B()},E=()=>{if(!d)return;const T=document.documentElement.getAttribute("theme-mode")==="dark";d.options.theme=T?I.dark:I.light},B=()=>{d?.writeln("\x1B[1;34m[System]\x1B[0m 正在初始化Frp控制台 ..."),d?.writeln(`\x1B[1;34m[System]\x1B[0m ID: ${c.frpId} | 状态: \x1B[32m已就绪！\x1B[0m`)},p=async()=>{if(k)try{await k.stop(),k=null}catch(T){console.error(T)}},A=async()=>{if(await p(),!c.frpId)return;const{baseUrl:T,token:x}=i,N=new URL("/api/hubs/frpLogsHub",T||window.location.origin);x&&N.searchParams.append("x-user-token",x),console.log(N.toString()),k=new wt().withUrl(N.toString(),{withCredentials:!1}).configureLogging(Mt.Warning).withAutomaticReconnect([0,2e3,5e3,1e4,3e4]).build(),k.on("ReceiveLog",G=>{d?.writeln(g(G)),G.includes("[MSLX]")&&setTimeout(()=>{o("update")},2e3)}),k.onreconnecting(G=>{d?.writeln("\x1B[1;33m[System] 检测到连接中断，正在尝试重连...\x1B[0m"),console.warn("SignalR Reconnecting:",G)}),k.onreconnected(async()=>{d?.writeln("\x1B[1;32m[System] 网络已恢复，重新连接日志服务...\x1B[0m");try{await k?.invoke("JoinGroup",c.frpId),d?.writeln("\x1B[1;32m[System] 日志服务成功重新连接！\x1B[0m")}catch(G){d?.writeln(`\x1B[1;31m[Error] 重新连接日志服务失败: ${G.message}\x1B[0m`)}}),k.onclose(G=>{G&&(d?.writeln(`\x1B[1;31m[System] 日志服务连接已断开: ${G.message}\x1B[0m`),d?.writeln("\x1B[1;31m[System] 请刷新页面或检查网络连接。\x1B[0m"))});try{await k.start(),d?.writeln("\x1B[1;32m[System] 成功连接到Frpc日志服务\x1B[0m"),await k.invoke("JoinGroup",c.frpId)}catch(G){d?.writeln(`\x1B[1;31m[Error] 连接失败: ${G.message}\x1B[0m`)}};return n({writeln:T=>d?.writeln(T),clear:()=>{d?.clear(),B()}}),be(()=>c.frpId,async T=>{T&&(V(),await A())}),ke(async()=>{await vt(),V(),S=new MutationObserver(E),S.observe(document.documentElement,{attributes:!0,attributeFilter:["theme-mode"]}),c.frpId&&await A()}),Je(async()=>{S?.disconnect(),await p(),d?.dispose(),b?.disconnect()}),(T,x)=>(r(),C("div",{ref_key:"terminalWrapper",ref:f,class:"terminal-wrapper"},[t("div",$p,[x[0]||(x[0]=t("div",{class:"dots"},[t("span",{class:"dot red"}),t("span",{class:"dot yellow"}),t("span",{class:"dot green"})],-1)),t("div",Ap,"MSLX - Frp 控制台 | "+M(s.frpId),1)]),t("div",{ref_key:"terminalBody",ref:u,class:"terminal-body"},null,512)],512))}}),Cp=oe(xp,[["__scopeId","data-v-60e866bf"]]),Xt=(s,n=!0,l="复制成功")=>new Promise((c,o)=>{navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(s).then(()=>{n&&P.success(l),c()}).catch(()=>{us(s,n,l,c,o)}):us(s,n,l,c,o)});function us(s,n,l,c,o){try{const i=document.createElement("textarea");i.value=s,i.style.top="0",i.style.left="0",i.style.position="fixed",document.body.appendChild(i),i.focus(),i.select();const f=document.execCommand("copy");document.body.removeChild(i),f?(n&&P.success(l),c()):(n&&P.error("复制失败"),o(new Error("execCommand returned false")))}catch(i){n&&P.error("复制出错"),o(i)}}const Sp={class:"sidebar-content"},Ip={class:"control-header"},Vp={class:"control-actions"},Mp={class:"action-row"},Lp={class:"info-list"},Up={class:"info-item"},Bp={class:"label"},Rp={class:"value"},Ep={key:0,class:"proxy-header"},Pp={class:"info-item"},zp={class:"label"},Fp=["onClick"],Tp={class:"info-item"},Dp={class:"label"},Op={class:"value highlight"},jp={class:"info-item"},Kp={class:"label"},qp=["onClick"],Np={key:1,class:"info-item"},Gp={class:"label"},Hp=["onClick"],Jp={class:"info-item"},Wp={class:"label"},Xp={class:"value"},Qp={key:1,class:"info-item empty-state"},Yp={class:"value"},Zp=ne({__name:"ControlPanel",props:{frpId:{},isRunning:{type:Boolean},loading:{type:Boolean},tunnelInfo:{}},emits:["start","stop","clear-log","edit-config"],setup(s){return(n,l)=>{const c=v("t-tag"),o=v("t-button"),i=v("t-card"),f=v("t-tooltip");return r(),C("div",Sp,[e(i,{class:"control-card",bordered:!1},{default:a(()=>[t("div",Ip,[t("div",{class:we(["status-indicator",{running:s.isRunning}])},[l[4]||(l[4]=t("span",{class:"pulse"},null,-1)),_(M(s.isRunning?"Running":"Stopped"),1)],2),e(c,{theme:s.isRunning?"success":"default",variant:"light",shape:"round"},{default:a(()=>[_(M(s.isRunning?"正常运行":"未运行"),1)]),_:1},8,["theme"])]),t("div",Vp,[s.isRunning?(r(),j(o,{key:1,theme:"danger",size:"large",block:"",loading:s.loading,onClick:l[1]||(l[1]=u=>n.$emit("stop"))},{icon:a(()=>[e(y(sa))]),default:a(()=>[l[6]||(l[6]=_("停止服务 ",-1))]),_:1},8,["loading"])):(r(),j(o,{key:0,theme:"primary",size:"large",block:"",loading:s.loading,onClick:l[0]||(l[0]=u=>n.$emit("start"))},{icon:a(()=>[e(y(Kt))]),default:a(()=>[l[5]||(l[5]=_("启动服务 ",-1))]),_:1},8,["loading"])),t("div",Mp,[e(o,{class:"glass-btn",variant:"outline",theme:"warning",onClick:l[2]||(l[2]=u=>n.$emit("clear-log"))},{icon:a(()=>[e(y(lt))]),default:a(()=>[l[7]||(l[7]=_("清空日志 ",-1))]),_:1}),e(o,{variant:"outline",theme:"default",onClick:l[3]||(l[3]=u=>n.$emit("edit-config"))},{icon:a(()=>[e(y(on))]),default:a(()=>[l[8]||(l[8]=_("配置文件 ",-1))]),_:1})])])]),_:1}),e(i,{title:"隧道概览",class:"info-card",bordered:!1},{actions:a(()=>[s.tunnelInfo&&s.tunnelInfo.proxies&&s.tunnelInfo.proxies.length>0&&s.tunnelInfo.proxies.some(u=>u.type==="xtcp")?(r(),j(c,{key:0,variant:"light-outline",theme:"primary"},{default:a(()=>[...l[9]||(l[9]=[_("联机房间 - 房主",-1)])]),_:1})):s.tunnelInfo&&s.tunnelInfo.proxies&&s.tunnelInfo.proxies.length>0&&s.tunnelInfo.proxies.some(u=>u.type==="xtcp - Visitors")?(r(),j(c,{key:1,variant:"light-outline",theme:"primary"},{default:a(()=>[...l[10]||(l[10]=[_("联机房间 - 访客",-1)])]),_:1})):(r(),j(o,{key:2,shape:"circle",variant:"text"},{default:a(()=>[e(y(St))]),_:1}))]),default:a(()=>[t("div",Lp,[t("div",Up,[t("div",Bp,[e(y(Ct)),l[11]||(l[11]=_(" 隧道实例 ID",-1))]),t("div",Rp,"#"+M(s.frpId),1)]),s.tunnelInfo&&s.tunnelInfo.proxies&&s.tunnelInfo.proxies.length>0?(r(!0),C(pe,{key:0},ye(s.tunnelInfo.proxies,(u,d)=>(r(),C("div",{key:d,class:"proxy-group"},[s.tunnelInfo.proxies.length>1?(r(),C("div",Ep,"配置 #"+M(d+1),1)):O("",!0),t("div",Pp,[t("div",zp,[e(y(Ft)),_(" "+M(u.type.includes("xtcp")?"房间号":"隧道名称"),1)]),e(f,{content:u.proxyName,placement:"top","show-arrow":"","destroy-on-close":""},{default:a(()=>[t("div",{onClick:m=>y(Xt)(u.proxyName,!0,`${u.type.includes("xtcp")?"房间号":"隧道名称"}已复制！`),class:"value remote-addr pointer"},M(u.proxyName),9,Fp)]),_:2},1032,["content"])]),t("div",Tp,[t("div",Dp,[e(y(ws)),l[12]||(l[12]=_(" 协议类型",-1))]),t("div",Op,M(u.type.toUpperCase()),1)]),t("div",jp,[t("div",Kp,[e(y(bt)),_(" "+M(u.type.includes("xtcp")?"房间密钥":"连接地址"),1)]),e(f,{content:u.remoteAddressMain,placement:"top","show-arrow":"","destroy-on-close":""},{default:a(()=>[t("div",{class:"value remote-addr pointer",onClick:m=>y(Xt)(u.remoteAddressMain,!0,`${u.type.includes("xtcp")?"房间密钥":"连接地址"}已复制！`)},M(u.remoteAddressMain||"获取中..."),9,qp)]),_:2},1032,["content"])]),u.remoteAddressBackup&&u.remoteAddressBackup!==u.remoteAddressMain?(r(),C("div",Np,[t("div",Gp,[e(y(bt)),l[13]||(l[13]=_(" 备用地址",-1))]),e(f,{content:u.remoteAddressBackup,placement:"top","show-arrow":"","destroy-on-close":""},{default:a(()=>[t("div",{class:"value remote-addr pointer",onClick:m=>y(Xt)(u.remoteAddressBackup,!0,"备用连接地址已复制！")},M(u.remoteAddressBackup),9,Hp)]),_:2},1032,["content"])])):O("",!0),t("div",Jp,[t("div",Wp,[e(y(St)),l[14]||(l[14]=_(" 本地地址",-1))]),t("div",Xp,M(u.localAddress),1)])]))),128)):(r(),C("div",Qp,[l[15]||(l[15]=t("div",{class:"label"},"状态",-1)),t("div",Yp,M(s.loading?"正在加载配置...":"暂无详细信息"),1)]))])]),_:1})])}}}),ev=oe(Zp,[["__scopeId","data-v-3a2669c8"]]),tv={class:"editor-container"},av={class:"editor-status-bar"},sv={class:"mode-tag"},nv={class:"dialog-footer"},lv={class:"footer-left"},ov={class:"footer-right"},rv=ne({__name:"FileEditor",props:{visible:Boolean,fileName:String,content:String,loading:Boolean},emits:["update:visible","save"],setup(s,{emit:n}){const l=s,c=n,o=async()=>{if(!i.value)return;const k=l.fileName?.split(".").pop()?.toLowerCase();let I="",g=[];switch(k){case"json":I="json",g=[Ha,Ja];break;case"yml":case"yaml":I="yaml",g=[al];break;case"js":case"ts":I="babel",g=[Ha,Ja];break;case"css":case"less":case"scss":I="css",g=[tl];break;case"html":case"xml":I="html",g=[el];break;default:P.warning("该文件类型暂不支持自动格式化");return}try{const V=await Zn.format(i.value,{parser:I,plugins:g,tabWidth:2,printWidth:80,semi:!0,singleQuote:!0});i.value=V,P.success("格式化成功")}catch(V){console.error(V),P.error(`格式化失败: 请检查语法错误
${V.message.split(`
`)[0]}`)}},i=w(""),f=w(!1);let u=null;const d=()=>{const k=document.documentElement.getAttribute("theme-mode");f.value=k==="dark"};ke(()=>{d(),u=new MutationObserver(d),u.observe(document.documentElement,{attributes:!0,attributeFilter:["theme-mode"]})}),Je(()=>{u?.disconnect()}),be(()=>l.content,k=>{i.value=k||""},{immediate:!0});const m=te(()=>{const k=[];switch(f.value&&k.push(qn),k.push(Nn.phrases.of({Find:"查找内容...",Replace:"替换为...",next:"下一个",previous:"上一个",all:"选中所有","match case":"区分大小写","by word":"全字匹配",regexp:"正则表达式",replace:"替换","replace all":"替换全部",close:"关闭"})),l.fileName?.split(".").pop()?.toLowerCase()){case"json":k.push(Yn());break;case"yml":case"yaml":k.push(Qn());break;case"js":case"ts":k.push(Xn());break;case"css":case"less":case"scss":k.push(Wn());break;case"html":case"xml":k.push(Jn());break;case"toml":case"ini":case"conf":k.push(Gn.define(Hn));break}return k}),b=()=>{c("update:visible",!1)},S=()=>{c("save",i.value)};return(k,I)=>{const g=v("t-button"),V=v("t-dialog");return r(),j(V,{visible:s.visible,header:`正在编辑: ${s.fileName}`,width:"90%",attach:"body",top:"1vh",class:"editor-dialog",onClose:b},{footer:a(()=>[t("div",nv,[t("div",lv,[e(g,{variant:"outline",theme:"default",onClick:o},{default:a(()=>[...I[1]||(I[1]=[_(" 自动格式化 ",-1)])]),_:1})]),t("div",ov,[e(g,{variant:"outline",onClick:b},{default:a(()=>[...I[2]||(I[2]=[_("取消",-1)])]),_:1}),e(g,{theme:"primary",loading:l.loading,onClick:S},{default:a(()=>[...I[3]||(I[3]=[_(" 保存 ",-1)])]),_:1},8,["loading"])])])]),default:a(()=>[t("div",tv,[e(y(rn),{modelValue:i.value,"onUpdate:modelValue":I[0]||(I[0]=E=>i.value=E),placeholder:"文件内容为空...",style:{height:"70vh",fontSize:"14px"},autofocus:!0,"indent-with-tab":!0,"tab-size":2,extensions:m.value},null,8,["modelValue","extensions"])]),t("div",av,[t("span",null,"行数: "+M(i.value.split(`
`).length),1),t("span",null,"长度: "+M(i.value.length),1),t("span",sv,M(f.value?"Dark Mode":"Light Mode"),1)])]),_:1},8,["visible","header"])}}}),Os=oe(rv,[["__scopeId","data-v-8c0385d1"]]),iv={class:"console-page"},uv={class:"layout-container"},dv={class:"main-terminal-area"},cv={class:"sidebar-area"},mv=ne({__name:"index",setup(s){const n=Oa(),l=Qe(),c=w(parseInt(l.params.frpId)||0),o=w(!1),i=w(!1),f=w(null),u=w(!1),d=w(""),m=w(""),b=w(!1),S=w(null);async function k(){if(c.value)try{f.value=await $c(c.value),o.value=f.value.isRunning,await n.getTunnels()}catch(A){console.error("获取隧道信息失败",A),S.value?.writeln(`\x1B[1;31m[Error] 获取隧道信息失败: ${A}\x1B[0m`)}}const I=async()=>{i.value=!0;try{S.value?.writeln("\x1B[1;32m[System] 正在发送启动指令...\x1B[0m"),await is("start",c.value),o.value=!0,P.success("启动指令已发送"),setTimeout(k,1500),S.value?.writeln("\x1B[1;35m\x1B[1m[TIPS] 注意：日志可能包含您的在线服务商的Token信息，若需要截图，请将关键信息打码处理！\x1B[0m")}catch(A){S.value?.writeln(`\x1B[1;31m[Error] Frpc启动失败: ${A.message}\x1B[0m`)}finally{i.value=!1}},g=async()=>{i.value=!0;try{S.value?.writeln("\x1B[1;32m[System] 正在发送停止指令...\x1B[0m"),await is("stop",c.value),o.value=!1,P.warning("停止指令已发送"),setTimeout(k,1e3)}catch(A){S.value?.writeln(`\x1B[1;31m[Error] Frpc停止失败: ${A.message}\x1B[0m`)}finally{i.value=!1}},V=()=>{S.value?.clear()},E=()=>{const A=tt.confirm({header:"警告",body:`直接编辑配置文件可能会导致服务无法启动或异常。正常情况在线服务商提供的配置文件也不能修改。请确保您了解配置文件的格式和内容。

是否继续？`,theme:"warning",onConfirm:async()=>{A.hide(),await B()}})},B=async()=>{const A=P.loading("正在读取配置文件...");try{let h="toml";const F=n.frpList.find(G=>G.id===c.value);F&&F.configType&&(h=F.configType.toLowerCase());const T=`frpc.${h}`,x=`${c.value}/${T}`,N=await ra(0,x);d.value=T,m.value=N,u.value=!0,P.close(A)}catch(h){P.close(A),P.error("读取配置文件失败: "+h.message),S.value?.writeln(`\x1B[1;31m[Error] 读取配置文件失败: ${h.message}\x1B[0m`)}},p=async A=>{b.value=!0;try{const h=`${c.value}/${d.value}`;await Ea(0,h,A),P.success("配置文件保存成功"),u.value=!1,S.value?.writeln("\x1B[1;32m[System] 配置文件已更新，请重启服务以生效。\x1B[0m")}catch(h){P.error("保存失败"),S.value?.writeln(`\x1B[1;31m[Error] 保存失败: ${h.message}\x1B[0m`)}finally{b.value=!1}};return be(()=>l.params.frpId,async A=>{l.name==="FrpConsole"&&A&&(c.value=parseInt(A),await k())}),ke(()=>{c.value&&k()}),(A,h)=>(r(),C("div",iv,[t("div",uv,[t("div",dv,[e(Cp,{ref_key:"terminalRef",ref:S,"frp-id":c.value,onUpdate:h[0]||(h[0]=F=>k())},null,8,["frp-id"])]),t("div",cv,[e(ev,{"frp-id":c.value,"is-running":o.value,loading:i.value,"tunnel-info":f.value,onStart:I,onStop:g,onClearLog:V,onEditConfig:E},null,8,["frp-id","is-running","loading","tunnel-info"])])]),e(Os,{visible:u.value,"onUpdate:visible":h[1]||(h[1]=F=>u.value=F),"file-name":d.value,content:m.value,loading:b.value,onSave:p},null,8,["visible","file-name","content","loading"])]))}}),pv=oe(mv,[["__scopeId","data-v-d01d4c2c"]]),vv=Object.freeze(Object.defineProperty({__proto__:null,default:pv},Symbol.toStringTag,{value:"Module"})),qa=gt("instanceHub",()=>{const s=Fe(),n=w(null),l=w(!1),c=w(null),o=w(0),i=w(0);let f=Promise.resolve();const u=w({cpu:0,memBytes:0,memPercent:0}),d=new Set,m=new Set,b=new Set,S=A=>{i.value=A},k=A=>(f=f.then(async()=>{if(o.value++,n.value?.state==="Connected"&&c.value===A)return;n.value&&await g(),c.value=A,i.value=0;const{baseUrl:h,token:F}=s,T=new URL("/api/hubs/instanceControlHub",h||window.location.origin);F&&T.searchParams.append("x-user-token",F);const x=new wt().withUrl(T.toString(),{withCredentials:!1}).configureLogging(Mt.Warning).withAutomaticReconnect([0,2e3,5e3,1e4]).build();x.on("ReceiveLog",N=>{d.forEach(G=>G(N))}),x.on("RequireEULA",()=>{m.forEach(N=>N())}),x.on("CommandResult",(N,G)=>{b.forEach(R=>R(N,G))}),x.on("ReceiveStatus",(N,G,R)=>{if(String(N)!==String(A))return;let $=0;if(i.value>0){const L=i.value*1024*1024;$=R/L*100,$>100&&($=100)}u.value={cpu:G,memBytes:R,memPercent:$}}),x.onreconnecting(()=>d.forEach(N=>N("\x1B[1;31m[System] 连接中断，尝试重连...\x1B[0m"))),x.onreconnected(async()=>{d.forEach(N=>N("\x1B[1;32m[System] 网络恢复，重新加入会话...\x1B[0m"));try{await x.invoke("JoinGroup",A)}catch(N){console.error(N)}});try{await x.start(),await x.invoke("JoinGroup",A),n.value=x,l.value=!0,d.forEach(N=>N("\x1B[1;32m[System] 已连接到实例控制服务\x1B[0m"))}catch(N){l.value=!1,d.forEach(G=>G(`\x1B[1;31m[Error] 连接失败: ${N.message}\x1B[0m`)),c.value=null,n.value=null}}),f),I=()=>(f=f.then(async()=>{o.value>0&&o.value--,o.value===0&&await g()}),f),g=async()=>{if(n.value)try{n.value.state==="Connected"&&c.value&&await n.value.invoke("LeaveGroup",c.value),await n.value.stop()}catch(A){console.warn(A)}n.value=null,l.value=!1,c.value=null,i.value=0,u.value={cpu:0,memBytes:0,memPercent:0}};return{isConnected:l,stats:u,currentServerId:c,connect:k,disconnect:I,setMaxMemory:S,sendCommand:async A=>{if(!n.value||n.value.state!=="Connected"||!c.value)throw new Error("未连接到服务");await n.value.invoke("SendCommand",c.value,A)},onLog:A=>(d.add(A),()=>d.delete(A)),onEula:A=>(m.add(A),()=>d.delete(A)),onCommandResult:A=>(b.add(A),()=>b.delete(A))}}),fv=ia();ue.enabled=!0;const gv=(s,n=-1)=>s?(n===-1&&(n=fv.settings.webPanelColorizeLogLevel),n===0?s:(s=s.replace(/\n/g,`\r
`),s.includes("Done")&&s.includes("!")&&(s=s.replace(/Done \((.*?)\)!/g,(l,c)=>`${ue.green.bold("Done")} (${ue.blue(c)})!`)),s.startsWith("[System]")&&(s=s.replace(/^\[System]/,`[${ue.blue.bold("System")}]`)),s.includes("[MSLX]")&&(s=s.replace(/\[MSLX]/g,`[${ue.magenta.bold("MSLX")}]`)),s.includes("[MSLX-Backup]")&&(s=s.replace(/\[MSLX-Backup]/g,`[${ue.magenta.bold("MSLX-Backup")}]`)),s.includes("[MSLX-Daemon]")&&(s=s.replace(/\[MSLX-Daemon]/g,`[${ue.magenta.bold("MSLX-Daemon")}]`)),s.startsWith(">>>")&&(s=s.replace(/^>>>/,ue.red.bold(">>>"))),n===1?(s=s.replace(/^\[\d{2}:\d{2}:\d{2}\s+(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]/,(l,c)=>{switch(c){case"INFO":return ue.green(l);case"WARN":case"WARNING":return ue.yellow(l);case"ERROR":case"FATAL":return ue.red(l);case"DEBUG":return ue.blue(l);default:return l}}),s=s.replace(/^\[\d{2}:\d{2}:\d{2}\]\s+\[[^/]+\/(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]/,(l,c)=>{switch(c){case"INFO":return ue.green(l);case"WARN":case"WARNING":return ue.yellow(l);case"ERROR":case"FATAL":return ue.red(l);default:return l}}),s=s.replace(new RegExp("(?<=:\\s|^)\\s*([([][a-zA-Z0-9_\\-.\\s]+[)\\]])(?=\\s)","g"),l=>ue.cyan(l)),s):(s=s.replace(/^\[(\d{2}:\d{2}:\d{2})\s+(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]:/,(l,c,o)=>{let i=o;switch(o){case"INFO":i=ue.green("INFO");break;case"WARN":case"WARNING":i=ue.magenta.bold("WARN");break;case"ERROR":case"FATAL":i=ue.red.bold(o);break;case"DEBUG":i=ue.blue("DEBUG");break}return`[${ue.gray(c)} ${i}]:`}),/^\[\d{2}:\d{2}:\d{2}\]/.test(s)&&(s=s.replace(/^\[(\d{2}:\d{2}:\d{2})\]/,(l,c)=>`[${ue.gray(c)}]`)),s=s.replace(/\[([^/]+)\/(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]/g,(l,c,o)=>{const i=ue.blue(c);let f=o;switch(o){case"INFO":f=ue.green("INFO");break;case"WARN":f=ue.magenta("WARN");break;case"ERROR":f=ue.red.bold("ERROR");break}return`[${i}/${f}]`}),s=s.replace(new RegExp("(?<=:\\s|^)\\s*\\[([a-zA-Z0-9_\\-.\\s]+)\\](?=\\s)","g"),(l,c)=>c==="System"||c.includes("MSLX")?l:` [${ue.bold.black(c)}]`),s=s.replace(/(https?:\/\/[^\s]+)/g,l=>ue.blue.underline(l)),s=s.replace(new RegExp("\\b\\d+\\.\\d+[\\w.+\\-@]*(?<!ms|s|MB|GB|KB|%)\\b","g"),l=>ue.magenta(l)),s=s.replace(/\b\d+(\.\d+)?\s?(ms|s|%|MB|GB|KB)\b/gi,l=>ue.blue(l)),s=s.replace(new RegExp("(\\u001b\\[[\\d;]*m)|((?<!\\d:\\d)(?<![.\\-+])\\b\\d+\\b(?![.\\-+])(?!\\s*:\\s*\\d))","g"),(l,c,o)=>{if(c)return l;if(o){if(o.length>=4&&o.length<=6)return ue.blue(o);if(o.length<=3)return ue.blue(o)}return l}),s=s.replace(/(\*:\d{1,5})/,l=>ue.blue.bold(l)),s=s.replace(/\b(Loaded|Saved|Starting|Started|Connected)\b/g,l=>ue.green(l)),s=s.replace(/\bDone\b(?!\u001b)/g,ue.green.bold("Done")),s=s.replace(/\b(Failed|Exception|Error|Caused by|Stopping|Closed)\b/g,l=>ue.red.bold(l)),s=s.replace(/\b(Loading|Preparing|Generating|Saving|Using|Running)\b/g,l=>ue.magenta(l)),s=s.replace(/\b(Minecraft|Paper|Velocity|Java)\b/gi,l=>ue.bold.black(l)),s=s.replace(/'minecraft:[a-z_]+'/g,l=>ue.magenta(l)),s))):"",_v={class:"terminal-header"},hv={class:"tab-title"},yv={class:"terminal-footer"},bv=ne({__name:"ServerTerminal",props:{serverId:{}},emits:["update"],setup(s,{expose:n,emit:l}){const c=s,o=l,i=qa(),f=w(null),u=w(null);let d=null,m=null,b=null,S=null,k=null,I=null,g="";const V=w(""),E={dark:{background:"transparent",foreground:"#cccccc",cursor:"#cccccc",selectionBackground:"#264f78",black:"#000000",red:"#cd3131",green:"#0dbc79",yellow:"#e5e510",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"},light:{background:"transparent",foreground:"#333333",cursor:"#333333",selectionBackground:"#add6ff",black:"#000000",red:"#cd3131",green:"#00bc79",yellow:"#9d9d10",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"}};ue.enabled=!0;const B=L=>gv(L),p=()=>{if(!u.value||!f.value)return;if(d){d.clear(),x();return}const L=document.documentElement.getAttribute("theme-mode")==="dark";d=new Us({cursorBlink:!1,cursorStyle:"bar",fontSize:14,fontFamily:'"Maple Mono", "Maple Mono CN", "Cascadia Code", Consolas, Menlo, "PingFang SC", "Microsoft YaHei", monospace',lineHeight:1.4,theme:L?E.dark:E.light,allowTransparency:!0,disableStdin:!0,convertEol:!0}),m=new Bs,d.loadAddon(m),d.open(u.value),d.onData(Z=>A(Z));const U=()=>{if(u.value&&u.value.clientWidth>0&&u.value.clientHeight>0)try{m?.fit()}catch(Z){console.warn(Z)}};b=new ResizeObserver(()=>window.requestAnimationFrame(U)),b.observe(f.value),setTimeout(U,100),x()},A=async L=>{!d||!c.serverId||(L==="\r"?(d.write(`\r
`),g.trim()&&await F(g),g=""):L===""?g.length>0&&(g=g.slice(0,-1),d.write("\b \b")):L>=" "&&(g+=L,d.write(L)))},h=async()=>{if(!V.value)return;const L=V.value;d?.writeln(L),await F(L),V.value=""},F=async L=>{try{await i.sendCommand(L)}catch(U){d?.writeln(`\x1B[1;31m[Error] ${U.message}\x1B[0m`)}},T=()=>{if(!d)return;const L=document.documentElement.getAttribute("theme-mode")==="dark";d.options.theme=L?E.dark:E.light},x=()=>{d?.writeln("\x1B[1;34m[System]\x1B[0m 正在连接服务器控制台 ..."),d?.writeln(`\x1B[1;34m[System]\x1B[0m 实例 ID: ${c.serverId}`),d?.writeln("")},N=async()=>{c.serverId&&(k&&k(),k=i.onLog(L=>{d&&d.writeln(B(L)),L.startsWith("[MSLX]")&&o("update")}),I&&I(),I=i.onCommandResult((L,U)=>{L||d?.writeln(`\x1B[1;31m[System] 指令执行反馈: ${U}\x1B[0m`)}),await i.connect(c.serverId))},G=async()=>{k&&k(),I&&I(),await i.disconnect()};return n({writeln:L=>d?.writeln(L),clear:()=>{d?.clear(),x()}}),be(()=>c.serverId,async(L,U)=>{L!==U&&(await G(),p(),await N())}),ke(async()=>{await vt(),p(),S=new MutationObserver(T),S.observe(document.documentElement,{attributes:!0,attributeFilter:["theme-mode"]}),await N()}),Je(async()=>{S?.disconnect(),b?.disconnect(),d?.dispose(),await G()}),(L,U)=>(r(),C("div",{ref_key:"terminalWrapper",ref:f,class:"terminal-wrapper"},[t("div",_v,[U[1]||(U[1]=t("div",{class:"dots"},[t("span",{class:"dot red"}),t("span",{class:"dot yellow"}),t("span",{class:"dot green"})],-1)),t("div",hv,"MSLX 服务端控制台 | #"+M(s.serverId),1)]),t("div",{ref_key:"terminalBody",ref:u,class:"terminal-body"},null,512),t("div",yv,[Xe(t("input",{"onUpdate:modelValue":U[0]||(U[0]=Z=>V.value=Z),class:"cmd-input",placeholder:"发送控制台指令...",onKeyup:un(h,["enter"])},null,544),[[bs,V.value]]),t("button",{class:"send-btn",onClick:h},"发送")])],512))}}),wv=oe(bv,[["__scopeId","data-v-1187dfc3"]]),kv={class:"settings-container"},$v={class:"setting-item"},Av={class:"setting-control"},xv={class:"setting-item"},Cv={class:"setting-info"},Sv={class:"desc"},Iv={class:"setting-control"},Vv={class:"setting-item"},Mv={class:"setting-control"},Lv={key:0,style:{"margin-top":"8px"}},Uv={class:"setting-item"},Bv={class:"setting-info"},Rv={class:"title"},Ev={class:"desc"},Pv={class:"setting-control"},zv={class:"setting-item"},Fv={class:"setting-control"},Tv={key:0,class:"core-tools-panel"},Dv={key:0,class:"upload-progress"},Ov={class:"setting-item"},jv={class:"setting-control flex-row"},Kv={class:"memory-input-group"},qv={class:"memory-input-group"},Nv={class:"setting-item"},Gv={class:"setting-control flex-row"},Hv={class:"setting-info-desc-only"},Jv={style:{"font-size":"12px",color:"var(--td-text-color-placeholder)",cursor:"help"}},Wv={class:"setting-item"},Xv={class:"setting-control"},Qv={key:0,style:{"margin-top":"8px"}},Yv={key:2,class:"setting-group-title"},Zv={key:3,class:"setting-item"},e1={class:"setting-control"},t1={key:0,style:{"margin-top":"8px"}},a1={class:"setting-item"},s1={class:"setting-control"},n1={class:"setting-item"},l1={class:"setting-control"},o1={key:4,class:"setting-item"},r1={class:"setting-control"},i1={class:"setting-item"},u1={class:"setting-control"},d1={class:"setting-item"},c1={class:"setting-control"},m1={class:"setting-item"},p1={class:"setting-control"},v1={key:5,class:"setting-item"},f1={class:"setting-control"},g1={class:"setting-item"},_1={class:"setting-control flex-row"},h1={class:"setting-item"},y1={class:"setting-control flex-row"},b1={class:"form-actions"},w1={class:"progress-body"},k1={id:"update-log-box",class:"log-box"},$1={class:"time"},A1={key:0,class:"dialog-actions"},x1=ne({__name:"GeneralSettings",setup(s){const n=Qe(),l=Fe(),c=te(()=>{const se=n.params.serverId;return se?parseInt(se):NaN}),o=w(null),i=w(!1),f=w(!1),u=w(!1),d=[{label:"UTF-8",value:"utf-8"},{label:"GBK",value:"gbk"}],m=w({id:c.value,name:"",base:"",java:"",core:"",minM:1024,maxM:4096,args:"",yggdrasilApiAddr:"",backupMaxCount:20,backupDelay:10,backupPath:"MSLX://Backup/Instance",autoRestart:!1,forceAutoRestart:!0,ignoreEula:!1,runOnStartup:!1,inputEncoding:"utf-8",outputEncoding:"utf-8",fileEncoding:"utf-8",coreUrl:"",coreSha256:"",coreFileKey:""}),b=w("MB"),S=w("MB"),k=[{label:"MB",value:"MB"},{label:"GB",value:"GB"}],I=te({get:()=>{if(b.value==="GB"){const se=m.value.minM/1024;return Math.round(se*100)/100}return m.value.minM},set:se=>{m.value.minM=b.value==="GB"?Math.round(se*1024):se}}),g=te({get:()=>{if(S.value==="GB"){const se=m.value.maxM/1024;return Math.round(se*100)/100}return m.value.maxM},set:se=>{m.value.maxM=S.value==="GB"?Math.round(se*1024):se}}),V=w("custom"),E=w([]),B=w([]),p=w(""),A=w(""),h=async(se=!1)=>{try{se&&P.info("正在扫描 Java 环境...");const z=await Ta(l.userInfo.systemInfo.osType.toLowerCase().replace("os",""),l.userInfo.systemInfo.osArchitecture.toLowerCase());z&&Array.isArray(z)&&(E.value=z.map(ae=>({label:`Java ${ae} (在线)`,value:ae})));const K=await Da(se);B.value=K.map(ae=>({label:`Java ${ae.version} (${ae.path})`,value:ae.path})),se&&P.success("刷新成功")}catch(z){console.error(z)}};be([V,p,A],([se,z,K])=>{se==="none"?m.value.java="none":se==="env"?m.value.java="java":se==="custom"||se==="local"?m.value.java=K:se==="online"&&(m.value.java=z?`MSLX://Java/${z}`:"")});const F=w("MSLX://Backup/Instance"),T=w("");be([F,T],([se,z])=>{se==="custom"?m.value.backupPath=z:m.value.backupPath=se});const x=w(""),N=w(""),G=[{label:"官方/离线模式 (无)",value:"none"},{label:"MSL 统一身份验证 (MSL Skin)",value:"https://skin.mslmc.net/api/yggdrasil"},{label:"LittleSkin",value:"https://littleskin.cn/api/yggdrasil"},{label:"自定义服务器",value:"custom"}];be([x,N],([se,z])=>{se==="none"?m.value.yggdrasilApiAddr="":se==="custom"?m.value.yggdrasilApiAddr=z:m.value.yggdrasilApiAddr=se});const R=w(!1),$=w(!1),L=w(null),U=w(!1),Z=w(0),W=w(""),J=se=>{m.value.core=se.filename,m.value.coreUrl=se.url,m.value.coreSha256=se.sha256,m.value.coreFileKey="",R.value=!1,P.success(`已选择核心: ${se.filename}，保存后将自动下载`)},H=()=>L.value?.click(),he=async se=>{const z=se.target;if(!z.files?.length)return;const K=z.files[0];if(m.value.coreFileKey)try{await ht(m.value.coreFileKey)}catch{console.error("删除上传失败")}W.value=K.name,U.value=!0,Z.value=0;try{const me=(await qt()).uploadId,ee=5*1024*1024,D=Math.ceil(K.size/ee);for(let ce=0;ce<D;ce++){const $e=K.slice(ce*ee,Math.min(K.size,(ce+1)*ee));await Nt(me,ce,$e),Z.value=Math.floor((ce+1)/D*100)}const ie=await Gt(me,D);m.value.coreFileKey=ie.uploadId,m.value.core=K.name,m.value.coreUrl="",P.success("文件上传就绪，保存后生效"),R.value=!1}catch(ae){P.error(`上传失败: ${ae.message}`)}finally{U.value=!1,z.value=""}},Te=()=>{u.value||As.warning({title:"风险操作",content:"修改实例路径会导致面板无法找到原有文件。请确保您已手动移动了文件，或您明确知道自己在做什么。",duration:5e3}),u.value=!u.value},ge=w(!1),Re=w(0),Ue=w([]),Ee=w(null),Be=te(()=>V.value==="none"?{name:[{required:!0,message:"服务器名称不能为空",trigger:"blur"}],base:[{required:!0,message:"基础路径不能为空",trigger:"blur"}],args:[{required:!0,message:"自定义模式必须填写启动命令",trigger:"blur"}]}:{name:[{required:!0,message:"服务器名称不能为空",trigger:"blur"}],base:[{required:!0,message:"基础路径不能为空",trigger:"blur"}],java:[{required:!0,message:"Java 环境不能为空",trigger:"change"}],core:[{required:!0,message:"核心文件名不能为空",trigger:"change"}],minM:[{required:!0,message:"必填",trigger:"blur"}],maxM:[{required:!0,message:"必填",trigger:"blur"}]}),je=async()=>{if(c.value){i.value=!0;try{await h(),m.value.id=c.value;const se=await zr(c.value);if(m.value={...m.value,...se,coreUrl:"",coreFileKey:"",coreSha256:""},b.value=se.minM>0&&se.minM%1024===0?"GB":"MB",S.value=se.maxM>0&&se.maxM%1024===0?"GB":"MB",u.value=!1,se.java==="none")V.value="none";else if(se.java==="java")V.value="env";else if(se.java.startsWith("MSLX://Java/"))V.value="online",p.value=se.java.replace("MSLX://Java/","");else{const ae=B.value.find(me=>me.value===se.java);V.value=ae?"local":"custom",A.value=se.java}const z=se.backupPath;z==="MSLX://Backup/Instance"||z==="MSLX://Backup/Data"?F.value=z:(F.value="custom",T.value=z);const K=se.yggdrasilApiAddr;K?K==="https://skin.mslmc.net/api/yggdrasil"?x.value="https://skin.mslmc.net/api/yggdrasil":K==="https://littleskin.cn/api/yggdrasil"?x.value="https://littleskin.cn/api/yggdrasil":(x.value="custom",N.value=K):x.value="none"}catch(se){P.error("获取配置失败: "+se.message)}finally{i.value=!1}}};be(()=>n.params.serverId,se=>{n.name==="InstanceConsole"&&se&&je()}),ke(je);const re=async()=>{if(await o.value?.validate()===!0&&!(V.value!=="none"&&(m.value.coreUrl||m.value.coreFileKey)&&!await new Promise(ae=>{const me=tt.confirm({header:"确认变更核心文件?",body:"检测到您上传或选择了新的核心文件，这将覆盖服务器现有的部署。",theme:"warning",onConfirm:()=>{me.hide(),ae(!0)},onClose:()=>{me.hide(),ae(!1)}})}))){V.value==="none"&&(m.value.core="none",m.value.minM=1027,m.value.maxM=1102,m.value.java="none",m.value.coreUrl="",m.value.coreFileKey="",m.value.coreSha256=""),f.value=!0;try{const z=await Fr(m.value);z.data?.needListen??z.needListen?Se():(P.success("配置已保存"),f.value=!1,je())}catch(z){P.error(z.message||"保存失败"),f.value=!1}}},Se=async()=>{ge.value=!0,Re.value=0,Ue.value=[];const{baseUrl:se,token:z}=l,K=new URL("/api/hubs/updateProgressHub",se||window.location.origin);K.searchParams.append("x-user-token",z),Ee.value=new wt().withUrl(K.toString(),{withCredentials:!1}).configureLogging(Mt.None).build(),Ee.value.on("UpdateStatus",(ae,me,ee)=>{Ue.value.push({time:new Date().toLocaleTimeString(),msg:ee?`[错误] ${ae}`:ae}),vt(()=>{const D=document.getElementById("update-log-box");D&&(D.scrollTop=D.scrollHeight)}),me>=0&&(Re.value=Number(me.toFixed(1))),me===100&&(P.success("更新完成"),De(!0))});try{await Ee.value.start(),await Ee.value.invoke("JoinGroup",c.value.toString())}catch{Ue.value.push({time:"-",msg:"连接失败"})}},De=(se=!1)=>{Ee.value?.stop(),setTimeout(()=>{ge.value=!1,f.value=!1,se&&je()},1e3)};return Je(()=>{Ee.value?.stop()}),(se,z)=>{const K=v("t-input"),ae=v("t-button"),me=v("t-tooltip"),ee=v("t-select"),D=v("t-textarea"),ie=v("t-alert"),ce=v("t-icon"),$e=v("t-col"),ve=v("t-row"),fe=v("t-progress"),Ce=v("t-space"),xe=v("t-input-number"),Ie=v("t-switch"),Oe=v("t-form"),Ke=v("t-loading"),qe=v("t-dialog");return r(),C("div",kv,[e(Ke,{loading:i.value,"show-overlay":""},{default:a(()=>[e(Oe,{ref_key:"formRef",ref:o,data:m.value,rules:Be.value,"label-width":"0",onSubmit:re},{default:a(()=>[z[59]||(z[59]=t("div",{class:"setting-group-title"},"基础设置",-1)),t("div",$v,[z[33]||(z[33]=t("div",{class:"setting-info"},[t("div",{class:"title"},"服务器名称"),t("div",{class:"desc"},"在面板列表中显示的别名，支持中文")],-1)),t("div",Av,[e(K,{modelValue:m.value.name,"onUpdate:modelValue":z[0]||(z[0]=Y=>m.value.name=Y),placeholder:"请输入名称"},null,8,["modelValue"])])]),t("div",xv,[t("div",Cv,[z[34]||(z[34]=t("div",{class:"title"},"实例路径",-1)),t("div",Sv,[t("span",{class:we({"text-warning":u.value})},M(u.value?"警告：修改路径可能导致无法找到原文件":"服务器文件的物理存储路径，非必要请勿修改"),3)])]),t("div",Iv,[e(K,{modelValue:m.value.base,"onUpdate:modelValue":z[1]||(z[1]=Y=>m.value.base=Y),disabled:!u.value},{suffix:a(()=>[e(me,{content:u.value?"点击锁定":"点击解锁编辑 (慎重)"},{default:a(()=>[e(ae,{variant:"text",shape:"square",onClick:Te},{icon:a(()=>[u.value?(r(),j(y(dn),{key:0,style:{color:"var(--td-warning-color)"}})):(r(),j(y(oa),{key:1}))]),_:1})]),_:1},8,["content"])]),_:1},8,["modelValue","disabled"])])]),z[60]||(z[60]=t("div",{class:"setting-group-title"},"运行模式",-1)),t("div",Vv,[z[35]||(z[35]=t("div",{class:"setting-info"},[t("div",{class:"title"},"启动方式"),t("div",{class:"desc"},"选择使用 Java 启动 Minecraft，或使用自定义命令启动其他程序 (如 Bedrock, Python 等)")],-1)),t("div",Mv,[e(ee,{modelValue:V.value,"onUpdate:modelValue":z[2]||(z[2]=Y=>V.value=Y),options:[{label:"MSLX 在线下载 (Java)",value:"online"},{label:"使用本地版本 (Java)",value:"local"},{label:"自定义路径 (Java)",value:"custom"},{label:"环境变量 (Java)",value:"env"},{label:"自定义命令 (无Java)",value:"none"}]},null,8,["modelValue"]),V.value!=="none"?(r(),C("div",Lv,[V.value==="online"?(r(),j(ee,{key:0,modelValue:p.value,"onUpdate:modelValue":z[3]||(z[3]=Y=>p.value=Y),options:E.value,placeholder:"请选择版本",filterable:""},null,8,["modelValue","options"])):O("",!0),V.value==="local"?(r(),j(ee,{key:1,modelValue:A.value,"onUpdate:modelValue":z[4]||(z[4]=Y=>A.value=Y),options:B.value,placeholder:"选择已识别的 Java"},null,8,["modelValue","options"])):O("",!0),V.value==="custom"?(r(),j(K,{key:2,modelValue:A.value,"onUpdate:modelValue":z[5]||(z[5]=Y=>A.value=Y),placeholder:"输入 java 可执行文件完整路径"},null,8,["modelValue"])):O("",!0)])):O("",!0)])]),t("div",Uv,[t("div",Bv,[t("div",Rv,M(V.value==="none"?"启动命令 (Command)":"启动参数 (JVM Args)"),1),t("div",Ev,M(V.value==="none"?"完全自定义的启动命令。程序将直接执行此段内容，不依赖 Java 环境。":"传递给 Java 的启动参数，如 GC 策略 (例如 -XX:+UseG1GC)"),1)]),t("div",Pv,[e(D,{modelValue:m.value.args,"onUpdate:modelValue":z[6]||(z[6]=Y=>m.value.args=Y),autosize:{minRows:2,maxRows:4},placeholder:V.value==="none"?"例如: ./bedrock_server_x64":"无特殊需求请留空"},null,8,["modelValue","placeholder"])])]),V.value!=="none"?(r(),C(pe,{key:0},[z[39]||(z[39]=t("div",{class:"setting-group-title"},"核心管理",-1)),t("div",zv,[z[38]||(z[38]=t("div",{class:"setting-info"},[t("div",{class:"title"},"服务端核心文件"),t("div",{class:"desc"},[_(" 指定启动的 Jar 文件名。如果文件已存在于目录中，直接输入文件名即可。 "),t("br"),_("需要更新核心？点击下方“文件工具” ")])],-1)),t("div",Fv,[e(K,{modelValue:m.value.core,"onUpdate:modelValue":z[8]||(z[8]=Y=>m.value.core=Y),placeholder:"例如 server.jar"},{suffix:a(()=>[e(ae,{variant:"text",theme:"primary",size:"small",onClick:z[7]||(z[7]=Y=>R.value=!R.value)},{default:a(()=>[_(M(R.value?"收起工具":"文件工具"),1)]),_:1})]),_:1},8,["modelValue"]),R.value?(r(),C("div",Tv,[e(Ce,{direction:"vertical",style:{width:"100%"}},{default:a(()=>[e(ie,{theme:"info",message:"在此处操作会自动下载/上传文件，并填入上方的文件名。"}),e(ve,{gutter:12},{default:a(()=>[e($e,{span:6},{default:a(()=>[e(ae,{block:"",variant:"outline",onClick:z[9]||(z[9]=Y=>$.value=!0)},{icon:a(()=>[e(ce,{name:"cloud-download"})]),default:a(()=>[z[36]||(z[36]=_(" 从版本库下载 ",-1))]),_:1})]),_:1}),e($e,{span:6},{default:a(()=>[e(ae,{block:"",variant:"outline",loading:U.value,onClick:H},{icon:a(()=>[e(ce,{name:"upload"})]),default:a(()=>[z[37]||(z[37]=_(" 上传本地文件 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1}),t("input",{ref_key:"uploadInputRef",ref:L,type:"file",accept:".jar",hidden:"",onChange:he},null,544),U.value?(r(),C("div",Dv,[t("span",null,"正在上传: "+M(W.value),1),e(fe,{theme:"line",percentage:Z.value},null,8,["percentage"])])):O("",!0)]),_:1})])):O("",!0)])])],64)):O("",!0),V.value!=="none"?(r(),C(pe,{key:1},[z[42]||(z[42]=t("div",{class:"setting-group-title"},"资源限制",-1)),t("div",Ov,[z[41]||(z[41]=t("div",{class:"setting-info"},[t("div",{class:"title"},"内存分配"),t("div",{class:"desc"},"设置 Java 堆内存大小 (Xms / Xmx)")],-1)),t("div",jv,[t("div",Kv,[e(xe,{modelValue:I.value,"onUpdate:modelValue":z[10]||(z[10]=Y=>I.value=Y),min:0,"decimal-places":b.value==="GB"?1:0,placeholder:"Xms",theme:"normal",class:"input-left"},null,8,["modelValue","decimal-places"]),e(ee,{modelValue:b.value,"onUpdate:modelValue":z[11]||(z[11]=Y=>b.value=Y),options:k,clearable:!1,class:"select-right"},null,8,["modelValue"])]),z[40]||(z[40]=t("span",{class:"separator"},"-",-1)),t("div",qv,[e(xe,{modelValue:g.value,"onUpdate:modelValue":z[12]||(z[12]=Y=>g.value=Y),min:0,"decimal-places":S.value==="GB"?1:0,placeholder:"Xmx",theme:"normal",class:"input-left"},null,8,["modelValue","decimal-places"]),e(ee,{modelValue:S.value,"onUpdate:modelValue":z[13]||(z[13]=Y=>S.value=Y),options:k,clearable:!1,class:"select-right"},null,8,["modelValue"])])])])],64)):O("",!0),z[61]||(z[61]=t("div",{class:"setting-group-title"},"备份设置",-1)),t("div",Nv,[z[45]||(z[45]=t("div",{class:"setting-info"},[t("div",{class:"title"},"备份策略"),t("div",{class:"desc"},"设置自动备份保留的最大数量，以及触发备份的延迟时间")],-1)),t("div",Gv,[e(xe,{modelValue:m.value.backupMaxCount,"onUpdate:modelValue":z[14]||(z[14]=Y=>m.value.backupMaxCount=Y),min:1,max:100,placeholder:"保留份数",theme:"column",style:{width:"140px"},suffix:"份"},null,8,["modelValue"]),z[43]||(z[43]=t("span",{class:"separator"},"/",-1)),e(xe,{modelValue:m.value.backupDelay,"onUpdate:modelValue":z[15]||(z[15]=Y=>m.value.backupDelay=Y),min:0,placeholder:"延迟时间",theme:"column",style:{width:"140px"},suffix:"秒"},null,8,["modelValue"])]),t("div",Hv,[e(me,{content:"MSLX 向服务器发送 save-all 指令后，会等待指定的秒数，确保数据完全写入硬盘后再开始打包备份。"},{default:a(()=>[t("span",Jv,[e(ce,{name:"help-circle"}),z[44]||(z[44]=_(" 什么是延迟时间？ ",-1))])]),_:1})])]),t("div",Wv,[z[46]||(z[46]=t("div",{class:"setting-info"},[t("div",{class:"title"},"备份存放路径"),t("div",{class:"desc"},"选择备份文件存储的位置。推荐存储在实例文件夹外部以免误删。")],-1)),t("div",Xv,[e(ee,{modelValue:F.value,"onUpdate:modelValue":z[16]||(z[16]=Y=>F.value=Y),options:[{label:"实例文件夹内 (Instance)",value:"MSLX://Backup/Instance"},{label:"全局数据目录 (Data)",value:"MSLX://Backup/Data"},{label:"自定义绝对路径",value:"custom"}]},null,8,["modelValue"]),F.value==="custom"?(r(),C("div",Qv,[e(K,{modelValue:T.value,"onUpdate:modelValue":z[17]||(z[17]=Y=>T.value=Y),placeholder:"输入备份存放的绝对路径"},null,8,["modelValue"])])):O("",!0)])]),V.value!=="none"?(r(),C("div",Yv,"外置登录")):O("",!0),V.value!=="none"?(r(),C("div",Zv,[z[47]||(z[47]=t("div",{class:"setting-info"},[t("div",{class:"title"},"Yggdrasil API"),t("div",{class:"desc"},"选择认证服务器。留空则表示使用官方正版登录 (或离线模式)。")],-1)),t("div",e1,[e(ee,{modelValue:x.value,"onUpdate:modelValue":z[18]||(z[18]=Y=>x.value=Y),options:G},null,8,["modelValue"]),x.value==="custom"?(r(),C("div",t1,[e(K,{modelValue:N.value,"onUpdate:modelValue":z[19]||(z[19]=Y=>N.value=Y),placeholder:"输入 Authlib-Injector API 地址"},null,8,["modelValue"])])):O("",!0)])])):O("",!0),z[62]||(z[62]=t("div",{class:"setting-group-title"},"高级设置",-1)),t("div",a1,[z[48]||(z[48]=t("div",{class:"setting-info"},[t("div",{class:"title"},"停止服务器指令"),t("div",{class:"desc"}," 设置正常停止时所发送的指令，默认为stop "),t("div",{class:"desc"}," 设置为^c为发送Ctrl C (在部分环境可能无法发送成功) ")],-1)),t("div",s1,[e(K,{modelValue:m.value.stopCommand,"onUpdate:modelValue":z[20]||(z[20]=Y=>m.value.stopCommand=Y),placeholder:"请输入停止指令"},null,8,["modelValue"])])]),t("div",n1,[z[49]||(z[49]=t("div",{class:"setting-info"},[t("div",{class:"title"},"自动重启"),t("div",{class:"desc"},"当服务器崩溃或意外停止时尝试自动重启"),t("div",{class:"desc"},"熔断机制: 若5分钟内尝试重启次数达到 5 次，则停止尝试重启")],-1)),t("div",l1,[e(Ie,{modelValue:m.value.autoRestart,"onUpdate:modelValue":z[21]||(z[21]=Y=>m.value.autoRestart=Y),label:["已开启","已关闭"]},null,8,["modelValue"])])]),m.value.autoRestart?(r(),C("div",o1,[z[50]||(z[50]=t("div",{class:"setting-info"},[t("div",{class:"title"},"强制自动重启"),t("div",{class:"desc"},"开启此功能后，就算服务器是正常退出的也会强制重启(正常退出 => 退出代码 0)"),t("div",{class:"desc"},"不影响手动在面板关闭服务器")],-1)),t("div",r1,[e(Ie,{modelValue:m.value.forceAutoRestart,"onUpdate:modelValue":z[22]||(z[22]=Y=>m.value.forceAutoRestart=Y),label:["已开启","已关闭"]},null,8,["modelValue"])])])):O("",!0),t("div",i1,[z[51]||(z[51]=t("div",{class:"setting-info"},[t("div",{class:"title"},"关服强制结束时间"),t("div",{class:"desc"},"设置在发出Stop指令或关服请求后，等待多久后强制结束进程"),t("div",{class:"desc"},"可设置10 - 120 s")],-1)),t("div",u1,[e(xe,{modelValue:m.value.forceExitDelay,"onUpdate:modelValue":z[23]||(z[23]=Y=>m.value.forceExitDelay=Y)},null,8,["modelValue"])])]),t("div",d1,[z[52]||(z[52]=t("div",{class:"setting-info"},[t("div",{class:"title"},"忽略EULA提示"),t("div",{class:"desc"},"若您的实例并非MC服务器，可打开此选项")],-1)),t("div",c1,[e(Ie,{modelValue:m.value.ignoreEula,"onUpdate:modelValue":z[24]||(z[24]=Y=>m.value.ignoreEula=Y),label:["已开启","已关闭"]},null,8,["modelValue"])])]),t("div",m1,[z[53]||(z[53]=t("div",{class:"setting-info"},[t("div",{class:"title"},"随守护进程启动"),t("div",{class:"desc"},"当物理机开机/面板启动时，自动启动此实例")],-1)),t("div",p1,[e(Ie,{modelValue:m.value.runOnStartup,"onUpdate:modelValue":z[25]||(z[25]=Y=>m.value.runOnStartup=Y),label:["已开启","已关闭"]},null,8,["modelValue"])])]),V.value!=="none"?(r(),C("div",v1,[z[54]||(z[54]=t("div",{class:"setting-info"},[t("div",{class:"title"},"强制Java使用UTF8"),t("div",{class:"desc"},"此功能可以解决部分游戏内中文乱码的问题（特别是Windows系统上）"),t("div",{class:"desc"},[_("开启此功能后请务必将下面的"),t("b",null,"文件编码"),_("设置设置为"),t("b",null,"UTF-8")])],-1)),t("div",f1,[e(Ie,{modelValue:m.value.forceJvmUTF8,"onUpdate:modelValue":z[26]||(z[26]=Y=>m.value.forceJvmUTF8=Y),label:["已开启","已关闭"]},null,8,["modelValue"])])])):O("",!0),t("div",g1,[z[55]||(z[55]=t("div",{class:"setting-info"},[t("div",{class:"title"},"控制台编码"),t("div",{class:"desc"},"设置输入输出流的字符集，乱码时请尝试切换")],-1)),t("div",_1,[e(ee,{modelValue:m.value.inputEncoding,"onUpdate:modelValue":z[27]||(z[27]=Y=>m.value.inputEncoding=Y),options:d,label:"输入",style:{width:"140px"}},null,8,["modelValue"]),e(ee,{modelValue:m.value.outputEncoding,"onUpdate:modelValue":z[28]||(z[28]=Y=>m.value.outputEncoding=Y),options:d,label:"输出",style:{width:"140px"}},null,8,["modelValue"])])]),t("div",h1,[z[56]||(z[56]=t("div",{class:"setting-info"},[t("div",{class:"title"},"文件编码"),t("div",{class:"desc"},"设置文件编辑和保存时的编码格式，乱码时请尝试切换。(一般Windows是GBK，其他是UTF-8。)")],-1)),t("div",y1,[e(ee,{modelValue:m.value.fileEncoding,"onUpdate:modelValue":z[29]||(z[29]=Y=>m.value.fileEncoding=Y),options:d,style:{width:"140px"}},null,8,["modelValue"])])]),t("div",b1,[e(ae,{theme:"primary",type:"submit",size:"large",loading:f.value},{default:a(()=>[...z[57]||(z[57]=[_("保存设置",-1)])]),_:1},8,["loading"]),e(ae,{theme:"default",variant:"base",size:"large",onClick:je},{default:a(()=>[...z[58]||(z[58]=[_("重置更改",-1)])]),_:1})])]),_:1},8,["data","rules"])]),_:1},8,["loading"]),e(Fa,{visible:$.value,"onUpdate:visible":z[30]||(z[30]=Y=>$.value=Y),onConfirm:J},null,8,["visible"]),e(qe,{visible:ge.value,"onUpdate:visible":z[32]||(z[32]=Y=>ge.value=Y),header:"正在应用更新",footer:!1,"close-on-overlay-click":!1,"close-btn":!1,width:"600px"},{default:a(()=>[t("div",w1,[e(fe,{theme:"plump",percentage:Re.value,label:`${Re.value}%`},null,8,["percentage","label"]),t("div",k1,[(r(!0),C(pe,null,ye(Ue.value,(Y,Ve)=>(r(),C("div",{key:Ve,class:"log-line"},[t("span",$1,M(Y.time),1),_(" "+M(Y.msg),1)]))),128))]),Re.value===100?(r(),C("div",A1,[e(ae,{theme:"primary",onClick:z[31]||(z[31]=Y=>ge.value=!1)},{default:a(()=>[...z[63]||(z[63]=[_("关闭并刷新",-1)])]),_:1})])):O("",!0)])]),_:1},8,["visible"])])}}}),C1=oe(x1,[["__scopeId","data-v-8c9c0740"]]),S1={class:"uploader-container"},I1={key:0,class:"drop-text"},V1={key:1,class:"drop-text"},M1={class:"drop-actions"},L1={key:0,class:"queue-actions"},U1={class:"queue-info"},B1={key:0},R1={class:"btn-group"},E1={key:1,class:"file-list"},P1={class:"file-icon-wrapper"},z1={class:"file-content"},F1={class:"file-header"},T1=["title"],D1={class:"meta"},O1={key:0,class:"error"},j1={key:1},K1={class:"size"},q1=["title"],N1={class:"progress-wrapper"},G1={class:"file-action"},H1=ne({__name:"FileUploader",props:{visible:{type:Boolean},instanceId:{},currentPath:{},allowFolder:{type:Boolean,default:!0}},emits:["update:visible","success"],setup(s,{emit:n}){const l=s,c=n,o=w([]),i=w(!1),f=w(!1),u=w(!1),d=w(),m=w(),b=$=>{const L=$.split(".").pop()?.toLowerCase();return["png","jpg","jpeg","gif","ico","webp"].includes(L||"")?{icon:Cs,color:"var(--td-success-color)"}:["jar","zip","rar","7z","tar","gz"].includes(L||"")?{icon:ga,color:"#722ed1"}:["js","ts","py","java","c","cpp","cs","json","yml","yaml","xml","html","css","properties","conf","sh","bat"].includes(L||"")?{icon:St,color:"var(--td-warning-color)"}:["log","txt","md","lock"].includes(L||"")?{icon:_a,color:"var(--td-gray-color-6)"}:["db","db-wal","dat"].includes(L||"")?{icon:mn,color:"var(--td-gray-color-8)"}:{icon:Yt,color:"var(--td-brand-color)"}},S=$=>$.split("/").pop()||$,k=$=>{const L=$.lastIndexOf("/");return L!==-1?$.substring(0,L):""},I=te(()=>{if(o.value.length===0)return 0;const $=o.value.reduce((L,U)=>L+U.progress,0);return Math.floor($/o.value.length)}),g=te(()=>o.value.some($=>$.status==="pending"||$.status==="error")),V=()=>d.value?.click(),E=()=>m.value?.click(),B=$=>{const L=$.target;if(L.files&&L.files.length>0){const Z=Array.from(L.files).map(W=>({file:W,path:W.webkitRelativePath||W.name}));F(Z)}L.value=""},p=async $=>{u.value=!1;const L=$.dataTransfer?.items;if(!L)return;const U=[],Z=Array.from(L).map(W=>W.webkitGetAsEntry()).filter(W=>W!==null);for(const W of Z)W&&await A(W,U);F(U)},A=async($,L)=>{if($.isFile){const U=await new Promise((W,J)=>$.file(W,J)),Z=$.fullPath.startsWith("/")?$.fullPath.slice(1):$.fullPath;L.push({file:U,path:Z})}else if($.isDirectory)if(l.allowFolder){const U=$.createReader(),Z=await h(U);for(const W of Z)await A(W,L)}else P.error("此处不支持上传文件夹")},h=async $=>{let L=[];const U=async()=>{const Z=await new Promise((W,J)=>$.readEntries(W,J));Z.length>0&&(L=L.concat(Z),await U())};return await U(),L},F=$=>{$.forEach(({file:L,path:U})=>{o.value.some(Z=>Z.path===U&&Z.file.size===L.size&&Z.status!=="error")||o.value.push({id:Math.random().toString(36).substring(2),file:L,path:U,status:"pending",progress:0,speed:""})})},T=async()=>{if(i.value)return;i.value=!0,f.value=!1;const $=3,L=o.value.filter(U=>U.status==="pending"||U.status==="error");for(let U=0;U<L.length&&!(f.value&&o.value.length===0);U+=$){const W=L.slice(U,U+$).filter(J=>o.value.some(H=>H.id===J.id));W.length>0&&await Promise.all(W.map(J=>x(J)))}i.value=!1,!f.value&&o.value.length>0&&o.value.every(U=>U.status==="success")&&(P.success("上传完成"),c("success"))},x=async $=>{$.status="uploading",$.progress=0,$.abortController=new AbortController;const L=Date.now();let U=0;try{const W=(await qt()).uploadId,H=$.file.size>200*1024*1024?50*1024*1024:10*1024*1024,he=Math.ceil($.file.size/H),Te=4,ge=5,Re=Array.from({length:he},(Se,De)=>De),Ue=new Map,Ee=()=>{const Se=Date.now();if(Se-U<100)return;U=Se;const De=Array.from(Ue.values()).reduce((K,ae)=>K+ae,0),se=Math.min(De/$.file.size*95,95);$.progress=Number(se.toFixed(1));const z=(Se-L)/1e3;if(z>0){const K=De/1024/1024/z;$.speed=K.toFixed(1)+" MB/s"}},Be=async Se=>{if($.abortController?.signal.aborted)throw new Error("已取消");const De=Se*H,se=Math.min($.file.size,De+H),z=$.file.slice(De,se);let K;for(let ae=1;ae<=ge;ae++){if($.abortController?.signal.aborted)throw new Error("已取消");try{await Nt(W,Se,z,me=>{me&&me.loaded&&(Ue.set(Se,me.loaded),Ee())},$.abortController?.signal),Ue.set(Se,z.size),Ee();return}catch(me){K=me,ae<ge&&(Ue.set(Se,0),Ee(),await new Promise(ee=>setTimeout(ee,1e3*ae)))}}throw K||new Error(`分片 ${Se} 失败`)},je=async()=>{for(;Re.length>0&&!$.abortController?.signal.aborted;){const Se=Re.shift();if(Se===void 0)break;await Be(Se)}},re=Array(Math.min(Te,he)).fill(null).map(()=>je());if(await Promise.all(re),$.abortController.signal.aborted)throw new Error("已取消");$.status="merging",$.speed="合并中...",$.progress=98,await Gt(W,he),await $o(l.instanceId,W,$.path,l.currentPath),$.status="success",$.progress=100,$.speed="完成"}catch(Z){Z.message==="已取消"||$.abortController?.signal.aborted?($.status="pending",$.speed="已取消",$.progress=0):($.status="error",$.errorMsg=Z.message||"失败")}},N=$=>{o.value[$].abortController?.abort(),o.value.splice($,1)},G=()=>{o.value=o.value.filter($=>$.status!=="success")},R=()=>c("update:visible",!1);return Je(()=>o.value.forEach($=>$.abortController?.abort())),($,L)=>{const U=v("t-button"),Z=v("t-progress"),W=v("t-dialog");return r(),j(W,{visible:s.visible,header:"批量上传文件",width:"650px",footer:!1,onClose:R},{default:a(()=>[t("input",{ref_key:"fileInputRef",ref:d,type:"file",multiple:"",style:{display:"none"},onChange:B},null,544),t("input",{ref_key:"folderInputRef",ref:m,type:"file",webkitdirectory:"",style:{display:"none"},onChange:B},null,544),t("div",S1,[t("div",{class:we(["drop-zone",{active:u.value}]),onDragover:L[0]||(L[0]=Pt(J=>u.value=!0,["prevent"])),onDragleave:L[1]||(L[1]=Pt(J=>u.value=!1,["prevent"])),onDrop:Pt(p,["prevent"])},[e(y(xs),{size:"40px",style:{color:"var(--td-brand-color)"}}),l.allowFolder?(r(),C("p",I1,"拖入文件或文件夹")):O("",!0),l.allowFolder?O("",!0):(r(),C("p",V1,"拖入文件")),t("div",M1,[e(U,{variant:"outline",size:"small",onClick:V},{icon:a(()=>[e(y(Yt))]),default:a(()=>[L[2]||(L[2]=_(" 选择文件",-1))]),_:1}),l.allowFolder?(r(),j(U,{key:0,variant:"outline",size:"small",onClick:E},{icon:a(()=>[e(y(It))]),default:a(()=>[L[3]||(L[3]=_(" 选择文件夹",-1))]),_:1})):O("",!0)])],34),o.value.length>0?(r(),C("div",L1,[t("span",U1,[_(" 队列: "+M(o.value.length)+" 个 | ",1),i.value?(r(),C("span",B1,"总进度 "+M(I.value)+"%",1)):O("",!0)]),t("div",R1,[e(U,{theme:"primary",size:"small",disabled:!g.value||i.value,onClick:T},{icon:a(()=>[e(y(Kt))]),default:a(()=>[_(" "+M(i.value?"上传中...":"开始上传"),1)]),_:1},8,["disabled"]),e(U,{variant:"text",size:"small",onClick:G},{icon:a(()=>[e(y(cn))]),default:a(()=>[L[4]||(L[4]=_(" 清空已完成",-1))]),_:1})])])):O("",!0),o.value.length>0?(r(),C("div",E1,[(r(!0),C(pe,null,ye(o.value,(J,H)=>(r(),C("div",{key:J.id,class:"file-item"},[t("div",P1,[(r(),j(st(b(S(J.path)).icon),{style:Vt({color:b(S(J.path)).color})},null,8,["style"]))]),t("div",z1,[t("div",F1,[t("div",{class:"name",title:S(J.path)},M(S(J.path)),9,T1),t("div",D1,[J.status==="error"?(r(),C("span",O1,M(J.errorMsg),1)):(r(),C("span",j1,M(J.speed),1)),t("span",K1,M((J.file.size/1024/1024).toFixed(2))+" MB",1)])]),k(J.path)?(r(),C("div",{key:0,class:"file-path",title:k(J.path)},[e(y(It),{size:"10px"}),_(" "+M(k(J.path))+"/ ",1)],8,q1)):O("",!0),t("div",N1,[e(Z,{percentage:J.progress,status:J.status==="error"?"error":J.status==="success"?"success":"active",size:"small",label:!1},null,8,["percentage","status"])])]),t("div",G1,[J.status!=="success"?(r(),j(U,{key:0,shape:"circle",variant:"text",size:"small",onClick:he=>N(H)},{default:a(()=>[e(y(Ma))]),_:1},8,["onClick"])):(r(),j(y(na),{key:1,style:{color:"var(--td-success-color)","font-size":"18px"}}))])]))),128))])):O("",!0)])]),_:1},8,["visible"])}}}),js=oe(H1,[["__scopeId","data-v-890b3931"]]),J1={class:"pm-container"},W1={class:"header-section"},X1={class:"mode-switcher"},Q1={key:0,class:"error-alert-bar"},Y1={class:"toolbar"},Z1={class:"left-actions"},ef={key:0,class:"bulk-actions"},tf={class:"selected-count"},af={class:"right-search"},sf={class:"table-wrapper"},nf={style:{display:"flex","align-items":"center",gap:"8px"}},lf={class:"empty-state"},of={class:"tips-footer"},rf=ne({__name:"ModsPluginsManager",setup(s){const n=Qe(),l=parseInt(n.params.serverId),c=w("mods"),o=w(!1),i=w([]),f=w(""),u=w([]),d=w(""),m=te(()=>{if(!f.value)return i.value;const A=f.value.toLowerCase();return i.value.filter(h=>h.name.toLowerCase().includes(A))}),b=te(()=>[{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{title:"文件名",colKey:"name",sorter:(A,h)=>A.name.localeCompare(h.name),ellipsis:!0},{title:"状态",colKey:"status",width:100},{title:"操作",colKey:"op",width:180,fixed:"right",align:"right"}]),S=async(A=!1)=>{o.value=!0,u.value=[],d.value="";try{const h=await xa(l,c.value,A),F=(h.clientJarFiles||[]).map(N=>({name:N,status:"enabled",isClient:!0})),T=(h.jarFiles||[]).map(N=>({name:N,status:"enabled"})),x=(h.disableJarFiles||[]).map(N=>({name:N,status:"disabled"}));i.value=[...F,...T,...x],A&&F.length>0?(u.value=F.map(N=>N.name),P.success(`检测到 ${F.length} 个客户端模组`)):A&&P.info("未检测到仅客户端模组")}catch(h){const F=h.message||"获取列表失败";d.value=F,i.value=[]}finally{o.value=!1}},k=async(A,h)=>{if(h.length===0)return;const F={enable:"启用",disable:"禁用",delete:"删除"},T=async()=>{try{o.value=!0;const x=await Mo(l,c.value,A,h),{successCount:N,failCount:G}=x||{};G>0?P.warning(`操作完成：成功 ${N} 个，失败 ${G} 个`):P.success(`成功${F[A]} ${N} 个文件`),await S()}catch(x){P.error(x.message||"操作失败"),o.value=!1}};if(A==="delete"){const x=tt.confirm({header:`确认删除 ${h.length} 个文件?`,body:"此操作不可逆，文件将被永久删除。",theme:"danger",onConfirm:()=>{x.hide(),T()}})}else await T()},I=A=>{c.value=A,S()},g=A=>{const h=A.status==="enabled"?"disable":"enable";k(h,[A.name])},V=A=>{const h=u.value;k(A,h)},E=w(!1),B=()=>{E.value=!0},p=()=>{E.value=!1,S()};return ke(()=>{S()}),be(()=>n.params.serverId,A=>{A&&location.reload()}),(A,h)=>{const F=v("t-radio-button"),T=v("t-radio-group"),x=v("t-alert"),N=v("t-button"),G=v("t-input"),R=v("t-tag"),$=v("t-switch"),L=v("t-popconfirm"),U=v("t-space"),Z=v("t-table");return r(),C("div",J1,[t("div",W1,[h[13]||(h[13]=t("div",{class:"setting-group-title"}," 资源管理 ",-1)),t("div",X1,[e(T,{modelValue:c.value,"onUpdate:modelValue":h[0]||(h[0]=W=>c.value=W),variant:"default-filled",onChange:I},{default:a(()=>[e(F,{value:"mods"},{icon:a(()=>[e(y(ha))]),default:a(()=>[h[11]||(h[11]=_(" 模组 (Mods) ",-1))]),_:1}),e(F,{value:"plugins"},{icon:a(()=>[e(y(Tt))]),default:a(()=>[h[12]||(h[12]=_(" 插件 (Plugins) ",-1))]),_:1})]),_:1},8,["modelValue"])])]),d.value?(r(),C("div",Q1,[e(x,{theme:"error",message:d.value,closeable:"",onClose:h[2]||(h[2]=W=>d.value="")},{operation:a(()=>[t("span",{style:{cursor:"pointer","margin-left":"8px"},onClick:h[1]||(h[1]=W=>S(!1))},"重试")]),_:1},8,["message"])])):O("",!0),t("div",Y1,[t("div",Z1,[e(N,{theme:"primary",disabled:d.value!=="",onClick:B},{icon:a(()=>[e(y(ya))]),default:a(()=>[h[14]||(h[14]=_(" 上传文件 ",-1))]),_:1},8,["disabled"]),c.value==="mods"?(r(),j(N,{key:0,disabled:d.value!=="",variant:"outline",loading:o.value,onClick:h[3]||(h[3]=W=>S(!0))},{icon:a(()=>[e(y(ba))]),default:a(()=>[h[15]||(h[15]=_(" 检测客户端模组 ",-1))]),_:1},8,["disabled","loading"])):O("",!0),e(N,{variant:"outline",loading:o.value,onClick:h[4]||(h[4]=W=>S(!1))},{icon:a(()=>[e(y(lt))]),_:1},8,["loading"]),e(aa,{name:"fade"},{default:a(()=>[u.value.length>0?(r(),C("div",ef,[h[19]||(h[19]=t("div",{class:"divider"},null,-1)),t("span",tf,"已选 "+M(u.value.length)+" 项",1),e(N,{size:"small",variant:"text",theme:"success",onClick:h[5]||(h[5]=W=>V("enable"))},{default:a(()=>[...h[16]||(h[16]=[_("启用",-1)])]),_:1}),e(N,{size:"small",variant:"text",theme:"warning",onClick:h[6]||(h[6]=W=>V("disable"))},{default:a(()=>[...h[17]||(h[17]=[_("禁用",-1)])]),_:1}),e(N,{size:"small",variant:"text",theme:"danger",onClick:h[7]||(h[7]=W=>V("delete"))},{default:a(()=>[...h[18]||(h[18]=[_("删除",-1)])]),_:1})])):O("",!0)]),_:1})]),t("div",af,[e(G,{modelValue:f.value,"onUpdate:modelValue":h[8]||(h[8]=W=>f.value=W),placeholder:"搜索文件名...",clearable:""},{"prefix-icon":a(()=>[e(y(ba))]),_:1},8,["modelValue"])])]),t("div",sf,[e(Z,{"selected-row-keys":u.value,"onUpdate:selectedRowKeys":h[9]||(h[9]=W=>u.value=W),pagination:{defaultPageSize:20,total:m.value.length,showJumper:!0,defaultCurrent:1},data:m.value,columns:b.value,"row-key":"name",loading:o.value,hover:"",stripe:"",class:"custom-table"},{name:a(({row:W})=>[t("div",nf,[t("span",null,M(W.name),1),W.isClient?(r(),j(R,{key:0,theme:"warning",variant:"light",size:"small"},{default:a(()=>[...h[20]||(h[20]=[_(" 客户端 ",-1)])]),_:1})):O("",!0)])]),status:a(({row:W})=>[W.status==="enabled"?(r(),j(R,{key:0,theme:"success",variant:"light"},{icon:a(()=>[e(y(yt))]),default:a(()=>[h[21]||(h[21]=_(" 已启用 ",-1))]),_:1})):(r(),j(R,{key:1,theme:"default",variant:"light",style:{color:"var(--td-text-color-placeholder)"}},{icon:a(()=>[e(y(Ma))]),default:a(()=>[h[22]||(h[22]=_(" 已禁用 ",-1))]),_:1}))]),op:a(({row:W})=>[e(U,{size:"small"},{default:a(()=>[e($,{"model-value":W.status==="enabled",loading:o.value,size:"medium",onChange:J=>g(W)},{label:a(J=>[_(M(J.value?"开":"关"),1)]),_:1},8,["model-value","loading","onChange"]),e(L,{content:"确定要删除此文件吗？",theme:"danger",onConfirm:J=>k("delete",[W.name])},{default:a(()=>[e(N,{variant:"text",theme:"danger",shape:"square"},{default:a(()=>[e(y(Lt))]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)]),empty:a(()=>[t("div",lf,[c.value==="mods"?(r(),j(y(ha),{key:0,size:"48px",style:{color:"var(--td-gray-color-4)"}})):(r(),j(y(Tt),{key:1,size:"48px",style:{color:"var(--td-gray-color-4)"}})),t("p",null,M(`暂无${c.value==="mods"?"模组":"插件"}文件`),1)])]),_:1},8,["selected-row-keys","pagination","data","columns","loading"])]),t("div",of,[t("p",null,"提示："+M(c.value==="mods"?"模组":"插件")+"文件存放于服务器根目录的 /"+M(c.value)+" 文件夹下。",1),h[23]||(h[23]=t("p",null,"禁用文件后，会在文件名后添加 .disabled 后缀，服务器将忽略该文件。",-1))]),e(js,{visible:E.value,"onUpdate:visible":h[10]||(h[10]=W=>E.value=W),"instance-id":y(l),"current-path":c.value,"allow-folder":!1,onSuccess:p},null,8,["visible","instance-id","current-path"])])}}}),uf=oe(rf,[["__scopeId","data-v-c8641ed4"]]),ds=[{key:"motd",label:"服务器标语",desc:"显示在多人游戏列表中的服务器介绍信息，支持颜色代码，不支持中文。",type:"string"},{key:"server-port",label:"服务器端口",desc:"默认为 25565。如果要在一台机器运行多个服务器，必须修改此端口。",type:"number"},{key:"max-players",label:"最大玩家数",desc:"服务器同时允许在线的最大玩家数量。",type:"number"},{key:"online-mode",label:"正版验证",desc:"开启后将验证玩家的正版账号。如果使用离线/皮肤站，请关闭此项。",type:"boolean"},{key:"white-list",label:"启用白名单",desc:"开启后只有在白名单内的玩家才能进入服务器。",type:"boolean"},{key:"enforce-whitelist",label:"强制白名单",desc:"开启后，当玩家不在白名单时，即使已在线也会被踢出（通常用于维护时重新加载白名单）。",type:"boolean"},{key:"level-name",label:"存档文件夹名称",desc:"服务器读取的世界存档文件夹名称（默认为 world）。",type:"string"},{key:"gamemode",label:"默认游戏模式",desc:"新玩家进入服务器时的默认模式。",type:"select",options:[{label:"生存 (Survival)",value:"survival"},{label:"创造 (Creative)",value:"creative"},{label:"冒险 (Adventure)",value:"adventure"},{label:"旁观 (Spectator)",value:"spectator"}]},{key:"force-gamemode",label:"强制游戏模式",desc:"开启后，玩家每次加入服务器都会被重置为默认游戏模式。",type:"boolean"},{key:"difficulty",label:"难度",desc:"世界的游戏难度设置。",type:"select",options:[{label:"和平 (Peaceful)",value:"peaceful"},{label:"简单 (Easy)",value:"easy"},{label:"普通 (Normal)",value:"normal"},{label:"困难 (Hard)",value:"hard"}]},{key:"hardcore",label:"极限模式",desc:"开启后，玩家死亡将被封禁。",type:"boolean"},{key:"allow-flight",label:"允许飞行",desc:"允许生存模式下的玩家飞行（防止被服务端反作弊踢出）。",type:"boolean"},{key:"spawn-protection",label:"出生点保护半径",desc:"出生点周围多少格内禁止非 OP 破坏。设为 0 可禁用。",type:"number"},{key:"player-idle-timeout",label:"挂机踢出时间",desc:"玩家闲置多少分钟后被自动踢出。0 为不限制。",type:"number"},{key:"level-seed",label:"世界种子",desc:"生成世界使用的种子，留空则随机生成。",type:"string"},{key:"level-type",label:"世界类型",desc:"例如 minecraft:normal, minecraft:flat, minecraft:amplified。",type:"string"},{key:"generate-structures",label:"生成结构",desc:"是否生成村庄、地牢等结构。",type:"boolean"},{key:"generator-settings",label:"生成器设置",desc:"用于自定义超平坦或特定生成器的 JSON 参数。",type:"string"},{key:"max-world-size",label:"世界边界半径",desc:"设置世界边界（World Border）的最大半径。",type:"number"},{key:"simulation-distance",label:"模拟距离",desc:"服务器实际运算实体/作物生长的区块半径（3-32）。",type:"number"},{key:"view-distance",label:"视距",desc:"客户端可以看见的区块半径。数值过大显著增加内存和带宽消耗。",type:"number"},{key:"entity-broadcast-range-percentage",label:"实体广播范围百分比",desc:"控制客户端能看到实体的距离系数（100表示默认）。",type:"number"},{key:"max-tick-time",label:"最大刻耗时 (Watchdog)",desc:"一刻的最长处理毫秒数。超过此数值服务器将强制关闭以防卡死。设为 -1 可禁用。",type:"number"},{key:"network-compression-threshold",label:"网络压缩阈值",desc:"数据包超过此字节数时进行压缩。设为 -1 禁用压缩。推荐保持默认 256。",type:"number"},{key:"rate-limit",label:"数据包限制",desc:"如果玩家发送数据包过快，将被踢出。0 为禁用。",type:"number"},{key:"use-native-transport",label:"使用原生传输优化",desc:"Linux 环境下是否启用 Epoll 优化网络性能。",type:"boolean"},{key:"prevent-proxy-connections",label:"防止代理连接",desc:"是否尝试阻止通过 VPN 或代理的连接（ISP/AS 号判断）。",type:"boolean"},{key:"sync-chunk-writes",label:"同步区块写入",desc:"开启后区块写入完成后才继续逻辑，数据更安全但可能掉帧；关闭可能提升性能。",type:"boolean"},{key:"region-file-compression",label:"区块文件压缩格式",desc:"用于保存区块的压缩算法。",type:"select",options:[{label:"Deflate (默认)",value:"deflate"},{label:"LZ4 (更快)",value:"lz4"},{label:"不压缩 (None)",value:"none"}]},{key:"max-chained-neighbor-updates",label:"最大连锁更新数",desc:"限制红石/方块连锁更新的数量以防止崩服。",type:"number"},{key:"log-ips",label:"控制台记录 IP",desc:"是否在控制台日志中显示玩家连接的 IP 地址。",type:"boolean"},{key:"hide-online-players",label:"隐藏在线玩家列表",desc:"开启后，服务器列表中将不显示具体的玩家名单。",type:"boolean"},{key:"enable-status",label:"启用状态查询",desc:"是否允许外部（如服务器列表网站）查询服务器状态。",type:"boolean"},{key:"accepts-transfers",label:"接受服务器传送",desc:"是否允许玩家从其他服务器无缝传送到此服务器。",type:"boolean"},{key:"pause-when-empty-seconds",label:"空载暂停时间",desc:"服务器内无玩家多少秒后暂停游戏循环（省资源）。-1 为不暂停。",type:"number"},{key:"op-permission-level",label:"OP 权限等级",desc:"设置 OP 的默认权限级别。",type:"select",options:[{label:"1 - 无视出生点保护",value:1},{label:"2 - 使用单机指令 (gamemode等)",value:2},{label:"3 - 多人管理 (kick/ban/op)",value:3},{label:"4 - 系统管理 (stop/save)",value:4}]},{key:"function-permission-level",label:"函数权限等级",desc:"数据包(Datapack)中函数的默认执行权限等级。",type:"number"},{key:"enforce-secure-profile",label:"强制安全配置 (签名)",desc:"强制玩家拥有官方签名的公钥（聊天报告相关）。离线服建议关闭。",type:"boolean"},{key:"enable-code-of-conduct",label:"启用行为准则提示",desc:"是否向玩家展示行为准则链接（遥测相关）。",type:"boolean"},{key:"bug-report-link",label:"Bug 反馈链接",desc:"自定义玩家遇到错误时显示的反馈网址。",type:"string"},{key:"resource-pack",label:"资源包下载地址",desc:"玩家进入服务器时提示下载的资源包直链 URL。",type:"string"},{key:"require-resource-pack",label:"强制资源包",desc:"开启后，拒绝下载资源包的玩家将被踢出。",type:"boolean"},{key:"resource-pack-sha1",label:"资源包 SHA1",desc:"资源包文件的 SHA-1 校验码，用于验证完整性和缓存。",type:"string"},{key:"resource-pack-prompt",label:"资源包提示语",desc:"下载资源包时向玩家显示的自定义消息（Json 格式）。",type:"string"},{key:"initial-enabled-packs",label:"初始启用数据包",desc:"世界生成时默认启用的数据包列表（逗号分隔）。",type:"string"},{key:"initial-disabled-packs",label:"初始禁用数据包",desc:"世界生成时默认禁用的数据包列表。",type:"string"},{key:"enable-rcon",label:"启用 RCON",desc:"开启远程控制台协议，允许外部工具发送指令。",type:"boolean"},{key:"rcon.port",label:"RCON 端口",desc:"RCON 监听端口（默认为 25575）。",type:"number"},{key:"rcon.password",label:"RCON 密码",desc:"连接 RCON 必须的密码。请设置复杂的密码。",type:"string"},{key:"broadcast-rcon-to-ops",label:"向 OP 广播 RCON",desc:"当 RCON 执行指令时，是否通知在线的 OP。",type:"boolean"},{key:"enable-query",label:"启用 Query",desc:"开启 GameSpy4 协议，用于获取服务器详细信息。",type:"boolean"},{key:"query.port",label:"Query 端口",desc:"Query 协议监听端口（默认为 25565）。",type:"number"},{key:"broadcast-console-to-ops",label:"向 OP 广播控制台",desc:"控制台执行的指令输出是否发给在线 OP。",type:"boolean"},{key:"enable-jmx-monitoring",label:"启用 JMX 监控",desc:"开启 Java JMX 性能监控（通常用于开发调试）。",type:"boolean"},{key:"management-server-enabled",label:"启用管理后台",desc:"是否启用 Minecraft 官方定义的管理服务器接口。",type:"boolean"},{key:"management-server-port",label:"管理后台端口",desc:"管理接口监听的端口。",type:"number"},{key:"management-server-host",label:"管理后台主机",desc:"管理接口绑定的主机名/IP。",type:"string"},{key:"management-server-allowed-origins",label:"管理后台允许源",desc:"允许访问管理接口的 Origin 列表。",type:"string"},{key:"server-ip",label:"服务器绑定 IP",desc:"指定服务器绑定的本地网卡 IP。留空表示监听所有网卡（0.0.0.0）。",type:"string"},{key:"debug",label:"调试模式",desc:"开启后控制台将输出更多调试信息。",type:"boolean"},{key:"text-filtering-config",label:"文本过滤配置",desc:"用于文本过滤服务的 API 配置。",type:"string"},{key:"status-heartbeat-interval",label:"状态心跳间隔",desc:"服务器向客户端发送状态心跳的间隔（0 为默认）。",type:"number"}],df={class:"settings-container"},cf={class:"page-header"},mf={class:"config-list"},pf={key:0,class:"empty-tip"},vf={class:"setting-info"},ff={class:"title"},gf={class:"key-name-row"},_f={key:0,class:"key-name"},hf={key:0,class:"desc"},yf={class:"setting-control"},bf={class:"form-actions"},wf=ne({__name:"ServerProperties",setup(s){const n=Qe(),l=w(0),c=w(!1),o=w(!1),i=w({}),f=w(""),u=V=>{const E={};return V.split(`
`).forEach(p=>{const A=p.trim();if(!A||A.startsWith("#"))return;const h=A.indexOf("=");if(h!==-1){const F=A.substring(0,h).trim(),T=A.substring(h+1).trim();E[F]=T}}),E},d=V=>{let E=`#Minecraft server properties
#${new Date().toString()}
`;const B=ds.map(A=>A.key),p=Object.keys(V);return B.forEach(A=>{Object.prototype.hasOwnProperty.call(V,A)&&(E+=`${A}=${V[A]}
`)}),p.forEach(A=>{B.includes(A)||(E+=`${A}=${V[A]}
`)}),E},m=async()=>{if(l.value){c.value=!0;try{const V=await ra(l.value,"server.properties");V&&(f.value=V,i.value=u(V))}catch(V){P.error(`读取配置文件失败: ${V.message}`)}finally{c.value=!1}}},b=async()=>{o.value=!0;try{const V=d(i.value);await Ea(l.value,"server.properties",V),P.success("配置文件已保存"),m()}catch(V){P.error(`保存失败: ${V.message}`)}finally{o.value=!1}},S=te(()=>{const V=[],E=i.value,B=new Set(Object.keys(E));return ds.forEach(p=>{B.has(p.key)&&(V.push(p),B.delete(p.key))}),B.forEach(p=>{V.push({key:p,label:p,desc:"未收录的配置项",type:k(E[p]),isUnknown:!0})}),V}),k=V=>V==="true"||V==="false"?"boolean":!isNaN(Number(V))&&V!==""?"number":"string",I=(V,E)=>{const B=i.value[V];return B===void 0?E==="boolean"?!1:"":E==="boolean"?B==="true":E==="number"?Number(B):B},g=(V,E,B)=>{i.value[V]=String(E)};return be(()=>n.params.serverId,V=>{n.name==="InstanceConsole"&&V&&(l.value=parseInt(V),m())},{immediate:!0}),(V,E)=>{const B=v("t-button"),p=v("t-space"),A=v("t-switch"),h=v("t-select"),F=v("t-input-number"),T=v("t-input"),x=v("t-loading");return r(),C("div",df,[t("div",cf,[E[1]||(E[1]=t("div",{class:"section-title"},"Server.properties 配置编辑器",-1)),e(p,null,{default:a(()=>[e(B,{variant:"text",shape:"square",loading:c.value,onClick:m},{icon:a(()=>[e(y(lt))]),_:1},8,["loading"]),e(B,{theme:"primary",loading:o.value,onClick:b},{icon:a(()=>[e(y(Ss))]),default:a(()=>[E[0]||(E[0]=_(" 保存配置 ",-1))]),_:1},8,["loading"])]),_:1})]),e(x,{loading:c.value,text:"正在读取配置文件..."},{default:a(()=>[t("div",mf,[!c.value&&S.value.length===0?(r(),C("div",pf," 无法找到配置项或文件为空 ")):O("",!0),(r(!0),C(pe,null,ye(S.value,N=>(r(),C("div",{key:N.key,class:we(["setting-item",{"unknown-item":N.isUnknown}])},[t("div",vf,[t("div",ff,M(N.label),1),t("div",gf,[N.isUnknown?O("",!0):(r(),C("span",_f,M(N.key),1))]),N.isUnknown?O("",!0):(r(),C("div",hf,M(N.desc||"暂无描述"),1))]),t("div",yf,[N.type==="boolean"?(r(),j(A,{key:0,"model-value":I(N.key,"boolean"),"onUpdate:modelValue":G=>g(N.key,G,"boolean")},null,8,["model-value","onUpdate:modelValue"])):N.type==="select"?(r(),j(h,{key:1,"model-value":I(N.key,"string"),options:N.options,placeholder:"请选择","onUpdate:modelValue":G=>g(N.key,G,"string")},null,8,["model-value","options","onUpdate:modelValue"])):N.type==="number"?(r(),j(F,{key:2,"model-value":I(N.key,"number"),theme:"column",style:{width:"100%"},"onUpdate:modelValue":G=>g(N.key,G,"number")},null,8,["model-value","onUpdate:modelValue"])):(r(),j(T,{key:3,"model-value":I(N.key,"string"),placeholder:"未设置","onUpdate:modelValue":G=>g(N.key,G,"string")},null,8,["model-value","onUpdate:modelValue"]))])],2))),128))])]),_:1},8,["loading"]),t("div",bf,[e(B,{theme:"primary",size:"large",loading:o.value,onClick:b},{default:a(()=>[...E[2]||(E[2]=[_("保存设置",-1)])]),_:1},8,["loading"]),e(B,{theme:"default",variant:"base",size:"large",onClick:m},{default:a(()=>[...E[3]||(E[3]=[_("重置更改",-1)])]),_:1})])])}}}),kf=oe(wf,[["__scopeId","data-v-6dfcc71c"]]);async function $f(s){return await Q.get({url:`/api/instance/tasks/list/${s}`})}async function Af(s,n,l,c,o,i){return await Q.post({url:"/api/instance/tasks/create",data:{instanceId:s,name:n,cron:l,payload:c,type:o,enable:i}})}async function xf(s,n,l,c,o,i,f){return await Q.post({url:"/api/instance/tasks/update",data:{instanceId:s,id:n,name:l,cron:c,payload:o,type:i,enable:f}})}async function Cf(s){return await Q.post({url:`/api/instance/tasks/delete/${s}`})}const Sf={class:"cron-gen-container"},If={class:"mode-switch"},Vf={key:0,class:"mode-content novice-panel"},Mf={class:"novice-input-group"},Lf={key:1,class:"mode-content pro-panel"},Uf={class:"tab-scroll-area"},Bf={key:0,class:"specific-box"},Rf={class:"result-area"},Ef={class:"cron-display"},Pf={class:"code-box"},zf={class:"next-runs"},Ff={class:"runs-title"},Tf={key:0,class:"error-msg"},Df={key:1,class:"runs-list"},Of={class:"index"},jf=ne({__name:"CronGenerator",props:{visible:{type:Boolean,default:!1},initialValue:{type:String,default:""}},emits:["update:visible","confirm"],setup(s,{emit:n}){const l=s,c=n,o=w("novice"),i=w(10),f=w("minute"),u=[{label:"秒",value:"second"},{label:"分钟",value:"minute"},{label:"小时",value:"hour"},{label:"天",value:"day"}],d=w("second"),m=[{label:"秒",value:"second",min:0,max:59},{label:"分",value:"minute",min:0,max:59},{label:"时",value:"hour",min:0,max:23},{label:"日",value:"day",min:1,max:31},{label:"月",value:"month",min:1,max:12},{label:"周",value:"week",min:1,max:7}],b=w({second:{type:"every",start:0,step:1,specifics:[]},minute:{type:"every",start:0,step:1,specifics:[]},hour:{type:"every",start:0,step:1,specifics:[]},day:{type:"every",start:1,step:1,specifics:[]},month:{type:"every",start:1,step:1,specifics:[]},week:{type:"any",start:1,step:1,specifics:[]}}),S=[{label:"周日",value:1},{label:"周一",value:2},{label:"周二",value:3},{label:"周三",value:4},{label:"周四",value:5},{label:"周五",value:6},{label:"周六",value:7}],k=te(()=>{const h=($,L="*")=>{const U=b.value[$];return $==="week"&&U.type==="any"||$==="week"&&b.value.day.type!=="every"||$==="day"&&b.value.week.type!=="any"?"?":U.type==="every"?"*":U.type==="interval"?`${U.start}/${U.step}`:U.type==="specific"?U.specifics.length===0?$==="day"||$==="month"?"1":"0":U.specifics.sort((Z,W)=>Z-W).join(","):L},F=h("second"),T=h("minute"),x=h("hour"),N=h("day"),G=h("month"),R=h("week","?");return`${F} ${T} ${x} ${N} ${G} ${R}`}),I=te(()=>{const h=i.value;switch(f.value){case"second":return`*/${h} * * * * *`;case"minute":return`0 */${h} * * * *`;case"hour":return`0 0 */${h} * * ?`;case"day":return`0 0 0 */${h} * ?`;default:return"* * * * * *"}}),g=te(()=>o.value==="novice"?I.value:k.value),V=w([]),E=w(""),B=()=>{try{const h=Kn.CronExpressionParser.parse(g.value,{currentDate:new Date});V.value=h.take(5).map(F=>new Date(F.toString()).toLocaleString()),E.value=""}catch{E.value="无法解析当前 Cron 表达式，请检查规则是否冲突",V.value=[]}};be(g,()=>{B()},{immediate:!0}),be(()=>l.visible,h=>{h&&l.initialValue&&(o.value="pro",B())});const p=()=>{if(E.value){P.warning("当前表达式无效，无法保存");return}c("confirm",g.value),c("update:visible",!1)},A=h=>{const F=m.find(x=>x.value===h);if(!F)return[];const T=[];for(let x=F.min;x<=F.max;x++)T.push({label:x.toString(),value:x});return T};return(h,F)=>{const T=v("t-radio-button"),x=v("t-radio-group"),N=v("t-input-number"),G=v("t-select"),R=v("t-alert"),$=v("t-radio"),L=v("t-checkbox-group"),U=v("t-tab-panel"),Z=v("t-tabs"),W=v("t-tag"),J=v("t-dialog");return r(),j(J,{visible:s.visible,header:"Cron 表达式生成器",width:"700px",top:"5vh",onClose:F[4]||(F[4]=H=>c("update:visible",!1)),onConfirm:p},{default:a(()=>[t("div",Sf,[t("div",If,[e(x,{modelValue:o.value,"onUpdate:modelValue":F[0]||(F[0]=H=>o.value=H),variant:"default-filled"},{default:a(()=>[e(T,{value:"novice"},{default:a(()=>[...F[5]||(F[5]=[_("🚀 新手模式",-1)])]),_:1}),e(T,{value:"pro"},{default:a(()=>[...F[6]||(F[6]=[_("🛠️ 专业模式",-1)])]),_:1})]),_:1},8,["modelValue"])]),o.value==="novice"?(r(),C("div",Vf,[t("div",Mf,[F[7]||(F[7]=t("span",null,"每隔",-1)),e(N,{modelValue:i.value,"onUpdate:modelValue":F[1]||(F[1]=H=>i.value=H),min:1,theme:"column",style:{width:"100px"}},null,8,["modelValue"]),e(G,{modelValue:f.value,"onUpdate:modelValue":F[2]||(F[2]=H=>f.value=H),options:u,style:{width:"100px"}},null,8,["modelValue"]),F[8]||(F[8]=t("span",null,"执行一次",-1))]),e(R,{theme:"info",style:{"margin-top":"16px"}},{message:a(()=>[...F[9]||(F[9]=[_(" 此模式适用于简单的周期性任务。如果需要“每周五上午10点”等复杂规则，请切换到",-1),t("b",null,"专业模式",-1),_("。 ",-1)])]),_:1})])):(r(),C("div",Lf,[e(Z,{modelValue:d.value,"onUpdate:modelValue":F[3]||(F[3]=H=>d.value=H)},{default:a(()=>[(r(),C(pe,null,ye(m,H=>e(U,{key:H.value,value:H.value,label:H.label},{default:a(()=>[t("div",Uf,[e(x,{modelValue:b.value[H.value].type,"onUpdate:modelValue":he=>b.value[H.value].type=he,direction:"vertical"},{default:a(()=>[e($,{value:"every"},{default:a(()=>[_(M(H.value==="week"?"不指定 (?)":`每${H.label} (*)`),1)]),_:2},1024),H.value!=="week"?(r(),j($,{key:0,value:"interval"},{default:a(()=>[F[10]||(F[10]=_(" 周期: 从 ",-1)),e(N,{modelValue:b.value[H.value].start,"onUpdate:modelValue":he=>b.value[H.value].start=he,min:H.min,max:H.max,size:"small",theme:"column",style:{width:"60px"}},null,8,["modelValue","onUpdate:modelValue","min","max"]),_(" "+M(H.label)+"开始，每 ",1),e(N,{modelValue:b.value[H.value].step,"onUpdate:modelValue":he=>b.value[H.value].step=he,min:1,max:H.max,size:"small",theme:"column",style:{width:"60px"}},null,8,["modelValue","onUpdate:modelValue","max"]),_(" "+M(H.label)+"执行一次 ",1)]),_:2},1024)):O("",!0),H.value!=="week"?(r(),j($,{key:1,value:"specific"},{default:a(()=>[_("指定: 选择具体的"+M(H.label),1)]),_:2},1024)):O("",!0),H.value==="week"?(r(),j($,{key:2,value:"specific"},{default:a(()=>[...F[11]||(F[11]=[_("指定周几",-1)])]),_:1})):O("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),b.value[H.value].type==="specific"?(r(),C("div",Bf,[e(L,{modelValue:b.value[H.value].specifics,"onUpdate:modelValue":he=>b.value[H.value].specifics=he,options:H.value==="week"?S:A(H.value),class:"grid-checkbox"},null,8,["modelValue","onUpdate:modelValue","options"])])):O("",!0)])]),_:2},1032,["value","label"])),64))]),_:1},8,["modelValue"])])),t("div",Rf,[t("div",Ef,[F[14]||(F[14]=t("span",{class:"label"},"当前表达式:",-1)),t("div",Pf,[_(M(g.value)+" ",1),E.value?(r(),j(W,{key:1,theme:"danger",variant:"light",size:"small"},{default:a(()=>[e(y(fs)),F[13]||(F[13]=_(" 无效",-1))]),_:1})):(r(),j(W,{key:0,theme:"success",variant:"light",size:"small"},{default:a(()=>[e(y(yt)),F[12]||(F[12]=_(" 有效",-1))]),_:1}))])]),t("div",zf,[t("div",Ff,[e(y(ft)),F[15]||(F[15]=_(" 最近 5 次运行时间预测:",-1))]),E.value?(r(),C("div",Tf,M(E.value),1)):(r(),C("ul",Df,[(r(!0),C(pe,null,ye(V.value,(H,he)=>(r(),C("li",{key:he},[t("span",Of,"#"+M(he+1),1),_(" "+M(H),1)]))),128))]))])])])]),_:1},8,["visible"])}}}),Kf=oe(jf,[["__scopeId","data-v-b81cfe41"]]),Rt="https://mslx.mslmc.cn",Ot={cron:`${Rt}/docs/server-config/crons`,style:`${Rt}/docs/style/webpanel/`,style_log_colorizer:`${Rt}/docs/style/webpanel/#%E7%BB%88%E7%AB%AF%E6%97%A5%E5%BF%97%E6%9F%93%E8%89%B2%E7%AD%89%E7%BA%A7%E9%85%8D%E7%BD%AE`,remote_access:`${Rt}/docs/config/remote-access/`,msl_oauth:`${Rt}/docs/config/msl-oauth`},qf={class:"page-container"},Nf={class:"page-header"},Gf={key:0,class:"create-container"},Hf={class:"container-header"},Jf={class:"title"},Wf={class:"setting-item"},Xf={class:"setting-control"},Qf={class:"setting-item"},Yf={class:"setting-control"},Zf={class:"setting-item"},eg={class:"setting-control"},tg={key:0,class:"setting-item"},ag={class:"setting-info"},sg={class:"title"},ng={class:"desc"},lg={class:"setting-control"},og={class:"setting-item"},rg={class:"setting-control"},ig={class:"form-actions"},ug={class:"task-list"},dg={key:0,class:"empty-state"},cg={class:"card-left"},mg={class:"task-header-row"},pg={class:"task-name"},vg={class:"task-meta-row"},fg={class:"cron-display"},gg=["title"],_g={class:"card-right"},hg=ne({__name:"CronTasks",setup(s){const n=Qe(),l=te(()=>parseInt(n.params.serverId)),c=w([]),o=w(!1),i=w(!1),f=w(null),u=w(!1),d=w(null),m=w(!1),b=w({id:"",name:"",cron:"",type:"command",payload:"",enable:!0}),S=[{label:"发送命令 (Command)",value:"command"},{label:"备份存档 (Backup)",value:"backup"},{label:"开启服务器 (Start)",value:"start"},{label:"停止服务器 (Stop)",value:"stop"},{label:"重启服务器 (Restart)",value:"restart"}],k={name:[{required:!0,message:"必填",trigger:"blur"}],cron:[{required:!0,message:"必填",trigger:"blur"}],type:[{required:!0,message:"必选",trigger:"change"}],payload:[{validator:T=>b.value.type==="command"&&!T?{result:!1,message:"命令内容不能为空",type:"error"}:!0,trigger:"blur"}]},I=async()=>{if(l.value){o.value=!0;try{const T=await $f(l.value);c.value=T||[]}catch(T){P.error(T.message||"获取列表失败")}finally{o.value=!1}}},g=()=>{i.value||(b.value={id:"",name:"",cron:"",type:"command",payload:"",enable:!0},f.value=null,i.value=!0)},V=T=>{b.value={id:T.id,name:T.name,cron:T.cron,type:T.type.toLowerCase(),payload:T.payload,enable:T.enable},f.value=T.id,i.value=!0,window.scrollTo({top:0,behavior:"smooth"})},E=()=>{i.value=!1,f.value=null},B=async()=>{if(await d.value?.validate()===!0){u.value=!0;try{f.value?(await xf(l.value,b.value.id,b.value.name,b.value.cron,b.value.payload,b.value.type,b.value.enable),P.success("更新成功")):(await Af(l.value,b.value.name,b.value.cron,b.value.payload,b.value.type,b.value.enable),P.success("创建成功")),E(),I()}catch(x){P.error(x.message||"操作失败")}finally{u.value=!1}}},p=T=>{const x=tt.confirm({header:"确认删除?",body:`确定删除任务 "${T.name}" 吗？`,theme:"danger",onConfirm:async()=>{try{await Cf(T.id),P.success("已删除"),I(),x.hide()}catch(N){P.error(N.message)}},onClose:()=>x.hide()})},A=T=>{b.value.cron=T},h=T=>{const x=T.toLowerCase();return x==="start"?Kt:x==="stop"?sa:x==="restart"?lt:St},F=T=>{const x=T.toLowerCase();return x==="start"?"success":x==="stop"?"danger":x==="restart"?"warning":"primary"};return be(()=>l.value,I),ke(I),(T,x)=>{const N=v("t-button"),G=v("t-space"),R=v("t-input"),$=v("t-select"),L=v("t-textarea"),U=v("t-switch"),Z=v("t-form"),W=v("t-tag"),J=v("t-loading");return r(),C("div",qf,[t("div",Nf,[x[10]||(x[10]=t("div",{class:"section-title"},"定时计划任务",-1)),e(G,null,{default:a(()=>[i.value?O("",!0):(r(),j(N,{key:0,theme:"default",onClick:x[0]||(x[0]=H=>y(Ae)(y(Ot).cron))},{icon:a(()=>[e(y(Zt))]),default:a(()=>[x[8]||(x[8]=_(" 使用文档 ",-1))]),_:1})),i.value?O("",!0):(r(),j(N,{key:1,theme:"primary",onClick:g},{icon:a(()=>[e(y(la))]),default:a(()=>[x[9]||(x[9]=_(" 创建新任务 ",-1))]),_:1}))]),_:1})]),e(aa,{name:"slide-fade"},{default:a(()=>[i.value?(r(),C("div",Gf,[t("div",Hf,[t("span",Jf,M(f.value?"编辑任务":"创建新任务"),1),e(N,{size:"small",variant:"text",onClick:E},{default:a(()=>[e(y(Ia))]),_:1})]),e(Z,{ref_key:"formRef",ref:d,data:b.value,rules:k,"label-width":"0"},{default:a(()=>[t("div",Wf,[x[11]||(x[11]=t("div",{class:"setting-info"},[t("div",{class:"title"},"任务名称"),t("div",{class:"desc"},"给这个计划任务起个容易识别的名字，例如“每日自动重启”")],-1)),t("div",Xf,[e(R,{modelValue:b.value.name,"onUpdate:modelValue":x[1]||(x[1]=H=>b.value.name=H),placeholder:"请输入任务名称"},null,8,["modelValue"])])]),t("div",Qf,[x[13]||(x[13]=t("div",{class:"setting-info"},[t("div",{class:"title"},"触发规则 (Cron)"),t("div",{class:"desc"},"使用 Cron 表达式定义执行时间。支持秒级精度 (秒 分 时 日 月 周)")],-1)),t("div",Yf,[e(R,{modelValue:b.value.cron,"onUpdate:modelValue":x[2]||(x[2]=H=>b.value.cron=H),placeholder:"例如: 0 0 12 * * ?"},null,8,["modelValue"]),e(N,{variant:"outline",theme:"default",onClick:x[3]||(x[3]=H=>m.value=!0)},{default:a(()=>[...x[12]||(x[12]=[_(" 表达式生成器 ",-1)])]),_:1})])]),t("div",Zf,[x[14]||(x[14]=t("div",{class:"setting-info"},[t("div",{class:"title"},"执行操作"),t("div",{class:"desc"},"选择触发时要执行的动作类型")],-1)),t("div",eg,[e($,{modelValue:b.value.type,"onUpdate:modelValue":x[4]||(x[4]=H=>b.value.type=H),options:S},null,8,["modelValue"])])]),b.value.type==="command"||b.value.type==="restart"?(r(),C("div",tg,[t("div",ag,[t("div",sg,M(b.value.type==="restart"?"重启提示语":"控制台命令"),1),t("div",ng,M(b.value.type==="restart"?"重启前发送给全服玩家的倒计时提示消息":"不需要加 /，直接输入命令内容"),1)]),t("div",lg,[e(L,{modelValue:b.value.payload,"onUpdate:modelValue":x[5]||(x[5]=H=>b.value.payload=H),autosize:{minRows:2,maxRows:5},placeholder:"请输入内容..."},null,8,["modelValue"])])])):O("",!0),t("div",og,[x[15]||(x[15]=t("div",{class:"setting-info"},[t("div",{class:"title"},"启用状态"),t("div",{class:"desc"},"暂时禁用此任务而不删除它")],-1)),t("div",rg,[e(U,{modelValue:b.value.enable,"onUpdate:modelValue":x[6]||(x[6]=H=>b.value.enable=H)},null,8,["modelValue"])])]),t("div",ig,[e(N,{theme:"primary",loading:u.value,onClick:B},{icon:a(()=>[e(y(Ss))]),default:a(()=>[_(" "+M(f.value?"保存修改":"立即创建"),1)]),_:1},8,["loading"]),e(N,{theme:"default",variant:"base",onClick:E},{default:a(()=>[...x[16]||(x[16]=[_("取消",-1)])]),_:1})])]),_:1},8,["data"])])):O("",!0)]),_:1}),e(J,{loading:o.value,"show-overlay":""},{default:a(()=>[t("div",ug,[c.value.length===0&&!o.value?(r(),C("div",dg,"暂无任务，请点击上方创建")):O("",!0),(r(!0),C(pe,null,ye(c.value,H=>(r(),C("div",{key:H.id,class:"task-card"},[t("div",cg,[t("div",mg,[e(W,{size:"small",theme:H.enable?"success":"warning",variant:"light",class:"status-tag"},{default:a(()=>[_(M(H.enable?"运行中":"已暂停"),1)]),_:2},1032,["theme"]),t("span",pg,M(H.name),1)]),t("div",vg,[e(W,{size:"small",variant:"outline",theme:F(H.type),style:{"margin-right":"8px"}},{icon:a(()=>[(r(),j(st(h(H.type))))]),default:a(()=>[_(" "+M(H.type.toUpperCase()),1)]),_:2},1032,["theme"]),t("span",fg,[e(y(ft)),_(" "+M(H.cron),1)])]),H.payload?(r(),C("div",{key:0,class:"task-payload",title:H.payload},M(H.payload),9,gg)):O("",!0)]),t("div",_g,[e(N,{variant:"text",theme:"primary",onClick:he=>V(H)},{icon:a(()=>[e(y(ks))]),default:a(()=>[x[17]||(x[17]=_(" 编辑 ",-1))]),_:1},8,["onClick"]),e(N,{variant:"text",theme:"danger",onClick:he=>p(H)},{icon:a(()=>[e(y(Lt))]),default:a(()=>[x[18]||(x[18]=_(" 删除 ",-1))]),_:1},8,["onClick"])])]))),128))])]),_:1},8,["loading"]),e(Kf,{visible:m.value,"onUpdate:visible":x[7]||(x[7]=H=>m.value=H),"initial-value":b.value.cron,onConfirm:A},null,8,["visible","initial-value"])])}}}),yg=oe(hg,[["__scopeId","data-v-98dd2a72"]]),bg={class:"layout-container"},wg={class:"sidebar"},kg=["onClick"],$g={class:"nav-text"},Ag={class:"main-content"},xg={key:0,class:"panel-wrapper"},Cg={key:1,class:"panel-wrapper"},Sg={key:2,class:"panel-wrapper"},Ig={key:3,class:"panel-wrapper"},Vg=ne({__name:"InstanceSettings",setup(s,{expose:n}){const l=w(!1),c=w(0),o=[{label:"实例设置",icon:La},{label:"插件/模组",icon:pn},{label:"服务器属性",icon:vn},{label:"定时任务",icon:ft}];return n({open:()=>{l.value=!0}}),(f,u)=>{const d=v("t-dialog");return r(),j(d,{visible:l.value,"onUpdate:visible":u[0]||(u[0]=m=>l.value=m),header:"实例配置",width:"90%",top:"3vh",attach:"body",footer:!1,class:"settings-dialog"},{default:a(()=>[t("div",bg,[t("div",wg,[(r(),C(pe,null,ye(o,(m,b)=>t("div",{key:b,class:we(["nav-item",{active:c.value===b}]),onClick:S=>c.value=b},[(r(),j(st(m.icon),{class:"nav-icon"})),t("span",$g,M(m.label),1)],10,kg)),64))]),t("div",Ag,[c.value===0?(r(),C("div",xg,[e(C1)])):O("",!0),c.value===1?(r(),C("div",Cg,[e(uf)])):O("",!0),c.value===2?(r(),C("div",Sg,[e(kf,{"instance-id":21})])):O("",!0),c.value===3?(r(),C("div",Ig,[e(yg)])):O("",!0)])])]),_:1},8,["visible"])}}}),Mg=oe(Vg,[["__scopeId","data-v-7ac73b7c"]]),Lg={class:"monitor-container"},Ug={class:"status-header"},Bg={class:"status-text"},Rg={class:"monitor-content"},Eg={class:"monitor-block"},Pg={class:"info-item"},zg={class:"label"},Fg={class:"value"},Tg={class:"monitor-block"},Dg={class:"info-item"},Og={class:"label"},jg={class:"value"},Kg={key:0,class:"sub-val"},Jt=20,qg=ne({__name:"InstanceMonitor",props:{serverId:{},maxMemory:{},isRunning:{type:Boolean}},setup(s){const n=s,l=qa(),c=w(null),o=w(null);let i=null,f=null;const u=w(new Array(Jt).fill(0)),d=w(new Array(Jt).fill(0)),m=te(()=>n.maxMemory>0),b=(E,B,p=100)=>({grid:{top:4,right:0,bottom:4,left:0},xAxis:{type:"category",show:!1,boundaryGap:!1},yAxis:{type:"value",min:0,max:p===null?void 0:p,show:!1},series:[{type:"line",data:B,smooth:!0,showSymbol:!1,lineStyle:{width:2,color:E},areaStyle:{color:new Rs(0,0,0,1,[{offset:0,color:E.replace(")",", 0.2)").replace("rgb","rgba")},{offset:1,color:"transparent"}])}}]}),S=()=>{const E=getComputedStyle(document.documentElement),B=E.getPropertyValue("--td-brand-color").trim()||"#0052d9",p=E.getPropertyValue("--td-warning-color").trim()||"#e37318";if(c.value&&(i=ea(c.value),i.setOption(b(B,u.value,100))),o.value){f=ea(o.value);const A=m.value?100:null;f.setOption(b(p,d.value,A))}window.addEventListener("resize",k)},k=()=>{i?.resize(),f?.resize()},I=te(()=>{const E=l.stats.memBytes/1024/1024;return E>1024?`${(E/1024).toFixed(2)} GB`:`${E.toFixed(0)} MB`}),g=async()=>{n.isRunning&&n.serverId&&(l.setMaxMemory(n.maxMemory),await l.connect(n.serverId))},V=async()=>{await l.disconnect()};return be(()=>n.maxMemory,E=>{if(l.setMaxMemory(E),f){const B=E>0?100:null;f.setOption({yAxis:{max:B===null?void 0:B}})}},{immediate:!0}),be(()=>l.stats,E=>{if(!(!n.isRunning||l.currentServerId!==n.serverId)){if(u.value.push(E.cpu),u.value.length>Jt&&u.value.shift(),m.value)d.value.push(E.memPercent);else{const B=E.memBytes/1024/1024;d.value.push(B)}d.value.length>Jt&&d.value.shift(),i?.setOption({series:[{data:u.value}]}),f?.setOption({series:[{data:d.value}]})}},{deep:!0}),be(()=>n.isRunning,async E=>{E?vt(()=>{k(),g()}):(u.value.fill(0),d.value.fill(0),i?.setOption({series:[{data:u.value}]}),f?.setOption({series:[{data:d.value}]}),await V())}),be(()=>n.serverId,async(E,B)=>{E!==B&&(await V(),n.isRunning&&await g())}),ke(async()=>{await vt(),S(),n.isRunning&&await g()}),Je(async()=>{window.removeEventListener("resize",k),await V(),i?.dispose(),f?.dispose()}),(E,B)=>(r(),C("div",Lg,[t("div",Ug,[t("span",Bg,[y(l).isConnected?(r(),j(y(Na),{key:0,style:{color:"var(--td-success-color)"}})):(r(),j(y(Na),{key:1,style:{color:"var(--td-text-color-disabled)"}})),_(" "+M(y(l).isConnected?"连接正常":"正在连接数据流..."),1)]),t("div",{class:we(["monitor-dot",{active:y(l).isConnected&&s.isRunning}])},null,2)]),t("div",Rg,[t("div",Eg,[t("div",Pg,[t("div",zg,[e(y(wa)),B[0]||(B[0]=_(" CPU 使用率",-1))]),t("div",Fg,M(y(l).stats.cpu.toFixed(1))+" %",1)]),t("div",{ref_key:"cpuChartRef",ref:c,class:"chart-wrapper"},null,512)]),B[2]||(B[2]=t("div",{class:"divider"},null,-1)),t("div",Tg,[t("div",Dg,[t("div",Og,[e(y(fn)),B[1]||(B[1]=_(" 内存使用",-1))]),t("div",jg,[_(M(I.value)+" ",1),m.value?(r(),C("span",Kg," ("+M(y(l).stats.memPercent.toFixed(1))+"%) ",1)):O("",!0)])]),t("div",{ref_key:"memChartRef",ref:o,class:"chart-wrapper"},null,512)])])]))}}),Ng=oe(qg,[["__scopeId","data-v-ddbf668d"]]);async function Gg(s){return await Q.get({url:"/api/tools/ai/usage",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${s}`}})}async function Hg(s){return await Q.get({url:"/api/tools/ai/models",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${s}`}})}async function Jg(s,n,l,c,o,i){return n===""&&(n=null),l===""&&(l=null),await Q.post({url:"/api/tools/ai/analysis",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${s}`},data:{mods:n,plugins:l,core:c,logs:o,model:i,usemd:!0},timeout:300*1e3})}const Wg={class:"analysis-container"},Xg={class:"panel-left"},Qg={class:"form-group"},Yg={class:"model-option-item"},Zg={class:"form-group"},e_={class:"form-group"},t_={class:"env-tabs"},a_={class:"form-group flex-grow"},s_={class:"action-bar"},n_={class:"panel-right"},l_={class:"panel-header"},o_={class:"stats-tags"},r_={class:"report-content"},i_=ne({__name:"LogAnalysis",props:{visible:{type:Boolean},serverId:{}},emits:["update:visible","submit"],setup(s,{emit:n}){const l=Qe(),c=s,o=n,i=He({coreVersion:"",envType:"mods",modsList:"",pluginsList:"",logContent:"",result:"> ✨ 等待日志分析开始······",selectedModel:"qwen-flash"}),f=w([]),u=He({max:0,today:0,extra:0,lastTime:0}),d=w(!1),m=w(!1),b=w(!1);async function S(){const B=await Gg(localStorage.getItem("msl-user-token"));if(B.code===200)u.max=B.data.max_per_day,u.extra=B.data.extra_tokens,u.lastTime=B.data.last_use_time,u.today=B.data.today_usage;else{P.error("MSL账号未登录或已失效，请重新登录！"),Ae("/frp/create");return}}async function k(){try{m.value=!0,await S();try{const p=await Hg(localStorage.getItem("msl-user-token")||"");p.code===200&&(f.value=p.data,!i.selectedModel&&f.value.length>0&&(i.selectedModel=f.value[0].name))}catch(p){P.error("获取模型列表失败"+p.message)}const B=await Ts(c.serverId);i.coreVersion=B.core;try{const p=await xa(c.serverId,"mods",!1);i.modsList=(p.jarFiles||[]).join(`
`),i.envType="mods"}catch{i.modsList=""}try{const p=await xa(c.serverId,"plugins",!1);i.pluginsList=(p.jarFiles||[]).join(`
`),i.modsList==""&&(i.envType="plugins")}catch{i.pluginsList=""}try{i.logContent=await ra(c.serverId,"logs/latest.log")}catch{}}catch(B){P.error(B.message)}m.value=!1}be(()=>c.visible,B=>{l.name==="InstanceConsole"&&(d.value=B,B&&k())});const I=()=>{o("update:visible",!1)};async function g(){if(i.logContent){if(!i.selectedModel){P.warning("请先选择分析模型");return}b.value=!0,i.result="> ⌛️ 分析日志中··· 请稍等";try{const B=await Jg(localStorage.getItem("msl-user-token"),i.modsList,i.pluginsList,i.coreVersion,i.logContent,i.selectedModel);i.result=B.data.content}catch(B){i.result=`> ❌ 分析出现错误: ${B.message}`}b.value=!1,await S()}}const V=hs(),E=w(V.value?"dark":"light");return be(V,()=>{E.value=V.value?"dark":"light"}),(B,p)=>{const A=v("t-tag"),h=v("t-option"),F=v("t-select"),T=v("t-input"),x=v("t-radio-button"),N=v("t-radio-group"),G=v("t-textarea"),R=v("t-button"),$=v("t-loading"),L=v("t-dialog");return r(),j(L,{visible:d.value,"onUpdate:visible":p[6]||(p[6]=U=>d.value=U),width:"90%",top:"3vh",footer:!1,"close-on-overlay-click":!1,class:"log-analysis-dialog",onClose:I},{header:a(()=>[...p[7]||(p[7]=[t("div",{class:"dialog-title"},[t("span",{style:{display:"flex","align-items":"center",gap:"8px"}}," AI 错误日志分析 ")],-1)])]),default:a(()=>[e($,{loading:m.value},{default:a(()=>[t("div",Wg,[t("div",Xg,[t("div",Qg,[p[8]||(p[8]=t("div",{class:"label"},"选择分析模型",-1)),e(F,{modelValue:i.selectedModel,"onUpdate:modelValue":p[0]||(p[0]=U=>i.selectedModel=U),placeholder:"请选择AI模型",filterable:""},{default:a(()=>[(r(!0),C(pe,null,ye(f.value,U=>(r(),j(h,{key:U.name,value:U.name,label:U.name},{default:a(()=>[t("div",Yg,[t("span",null,M(U.name),1),e(A,{size:"small",variant:"light",theme:"default"},{default:a(()=>[_(" 倍率: "+M(U.rate)+"x ",1)]),_:2},1024)])]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),t("div",Zg,[p[9]||(p[9]=t("div",{class:"label"},"服务端核心/版本",-1)),e(T,{modelValue:i.coreVersion,"onUpdate:modelValue":p[1]||(p[1]=U=>i.coreVersion=U),readonly:"",placeholder:"例如: Arclight 1.21.1"},{"prefix-icon":a(()=>[e(y(Tt))]),_:1},8,["modelValue"])]),t("div",e_,[p[12]||(p[12]=t("div",{class:"label"},"环境列表",-1)),t("div",t_,[e(N,{modelValue:i.envType,"onUpdate:modelValue":p[2]||(p[2]=U=>i.envType=U),variant:"default-filled",class:"custom-radio-group"},{default:a(()=>[e(x,{value:"mods"},{default:a(()=>[e(y(Tt),{class:"mr-1"}),p[10]||(p[10]=_(" 模组 (Mods) ",-1))]),_:1}),e(x,{value:"plugins"},{default:a(()=>[e(y(ha),{class:"mr-1"}),p[11]||(p[11]=_(" 插件 (Plugins) ",-1))]),_:1})]),_:1},8,["modelValue"])]),Xe(e(G,{modelValue:i.modsList,"onUpdate:modelValue":p[3]||(p[3]=U=>i.modsList=U),readonly:"",autosize:{minRows:4,maxRows:6},placeholder:"暂无模组数据...",class:"mt-2 readonly-textarea"},null,8,["modelValue"]),[[et,i.envType==="mods"]]),Xe(e(G,{modelValue:i.pluginsList,"onUpdate:modelValue":p[4]||(p[4]=U=>i.pluginsList=U),readonly:"",autosize:{minRows:4,maxRows:6},placeholder:"暂无插件数据...",class:"mt-2 readonly-textarea"},null,8,["modelValue"]),[[et,i.envType==="plugins"]])]),t("div",a_,[p[13]||(p[13]=t("div",{class:"label"},"错误日志内容",-1)),e(G,{modelValue:i.logContent,"onUpdate:modelValue":p[5]||(p[5]=U=>i.logContent=U),placeholder:"没找到有效日志，您可以手动粘贴日志......",class:"log-textarea"},null,8,["modelValue"])]),t("div",s_,[e(R,{loading:b.value,block:"",theme:"primary",size:"large",onClick:g},{icon:a(()=>[e(y(gn))]),default:a(()=>[p[14]||(p[14]=_(" 开始 AI 诊断 ",-1))]),_:1},8,["loading"])])]),t("div",n_,[t("div",l_,[p[15]||(p[15]=t("span",{class:"title"},"AI 分析报告",-1)),t("div",o_,[e(A,{theme:"default",variant:"light",size:"small"},{icon:a(()=>[e(y(_n))]),default:a(()=>[_(" 今日: "+M(u.today)+" / "+M(u.max),1)]),_:1}),e(A,{theme:"primary",variant:"light",size:"small"},{icon:a(()=>[e(y(Yt))]),default:a(()=>[_(" 额外: "+M(u.extra),1)]),_:1}),e(A,{theme:"warning",variant:"light",size:"small"},{icon:a(()=>[e(y(ft))]),default:a(()=>[_(" 上次: "+M(y(Ds)(u.lastTime)),1)]),_:1})])]),t("div",r_,[e(y(ys),{"editor-id":"report-preview","model-value":i.result,theme:E.value,class:"md-preview-wrapper"},null,8,["model-value","theme"])])])])]),_:1},8,["loading"])]),_:1},8,["visible"])}}}),u_=oe(i_,[["__scopeId","data-v-bbd660a8"]]),d_={class:"sidebar-content"},c_={class:"control-header"},m_={class:"control-actions"},p_={class:"running-action-group"},v_={class:"action-row"},f_={class:"card-content-area"},g_={key:0,class:"info-list"},__={class:"info-item"},h_={class:"label"},y_={class:"value"},b_={class:"info-item"},w_={class:"label"},k_={class:"value"},$_={class:"info-item"},A_={class:"label"},x_={class:"value"},C_={class:"info-item"},S_={class:"label"},I_={class:"value"},V_={class:"info-item"},M_={class:"label"},L_={class:"value"},U_={class:"info-item"},B_={class:"label"},R_={class:"value"},E_={class:"info-item"},P_={class:"label"},z_={class:"value"},F_={key:1,class:"info-item"},T_={class:"label"},D_={class:"info-item"},O_={class:"label"},j_={class:"value"},K_={key:1,class:"monitor-view"},q_={key:1,class:"monitor-placeholder"},N_=ne({__name:"ServerControlPanel",props:{serverId:{},isRunning:{type:Boolean},loading:{type:Boolean},serverInfo:{}},emits:["start","stop","clear-log","refresh-info","backup","force-exit","restart"],setup(s,{emit:n}){const l=s,c=n,o=w(!1),i=w(null),f=w("info"),u=()=>{i.value?.open()},d=()=>{c("refresh-info")},m=w(0);let b=null;const S=I=>{if(!I)return 0;const g=I.match(/^(?:(\d+)\.)?(\d{1,2}):(\d{2}):(\d{2})(?:\.\d+)?$/);return g?parseInt(g[1]||"0",10)*86400+parseInt(g[2])*3600+parseInt(g[3])*60+parseInt(g[4]):0},k=te(()=>{if(m.value<=0)return"00:00:00";const I=Math.floor(m.value/86400),g=new Date(m.value*1e3).toISOString().substr(11,8);return I>0?`${I}天 ${g}`:g});return be(()=>l.serverInfo?.uptime,I=>I&&(m.value=S(I)),{immediate:!0}),be(()=>l.isRunning,I=>{I?b||(b=window.setInterval(()=>m.value++,1e3)):b&&(clearInterval(b),b=null)},{immediate:!0}),Je(()=>{b&&clearInterval(b)}),(I,g)=>{const V=v("t-tag"),E=v("t-button"),B=v("t-dropdown-item"),p=v("t-dropdown-menu"),A=v("t-dropdown"),h=v("t-card"),F=v("t-radio-button"),T=v("t-radio-group");return r(),C("div",d_,[e(h,{bordered:!1,class:"control-card"},{default:a(()=>[t("div",c_,[t("div",{class:we(["status-indicator",{running:s.isRunning}])},[g[10]||(g[10]=t("span",{class:"pulse"},null,-1)),_(M(s.isRunning?"Running":"Stopped"),1)],2),e(V,{theme:s.isRunning?"success":"default",variant:"light",shape:"round"},{default:a(()=>[_(M(s.isRunning?"运行中":"已停止"),1)]),_:1},8,["theme"])]),t("div",m_,[s.isRunning?(r(),C(pe,{key:1},[t("div",p_,[e(E,{class:"stop-btn",theme:"danger",size:"large",loading:s.loading,variant:s.loading?"outline":"base",onClick:g[1]||(g[1]=x=>!s.loading&&I.$emit("stop"))},{icon:a(()=>[e(y(sa))]),default:a(()=>[_(" "+M(s.loading?"停止中...":"停止"),1)]),_:1},8,["loading","variant"]),e(E,{theme:"warning",size:"large",shape:"square",disabled:s.loading,onClick:g[2]||(g[2]=x=>I.$emit("restart"))},{icon:a(()=>[e(y(lt))]),_:1},8,["disabled"])]),s.loading?(r(),j(E,{key:0,class:"force-kill-btn glass-btn",theme:"danger",variant:"outline",block:"",onClick:g[3]||(g[3]=x=>I.$emit("force-exit"))},{icon:a(()=>[e(y(Ma))]),default:a(()=>[g[12]||(g[12]=_(" 强制结束 ",-1))]),_:1})):O("",!0)],64)):(r(),j(E,{key:0,theme:"primary",size:"large",block:"",loading:s.loading,onClick:g[0]||(g[0]=x=>{I.$emit("clear-log"),I.$emit("start")})},{icon:a(()=>[e(y(Kt))]),default:a(()=>[g[11]||(g[11]=_("启动实例 ",-1))]),_:1},8,["loading"])),t("div",v_,[e(E,{class:"glass-btn",variant:"outline",block:"",onClick:g[4]||(g[4]=x=>y(Ae)(`/instance/files/${s.serverId}`))},{icon:a(()=>[e(y(It))]),default:a(()=>[g[13]||(g[13]=_("文件管理 ",-1))]),_:1}),e(E,{class:"glass-btn",variant:"outline",block:"",onClick:u},{icon:a(()=>[e(y(La))]),default:a(()=>[g[14]||(g[14]=_("实例设置 ",-1))]),_:1})]),e(A,{trigger:"click","min-column-width":120,placement:"bottom"},{default:a(()=>[e(E,{theme:"primary",class:"glass-btn",variant:"outline",block:""},{icon:a(()=>[e(y(Is))]),default:a(()=>[g[15]||(g[15]=_("更多功能 ",-1))]),_:1}),e(p,null,{default:a(()=>[e(B,{onClick:g[5]||(g[5]=x=>I.$emit("clear-log"))},{"prefix-icon":a(()=>[e(y(lt))]),default:a(()=>[g[16]||(g[16]=_(" 清空日志 ",-1))]),_:1}),e(B,{disabled:!s.isRunning||s.loading,onClick:g[6]||(g[6]=x=>I.$emit("backup"))},{"prefix-icon":a(()=>[e(y(Ft))]),default:a(()=>[g[17]||(g[17]=_(" 立即备份 ",-1))]),_:1},8,["disabled"]),e(B,{onClick:g[7]||(g[7]=x=>o.value=!0)},{"prefix-icon":a(()=>[e(y(hn))]),default:a(()=>[g[18]||(g[18]=_(" 日志分析 ",-1))]),_:1})]),_:1})]),_:1})])]),_:1}),e(h,{bordered:!1,title:"实例概览",class:"info-card"},{actions:a(()=>[e(T,{modelValue:f.value,"onUpdate:modelValue":g[8]||(g[8]=x=>f.value=x),variant:"default-filled",size:"small"},{default:a(()=>[e(F,{value:"info"},{default:a(()=>[e(y(An)),g[19]||(g[19]=_(" 详情",-1))]),_:1}),e(F,{value:"monitor",disabled:!s.isRunning},{default:a(()=>[e(y(xn)),g[20]||(g[20]=_(" 监控",-1))]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),default:a(()=>[t("div",f_,[f.value==="info"?(r(),C("div",g_,[t("div",__,[t("div",h_,[e(y(yn)),g[21]||(g[21]=_(" 实例名称",-1))]),t("div",y_,M(s.serverInfo?.name),1)]),s.serverInfo?.java!=="none"?(r(),C(pe,{key:0},[t("div",b_,[t("div",w_,[e(y(wa)),g[22]||(g[22]=_(" 内存限制",-1))]),t("div",k_,M(s.serverInfo?.maxM)+" MB",1)]),g[28]||(g[28]=t("div",{class:"proxy-group"},null,-1)),t("div",$_,[t("div",A_,[e(y(bn)),g[23]||(g[23]=_(" 运行端口",-1))]),t("div",x_,M(s.serverInfo?.mcConfig?.serverPort),1)]),t("div",C_,[t("div",S_,[e(y(wn)),g[24]||(g[24]=_(" 游戏难度",-1))]),t("div",I_,[e(V,{theme:"primary"},{default:a(()=>[_(M(s.serverInfo?.mcConfig?.difficulty),1)]),_:1})])]),t("div",V_,[t("div",M_,[e(y(kn)),g[25]||(g[25]=_(" 游戏模式",-1))]),t("div",L_,[e(V,null,{default:a(()=>[_(M(s.serverInfo?.mcConfig?.gamemode),1)]),_:1})])]),t("div",U_,[t("div",B_,[e(y(It)),g[26]||(g[26]=_(" 游戏地图",-1))]),t("div",R_,M(s.serverInfo?.mcConfig?.levelName),1)]),t("div",E_,[t("div",P_,[e(y($n)),g[27]||(g[27]=_(" 正版验证",-1))]),t("div",z_,[e(V,{theme:s.serverInfo?.mcConfig?.onlineMode==="true"?"success":"warning"},{default:a(()=>[_(M(s.serverInfo?.mcConfig?.onlineMode==="true"?"开启":"关闭"),1)]),_:1},8,["theme"])])])],64)):(r(),C("div",F_,[t("div",T_,[e(y(wa)),g[29]||(g[29]=_(" 模式",-1))]),g[30]||(g[30]=t("div",{class:"value"},"自定义模式",-1))])),g[32]||(g[32]=t("div",{class:"proxy-group"},null,-1)),t("div",D_,[t("div",O_,[e(y(ft)),g[31]||(g[31]=_(" 运行时长",-1))]),t("div",j_,M(s.isRunning?k.value:"--:--:--"),1)])])):f.value==="monitor"?(r(),C("div",K_,[s.serverInfo&&s.isRunning?(r(),j(Ng,{key:0,"server-id":s.serverId,"is-running":s.isRunning,"max-memory":s.serverInfo.java==="none"?0:s.serverInfo.maxM||4096},null,8,["server-id","is-running","max-memory"])):(r(),C("div",q_,"实例未运行"))])):O("",!0)])]),_:1}),e(Mg,{ref_key:"settingsRef",ref:i,"server-id":s.serverId,onSuccess:d},null,8,["server-id"]),e(u_,{"server-id":s.serverId,visible:o.value,"onUpdate:visible":g[9]||(g[9]=x=>o.value=x)},null,8,["server-id","visible"])])}}}),G_=oe(N_,[["__scopeId","data-v-fa4380de"]]),H_={class:"console-page"},J_={class:"layout-container"},W_={class:"main-terminal-area"},X_={class:"sidebar-area"},Q_={style:{"line-height":"1.6"}},Y_={style:{"margin-bottom":"12px"}},Z_=ne({__name:"index",setup(s){const n=Qe(),l=Ht(),c=qa(),o=w(parseInt(n.params.serverId)||0),i=w(!1),f=w(!1),u=w(null),d=w(null);async function m(){if(o.value)try{f.value=!0;const A=await Ts(o.value);await l.refreshInstanceList(),i.value=A.status,u.value=A,f.value=!1}catch(A){d.value?.writeln(`\x1B[1;31m[Error] 获取实例信息失败: ${A.message}\x1B[0m`),f.value=!1}}const b=async()=>{f.value=!0;try{d.value?.writeln("\x1B[1;32m[System] 正在发送启动指令...\x1B[0m"),await $t(o.value,"start"),P.success("实例启动指令已发送"),f.value=!1}catch(A){d.value?.writeln(`\x1B[1;31m[Error] 启动失败: ${A.message}\x1B[0m`),f.value=!1}},S=async()=>{f.value=!0;try{d.value?.writeln("\x1B[1;32m[System] 正在发送停止指令...\x1B[0m"),await $t(o.value,"stop"),P.warning("实例停止指令已发送"),f.value=!1}catch(A){d.value?.writeln(`\x1B[1;31m[Error] 停止失败: ${A.message}\x1B[0m`),f.value=!1}},k=async()=>{f.value=!0;try{d.value?.writeln("\x1B[1;32m[System] 正在发送强制退出指令...\x1B[0m"),await $t(o.value,"forceExit"),P.warning("强制退出指令已发送"),f.value=!1}catch(A){d.value?.writeln(`\x1B[1;31m[Error] 强制退出失败: ${A.message}\x1B[0m`),f.value=!1}},I=async()=>{f.value=!0;try{d.value?.writeln("\x1B[1;32m[System] 正在发送重启指令...\x1B[0m"),await $t(o.value,"restart"),P.warning("重启执行成功"),f.value=!1}catch(A){d.value?.writeln(`\x1B[1;31m[Error] 重启失败: ${A.message}\x1B[0m`),f.value=!1}},g=async()=>{try{d.value?.writeln("\x1B[1;32m[System] 正在发送备份任务...\x1B[0m"),await $t(o.value,"backup"),P.success("备份任务启动中···"),f.value=!1}catch(A){d.value?.writeln(`\x1B[1;31m[Error] 备份任务启动失败: ${A.message}\x1B[0m`)}},V=()=>{d.value?.clear()},E=w(!1),B=async()=>{o.value&&(c.onEula(()=>{E.value=!0}),await c.connect(o.value))},p=async A=>{try{E.value=!1,await $t(o.value,`agreeEula?${A}`),P.success(A?"已发送同意请求":"已发送请求")}catch(h){P.error(h.message||"发送失败")}};return be(()=>n.params.serverId,async A=>{n.name==="InstanceConsole"&&A&&(o.value=parseInt(A),await m())}),ke(async()=>{o.value&&(await m(),await B())}),(A,h)=>{const F=v("t-link"),T=v("t-dialog");return r(),C("div",H_,[t("div",J_,[t("div",W_,[e(wv,{ref_key:"terminalRef",ref:d,"server-id":o.value,onUpdate:h[0]||(h[0]=x=>m())},null,8,["server-id"])]),t("div",X_,[e(G_,{"server-id":o.value,"is-running":i.value,loading:f.value,"server-info":u.value,onStart:b,onStop:S,onBackup:g,onClearLog:V,onForceExit:k,onRestart:I},null,8,["server-id","is-running","loading","server-info"])])]),e(T,{visible:E.value,"onUpdate:visible":h[1]||(h[1]=x=>E.value=x),header:"是否同意EULA","confirm-btn":{content:"同意",theme:"primary"},"cancel-btn":{content:"不同意",theme:"default"},onConfirm:h[2]||(h[2]=x=>p(!0)),onCancel:h[3]||(h[3]=x=>p(!1))},{default:a(()=>[t("div",Q_,[t("p",Y_,[h[5]||(h[5]=_(" 开启Minecraft服务器需要您同意 ",-1)),h[6]||(h[6]=t("strong",null,"EULA",-1)),h[7]||(h[7]=_(" ！",-1)),e(F,{theme:"primary",underline:""},{default:a(()=>[...h[4]||(h[4]=[_(" (https://aka.ms/minecrafteula)",-1)])]),_:1})]),h[8]||(h[8]=t("p",{style:{"margin-bottom":"12px"}},[t("strong",{style:{color:"#e34d59"}},"请您务必认真仔细阅读！")],-1)),h[9]||(h[9]=t("p",{style:{"margin-bottom":"12px"}},[t("strong",null,"注意："),_("不论您选择是或否，服务器都会在您操作后继续运行。")],-1)),h[10]||(h[10]=t("p",{style:{"margin-bottom":"12px",color:"#f59a23"}},[_(" ⚠️ 如果您"),t("strong",null,"未同意 EULA"),_("，服务器可能会在运行时自动关闭！ ")],-1)),h[11]||(h[11]=t("p",{style:{"margin-top":"16px"}},[_("💡 提示：如要在每次启动实例时忽略此提示，请在"),t("strong",null,"设置"),_("里进行配置。")],-1))])]),_:1},8,["visible"])])}}}),eh=oe(Z_,[["__scopeId","data-v-4ce7e6e4"]]),th=Object.freeze(Object.defineProperty({__proto__:null,default:eh},Symbol.toStringTag,{value:"Module"})),ah={class:"image-wrapper"},sh=["src","alt"],nh={key:1,class:"loading-placeholder"},lh=ne({__name:"ImagePreview",props:{visible:{type:Boolean},fileName:{},imageBlobUrl:{}},emits:["update:visible"],setup(s,{emit:n}){const l=n,c=()=>{l("update:visible",!1)};return(o,i)=>{const f=v("t-dialog");return r(),j(f,{visible:s.visible,header:s.fileName,footer:!1,width:"auto",top:"10vh",class:"image-preview-dialog",onClose:c},{default:a(()=>[t("div",ah,[s.imageBlobUrl?(r(),C("img",{key:0,src:s.imageBlobUrl,alt:s.fileName},null,8,sh)):(r(),C("div",nh,"加载中..."))])]),_:1},8,["visible","header"])}}}),oh=oe(lh,[["__scopeId","data-v-9d5acf17"]]),rh={key:0,class:"compress-form"},ih={class:"file-list-preview"},uh={class:"actions"},dh={key:1,class:"progress-view"},ch={class:"status-icon"},mh={class:"status-text"},ph=ne({__name:"FileCompressor",props:{visible:{type:Boolean},instanceId:{},currentPath:{},files:{}},emits:["update:visible","success"],setup(s,{emit:n}){const l=s,c=n,o=w(""),i=w("idle"),f=w(0),u=w("");let d=null;be(()=>l.visible,I=>{I?(i.value="idle",f.value=0,u.value="",l.files.length>0&&(o.value=`${l.files[0]}_packed.zip`)):m()});const m=()=>{d&&(clearInterval(d),d=null)},b=async()=>{if(!o.value.trim()){P.warning("请输入压缩包名称");return}let I=o.value;I.endsWith(".zip")||(I+=".zip"),i.value="processing",f.value=0,u.value="正在提交任务...";try{const V=(await xo(l.instanceId,l.files,I,l.currentPath)).taskId;if(V)S(V);else throw new Error("未获取到任务ID")}catch(g){i.value="error",u.value=g.message||"提交失败"}},S=I=>{d=window.setInterval(async()=>{try{const g=await Co(I);f.value=g.progress,u.value=g.message,g.status==="success"?(m(),i.value="success",f.value=100,setTimeout(()=>{c("success"),c("update:visible",!1)},1e3)):g.status==="error"&&(m(),i.value="error")}catch(g){console.error(g)}},1e3)},k=()=>{i.value==="processing"&&P.warning("后台任务仍在进行中，关闭窗口不会取消任务"),m(),c("update:visible",!1)};return Je(()=>m()),(I,g)=>{const V=v("t-input"),E=v("t-button"),B=v("t-loading"),p=v("t-progress"),A=v("t-dialog");return r(),j(A,{visible:s.visible,header:i.value==="idle"?"创建压缩包":"正在压缩",footer:!1,"close-on-overlay-click":!1,width:"480px",onClose:k},{default:a(()=>[i.value==="idle"?(r(),C("div",rh,[t("div",ih,[g[1]||(g[1]=_(" 即将压缩 ",-1)),t("span",null,M(s.files.length),1),g[2]||(g[2]=_(" 个文件/文件夹 ",-1))]),e(V,{modelValue:o.value,"onUpdate:modelValue":g[0]||(g[0]=h=>o.value=h),placeholder:"请输入文件名",suffix:".zip",autofocus:"",onEnter:b},null,8,["modelValue"]),t("div",uh,[e(E,{theme:"default",variant:"text",onClick:k},{default:a(()=>[...g[3]||(g[3]=[_("取消",-1)])]),_:1}),e(E,{theme:"primary",onClick:b},{default:a(()=>[...g[4]||(g[4]=[_("开始压缩",-1)])]),_:1})])])):(r(),C("div",dh,[t("div",ch,[i.value==="processing"?(r(),j(B,{key:0})):i.value==="success"?(r(),j(y(na),{key:1,style:{color:"var(--td-success-color)","font-size":"40px"}})):i.value==="error"?(r(),j(y(Vs),{key:2,style:{color:"var(--td-error-color)","font-size":"40px"}})):O("",!0)]),t("div",mh,M(u.value),1),e(p,{theme:"plump",percentage:f.value,status:i.value==="error"?"error":i.value==="success"?"success":"active"},null,8,["percentage","status"])]))]),_:1},8,["visible","header"])}}}),vh=oe(ph,[["__scopeId","data-v-da286579"]]),fh={class:"decompress-container"},gh={class:"file-info"},_h={class:"value"},hh={key:0,class:"form-item"},yh={key:1,class:"switch-row"},bh={key:2,class:"progress-area"},wh={class:"status-header"},kh={class:"status-text"},$h={class:"status-percent"},Ah={key:3,class:"actions"},xh=ne({__name:"FileDecompress",props:{visible:{type:Boolean},instanceId:{},currentPath:{},fileName:{}},emits:["update:visible","success"],setup(s,{emit:n}){const l=s,c=n,o=te({get:()=>l.visible,set:p=>c("update:visible",p)}),i=w("auto"),f=w(!0),u=w(!1),d=w(0),m=w(""),b=w("");let S=null;const k=[{label:"自动检测 (推荐)",value:"auto"},{label:"UTF-8 (Linux/Mac通用)",value:"utf-8"},{label:"GBK (Windows传统)",value:"gbk"}],I=()=>{i.value="auto",f.value=!0,u.value=!1,d.value=0,m.value="",b.value="",S&&(clearInterval(S),S=null)};be(()=>l.visible,p=>{p&&I()});const g=()=>{S&&(clearInterval(S),S=null)},V=async()=>{if(!u.value)try{u.value=!0,m.value="正在提交任务...";const p=await So(l.instanceId,l.fileName,l.currentPath,i.value,f.value);if(p&&p.taskId)b.value=p.taskId,S=window.setInterval(E,1e3);else throw new Error("未能获取任务ID")}catch(p){P.error(p.message||"提交失败"),u.value=!1}},E=async()=>{if(b.value)try{const p=await Io(b.value);d.value=p.progress||0,m.value=p.message,p.status==="success"?(g(),P.success("解压成功"),d.value=100,setTimeout(()=>{o.value=!1,c("success")},800)):p.status==="error"&&(g(),u.value=!1,P.error(p.message||"解压出错"))}catch(p){console.error("轮询失败",p)}},B=()=>{u.value&&d.value<100&&P.warning("解压正在后台进行中"),g(),o.value=!1};return(p,A)=>{const h=v("t-select"),F=v("t-switch"),T=v("t-progress"),x=v("t-button"),N=v("t-dialog");return r(),j(N,{visible:o.value,"onUpdate:visible":A[2]||(A[2]=G=>o.value=G),header:"解压文件",footer:!1,"close-on-overlay-click":!u.value,"on-close":B,width:"480px"},{default:a(()=>[t("div",fh,[t("div",gh,[A[3]||(A[3]=t("span",{class:"label"},"目标文件：",-1)),t("span",_h,M(s.fileName),1)]),u.value?O("",!0):(r(),C("div",hh,[A[4]||(A[4]=t("span",{class:"label"},"文件名编码",-1)),e(h,{modelValue:i.value,"onUpdate:modelValue":A[0]||(A[0]=G=>i.value=G),options:k},null,8,["modelValue"])])),u.value?O("",!0):(r(),C("div",yh,[A[5]||(A[5]=t("div",{class:"switch-info"},[t("span",{class:"switch-label"},"创建同名文件夹"),t("span",{class:"switch-tip"},"推荐开启，防止文件散乱在当前目录")],-1)),e(F,{modelValue:f.value,"onUpdate:modelValue":A[1]||(A[1]=G=>f.value=G)},null,8,["modelValue"])])),u.value?(r(),C("div",bh,[t("div",wh,[t("span",kh,M(m.value),1),t("span",$h,M(d.value)+"%",1)]),e(T,{theme:"line",percentage:d.value,label:!1,status:d.value===100?"success":"active"},null,8,["percentage","status"])])):O("",!0),u.value?O("",!0):(r(),C("div",Ah,[e(x,{variant:"outline",onClick:B},{default:a(()=>[...A[6]||(A[6]=[_("取消",-1)])]),_:1}),e(x,{theme:"primary",onClick:V},{default:a(()=>[...A[7]||(A[7]=[_("开始解压",-1)])]),_:1})]))])]),_:1},8,["visible","close-on-overlay-click"])}}}),Ch=oe(xh,[["__scopeId","data-v-9c603684"]]),Sh={class:"permission-form"},Ih={class:"presets"},Vh={class:"preset-list"},Mh={key:0,class:"preset-desc"},Lh={key:1,class:"preset-desc"},Uh={key:2,class:"preset-desc"},Bh=ne({__name:"FilePermission",props:{visible:{type:Boolean},instanceId:{},currentPath:{},targets:{}},emits:["update:visible","success"],setup(s,{emit:n}){const l=s,c=n,o=w({mode:"755"}),i=w(!1),f=[{label:"755 (推荐: 所有者读写执/他人读执)",value:"755"},{label:"777 (全开: 所有权限)",value:"777"},{label:"644 (普通文件: 读写/读)",value:"644"}],u=te(()=>l.targets.length===1?`修改权限 - ${l.targets[0].name}`:`批量修改权限 (${l.targets.length} 项)`);be(()=>l.visible,S=>{S&&l.targets.length>0&&(l.targets.length===1&&l.targets[0].mode&&l.targets[0].mode!=="Unknown"?o.value.mode=l.targets[0].mode:o.value.mode="755")});const d=()=>{c("update:visible",!1),i.value=!1},m=async()=>{if(!o.value.mode||!/^[0-7]{3}$/.test(o.value.mode)){P.warning("请输入正确的3位八进制权限码 (如 755)");return}i.value=!0;let S=0,k=0;try{for(const I of l.targets)try{await Vo(b,I.fullPath,o.value.mode),S++}catch(g){k++,console.error(g)}k===0?P.success("权限修改成功"):P.warning(`完成: 成功 ${S} 个, 失败 ${k} 个`),c("success"),d()}catch(I){P.error(I.message||"请求失败")}finally{i.value=!1}},b=l.instanceId;return(S,k)=>{const I=v("t-input"),g=v("t-form-item"),V=v("t-tag"),E=v("t-dialog");return r(),j(E,{visible:s.visible,header:u.value,"confirm-btn":{content:"保存修改",loading:i.value},"on-close":d,"on-confirm":m,width:"480px"},{default:a(()=>[t("div",Sh,[e(g,{label:"权限代码","required-mark":""},{default:a(()=>[e(I,{modelValue:o.value.mode,"onUpdate:modelValue":k[0]||(k[0]=B=>o.value.mode=B),placeholder:"例如: 755",tips:"请输入3位八进制数字 (Linux Chmod)"},null,8,["modelValue"])]),_:1}),t("div",Ih,[k[1]||(k[1]=t("div",{class:"preset-label"},"快捷设置：",-1)),t("div",Vh,[(r(),C(pe,null,ye(f,B=>e(V,{key:B.value,variant:"light-outline",theme:"primary",class:"preset-tag",style:{cursor:"pointer"},onClick:p=>o.value.mode=B.value},{default:a(()=>[_(M(B.value),1)]),_:2},1032,["onClick"])),64))]),o.value.mode==="755"?(r(),C("div",Mh,"适合可执行程序、脚本或文件夹")):O("",!0),o.value.mode==="644"?(r(),C("div",Lh,"适合普通配置文件、日志等")):O("",!0),o.value.mode==="777"?(r(),C("div",Uh,"允许任何人写入 (不安全)")):O("",!0)])])]),_:1},8,["visible","header","confirm-btn"])}}}),Rh=oe(Bh,[["__scopeId","data-v-6dc7353c"]]),Eh={class:"file-manager-wrapper"},Ph={class:"toolbar"},zh={class:"breadcrumb-area"},Fh={class:"actions-area"},Th={key:0},Dh={key:0},Oh={key:0},jh={class:"table-wrapper"},Kh=["onClick"],qh={class:"name-text"},Nh={class:"op-actions"},Gh={key:0,class:"selection-bar"},Hh={key:0,class:"selection-info"},Jh={key:1,class:"selection-info"},Wh={class:"selection-actions"},Xh={key:0},Qh={key:0},Yh={key:0},Zh={key:0},ey={key:0},ty={key:0},ay={key:1,class:"selection-bar clipboard-bar"},sy={class:"selection-info"},ny={key:0},ly={key:1},oy={class:"selection-actions"},ry=ne({__name:"index",setup(s){const n=Qe(),l=jt(),c=te(()=>Number(n.params.serverFilesId)),o=Fe(),i=w(!1),f=w([]),u=w(""),d=w([]),m=w(window.innerWidth),b=te(()=>m.value<768),S=w(!1),k=w(!1),I=w(!1),g=w(!1),V=w(!1),E=w(!1),B=w(!1),p=w(!1),A=w(!1),h=w(""),F=w(""),T=w(""),x=w(!1),N=w(""),G=w(""),R=w(""),$=w(""),L=w(null),U=w([]),Z=w(""),W=w([]),J=()=>{m.value=window.innerWidth},H=X=>{const q=X.split(".").pop()?.toLowerCase();return["png","jpg","jpeg","gif","ico","webp","bmp","svg"].includes(q||"")},he=X=>{const q=X.split(".").pop()?.toLowerCase();return["zip","jar"].includes(q||"")},Te=X=>{if(X.type==="folder"){const _e=X.name.toLowerCase();return _e==="config"||_e==="settings"?{icon:La,color:"var(--td-warning-color)"}:_e.startsWith("world")||_e==="level"?{icon:Vn,color:"var(--td-success-color)"}:["plugins","mods","libraries"].includes(_e)?{icon:Tt,color:"var(--td-brand-color)"}:["logs","crash-reports","cache","temp"].includes(_e)?{icon:It,color:"var(--td-gray-color-6)"}:{icon:It,color:"var(--td-brand-color)"}}const q=X.name.split(".").pop()?.toLowerCase();return["png","jpg","jpeg","gif","ico","webp"].includes(q||"")?{icon:Cs,color:"var(--td-success-color)"}:["jar","zip","rar","7z","tar","gz"].includes(q||"")?{icon:ga,color:"#722ed1"}:["yml","yaml","json","properties","toml","xml","conf","sh","bat","cmd"].includes(q||"")?{icon:St,color:"var(--td-warning-color)"}:["log","txt","md","lock"].includes(q||"")?{icon:_a,color:"var(--td-gray-color-6)"}:{icon:Yt,color:"var(--td-text-color-secondary)"}},ge=te(()=>f.value.some(X=>X.permission&&X.permission!=="")),Re=te(()=>{const X={colKey:"row-select",type:"multiple",width:b.value?34:40},q={colKey:"name",title:"文件名",ellipsis:!0,width:"auto"},_e={colKey:"operation",title:"操作",width:b.value?50:80,align:"center",fixed:b.value?"right":void 0};return b.value?[X,q,_e]:[X,q,{colKey:"size",title:"大小",width:100,align:"right"},...ge.value?[{colKey:"permission",title:"权限",width:80,align:"center"}]:[],{colKey:"lastModified",title:"修改时间",width:180,align:"center"},_e]}),Ue=te(()=>{const X=u.value.split("/").filter(ze=>ze),q=[{name:"根目录",path:""}];let _e="";return X.forEach(ze=>{_e=_e?`${_e}/${ze}`:ze,q.push({name:ze,path:_e})}),q}),Ee=te(()=>d.value.length>0),Be=X=>{if(X===0)return"-";const q=["B","KB","MB","GB","TB"];let _e=0;for(;X>=1024&&_e<q.length-1;)X/=1024,_e++;return`${X.toFixed(1)} ${q[_e]}`},je=X=>X?new Date(X).toLocaleString():"-",re=async()=>{i.value=!0,d.value=[];try{const X=await yo(c.value,u.value);f.value=X||[]}catch(X){console.error(X)}finally{i.value=!1}},Se=async X=>{G.value&&(window.URL.revokeObjectURL(G.value),G.value="");const q=u.value?`${u.value}/${X}`:X,_e=P.loading("正在加载图片...");try{const ze=await Ao(c.value,q);if(!(ze instanceof Blob))throw new Error("无效数据");G.value=window.URL.createObjectURL(ze),N.value=X,k.value=!0,P.close(_e)}catch{P.close(_e),P.error("加载失败")}},De=async(X,q=!1)=>{if(q){F.value=X,T.value="",S.value=!0;return}if(H(X)){Se(X);return}const _e=u.value?`${u.value}/${X}`:X,ze=P.loading("正在读取文件...");try{const Le=await ra(c.value,_e);F.value=X,T.value=Le,S.value=!0,P.close(ze)}catch(Le){P.close(ze),P.error("读取失败: "+Le.message)}},se=()=>{R.value="",I.value=!0},z=()=>{if(!R.value.trim()){P.warning("请输入文件名");return}I.value=!1,De(R.value,!0)},K=async X=>{x.value=!0;try{const q=u.value?`${u.value}/${F.value}`:F.value;await Ea(c.value,q,X),P.success("保存成功"),S.value=!1,ve()}catch{P.error("保存失败")}finally{x.value=!1}},ae=()=>{h.value="",A.value=!0},me=async()=>{if(!h.value.trim()){P.warning("请输入文件夹名称");return}try{await bo(c.value,u.value,h.value),P.success("文件夹创建成功"),A.value=!1,ve()}catch(X){P.error(`创建失败: ${X.message||"未知错误"}`)}},ee=X=>{L.value={name:X.name,fullPath:u.value?`${u.value}/${X.name}`:X.name},$.value=X.name,g.value=!0},D=async()=>{if(!$.value||!L.value)return;const X=u.value?`${u.value}/${$.value}`:$.value;try{await wo(c.value,L.value.fullPath,X),P.success("重命名成功"),g.value=!1,ve()}catch{P.error("重命名失败")}},ie=X=>{let q=[];if(X?q=[X.name]:q=[...d.value],q.length===0)return;const _e=tt.confirm({header:"确认删除",body:`确定要永久删除这 ${q.length} 项吗？`,theme:"danger",onConfirm:async()=>{try{const ze=q.map(Le=>u.value?`${u.value}/${Le}`:Le);await ko(c.value,ze),P.success("删除成功"),d.value=[],ve(),_e.hide()}catch{P.error("删除失败")}}})},ce=X=>{if(X.type==="folder"){const q=u.value===""?"":"/";u.value=`${u.value}${q}${X.name}`}else H(X.name)?Se(X.name):De(X.name)},$e=X=>{u.value=X},ve=()=>re(),fe=async X=>{let q=[];if(X?q=[X.name]:q=[...d.value],q.length===0)return;const{baseUrl:_e,token:ze}=o,Le=_e.endsWith("/")?_e.slice(0,-1):_e;for(const ot of q){if(f.value.find(rt=>rt.name===ot)?.type==="folder"){P.warning(`暂不支持下载文件夹: ${ot} 请压缩后再下载！`);continue}const ca=u.value?`${u.value}/${ot}`:ot;try{const rt=new URL(`${Le||window.location.origin}/api/files/instance/${c.value}/download`);rt.searchParams.append("path",ca),rt.searchParams.append("x-user-token",ze);const ct=document.createElement("a");ct.href=rt.toString(),ct.style.display="none",ct.download=ot,document.body.appendChild(ct),ct.click(),document.body.removeChild(ct)}catch(rt){console.error(rt),P.error(`创建下载链接失败: ${ot}`)}}X||(d.value=[])},Ce=()=>{d.value.length!==0&&(U.value=[...d.value],E.value=!0)},xe=()=>{d.value=[],ve()},Ie=X=>{Z.value=X.name,B.value=!0},Oe=()=>{ve()},Ke=X=>{if(W.value=[],X)W.value.push({name:X.name,fullPath:u.value?`${u.value}/${X.name}`:X.name,mode:X.permission||"755"});else{if(d.value.length===0)return;d.value.forEach(q=>{const _e=f.value.find(ze=>ze.name===q);_e&&W.value.push({name:_e.name,fullPath:u.value?`${u.value}/${_e.name}`:_e.name,mode:_e.permission||"755"})})}p.value=!0},qe=()=>{d.value=[],ve()},Y=()=>ve(),Ve=w([]),Ye=w("copy"),Ne=w(""),Pe=te(()=>Ve.value.length>0),de=te(()=>u.value===Ne.value),We=()=>{if(d.value.length===0)return;const X=d.value.map(q=>u.value?`${u.value}/${q}`:q);Ve.value=X,Ye.value="copy",Ne.value=u.value,d.value=[],P.info(`已复制 ${X.length} 项，请前往目标目录粘贴`)},ut=()=>{if(d.value.length===0)return;const X=d.value.map(q=>u.value?`${u.value}/${q}`:q);Ve.value=X,Ye.value="move",Ne.value=u.value,d.value=[],P.info(`已剪切 ${X.length} 项，请前往目标目录粘贴`)},kt=()=>{Ve.value=[],Ne.value="",P.info("已取消操作")},dt=async()=>{if(Ve.value.length===0)return;const X=P.loading("正在粘贴中...");try{Ye.value==="copy"?await Lo(c.value,Ve.value,u.value):await Uo(c.value,Ve.value,u.value),P.success("粘贴成功"),Ve.value=[],ve()}catch(q){P.error(`粘贴失败: ${q.message||"未知错误"}`)}finally{P.close(X)}};return be(u,X=>{l.replace({query:{...n.query,path:X||void 0}}),re()}),be(c,()=>{n.name==="InstanceFiles"&&(u.value="",d.value=[],re())}),ke(()=>{const X=n.query.path;window.addEventListener("resize",J),X?u.value=X:re()}),Je(()=>{window.removeEventListener("resize",J)}),(X,q)=>{const _e=v("t-breadcrumb-item"),ze=v("t-breadcrumb"),Le=v("t-button"),ot=v("t-dropdown"),ca=v("t-tag"),rt=v("t-table"),ct=v("t-card"),ma=v("t-input"),pa=v("t-dialog");return r(),C("div",Eh,[e(ct,{bordered:!1,class:"file-manager-card"},{default:a(()=>[t("div",Ph,[t("div",zh,[e(ze,{"max-item-width":b.value?"80px":"150px"},{default:a(()=>[(r(!0),C(pe,null,ye(Ue.value,(le,Bt)=>(r(),j(_e,{key:Bt,class:"crumb-item",onClick:H0=>$e(le.path)},vs({default:a(()=>[_(" "+M(le.name),1)]),_:2},[Bt===0?{name:"icon",fn:a(()=>[e(y(Cn))]),key:"0"}:void 0]),1032,["onClick"]))),128))]),_:1},8,["max-item-width"])]),t("div",Fh,[e(Le,{variant:"outline",size:"medium",onClick:q[0]||(q[0]=le=>y(Ae)(`/instance/console/${c.value}`))},{icon:a(()=>[e(y($s))]),default:a(()=>[b.value?O("",!0):(r(),C("span",Th,"控制台"))]),_:1}),e(ot,{options:[{content:"新建文件",value:"file",onClick:se},{content:"新建文件夹",value:"folder",onClick:ae}]},{default:a(()=>[e(Le,{variant:"outline",size:"medium"},{icon:a(()=>[e(y(Sn))]),default:a(()=>[b.value?O("",!0):(r(),C("span",Dh,"新建"))]),_:1})]),_:1},8,["options"]),e(Le,{theme:"primary",size:"medium",onClick:q[1]||(q[1]=le=>V.value=!0)},{icon:a(()=>[e(y(xs))]),default:a(()=>[b.value?O("",!0):(r(),C("span",Oh,"上传"))]),_:1}),e(Le,{variant:"outline",size:"medium",onClick:ve},{icon:a(()=>[e(y(lt))]),_:1})])]),t("div",jh,[e(rt,{"selected-row-keys":d.value,"onUpdate:selectedRowKeys":q[2]||(q[2]=le=>d.value=le),data:f.value,columns:Re.value,"row-key":"name",loading:i.value,hover:!0,size:"medium",class:"file-table"},{name:a(({row:le})=>[t("div",{class:"file-name-cell",onClick:Pt(Bt=>ce(le),["stop"])},[(r(),j(st(Te(le).icon),{class:"file-icon",style:Vt({color:Te(le).color})},null,8,["style"])),t("span",qh,M(le.name),1)],8,Kh)]),size:a(({row:le})=>[_(M(Be(le.size)),1)]),permission:a(({row:le})=>[le.permission?(r(),j(ca,{key:0,variant:"light",size:"small"},{default:a(()=>[_(M(le.permission),1)]),_:2},1024)):O("",!0)]),lastModified:a(({row:le})=>[_(M(je(le.lastModified)),1)]),operation:a(({row:le})=>[t("div",Nh,[e(ot,{placement:b.value?"bottom-right":"bottom",options:[{content:"解压",value:"decompress",onClick:()=>Ie(le),show:he(le.name)&&le.type!=="folder"},{content:H(le.name)?"预览":"编辑",value:"edit",onClick:()=>H(le.name)?Se(le.name):De(le.name),disabled:le.type==="folder"||he(le.name)},{content:"权限",value:"permission",onClick:()=>Ke(le),show:ge.value},{content:"下载",value:"download",onClick:()=>fe(le)},{content:"重命名",value:"rename",onClick:()=>ee(le)},{content:"删除",value:"delete",theme:"error",onClick:()=>ie(le)}].filter(Bt=>Bt.show!==!1)},{default:a(()=>[e(Le,{variant:"text",shape:"square",size:"medium"},{default:a(()=>[e(y(Is))]),_:1})]),_:1},8,["placement","options"])])]),empty:a(()=>[...q[22]||(q[22]=[t("div",{class:"empty-state"},"暂无文件",-1)])]),_:1},8,["selected-row-keys","data","columns","loading"])])]),_:1}),e(aa,{name:"slide-up"},{default:a(()=>[Ee.value?(r(),C("div",Gh,[b.value?(r(),C("div",Jh,[t("span",null,M(d.value.length),1)])):(r(),C("div",Hh,[q[23]||(q[23]=_(" 已选 ",-1)),t("span",null,M(d.value.length),1),q[24]||(q[24]=_(" 项 ",-1))])),t("div",Wh,[e(Le,{size:"small",variant:"text",theme:"primary",onClick:q[3]||(q[3]=le=>We())},{icon:a(()=>[e(y(Ms))]),default:a(()=>[b.value?O("",!0):(r(),C("span",Xh,"复制"))]),_:1}),e(Le,{size:"small",variant:"text",theme:"primary",onClick:q[4]||(q[4]=le=>ut())},{icon:a(()=>[e(y(In))]),default:a(()=>[b.value?O("",!0):(r(),C("span",Qh,"剪切"))]),_:1}),e(Le,{size:"small",variant:"text",theme:"primary",onClick:q[5]||(q[5]=le=>Ce())},{icon:a(()=>[e(y(ga))]),default:a(()=>[b.value?O("",!0):(r(),C("span",Yh,"压缩"))]),_:1}),e(Le,{size:"small",variant:"text",theme:"primary",onClick:q[6]||(q[6]=le=>fe())},{icon:a(()=>[e(y(_s))]),default:a(()=>[b.value?O("",!0):(r(),C("span",Zh,"下载"))]),_:1}),ge.value?(r(),j(Le,{key:0,size:"small",variant:"text",theme:"primary",onClick:q[7]||(q[7]=le=>Ke())},{icon:a(()=>[e(y(oa))]),default:a(()=>[b.value?O("",!0):(r(),C("span",ey,"权限"))]),_:1})):O("",!0),e(Le,{size:"small",variant:"text",theme:"danger",onClick:q[8]||(q[8]=le=>ie())},{icon:a(()=>[e(y(Lt))]),default:a(()=>[b.value?O("",!0):(r(),C("span",ty,"删除"))]),_:1}),e(Le,{size:"small",variant:"text",onClick:q[9]||(q[9]=le=>d.value=[])},{default:a(()=>[...q[25]||(q[25]=[_("取消",-1)])]),_:1})])])):Pe.value?(r(),C("div",ay,[t("div",sy,[Ye.value==="copy"?(r(),C("span",ny,"准备复制")):(r(),C("span",ly,"准备移动")),t("span",null,M(Ve.value.length),1),q[26]||(q[26]=_(" 项 ",-1))]),t("div",oy,[e(Le,{theme:"primary",disabled:de.value,onClick:dt},{icon:a(()=>[e(y(_a))]),default:a(()=>[q[27]||(q[27]=_(" 粘贴在此处 ",-1))]),_:1},8,["disabled"]),e(Le,{variant:"text",theme:"default",onClick:kt},{icon:a(()=>[e(y(Ia))]),default:a(()=>[q[28]||(q[28]=_(" 取消 ",-1))]),_:1})])])):O("",!0)]),_:1}),e(Os,{visible:S.value,"onUpdate:visible":q[10]||(q[10]=le=>S.value=le),"file-name":F.value,content:T.value,loading:x.value,onSave:K},null,8,["visible","file-name","content","loading"]),e(pa,{visible:I.value,"onUpdate:visible":q[12]||(q[12]=le=>I.value=le),header:"新建文件","on-confirm":z},{default:a(()=>[e(ma,{modelValue:R.value,"onUpdate:modelValue":q[11]||(q[11]=le=>R.value=le),placeholder:"输入文件名",autofocus:!0,onEnter:z},null,8,["modelValue"])]),_:1},8,["visible"]),e(pa,{visible:g.value,"onUpdate:visible":q[14]||(q[14]=le=>g.value=le),header:"重命名","on-confirm":D},{default:a(()=>[e(ma,{modelValue:$.value,"onUpdate:modelValue":q[13]||(q[13]=le=>$.value=le),placeholder:"输入新名称",autofocus:!0,onEnter:D},null,8,["modelValue"])]),_:1},8,["visible"]),e(js,{visible:V.value,"onUpdate:visible":q[15]||(q[15]=le=>V.value=le),"instance-id":c.value,"current-path":u.value,onSuccess:Y},null,8,["visible","instance-id","current-path"]),e(oh,{visible:k.value,"onUpdate:visible":q[16]||(q[16]=le=>k.value=le),"file-name":N.value,"image-blob-url":G.value},null,8,["visible","file-name","image-blob-url"]),e(vh,{visible:E.value,"onUpdate:visible":q[17]||(q[17]=le=>E.value=le),"instance-id":c.value,"current-path":u.value,files:U.value,onSuccess:xe},null,8,["visible","instance-id","current-path","files"]),e(Ch,{visible:B.value,"onUpdate:visible":q[18]||(q[18]=le=>B.value=le),"instance-id":c.value,"current-path":u.value,"file-name":Z.value,onSuccess:Oe},null,8,["visible","instance-id","current-path","file-name"]),e(Rh,{visible:p.value,"onUpdate:visible":q[19]||(q[19]=le=>p.value=le),"instance-id":c.value,"current-path":u.value,targets:W.value,onSuccess:qe},null,8,["visible","instance-id","current-path","targets"]),e(pa,{visible:A.value,"onUpdate:visible":q[21]||(q[21]=le=>A.value=le),header:"新建文件夹","on-confirm":me},{default:a(()=>[e(ma,{modelValue:h.value,"onUpdate:modelValue":q[20]||(q[20]=le=>h.value=le),placeholder:"输入文件夹名称",autofocus:!0,onEnter:me},null,8,["modelValue"])]),_:1},8,["visible"])])}}}),iy=oe(ry,[["__scopeId","data-v-1fa8ea78"]]),uy=Object.freeze(Object.defineProperty({__proto__:null,default:iy},Symbol.toStringTag,{value:"Module"})),dy=ne({name:"FrameBlank"});function cy(s,n,l,c,o,i){return r(),C("div")}const my=oe(dy,[["render",cy]]),py=Object.freeze(Object.defineProperty({__proto__:null,default:my},Symbol.toStringTag,{value:"Module"}));function cs(){return Q.get({url:"/api/user/me"})}function ms(s){return Q.post({url:"/api/user/me/update",data:s})}function vy(){return Q.get({url:"/api/admin/user/list"})}function fy(s){return Q.post({url:"/api/admin/user/create",data:s})}function gy(s,n){return Q.post({url:`/api/admin/user/update/${s}`,data:n})}function _y(s){return Q.post({url:`/api/admin/user/delete/${s}`})}const hy={class:"user-manage"},yy={class:"toolbar"},by={class:"left-action"},wy={class:"right-search"},ky={class:"user-info-cell"},$y={class:"text-info"},Ay={class:"nickname"},xy={class:"username"},Cy={key:0,class:"time-text"},Sy={key:1,class:"time-placeholder"},Iy={class:"op-buttons"},Vy=ne({__name:"index",setup(s){const n=w(!1),l=w([]),c=w(""),o=Fe(),i=w(!1),f=w("create"),u=w(!1),d=He({id:"",username:"",name:"",password:"",role:"admin",resetApiKey:!1}),m={username:[{required:!0,message:"请输入用户名",type:"error"}],role:[{required:!0,message:"请选择角色",type:"error"}],password:[{validator:B=>f.value==="create"&&!B?{result:!1,message:"创建用户时密码必填",type:"error"}:!0}]},b=te(()=>[{colKey:"info",title:"用户信息",width:200,fixed:"left",cell:"info-slot"},{colKey:"role",title:"角色",width:100,cell:"role-slot"},{colKey:"lastLogin",title:"最后登录",width:180,cell:"time-slot",className:"hidden-xs"},{colKey:"op",title:"操作",width:140,fixed:"right",cell:"op-slot"}]),S=te(()=>{if(!c.value)return l.value;const B=c.value.toLowerCase();return l.value.filter(p=>p.username.toLowerCase().includes(B)||p.name&&p.name.toLowerCase().includes(B))}),k=async()=>{n.value=!0;try{const B=await vy();l.value=B}catch(B){P.error(B.message||"获取用户列表失败")}finally{n.value=!1}},I=()=>{f.value="create",d.id="",d.username="",d.name="",d.password="",d.role="admin",d.resetApiKey=!1,i.value=!0},g=B=>{f.value="edit",d.id=B.id,d.username=B.username,d.name=B.name,d.password="",d.role=B.role,d.resetApiKey=!1,i.value=!0},V=async({validateResult:B})=>{if(B===!0){u.value=!0;try{f.value==="create"?(await fy({username:d.username,password:d.password,name:d.name,role:d.role}),P.success("用户创建成功")):(await gy(d.id,{name:d.name,password:d.password||void 0,role:d.role,resetApiKey:d.resetApiKey}),P.success("用户更新成功")),i.value=!1,k()}catch(p){P.error(p.message||"操作失败")}finally{u.value=!1}}},E=B=>{const p=tt.confirm({header:"删除警告",body:`确定要删除用户 "${B.username}" 吗？此操作不可恢复。`,theme:"danger",onConfirm:async()=>{try{p.hide(),await _y(B.id),P.success("删除成功"),k()}catch(A){P.error(A.message||"删除失败")}}})};return ke(()=>{k()}),(B,p)=>{const A=v("t-button"),h=v("t-input"),F=v("t-avatar"),T=v("t-tag"),x=v("t-divider"),N=v("t-table"),G=v("t-card"),R=v("t-form-item"),$=v("t-radio-button"),L=v("t-radio-group"),U=v("t-checkbox"),Z=v("t-form"),W=v("t-dialog");return r(),C("div",hy,[e(G,{bordered:!1,class:"main-card"},{default:a(()=>[t("div",yy,[t("div",by,[e(A,{theme:"primary",onClick:I},{icon:a(()=>[e(y(la))]),default:a(()=>[p[7]||(p[7]=_(" 新增用户 ",-1))]),_:1})]),t("div",wy,[e(h,{modelValue:c.value,"onUpdate:modelValue":p[0]||(p[0]=J=>c.value=J),placeholder:"搜索用户名或昵称",clearable:""},{"prefix-icon":a(()=>[e(y(ba))]),_:1},8,["modelValue"]),e(A,{variant:"text",shape:"square",onClick:k},{icon:a(()=>[e(y(lt))]),_:1})])]),e(N,{"row-key":"id",data:S.value,columns:b.value,loading:n.value,hover:!0,pagination:{defaultPageSize:20,total:S.value.length,showJumper:!0},class:"user-table","table-layout":"auto"},{"info-slot":a(({row:J})=>[t("div",ky,[e(F,{image:J.avatar,size:"40px",shape:"circle","hide-on-load-failed":!1},{default:a(()=>[_(M(J.name?J.name[0].toUpperCase():"U"),1)]),_:2},1032,["image"]),t("div",$y,[t("div",Ay,M(J.name||"未设置昵称"),1),t("div",xy,"@"+M(J.username),1)])])]),"role-slot":a(({row:J})=>[J.role==="admin"?(r(),j(T,{key:0,theme:"success",variant:"light",size:"small",shape:"round"},{default:a(()=>[...p[8]||(p[8]=[_("管理员",-1)])]),_:1})):(r(),j(T,{key:1,theme:"primary",variant:"light",size:"small",shape:"round"},{default:a(()=>[...p[9]||(p[9]=[_("普通用户",-1)])]),_:1}))]),"time-slot":a(({row:J})=>[J.lastLoginTime?(r(),C("span",Cy,M(new Date(J.lastLoginTime).toLocaleString()),1)):(r(),C("span",Sy,"从未登录"))]),"op-slot":a(({row:J})=>[t("div",Iy,[e(A,{variant:"text",theme:"primary",size:"small",onClick:H=>g(J)},{default:a(()=>[...p[10]||(p[10]=[_(" 编辑 ",-1)])]),_:1},8,["onClick"]),e(x,{layout:"vertical"}),e(A,{variant:"text",theme:"danger",size:"small",disabled:J.id===y(o).userInfo.id||J.username==="admin",onClick:H=>E(J)},{default:a(()=>[...p[11]||(p[11]=[_(" 删除 ",-1)])]),_:1},8,["disabled","onClick"])])]),_:1},8,["data","columns","loading","pagination"])]),_:1}),e(W,{visible:i.value,"onUpdate:visible":p[6]||(p[6]=J=>i.value=J),header:f.value==="create"?"新增用户":"编辑用户","confirm-btn":{content:"提交",loading:u.value},"on-confirm":()=>B.$refs.formRef.submit(),width:"480px"},{default:a(()=>[e(Z,{ref:"formRef",data:d,rules:m,"label-align":"top",onSubmit:V},{default:a(()=>[e(R,{label:"用户名",name:"username"},{default:a(()=>[e(h,{modelValue:d.username,"onUpdate:modelValue":p[1]||(p[1]=J=>d.username=J),placeholder:"登录账号",disabled:f.value==="edit"},null,8,["modelValue","disabled"])]),_:1}),e(R,{label:"昵称",name:"name"},{default:a(()=>[e(h,{modelValue:d.name,"onUpdate:modelValue":p[2]||(p[2]=J=>d.name=J),placeholder:"显示名称"},null,8,["modelValue"])]),_:1}),e(R,{label:"角色",name:"role"},{default:a(()=>[e(L,{modelValue:d.role,"onUpdate:modelValue":p[3]||(p[3]=J=>d.role=J),variant:"default-filled"},{default:a(()=>[e($,{value:"user",disabled:""},{default:a(()=>[...p[12]||(p[12]=[_("普通用户",-1)])]),_:1}),e($,{value:"admin"},{default:a(()=>[...p[13]||(p[13]=[_("管理员",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(R,{label:"密码",name:"password",help:f.value==="edit"?"留空则不修改密码":""},{default:a(()=>[e(h,{modelValue:d.password,"onUpdate:modelValue":p[4]||(p[4]=J=>d.password=J),type:"password",placeholder:"设置密码",autocomplete:"new-password"},null,8,["modelValue"])]),_:1},8,["help"]),f.value==="edit"?(r(),j(R,{key:0,label:"API 密钥"},{default:a(()=>[e(U,{modelValue:d.resetApiKey,"onUpdate:modelValue":p[5]||(p[5]=J=>d.resetApiKey=J)},{default:a(()=>[...p[14]||(p[14]=[_("重置该用户的 API Key",-1)])]),_:1},8,["modelValue"])]),_:1})):O("",!0)]),_:1},8,["data"])]),_:1},8,["visible","header","confirm-btn","on-confirm"])])}}}),My=oe(Vy,[["__scopeId","data-v-9c409721"]]),Ly=Object.freeze(Object.defineProperty({__proto__:null,default:My},Symbol.toStringTag,{value:"Module"})),Uy={class:"profile-header"},By={class:"avatar-col"},Ry={class:"info-col"},Ey={class:"main-row"},Py={class:"nickname"},zy={class:"sub-row"},Fy={class:"username"},Ty={key:0,class:"last-login"},Dy={key:0,class:"bound-status"},Oy={key:1},jy=ne({__name:"UserProfileCard",setup(s,{expose:n}){const l=Fe(),c=w(!1),o=w(!1),i=w(!1),f=w(""),u=w(""),d=w("qq"),m=He({id:"",username:"",name:"",avatar:"",role:"",apiKey:"",lastLoginTime:"",openMSLID:""}),b=He({changePassword:!1,newPassword:"",confirmPassword:""}),S=async()=>{c.value=!0;try{const A=await cs();Object.assign(m,A),f.value=A.username;const h=A.avatar&&A.avatar.match(/nk=(\d+)/);h&&h[1]?(d.value="qq",u.value=h[1]):d.value="custom"}catch(A){P.error(A.message||"用户加载失败")}finally{c.value=!1}};be(u,A=>{d.value==="qq"&&A&&(m.avatar=`https://q.qlogo.cn/g?b=qq&nk=${A}&s=640`)});const k=A=>{A==="qq"&&u.value&&(m.avatar=`https://q.qlogo.cn/g?b=qq&nk=${u.value}&s=640`)},I=()=>{m.apiKey&&navigator.clipboard.writeText(m.apiKey).then(()=>{P.success("API Key 已复制")})},g=()=>{const A=tt.confirm({header:"重置 API 密钥",theme:"warning",body:"重置后，所有使用旧 Key 的外部工具将立即失效，确定要继续吗？",onConfirm:async()=>{try{A.hide(),await ms({resetApiKey:!0}),P.success("API Key 重置成功");const h=await cs();m.apiKey=h.apiKey}catch(h){P.error(h.message||"重置失败")}}})},V=async()=>{if(b.changePassword){if(!b.newPassword){P.warning("请输入新密码");return}if(b.newPassword!==b.confirmPassword){P.error("两次输入的密码不一致");return}}const A=m.username!==f.value,h=b.changePassword&&!!b.newPassword;o.value=!0;try{const F={username:m.username,name:m.name,avatar:m.avatar,password:h?b.newPassword:void 0,resetApiKey:!1};await ms(F),b.changePassword=!1,b.newPassword="",b.confirmPassword="",f.value=m.username,P.success("个人信息保存成功"),A||h?tt.alert({header:"重新登录",body:"账号或密码已变更，请重新登录以生效。",confirmBtn:"去登录",onConfirm:async()=>{await l.logout(),window.location.reload()}}):await l.getUserInfo()}catch(F){P.error(F.message)}finally{o.value=!1}};n({initData:S});const E=w(!1),B=async()=>{E.value=!0;try{const A=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);localStorage.setItem("oauth_state",A);const h=`${window.location.origin}/oauth/callback?mode=bind`,F=await Q.get({url:"/api/auth/oauth/url",params:{state:A,callback:h}});F&&F.url?window.location.href=F.url:(P.error(F.message||"获取绑定地址失败"),E.value=!1)}catch(A){P.error(A.message||"请求失败"),E.value=!1}},p=()=>{const A=tt.confirm({header:"解除绑定",theme:"warning",body:"确定要解除与 MSL 账户的绑定吗？解绑后您将无法使用 MSL 账户快捷登录。",onConfirm:async()=>{try{A.hide(),await Q.post({url:"/api/auth/oauth/unbind"}),P.success("解绑成功"),await S()}catch(h){P.error(h.message||"解绑失败")}}})};return(A,h)=>{const F=v("t-avatar"),T=v("t-tag"),x=v("t-divider"),N=v("t-radio-button"),G=v("t-radio-group"),R=v("t-input"),$=v("t-space"),L=v("t-form-item"),U=v("t-button"),Z=v("t-switch"),W=v("t-form"),J=v("t-card");return r(),j(J,{bordered:!1,loading:c.value,class:"settings-card"},{default:a(()=>[t("div",Uy,[t("div",By,[e(F,{image:m.avatar,size:"80px",shape:"circle",class:"user-avatar-shadow"},{default:a(()=>[_(M(m.name?m.name.slice(0,1).toUpperCase():"U"),1)]),_:1},8,["image"])]),t("div",Ry,[t("div",Ey,[t("span",Py,M(m.name||"未设置昵称"),1),m.role==="admin"?(r(),j(T,{key:0,theme:"success",variant:"light",size:"small",shape:"round"},{default:a(()=>[...h[8]||(h[8]=[_("管理员",-1)])]),_:1})):(r(),j(T,{key:1,theme:"primary",variant:"light",size:"small",shape:"round"},{default:a(()=>[...h[9]||(h[9]=[_("普通用户",-1)])]),_:1}))]),t("div",zy,[t("span",Fy,"@"+M(m.username),1),m.lastLoginTime?(r(),C("span",Ty,[e(y(ft)),_(" "+M(new Date(m.lastLoginTime).toLocaleString()),1)])):O("",!0)])])]),e(x),e(W,{ref:"userForm",data:m,"label-width":100,"label-align":"left",onSubmit:V},{default:a(()=>[e(L,{label:"头像设置"},{default:a(()=>[e($,{direction:"vertical",style:{width:"100%"}},{default:a(()=>[e(G,{modelValue:d.value,"onUpdate:modelValue":h[0]||(h[0]=H=>d.value=H),variant:"default-filled",onChange:k},{default:a(()=>[e(N,{value:"qq"},{default:a(()=>[e(y(Mn)),h[10]||(h[10]=_(" QQ头像",-1))]),_:1}),e(N,{value:"custom"},{default:a(()=>[e(y(bt)),h[11]||(h[11]=_(" 链接",-1))]),_:1})]),_:1},8,["modelValue"]),d.value==="qq"?(r(),j(R,{key:0,modelValue:u.value,"onUpdate:modelValue":h[1]||(h[1]=H=>u.value=H),placeholder:"输入QQ号自动获取",type:"number"},{"prefix-icon":a(()=>[e(y(Ln))]),_:1},8,["modelValue"])):(r(),j(R,{key:1,modelValue:m.avatar,"onUpdate:modelValue":h[2]||(h[2]=H=>m.avatar=H),placeholder:"输入图片 URL 链接"},{"prefix-icon":a(()=>[e(y(Un))]),_:1},8,["modelValue"]))]),_:1})]),_:1}),e(L,{label:"用户昵称",name:"name"},{default:a(()=>[e(R,{modelValue:m.name,"onUpdate:modelValue":h[3]||(h[3]=H=>m.name=H),placeholder:"显示的名称"},null,8,["modelValue"])]),_:1}),e(L,{label:"登录账号",name:"username"},{default:a(()=>[e(R,{modelValue:m.username,"onUpdate:modelValue":h[4]||(h[4]=H=>m.username=H),placeholder:"登录唯一标识"},null,8,["modelValue"])]),_:1}),e(L,{label:"API Key",help:"用于第三方工具连接的凭证，请妥善保管"},{default:a(()=>[e(R,{value:m.apiKey,type:i.value?"text":"password",readonly:"",placeholder:"点击重置生成 Key"},{suffix:a(()=>[e(U,{variant:"text",size:"small",onClick:I},{icon:a(()=>[e(y(Ms))]),_:1}),e(U,{variant:"text",theme:"danger",size:"small",onClick:g},{icon:a(()=>[e(y(lt))]),_:1})]),_:1},8,["value","type"])]),_:1}),e(x,{dashed:""}),e(L,{label:"MSL 账户绑定",help:"绑定后可使用 MSL 账户直接登录本控制台"},{default:a(()=>[m.openMSLID&&m.openMSLID!=="0"?(r(),C("div",Dy,[e(T,{theme:"success",variant:"light",size:"medium"},{icon:a(()=>[e(y(yt))]),default:a(()=>[_(" 已绑定 (MSL UID: "+M(m.openMSLID)+") ",1)]),_:1}),e(U,{theme:"danger",variant:"text",size:"small",style:{"margin-left":"12px"},onClick:p},{default:a(()=>[...h[12]||(h[12]=[_(" 解除绑定 ",-1)])]),_:1})])):(r(),C("div",Oy,[e(U,{theme:"primary",variant:"outline",loading:E.value,onClick:B},{icon:a(()=>[e(y(bt))]),default:a(()=>[h[13]||(h[13]=_(" 绑定 MSL 账户 ",-1))]),_:1},8,["loading"])]))]),_:1}),e(x,{dashed:""}),e(L,{label:"修改密码"},{default:a(()=>[e(Z,{modelValue:b.changePassword,"onUpdate:modelValue":h[5]||(h[5]=H=>b.changePassword=H)},null,8,["modelValue"])]),_:1}),b.changePassword?(r(),C(pe,{key:0},[e(L,{label:"新密码","required-mark":""},{default:a(()=>[e(R,{modelValue:b.newPassword,"onUpdate:modelValue":h[6]||(h[6]=H=>b.newPassword=H),type:"password",placeholder:"请输入新密码"},{"prefix-icon":a(()=>[e(y(oa))]),_:1},8,["modelValue"])]),_:1}),e(L,{label:"确认密码","required-mark":""},{default:a(()=>[e(R,{modelValue:b.confirmPassword,"onUpdate:modelValue":h[7]||(h[7]=H=>b.confirmPassword=H),type:"password",placeholder:"请再次输入新密码"},{"prefix-icon":a(()=>[e(y(yt))]),_:1},8,["modelValue"])]),_:1})],64)):O("",!0),e(L,null,{default:a(()=>[e(U,{theme:"primary",type:"submit",loading:o.value,block:"",class:"action-btn"},{default:a(()=>[...h[14]||(h[14]=[_(" 保存个人资料 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["data"])]),_:1},8,["loading"])}}}),Ky=oe(jy,[["__scopeId","data-v-e8f682ba"]]),qy={class:"status-label"},Ny=ne({__name:"SystemSettingsCard",emits:["refresh"],setup(s,{expose:n,emit:l}){const c=Pa(),o=w(!1),i=w(!1),f=He({fireWallBanLocalAddr:!1,openWebConsoleOnLaunch:!0,neoForgeInstallerMirrors:"MSL Mirrors",listenHost:"localhost",listenPort:1027,oAuthMSLClientID:"",oAuthMSLClientSecret:""}),u=[{label:"官方源 (较慢)",value:"Official"},{label:"MSL镜像源 (推荐)",value:"MSL Mirrors"},{label:"MSL镜像源 - 备用",value:"MSL Mirrors Backup"}],d=l,m=async()=>{o.value=!0;try{const I=await vo();Object.assign(f,I)}catch(I){P.error(I.message||"系统设置加载失败")}finally{o.value=!1}},b=async()=>{i.value=!0;try{await fo(f),P.success("系统设置保存成功")}catch(I){P.error(I.message)}finally{i.value=!1}},S=()=>{m(),d("refresh")};n({initData:m});const k=w("");return ke(()=>{k.value=`${window.location.origin}/oauth/callback`}),(I,g)=>{const V=v("t-button"),E=v("t-form-item"),B=v("t-switch"),p=v("t-select"),A=v("t-divider"),h=v("t-input"),F=v("t-icon"),T=v("t-space"),x=v("t-col"),N=v("t-row"),G=v("t-form"),R=v("t-card");return r(),j(R,{bordered:!1,title:"系统偏好设置",loading:o.value,class:"settings-card"},{actions:a(()=>[e(V,{theme:"primary",variant:"text",size:"small",onClick:S},{default:a(()=>[...g[11]||(g[11]=[_("刷新数据",-1)])]),_:1})]),default:a(()=>[e(G,{ref:"sysForm",data:f,"label-width":120,"label-align":"left",onSubmit:b},{default:a(()=>[g[17]||(g[17]=t("div",{class:"group-title"},"守护进程",-1)),e(E,{label:"软件更新",style:{"margin-top":"6px"}},{default:a(()=>[e(V,{theme:"default",loading:y(c).loading,onClick:g[0]||(g[0]=$=>y(c).checkAppUpdate(!0))},{icon:a(()=>[e(y(gs))]),default:a(()=>[g[12]||(g[12]=_(" 检查更新 ",-1))]),_:1},8,["loading"])]),_:1}),e(E,{label:"自动打开控制台",help:"MSLX 守护进程启动成功后，是否自动登录网页端控制台。"},{default:a(()=>[e(B,{modelValue:f.openWebConsoleOnLaunch,"onUpdate:modelValue":g[1]||(g[1]=$=>f.openWebConsoleOnLaunch=$)},null,8,["modelValue"])]),_:1}),e(E,{label:"安装镜像源",help:"选择在自动安装 NeoForge / Forge 时所使用的镜像源。",style:{"margin-top":"6px"}},{default:a(()=>[e(p,{modelValue:f.neoForgeInstallerMirrors,"onUpdate:modelValue":g[2]||(g[2]=$=>f.neoForgeInstallerMirrors=$),options:u},null,8,["modelValue"])]),_:1}),e(A,{dashed:""}),g[18]||(g[18]=t("div",{class:"group-title"},"MSL OAuth 2.0",-1)),e(E,{label:"Client ID",style:{"margin-top":"6px"}},{default:a(()=>[e(h,{modelValue:f.oAuthMSLClientID,"onUpdate:modelValue":g[3]||(g[3]=$=>f.oAuthMSLClientID=$),placeholder:"请输入 Client ID"},{"prefix-icon":a(()=>[e(y(Ct))]),_:1},8,["modelValue"])]),_:1}),e(E,{label:"Client Secret",help:"配置MSL OAuth 2.0后即可使用您的MSL账号一键登录您的MSLX控制台。",style:{"margin-top":"16px"}},{default:a(()=>[e(h,{modelValue:f.oAuthMSLClientSecret,"onUpdate:modelValue":g[4]||(g[4]=$=>f.oAuthMSLClientSecret=$),type:"password",placeholder:"请输入 Client Secret"},{"prefix-icon":a(()=>[e(y(Ga))]),_:1},8,["modelValue"])]),_:1}),e(E,{label:"回调地址",help:"请将此地址复制并填入 MSL用户中心 OAuth应用配置的 [回调地址] 中",style:{"margin-top":"16px"}},{default:a(()=>[e(h,{value:k.value,readonly:"",placeholder:"正在获取当前域名..."},{"prefix-icon":a(()=>[e(y(bt))]),suffix:a(()=>[e(V,{variant:"text",shape:"square",onClick:g[5]||(g[5]=$=>y(Xt)(k.value,!0,"回调地址复制成功"))},{default:a(()=>[e(F,{name:"file-copy"})]),_:1})]),_:1},8,["value"])]),_:1}),e(E,{style:{"margin-top":"6px"},label:"配置教程"},{default:a(()=>[e(T,{align:"center"},{default:a(()=>[e(V,{theme:"default",onClick:g[6]||(g[6]=$=>y(Ae)(y(Ot).msl_oauth))},{icon:a(()=>[e(y(Zt))]),default:a(()=>[g[13]||(g[13]=_(" 配置MSL账号快捷登录教程",-1))]),_:1})]),_:1})]),_:1}),e(A,{dashed:""}),g[19]||(g[19]=t("div",{class:"group-title"},"网络与安全",-1)),e(E,{label:"禁止本地访问",help:"开启后将禁止本地回环地址访问，增强安全性。"},{default:a(()=>[e(T,{align:"center"},{default:a(()=>[e(B,{modelValue:f.fireWallBanLocalAddr,"onUpdate:modelValue":g[7]||(g[7]=$=>f.fireWallBanLocalAddr=$)},null,8,["modelValue"]),t("span",qy,M(f.fireWallBanLocalAddr?"已开启":"已关闭"),1)]),_:1})]),_:1}),e(E,{label:"监听地址设置",help:"设置MSLX守护进程的监听地址。(需要重启守护进程生效,若不明白这是干什么的请一定不要修改！)",style:{"margin-top":"6px"}},{default:a(()=>[e(N,{gutter:16,style:{width:"100%"}},{default:a(()=>[e(x,{span:6},{default:a(()=>[e(h,{modelValue:f.listenHost,"onUpdate:modelValue":g[8]||(g[8]=$=>f.listenHost=$),placeholder:"localhost"},{"prefix-icon":a(()=>[e(y(Ct))]),_:1},8,["modelValue"])]),_:1}),e(x,{span:4,style:{display:"flex","align-items":"center"}},{default:a(()=>[g[14]||(g[14]=t("span",{style:{"margin-right":"8px",color:"var(--td-text-color-secondary)"}},":",-1)),e(h,{modelValue:f.listenPort,"onUpdate:modelValue":g[9]||(g[9]=$=>f.listenPort=$),placeholder:"1027",style:{width:"120px"}},{"prefix-icon":a(()=>[e(y(Ga))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(E,{style:{"margin-top":"6px"},label:"远程访问"},{default:a(()=>[e(T,{align:"center"},{default:a(()=>[e(V,{theme:"default",onClick:g[10]||(g[10]=$=>y(Ae)(y(Ot).remote_access))},{icon:a(()=>[e(y(Zt))]),default:a(()=>[g[15]||(g[15]=_(" 配置远程访问说明",-1))]),_:1})]),_:1})]),_:1}),e(E,null,{default:a(()=>[e(V,{theme:"primary",type:"submit",loading:i.value,block:"",class:"action-btn"},{default:a(()=>[...g[16]||(g[16]=[_(" 保存系统设置 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["data"])]),_:1},8,["loading"])}}}),Gy=oe(Ny,[["__scopeId","data-v-f3a532cd"]]),Hy=ne({__name:"WebPanelStyleCard",setup(s){const n=ia(),l=async(c,o)=>{const i=c[0]?.raw||c.raw;if(!i)return;const f=await n.uploadImage(i);f&&(n.settings[o]=f)};return(c,o)=>{const i=v("t-button"),f=v("t-upload"),u=v("t-input"),d=v("t-form-item"),m=v("t-divider"),b=v("t-slider"),S=v("t-col"),k=v("t-row"),I=v("t-option"),g=v("t-select"),V=v("t-space"),E=v("t-form"),B=v("t-card");return r(),j(B,{bordered:!1,title:"面板自定义样式",description:"背景图相关的样式需要在面板左上角的样式面板中启用背景美化才会生效哦！",loading:y(n).loading,class:"settings-card"},{actions:a(()=>[e(i,{theme:"default",onClick:o[0]||(o[0]=p=>y(Ae)(y(Ot).style))},{icon:a(()=>[e(y(Zt))]),default:a(()=>[o[13]||(o[13]=_(" 设置文档",-1))]),_:1})]),default:a(()=>[e(E,{data:y(n).settings,"label-width":120,"label-align":"left",onSubmit:y(n).saveSettings},{default:a(()=>[o[16]||(o[16]=t("div",{class:"group-title"},"背景图片设置",-1)),e(d,{label:"浅色背景",help:"留空则使用默认的背景图哦～"},{default:a(()=>[e(u,{modelValue:y(n).settings.webPanelStyleLightBackground,"onUpdate:modelValue":o[2]||(o[2]=p=>y(n).settings.webPanelStyleLightBackground=p),placeholder:"输入完整URL地址或者在右边上传图片"},{suffix:a(()=>[e(f,{theme:"custom",action:"","auto-upload":!1,"show-file-list":!1,accept:"image/png, image/jpeg, image/webp",onChange:o[1]||(o[1]=p=>l(p,"webPanelStyleLightBackground"))},{default:a(()=>[e(i,{variant:"text",shape:"square"},{default:a(()=>[e(y(ya))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"深色背景"},{default:a(()=>[e(u,{modelValue:y(n).settings.webPanelStyleDarkBackground,"onUpdate:modelValue":o[4]||(o[4]=p=>y(n).settings.webPanelStyleDarkBackground=p),placeholder:"输入完整URL地址或者在右边上传图片"},{suffix:a(()=>[e(f,{theme:"custom","auto-upload":!1,"show-file-list":!1,accept:"image/png, image/jpeg, image/webp",onChange:o[3]||(o[3]=p=>l(p,"webPanelStyleDarkBackground"))},{default:a(()=>[e(i,{variant:"text",shape:"square"},{default:a(()=>[e(y(ya))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(m,{dashed:""}),o[17]||(o[17]=t("div",{class:"group-title"},"透明度调整 (0.1 - 1.0)",-1)),e(k,{gutter:[32,16]},{default:a(()=>[e(S,{xs:24,sm:12,md:6},{default:a(()=>[e(d,{label:"浅色背景透明度"},{default:a(()=>[e(b,{modelValue:y(n).settings.webPanelStyleLightBackgroundOpacity,"onUpdate:modelValue":o[5]||(o[5]=p=>y(n).settings.webPanelStyleLightBackgroundOpacity=p),min:.1,max:1,step:.01,"tooltip-props":{theme:"light"}},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{xs:24,sm:12,md:6},{default:a(()=>[e(d,{label:"浅色组件透明度"},{default:a(()=>[e(b,{modelValue:y(n).settings.webPanelStyleLightComponentsOpacity,"onUpdate:modelValue":o[6]||(o[6]=p=>y(n).settings.webPanelStyleLightComponentsOpacity=p),min:.1,max:1,step:.01,"tooltip-props":{theme:"light"}},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{xs:24,sm:12,md:6},{default:a(()=>[e(d,{label:"深色背景透明度"},{default:a(()=>[e(b,{modelValue:y(n).settings.webPanelStyleDarkBackgroundOpacity,"onUpdate:modelValue":o[7]||(o[7]=p=>y(n).settings.webPanelStyleDarkBackgroundOpacity=p),min:.1,max:1,step:.01},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{xs:24,sm:12,md:6},{default:a(()=>[e(d,{label:"深色组件透明度"},{default:a(()=>[e(b,{modelValue:y(n).settings.webPanelStyleDarkComponentsOpacity,"onUpdate:modelValue":o[8]||(o[8]=p=>y(n).settings.webPanelStyleDarkComponentsOpacity=p),min:.1,max:1,step:.01},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(m,{dashed:""}),o[18]||(o[18]=t("div",{class:"group-title"},"终端设置(毛玻璃强度/染色设置)",-1)),e(k,{gutter:[32,16]},{default:a(()=>[e(S,{xs:24,sm:12,md:6},{default:a(()=>[e(d,{label:"浅色模式模糊度"},{default:a(()=>[e(b,{modelValue:y(n).settings.webpPanelTerminalBlurLight,"onUpdate:modelValue":o[9]||(o[9]=p=>y(n).settings.webpPanelTerminalBlurLight=p),min:0,max:50,step:1,"input-number-props":{theme:"column",style:"width: 65px"}},{label:a(({value:p})=>[_(M(p)+"px ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(S,{xs:24,sm:12,md:6},{default:a(()=>[e(d,{label:"深色模式模糊度"},{default:a(()=>[e(b,{modelValue:y(n).settings.webpPanelTerminalBlurDark,"onUpdate:modelValue":o[10]||(o[10]=p=>y(n).settings.webpPanelTerminalBlurDark=p),min:0,max:50,step:1,"input-number-props":{theme:"column",style:"width: 65px"}},{label:a(({value:p})=>[_(M(p)+"px ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(S,{xs:24,sm:12,md:6},{default:a(()=>[e(V,null,{default:a(()=>[e(d,{label:"日志染色等级"},{default:a(()=>[e(g,{modelValue:y(n).settings.webPanelColorizeLogLevel,"onUpdate:modelValue":o[11]||(o[11]=p=>y(n).settings.webPanelColorizeLogLevel=p)},{default:a(()=>[e(I,{label:"不染色",value:0}),e(I,{label:"简约染色",value:1}),e(I,{label:"增强染色",value:2})]),_:1},8,["modelValue"])]),_:1}),e(i,{theme:"default",onClick:o[12]||(o[12]=p=>y(Ae)(y(Ot).style_log_colorizer))},{icon:a(()=>[e(y(Bn))]),default:a(()=>[o[14]||(o[14]=_(" 有什么区别？",-1))]),_:1})]),_:1})]),_:1})]),_:1}),e(d,{style:{"margin-top":"24px"}},{default:a(()=>[e(i,{theme:"primary",type:"submit",loading:y(n).submitLoading,block:"",class:"action-btn"},{default:a(()=>[...o[15]||(o[15]=[_(" 应用样式设置 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["data","onSubmit"])]),_:1},8,["loading"])}}}),Jy=oe(Hy,[["__scopeId","data-v-e0f02fd5"]]),Wy={class:"settings-page"},Xy=ne({__name:"index",setup(s){const n=ia(),l=w(),c=w(),o=async()=>{const i=[];l.value&&i.push(l.value.initData()),c.value&&i.push(c.value.initData()),i.push(n.fetchSettings()),await Promise.all(i)};return ke(()=>{o()}),(i,f)=>{const u=v("t-space");return r(),C("div",Wy,[e(u,{direction:"vertical",size:"large",style:{width:"100%"}},{default:a(()=>[e(Ky,{ref_key:"userCardRef",ref:l},null,512),e(Gy,{ref_key:"sysCardRef",ref:c,onRefresh:o},null,512),e(Jy)]),_:1})])}}}),Qy=oe(Xy,[["__scopeId","data-v-5abf49f6"]]),Yy=Object.freeze(Object.defineProperty({__proto__:null,default:Qy},Symbol.toStringTag,{value:"Module"}));async function Zy(){return await Q.get({url:"/build.json",baseURL:"/",params:{t:Date.now()}})}async function eb(){return await Q.get({url:"/query/changelogs?software=MSLX",baseURL:"https://api.mslmc.cn/v3"})}const tb={class:"about-page"},ab={class:"intro-header"},sb={class:"logo-area"},nb={class:"dev-card"},lb={class:"dev-info"},ob={class:"dev-name"},rb={class:"dev-role"},ib=["title"],ub={class:"dev-card"},db={class:"dev-info"},cb={class:"dev-name"},mb={class:"dev-role",style:{background:"var(--td-success-color-1)",color:"var(--td-success-color-7)"}},pb=["title"],vb={key:0,class:"history-timeline"},fb={class:"timeline-content"},gb={style:{display:"flex","align-items":"center",gap:"8px","margin-bottom":"8px"}},_b={class:"commit-time",style:{"margin-bottom":"0"}},hb={class:"msg",style:{"white-space":"pre-wrap","margin-bottom":"0"}},yb={key:1,style:{"text-align":"center",color:"var(--td-text-color-placeholder)",padding:"20px"}},bb={key:0,class:"build-summary"},wb={class:"info-block"},kb={class:"value version"},$b={class:"info-block"},Ab={class:"value time"},xb={class:"info-block"},Cb=["title"],Sb={class:"sub-value"},Ib={class:"info-block"},Vb={class:"value framework"},Mb={key:1,class:"details-collapse"},Lb={class:"panel-header"},Ub={class:"history-timeline"},Bb={class:"timeline-content"},Rb={class:"commit-time"},Eb={class:"msg"},Pb={class:"meta"},zb={class:"hash"},Fb={class:"panel-header"},Tb={class:"deps-grid"},Db={class:"dep-item"},Ob=["title"],jb=ne({__name:"index",setup(s){const n=[{name:"xiaoyu",role:"Core Developer",avatar:"https://q.qlogo.cn/headimg_dl?dst_uin=1791123970&spec=640&img_type=jpg",desc:"核心开发者"},{name:"Weheal",role:"Core Developer",avatar:"https://q.qlogo.cn/headimg_dl?dst_uin=2035582067&spec=640&img_type=jpg",desc:"核心开发者"}],l=[{name:"GuHanDuRen",role:"Alpha Tester",avatar:"https://q.qlogo.cn/headimg_dl?dst_uin=2778318425&spec=640&img_type=jpg",desc:"最早期内部功能测试"},{name:"邱息",role:"Beta Tester",avatar:"https://q.qlogo.cn/headimg_dl?dst_uin=3687624214&spec=640&img_type=jpg",desc:"提供了宝贵的建议"},{name:"Nebula琳",role:"Beta Tester",avatar:"https://q.qlogo.cn/headimg_dl?dst_uin=3770298358&spec=640&img_type=jpg",desc:"提供了宝贵的建议"},{name:"MSLX Beta 群友们",role:"Members",avatar:"https://p.qlogo.cn/gh/839645854/839645854/0",desc:"感谢各位内测群的群友们！"}],c=w(!0),o=w(null),i=w(!0),f=w([]),u=async()=>{try{c.value=!0,o.value=await Zy()}catch(b){console.error(b),P.warning("无法加载构建信息")}finally{c.value=!1}},d=async()=>{try{i.value=!0;const b=await eb();b&&(f.value=b)}catch(b){console.error("获取更新日志失败:",b)}finally{i.value=!1}},m=te(()=>o.value?.dependencies?Object.entries(o.value.dependencies).map(([b,S])=>({name:b,version:S})):[]);return ke(()=>{u(),d()}),(b,S)=>{const k=v("t-card"),I=v("t-avatar"),g=v("t-col"),V=v("t-row"),E=v("t-tag"),B=v("t-timeline-item"),p=v("t-timeline"),A=v("t-divider"),h=v("t-collapse-panel"),F=v("t-collapse"),T=v("t-space");return r(),C("div",tb,[e(T,{direction:"vertical",size:"large",style:{width:"100%"}},{default:a(()=>[e(k,{bordered:!1,class:"intro-card"},{default:a(()=>[t("div",ab,[t("div",sb,[e(y(Ct),{class:"logo-icon"}),S[0]||(S[0]=t("h1",{class:"project-title"},"关于 MSLX",-1))])]),S[1]||(S[1]=t("div",{class:"intro-text"},[t("p",null,[t("strong",null,"MSLX"),_(" 是由 "),t("strong",null,"MSL 原班团队 MSLTeam"),_(" 倾力打造的全新一代开服工具。 基于 "),t("strong",null,".NET Core 10.0"),_(" 环境。 ")]),t("p",null,[_(" 它传承了 MSL 经典的 UI 设计语言，旨在让操作零门槛——无论是老用户还是新伙伴，都能即刻上手，极速部署您的 MC 服务器。 MSLX 不仅 "),t("strong",null,"完美支持跨平台"),_(" (Windows / macOS / Linux) 运行，相比前代，更引入了强大的 "),t("strong",null,"远程访问"),_(" 功能，让管理更自由。 ")])],-1))]),_:1}),e(k,{bordered:!1,title:"开发团队"},{default:a(()=>[S[2]||(S[2]=t("p",{class:"about-desc"},"感谢以下开发者对本项目的杰出贡献：",-1)),e(V,{gutter:[16,16]},{default:a(()=>[(r(),C(pe,null,ye(n,x=>e(g,{key:x.name,span:3,xs:12,sm:6},{default:a(()=>[t("div",nb,[e(I,{image:x.avatar,size:"56px",shape:"circle",class:"dev-avatar"},null,8,["image"]),t("div",lb,[t("div",ob,M(x.name),1),t("div",rb,M(x.role),1),t("div",{class:"dev-desc",title:x.desc},M(x.desc),9,ib)])])]),_:2},1024)),64))]),_:1})]),_:1}),e(k,{bordered:!1,title:"鸣谢"},{default:a(()=>[S[3]||(S[3]=t("p",{class:"about-desc"},"特别感谢参与内测并提供反馈的伙伴们：",-1)),e(V,{gutter:[16,16]},{default:a(()=>[(r(),C(pe,null,ye(l,x=>e(g,{key:x.name,span:3,xs:12,sm:4,md:4,lg:3},{default:a(()=>[t("div",ub,[e(I,{image:x.avatar,size:"56px",shape:"circle",class:"dev-avatar"},null,8,["image"]),t("div",db,[t("div",cb,M(x.name),1),t("div",mb,M(x.role),1),t("div",{class:"dev-desc",title:x.desc},M(x.desc),9,pb)])])]),_:2},1024)),64))]),_:1})]),_:1}),e(k,{bordered:!1,title:"更新日志",loading:i.value},{"header-icon":a(()=>[e(y(Rn))]),default:a(()=>[f.value.length>0?(r(),C("div",vb,[e(p,null,{default:a(()=>[(r(!0),C(pe,null,ye(f.value,(x,N)=>(r(),j(B,{key:N,"dot-color":"primary"},{default:a(()=>[t("div",fb,[t("div",gb,[e(E,{size:"small",variant:"light",theme:"primary"},{default:a(()=>[_(M(x.version),1)]),_:2},1024),t("div",_b,[e(y(ft),{style:{"margin-right":"4px","font-size":"12px"}}),_(" "+M(x.time),1)])]),t("div",hb,M(x.changes),1)])]),_:2},1024))),128))]),_:1})])):i.value?O("",!0):(r(),C("div",yb," 暂无更新日志 "))]),_:1},8,["loading"]),e(k,{bordered:!1,title:"构建信息",loading:c.value},{actions:a(()=>[o.value?(r(),j(E,{key:0,theme:"success",variant:"light"},{icon:a(()=>[e(y(yt))]),default:a(()=>[S[4]||(S[4]=_(" 构建成功 ",-1))]),_:1})):O("",!0)]),default:a(()=>[o.value?(r(),C("div",bb,[e(V,{gutter:[16,16],style:{"align-items":"stretch"}},{default:a(()=>[e(g,{span:3,xs:12,sm:6},{default:a(()=>[t("div",wb,[S[5]||(S[5]=t("div",{class:"label"},"当前版本",-1)),t("div",kb,M(o.value.version),1)])]),_:1}),e(g,{span:3,xs:12,sm:6},{default:a(()=>[t("div",$b,[S[6]||(S[6]=t("div",{class:"label"},"构建时间",-1)),t("div",Ab,[e(y(ft)),_(" "+M(o.value.buildTime),1)])])]),_:1}),e(g,{span:3,xs:12,sm:6},{default:a(()=>[t("div",xb,[S[7]||(S[7]=t("div",{class:"label"},"最新提交",-1)),t("div",{class:"value commit",title:o.value.commitMsg},[e(y(En)),_(" "+M(o.value.commitId.substring(0,7)),1)],8,Cb),t("div",Sb,"by "+M(o.value.commitAuthor),1)])]),_:1}),e(g,{span:3,xs:12,sm:6},{default:a(()=>[t("div",Ib,[S[10]||(S[10]=t("div",{class:"label"},"核心框架",-1)),t("div",Vb,[S[8]||(S[8]=t("span",{class:"dotnet"},".NET 10.0",-1)),e(A,{layout:"vertical"}),S[9]||(S[9]=t("span",{class:"vue"},"Vue 3.x",-1))])])]),_:1})]),_:1})])):O("",!0),o.value?(r(),C("div",Mb,[e(F,{borderless:!0},{default:a(()=>[e(h,{value:"history"},{header:a(()=>[t("div",Lb,[e(y(Pn)),S[11]||(S[11]=_(" 提交日志 (Commit History)",-1))])]),default:a(()=>[t("div",Ub,[e(p,null,{default:a(()=>[(r(!0),C(pe,null,ye(o.value.history,x=>(r(),j(B,{key:x.commitId,"dot-color":"primary"},{default:a(()=>[t("div",Bb,[t("div",Rb,M(x.commitTime),1),t("div",Eb,M(x.commitMsg),1),t("div",Pb,[e(E,{size:"small",style:{padding:"0"}},{default:a(()=>[e(y(Qt)),_(" "+M(x.commitAuthor),1)]),_:2},1024),t("span",zb,"#"+M(x.commitId.substring(0,7)),1)])])]),_:2},1024))),128))]),_:1})])]),_:1}),e(h,{value:"dependencies"},{header:a(()=>[t("div",Fb,[e(y(St)),S[12]||(S[12]=_(" 核心依赖 (Dependencies)",-1))])]),default:a(()=>[t("div",Tb,[e(V,{gutter:[12,12]},{default:a(()=>[(r(!0),C(pe,null,ye(m.value,x=>(r(),j(g,{key:x.name,span:3,xs:12,sm:6,md:4},{default:a(()=>[t("div",Db,[t("span",{class:"dep-name",title:x.name},M(x.name),9,Ob),e(E,{size:"small",variant:"light-outline"},{default:a(()=>[_(M(x.version),1)]),_:2},1024)])]),_:2},1024))),128))]),_:1})])]),_:1})]),_:1})])):O("",!0)]),_:1},8,["loading"])]),_:1})])}}}),Kb=oe(jb,[["__scopeId","data-v-df30b051"]]),qb=Object.freeze(Object.defineProperty({__proto__:null,default:Kb},Symbol.toStringTag,{value:"Module"})),Nb={key:0,class:"loading-wrapper"},Gb={key:1,class:"input-group"},Hb={class:"check-container"},Jb={class:"btn-wrapper"},Wb={key:0,class:"msl-login-wrapper"},Xb={class:"reset-guide"},Qb={class:"guide-item"},Yb={class:"guide-title"},Zb={class:"guide-item"},e0={class:"guide-title"},t0="remembered_url",ps="remembered_username",a0=ne({__name:"Login",setup(s){const n=Fe(),l=Pa(),c=jt(),o=Qe(),i=w(!1),f=w(!1),u=w(!1),d=w(!1),m=w(!0),b=w(!1),S=He({url:localStorage.getItem(t0)||"",username:localStorage.getItem(ps)||"",password:"",checked:!!localStorage.getItem(ps)}),k=w(),I=te(()=>{const B={username:[{required:!0,message:"请输入用户名",type:"error"}],password:[{required:!0,message:"请输入密码",type:"error"}]};return d.value||(B.url=[{required:!0,message:"请输入服务器地址",type:"error"}]),B}),g=async()=>{m.value=!0,await n.checkConnection("")?(d.value=!0,S.url=""):d.value=!1;try{(await Q.get({url:"/api/auth/oauth/status"})).allowOAuth&&(f.value=!0),m.value=!1}catch{m.value=!1}},V=async({validateResult:B})=>{if(B===!0){i.value=!0;try{await n.login({url:d.value?"":S.url,username:S.username,password:S.password,checked:S.checked}),P.success("登录成功");const p=o.query.redirect,A=p?decodeURIComponent(p):"/dashboard/base";c.push(A),As.success({content:`欢迎回来！${n.userInfo.name}`,title:"MSLX 控制台"}),l.checkAppUpdate(!1)}catch(p){P.error(p.message||"登录失败，请检查账号密码")}finally{i.value=!1}}},E=async()=>{try{i.value=!0;const B=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);localStorage.setItem("oauth_state",B);const p=`${window.location.origin}/oauth/callback?mode=login`,A=await Q.get({url:"/api/auth/oauth/url",params:{state:B,callback:p}});if(A&&A.url)window.location.href=A.url;else throw new Error(A.message||"获取授权地址失败")}catch(B){P.error(B.message||"无法连接到认证服务器"),i.value=!1}};return ke(()=>{g()}),(B,p)=>{const A=v("t-loading"),h=v("t-icon"),F=v("t-input"),T=v("t-form-item"),x=v("t-checkbox"),N=v("t-link"),G=v("t-button"),R=v("t-form"),$=v("t-divider"),L=v("t-alert"),U=v("t-dialog");return r(),C("div",null,[e(R,{ref_key:"form",ref:k,class:"login-form",data:S,rules:I.value,"label-width":"0",onSubmit:V},{default:a(()=>[m.value?(r(),C("div",Nb,[e(A,{text:"正在连接服务...",size:"small"})])):(r(),C("div",Gb,[d.value?O("",!0):(r(),j(T,{key:0,name:"url"},{default:a(()=>[e(F,{modelValue:S.url,"onUpdate:modelValue":p[0]||(p[0]=Z=>S.url=Z),size:"large",placeholder:"服务器地址 (如 localhost:1027)",class:"glass-input"},{"prefix-icon":a(()=>[e(h,{name:"server"})]),_:1},8,["modelValue"])]),_:1})),e(T,{name:"username"},{default:a(()=>[e(F,{modelValue:S.username,"onUpdate:modelValue":p[1]||(p[1]=Z=>S.username=Z),size:"large",placeholder:"请输入用户名",class:"glass-input"},{"prefix-icon":a(()=>[e(h,{name:"user"})]),_:1},8,["modelValue"])]),_:1}),e(T,{name:"password"},{default:a(()=>[e(F,{modelValue:S.password,"onUpdate:modelValue":p[3]||(p[3]=Z=>S.password=Z),size:"large",type:u.value?"text":"password",placeholder:"请输入密码",class:"glass-input"},{"prefix-icon":a(()=>[e(h,{name:"lock-on"})]),"suffix-icon":a(()=>[e(h,{name:u.value?"browse":"browse-off",style:{cursor:"pointer"},onClick:p[2]||(p[2]=Z=>u.value=!u.value)},null,8,["name"])]),_:1},8,["modelValue","type"])]),_:1})])),t("div",Hb,[e(x,{modelValue:S.checked,"onUpdate:modelValue":p[4]||(p[4]=Z=>S.checked=Z)},{default:a(()=>[...p[7]||(p[7]=[_("记住用户名",-1)])]),_:1},8,["modelValue"]),e(N,{theme:"primary",hover:"color",onClick:p[5]||(p[5]=Z=>b.value=!0)},{default:a(()=>[...p[8]||(p[8]=[_(" 忘记密码？ ",-1)])]),_:1})]),e(T,{class:"btn-container"},{default:a(()=>[t("div",Jb,[e(G,{block:"",size:"large",type:"submit",class:"login-btn",loading:i.value},{default:a(()=>[...p[9]||(p[9]=[_(" 登 录 ",-1)])]),_:1},8,["loading"]),f.value?(r(),C("div",Wb,[t("a",{class:"msl-link-btn",onClick:E},[e(h,{name:"user-transmit"}),p[10]||(p[10]=t("span",null,"使用 MSL 账户登录",-1))])])):O("",!0)])]),_:1})]),_:1},8,["data","rules"]),e(U,{visible:b.value,"onUpdate:visible":p[6]||(p[6]=Z=>b.value=Z),header:"找回或重置密码",footer:!1,width:"480px",attach:"body"},{default:a(()=>[t("div",Xb,[t("div",Qb,[t("div",Yb,[e(h,{name:"user-talk"}),p[11]||(p[11]=_(" 方式一：联系管理员",-1))]),p[12]||(p[12]=t("p",{class:"guide-desc"},"如果系统中存在其他管理员账号，请联系对应人员协助您在后台重置密码。",-1))]),e($,{dashed:"",style:{margin:"16px 0"}}),t("div",Zb,[t("div",e0,[e(h,{name:"refresh"}),p[13]||(p[13]=_(" 方式二：初始化默认账户",-1))]),p[15]||(p[15]=t("p",{class:"guide-desc"},"若无法联系其他管理员，请在服务器端删除以下配置文件：",-1)),p[16]||(p[16]=t("div",{class:"code-block"},"DaemonData/Configs/UserList.json",-1)),t("p",null,[e(L,{style:{"margin-top":"10px"}},{default:a(()=>[...p[14]||(p[14]=[_("操作提示：删除该文件后，请",-1),t("strong",null,"重启守护进程",-1),_("。系统将自动重新创建包含默认账号密码的初始文件。",-1)])]),_:1})])])])]),_:1},8,["visible"])])}}}),s0=oe(a0,[["__scopeId","data-v-b95f4e77"]]),n0={class:"login-header"},l0={class:"logo"},o0={class:"operations-container"},r0=ne({__name:"Header",setup(s){const n=Ze(),l=()=>{n.updateConfig({showSettingPanel:!0})},c=()=>{window.open("https://github.com/MSLTeam/MSLX")},o=()=>{window.open("https://mslx.mslmc.cn")};return(i,f)=>{const u=v("t-icon"),d=v("t-button");return r(),C("header",n0,[t("span",l0,[t("img",{src:Ra,class:we(`${y(Me)}-side-nav-logo-img`),alt:"logo"},null,2),f[0]||(f[0]=t("span",null," MSLX 管理中心 ",-1))]),t("div",o0,[e(d,{theme:"default",shape:"square",variant:"text",onClick:c},{default:a(()=>[e(u,{name:"logo-github",class:"icon"})]),_:1}),e(d,{theme:"default",shape:"square",variant:"text",onClick:o},{default:a(()=>[e(u,{name:"help-circle",class:"icon"})]),_:1}),e(d,{theme:"default",shape:"square",variant:"text",onClick:l},{default:a(()=>[e(u,{name:"setting",class:"icon"})]),_:1})])])}}}),Ks=oe(r0,[["__scopeId","data-v-a538553e"]]),i0={class:"login-wrapper"},u0={class:"login-content"},d0={class:"login-container"},c0={class:"copyright"},m0={class:"welcome-content"},p0={class:"account-card"},v0={class:"info-row"},f0={class:"label"},g0={class:"info-row"},_0={class:"label"},h0={name:"LoginIndex"},y0=ne({...h0,setup(s){const n=w(!1),l=()=>{n.value=!1;const c=new URL(window.location.href);c.searchParams.delete("initialize"),window.history.replaceState({},"",c)};return ke(()=>{new URLSearchParams(window.location.search).get("initialize")==="true"&&(n.value=!0)}),(c,o)=>{const i=v("t-alert"),f=v("t-button"),u=v("t-dialog");return r(),C("div",i0,[e(Ks,{class:"login-header-fixed"}),t("div",u0,[t("div",d0,[o[1]||(o[1]=t("div",{class:"title-container"},[t("h1",{class:"title"},"连接到 MSLX"),t("p",{class:"sub-title"},"网页管理中心")],-1)),e(s0),t("footer",c0,"Copyright @ 2021-"+M(new Date().getFullYear())+" MSLTeam",1)])]),e(Ba,{class:"tdesign-setting-outside"}),e(u,{visible:n.value,"onUpdate:visible":o[0]||(o[0]=d=>n.value=d),footer:!1,"close-btn":!0,width:"480px",attach:"body",class:"welcome-dialog","on-close":l},{header:a(()=>[...o[2]||(o[2]=[t("div",{class:"dialog-header-row"},[t("span",{class:"emoji-icon"},"🎉"),t("span",{class:"header-text"},"欢迎使用 MSLX 开服器")],-1)])]),default:a(()=>[t("div",m0,[e(i,{theme:"success",class:"security-alert"},{message:a(()=>[...o[3]||(o[3]=[_(" 您似乎是第一次使用？请查阅以下信息，然后开始享受您的MC开服之旅吧～ ",-1)])]),_:1}),t("div",p0,[t("div",v0,[t("span",f0,[e(y(Qt)),o[4]||(o[4]=_(" 默认账户:",-1))]),o[5]||(o[5]=t("span",{class:"value highlight"},"mslx",-1))]),t("div",g0,[t("span",_0,[e(y(oa)),o[6]||(o[6]=_(" 默认密码:",-1))]),o[7]||(o[7]=t("span",{class:"value mono"},"请在MSLX守护进程端控制台查看",-1))])]),e(i,{theme:"warning",class:"security-alert"},{message:a(()=>[...o[8]||(o[8]=[_(" 安全提醒：请登录后",-1),t("b",null,[t("u",null,"立即修改默认的账户名和密码")],-1),_("，保障您的服务安全。 ",-1)])]),_:1}),e(f,{block:"",theme:"primary",size:"large",variant:"base",onClick:l},{icon:a(()=>[e(y(yt))]),default:a(()=>[o[9]||(o[9]=_(" 我已知晓，立即登录 ",-1))]),_:1})])]),_:1},8,["visible"])])}}}),b0=oe(y0,[["__scopeId","data-v-59aa3632"]]),w0=Object.freeze(Object.defineProperty({__proto__:null,default:b0},Symbol.toStringTag,{value:"Module"})),k0={class:"login-wrapper"},$0={class:"login-panel"},A0={class:"login-container"},x0={class:"callback-content"},C0={key:0,class:"status-box"},S0={class:"loading-icon-wrapper"},I0={class:"tip-text"},V0={key:1,class:"status-box success"},M0={class:"desc"},L0={class:"sub-desc"},U0={class:"btn-group"},B0={key:2,class:"status-box error"},R0={class:"error-msg-box"},E0={class:"btn-group"},P0={class:"copyright"},z0=ne({__name:"index",setup(s){const n=Qe(),l=jt(),c=Fe(),o=w("loading"),i=w("正在验证身份..."),f=w(""),u=w(""),d=w(3),m=async()=>{const{code:g,state:V,mode:E}=n.query;if(!g||!V){o.value="error",f.value="无效的回调参数，缺少 Code 或 State。";return}const B=localStorage.getItem("oauth_state");if(localStorage.removeItem("oauth_state"),V!==B){o.value="error",f.value="安全校验失败 (State Mismatch)，请求可能被篡改。";return}try{if(E==="login")await b(g);else if(E==="bind")await S(g);else throw new Error("未知的操作模式")}catch(p){o.value="error",f.value=p.message||"处理请求时发生未知错误"}},b=async g=>{i.value="正在登录 MSLX...";try{const V=await Q.post({url:"/api/auth/oauth/login",data:{code:g}});await c.loginByOAuth(V),o.value="success",u.value=`欢迎回来，${c.userInfo.name||V.data.userInfo?.name}`,k("/dashboard/base")}catch(V){o.value="error",f.value=V.message}},S=async g=>{i.value="正在绑定 MSL 账号...";try{await Q.post({url:"/api/auth/oauth/bind",data:{code:g}}),o.value="success",u.value="账号绑定成功！",await c.getUserInfo(),k("/settings")}catch(V){P.error(V.message)}},k=g=>{const V=setInterval(()=>{d.value--,d.value<=0&&(clearInterval(V),Ae(g))},1e3)},I=()=>{Ae("/login")};return ke(()=>{m()}),(g,V)=>{const E=v("t-loading"),B=v("t-button");return r(),C("div",k0,[e(Ks,{class:"login-header-fixed"}),t("div",$0,[t("div",A0,[V[5]||(V[5]=t("div",{class:"title-container"},[t("h1",{style:{"margin-bottom":"10px"},class:"title"},"MSL 统一身份认证")],-1)),t("div",x0,[o.value==="loading"?(r(),C("div",C0,[t("div",S0,[e(E,{size:"large"})]),t("p",I0,M(i.value),1)])):o.value==="success"?(r(),C("div",V0,[e(y(na),{class:"icon-success"}),V[2]||(V[2]=t("h2",{class:"status-title"},"操作成功",-1)),t("p",M0,M(u.value),1),t("p",L0,M(d.value)+" 秒后自动跳转...",1),t("div",U0,[e(B,{block:"",size:"large",class:"login-btn",onClick:V[0]||(V[0]=p=>y(l).push("/dashboard/base"))},{default:a(()=>[...V[1]||(V[1]=[_(" 立即进入 ",-1)])]),_:1})])])):(r(),C("div",B0,[e(y(Vs),{class:"icon-error"}),V[4]||(V[4]=t("h2",{class:"status-title"},"操作失败",-1)),t("div",R0,M(f.value),1),t("div",E0,[e(B,{block:"",size:"large",class:"login-btn",onClick:I},{default:a(()=>[...V[3]||(V[3]=[_(" 返回登录页 ",-1)])]),_:1})])]))]),t("footer",P0,"Copyright @ 2021-"+M(new Date().getFullYear())+" MSLTeam",1)])]),e(Ba,{class:"tdesign-setting-outside"})])}}}),F0=oe(z0,[["__scopeId","data-v-fa1e4e34"]]),T0=Object.freeze(Object.defineProperty({__proto__:null,default:F0},Symbol.toStringTag,{value:"Module"})),D0={class:"result-content"},O0={class:"result-container"},j0={class:"action-box"},K0={class:"copyright"},q0=ne({__name:"index",setup(s){const n=Ze(),l=te(()=>n.displayMode);return(c,o)=>{const i=v("t-button");return r(),C("div",{class:we(["result-wrapper",l.value])},[t("div",D0,[t("div",O0,[o[2]||(o[2]=t("div",{class:"result-info"},[t("h1",{class:"code"},"404"),t("h2",{class:"title"},"掉出了这个世界......"),t("p",{class:"desc"},[_("越过基岩的边界，只剩无尽的黑夜，"),t("br"),_("请点击重生，寻回原本的世界。")])],-1)),t("div",j0,[e(i,{theme:"primary",size:"large",block:"",class:"home-btn",onClick:o[0]||(o[0]=f=>y(Ae)("/"))},{default:a(()=>[...o[1]||(o[1]=[_(" 返回主页 ",-1)])]),_:1})]),t("footer",K0,"Copyright @ 2021-"+M(new Date().getFullYear())+" MSLTeam",1)])])],2)}}}),N0=oe(q0,[["__scopeId","data-v-86bbfa54"]]),G0=Object.freeze(Object.defineProperty({__proto__:null,default:N0},Symbol.toStringTag,{value:"Module"}));
