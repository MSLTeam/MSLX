import{l as te,a_ as R,a$ as o,aZ as w,aU as r,aY as d,aV as m,w as ee,f as Ie,r as n,G as z,b2 as B,j as l,J as I,b3 as U,c as K,b0 as ze,F as De,o as tt,D as st,b4 as at,be as lt,b1 as ot,aX as nt}from"./index.DuVfB4dr.js";import{a as it,u as rt}from"./vue-router.BSuyFzNa.js";import{_ as se,o as ut,q as ct,t as dt,v as vt,w as mt,u as pt,x as ft,c as gt,y as ht,l as _t,s as bt,z as yt,A as wt,C as kt,D as $t,E as Ct}from"./index.C0RiS9Sp.js";import{F as xt}from"./FileEditor.BFFwFifD.js";import{F as Pt}from"./FileUploader.kvFzfviB.js";import{a as Ut,e as Ft,aD as It,aE as zt,aF as Dt,aG as St,U as Vt,au as Bt,f as Et,aH as Lt,aI as Pe,H as Mt,a8 as Rt,_ as Tt,aJ as Ue,c as Nt,M as jt,aK as Kt,ai as Ot,at as Fe,aL as qt,af as Wt,X as Gt}from"./tdesign-icons-vue-next.BalHEYKK.js";import{M as c,D as At}from"./tdesign-vue-next.Csn1Y9JM.js";import"./core-js-pure.DbDavgKW.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./pinia.K9HejpEf.js";import"./pinia-plugin-persistedstate_2eabddac918ad8d0cf74e67f4601f4c8.n2tMOXAx.js";import"./tvision-color.Cy78gTfV.js";import"./chroma-js.DO2ptVd8.js";import"./bezier-easing.D5A5epFU.js";import"./lodash.CpoxsuHF.js";import"./axios.B9ygI19o.js";import"./qs.CsZETzAf.js";import"./side-channel.gyxQHTce.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.CWmL7r7A.js";import"./side-channel-list.DZ_HK50j.js";import"./side-channel-map.Ujj6CYbr.js";import"./get-intrinsic.DZF4l_-S.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.GRuZvLsk.js";import"./dunder-proto.BfGlLUzx.js";import"./call-bind-apply-helpers.DPbVMkjK.js";import"./function-bind.CHqF18-c.js";import"./hasown.B1sN64jK.js";import"./call-bound.DTRAK3sj.js";import"./side-channel-weakmap.D0YmY7JX.js";import"./nprogress.COlaCQ7y.js";import"./lodash-es.sbUBen0f.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";import"./vue-codemirror.am87IH_v.js";import"./codemirror.lvVLeZ7G.js";import"./prettier._FpaQKPv.js";const Ht={class:"image-wrapper"},Jt=["src","alt"],Xt={key:1,class:"loading-placeholder"},Zt=te({__name:"ImagePreview",props:{visible:{type:Boolean},fileName:{},imageBlobUrl:{}},emits:["update:visible"],setup(D,{emit:E}){const p=E,f=()=>{p("update:visible",!1)};return(b,g)=>{const P=w("t-dialog");return r(),R(P,{visible:D.visible,header:D.fileName,footer:!1,width:"auto",top:"10vh",class:"image-preview-dialog",onClose:f},{default:o(()=>[d("div",Ht,[D.imageBlobUrl?(r(),m("img",{key:0,src:D.imageBlobUrl,alt:D.fileName},null,8,Jt)):(r(),m("div",Xt,"加载中..."))])]),_:1},8,["visible","header"])}}}),Yt=se(Zt,[["__scopeId","data-v-9d5acf17"]]),Qt={key:0,class:"compress-form"},es={class:"file-list-preview"},ts={class:"actions"},ss={key:1,class:"progress-view"},as={class:"status-icon"},ls={class:"status-text"},os=te({__name:"FileCompressor",props:{visible:{type:Boolean},instanceId:{},currentPath:{},files:{}},emits:["update:visible","success"],setup(D,{emit:E}){const p=D,f=E,b=n(""),g=n("idle"),P=n(0),a=n("");let i=null;ee(()=>p.visible,x=>{x?(g.value="idle",P.value=0,a.value="",p.files.length>0&&(b.value=`${p.files[0]}_packed.zip`)):S()});const S=()=>{i&&(clearInterval(i),i=null)},h=async()=>{if(!b.value.trim()){c.warning("请输入压缩包名称");return}let x=b.value;x.endsWith(".zip")||(x+=".zip"),g.value="processing",P.value=0,a.value="正在提交任务...";try{const L=(await ut(p.instanceId,p.files,x,p.currentPath)).taskId;if(L)C(L);else throw new Error("未获取到任务ID")}catch(v){g.value="error",a.value=v.message||"提交失败"}},C=x=>{i=window.setInterval(async()=>{try{const v=await ct(x);P.value=v.progress,a.value=v.message,v.status==="success"?(S(),g.value="success",P.value=100,setTimeout(()=>{f("success"),f("update:visible",!1)},1e3)):v.status==="error"&&(S(),g.value="error")}catch(v){console.error(v)}},1e3)},F=()=>{g.value==="processing"&&c.warning("后台任务仍在进行中，关闭窗口不会取消任务"),S(),f("update:visible",!1)};return Ie(()=>S()),(x,v)=>{const L=w("t-input"),T=w("t-button"),V=w("t-loading"),y=w("t-progress"),k=w("t-dialog");return r(),R(k,{visible:D.visible,header:g.value==="idle"?"创建压缩包":"正在压缩",footer:!1,"close-on-overlay-click":!1,width:"480px",onClose:F},{default:o(()=>[g.value==="idle"?(r(),m("div",Qt,[d("div",es,[v[1]||(v[1]=z(" 即将压缩 ",-1)),d("span",null,B(D.files.length),1),v[2]||(v[2]=z(" 个文件/文件夹 ",-1))]),l(L,{modelValue:b.value,"onUpdate:modelValue":v[0]||(v[0]=O=>b.value=O),placeholder:"请输入文件名",suffix:".zip",autofocus:"",onEnter:h},null,8,["modelValue"]),d("div",ts,[l(T,{theme:"default",variant:"text",onClick:F},{default:o(()=>[...v[3]||(v[3]=[z("取消",-1)])]),_:1}),l(T,{theme:"primary",onClick:h},{default:o(()=>[...v[4]||(v[4]=[z("开始压缩",-1)])]),_:1})])])):(r(),m("div",ss,[d("div",as,[g.value==="processing"?(r(),R(V,{key:0})):g.value==="success"?(r(),R(I(Ut),{key:1,style:{color:"var(--td-success-color)","font-size":"40px"}})):g.value==="error"?(r(),R(I(Ft),{key:2,style:{color:"var(--td-error-color)","font-size":"40px"}})):U("",!0)]),d("div",ls,B(a.value),1),l(y,{theme:"plump",percentage:P.value,status:g.value==="error"?"error":g.value==="success"?"success":"active"},null,8,["percentage","status"])]))]),_:1},8,["visible","header"])}}}),ns=se(os,[["__scopeId","data-v-da286579"]]),is={class:"decompress-container"},rs={class:"file-info"},us={class:"value"},cs={key:0,class:"form-item"},ds={key:1,class:"switch-row"},vs={key:2,class:"progress-area"},ms={class:"status-header"},ps={class:"status-text"},fs={class:"status-percent"},gs={key:3,class:"actions"},hs=te({__name:"FileDecompress",props:{visible:{type:Boolean},instanceId:{},currentPath:{},fileName:{}},emits:["update:visible","success"],setup(D,{emit:E}){const p=D,f=E,b=K({get:()=>p.visible,set:y=>f("update:visible",y)}),g=n("auto"),P=n(!0),a=n(!1),i=n(0),S=n(""),h=n("");let C=null;const F=[{label:"自动检测 (推荐)",value:"auto"},{label:"UTF-8 (Linux/Mac通用)",value:"utf-8"},{label:"GBK (Windows传统)",value:"gbk"}],x=()=>{g.value="auto",P.value=!0,a.value=!1,i.value=0,S.value="",h.value="",C&&(clearInterval(C),C=null)};ee(()=>p.visible,y=>{y&&x()});const v=()=>{C&&(clearInterval(C),C=null)},L=async()=>{if(!a.value)try{a.value=!0,S.value="正在提交任务...";const y=await dt(p.instanceId,p.fileName,p.currentPath,g.value,P.value);if(y&&y.taskId)h.value=y.taskId,C=window.setInterval(T,1e3);else throw new Error("未能获取任务ID")}catch(y){c.error(y.message||"提交失败"),a.value=!1}},T=async()=>{if(h.value)try{const y=await vt(h.value);i.value=y.progress||0,S.value=y.message,y.status==="success"?(v(),c.success("解压成功"),i.value=100,setTimeout(()=>{b.value=!1,f("success")},800)):y.status==="error"&&(v(),a.value=!1,c.error(y.message||"解压出错"))}catch(y){console.error("轮询失败",y)}},V=()=>{a.value&&i.value<100&&c.warning("解压正在后台进行中"),v(),b.value=!1};return(y,k)=>{const O=w("t-select"),A=w("t-switch"),X=w("t-progress"),H=w("t-button"),ae=w("t-dialog");return r(),R(ae,{visible:b.value,"onUpdate:visible":k[2]||(k[2]=M=>b.value=M),header:"解压文件",footer:!1,"close-on-overlay-click":!a.value,"on-close":V,width:"480px"},{default:o(()=>[d("div",is,[d("div",rs,[k[3]||(k[3]=d("span",{class:"label"},"目标文件：",-1)),d("span",us,B(D.fileName),1)]),a.value?U("",!0):(r(),m("div",cs,[k[4]||(k[4]=d("span",{class:"label"},"文件名编码",-1)),l(O,{modelValue:g.value,"onUpdate:modelValue":k[0]||(k[0]=M=>g.value=M),options:F},null,8,["modelValue"])])),a.value?U("",!0):(r(),m("div",ds,[k[5]||(k[5]=d("div",{class:"switch-info"},[d("span",{class:"switch-label"},"创建同名文件夹"),d("span",{class:"switch-tip"},"推荐开启，防止文件散乱在当前目录")],-1)),l(A,{modelValue:P.value,"onUpdate:modelValue":k[1]||(k[1]=M=>P.value=M)},null,8,["modelValue"])])),a.value?(r(),m("div",vs,[d("div",ms,[d("span",ps,B(S.value),1),d("span",fs,B(i.value)+"%",1)]),l(X,{theme:"line",percentage:i.value,label:!1,status:i.value===100?"success":"active"},null,8,["percentage","status"])])):U("",!0),a.value?U("",!0):(r(),m("div",gs,[l(H,{variant:"outline",onClick:V},{default:o(()=>[...k[6]||(k[6]=[z("取消",-1)])]),_:1}),l(H,{theme:"primary",onClick:L},{default:o(()=>[...k[7]||(k[7]=[z("开始解压",-1)])]),_:1})]))])]),_:1},8,["visible","close-on-overlay-click"])}}}),_s=se(hs,[["__scopeId","data-v-9c603684"]]),bs={class:"permission-form"},ys={class:"presets"},ws={class:"preset-list"},ks={key:0,class:"preset-desc"},$s={key:1,class:"preset-desc"},Cs={key:2,class:"preset-desc"},xs=te({__name:"FilePermission",props:{visible:{type:Boolean},instanceId:{},currentPath:{},targets:{}},emits:["update:visible","success"],setup(D,{emit:E}){const p=D,f=E,b=n({mode:"755"}),g=n(!1),P=[{label:"755 (推荐: 所有者读写执/他人读执)",value:"755"},{label:"777 (全开: 所有权限)",value:"777"},{label:"644 (普通文件: 读写/读)",value:"644"}],a=K(()=>p.targets.length===1?`修改权限 - ${p.targets[0].name}`:`批量修改权限 (${p.targets.length} 项)`);ee(()=>p.visible,C=>{C&&p.targets.length>0&&(p.targets.length===1&&p.targets[0].mode&&p.targets[0].mode!=="Unknown"?b.value.mode=p.targets[0].mode:b.value.mode="755")});const i=()=>{f("update:visible",!1),g.value=!1},S=async()=>{if(!b.value.mode||!/^[0-7]{3}$/.test(b.value.mode)){c.warning("请输入正确的3位八进制权限码 (如 755)");return}g.value=!0;let C=0,F=0;try{for(const x of p.targets)try{await mt(h,x.fullPath,b.value.mode),C++}catch(v){F++,console.error(v)}F===0?c.success("权限修改成功"):c.warning(`完成: 成功 ${C} 个, 失败 ${F} 个`),f("success"),i()}catch(x){c.error(x.message||"请求失败")}finally{g.value=!1}},h=p.instanceId;return(C,F)=>{const x=w("t-input"),v=w("t-form-item"),L=w("t-tag"),T=w("t-dialog");return r(),R(T,{visible:D.visible,header:a.value,"confirm-btn":{content:"保存修改",loading:g.value},"on-close":i,"on-confirm":S,width:"480px"},{default:o(()=>[d("div",bs,[l(v,{label:"权限代码","required-mark":""},{default:o(()=>[l(x,{modelValue:b.value.mode,"onUpdate:modelValue":F[0]||(F[0]=V=>b.value.mode=V),placeholder:"例如: 755",tips:"请输入3位八进制数字 (Linux Chmod)"},null,8,["modelValue"])]),_:1}),d("div",ys,[F[1]||(F[1]=d("div",{class:"preset-label"},"快捷设置：",-1)),d("div",ws,[(r(),m(De,null,ze(P,V=>l(L,{key:V.value,variant:"light-outline",theme:"primary",class:"preset-tag",style:{cursor:"pointer"},onClick:y=>b.value.mode=V.value},{default:o(()=>[z(B(V.value),1)]),_:2},1032,["onClick"])),64))]),b.value.mode==="755"?(r(),m("div",ks,"适合可执行程序、脚本或文件夹")):U("",!0),b.value.mode==="644"?(r(),m("div",$s,"适合普通配置文件、日志等")):U("",!0),b.value.mode==="777"?(r(),m("div",Cs,"允许任何人写入 (不安全)")):U("",!0)])])]),_:1},8,["visible","header","confirm-btn"])}}}),Ps=se(xs,[["__scopeId","data-v-6dc7353c"]]),Us={class:"file-manager-wrapper"},Fs={class:"toolbar"},Is={class:"breadcrumb-area"},zs={class:"actions-area"},Ds={key:0},Ss={key:0},Vs={key:0},Bs={class:"table-wrapper"},Es=["onClick"],Ls={class:"name-text"},Ms={class:"op-actions"},Rs={key:0,class:"selection-bar"},Ts={key:0,class:"selection-info"},Ns={key:1,class:"selection-info"},js={class:"selection-actions"},Ks={key:0},Os={key:0},qs={key:0},Ws={key:0},Gs={key:0},As={key:0},Hs={key:1,class:"selection-bar clipboard-bar"},Js={class:"selection-info"},Xs={key:0},Zs={key:1},Ys={class:"selection-actions"},Qs=te({__name:"index",setup(D){const E=it(),p=rt(),f=K(()=>Number(E.params.serverFilesId)),b=pt(),g=n(!1),P=n([]),a=n(""),i=n([]),S=n(window.innerWidth),h=K(()=>S.value<768),C=n(!1),F=n(!1),x=n(!1),v=n(!1),L=n(!1),T=n(!1),V=n(!1),y=n(!1),k=n(!1),O=n(""),A=n(""),X=n(""),H=n(!1),ae=n(""),M=n(""),Z=n(""),J=n(""),ue=n(null),fe=n([]),ge=n(""),le=n([]),he=()=>{S.value=window.innerWidth},oe=t=>{var u;const e=(u=t.split(".").pop())==null?void 0:u.toLowerCase();return["png","jpg","jpeg","gif","ico","webp","bmp","svg"].includes(e||"")},_e=t=>{var u;const e=(u=t.split(".").pop())==null?void 0:u.toLowerCase();return["zip","jar"].includes(e||"")},be=t=>{var u;if(t.type==="folder"){const _=t.name.toLowerCase();return _==="config"||_==="settings"?{icon:jt,color:"var(--td-warning-color)"}:_.startsWith("world")||_==="level"?{icon:Kt,color:"var(--td-success-color)"}:["plugins","mods","libraries"].includes(_)?{icon:Ot,color:"var(--td-brand-color)"}:["logs","crash-reports","cache","temp"].includes(_)?{icon:Fe,color:"var(--td-gray-color-6)"}:{icon:Fe,color:"var(--td-brand-color)"}}const e=(u=t.name.split(".").pop())==null?void 0:u.toLowerCase();return["png","jpg","jpeg","gif","ico","webp"].includes(e||"")?{icon:qt,color:"var(--td-success-color)"}:["jar","zip","rar","7z","tar","gz"].includes(e||"")?{icon:Pe,color:"#722ed1"}:["yml","yaml","json","properties","toml","xml","conf","sh","bat","cmd"].includes(e||"")?{icon:Wt,color:"var(--td-warning-color)"}:["log","txt","md","lock"].includes(e||"")?{icon:Ue,color:"var(--td-gray-color-6)"}:{icon:Gt,color:"var(--td-text-color-secondary)"}},ce=K(()=>P.value.some(t=>t.permission&&t.permission!=="")),Se=K(()=>{const t={colKey:"row-select",type:"multiple",width:h.value?34:40},e={colKey:"name",title:"文件名",ellipsis:!0,width:"auto"},u={colKey:"operation",title:"操作",width:h.value?50:80,align:"center",fixed:h.value?"right":void 0};return h.value?[t,e,u]:[t,e,{colKey:"size",title:"大小",width:100,align:"right"},...ce.value?[{colKey:"permission",title:"权限",width:80,align:"center"}]:[],{colKey:"lastModified",title:"修改时间",width:180,align:"center"},u]}),Ve=K(()=>{const t=a.value.split("/").filter(_=>_),e=[{name:"根目录",path:""}];let u="";return t.forEach(_=>{u=u?`${u}/${_}`:_,e.push({name:_,path:u})}),e}),Be=K(()=>i.value.length>0),Ee=t=>{if(t===0)return"-";const e=["B","KB","MB","GB","TB"];let u=0;for(;t>=1024&&u<e.length-1;)t/=1024,u++;return`${t.toFixed(1)} ${e[u]}`},Le=t=>t?new Date(t).toLocaleString():"-",ne=async()=>{g.value=!0,i.value=[];try{const t=await ft(f.value,a.value);P.value=t||[]}catch(t){console.error(t)}finally{g.value=!1}},de=async t=>{M.value&&(window.URL.revokeObjectURL(M.value),M.value="");const e=a.value?`${a.value}/${t}`:t,u=c.loading("正在加载图片...");try{const _=await ht(f.value,e);if(!(_ instanceof Blob))throw new Error("无效数据");M.value=window.URL.createObjectURL(_),ae.value=t,F.value=!0,c.close(u)}catch{c.close(u),c.error("加载失败")}},ve=async(t,e=!1)=>{if(e){A.value=t,X.value="",C.value=!0;return}if(oe(t)){de(t);return}const u=a.value?`${a.value}/${t}`:t,_=c.loading("正在读取文件...");try{const $=await _t(f.value,u);A.value=t,X.value=$,C.value=!0,c.close(_)}catch($){c.close(_),c.error("读取失败: "+$.message)}},Me=()=>{Z.value="",x.value=!0},ye=()=>{if(!Z.value.trim()){c.warning("请输入文件名");return}x.value=!1,ve(Z.value,!0)},Re=async t=>{H.value=!0;try{const e=a.value?`${a.value}/${A.value}`:A.value;await bt(f.value,e,t),c.success("保存成功"),C.value=!1,N()}catch{c.error("保存失败")}finally{H.value=!1}},Te=()=>{O.value="",k.value=!0},we=async()=>{if(!O.value.trim()){c.warning("请输入文件夹名称");return}try{await yt(f.value,a.value,O.value),c.success("文件夹创建成功"),k.value=!1,N()}catch(t){c.error(`创建失败: ${t.message||"未知错误"}`)}},Ne=t=>{ue.value={name:t.name,fullPath:a.value?`${a.value}/${t.name}`:t.name},J.value=t.name,v.value=!0},ke=async()=>{if(!J.value||!ue.value)return;const t=a.value?`${a.value}/${J.value}`:J.value;try{await wt(f.value,ue.value.fullPath,t),c.success("重命名成功"),v.value=!1,N()}catch{c.error("重命名失败")}},$e=t=>{let e=[];if(t?e=[t.name]:e=[...i.value],e.length===0)return;const u=At.confirm({header:"确认删除",body:`确定要永久删除这 ${e.length} 项吗？`,theme:"danger",onConfirm:async()=>{try{const _=e.map($=>a.value?`${a.value}/${$}`:$);await kt(f.value,_),c.success("删除成功"),i.value=[],N(),u.hide()}catch{c.error("删除失败")}}})},je=t=>{if(t.type==="folder"){const e=a.value===""?"":"/";a.value=`${a.value}${e}${t.name}`}else oe(t.name)?de(t.name):ve(t.name)},Ke=t=>{a.value=t},N=()=>ne(),Ce=async t=>{var Y;let e=[];if(t?e=[t.name]:e=[...i.value],e.length===0)return;const{baseUrl:u,token:_}=b,$=u.endsWith("/")?u.slice(0,-1):u;for(const G of e){if(((Y=P.value.find(W=>W.name===G))==null?void 0:Y.type)==="folder"){c.warning(`暂不支持下载文件夹: ${G} 请压缩后再下载！`);continue}const me=a.value?`${a.value}/${G}`:G;try{const W=new URL(`${$||window.location.origin}/api/files/instance/${f.value}/download`);W.searchParams.append("path",me),W.searchParams.append("x-user-token",_);const j=document.createElement("a");j.href=W.toString(),j.style.display="none",j.download=G,document.body.appendChild(j),j.click(),document.body.removeChild(j)}catch(W){console.error(W),c.error(`创建下载链接失败: ${G}`)}}t||(i.value=[])},Oe=()=>{i.value.length!==0&&(fe.value=[...i.value],T.value=!0)},qe=()=>{i.value=[],N()},We=t=>{ge.value=t.name,V.value=!0},Ge=()=>{N()},xe=t=>{if(le.value=[],t)le.value.push({name:t.name,fullPath:a.value?`${a.value}/${t.name}`:t.name,mode:t.permission||"755"});else{if(i.value.length===0)return;i.value.forEach(e=>{const u=P.value.find(_=>_.name===e);u&&le.value.push({name:u.name,fullPath:a.value?`${a.value}/${u.name}`:u.name,mode:u.permission||"755"})})}y.value=!0},Ae=()=>{i.value=[],N()},He=()=>N(),q=n([]),ie=n("copy"),re=n(""),Je=K(()=>q.value.length>0),Xe=K(()=>a.value===re.value),Ze=()=>{if(i.value.length===0)return;const t=i.value.map(e=>a.value?`${a.value}/${e}`:e);q.value=t,ie.value="copy",re.value=a.value,i.value=[],c.info(`已复制 ${t.length} 项，请前往目标目录粘贴`)},Ye=()=>{if(i.value.length===0)return;const t=i.value.map(e=>a.value?`${a.value}/${e}`:e);q.value=t,ie.value="move",re.value=a.value,i.value=[],c.info(`已剪切 ${t.length} 项，请前往目标目录粘贴`)},Qe=()=>{q.value=[],re.value="",c.info("已取消操作")},et=async()=>{if(q.value.length===0)return;const t=c.loading("正在粘贴中...");try{ie.value==="copy"?await $t(f.value,q.value,a.value):await Ct(f.value,q.value,a.value),c.success("粘贴成功"),q.value=[],N()}catch(e){c.error(`粘贴失败: ${e.message||"未知错误"}`)}finally{c.close(t)}};return ee(a,t=>{p.replace({query:{...E.query,path:t||void 0}}),ne()}),ee(f,()=>{E.name==="InstanceFiles"&&(a.value="",i.value=[],ne())}),tt(()=>{const t=E.query.path;window.addEventListener("resize",he),t?a.value=t:ne()}),Ie(()=>{window.removeEventListener("resize",he)}),(t,e)=>{const u=w("t-breadcrumb-item"),_=w("t-breadcrumb"),$=w("t-button"),Y=w("t-dropdown"),G=w("t-tag"),me=w("t-table"),W=w("t-card"),j=w("t-input"),pe=w("t-dialog");return r(),m("div",Us,[l(W,{bordered:!1,class:"file-manager-card"},{default:o(()=>[d("div",Fs,[d("div",Is,[l(_,{"max-item-width":h.value?"80px":"150px"},{default:o(()=>[(r(!0),m(De,null,ze(Ve.value,(s,Q)=>(r(),R(u,{key:Q,class:"crumb-item",onClick:ea=>Ke(s.path)},at({default:o(()=>[z(" "+B(s.name),1)]),_:2},[Q===0?{name:"icon",fn:o(()=>[l(I(It))]),key:"0"}:void 0]),1032,["onClick"]))),128))]),_:1},8,["max-item-width"])]),d("div",zs,[l($,{variant:"outline",size:"medium",onClick:e[0]||(e[0]=s=>I(gt)(`/instance/console/${f.value}`))},{icon:o(()=>[l(I(zt))]),default:o(()=>[h.value?U("",!0):(r(),m("span",Ds,"控制台"))]),_:1}),l(Y,{options:[{content:"新建文件",value:"file",onClick:Me},{content:"新建文件夹",value:"folder",onClick:Te}]},{default:o(()=>[l($,{variant:"outline",size:"medium"},{icon:o(()=>[l(I(Dt))]),default:o(()=>[h.value?U("",!0):(r(),m("span",Ss,"新建"))]),_:1})]),_:1},8,["options"]),l($,{theme:"primary",size:"medium",onClick:e[1]||(e[1]=s=>L.value=!0)},{icon:o(()=>[l(I(St))]),default:o(()=>[h.value?U("",!0):(r(),m("span",Vs,"上传"))]),_:1}),l($,{variant:"outline",size:"medium",onClick:N},{icon:o(()=>[l(I(Vt))]),_:1})])]),d("div",Bs,[l(me,{"selected-row-keys":i.value,"onUpdate:selectedRowKeys":e[2]||(e[2]=s=>i.value=s),data:P.value,columns:Se.value,"row-key":"name",loading:g.value,hover:!0,size:"medium",class:"file-table"},{name:o(({row:s})=>[d("div",{class:"file-name-cell",onClick:lt(Q=>je(s),["stop"])},[(r(),R(ot(be(s).icon),{class:"file-icon",style:nt({color:be(s).color})},null,8,["style"])),d("span",Ls,B(s.name),1)],8,Es)]),size:o(({row:s})=>[z(B(Ee(s.size)),1)]),permission:o(({row:s})=>[s.permission?(r(),R(G,{key:0,variant:"light",size:"small"},{default:o(()=>[z(B(s.permission),1)]),_:2},1024)):U("",!0)]),lastModified:o(({row:s})=>[z(B(Le(s.lastModified)),1)]),operation:o(({row:s})=>[d("div",Ms,[l(Y,{placement:h.value?"bottom-right":"bottom",options:[{content:"解压",value:"decompress",onClick:()=>We(s),show:_e(s.name)&&s.type!=="folder"},{content:oe(s.name)?"预览":"编辑",value:"edit",onClick:()=>oe(s.name)?de(s.name):ve(s.name),disabled:s.type==="folder"||_e(s.name)},{content:"权限",value:"permission",onClick:()=>xe(s),show:ce.value},{content:"下载",value:"download",onClick:()=>Ce(s)},{content:"重命名",value:"rename",onClick:()=>Ne(s)},{content:"删除",value:"delete",theme:"error",onClick:()=>$e(s)}].filter(Q=>Q.show!==!1)},{default:o(()=>[l($,{variant:"text",shape:"square",size:"medium"},{default:o(()=>[l(I(Bt))]),_:1})]),_:1},8,["placement","options"])])]),empty:o(()=>[...e[22]||(e[22]=[d("div",{class:"empty-state"},"暂无文件",-1)])]),_:1},8,["selected-row-keys","data","columns","loading"])])]),_:1}),l(st,{name:"slide-up"},{default:o(()=>[Be.value?(r(),m("div",Rs,[h.value?(r(),m("div",Ns,[d("span",null,B(i.value.length),1)])):(r(),m("div",Ts,[e[23]||(e[23]=z(" 已选 ",-1)),d("span",null,B(i.value.length),1),e[24]||(e[24]=z(" 项 ",-1))])),d("div",js,[l($,{size:"small",variant:"text",theme:"primary",onClick:e[3]||(e[3]=s=>Ze())},{icon:o(()=>[l(I(Et))]),default:o(()=>[h.value?U("",!0):(r(),m("span",Ks,"复制"))]),_:1}),l($,{size:"small",variant:"text",theme:"primary",onClick:e[4]||(e[4]=s=>Ye())},{icon:o(()=>[l(I(Lt))]),default:o(()=>[h.value?U("",!0):(r(),m("span",Os,"剪切"))]),_:1}),l($,{size:"small",variant:"text",theme:"primary",onClick:e[5]||(e[5]=s=>Oe())},{icon:o(()=>[l(I(Pe))]),default:o(()=>[h.value?U("",!0):(r(),m("span",qs,"压缩"))]),_:1}),l($,{size:"small",variant:"text",theme:"primary",onClick:e[6]||(e[6]=s=>Ce())},{icon:o(()=>[l(I(Mt))]),default:o(()=>[h.value?U("",!0):(r(),m("span",Ws,"下载"))]),_:1}),ce.value?(r(),R($,{key:0,size:"small",variant:"text",theme:"primary",onClick:e[7]||(e[7]=s=>xe())},{icon:o(()=>[l(I(Rt))]),default:o(()=>[h.value?U("",!0):(r(),m("span",Gs,"权限"))]),_:1})):U("",!0),l($,{size:"small",variant:"text",theme:"danger",onClick:e[8]||(e[8]=s=>$e())},{icon:o(()=>[l(I(Tt))]),default:o(()=>[h.value?U("",!0):(r(),m("span",As,"删除"))]),_:1}),l($,{size:"small",variant:"text",onClick:e[9]||(e[9]=s=>i.value=[])},{default:o(()=>[...e[25]||(e[25]=[z("取消",-1)])]),_:1})])])):Je.value?(r(),m("div",Hs,[d("div",Js,[ie.value==="copy"?(r(),m("span",Xs,"准备复制")):(r(),m("span",Zs,"准备移动")),d("span",null,B(q.value.length),1),e[26]||(e[26]=z(" 项 ",-1))]),d("div",Ys,[l($,{theme:"primary",disabled:Xe.value,onClick:et},{icon:o(()=>[l(I(Ue))]),default:o(()=>[e[27]||(e[27]=z(" 粘贴在此处 ",-1))]),_:1},8,["disabled"]),l($,{variant:"text",theme:"default",onClick:Qe},{icon:o(()=>[l(I(Nt))]),default:o(()=>[e[28]||(e[28]=z(" 取消 ",-1))]),_:1})])])):U("",!0)]),_:1}),l(xt,{visible:C.value,"onUpdate:visible":e[10]||(e[10]=s=>C.value=s),"file-name":A.value,content:X.value,loading:H.value,onSave:Re},null,8,["visible","file-name","content","loading"]),l(pe,{visible:x.value,"onUpdate:visible":e[12]||(e[12]=s=>x.value=s),header:"新建文件","on-confirm":ye},{default:o(()=>[l(j,{modelValue:Z.value,"onUpdate:modelValue":e[11]||(e[11]=s=>Z.value=s),placeholder:"输入文件名",autofocus:!0,onEnter:ye},null,8,["modelValue"])]),_:1},8,["visible"]),l(pe,{visible:v.value,"onUpdate:visible":e[14]||(e[14]=s=>v.value=s),header:"重命名","on-confirm":ke},{default:o(()=>[l(j,{modelValue:J.value,"onUpdate:modelValue":e[13]||(e[13]=s=>J.value=s),placeholder:"输入新名称",autofocus:!0,onEnter:ke},null,8,["modelValue"])]),_:1},8,["visible"]),l(Pt,{visible:L.value,"onUpdate:visible":e[15]||(e[15]=s=>L.value=s),"instance-id":f.value,"current-path":a.value,onSuccess:He},null,8,["visible","instance-id","current-path"]),l(Yt,{visible:F.value,"onUpdate:visible":e[16]||(e[16]=s=>F.value=s),"file-name":ae.value,"image-blob-url":M.value},null,8,["visible","file-name","image-blob-url"]),l(ns,{visible:T.value,"onUpdate:visible":e[17]||(e[17]=s=>T.value=s),"instance-id":f.value,"current-path":a.value,files:fe.value,onSuccess:qe},null,8,["visible","instance-id","current-path","files"]),l(_s,{visible:V.value,"onUpdate:visible":e[18]||(e[18]=s=>V.value=s),"instance-id":f.value,"current-path":a.value,"file-name":ge.value,onSuccess:Ge},null,8,["visible","instance-id","current-path","file-name"]),l(Ps,{visible:y.value,"onUpdate:visible":e[19]||(e[19]=s=>y.value=s),"instance-id":f.value,"current-path":a.value,targets:le.value,onSuccess:Ae},null,8,["visible","instance-id","current-path","targets"]),l(pe,{visible:k.value,"onUpdate:visible":e[21]||(e[21]=s=>k.value=s),header:"新建文件夹","on-confirm":we},{default:o(()=>[l(j,{modelValue:O.value,"onUpdate:modelValue":e[20]||(e[20]=s=>O.value=s),placeholder:"输入文件夹名称",autofocus:!0,onEnter:we},null,8,["modelValue"])]),_:1},8,["visible"])])}}}),Wa=se(Qs,[["__scopeId","data-v-1fa8ea78"]]);export{Wa as default};
