import{D as H,F as i,R as ze,aa as pe,P as G,K as j,b1 as M,b2 as o,b0 as $,aY as r,a$ as c,G as l,ap as z,b5 as V,bl as st,bm as at,bn as lt,bo as ot,bp as nt,bq as it,aX as y,ao as S,b6 as I,b3 as De,O as Se,am as rt,b7 as ut,bh as ct,b4 as dt,a_ as vt}from"./index.BbdIPky0.js";import{a as mt,u as pt}from"./vue-router.CTuarHf7.js";import{_ as X,n as ft,o as ht,q as gt,t as bt,v as _t,w as yt,c as wt,x as Pe,l as kt,y as $t,z as Ct,A as xt,C as Pt,D as Ft,m as Ut}from"./index.CMHGRTIf.js";import{T as It}from"./vue-codemirror.BwymcuFK.js";import{F as zt}from"./FileUploader.CFIWAUYU.js";import{a as Dt,e as St,ay as Vt,az as Bt,aA as Lt,aB as Et,U as Mt,aC as Rt,f as jt,aD as Tt,aE as Fe,H as Nt,ad as Ot,_ as Kt,aF as Ue,c as qt,M as Wt,aG as At,af as Gt,aq as Ie,aH as Ht,ab as Xt,X as Yt}from"./tdesign-icons-vue-next.B3wvPiG1.js";import{M as u,D as Zt}from"./tdesign-vue-next.B9R1AJJu.js";import"./core-js-pure.DghWRT_o.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./pinia.DE9DXmFR.js";import"./pinia-plugin-persistedstate.n2tMOXAx.js";import"./tvision-color.BU_YHHaJ.js";import"./chroma-js.Cmk4elvR.js";import"./bezier-easing.jp9ayU57.js";import"./lodash.B5_zCkFd.js";import"./axios.R-lXtGyY.js";import"./qs.pfv2Cuas.js";import"./side-channel.B7VpeXu7.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.CD-SYzlK.js";import"./cron-parser.BqMfRICj.js";import"./luxon.BVaPVz1w.js";import"./side-channel-list.CQN2BsdT.js";import"./side-channel-map.mJjiYxsE.js";import"./get-intrinsic.DZF4l_-S.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.GRuZvLsk.js";import"./dunder-proto.BfGlLUzx.js";import"./call-bind-apply-helpers.DPbVMkjK.js";import"./function-bind.CHqF18-c.js";import"./hasown.B1sN64jK.js";import"./call-bound.DTRAK3sj.js";import"./side-channel-weakmap.C4d6frlU.js";import"./nprogress.CMq2Rk2a.js";import"./lodash-es.ClUTdtmA.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";import"./codemirror.CEpN6POG.js";const Jt={class:"editor-container"},Qt={class:"editor-status-bar"},es={class:"mode-tag"},ts=H({__name:"FileEditor",props:{visible:Boolean,fileName:String,content:String,loading:Boolean},emits:["update:visible","save"],setup(F,{emit:B}){const f=F,b=B,m=i(""),p=i(!1);let a=null;const n=()=>{const h=document.documentElement.getAttribute("theme-mode");p.value=h==="dark"};ze(()=>{n(),a=new MutationObserver(n),a.observe(document.documentElement,{attributes:!0,attributeFilter:["theme-mode"]})}),pe(()=>{a==null||a.disconnect()}),G(()=>f.content,h=>{m.value=h||""},{immediate:!0});const U=j(()=>{var w,v;const h=[];switch(p.value&&h.push(st),(v=(w=f.fileName)==null?void 0:w.split(".").pop())==null?void 0:v.toLowerCase()){case"json":h.push(it());break;case"yml":case"yaml":h.push(nt());break;case"js":case"ts":h.push(ot());break;case"css":case"less":case"scss":h.push(lt());break;case"html":case"xml":h.push(at());break}return h}),_=()=>{b("update:visible",!1)},D=()=>{b("save",m.value)};return(h,P)=>{const w=$("t-dialog");return r(),M(w,{visible:F.visible,header:`正在编辑: ${F.fileName}`,width:"90%",attach:"body",top:"1vh","confirm-btn":{content:"保存",loading:f.loading,theme:"primary"},class:"editor-dialog",onClose:_,onConfirm:D},{default:o(()=>[c("div",Jt,[l(z(It),{modelValue:m.value,"onUpdate:modelValue":P[0]||(P[0]=v=>m.value=v),placeholder:"文件内容为空...",style:{height:"70vh",fontSize:"14px"},autofocus:!0,"indent-with-tab":!0,"tab-size":2,extensions:U.value},null,8,["modelValue","extensions"])]),c("div",Qt,[c("span",null,"行数: "+V(m.value.split(`
`).length),1),c("span",null,"长度: "+V(m.value.length),1),c("span",es,V(p.value?"Dark Mode":"Light Mode"),1)])]),_:1},8,["visible","header","confirm-btn"])}}}),ss=X(ts,[["__scopeId","data-v-97640eff"]]),as={class:"image-wrapper"},ls=["src","alt"],os={key:1,class:"loading-placeholder"},ns=H({__name:"ImagePreview",props:{visible:{type:Boolean},fileName:{},imageBlobUrl:{}},emits:["update:visible"],setup(F,{emit:B}){const f=B,b=()=>{f("update:visible",!1)};return(m,p)=>{const a=$("t-dialog");return r(),M(a,{visible:F.visible,header:F.fileName,footer:!1,width:"auto",top:"10vh",class:"image-preview-dialog",onClose:b},{default:o(()=>[c("div",as,[F.imageBlobUrl?(r(),y("img",{key:0,src:F.imageBlobUrl,alt:F.fileName},null,8,ls)):(r(),y("div",os,"加载中..."))])]),_:1},8,["visible","header"])}}}),is=X(ns,[["__scopeId","data-v-9d5acf17"]]),rs={key:0,class:"compress-form"},us={class:"file-list-preview"},cs={class:"actions"},ds={key:1,class:"progress-view"},vs={class:"status-icon"},ms={class:"status-text"},ps=H({__name:"FileCompressor",props:{visible:{type:Boolean},instanceId:{},currentPath:{},files:{}},emits:["update:visible","success"],setup(F,{emit:B}){const f=F,b=B,m=i(""),p=i("idle"),a=i(0),n=i("");let U=null;G(()=>f.visible,w=>{w?(p.value="idle",a.value=0,n.value="",f.files.length>0&&(m.value=`${f.files[0]}_packed.zip`)):_()});const _=()=>{U&&(clearInterval(U),U=null)},D=async()=>{if(!m.value.trim()){u.warning("请输入压缩包名称");return}let w=m.value;w.endsWith(".zip")||(w+=".zip"),p.value="processing",a.value=0,n.value="正在提交任务...";try{const E=(await ft(f.instanceId,f.files,w,f.currentPath)).taskId;if(E)h(E);else throw new Error("未获取到任务ID")}catch(v){p.value="error",n.value=v.message||"提交失败"}},h=w=>{U=window.setInterval(async()=>{try{const v=await ht(w);a.value=v.progress,n.value=v.message,v.status==="success"?(_(),p.value="success",a.value=100,setTimeout(()=>{b("success"),b("update:visible",!1)},1e3)):v.status==="error"&&(_(),p.value="error")}catch(v){console.error(v)}},1e3)},P=()=>{p.value==="processing"&&u.warning("后台任务仍在进行中，关闭窗口不会取消任务"),_(),b("update:visible",!1)};return pe(()=>_()),(w,v)=>{const E=$("t-input"),T=$("t-button"),L=$("t-loading"),k=$("t-progress"),C=$("t-dialog");return r(),M(C,{visible:F.visible,header:p.value==="idle"?"创建压缩包":"正在压缩",footer:!1,"close-on-overlay-click":!1,width:"480px",onClose:P},{default:o(()=>[p.value==="idle"?(r(),y("div",rs,[c("div",us,[v[1]||(v[1]=S(" 即将压缩 ",-1)),c("span",null,V(F.files.length),1),v[2]||(v[2]=S(" 个文件/文件夹 ",-1))]),l(E,{modelValue:m.value,"onUpdate:modelValue":v[0]||(v[0]=O=>m.value=O),placeholder:"请输入文件名",suffix:".zip",autofocus:"",onEnter:D},null,8,["modelValue"]),c("div",cs,[l(T,{theme:"default",variant:"text",onClick:P},{default:o(()=>[...v[3]||(v[3]=[S("取消",-1)])]),_:1}),l(T,{theme:"primary",onClick:D},{default:o(()=>[...v[4]||(v[4]=[S("开始压缩",-1)])]),_:1})])])):(r(),y("div",ds,[c("div",vs,[p.value==="processing"?(r(),M(L,{key:0})):p.value==="success"?(r(),M(z(Dt),{key:1,style:{color:"var(--td-success-color)","font-size":"40px"}})):p.value==="error"?(r(),M(z(St),{key:2,style:{color:"var(--td-error-color)","font-size":"40px"}})):I("",!0)]),c("div",ms,V(n.value),1),l(k,{theme:"plump",percentage:a.value,status:p.value==="error"?"error":p.value==="success"?"success":"active"},null,8,["percentage","status"])]))]),_:1},8,["visible","header"])}}}),fs=X(ps,[["__scopeId","data-v-da286579"]]),hs={class:"decompress-container"},gs={class:"file-info"},bs={class:"value"},_s={key:0,class:"form-item"},ys={key:1,class:"switch-row"},ws={key:2,class:"progress-area"},ks={class:"status-header"},$s={class:"status-text"},Cs={class:"status-percent"},xs={key:3,class:"actions"},Ps=H({__name:"FileDecompress",props:{visible:{type:Boolean},instanceId:{},currentPath:{},fileName:{}},emits:["update:visible","success"],setup(F,{emit:B}){const f=F,b=B,m=j({get:()=>f.visible,set:k=>b("update:visible",k)}),p=i("auto"),a=i(!0),n=i(!1),U=i(0),_=i(""),D=i("");let h=null;const P=[{label:"自动检测 (推荐)",value:"auto"},{label:"UTF-8 (Linux/Mac通用)",value:"utf-8"},{label:"GBK (Windows传统)",value:"gbk"}],w=()=>{p.value="auto",a.value=!0,n.value=!1,U.value=0,_.value="",D.value="",h&&(clearInterval(h),h=null)};G(()=>f.visible,k=>{k&&w()});const v=()=>{h&&(clearInterval(h),h=null)},E=async()=>{if(!n.value)try{n.value=!0,_.value="正在提交任务...";const k=await gt(f.instanceId,f.fileName,f.currentPath,p.value,a.value);if(k&&k.taskId)D.value=k.taskId,h=window.setInterval(T,1e3);else throw new Error("未能获取任务ID")}catch(k){u.error(k.message||"提交失败"),n.value=!1}},T=async()=>{if(D.value)try{const k=await bt(D.value);U.value=k.progress||0,_.value=k.message,k.status==="success"?(v(),u.success("解压成功"),U.value=100,setTimeout(()=>{m.value=!1,b("success")},800)):k.status==="error"&&(v(),n.value=!1,u.error(k.message||"解压出错"))}catch(k){console.error("轮询失败",k)}},L=()=>{n.value&&U.value<100&&u.warning("解压正在后台进行中"),v(),m.value=!1};return(k,C)=>{const O=$("t-select"),Y=$("t-switch"),Z=$("t-progress"),J=$("t-button"),W=$("t-dialog");return r(),M(W,{visible:m.value,"onUpdate:visible":C[2]||(C[2]=R=>m.value=R),header:"解压文件",footer:!1,"close-on-overlay-click":!n.value,"on-close":L,width:"480px"},{default:o(()=>[c("div",hs,[c("div",gs,[C[3]||(C[3]=c("span",{class:"label"},"目标文件：",-1)),c("span",bs,V(F.fileName),1)]),n.value?I("",!0):(r(),y("div",_s,[C[4]||(C[4]=c("span",{class:"label"},"文件名编码",-1)),l(O,{modelValue:p.value,"onUpdate:modelValue":C[0]||(C[0]=R=>p.value=R),options:P},null,8,["modelValue"])])),n.value?I("",!0):(r(),y("div",ys,[C[5]||(C[5]=c("div",{class:"switch-info"},[c("span",{class:"switch-label"},"创建同名文件夹"),c("span",{class:"switch-tip"},"推荐开启，防止文件散乱在当前目录")],-1)),l(Y,{modelValue:a.value,"onUpdate:modelValue":C[1]||(C[1]=R=>a.value=R)},null,8,["modelValue"])])),n.value?(r(),y("div",ws,[c("div",ks,[c("span",$s,V(_.value),1),c("span",Cs,V(U.value)+"%",1)]),l(Z,{theme:"line",percentage:U.value,label:!1,status:U.value===100?"success":"active"},null,8,["percentage","status"])])):I("",!0),n.value?I("",!0):(r(),y("div",xs,[l(J,{variant:"outline",onClick:L},{default:o(()=>[...C[6]||(C[6]=[S("取消",-1)])]),_:1}),l(J,{theme:"primary",onClick:E},{default:o(()=>[...C[7]||(C[7]=[S("开始解压",-1)])]),_:1})]))])]),_:1},8,["visible","close-on-overlay-click"])}}}),Fs=X(Ps,[["__scopeId","data-v-9c603684"]]),Us={class:"permission-form"},Is={class:"presets"},zs={class:"preset-list"},Ds={key:0,class:"preset-desc"},Ss={key:1,class:"preset-desc"},Vs={key:2,class:"preset-desc"},Bs=H({__name:"FilePermission",props:{visible:{type:Boolean},instanceId:{},currentPath:{},targets:{}},emits:["update:visible","success"],setup(F,{emit:B}){const f=F,b=B,m=i({mode:"755"}),p=i(!1),a=[{label:"755 (推荐: 所有者读写执/他人读执)",value:"755"},{label:"777 (全开: 所有权限)",value:"777"},{label:"644 (普通文件: 读写/读)",value:"644"}],n=j(()=>f.targets.length===1?`修改权限 - ${f.targets[0].name}`:`批量修改权限 (${f.targets.length} 项)`);G(()=>f.visible,h=>{h&&f.targets.length>0&&(f.targets.length===1&&f.targets[0].mode&&f.targets[0].mode!=="Unknown"?m.value.mode=f.targets[0].mode:m.value.mode="755")});const U=()=>{b("update:visible",!1),p.value=!1},_=async()=>{if(!m.value.mode||!/^[0-7]{3}$/.test(m.value.mode)){u.warning("请输入正确的3位八进制权限码 (如 755)");return}p.value=!0;let h=0,P=0;try{for(const w of f.targets)try{await _t(D,w.fullPath,m.value.mode),h++}catch(v){P++,console.error(v)}P===0?u.success("权限修改成功"):u.warning(`完成: 成功 ${h} 个, 失败 ${P} 个`),b("success"),U()}catch(w){u.error(w.message||"请求失败")}finally{p.value=!1}},D=f.instanceId;return(h,P)=>{const w=$("t-input"),v=$("t-form-item"),E=$("t-tag"),T=$("t-dialog");return r(),M(T,{visible:F.visible,header:n.value,"confirm-btn":{content:"保存修改",loading:p.value},"on-close":U,"on-confirm":_,width:"480px"},{default:o(()=>[c("div",Us,[l(v,{label:"权限代码","required-mark":""},{default:o(()=>[l(w,{modelValue:m.value.mode,"onUpdate:modelValue":P[0]||(P[0]=L=>m.value.mode=L),placeholder:"例如: 755",tips:"请输入3位八进制数字 (Linux Chmod)"},null,8,["modelValue"])]),_:1}),c("div",Is,[P[1]||(P[1]=c("div",{class:"preset-label"},"快捷设置：",-1)),c("div",zs,[(r(),y(Se,null,De(a,L=>l(E,{key:L.value,variant:"light-outline",theme:"primary",class:"preset-tag",style:{cursor:"pointer"},onClick:k=>m.value.mode=L.value},{default:o(()=>[S(V(L.value),1)]),_:2},1032,["onClick"])),64))]),m.value.mode==="755"?(r(),y("div",Ds,"适合可执行程序、脚本或文件夹")):I("",!0),m.value.mode==="644"?(r(),y("div",Ss,"适合普通配置文件、日志等")):I("",!0),m.value.mode==="777"?(r(),y("div",Vs,"允许任何人写入 (不安全)")):I("",!0)])])]),_:1},8,["visible","header","confirm-btn"])}}}),Ls=X(Bs,[["__scopeId","data-v-6dc7353c"]]),Es={class:"file-manager-wrapper"},Ms={class:"toolbar"},Rs={class:"breadcrumb-area"},js={class:"actions-area"},Ts={key:0},Ns={key:0},Os={key:0},Ks={class:"table-wrapper"},qs=["onClick"],Ws={class:"name-text"},As={class:"op-actions"},Gs={key:0,class:"selection-bar"},Hs={key:0,class:"selection-info"},Xs={key:1,class:"selection-info"},Ys={class:"selection-actions"},Zs={key:0},Js={key:0},Qs={key:0},ea={key:0},ta={key:0},sa={key:0},aa={key:1,class:"selection-bar clipboard-bar"},la={class:"selection-info"},oa={key:0},na={key:1},ia={class:"selection-actions"},ra=H({__name:"index",setup(F){const B=mt(),f=pt(),b=j(()=>Number(B.params.serverFilesId)),m=i(!1),p=i([]),a=i(""),n=i([]),U=i(window.innerWidth),_=j(()=>U.value<768),D=i(!1),h=i(!1),P=i(!1),w=i(!1),v=i(!1),E=i(!1),T=i(!1),L=i(!1),k=i(!1),C=i(""),O=i(""),Y=i(""),Z=i(!1),J=i(""),W=i(""),R=i(""),A=i(""),ie=i(null),fe=i([]),he=i(""),se=i([]),ge=()=>{U.value=window.innerWidth},ae=t=>{var d;const e=(d=t.split(".").pop())==null?void 0:d.toLowerCase();return["png","jpg","jpeg","gif","ico","webp","bmp","svg"].includes(e||"")},be=t=>{var d;const e=(d=t.split(".").pop())==null?void 0:d.toLowerCase();return["zip","jar"].includes(e||"")},_e=t=>{var d;if(t.type==="folder"){const g=t.name.toLowerCase();return g==="config"||g==="settings"?{icon:Wt,color:"var(--td-warning-color)"}:g.startsWith("world")||g==="level"?{icon:At,color:"var(--td-success-color)"}:["plugins","mods","libraries"].includes(g)?{icon:Gt,color:"var(--td-brand-color)"}:["logs","crash-reports","cache","temp"].includes(g)?{icon:Ie,color:"var(--td-gray-color-6)"}:{icon:Ie,color:"var(--td-brand-color)"}}const e=(d=t.name.split(".").pop())==null?void 0:d.toLowerCase();return["png","jpg","jpeg","gif","ico","webp"].includes(e||"")?{icon:Ht,color:"var(--td-success-color)"}:["jar","zip","rar","7z","tar","gz"].includes(e||"")?{icon:Fe,color:"#722ed1"}:["yml","yaml","json","properties","toml","xml","conf","sh","bat","cmd"].includes(e||"")?{icon:Xt,color:"var(--td-warning-color)"}:["log","txt","md","lock"].includes(e||"")?{icon:Ue,color:"var(--td-gray-color-6)"}:{icon:Yt,color:"var(--td-text-color-secondary)"}},re=j(()=>p.value.some(t=>t.permission&&t.permission!=="")),Ve=j(()=>{const t={colKey:"row-select",type:"multiple",width:_.value?34:40},e={colKey:"name",title:"文件名",ellipsis:!0,width:"auto"},d={colKey:"operation",title:"操作",width:_.value?50:80,align:"center",fixed:_.value?"right":void 0};return _.value?[t,e,d]:[t,e,{colKey:"size",title:"大小",width:100,align:"right"},...re.value?[{colKey:"permission",title:"权限",width:80,align:"center"}]:[],{colKey:"lastModified",title:"修改时间",width:180,align:"center"},d]}),Be=j(()=>{const t=a.value.split("/").filter(g=>g),e=[{name:"根目录",path:""}];let d="";return t.forEach(g=>{d=d?`${d}/${g}`:g,e.push({name:g,path:d})}),e}),Le=j(()=>n.value.length>0),Ee=t=>{if(t===0)return"-";const e=["B","KB","MB","GB","TB"];let d=0;for(;t>=1024&&d<e.length-1;)t/=1024,d++;return`${t.toFixed(1)} ${e[d]}`},Me=t=>t?new Date(t).toLocaleString():"-",le=async()=>{m.value=!0,n.value=[];try{const t=await yt(b.value,a.value);p.value=t||[]}catch(t){console.error(t)}finally{m.value=!1}},ue=async t=>{W.value&&(window.URL.revokeObjectURL(W.value),W.value="");const e=a.value?`${a.value}/${t}`:t,d=u.loading("正在加载图片...");try{const g=await Pe(b.value,e);if(!(g instanceof Blob))throw new Error("无效数据");W.value=window.URL.createObjectURL(g),J.value=t,h.value=!0,u.close(d)}catch{u.close(d),u.error("加载失败")}},ce=async(t,e=!1)=>{if(e){O.value=t,Y.value="",D.value=!0;return}if(ae(t)){ue(t);return}const d=a.value?`${a.value}/${t}`:t,g=u.loading("正在读取文件...");try{const x=await kt(b.value,d);O.value=t,Y.value=x,D.value=!0,u.close(g)}catch(x){u.close(g),u.error("读取失败: "+x.message)}},Re=()=>{R.value="",P.value=!0},ye=()=>{if(!R.value.trim()){u.warning("请输入文件名");return}P.value=!1,ce(R.value,!0)},je=async t=>{Z.value=!0;try{const e=a.value?`${a.value}/${O.value}`:O.value;await Ut(b.value,e,t),u.success("保存成功"),D.value=!1,N()}catch{u.error("保存失败")}finally{Z.value=!1}},Te=()=>{C.value="",k.value=!0},we=async()=>{if(!C.value.trim()){u.warning("请输入文件夹名称");return}try{await $t(b.value,a.value,C.value),u.success("文件夹创建成功"),k.value=!1,N()}catch(t){u.error(`创建失败: ${t.message||"未知错误"}`)}},Ne=t=>{ie.value={name:t.name,fullPath:a.value?`${a.value}/${t.name}`:t.name},A.value=t.name,w.value=!0},ke=async()=>{if(!A.value||!ie.value)return;const t=a.value?`${a.value}/${A.value}`:A.value;try{await Ct(b.value,ie.value.fullPath,t),u.success("重命名成功"),w.value=!1,N()}catch{u.error("重命名失败")}},$e=t=>{let e=[];if(t?e=[t.name]:e=[...n.value],e.length===0)return;const d=Zt.confirm({header:"确认删除",body:`确定要永久删除这 ${e.length} 项吗？`,theme:"danger",onConfirm:async()=>{try{const g=e.map(x=>a.value?`${a.value}/${x}`:x);await xt(b.value,g),u.success("删除成功"),n.value=[],N(),d.hide()}catch{u.error("删除失败")}}})},Oe=t=>{if(t.type==="folder"){const e=a.value===""?"":"/";a.value=`${a.value}${e}${t.name}`}else ae(t.name)?ue(t.name):ce(t.name)},Ke=t=>{a.value=t},N=()=>le(),Ce=async t=>{var d;let e=[];if(t?e=[t.name]:e=[...n.value],e.length!==0){for(const g of e){if(((d=p.value.find(ee=>ee.name===g))==null?void 0:d.type)==="folder"){u.warning(`暂不支持下载文件夹: ${g} 请压缩后再下载！`);continue}const x=a.value?`${a.value}/${g}`:g,Q=u.loading(`准备下载: ${g}...`);try{const ee=await Pe(b.value,x),de=new Blob([ee]),q=document.createElement("a");q.href=window.URL.createObjectURL(de),q.download=g,q.style.display="none",document.body.appendChild(q),q.click(),document.body.removeChild(q),window.URL.revokeObjectURL(q.href),u.close(Q)}catch{u.close(Q),u.error(`下载失败: ${g}`)}}t||(n.value=[])}},qe=()=>{n.value.length!==0&&(fe.value=[...n.value],E.value=!0)},We=()=>{n.value=[],N()},Ae=t=>{he.value=t.name,T.value=!0},Ge=()=>{N()},xe=t=>{if(se.value=[],t)se.value.push({name:t.name,fullPath:a.value?`${a.value}/${t.name}`:t.name,mode:t.permission||"755"});else{if(n.value.length===0)return;n.value.forEach(e=>{const d=p.value.find(g=>g.name===e);d&&se.value.push({name:d.name,fullPath:a.value?`${a.value}/${d.name}`:d.name,mode:d.permission||"755"})})}L.value=!0},He=()=>{n.value=[],N()},Xe=()=>N(),K=i([]),oe=i("copy"),ne=i(""),Ye=j(()=>K.value.length>0),Ze=j(()=>a.value===ne.value),Je=()=>{if(n.value.length===0)return;const t=n.value.map(e=>a.value?`${a.value}/${e}`:e);K.value=t,oe.value="copy",ne.value=a.value,n.value=[],u.info(`已复制 ${t.length} 项，请前往目标目录粘贴`)},Qe=()=>{if(n.value.length===0)return;const t=n.value.map(e=>a.value?`${a.value}/${e}`:e);K.value=t,oe.value="move",ne.value=a.value,n.value=[],u.info(`已剪切 ${t.length} 项，请前往目标目录粘贴`)},et=()=>{K.value=[],ne.value="",u.info("已取消操作")},tt=async()=>{if(K.value.length===0)return;const t=u.loading("正在粘贴中...");try{oe.value==="copy"?await Pt(b.value,K.value,a.value):await Ft(b.value,K.value,a.value),u.success("粘贴成功"),K.value=[],N()}catch(e){u.error(`粘贴失败: ${e.message||"未知错误"}`)}finally{u.close(t)}};return G(a,t=>{f.replace({query:{...B.query,path:t||void 0}}),le()}),G(b,()=>{B.name==="InstanceFiles"&&(a.value="",n.value=[],le())}),ze(()=>{const t=B.query.path;window.addEventListener("resize",ge),t?a.value=t:le()}),pe(()=>{window.removeEventListener("resize",ge)}),(t,e)=>{const d=$("t-breadcrumb-item"),g=$("t-breadcrumb"),x=$("t-button"),Q=$("t-dropdown"),ee=$("t-tag"),de=$("t-table"),q=$("t-card"),ve=$("t-input"),me=$("t-dialog");return r(),y("div",Es,[l(q,{bordered:!1,class:"file-manager-card"},{default:o(()=>[c("div",Ms,[c("div",Rs,[l(g,{"max-item-width":_.value?"80px":"150px"},{default:o(()=>[(r(!0),y(Se,null,De(Be.value,(s,te)=>(r(),M(d,{key:te,class:"crumb-item",onClick:ua=>Ke(s.path)},ut({default:o(()=>[S(" "+V(s.name),1)]),_:2},[te===0?{name:"icon",fn:o(()=>[l(z(Vt))]),key:"0"}:void 0]),1032,["onClick"]))),128))]),_:1},8,["max-item-width"])]),c("div",js,[l(x,{variant:"outline",size:"medium",onClick:e[0]||(e[0]=s=>z(wt)(`/instance/console/${b.value}`))},{icon:o(()=>[l(z(Bt))]),default:o(()=>[_.value?I("",!0):(r(),y("span",Ts,"控制台"))]),_:1}),l(Q,{options:[{content:"新建文件",value:"file",onClick:Re},{content:"新建文件夹",value:"folder",onClick:Te}]},{default:o(()=>[l(x,{variant:"outline",size:"medium"},{icon:o(()=>[l(z(Lt))]),default:o(()=>[_.value?I("",!0):(r(),y("span",Ns,"新建"))]),_:1})]),_:1},8,["options"]),l(x,{theme:"primary",size:"medium",onClick:e[1]||(e[1]=s=>v.value=!0)},{icon:o(()=>[l(z(Et))]),default:o(()=>[_.value?I("",!0):(r(),y("span",Os,"上传"))]),_:1}),l(x,{variant:"outline",size:"medium",onClick:N},{icon:o(()=>[l(z(Mt))]),_:1})])]),c("div",Ks,[l(de,{"selected-row-keys":n.value,"onUpdate:selectedRowKeys":e[2]||(e[2]=s=>n.value=s),data:p.value,columns:Ve.value,"row-key":"name",loading:m.value,hover:!0,size:"medium",class:"file-table"},{name:o(({row:s})=>[c("div",{class:"file-name-cell",onClick:ct(te=>Oe(s),["stop"])},[(r(),M(dt(_e(s).icon),{class:"file-icon",style:vt({color:_e(s).color})},null,8,["style"])),c("span",Ws,V(s.name),1)],8,qs)]),size:o(({row:s})=>[S(V(Ee(s.size)),1)]),permission:o(({row:s})=>[s.permission?(r(),M(ee,{key:0,variant:"light",size:"small"},{default:o(()=>[S(V(s.permission),1)]),_:2},1024)):I("",!0)]),lastModified:o(({row:s})=>[S(V(Me(s.lastModified)),1)]),operation:o(({row:s})=>[c("div",As,[l(Q,{placement:_.value?"bottom-right":"bottom",options:[{content:"解压",value:"decompress",onClick:()=>Ae(s),show:be(s.name)&&s.type!=="folder"},{content:ae(s.name)?"预览":"编辑",value:"edit",onClick:()=>ae(s.name)?ue(s.name):ce(s.name),disabled:s.type==="folder"||be(s.name)},{content:"权限",value:"permission",onClick:()=>xe(s),show:re.value},{content:"下载",value:"download",onClick:()=>Ce(s)},{content:"重命名",value:"rename",onClick:()=>Ne(s)},{content:"删除",value:"delete",theme:"error",onClick:()=>$e(s)}].filter(te=>te.show!==!1)},{default:o(()=>[l(x,{variant:"text",shape:"square",size:"medium"},{default:o(()=>[l(z(Rt))]),_:1})]),_:1},8,["placement","options"])])]),empty:o(()=>[...e[22]||(e[22]=[c("div",{class:"empty-state"},"暂无文件",-1)])]),_:1},8,["selected-row-keys","data","columns","loading"])])]),_:1}),l(rt,{name:"slide-up"},{default:o(()=>[Le.value?(r(),y("div",Gs,[_.value?(r(),y("div",Xs,[c("span",null,V(n.value.length),1)])):(r(),y("div",Hs,[e[23]||(e[23]=S(" 已选 ",-1)),c("span",null,V(n.value.length),1),e[24]||(e[24]=S(" 项 ",-1))])),c("div",Ys,[l(x,{size:"small",variant:"text",theme:"primary",onClick:e[3]||(e[3]=s=>Je())},{icon:o(()=>[l(z(jt))]),default:o(()=>[_.value?I("",!0):(r(),y("span",Zs,"复制"))]),_:1}),l(x,{size:"small",variant:"text",theme:"primary",onClick:e[4]||(e[4]=s=>Qe())},{icon:o(()=>[l(z(Tt))]),default:o(()=>[_.value?I("",!0):(r(),y("span",Js,"剪切"))]),_:1}),l(x,{size:"small",variant:"text",theme:"primary",onClick:e[5]||(e[5]=s=>qe())},{icon:o(()=>[l(z(Fe))]),default:o(()=>[_.value?I("",!0):(r(),y("span",Qs,"压缩"))]),_:1}),l(x,{size:"small",variant:"text",theme:"primary",onClick:e[6]||(e[6]=s=>Ce())},{icon:o(()=>[l(z(Nt))]),default:o(()=>[_.value?I("",!0):(r(),y("span",ea,"下载"))]),_:1}),re.value?(r(),M(x,{key:0,size:"small",variant:"text",theme:"primary",onClick:e[7]||(e[7]=s=>xe())},{icon:o(()=>[l(z(Ot))]),default:o(()=>[_.value?I("",!0):(r(),y("span",ta,"权限"))]),_:1})):I("",!0),l(x,{size:"small",variant:"text",theme:"danger",onClick:e[8]||(e[8]=s=>$e())},{icon:o(()=>[l(z(Kt))]),default:o(()=>[_.value?I("",!0):(r(),y("span",sa,"删除"))]),_:1}),l(x,{size:"small",variant:"text",onClick:e[9]||(e[9]=s=>n.value=[])},{default:o(()=>[...e[25]||(e[25]=[S("取消",-1)])]),_:1})])])):Ye.value?(r(),y("div",aa,[c("div",la,[oe.value==="copy"?(r(),y("span",oa,"准备复制")):(r(),y("span",na,"准备移动")),c("span",null,V(K.value.length),1),e[26]||(e[26]=S(" 项 ",-1))]),c("div",ia,[l(x,{theme:"primary",disabled:Ze.value,onClick:tt},{icon:o(()=>[l(z(Ue))]),default:o(()=>[e[27]||(e[27]=S(" 粘贴在此处 ",-1))]),_:1},8,["disabled"]),l(x,{variant:"text",theme:"default",onClick:et},{icon:o(()=>[l(z(qt))]),default:o(()=>[e[28]||(e[28]=S(" 取消 ",-1))]),_:1})])])):I("",!0)]),_:1}),l(ss,{visible:D.value,"onUpdate:visible":e[10]||(e[10]=s=>D.value=s),"file-name":O.value,content:Y.value,loading:Z.value,onSave:je},null,8,["visible","file-name","content","loading"]),l(me,{visible:P.value,"onUpdate:visible":e[12]||(e[12]=s=>P.value=s),header:"新建文件","on-confirm":ye},{default:o(()=>[l(ve,{modelValue:R.value,"onUpdate:modelValue":e[11]||(e[11]=s=>R.value=s),placeholder:"输入文件名",autofocus:!0,onEnter:ye},null,8,["modelValue"])]),_:1},8,["visible"]),l(me,{visible:w.value,"onUpdate:visible":e[14]||(e[14]=s=>w.value=s),header:"重命名","on-confirm":ke},{default:o(()=>[l(ve,{modelValue:A.value,"onUpdate:modelValue":e[13]||(e[13]=s=>A.value=s),placeholder:"输入新名称",autofocus:!0,onEnter:ke},null,8,["modelValue"])]),_:1},8,["visible"]),l(zt,{visible:v.value,"onUpdate:visible":e[15]||(e[15]=s=>v.value=s),"instance-id":b.value,"current-path":a.value,onSuccess:Xe},null,8,["visible","instance-id","current-path"]),l(is,{visible:h.value,"onUpdate:visible":e[16]||(e[16]=s=>h.value=s),"file-name":J.value,"image-blob-url":W.value},null,8,["visible","file-name","image-blob-url"]),l(fs,{visible:E.value,"onUpdate:visible":e[17]||(e[17]=s=>E.value=s),"instance-id":b.value,"current-path":a.value,files:fe.value,onSuccess:We},null,8,["visible","instance-id","current-path","files"]),l(Fs,{visible:T.value,"onUpdate:visible":e[18]||(e[18]=s=>T.value=s),"instance-id":b.value,"current-path":a.value,"file-name":he.value,onSuccess:Ge},null,8,["visible","instance-id","current-path","file-name"]),l(Ls,{visible:L.value,"onUpdate:visible":e[19]||(e[19]=s=>L.value=s),"instance-id":b.value,"current-path":a.value,targets:se.value,onSuccess:He},null,8,["visible","instance-id","current-path","targets"]),l(me,{visible:k.value,"onUpdate:visible":e[21]||(e[21]=s=>k.value=s),header:"新建文件夹","on-confirm":we},{default:o(()=>[l(ve,{modelValue:C.value,"onUpdate:modelValue":e[20]||(e[20]=s=>C.value=s),placeholder:"输入文件夹名称",autofocus:!0,onEnter:we},null,8,["modelValue"])]),_:1},8,["visible"])])}}}),el=X(ra,[["__scopeId","data-v-60b3ec1a"]]);export{el as default};
