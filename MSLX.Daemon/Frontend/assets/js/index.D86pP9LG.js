import{g as Y,c as Z,u as F,d as H}from"./user.B8__PLdf.js";import{u as O,_ as Q}from"./index.DKJwv0BD.js";import{M as u,D as W}from"./tdesign-vue-next.Csn1Y9JM.js";import{g as X,z as ee,U as te}from"./tdesign-icons-vue-next.BalHEYKK.js";import{l as ae,o as oe,aV as w,j as o,a$ as s,r as p,aZ as r,aU as c,aY as d,G as n,J as b,b2 as h,a_ as U,b3 as se,k as le,c as D}from"./index.DuVfB4dr.js";import"./pinia.K9HejpEf.js";import"./pinia-plugin-persistedstate_2eabddac918ad8d0cf74e67f4601f4c8.n2tMOXAx.js";import"./vue-router.BSuyFzNa.js";import"./tvision-color.Cy78gTfV.js";import"./chroma-js.DO2ptVd8.js";import"./core-js-pure.DbDavgKW.js";import"./bezier-easing.D5A5epFU.js";import"./lodash.CpoxsuHF.js";import"./axios.B9ygI19o.js";import"./qs.CsZETzAf.js";import"./side-channel.gyxQHTce.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.CWmL7r7A.js";import"./side-channel-list.DZ_HK50j.js";import"./side-channel-map.Ujj6CYbr.js";import"./get-intrinsic.DZF4l_-S.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.GRuZvLsk.js";import"./dunder-proto.BfGlLUzx.js";import"./call-bind-apply-helpers.DPbVMkjK.js";import"./function-bind.CHqF18-c.js";import"./hasown.B1sN64jK.js";import"./call-bound.DTRAK3sj.js";import"./side-channel-weakmap.D0YmY7JX.js";import"./nprogress.COlaCQ7y.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./lodash-es.sbUBen0f.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";const re={class:"user-manage"},ne={class:"toolbar"},ie={class:"left-action"},de={class:"right-search"},me={class:"user-info-cell"},ue={class:"text-info"},pe={class:"nickname"},ce={class:"username"},fe={key:0,class:"time-text"},_e={key:1,class:"time-placeholder"},ve={class:"op-buttons"},ge=ae({__name:"index",setup(ye){const V=p(!1),k=p([]),v=p(""),L=O(),f=p(!1),i=p("create"),x=p(!1),t=le({id:"",username:"",name:"",password:"",role:"admin",resetApiKey:!1}),z={username:[{required:!0,message:"请输入用户名",type:"error"}],role:[{required:!0,message:"请选择角色",type:"error"}],password:[{validator:l=>i.value==="create"&&!l?{result:!1,message:"创建用户时密码必填",type:"error"}:!0}]},S=D(()=>[{colKey:"info",title:"用户信息",width:200,fixed:"left",cell:"info-slot"},{colKey:"role",title:"角色",width:100,cell:"role-slot"},{colKey:"lastLogin",title:"最后登录",width:180,cell:"time-slot",className:"hidden-xs"},{colKey:"op",title:"操作",width:140,fixed:"right",cell:"op-slot"}]),C=D(()=>{if(!v.value)return k.value;const l=v.value.toLowerCase();return k.value.filter(e=>e.username.toLowerCase().includes(l)||e.name&&e.name.toLowerCase().includes(l))}),g=async()=>{V.value=!0;try{const l=await Y();k.value=l}catch(l){u.error(l.message||"获取用户列表失败")}finally{V.value=!1}},N=()=>{i.value="create",t.id="",t.username="",t.name="",t.password="",t.role="admin",t.resetApiKey=!1,f.value=!0},P=l=>{i.value="edit",t.id=l.id,t.username=l.username,t.name=l.name,t.password="",t.role=l.role,t.resetApiKey=!1,f.value=!0},$=async({validateResult:l})=>{if(l===!0){x.value=!0;try{i.value==="create"?(await Z({username:t.username,password:t.password,name:t.name,role:t.role}),u.success("用户创建成功")):(await F(t.id,{name:t.name,password:t.password||void 0,role:t.role,resetApiKey:t.resetApiKey}),u.success("用户更新成功")),f.value=!1,g()}catch(e){u.error(e.message||"操作失败")}finally{x.value=!1}}},B=l=>{const e=W.confirm({header:"删除警告",body:`确定要删除用户 "${l.username}" 吗？此操作不可恢复。`,theme:"danger",onConfirm:async()=>{try{e.hide(),await H(l.id),u.success("删除成功"),g()}catch(m){u.error(m.message||"删除失败")}}})};return oe(()=>{g()}),(l,e)=>{const m=r("t-button"),y=r("t-input"),I=r("t-avatar"),K=r("t-tag"),M=r("t-divider"),T=r("t-table"),q=r("t-card"),_=r("t-form-item"),A=r("t-radio-button"),E=r("t-radio-group"),J=r("t-checkbox"),R=r("t-form"),j=r("t-dialog");return c(),w("div",re,[o(q,{bordered:!1,class:"main-card"},{default:s(()=>[d("div",ne,[d("div",ie,[o(m,{theme:"primary",onClick:N},{icon:s(()=>[o(b(X))]),default:s(()=>[e[7]||(e[7]=n(" 新增用户 ",-1))]),_:1})]),d("div",de,[o(y,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=a=>v.value=a),placeholder:"搜索用户名或昵称",clearable:""},{"prefix-icon":s(()=>[o(b(ee))]),_:1},8,["modelValue"]),o(m,{variant:"text",shape:"square",onClick:g},{icon:s(()=>[o(b(te))]),_:1})])]),o(T,{"row-key":"id",data:C.value,columns:S.value,loading:V.value,hover:!0,pagination:{defaultPageSize:20,total:C.value.length,showJumper:!0},class:"user-table","table-layout":"auto"},{"info-slot":s(({row:a})=>[d("div",me,[o(I,{image:a.avatar,size:"40px",shape:"circle","hide-on-load-failed":!1},{default:s(()=>[n(h(a.name?a.name[0].toUpperCase():"U"),1)]),_:2},1032,["image"]),d("div",ue,[d("div",pe,h(a.name||"未设置昵称"),1),d("div",ce,"@"+h(a.username),1)])])]),"role-slot":s(({row:a})=>[a.role==="admin"?(c(),U(K,{key:0,theme:"success",variant:"light",size:"small",shape:"round"},{default:s(()=>[...e[8]||(e[8]=[n("管理员",-1)])]),_:1})):(c(),U(K,{key:1,theme:"primary",variant:"light",size:"small",shape:"round"},{default:s(()=>[...e[9]||(e[9]=[n("普通用户",-1)])]),_:1}))]),"time-slot":s(({row:a})=>[a.lastLoginTime?(c(),w("span",fe,h(new Date(a.lastLoginTime).toLocaleString()),1)):(c(),w("span",_e,"从未登录"))]),"op-slot":s(({row:a})=>[d("div",ve,[o(m,{variant:"text",theme:"primary",size:"small",onClick:G=>P(a)},{default:s(()=>[...e[10]||(e[10]=[n(" 编辑 ",-1)])]),_:1},8,["onClick"]),o(M,{layout:"vertical"}),o(m,{variant:"text",theme:"danger",size:"small",disabled:a.id===b(L).userInfo.id||a.username==="admin",onClick:G=>B(a)},{default:s(()=>[...e[11]||(e[11]=[n(" 删除 ",-1)])]),_:1},8,["disabled","onClick"])])]),_:1},8,["data","columns","loading","pagination"])]),_:1}),o(j,{visible:f.value,"onUpdate:visible":e[6]||(e[6]=a=>f.value=a),header:i.value==="create"?"新增用户":"编辑用户","confirm-btn":{content:"提交",loading:x.value},"on-confirm":()=>l.$refs.formRef.submit(),width:"480px"},{default:s(()=>[o(R,{ref:"formRef",data:t,rules:z,"label-align":"top",onSubmit:$},{default:s(()=>[o(_,{label:"用户名",name:"username"},{default:s(()=>[o(y,{modelValue:t.username,"onUpdate:modelValue":e[1]||(e[1]=a=>t.username=a),placeholder:"登录账号",disabled:i.value==="edit"},null,8,["modelValue","disabled"])]),_:1}),o(_,{label:"昵称",name:"name"},{default:s(()=>[o(y,{modelValue:t.name,"onUpdate:modelValue":e[2]||(e[2]=a=>t.name=a),placeholder:"显示名称"},null,8,["modelValue"])]),_:1}),o(_,{label:"角色",name:"role"},{default:s(()=>[o(E,{modelValue:t.role,"onUpdate:modelValue":e[3]||(e[3]=a=>t.role=a),variant:"default-filled"},{default:s(()=>[o(A,{value:"user",disabled:""},{default:s(()=>[...e[12]||(e[12]=[n("普通用户",-1)])]),_:1}),o(A,{value:"admin"},{default:s(()=>[...e[13]||(e[13]=[n("管理员",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(_,{label:"密码",name:"password",help:i.value==="edit"?"留空则不修改密码":""},{default:s(()=>[o(y,{modelValue:t.password,"onUpdate:modelValue":e[4]||(e[4]=a=>t.password=a),type:"password",placeholder:"设置密码",autocomplete:"new-password"},null,8,["modelValue"])]),_:1},8,["help"]),i.value==="edit"?(c(),U(_,{key:0,label:"API 密钥"},{default:s(()=>[o(J,{modelValue:t.resetApiKey,"onUpdate:modelValue":e[5]||(e[5]=a=>t.resetApiKey=a)},{default:s(()=>[...e[14]||(e[14]=[n("重置该用户的 API Key",-1)])]),_:1},8,["modelValue"])]),_:1})):se("",!0)]),_:1},8,["data"])]),_:1},8,["visible","header","confirm-btn","on-confirm"])])}}}),lt=Q(ge,[["__scopeId","data-v-9c409721"]]);export{lt as default};
