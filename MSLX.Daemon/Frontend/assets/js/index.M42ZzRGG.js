import{a as he}from"./vue-router.CTuarHf7.js";import{F as h,bb as Xe,be as We,D as oe,P as Z,R as me,V as Se,aa as Me,aX as E,a$ as e,b5 as A,ak as Re,bd as gt,bk as yt,bi as bt,bj as _t,aY as f,K as ae,G as t,b0 as S,b2 as s,b6 as O,aZ as $e,b1 as J,ap as U,O as ne,ao as p,b3 as ue,am as qe,b4 as Ke,W as Oe,bc as kt,al as ze}from"./index.BbdIPky0.js";import{c as j}from"./ansi-colors.gpWjHU8Z.js";import{d as wt}from"./pinia.DE9DXmFR.js";import{u as He,_ as ie,f as ht,i as $t,g as xt,h as Ct,k as Be,s as Vt,l as Ye,m as St,r as de,c as Ae}from"./index.DqIOwG5d.js";import{g as Ut,b as Mt,c as Ze,u as It,d as ve}from"./instance.DMZuGnuc.js";import{S as Rt,g as Bt,a as Lt}from"./localJava.BDKjlfLh.js";import{M as G,N as Et,D as Pe}from"./tdesign-vue-next.CZ9kjS-B.js";import{af as At,a4 as Pt,ag as Le,ah as Ue,a1 as Tt,y as Fe,U as we,_ as Qe,a5 as et,ai as tt,aj as at,ak as Dt,z as xe,al as Ot,g as zt,c as Ft,am as Nt,aa as lt,ab as st,ae as Gt,M as nt,an as Jt,ao as jt,ap as Ne,aq as Ee,ar as Xt,as as Wt,m as qt,X as Kt,at as Ge,au as Ht,a8 as Yt,av as Zt,aw as Qt,ax as ea,ay as ta,az as aa,aA as la,aB as sa,aC as na}from"./tdesign-icons-vue-next.H9a-SwwU.js";import{F as oa}from"./FileUploader.ByRzZPjn.js";import{d as ia}from"./cron-parser.BqMfRICj.js";import{D as ra}from"./docs.CxArFray.js";import{i as Je}from"./echarts.J8iroDPP.js";import{V as ua}from"./zrender.B_NAtvFA.js";import{r as da}from"./md-editor-v3.9f48Dgbv.js";import{f as ca}from"./tools.CQnzORaS.js";import"./core-js-pure.DghWRT_o.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./pinia-plugin-persistedstate_561243483b11dd07f5acf9e797fda690.n2tMOXAx.js";import"./tvision-color.BU_YHHaJ.js";import"./chroma-js.Cmk4elvR.js";import"./bezier-easing.jp9ayU57.js";import"./lodash.B5_zCkFd.js";import"./axios.R-lXtGyY.js";import"./qs.BQOswwC-.js";import"./side-channel.B7VpeXu7.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.CD-SYzlK.js";import"./side-channel-list.CQN2BsdT.js";import"./side-channel-map.mJjiYxsE.js";import"./get-intrinsic.DZF4l_-S.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.GRuZvLsk.js";import"./dunder-proto.BfGlLUzx.js";import"./call-bind-apply-helpers.DPbVMkjK.js";import"./function-bind.CHqF18-c.js";import"./hasown.B1sN64jK.js";import"./call-bound.DTRAK3sj.js";import"./side-channel-weakmap.C4d6frlU.js";import"./nprogress.CMq2Rk2a.js";import"./lodash-es.ClUTdtmA.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";import"./luxon.BVaPVz1w.js";import"./tslib.BDyQ-Jie.js";import"./markdown-it.Baj76ayU.js";import"./mdurl.k9Sl0PQj.js";import"./uc.micro.kMc2yuuw.js";import"./entities.C20TfXL6.js";import"./linkify-it.DWYhiEiT.js";import"./punycode.js.Dj65hjkv.js";import"./markdown-it-image-figures.IpqUZCLv.js";import"./markdown-it-sub.Bxi31R0z.js";import"./markdown-it-sup.Bp2DoVCN.js";import"./lru-cache.DJEINSmt.js";import"./medium-zoom.bWEtUbjf.js";const Te=wt("instanceHub",()=>{const n=He(),b=h(null),$=h(!1),w=h(null),u=h(0),x=h(0);let _=Promise.resolve();const L=h({cpu:0,memBytes:0,memPercent:0}),v=new Set,i=new Set,k=new Set,z=d=>{x.value=d},W=d=>(_=_.then(async()=>{var C;if(u.value++,((C=b.value)==null?void 0:C.state)==="Connected"&&w.value===d)return;b.value&&await r(),w.value=d,x.value=0;const{baseUrl:l,token:y}=n,B=new URL("/api/hubs/instanceControlHub",l||window.location.origin);y&&B.searchParams.append("x-user-token",y);const o=new Xe().withUrl(B.toString(),{withCredentials:!1}).configureLogging(We.Warning).withAutomaticReconnect([0,2e3,5e3,1e4]).build();o.on("ReceiveLog",T=>{v.forEach(X=>X(T))}),o.on("RequireEULA",()=>{i.forEach(T=>T())}),o.on("CommandResult",(T,X)=>{k.forEach(q=>q(T,X))}),o.on("ReceiveStatus",(T,X,q)=>{if(String(T)!==String(d))return;let I=0;if(x.value>0){const F=x.value*1024*1024;I=q/F*100,I>100&&(I=100)}L.value={cpu:X,memBytes:q,memPercent:I}}),o.onreconnecting(()=>v.forEach(T=>T("\x1B[1;31m[System] 连接中断，尝试重连...\x1B[0m"))),o.onreconnected(async()=>{v.forEach(T=>T("\x1B[1;32m[System] 网络恢复，重新加入会话...\x1B[0m"));try{await o.invoke("JoinGroup",d)}catch(T){console.error(T)}});try{await o.start(),await o.invoke("JoinGroup",d),b.value=o,$.value=!0,v.forEach(T=>T("\x1B[1;32m[System] 已连接到实例控制服务\x1B[0m"))}catch(T){$.value=!1,v.forEach(X=>X(`\x1B[1;31m[Error] 连接失败: ${T.message}\x1B[0m`)),w.value=null,b.value=null}}),_),P=()=>(_=_.then(async()=>{u.value>0&&u.value--,u.value===0&&await r()}),_),r=async()=>{if(b.value)try{b.value.state==="Connected"&&w.value&&await b.value.invoke("LeaveGroup",w.value),await b.value.stop()}catch(d){console.warn(d)}b.value=null,$.value=!1,w.value=null,x.value=0,L.value={cpu:0,memBytes:0,memPercent:0}};return{isConnected:$,stats:L,currentServerId:w,connect:W,disconnect:P,setMaxMemory:z,sendCommand:async d=>{if(!b.value||b.value.state!=="Connected"||!w.value)throw new Error("未连接到服务");await b.value.invoke("SendCommand",w.value,d)},onLog:d=>(v.add(d),()=>v.delete(d)),onEula:d=>(i.add(d),()=>v.delete(d)),onCommandResult:d=>(k.add(d),()=>k.delete(d))}});j.enabled=!0;const va=n=>n?(n.includes("Done")&&n.includes("!")&&(n=n.replace(/Done \((.*?)\)!/g,(b,$)=>`${j.green.bold("Done")} (${j.blue($)})!`)),n.startsWith("[System]")&&(n=n.replace(/^\[System\]/,`[${j.blue.bold("System")}]`)),n.includes("[MSLX]")&&(n=n.replace(/\[MSLX\]/g,`[${j.magenta.bold("MSLX")}]`)),n.includes("[MSLX-Backup]")&&(n=n.replace(/\[MSLX-Backup\]/g,`[${j.magenta.bold("MSLX-Backup")}]`)),n.includes("[MSLX-Daemon]")&&(n=n.replace(/\[MSLX-Daemon\]/g,`[${j.magenta.bold("MSLX-Daemon")}]`)),n.startsWith(">>>")&&(n=n.replace(/^>>>/,j.red.bold(">>>"))),n=n.replace(/^\[(\d{2}:\d{2}:\d{2})\s+(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]:/,(b,$,w)=>{let u=w;switch(w){case"INFO":u=j.green("INFO");break;case"WARN":case"WARNING":u=j.magenta.bold("WARN");break;case"ERROR":case"FATAL":u=j.red.bold(w);break;case"DEBUG":u=j.blue("DEBUG");break}return`[${j.gray($)} ${u}]:`}),/^\[\d{2}:\d{2}:\d{2}\]/.test(n)&&(n=n.replace(/^\[(\d{2}:\d{2}:\d{2})\]/,(b,$)=>`[${j.gray($)}]`)),n=n.replace(/\[([^/]+)\/(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]/g,(b,$,w)=>{const u=j.blue($);let x=w;switch(w){case"INFO":x=j.green("INFO");break;case"WARN":x=j.magenta("WARN");break;case"ERROR":x=j.red.bold("ERROR");break}return`[${u}/${x}]`}),n=n.replace(new RegExp("(?<=:\\s|^)\\s*\\[([a-zA-Z0-9_\\-.\\s]+)\\](?=\\s)","g"),(b,$)=>$==="System"||$.includes("MSLX")?b:` [${j.bold.black($)}]`),n=n.replace(/(https?:\/\/[^\s]+)/g,b=>j.blue.underline(b)),n=n.replace(/\b\d+\.\d+(\.\d+)?(-[a-zA-Z0-9]+)?\b/g,b=>j.magenta(b)),n=n.replace(/\b\d+(\.\d+)?\s?(ms|s|%|MB|GB|KB)\b/gi,b=>j.blue(b)),n=n.replace(new RegExp("(\\u001b\\[[\\d;]*m)|((?<!\\d:\\d)\\b\\d+\\b(?!\\s*:\\s*\\d))","g"),(b,$,w)=>{if($)return b;if(w){if(w.length>=4&&w.length<=6)return j.blue(w);if(w.length<=3)return j.blue(w)}return b}),n=n.replace(/(\*:\d{1,5})/,b=>j.blue.bold(b)),n=n.replace(/\b(Loaded|Saved|Starting|Started|Connected)\b/g,b=>j.green(b)),n=n.replace(/\bDone\b(?!\u001b)/g,j.green.bold("Done")),n=n.replace(/\b(Failed|Exception|Error|Caused by|Stopping|Closed)\b/g,b=>j.red.bold(b)),n=n.replace(/\b(Loading|Preparing|Generating|Saving|Using|Running)\b/g,b=>j.magenta(b)),n=n.replace(/\b(Minecraft|Paper|Velocity|Java)\b/gi,b=>j.bold.black(b)),n=n.replace(/'minecraft:[a-z_]+'/g,b=>j.magenta(b)),n=n.replace(/\n/g,`\r
`),n):"",ma={class:"terminal-header"},pa={class:"tab-title"},fa={class:"terminal-footer"},ga=oe({__name:"ServerTerminal",props:{serverId:{}},emits:["update"],setup(n,{expose:b,emit:$}){const w=n,u=$,x=Te(),_=h(null),L=h(null);let v=null,i=null,k=null,z=null,W=null,P=null,r="";const g=h(""),c={dark:{background:"transparent",foreground:"#cccccc",cursor:"#cccccc",selectionBackground:"#264f78",black:"#000000",red:"#cd3131",green:"#0dbc79",yellow:"#e5e510",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"},light:{background:"transparent",foreground:"#333333",cursor:"#333333",selectionBackground:"#add6ff",black:"#000000",red:"#cd3131",green:"#00bc79",yellow:"#9d9d10",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"}};j.enabled=!0;const m=I=>va(I),D=()=>{if(!L.value||!_.value)return;if(v){v.clear(),o();return}const I=document.documentElement.getAttribute("theme-mode")==="dark";v=new bt.Terminal({cursorBlink:!0,cursorStyle:"block",fontSize:13,fontFamily:'Menlo, Monaco, "Courier New", monospace',lineHeight:1.4,theme:I?c.dark:c.light,disableStdin:!1,convertEol:!0,allowTransparency:!0}),i=new _t.FitAddon,v.loadAddon(i),v.open(L.value),v.onData(Y=>d(Y));const F=()=>{if(L.value&&L.value.clientWidth>0&&L.value.clientHeight>0)try{i==null||i.fit()}catch(Y){console.warn(Y)}};k=new ResizeObserver(()=>window.requestAnimationFrame(F)),k.observe(_.value),setTimeout(F,100),o()},d=async I=>{!v||!w.serverId||(I==="\r"?(v.write(`\r
`),r.trim()&&await y(r),r=""):I===""?r.length>0&&(r=r.slice(0,-1),v.write("\b \b")):I>=" "&&(r+=I,v.write(I)))},l=async()=>{if(!g.value)return;const I=g.value;v==null||v.writeln(I),await y(I),g.value=""},y=async I=>{try{await x.sendCommand(I)}catch(F){v==null||v.writeln(`\x1B[1;31m[Error] ${F.message}\x1B[0m`)}},B=()=>{if(!v)return;const I=document.documentElement.getAttribute("theme-mode")==="dark";v.options.theme=I?c.dark:c.light},o=()=>{v==null||v.writeln("\x1B[1;34m[System]\x1B[0m 正在连接服务器控制台 ..."),v==null||v.writeln(`\x1B[1;34m[System]\x1B[0m 实例 ID: ${w.serverId}`),v==null||v.writeln("")},C=async()=>{w.serverId&&(W&&W(),W=x.onLog(I=>{v&&v.writeln(m(I)),I.startsWith("[MSLX]")&&u("update")}),P&&P(),P=x.onCommandResult((I,F)=>{I||v==null||v.writeln(`\x1B[1;31m[System] 指令执行反馈: ${F}\x1B[0m`)}),await x.connect(w.serverId))},T=async()=>{W&&W(),P&&P(),await x.disconnect()};return b({writeln:I=>v==null?void 0:v.writeln(I),clear:()=>{v==null||v.clear(),o()}}),Z(()=>w.serverId,async(I,F)=>{I!==F&&(await T(),D(),await C())}),me(async()=>{await Se(),D(),z=new MutationObserver(B),z.observe(document.documentElement,{attributes:!0,attributeFilter:["theme-mode"]}),await C()}),Me(async()=>{z==null||z.disconnect(),k==null||k.disconnect(),v==null||v.dispose(),await T()}),(I,F)=>(f(),E("div",{ref_key:"terminalWrapper",ref:_,class:"terminal-wrapper"},[e("div",ma,[F[1]||(F[1]=e("div",{class:"dots"},[e("span",{class:"dot red"}),e("span",{class:"dot yellow"}),e("span",{class:"dot green"})],-1)),e("div",pa,"MSLX 服务端控制台 | #"+A(n.serverId),1)]),e("div",{ref_key:"terminalBody",ref:L,class:"terminal-body"},null,512),e("div",fa,[Re(e("input",{"onUpdate:modelValue":F[0]||(F[0]=Y=>g.value=Y),class:"cmd-input",placeholder:"发送控制台指令...",onKeyup:yt(l,["enter"])},null,544),[[gt,g.value]]),e("button",{class:"send-btn",onClick:l},"发送")])],512))}}),ya=ie(ga,[["__scopeId","data-v-343fefce"]]),ba={class:"settings-container"},_a={class:"setting-item"},ka={class:"setting-control"},wa={class:"setting-item"},ha={class:"setting-info"},$a={class:"desc"},xa={class:"setting-control"},Ca={class:"setting-item"},Va={class:"setting-control"},Sa={key:0,style:{"margin-top":"8px"}},Ua={class:"setting-item"},Ma={class:"setting-info"},Ia={class:"title"},Ra={class:"desc"},Ba={class:"setting-control"},La={class:"setting-item"},Ea={class:"setting-control"},Aa={key:0,class:"core-tools-panel"},Pa={key:0,class:"upload-progress"},Ta={class:"setting-item"},Da={class:"setting-control flex-row"},Oa={class:"memory-input-group"},za={class:"memory-input-group"},Fa={class:"setting-item"},Na={class:"setting-control flex-row"},Ga={class:"setting-info-desc-only"},Ja={style:{"font-size":"12px",color:"var(--td-text-color-placeholder)",cursor:"help"}},ja={class:"setting-item"},Xa={class:"setting-control"},Wa={key:0,style:{"margin-top":"8px"}},qa={key:2,class:"setting-group-title"},Ka={key:3,class:"setting-item"},Ha={class:"setting-control"},Ya={key:0,style:{"margin-top":"8px"}},Za={class:"setting-item"},Qa={class:"setting-control"},el={key:4,class:"setting-item"},tl={class:"setting-control"},al={class:"setting-item"},ll={class:"setting-control"},sl={class:"setting-item"},nl={class:"setting-control"},ol={class:"setting-item"},il={class:"setting-control"},rl={key:5,class:"setting-item"},ul={class:"setting-control"},dl={class:"setting-item"},cl={class:"setting-control flex-row"},vl={class:"setting-item"},ml={class:"setting-control flex-row"},pl={class:"form-actions"},fl={class:"progress-body"},gl={id:"update-log-box",class:"log-box"},yl={class:"time"},bl={key:0,class:"dialog-actions"},_l=oe({__name:"GeneralSettings",setup(n){const b=he(),$=He(),w=ae(()=>{const M=b.params.serverId;return M?parseInt(M):NaN}),u=h(null),x=h(!1),_=h(!1),L=h(!1),v=[{label:"UTF-8",value:"utf-8"},{label:"GBK",value:"gbk"}],i=h({id:w.value,name:"",base:"",java:"",core:"",minM:1024,maxM:4096,args:"",yggdrasilApiAddr:"",backupMaxCount:20,backupDelay:10,backupPath:"MSLX://Backup/Instance",autoRestart:!1,forceAutoRestart:!0,ignoreEula:!1,runOnStartup:!1,inputEncoding:"utf-8",outputEncoding:"utf-8",fileEncoding:"utf-8",coreUrl:"",coreSha256:"",coreFileKey:""}),k=h("MB"),z=h("MB"),W=[{label:"MB",value:"MB"},{label:"GB",value:"GB"}],P=ae({get:()=>{if(k.value==="GB"){const M=i.value.minM/1024;return Math.round(M*100)/100}return i.value.minM},set:M=>{i.value.minM=k.value==="GB"?Math.round(M*1024):M}}),r=ae({get:()=>{if(z.value==="GB"){const M=i.value.maxM/1024;return Math.round(M*100)/100}return i.value.maxM},set:M=>{i.value.maxM=z.value==="GB"?Math.round(M*1024):M}}),g=h("custom"),c=h([]),m=h([]),D=h(""),d=h(""),l=async(M=!1)=>{try{M&&G.info("正在扫描 Java 环境...");const a=await Bt($.userInfo.systemInfo.osType.toLowerCase().replace("os",""),$.userInfo.systemInfo.osArchitecture.toLowerCase());a&&Array.isArray(a)&&(c.value=a.map(K=>({label:`Java ${K} (在线)`,value:K})));const H=await Lt(M);m.value=H.map(K=>({label:`Java ${K.version} (${K.path})`,value:K.path})),M&&G.success("刷新成功")}catch(a){console.error(a)}};Z([g,D,d],([M,a,H])=>{M==="none"?i.value.java="none":M==="env"?i.value.java="java":M==="custom"||M==="local"?i.value.java=H:M==="online"&&(i.value.java=a?`MSLX://Java/${a}`:"")});const y=h("MSLX://Backup/Instance"),B=h("");Z([y,B],([M,a])=>{M==="custom"?i.value.backupPath=a:i.value.backupPath=M});const o=h(""),C=h(""),T=[{label:"官方/离线模式 (无)",value:"none"},{label:"MSL 统一身份验证 (MSL Skin)",value:"https://skin.mslmc.net/api/yggdrasil"},{label:"LittleSkin",value:"https://littleskin.cn/api/yggdrasil"},{label:"自定义服务器",value:"custom"}];Z([o,C],([M,a])=>{M==="none"?i.value.yggdrasilApiAddr="":M==="custom"?i.value.yggdrasilApiAddr=a:i.value.yggdrasilApiAddr=M});const X=h(!1),q=h(!1),I=h(null),F=h(!1),Y=h(0),N=h(""),Q=M=>{i.value.core=M.filename,i.value.coreUrl=M.url,i.value.coreSha256=M.sha256,i.value.coreFileKey="",X.value=!1,G.success(`已选择核心: ${M.filename}，保存后将自动下载`)},V=()=>{var M;return(M=I.value)==null?void 0:M.click()},te=async M=>{var K;const a=M.target;if(!((K=a.files)!=null&&K.length))return;const H=a.files[0];if(i.value.coreFileKey)try{await ht(i.value.coreFileKey)}catch{console.error("删除上传失败")}N.value=H.name,F.value=!0,Y.value=0;try{const ee=(await $t()).uploadId,se=5*1024*1024,ye=Math.ceil(H.size/se);for(let re=0;re<ye;re++){const Ie=H.slice(re*se,Math.min(H.size,(re+1)*se));await xt(ee,re,Ie),Y.value=Math.floor((re+1)/ye*100)}const be=await Ct(ee,ye);i.value.coreFileKey=be.uploadId,i.value.core=H.name,i.value.coreUrl="",G.success("文件上传就绪，保存后生效"),X.value=!1}catch(le){G.error(`上传失败: ${le.message}`)}finally{F.value=!1,a.value=""}},ot=()=>{L.value||Et.warning({title:"风险操作",content:"修改实例路径会导致面板无法找到原有文件。请确保您已手动移动了文件，或您明确知道自己在做什么。",duration:5e3}),L.value=!L.value},pe=h(!1),fe=h(0),Ce=h([]),ce=h(null),it=ae(()=>g.value==="none"?{name:[{required:!0,message:"服务器名称不能为空",trigger:"blur"}],base:[{required:!0,message:"基础路径不能为空",trigger:"blur"}],args:[{required:!0,message:"自定义模式必须填写启动命令",trigger:"blur"}]}:{name:[{required:!0,message:"服务器名称不能为空",trigger:"blur"}],base:[{required:!0,message:"基础路径不能为空",trigger:"blur"}],java:[{required:!0,message:"Java 环境不能为空",trigger:"change"}],core:[{required:!0,message:"核心文件名不能为空",trigger:"change"}],minM:[{required:!0,message:"必填",trigger:"blur"}],maxM:[{required:!0,message:"必填",trigger:"blur"}]}),ge=async()=>{if(w.value){x.value=!0;try{await l(),i.value.id=w.value;const M=await Ut(w.value);if(i.value={...i.value,...M,coreUrl:"",coreFileKey:"",coreSha256:""},k.value=M.minM>0&&M.minM%1024===0?"GB":"MB",z.value=M.maxM>0&&M.maxM%1024===0?"GB":"MB",L.value=!1,M.java==="none")g.value="none";else if(M.java==="java")g.value="env";else if(M.java.startsWith("MSLX://Java/"))g.value="online",D.value=M.java.replace("MSLX://Java/","");else{const K=m.value.find(le=>le.value===M.java);g.value=K?"local":"custom",d.value=M.java}const a=M.backupPath;a==="MSLX://Backup/Instance"||a==="MSLX://Backup/Data"?y.value=a:(y.value="custom",B.value=a);const H=M.yggdrasilApiAddr;H?H==="https://skin.mslmc.net/api/yggdrasil"?o.value="https://skin.mslmc.net/api/yggdrasil":H==="https://littleskin.cn/api/yggdrasil"?o.value="https://littleskin.cn/api/yggdrasil":(o.value="custom",C.value=H):o.value="none"}catch(M){G.error("获取配置失败: "+M.message)}finally{x.value=!1}}};Z(()=>b.params.serverId,M=>{b.name==="InstanceConsole"&&M&&ge()}),me(ge);const rt=async()=>{var a,H;if(await((a=u.value)==null?void 0:a.validate())===!0&&!(g.value!=="none"&&(i.value.coreUrl||i.value.coreFileKey)&&!await new Promise(ee=>{const se=Pe.confirm({header:"确认变更核心文件?",body:"检测到您上传或选择了新的核心文件，这将覆盖服务器现有的部署。",theme:"warning",onConfirm:()=>{se.hide(),ee(!0)},onClose:()=>{se.hide(),ee(!1)}})}))){g.value==="none"&&(i.value.core="none",i.value.minM=1027,i.value.maxM=1102,i.value.java="none",i.value.coreUrl="",i.value.coreFileKey="",i.value.coreSha256=""),_.value=!0;try{const K=await Mt(i.value);((H=K.data)==null?void 0:H.needListen)??K.needListen?ut():(G.success("配置已保存"),_.value=!1,ge())}catch(K){G.error(K.message||"保存失败"),_.value=!1}}},ut=async()=>{pe.value=!0,fe.value=0,Ce.value=[];const{baseUrl:M,token:a}=$,H=new URL("/api/hubs/updateProgressHub",M||window.location.origin);H.searchParams.append("x-user-token",a),ce.value=new Xe().withUrl(H.toString(),{withCredentials:!1}).configureLogging(We.None).build(),ce.value.on("UpdateStatus",(K,le,ee)=>{Ce.value.push({time:new Date().toLocaleTimeString(),msg:ee?`[错误] ${K}`:K}),Se(()=>{const se=document.getElementById("update-log-box");se&&(se.scrollTop=se.scrollHeight)}),le>=0&&(fe.value=Number(le.toFixed(1))),le===100&&(G.success("更新完成"),dt(!0))});try{await ce.value.start(),await ce.value.invoke("JoinGroup",w.value.toString())}catch{Ce.value.push({time:"-",msg:"连接失败"})}},dt=(M=!1)=>{var a;(a=ce.value)==null||a.stop(),setTimeout(()=>{pe.value=!1,_.value=!1,M&&ge()},1e3)};return Me(()=>{var M;(M=ce.value)==null||M.stop()}),(M,a)=>{const H=S("t-input"),K=S("t-button"),le=S("t-tooltip"),ee=S("t-select"),se=S("t-textarea"),ye=S("t-alert"),be=S("t-icon"),re=S("t-col"),Ie=S("t-row"),De=S("t-progress"),ct=S("t-space"),_e=S("t-input-number"),ke=S("t-switch"),vt=S("t-form"),mt=S("t-loading"),pt=S("t-dialog");return f(),E("div",ba,[t(mt,{loading:x.value,"show-overlay":""},{default:s(()=>[t(vt,{ref_key:"formRef",ref:u,data:i.value,rules:it.value,"label-width":"0",onSubmit:rt},{default:s(()=>[a[57]||(a[57]=e("div",{class:"setting-group-title"},"基础设置",-1)),e("div",_a,[a[32]||(a[32]=e("div",{class:"setting-info"},[e("div",{class:"title"},"服务器名称"),e("div",{class:"desc"},"在面板列表中显示的别名，支持中文")],-1)),e("div",ka,[t(H,{modelValue:i.value.name,"onUpdate:modelValue":a[0]||(a[0]=R=>i.value.name=R),placeholder:"请输入名称"},null,8,["modelValue"])])]),e("div",wa,[e("div",ha,[a[33]||(a[33]=e("div",{class:"title"},"实例路径",-1)),e("div",$a,[e("span",{class:$e({"text-warning":L.value})},A(L.value?"警告：修改路径可能导致无法找到原文件":"服务器文件的物理存储路径，非必要请勿修改"),3)])]),e("div",xa,[t(H,{modelValue:i.value.base,"onUpdate:modelValue":a[1]||(a[1]=R=>i.value.base=R),disabled:!L.value},{suffix:s(()=>[t(le,{content:L.value?"点击锁定":"点击解锁编辑 (慎重)"},{default:s(()=>[t(K,{variant:"text",shape:"square",onClick:ot},{icon:s(()=>[L.value?(f(),J(U(At),{key:0,style:{color:"var(--td-warning-color)"}})):(f(),J(U(Pt),{key:1}))]),_:1})]),_:1},8,["content"])]),_:1},8,["modelValue","disabled"])])]),a[58]||(a[58]=e("div",{class:"setting-group-title"},"运行模式",-1)),e("div",Ca,[a[34]||(a[34]=e("div",{class:"setting-info"},[e("div",{class:"title"},"启动方式"),e("div",{class:"desc"},"选择使用 Java 启动 Minecraft，或使用自定义命令启动其他程序 (如 Bedrock, Python 等)")],-1)),e("div",Va,[t(ee,{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=R=>g.value=R),options:[{label:"MSLX 在线下载 (Java)",value:"online"},{label:"使用本地版本 (Java)",value:"local"},{label:"自定义路径 (Java)",value:"custom"},{label:"环境变量 (Java)",value:"env"},{label:"自定义命令 (无Java)",value:"none"}]},null,8,["modelValue"]),g.value!=="none"?(f(),E("div",Sa,[g.value==="online"?(f(),J(ee,{key:0,modelValue:D.value,"onUpdate:modelValue":a[3]||(a[3]=R=>D.value=R),options:c.value,placeholder:"请选择版本",filterable:""},null,8,["modelValue","options"])):O("",!0),g.value==="local"?(f(),J(ee,{key:1,modelValue:d.value,"onUpdate:modelValue":a[4]||(a[4]=R=>d.value=R),options:m.value,placeholder:"选择已识别的 Java"},null,8,["modelValue","options"])):O("",!0),g.value==="custom"?(f(),J(H,{key:2,modelValue:d.value,"onUpdate:modelValue":a[5]||(a[5]=R=>d.value=R),placeholder:"输入 java 可执行文件完整路径"},null,8,["modelValue"])):O("",!0)])):O("",!0)])]),e("div",Ua,[e("div",Ma,[e("div",Ia,A(g.value==="none"?"启动命令 (Command)":"启动参数 (JVM Args)"),1),e("div",Ra,A(g.value==="none"?"完全自定义的启动命令。程序将直接执行此段内容，不依赖 Java 环境。":"传递给 Java 的启动参数，如 GC 策略 (例如 -XX:+UseG1GC)"),1)]),e("div",Ba,[t(se,{modelValue:i.value.args,"onUpdate:modelValue":a[6]||(a[6]=R=>i.value.args=R),autosize:{minRows:2,maxRows:4},placeholder:g.value==="none"?"例如: ./bedrock_server_x64":"无特殊需求请留空"},null,8,["modelValue","placeholder"])])]),g.value!=="none"?(f(),E(ne,{key:0},[a[38]||(a[38]=e("div",{class:"setting-group-title"},"核心管理",-1)),e("div",La,[a[37]||(a[37]=e("div",{class:"setting-info"},[e("div",{class:"title"},"服务端核心文件"),e("div",{class:"desc"},[p(" 指定启动的 Jar 文件名。如果文件已存在于目录中，直接输入文件名即可。 "),e("br"),p("需要更新核心？点击下方“文件工具” ")])],-1)),e("div",Ea,[t(H,{modelValue:i.value.core,"onUpdate:modelValue":a[8]||(a[8]=R=>i.value.core=R),placeholder:"例如 server.jar"},{suffix:s(()=>[t(K,{variant:"text",theme:"primary",size:"small",onClick:a[7]||(a[7]=R=>X.value=!X.value)},{default:s(()=>[p(A(X.value?"收起工具":"文件工具"),1)]),_:1})]),_:1},8,["modelValue"]),X.value?(f(),E("div",Aa,[t(ct,{direction:"vertical",style:{width:"100%"}},{default:s(()=>[t(ye,{theme:"info",message:"在此处操作会自动下载/上传文件，并填入上方的文件名。"}),t(Ie,{gutter:12},{default:s(()=>[t(re,{span:6},{default:s(()=>[t(K,{block:"",variant:"outline",onClick:a[9]||(a[9]=R=>q.value=!0)},{icon:s(()=>[t(be,{name:"cloud-download"})]),default:s(()=>[a[35]||(a[35]=p(" 从版本库下载 ",-1))]),_:1})]),_:1}),t(re,{span:6},{default:s(()=>[t(K,{block:"",variant:"outline",loading:F.value,onClick:V},{icon:s(()=>[t(be,{name:"upload"})]),default:s(()=>[a[36]||(a[36]=p(" 上传本地文件 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1}),e("input",{ref_key:"uploadInputRef",ref:I,type:"file",accept:".jar",hidden:"",onChange:te},null,544),F.value?(f(),E("div",Pa,[e("span",null,"正在上传: "+A(N.value),1),t(De,{theme:"line",percentage:Y.value},null,8,["percentage"])])):O("",!0)]),_:1})])):O("",!0)])])],64)):O("",!0),g.value!=="none"?(f(),E(ne,{key:1},[a[41]||(a[41]=e("div",{class:"setting-group-title"},"资源限制",-1)),e("div",Ta,[a[40]||(a[40]=e("div",{class:"setting-info"},[e("div",{class:"title"},"内存分配"),e("div",{class:"desc"},"设置 Java 堆内存大小 (Xms / Xmx)")],-1)),e("div",Da,[e("div",Oa,[t(_e,{modelValue:P.value,"onUpdate:modelValue":a[10]||(a[10]=R=>P.value=R),min:0,"decimal-places":k.value==="GB"?1:0,placeholder:"Xms",theme:"normal",class:"input-left"},null,8,["modelValue","decimal-places"]),t(ee,{modelValue:k.value,"onUpdate:modelValue":a[11]||(a[11]=R=>k.value=R),options:W,clearable:!1,class:"select-right"},null,8,["modelValue"])]),a[39]||(a[39]=e("span",{class:"separator"},"-",-1)),e("div",za,[t(_e,{modelValue:r.value,"onUpdate:modelValue":a[12]||(a[12]=R=>r.value=R),min:0,"decimal-places":z.value==="GB"?1:0,placeholder:"Xmx",theme:"normal",class:"input-left"},null,8,["modelValue","decimal-places"]),t(ee,{modelValue:z.value,"onUpdate:modelValue":a[13]||(a[13]=R=>z.value=R),options:W,clearable:!1,class:"select-right"},null,8,["modelValue"])])])])],64)):O("",!0),a[59]||(a[59]=e("div",{class:"setting-group-title"},"备份设置",-1)),e("div",Fa,[a[44]||(a[44]=e("div",{class:"setting-info"},[e("div",{class:"title"},"备份策略"),e("div",{class:"desc"},"设置自动备份保留的最大数量，以及触发备份的延迟时间")],-1)),e("div",Na,[t(_e,{modelValue:i.value.backupMaxCount,"onUpdate:modelValue":a[14]||(a[14]=R=>i.value.backupMaxCount=R),min:1,max:100,placeholder:"保留份数",theme:"column",style:{width:"140px"},suffix:"份"},null,8,["modelValue"]),a[42]||(a[42]=e("span",{class:"separator"},"/",-1)),t(_e,{modelValue:i.value.backupDelay,"onUpdate:modelValue":a[15]||(a[15]=R=>i.value.backupDelay=R),min:0,placeholder:"延迟时间",theme:"column",style:{width:"140px"},suffix:"秒"},null,8,["modelValue"])]),e("div",Ga,[t(le,{content:"MSLX 向服务器发送 save-all 指令后，会等待指定的秒数，确保数据完全写入硬盘后再开始打包备份。"},{default:s(()=>[e("span",Ja,[t(be,{name:"help-circle"}),a[43]||(a[43]=p(" 什么是延迟时间？ ",-1))])]),_:1})])]),e("div",ja,[a[45]||(a[45]=e("div",{class:"setting-info"},[e("div",{class:"title"},"备份存放路径"),e("div",{class:"desc"},"选择备份文件存储的位置。推荐存储在实例文件夹外部以免误删。")],-1)),e("div",Xa,[t(ee,{modelValue:y.value,"onUpdate:modelValue":a[16]||(a[16]=R=>y.value=R),options:[{label:"实例文件夹内 (Instance)",value:"MSLX://Backup/Instance"},{label:"全局数据目录 (Data)",value:"MSLX://Backup/Data"},{label:"自定义绝对路径",value:"custom"}]},null,8,["modelValue"]),y.value==="custom"?(f(),E("div",Wa,[t(H,{modelValue:B.value,"onUpdate:modelValue":a[17]||(a[17]=R=>B.value=R),placeholder:"输入备份存放的绝对路径"},null,8,["modelValue"])])):O("",!0)])]),g.value!=="none"?(f(),E("div",qa,"外置登录")):O("",!0),g.value!=="none"?(f(),E("div",Ka,[a[46]||(a[46]=e("div",{class:"setting-info"},[e("div",{class:"title"},"Yggdrasil API"),e("div",{class:"desc"},"选择认证服务器。留空则表示使用官方正版登录 (或离线模式)。")],-1)),e("div",Ha,[t(ee,{modelValue:o.value,"onUpdate:modelValue":a[18]||(a[18]=R=>o.value=R),options:T},null,8,["modelValue"]),o.value==="custom"?(f(),E("div",Ya,[t(H,{modelValue:C.value,"onUpdate:modelValue":a[19]||(a[19]=R=>C.value=R),placeholder:"输入 Authlib-Injector API 地址"},null,8,["modelValue"])])):O("",!0)])])):O("",!0),a[60]||(a[60]=e("div",{class:"setting-group-title"},"高级设置",-1)),e("div",Za,[a[47]||(a[47]=e("div",{class:"setting-info"},[e("div",{class:"title"},"自动重启"),e("div",{class:"desc"},"当服务器崩溃或意外停止时尝试自动重启"),e("div",{class:"desc"},"熔断机制: 若5分钟内尝试重启次数达到 5 次，则停止尝试重启")],-1)),e("div",Qa,[t(ke,{modelValue:i.value.autoRestart,"onUpdate:modelValue":a[20]||(a[20]=R=>i.value.autoRestart=R),label:["已开启","已关闭"]},null,8,["modelValue"])])]),i.value.autoRestart?(f(),E("div",el,[a[48]||(a[48]=e("div",{class:"setting-info"},[e("div",{class:"title"},"强制自动重启"),e("div",{class:"desc"},"开启此功能后，就算服务器是正常退出的也会强制重启(正常退出 => 退出代码 0)"),e("div",{class:"desc"},"不影响手动在面板关闭服务器")],-1)),e("div",tl,[t(ke,{modelValue:i.value.forceAutoRestart,"onUpdate:modelValue":a[21]||(a[21]=R=>i.value.forceAutoRestart=R),label:["已开启","已关闭"]},null,8,["modelValue"])])])):O("",!0),e("div",al,[a[49]||(a[49]=e("div",{class:"setting-info"},[e("div",{class:"title"},"关服强制结束时间"),e("div",{class:"desc"},"设置在发出Stop指令或关服请求后，等待多久后强制结束进程"),e("div",{class:"desc"},"可设置10 - 120 s")],-1)),e("div",ll,[t(_e,{modelValue:i.value.forceExitDelay,"onUpdate:modelValue":a[22]||(a[22]=R=>i.value.forceExitDelay=R)},null,8,["modelValue"])])]),e("div",sl,[a[50]||(a[50]=e("div",{class:"setting-info"},[e("div",{class:"title"},"忽略EULA提示"),e("div",{class:"desc"},"若您的实例并非MC服务器，可打开此选项")],-1)),e("div",nl,[t(ke,{modelValue:i.value.ignoreEula,"onUpdate:modelValue":a[23]||(a[23]=R=>i.value.ignoreEula=R),label:["已开启","已关闭"]},null,8,["modelValue"])])]),e("div",ol,[a[51]||(a[51]=e("div",{class:"setting-info"},[e("div",{class:"title"},"随守护进程启动"),e("div",{class:"desc"},"当物理机开机/面板启动时，自动启动此实例")],-1)),e("div",il,[t(ke,{modelValue:i.value.runOnStartup,"onUpdate:modelValue":a[24]||(a[24]=R=>i.value.runOnStartup=R),label:["已开启","已关闭"]},null,8,["modelValue"])])]),g.value!=="none"?(f(),E("div",rl,[a[52]||(a[52]=e("div",{class:"setting-info"},[e("div",{class:"title"},"强制Java使用UTF8"),e("div",{class:"desc"},"此功能可以解决部分游戏内中文乱码的问题（特别是Windows系统上）"),e("div",{class:"desc"},[p("开启此功能后请务必将下面的"),e("b",null,"文件编码"),p("设置设置为"),e("b",null,"UTF-8")])],-1)),e("div",ul,[t(ke,{modelValue:i.value.forceJvmUTF8,"onUpdate:modelValue":a[25]||(a[25]=R=>i.value.forceJvmUTF8=R),label:["已开启","已关闭"]},null,8,["modelValue"])])])):O("",!0),e("div",dl,[a[53]||(a[53]=e("div",{class:"setting-info"},[e("div",{class:"title"},"控制台编码"),e("div",{class:"desc"},"设置输入输出流的字符集，乱码时请尝试切换")],-1)),e("div",cl,[t(ee,{modelValue:i.value.inputEncoding,"onUpdate:modelValue":a[26]||(a[26]=R=>i.value.inputEncoding=R),options:v,label:"输入",style:{width:"140px"}},null,8,["modelValue"]),t(ee,{modelValue:i.value.outputEncoding,"onUpdate:modelValue":a[27]||(a[27]=R=>i.value.outputEncoding=R),options:v,label:"输出",style:{width:"140px"}},null,8,["modelValue"])])]),e("div",vl,[a[54]||(a[54]=e("div",{class:"setting-info"},[e("div",{class:"title"},"文件编码"),e("div",{class:"desc"},"设置文件编辑和保存时的编码格式，乱码时请尝试切换。(一般Windows是GBK，其他是UTF-8。)")],-1)),e("div",ml,[t(ee,{modelValue:i.value.fileEncoding,"onUpdate:modelValue":a[28]||(a[28]=R=>i.value.fileEncoding=R),options:v,style:{width:"140px"}},null,8,["modelValue"])])]),e("div",pl,[t(K,{theme:"primary",type:"submit",size:"large",loading:_.value},{default:s(()=>[...a[55]||(a[55]=[p("保存设置",-1)])]),_:1},8,["loading"]),t(K,{theme:"default",variant:"base",size:"large",onClick:ge},{default:s(()=>[...a[56]||(a[56]=[p("重置更改",-1)])]),_:1})])]),_:1},8,["data","rules"])]),_:1},8,["loading"]),t(Rt,{visible:q.value,"onUpdate:visible":a[29]||(a[29]=R=>q.value=R),onConfirm:Q},null,8,["visible"]),t(pt,{visible:pe.value,"onUpdate:visible":a[31]||(a[31]=R=>pe.value=R),header:"正在应用更新",footer:!1,"close-on-overlay-click":!1,"close-btn":!1,width:"600px"},{default:s(()=>[e("div",fl,[t(De,{theme:"plump",percentage:fe.value,label:`${fe.value}%`},null,8,["percentage","label"]),e("div",gl,[(f(!0),E(ne,null,ue(Ce.value,(R,ft)=>(f(),E("div",{key:ft,class:"log-line"},[e("span",yl,A(R.time),1),p(" "+A(R.msg),1)]))),128))]),fe.value===100?(f(),E("div",bl,[t(K,{theme:"primary",onClick:a[30]||(a[30]=R=>pe.value=!1)},{default:s(()=>[...a[61]||(a[61]=[p("关闭并刷新",-1)])]),_:1})])):O("",!0)])]),_:1},8,["visible"])])}}}),kl=ie(_l,[["__scopeId","data-v-700c134f"]]),wl={class:"pm-container"},hl={class:"header-section"},$l={class:"mode-switcher"},xl={key:0,class:"error-alert-bar"},Cl={class:"toolbar"},Vl={class:"left-actions"},Sl={key:0,class:"bulk-actions"},Ul={class:"selected-count"},Ml={class:"right-search"},Il={class:"table-wrapper"},Rl={style:{display:"flex","align-items":"center",gap:"8px"}},Bl={class:"empty-state"},Ll={class:"tips-footer"},El=oe({__name:"ModsPluginsManager",setup(n){const b=he(),$=parseInt(b.params.serverId),w=h("mods"),u=h(!1),x=h([]),_=h(""),L=h([]),v=h(""),i=ae(()=>{if(!_.value)return x.value;const d=_.value.toLowerCase();return x.value.filter(l=>l.name.toLowerCase().includes(d))}),k=ae(()=>[{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{title:"文件名",colKey:"name",sorter:(d,l)=>d.name.localeCompare(l.name),ellipsis:!0},{title:"状态",colKey:"status",width:100},{title:"操作",colKey:"op",width:180,fixed:"right",align:"right"}]),z=async(d=!1)=>{u.value=!0,L.value=[],v.value="";try{const l=await Be($,w.value,d),y=(l.clientJarFiles||[]).map(C=>({name:C,status:"enabled",isClient:!0})),B=(l.jarFiles||[]).map(C=>({name:C,status:"enabled"})),o=(l.disableJarFiles||[]).map(C=>({name:C,status:"disabled"}));x.value=[...y,...B,...o],d&&y.length>0?(L.value=y.map(C=>C.name),G.success(`检测到 ${y.length} 个客户端模组`)):d&&G.info("未检测到仅客户端模组")}catch(l){const y=l.message||"获取列表失败";v.value=y,x.value=[]}finally{u.value=!1}},W=async(d,l)=>{if(l.length===0)return;const y={enable:"启用",disable:"禁用",delete:"删除"},B=async()=>{try{u.value=!0;const o=await Vt($,w.value,d,l),{successCount:C,failCount:T}=o||{};T>0?G.warning(`操作完成：成功 ${C} 个，失败 ${T} 个`):G.success(`成功${y[d]} ${C} 个文件`),await z()}catch(o){G.error(o.message||"操作失败"),u.value=!1}};if(d==="delete"){const o=Pe.confirm({header:`确认删除 ${l.length} 个文件?`,body:"此操作不可逆，文件将被永久删除。",theme:"danger",onConfirm:()=>{o.hide(),B()}})}else await B()},P=d=>{w.value=d,z()},r=d=>{const l=d.status==="enabled"?"disable":"enable";W(l,[d.name])},g=d=>{const l=L.value;W(d,l)},c=h(!1),m=()=>{c.value=!0},D=()=>{c.value=!1,z()};return me(()=>{z()}),Z(()=>b.params.serverId,d=>{d&&location.reload()}),(d,l)=>{const y=S("t-radio-button"),B=S("t-radio-group"),o=S("t-alert"),C=S("t-button"),T=S("t-input"),X=S("t-tag"),q=S("t-switch"),I=S("t-popconfirm"),F=S("t-space"),Y=S("t-table");return f(),E("div",wl,[e("div",hl,[l[13]||(l[13]=e("div",{class:"setting-group-title"}," 资源管理 ",-1)),e("div",$l,[t(B,{modelValue:w.value,"onUpdate:modelValue":l[0]||(l[0]=N=>w.value=N),variant:"default-filled",onChange:P},{default:s(()=>[t(y,{value:"mods"},{icon:s(()=>[t(U(Le))]),default:s(()=>[l[11]||(l[11]=p(" 模组 (Mods) ",-1))]),_:1}),t(y,{value:"plugins"},{icon:s(()=>[t(U(Ue))]),default:s(()=>[l[12]||(l[12]=p(" 插件 (Plugins) ",-1))]),_:1})]),_:1},8,["modelValue"])])]),v.value?(f(),E("div",xl,[t(o,{theme:"error",message:v.value,closeable:"",onClose:l[2]||(l[2]=N=>v.value="")},{operation:s(()=>[e("span",{style:{cursor:"pointer","margin-left":"8px"},onClick:l[1]||(l[1]=N=>z(!1))},"重试")]),_:1},8,["message"])])):O("",!0),e("div",Cl,[e("div",Vl,[t(C,{theme:"primary",disabled:v.value!=="",onClick:m},{icon:s(()=>[t(U(Tt))]),default:s(()=>[l[14]||(l[14]=p(" 上传文件 ",-1))]),_:1},8,["disabled"]),w.value==="mods"?(f(),J(C,{key:0,disabled:v.value!=="",variant:"outline",loading:u.value,onClick:l[3]||(l[3]=N=>z(!0))},{icon:s(()=>[t(U(Fe))]),default:s(()=>[l[15]||(l[15]=p(" 检测客户端模组 ",-1))]),_:1},8,["disabled","loading"])):O("",!0),t(C,{variant:"outline",loading:u.value,onClick:l[4]||(l[4]=N=>z(!1))},{icon:s(()=>[t(U(we))]),_:1},8,["loading"]),t(qe,{name:"fade"},{default:s(()=>[L.value.length>0?(f(),E("div",Sl,[l[19]||(l[19]=e("div",{class:"divider"},null,-1)),e("span",Ul,"已选 "+A(L.value.length)+" 项",1),t(C,{size:"small",variant:"text",theme:"success",onClick:l[5]||(l[5]=N=>g("enable"))},{default:s(()=>[...l[16]||(l[16]=[p("启用",-1)])]),_:1}),t(C,{size:"small",variant:"text",theme:"warning",onClick:l[6]||(l[6]=N=>g("disable"))},{default:s(()=>[...l[17]||(l[17]=[p("禁用",-1)])]),_:1}),t(C,{size:"small",variant:"text",theme:"danger",onClick:l[7]||(l[7]=N=>g("delete"))},{default:s(()=>[...l[18]||(l[18]=[p("删除",-1)])]),_:1})])):O("",!0)]),_:1})]),e("div",Ml,[t(T,{modelValue:_.value,"onUpdate:modelValue":l[8]||(l[8]=N=>_.value=N),placeholder:"搜索文件名...",clearable:""},{"prefix-icon":s(()=>[t(U(Fe))]),_:1},8,["modelValue"])])]),e("div",Il,[t(Y,{"selected-row-keys":L.value,"onUpdate:selectedRowKeys":l[9]||(l[9]=N=>L.value=N),pagination:{defaultPageSize:20,total:i.value.length,showJumper:!0,defaultCurrent:1},data:i.value,columns:k.value,"row-key":"name",loading:u.value,hover:"",stripe:"",class:"custom-table"},{name:s(({row:N})=>[e("div",Rl,[e("span",null,A(N.name),1),N.isClient?(f(),J(X,{key:0,theme:"warning",variant:"light",size:"small"},{default:s(()=>[...l[20]||(l[20]=[p(" 客户端 ",-1)])]),_:1})):O("",!0)])]),status:s(({row:N})=>[N.status==="enabled"?(f(),J(X,{key:0,theme:"success",variant:"light"},{icon:s(()=>[t(U(et))]),default:s(()=>[l[21]||(l[21]=p(" 已启用 ",-1))]),_:1})):(f(),J(X,{key:1,theme:"default",variant:"light",style:{color:"var(--td-text-color-placeholder)"}},{icon:s(()=>[t(U(tt))]),default:s(()=>[l[22]||(l[22]=p(" 已禁用 ",-1))]),_:1}))]),op:s(({row:N})=>[t(F,{size:"small"},{default:s(()=>[t(q,{"model-value":N.status==="enabled",loading:u.value,size:"medium",onChange:Q=>r(N)},{label:s(Q=>[p(A(Q.value?"开":"关"),1)]),_:1},8,["model-value","loading","onChange"]),t(I,{content:"确定要删除此文件吗？",theme:"danger",onConfirm:Q=>W("delete",[N.name])},{default:s(()=>[t(C,{variant:"text",theme:"danger",shape:"square"},{default:s(()=>[t(U(Qe))]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)]),empty:s(()=>[e("div",Bl,[w.value==="mods"?(f(),J(U(Le),{key:0,size:"48px",style:{color:"var(--td-gray-color-4)"}})):(f(),J(U(Ue),{key:1,size:"48px",style:{color:"var(--td-gray-color-4)"}})),e("p",null,A(`暂无${w.value==="mods"?"模组":"插件"}文件`),1)])]),_:1},8,["selected-row-keys","pagination","data","columns","loading"])]),e("div",Ll,[e("p",null,"提示："+A(w.value==="mods"?"模组":"插件")+"文件存放于服务器根目录的 /"+A(w.value)+" 文件夹下。",1),l[23]||(l[23]=e("p",null,"禁用文件后，会在文件名后添加 .disabled 后缀，服务器将忽略该文件。",-1))]),t(oa,{visible:c.value,"onUpdate:visible":l[10]||(l[10]=N=>c.value=N),"instance-id":U($),"current-path":w.value,"allow-folder":!1,onSuccess:D},null,8,["visible","instance-id","current-path"])])}}}),Al=ie(El,[["__scopeId","data-v-c8641ed4"]]),je=[{key:"motd",label:"服务器标语",desc:"显示在多人游戏列表中的服务器介绍信息，支持颜色代码，不支持中文。",type:"string"},{key:"server-port",label:"服务器端口",desc:"默认为 25565。如果要在一台机器运行多个服务器，必须修改此端口。",type:"number"},{key:"max-players",label:"最大玩家数",desc:"服务器同时允许在线的最大玩家数量。",type:"number"},{key:"online-mode",label:"正版验证",desc:"开启后将验证玩家的正版账号。如果使用离线/皮肤站，请关闭此项。",type:"boolean"},{key:"white-list",label:"启用白名单",desc:"开启后只有在白名单内的玩家才能进入服务器。",type:"boolean"},{key:"enforce-whitelist",label:"强制白名单",desc:"开启后，当玩家不在白名单时，即使已在线也会被踢出（通常用于维护时重新加载白名单）。",type:"boolean"},{key:"level-name",label:"存档文件夹名称",desc:"服务器读取的世界存档文件夹名称（默认为 world）。",type:"string"},{key:"gamemode",label:"默认游戏模式",desc:"新玩家进入服务器时的默认模式。",type:"select",options:[{label:"生存 (Survival)",value:"survival"},{label:"创造 (Creative)",value:"creative"},{label:"冒险 (Adventure)",value:"adventure"},{label:"旁观 (Spectator)",value:"spectator"}]},{key:"force-gamemode",label:"强制游戏模式",desc:"开启后，玩家每次加入服务器都会被重置为默认游戏模式。",type:"boolean"},{key:"difficulty",label:"难度",desc:"世界的游戏难度设置。",type:"select",options:[{label:"和平 (Peaceful)",value:"peaceful"},{label:"简单 (Easy)",value:"easy"},{label:"普通 (Normal)",value:"normal"},{label:"困难 (Hard)",value:"hard"}]},{key:"hardcore",label:"极限模式",desc:"开启后，玩家死亡将被封禁。",type:"boolean"},{key:"allow-flight",label:"允许飞行",desc:"允许生存模式下的玩家飞行（防止被服务端反作弊踢出）。",type:"boolean"},{key:"spawn-protection",label:"出生点保护半径",desc:"出生点周围多少格内禁止非 OP 破坏。设为 0 可禁用。",type:"number"},{key:"player-idle-timeout",label:"挂机踢出时间",desc:"玩家闲置多少分钟后被自动踢出。0 为不限制。",type:"number"},{key:"level-seed",label:"世界种子",desc:"生成世界使用的种子，留空则随机生成。",type:"string"},{key:"level-type",label:"世界类型",desc:"例如 minecraft:normal, minecraft:flat, minecraft:amplified。",type:"string"},{key:"generate-structures",label:"生成结构",desc:"是否生成村庄、地牢等结构。",type:"boolean"},{key:"generator-settings",label:"生成器设置",desc:"用于自定义超平坦或特定生成器的 JSON 参数。",type:"string"},{key:"max-world-size",label:"世界边界半径",desc:"设置世界边界（World Border）的最大半径。",type:"number"},{key:"simulation-distance",label:"模拟距离",desc:"服务器实际运算实体/作物生长的区块半径（3-32）。",type:"number"},{key:"view-distance",label:"视距",desc:"客户端可以看见的区块半径。数值过大显著增加内存和带宽消耗。",type:"number"},{key:"entity-broadcast-range-percentage",label:"实体广播范围百分比",desc:"控制客户端能看到实体的距离系数（100表示默认）。",type:"number"},{key:"max-tick-time",label:"最大刻耗时 (Watchdog)",desc:"一刻的最长处理毫秒数。超过此数值服务器将强制关闭以防卡死。设为 -1 可禁用。",type:"number"},{key:"network-compression-threshold",label:"网络压缩阈值",desc:"数据包超过此字节数时进行压缩。设为 -1 禁用压缩。推荐保持默认 256。",type:"number"},{key:"rate-limit",label:"数据包限制",desc:"如果玩家发送数据包过快，将被踢出。0 为禁用。",type:"number"},{key:"use-native-transport",label:"使用原生传输优化",desc:"Linux 环境下是否启用 Epoll 优化网络性能。",type:"boolean"},{key:"prevent-proxy-connections",label:"防止代理连接",desc:"是否尝试阻止通过 VPN 或代理的连接（ISP/AS 号判断）。",type:"boolean"},{key:"sync-chunk-writes",label:"同步区块写入",desc:"开启后区块写入完成后才继续逻辑，数据更安全但可能掉帧；关闭可能提升性能。",type:"boolean"},{key:"region-file-compression",label:"区块文件压缩格式",desc:"用于保存区块的压缩算法。",type:"select",options:[{label:"Deflate (默认)",value:"deflate"},{label:"LZ4 (更快)",value:"lz4"},{label:"不压缩 (None)",value:"none"}]},{key:"max-chained-neighbor-updates",label:"最大连锁更新数",desc:"限制红石/方块连锁更新的数量以防止崩服。",type:"number"},{key:"log-ips",label:"控制台记录 IP",desc:"是否在控制台日志中显示玩家连接的 IP 地址。",type:"boolean"},{key:"hide-online-players",label:"隐藏在线玩家列表",desc:"开启后，服务器列表中将不显示具体的玩家名单。",type:"boolean"},{key:"enable-status",label:"启用状态查询",desc:"是否允许外部（如服务器列表网站）查询服务器状态。",type:"boolean"},{key:"accepts-transfers",label:"接受服务器传送",desc:"是否允许玩家从其他服务器无缝传送到此服务器。",type:"boolean"},{key:"pause-when-empty-seconds",label:"空载暂停时间",desc:"服务器内无玩家多少秒后暂停游戏循环（省资源）。-1 为不暂停。",type:"number"},{key:"op-permission-level",label:"OP 权限等级",desc:"设置 OP 的默认权限级别。",type:"select",options:[{label:"1 - 无视出生点保护",value:1},{label:"2 - 使用单机指令 (gamemode等)",value:2},{label:"3 - 多人管理 (kick/ban/op)",value:3},{label:"4 - 系统管理 (stop/save)",value:4}]},{key:"function-permission-level",label:"函数权限等级",desc:"数据包(Datapack)中函数的默认执行权限等级。",type:"number"},{key:"enforce-secure-profile",label:"强制安全配置 (签名)",desc:"强制玩家拥有官方签名的公钥（聊天报告相关）。离线服建议关闭。",type:"boolean"},{key:"enable-code-of-conduct",label:"启用行为准则提示",desc:"是否向玩家展示行为准则链接（遥测相关）。",type:"boolean"},{key:"bug-report-link",label:"Bug 反馈链接",desc:"自定义玩家遇到错误时显示的反馈网址。",type:"string"},{key:"resource-pack",label:"资源包下载地址",desc:"玩家进入服务器时提示下载的资源包直链 URL。",type:"string"},{key:"require-resource-pack",label:"强制资源包",desc:"开启后，拒绝下载资源包的玩家将被踢出。",type:"boolean"},{key:"resource-pack-sha1",label:"资源包 SHA1",desc:"资源包文件的 SHA-1 校验码，用于验证完整性和缓存。",type:"string"},{key:"resource-pack-prompt",label:"资源包提示语",desc:"下载资源包时向玩家显示的自定义消息（Json 格式）。",type:"string"},{key:"initial-enabled-packs",label:"初始启用数据包",desc:"世界生成时默认启用的数据包列表（逗号分隔）。",type:"string"},{key:"initial-disabled-packs",label:"初始禁用数据包",desc:"世界生成时默认禁用的数据包列表。",type:"string"},{key:"enable-rcon",label:"启用 RCON",desc:"开启远程控制台协议，允许外部工具发送指令。",type:"boolean"},{key:"rcon.port",label:"RCON 端口",desc:"RCON 监听端口（默认为 25575）。",type:"number"},{key:"rcon.password",label:"RCON 密码",desc:"连接 RCON 必须的密码。请设置复杂的密码。",type:"string"},{key:"broadcast-rcon-to-ops",label:"向 OP 广播 RCON",desc:"当 RCON 执行指令时，是否通知在线的 OP。",type:"boolean"},{key:"enable-query",label:"启用 Query",desc:"开启 GameSpy4 协议，用于获取服务器详细信息。",type:"boolean"},{key:"query.port",label:"Query 端口",desc:"Query 协议监听端口（默认为 25565）。",type:"number"},{key:"broadcast-console-to-ops",label:"向 OP 广播控制台",desc:"控制台执行的指令输出是否发给在线 OP。",type:"boolean"},{key:"enable-jmx-monitoring",label:"启用 JMX 监控",desc:"开启 Java JMX 性能监控（通常用于开发调试）。",type:"boolean"},{key:"management-server-enabled",label:"启用管理后台",desc:"是否启用 Minecraft 官方定义的管理服务器接口。",type:"boolean"},{key:"management-server-port",label:"管理后台端口",desc:"管理接口监听的端口。",type:"number"},{key:"management-server-host",label:"管理后台主机",desc:"管理接口绑定的主机名/IP。",type:"string"},{key:"management-server-allowed-origins",label:"管理后台允许源",desc:"允许访问管理接口的 Origin 列表。",type:"string"},{key:"server-ip",label:"服务器绑定 IP",desc:"指定服务器绑定的本地网卡 IP。留空表示监听所有网卡（0.0.0.0）。",type:"string"},{key:"debug",label:"调试模式",desc:"开启后控制台将输出更多调试信息。",type:"boolean"},{key:"text-filtering-config",label:"文本过滤配置",desc:"用于文本过滤服务的 API 配置。",type:"string"},{key:"status-heartbeat-interval",label:"状态心跳间隔",desc:"服务器向客户端发送状态心跳的间隔（0 为默认）。",type:"number"}],Pl={class:"settings-container"},Tl={class:"page-header"},Dl={class:"config-list"},Ol={key:0,class:"empty-tip"},zl={class:"setting-info"},Fl={class:"title"},Nl={class:"key-name-row"},Gl={key:0,class:"key-name"},Jl={key:0,class:"desc"},jl={class:"setting-control"},Xl={class:"form-actions"},Wl=oe({__name:"ServerProperties",setup(n){const b=he(),$=h(0),w=h(!1),u=h(!1),x=h({}),_=h(""),L=g=>{const c={};return g.split(`
`).forEach(D=>{const d=D.trim();if(!d||d.startsWith("#"))return;const l=d.indexOf("=");if(l!==-1){const y=d.substring(0,l).trim(),B=d.substring(l+1).trim();c[y]=B}}),c},v=g=>{let c=`#Minecraft server properties
#${new Date().toString()}
`;const m=je.map(d=>d.key),D=Object.keys(g);return m.forEach(d=>{Object.prototype.hasOwnProperty.call(g,d)&&(c+=`${d}=${g[d]}
`)}),D.forEach(d=>{m.includes(d)||(c+=`${d}=${g[d]}
`)}),c},i=async()=>{if($.value){w.value=!0;try{const g=await Ye($.value,"server.properties");g&&(_.value=g,x.value=L(g))}catch(g){G.error(`读取配置文件失败: ${g.message}`)}finally{w.value=!1}}},k=async()=>{u.value=!0;try{const g=v(x.value);await St($.value,"server.properties",g),G.success("配置文件已保存"),i()}catch(g){G.error(`保存失败: ${g.message}`)}finally{u.value=!1}},z=ae(()=>{const g=[],c=x.value,m=new Set(Object.keys(c));return je.forEach(D=>{m.has(D.key)&&(g.push(D),m.delete(D.key))}),m.forEach(D=>{g.push({key:D,label:D,desc:"未收录的配置项",type:W(c[D]),isUnknown:!0})}),g}),W=g=>g==="true"||g==="false"?"boolean":!isNaN(Number(g))&&g!==""?"number":"string",P=(g,c)=>{const m=x.value[g];return m===void 0?c==="boolean"?!1:"":c==="boolean"?m==="true":c==="number"?Number(m):m},r=(g,c,m)=>{x.value[g]=String(c)};return Z(()=>b.params.serverId,g=>{b.name==="InstanceConsole"&&g&&($.value=parseInt(g),i())},{immediate:!0}),(g,c)=>{const m=S("t-button"),D=S("t-space"),d=S("t-switch"),l=S("t-select"),y=S("t-input-number"),B=S("t-input"),o=S("t-loading");return f(),E("div",Pl,[e("div",Tl,[c[1]||(c[1]=e("div",{class:"section-title"},"Server.properties 配置编辑器",-1)),t(D,null,{default:s(()=>[t(m,{variant:"text",shape:"square",loading:w.value,onClick:i},{icon:s(()=>[t(U(we))]),_:1},8,["loading"]),t(m,{theme:"primary",loading:u.value,onClick:k},{icon:s(()=>[t(U(at))]),default:s(()=>[c[0]||(c[0]=p(" 保存配置 ",-1))]),_:1},8,["loading"])]),_:1})]),t(o,{loading:w.value,text:"正在读取配置文件..."},{default:s(()=>[e("div",Dl,[!w.value&&z.value.length===0?(f(),E("div",Ol," 无法找到配置项或文件为空 ")):O("",!0),(f(!0),E(ne,null,ue(z.value,C=>(f(),E("div",{key:C.key,class:$e(["setting-item",{"unknown-item":C.isUnknown}])},[e("div",zl,[e("div",Fl,A(C.label),1),e("div",Nl,[C.isUnknown?O("",!0):(f(),E("span",Gl,A(C.key),1))]),C.isUnknown?O("",!0):(f(),E("div",Jl,A(C.desc||"暂无描述"),1))]),e("div",jl,[C.type==="boolean"?(f(),J(d,{key:0,"model-value":P(C.key,"boolean"),"onUpdate:modelValue":T=>r(C.key,T,"boolean")},null,8,["model-value","onUpdate:modelValue"])):C.type==="select"?(f(),J(l,{key:1,"model-value":P(C.key,"string"),options:C.options,placeholder:"请选择","onUpdate:modelValue":T=>r(C.key,T,"string")},null,8,["model-value","options","onUpdate:modelValue"])):C.type==="number"?(f(),J(y,{key:2,"model-value":P(C.key,"number"),theme:"column",style:{width:"100%"},"onUpdate:modelValue":T=>r(C.key,T,"number")},null,8,["model-value","onUpdate:modelValue"])):(f(),J(B,{key:3,"model-value":P(C.key,"string"),placeholder:"未设置","onUpdate:modelValue":T=>r(C.key,T,"string")},null,8,["model-value","onUpdate:modelValue"]))])],2))),128))])]),_:1},8,["loading"]),e("div",Xl,[t(m,{theme:"primary",size:"large",loading:u.value,onClick:k},{default:s(()=>[...c[2]||(c[2]=[p("保存设置",-1)])]),_:1},8,["loading"]),t(m,{theme:"default",variant:"base",size:"large",onClick:i},{default:s(()=>[...c[3]||(c[3]=[p("重置更改",-1)])]),_:1})])])}}}),ql=ie(Wl,[["__scopeId","data-v-6dfcc71c"]]);async function Kl(n){return await de.get({url:`/api/instance/tasks/list/${n}`})}async function Hl(n,b,$,w,u,x){return await de.post({url:"/api/instance/tasks/create",data:{instanceId:n,name:b,cron:$,payload:w,type:u,enable:x}})}async function Yl(n,b,$,w,u,x,_){return await de.post({url:"/api/instance/tasks/update",data:{instanceId:n,id:b,name:$,cron:w,payload:u,type:x,enable:_}})}async function Zl(n){return await de.post({url:`/api/instance/tasks/delete/${n}`})}const Ql={class:"cron-gen-container"},es={class:"mode-switch"},ts={key:0,class:"mode-content novice-panel"},as={class:"novice-input-group"},ls={key:1,class:"mode-content pro-panel"},ss={class:"tab-scroll-area"},ns={key:0,class:"specific-box"},os={class:"result-area"},is={class:"cron-display"},rs={class:"code-box"},us={class:"next-runs"},ds={class:"runs-title"},cs={key:0,class:"error-msg"},vs={key:1,class:"runs-list"},ms={class:"index"},ps=oe({__name:"CronGenerator",props:{visible:{type:Boolean,default:!1},initialValue:{type:String,default:""}},emits:["update:visible","confirm"],setup(n,{emit:b}){const $=n,w=b,u=h("novice"),x=h(10),_=h("minute"),L=[{label:"秒",value:"second"},{label:"分钟",value:"minute"},{label:"小时",value:"hour"},{label:"天",value:"day"}],v=h("second"),i=[{label:"秒",value:"second",min:0,max:59},{label:"分",value:"minute",min:0,max:59},{label:"时",value:"hour",min:0,max:23},{label:"日",value:"day",min:1,max:31},{label:"月",value:"month",min:1,max:12},{label:"周",value:"week",min:1,max:7}],k=h({second:{type:"every",start:0,step:1,specifics:[]},minute:{type:"every",start:0,step:1,specifics:[]},hour:{type:"every",start:0,step:1,specifics:[]},day:{type:"every",start:1,step:1,specifics:[]},month:{type:"every",start:1,step:1,specifics:[]},week:{type:"any",start:1,step:1,specifics:[]}}),z=[{label:"周日",value:1},{label:"周一",value:2},{label:"周二",value:3},{label:"周三",value:4},{label:"周四",value:5},{label:"周五",value:6},{label:"周六",value:7}],W=ae(()=>{const l=(q,I="*")=>{const F=k.value[q];return q==="week"&&F.type==="any"||q==="week"&&k.value.day.type!=="every"||q==="day"&&k.value.week.type!=="any"?"?":F.type==="every"?"*":F.type==="interval"?`${F.start}/${F.step}`:F.type==="specific"?F.specifics.length===0?q==="day"||q==="month"?"1":"0":F.specifics.sort((Y,N)=>Y-N).join(","):I},y=l("second"),B=l("minute"),o=l("hour"),C=l("day"),T=l("month"),X=l("week","?");return`${y} ${B} ${o} ${C} ${T} ${X}`}),P=ae(()=>{const l=x.value;switch(_.value){case"second":return`*/${l} * * * * *`;case"minute":return`0 */${l} * * * *`;case"hour":return`0 0 */${l} * * ?`;case"day":return`0 0 0 */${l} * ?`;default:return"* * * * * *"}}),r=ae(()=>u.value==="novice"?P.value:W.value),g=h([]),c=h(""),m=()=>{try{const l=ia.CronExpressionParser.parse(r.value,{currentDate:new Date});g.value=l.take(5).map(y=>new Date(y.toString()).toLocaleString()),c.value=""}catch{c.value="无法解析当前 Cron 表达式，请检查规则是否冲突",g.value=[]}};Z(r,()=>{m()},{immediate:!0}),Z(()=>$.visible,l=>{l&&$.initialValue&&(u.value="pro",m())});const D=()=>{if(c.value){G.warning("当前表达式无效，无法保存");return}w("confirm",r.value),w("update:visible",!1)},d=l=>{const y=i.find(o=>o.value===l);if(!y)return[];const B=[];for(let o=y.min;o<=y.max;o++)B.push({label:o.toString(),value:o});return B};return(l,y)=>{const B=S("t-radio-button"),o=S("t-radio-group"),C=S("t-input-number"),T=S("t-select"),X=S("t-alert"),q=S("t-radio"),I=S("t-checkbox-group"),F=S("t-tab-panel"),Y=S("t-tabs"),N=S("t-tag"),Q=S("t-dialog");return f(),J(Q,{visible:n.visible,header:"Cron 表达式生成器",width:"700px",top:"5vh",onClose:y[4]||(y[4]=V=>w("update:visible",!1)),onConfirm:D},{default:s(()=>[e("div",Ql,[e("div",es,[t(o,{modelValue:u.value,"onUpdate:modelValue":y[0]||(y[0]=V=>u.value=V),variant:"default-filled"},{default:s(()=>[t(B,{value:"novice"},{default:s(()=>[...y[5]||(y[5]=[p("🚀 新手模式",-1)])]),_:1}),t(B,{value:"pro"},{default:s(()=>[...y[6]||(y[6]=[p("🛠️ 专业模式",-1)])]),_:1})]),_:1},8,["modelValue"])]),u.value==="novice"?(f(),E("div",ts,[e("div",as,[y[7]||(y[7]=e("span",null,"每隔",-1)),t(C,{modelValue:x.value,"onUpdate:modelValue":y[1]||(y[1]=V=>x.value=V),min:1,theme:"column",style:{width:"100px"}},null,8,["modelValue"]),t(T,{modelValue:_.value,"onUpdate:modelValue":y[2]||(y[2]=V=>_.value=V),options:L,style:{width:"100px"}},null,8,["modelValue"]),y[8]||(y[8]=e("span",null,"执行一次",-1))]),t(X,{theme:"info",style:{"margin-top":"16px"}},{message:s(()=>[...y[9]||(y[9]=[p(" 此模式适用于简单的周期性任务。如果需要“每周五上午10点”等复杂规则，请切换到",-1),e("b",null,"专业模式",-1),p("。 ",-1)])]),_:1})])):(f(),E("div",ls,[t(Y,{modelValue:v.value,"onUpdate:modelValue":y[3]||(y[3]=V=>v.value=V)},{default:s(()=>[(f(),E(ne,null,ue(i,V=>t(F,{key:V.value,value:V.value,label:V.label},{default:s(()=>[e("div",ss,[t(o,{modelValue:k.value[V.value].type,"onUpdate:modelValue":te=>k.value[V.value].type=te,direction:"vertical"},{default:s(()=>[t(q,{value:"every"},{default:s(()=>[p(A(V.value==="week"?"不指定 (?)":`每${V.label} (*)`),1)]),_:2},1024),V.value!=="week"?(f(),J(q,{key:0,value:"interval"},{default:s(()=>[y[10]||(y[10]=p(" 周期: 从 ",-1)),t(C,{modelValue:k.value[V.value].start,"onUpdate:modelValue":te=>k.value[V.value].start=te,min:V.min,max:V.max,size:"small",theme:"column",style:{width:"60px"}},null,8,["modelValue","onUpdate:modelValue","min","max"]),p(" "+A(V.label)+"开始，每 ",1),t(C,{modelValue:k.value[V.value].step,"onUpdate:modelValue":te=>k.value[V.value].step=te,min:1,max:V.max,size:"small",theme:"column",style:{width:"60px"}},null,8,["modelValue","onUpdate:modelValue","max"]),p(" "+A(V.label)+"执行一次 ",1)]),_:2},1024)):O("",!0),V.value!=="week"?(f(),J(q,{key:1,value:"specific"},{default:s(()=>[p("指定: 选择具体的"+A(V.label),1)]),_:2},1024)):O("",!0),V.value==="week"?(f(),J(q,{key:2,value:"specific"},{default:s(()=>[...y[11]||(y[11]=[p("指定周几",-1)])]),_:1})):O("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),k.value[V.value].type==="specific"?(f(),E("div",ns,[t(I,{modelValue:k.value[V.value].specifics,"onUpdate:modelValue":te=>k.value[V.value].specifics=te,options:V.value==="week"?z:d(V.value),class:"grid-checkbox"},null,8,["modelValue","onUpdate:modelValue","options"])])):O("",!0)])]),_:2},1032,["value","label"])),64))]),_:1},8,["modelValue"])])),e("div",os,[e("div",is,[y[14]||(y[14]=e("span",{class:"label"},"当前表达式:",-1)),e("div",rs,[p(A(r.value)+" ",1),c.value?(f(),J(N,{key:1,theme:"danger",variant:"light",size:"small"},{default:s(()=>[t(U(Dt)),y[13]||(y[13]=p(" 无效",-1))]),_:1})):(f(),J(N,{key:0,theme:"success",variant:"light",size:"small"},{default:s(()=>[t(U(et)),y[12]||(y[12]=p(" 有效",-1))]),_:1}))])]),e("div",us,[e("div",ds,[t(U(xe)),y[15]||(y[15]=p(" 最近 5 次运行时间预测:",-1))]),c.value?(f(),E("div",cs,A(c.value),1)):(f(),E("ul",vs,[(f(!0),E(ne,null,ue(g.value,(V,te)=>(f(),E("li",{key:te},[e("span",ms,"#"+A(te+1),1),p(" "+A(V),1)]))),128))]))])])])]),_:1},8,["visible"])}}}),fs=ie(ps,[["__scopeId","data-v-b81cfe41"]]),gs={class:"page-container"},ys={class:"page-header"},bs={key:0,class:"create-container"},_s={class:"container-header"},ks={class:"title"},ws={class:"setting-item"},hs={class:"setting-control"},$s={class:"setting-item"},xs={class:"setting-control"},Cs={class:"setting-item"},Vs={class:"setting-control"},Ss={key:0,class:"setting-item"},Us={class:"setting-info"},Ms={class:"title"},Is={class:"desc"},Rs={class:"setting-control"},Bs={class:"setting-item"},Ls={class:"setting-control"},Es={class:"form-actions"},As={class:"task-list"},Ps={key:0,class:"empty-state"},Ts={class:"card-left"},Ds={class:"task-header-row"},Os={class:"task-name"},zs={class:"task-meta-row"},Fs={class:"cron-display"},Ns=["title"],Gs={class:"card-right"},Js=oe({__name:"CronTasks",setup(n){const b=he(),$=ae(()=>parseInt(b.params.serverId)),w=h([]),u=h(!1),x=h(!1),_=h(null),L=h(!1),v=h(null),i=h(!1),k=h({id:"",name:"",cron:"",type:"command",payload:"",enable:!0}),z=[{label:"发送命令 (Command)",value:"command"},{label:"备份存档 (Backup)",value:"backup"},{label:"开启服务器 (Start)",value:"start"},{label:"停止服务器 (Stop)",value:"stop"},{label:"重启服务器 (Restart)",value:"restart"}],W={name:[{required:!0,message:"必填",trigger:"blur"}],cron:[{required:!0,message:"必填",trigger:"blur"}],type:[{required:!0,message:"必选",trigger:"change"}],payload:[{validator:B=>k.value.type==="command"&&!B?{result:!1,message:"命令内容不能为空",type:"error"}:!0,trigger:"blur"}]},P=async()=>{if($.value){u.value=!0;try{const B=await Kl($.value);w.value=B||[]}catch(B){G.error(B.message||"获取列表失败")}finally{u.value=!1}}},r=()=>{x.value||(k.value={id:"",name:"",cron:"",type:"command",payload:"",enable:!0},_.value=null,x.value=!0)},g=B=>{k.value={id:B.id,name:B.name,cron:B.cron,type:B.type.toLowerCase(),payload:B.payload,enable:B.enable},_.value=B.id,x.value=!0,window.scrollTo({top:0,behavior:"smooth"})},c=()=>{x.value=!1,_.value=null},m=async()=>{var o;if(await((o=v.value)==null?void 0:o.validate())===!0){L.value=!0;try{_.value?(await Yl($.value,k.value.id,k.value.name,k.value.cron,k.value.payload,k.value.type,k.value.enable),G.success("更新成功")):(await Hl($.value,k.value.name,k.value.cron,k.value.payload,k.value.type,k.value.enable),G.success("创建成功")),c(),P()}catch(C){G.error(C.message||"操作失败")}finally{L.value=!1}}},D=B=>{const o=Pe.confirm({header:"确认删除?",body:`确定删除任务 "${B.name}" 吗？`,theme:"danger",onConfirm:async()=>{try{await Zl(B.id),G.success("已删除"),P(),o.hide()}catch(C){G.error(C.message)}},onClose:()=>o.hide()})},d=B=>{k.value.cron=B},l=B=>{const o=B.toLowerCase();return o==="start"?lt:o==="stop"?st:o==="restart"?we:Gt},y=B=>{const o=B.toLowerCase();return o==="start"?"success":o==="stop"?"danger":o==="restart"?"warning":"primary"};return Z(()=>$.value,P),me(P),(B,o)=>{const C=S("t-button"),T=S("t-space"),X=S("t-input"),q=S("t-select"),I=S("t-textarea"),F=S("t-switch"),Y=S("t-form"),N=S("t-tag"),Q=S("t-loading");return f(),E("div",gs,[e("div",ys,[o[10]||(o[10]=e("div",{class:"section-title"},"定时计划任务",-1)),t(T,null,{default:s(()=>[x.value?O("",!0):(f(),J(C,{key:0,theme:"default",onClick:o[0]||(o[0]=V=>U(Ae)(U(ra).cron))},{icon:s(()=>[t(U(Ot))]),default:s(()=>[o[8]||(o[8]=p(" 使用文档 ",-1))]),_:1})),x.value?O("",!0):(f(),J(C,{key:1,theme:"primary",onClick:r},{icon:s(()=>[t(U(zt))]),default:s(()=>[o[9]||(o[9]=p(" 创建新任务 ",-1))]),_:1}))]),_:1})]),t(qe,{name:"slide-fade"},{default:s(()=>[x.value?(f(),E("div",bs,[e("div",_s,[e("span",ks,A(_.value?"编辑任务":"创建新任务"),1),t(C,{size:"small",variant:"text",onClick:c},{default:s(()=>[t(U(Ft))]),_:1})]),t(Y,{ref_key:"formRef",ref:v,data:k.value,rules:W,"label-width":"0"},{default:s(()=>[e("div",ws,[o[11]||(o[11]=e("div",{class:"setting-info"},[e("div",{class:"title"},"任务名称"),e("div",{class:"desc"},"给这个计划任务起个容易识别的名字，例如“每日自动重启”")],-1)),e("div",hs,[t(X,{modelValue:k.value.name,"onUpdate:modelValue":o[1]||(o[1]=V=>k.value.name=V),placeholder:"请输入任务名称"},null,8,["modelValue"])])]),e("div",$s,[o[13]||(o[13]=e("div",{class:"setting-info"},[e("div",{class:"title"},"触发规则 (Cron)"),e("div",{class:"desc"},"使用 Cron 表达式定义执行时间。支持秒级精度 (秒 分 时 日 月 周)")],-1)),e("div",xs,[t(X,{modelValue:k.value.cron,"onUpdate:modelValue":o[2]||(o[2]=V=>k.value.cron=V),placeholder:"例如: 0 0 12 * * ?"},null,8,["modelValue"]),t(C,{variant:"outline",theme:"default",onClick:o[3]||(o[3]=V=>i.value=!0)},{default:s(()=>[...o[12]||(o[12]=[p(" 表达式生成器 ",-1)])]),_:1})])]),e("div",Cs,[o[14]||(o[14]=e("div",{class:"setting-info"},[e("div",{class:"title"},"执行操作"),e("div",{class:"desc"},"选择触发时要执行的动作类型")],-1)),e("div",Vs,[t(q,{modelValue:k.value.type,"onUpdate:modelValue":o[4]||(o[4]=V=>k.value.type=V),options:z},null,8,["modelValue"])])]),k.value.type==="command"||k.value.type==="restart"?(f(),E("div",Ss,[e("div",Us,[e("div",Ms,A(k.value.type==="restart"?"重启提示语":"控制台命令"),1),e("div",Is,A(k.value.type==="restart"?"重启前发送给全服玩家的倒计时提示消息":"不需要加 /，直接输入命令内容"),1)]),e("div",Rs,[t(I,{modelValue:k.value.payload,"onUpdate:modelValue":o[5]||(o[5]=V=>k.value.payload=V),autosize:{minRows:2,maxRows:5},placeholder:"请输入内容..."},null,8,["modelValue"])])])):O("",!0),e("div",Bs,[o[15]||(o[15]=e("div",{class:"setting-info"},[e("div",{class:"title"},"启用状态"),e("div",{class:"desc"},"暂时禁用此任务而不删除它")],-1)),e("div",Ls,[t(F,{modelValue:k.value.enable,"onUpdate:modelValue":o[6]||(o[6]=V=>k.value.enable=V)},null,8,["modelValue"])])]),e("div",Es,[t(C,{theme:"primary",loading:L.value,onClick:m},{icon:s(()=>[t(U(at))]),default:s(()=>[p(" "+A(_.value?"保存修改":"立即创建"),1)]),_:1},8,["loading"]),t(C,{theme:"default",variant:"base",onClick:c},{default:s(()=>[...o[16]||(o[16]=[p("取消",-1)])]),_:1})])]),_:1},8,["data"])])):O("",!0)]),_:1}),t(Q,{loading:u.value,"show-overlay":""},{default:s(()=>[e("div",As,[w.value.length===0&&!u.value?(f(),E("div",Ps,"暂无任务，请点击上方创建")):O("",!0),(f(!0),E(ne,null,ue(w.value,V=>(f(),E("div",{key:V.id,class:"task-card"},[e("div",Ts,[e("div",Ds,[t(N,{size:"small",theme:V.enable?"success":"warning",variant:"light",class:"status-tag"},{default:s(()=>[p(A(V.enable?"运行中":"已暂停"),1)]),_:2},1032,["theme"]),e("span",Os,A(V.name),1)]),e("div",zs,[t(N,{size:"small",variant:"outline",theme:y(V.type),style:{"margin-right":"8px"}},{icon:s(()=>[(f(),J(Ke(l(V.type))))]),default:s(()=>[p(" "+A(V.type.toUpperCase()),1)]),_:2},1032,["theme"]),e("span",Fs,[t(U(xe)),p(" "+A(V.cron),1)])]),V.payload?(f(),E("div",{key:0,class:"task-payload",title:V.payload},A(V.payload),9,Ns)):O("",!0)]),e("div",Gs,[t(C,{variant:"text",theme:"primary",onClick:te=>g(V)},{icon:s(()=>[t(U(Nt))]),default:s(()=>[o[17]||(o[17]=p(" 编辑 ",-1))]),_:1},8,["onClick"]),t(C,{variant:"text",theme:"danger",onClick:te=>D(V)},{icon:s(()=>[t(U(Qe))]),default:s(()=>[o[18]||(o[18]=p(" 删除 ",-1))]),_:1},8,["onClick"])])]))),128))])]),_:1},8,["loading"]),t(fs,{visible:i.value,"onUpdate:visible":o[7]||(o[7]=V=>i.value=V),"initial-value":k.value.cron,onConfirm:d},null,8,["visible","initial-value"])])}}}),js=ie(Js,[["__scopeId","data-v-98dd2a72"]]),Xs={class:"layout-container"},Ws={class:"sidebar"},qs=["onClick"],Ks={class:"nav-text"},Hs={class:"main-content"},Ys={key:0,class:"panel-wrapper"},Zs={key:1,class:"panel-wrapper"},Qs={key:2,class:"panel-wrapper"},en={key:3,class:"panel-wrapper"},tn=oe({__name:"InstanceSettings",setup(n,{expose:b}){const $=h(!1),w=h(0),u=[{label:"实例设置",icon:nt},{label:"插件/模组",icon:Jt},{label:"服务器属性",icon:jt},{label:"定时任务",icon:xe}];return b({open:()=>{$.value=!0}}),(_,L)=>{const v=S("t-dialog");return f(),J(v,{visible:$.value,"onUpdate:visible":L[0]||(L[0]=i=>$.value=i),header:"实例配置",width:"90%",top:"3vh",attach:"body",footer:!1,class:"settings-dialog"},{default:s(()=>[e("div",Xs,[e("div",Ws,[(f(),E(ne,null,ue(u,(i,k)=>e("div",{key:k,class:$e(["nav-item",{active:w.value===k}]),onClick:z=>w.value=k},[(f(),J(Ke(i.icon),{class:"nav-icon"})),e("span",Ks,A(i.label),1)],10,qs)),64))]),e("div",Hs,[w.value===0?(f(),E("div",Ys,[t(kl)])):O("",!0),w.value===1?(f(),E("div",Zs,[t(Al)])):O("",!0),w.value===2?(f(),E("div",Qs,[t(ql,{"instance-id":21})])):O("",!0),w.value===3?(f(),E("div",en,[t(js)])):O("",!0)])])]),_:1},8,["visible"])}}}),an=ie(tn,[["__scopeId","data-v-5ed0e6e3"]]),ln={class:"monitor-container"},sn={class:"status-header"},nn={class:"status-text"},on={class:"monitor-content"},rn={class:"monitor-block"},un={class:"info-item"},dn={class:"label"},cn={class:"value"},vn={class:"monitor-block"},mn={class:"info-item"},pn={class:"label"},fn={class:"value"},gn={key:0,class:"sub-val"},Ve=20,yn=oe({__name:"InstanceMonitor",props:{serverId:{},maxMemory:{},isRunning:{type:Boolean}},setup(n){const b=n,$=Te(),w=h(null),u=h(null);let x=null,_=null;const L=h(new Array(Ve).fill(0)),v=h(new Array(Ve).fill(0)),i=ae(()=>b.maxMemory>0),k=(c,m,D=100)=>({grid:{top:4,right:0,bottom:4,left:0},xAxis:{type:"category",show:!1,boundaryGap:!1},yAxis:{type:"value",min:0,max:D===null?void 0:D,show:!1},series:[{type:"line",data:m,smooth:!0,showSymbol:!1,lineStyle:{width:2,color:c},areaStyle:{color:new ua(0,0,0,1,[{offset:0,color:c.replace(")",", 0.2)").replace("rgb","rgba")},{offset:1,color:"transparent"}])}}]}),z=()=>{const c=getComputedStyle(document.documentElement),m=c.getPropertyValue("--td-brand-color").trim()||"#0052d9",D=c.getPropertyValue("--td-warning-color").trim()||"#e37318";if(w.value&&(x=Je(w.value),x.setOption(k(m,L.value,100))),u.value){_=Je(u.value);const d=i.value?100:null;_.setOption(k(D,v.value,d))}window.addEventListener("resize",W)},W=()=>{x==null||x.resize(),_==null||_.resize()},P=ae(()=>{const c=$.stats.memBytes/1024/1024;return c>1024?`${(c/1024).toFixed(2)} GB`:`${c.toFixed(0)} MB`}),r=async()=>{b.isRunning&&b.serverId&&($.setMaxMemory(b.maxMemory),await $.connect(b.serverId))},g=async()=>{await $.disconnect()};return Z(()=>b.maxMemory,c=>{if($.setMaxMemory(c),_){const m=c>0?100:null;_.setOption({yAxis:{max:m===null?void 0:m}})}},{immediate:!0}),Z(()=>$.stats,c=>{if(!(!b.isRunning||$.currentServerId!==b.serverId)){if(L.value.push(c.cpu),L.value.length>Ve&&L.value.shift(),i.value)v.value.push(c.memPercent);else{const m=c.memBytes/1024/1024;v.value.push(m)}v.value.length>Ve&&v.value.shift(),x==null||x.setOption({series:[{data:L.value}]}),_==null||_.setOption({series:[{data:v.value}]})}},{deep:!0}),Z(()=>b.isRunning,async c=>{c?Se(()=>{W(),r()}):(L.value.fill(0),v.value.fill(0),x==null||x.setOption({series:[{data:L.value}]}),_==null||_.setOption({series:[{data:v.value}]}),await g())}),Z(()=>b.serverId,async(c,m)=>{c!==m&&(await g(),b.isRunning&&await r())}),me(async()=>{await Se(),z(),b.isRunning&&await r()}),Me(async()=>{window.removeEventListener("resize",W),await g(),x==null||x.dispose(),_==null||_.dispose()}),(c,m)=>(f(),E("div",ln,[e("div",sn,[e("span",nn,[U($).isConnected?(f(),J(U(Ne),{key:0,style:{color:"var(--td-success-color)"}})):(f(),J(U(Ne),{key:1,style:{color:"var(--td-text-color-disabled)"}})),p(" "+A(U($).isConnected?"连接正常":"正在连接数据流..."),1)]),e("div",{class:$e(["monitor-dot",{active:U($).isConnected&&n.isRunning}])},null,2)]),e("div",on,[e("div",rn,[e("div",un,[e("div",dn,[t(U(Ee)),m[0]||(m[0]=p(" CPU 使用率",-1))]),e("div",cn,A(U($).stats.cpu.toFixed(1))+" %",1)]),e("div",{ref_key:"cpuChartRef",ref:w,class:"chart-wrapper"},null,512)]),m[2]||(m[2]=e("div",{class:"divider"},null,-1)),e("div",vn,[e("div",mn,[e("div",pn,[t(U(Xt)),m[1]||(m[1]=p(" 内存使用",-1))]),e("div",fn,[p(A(P.value)+" ",1),i.value?(f(),E("span",gn," ("+A(U($).stats.memPercent.toFixed(1))+"%) ",1)):O("",!0)])]),e("div",{ref_key:"memChartRef",ref:u,class:"chart-wrapper"},null,512)])])]))}}),bn=ie(yn,[["__scopeId","data-v-ddbf668d"]]);async function _n(n){return await de.get({url:"/api/tools/ai/usage",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${n}`}})}async function kn(n){return await de.get({url:"/api/tools/ai/models",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${n}`}})}async function wn(n,b,$,w,u,x){return b===""&&(b=null),$===""&&($=null),await de.post({url:"/api/tools/ai/analysis",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${n}`},data:{mods:b,plugins:$,core:w,logs:u,model:x,usemd:!0},timeout:300*1e3})}const hn={class:"analysis-container"},$n={class:"panel-left"},xn={class:"form-group"},Cn={class:"model-option-item"},Vn={class:"form-group"},Sn={class:"form-group"},Un={class:"env-tabs"},Mn={class:"form-group flex-grow"},In={class:"action-bar"},Rn={class:"panel-right"},Bn={class:"panel-header"},Ln={class:"stats-tags"},En={class:"report-content"},An=oe({__name:"LogAnalysis",props:{visible:{type:Boolean},serverId:{}},emits:["update:visible","submit"],setup(n,{emit:b}){const $=n,w=b,u=Oe({coreVersion:"",envType:"mods",modsList:"",pluginsList:"",logContent:"",result:"> ✨ 等待日志分析开始······",selectedModel:"qwen-flash"}),x=h([]),_=Oe({max:0,today:0,extra:0,lastTime:0}),L=h(!1),v=h(!1),i=h(!1);async function k(){const c=await _n(localStorage.getItem("msl-user-token"));if(c.code===200)_.max=c.data.max_per_day,_.extra=c.data.extra_tokens,_.lastTime=c.data.last_use_time,_.today=c.data.today_usage;else{G.error("MSL账号未登录或已失效，请重新登录！"),Ae("/frp/create");return}}async function z(){try{v.value=!0,await k();try{const m=await kn(localStorage.getItem("msl-user-token")||"");m.code===200&&(x.value=m.data,!u.selectedModel&&x.value.length>0&&(u.selectedModel=x.value[0].name))}catch(m){G.error("获取模型列表失败"+m.message)}const c=await Ze($.serverId);u.coreVersion=c.core;try{const m=await Be($.serverId,"mods",!1);u.modsList=(m.jarFiles||[]).join(`
`),u.envType="mods"}catch{u.modsList=""}try{const m=await Be($.serverId,"plugins",!1);u.pluginsList=(m.jarFiles||[]).join(`
`),u.modsList==""&&(u.envType="plugins")}catch{u.pluginsList=""}try{u.logContent=await Ye($.serverId,"logs/latest.log")}catch{}}catch(c){G.error(c.message)}v.value=!1}Z(()=>$.visible,c=>{L.value=c,c&&z()});const W=()=>{w("update:visible",!1)};async function P(){if(u.logContent){if(!u.selectedModel){G.warning("请先选择分析模型");return}i.value=!0,u.result="> ⌛️ 分析日志中··· 请稍等";try{const c=await wn(localStorage.getItem("msl-user-token"),u.modsList,u.pluginsList,u.coreVersion,u.logContent,u.selectedModel);u.result=c.data.content}catch(c){u.result=`> ❌ 分析出现错误: ${c.message}`}i.value=!1,await k()}}const r=kt(),g=h(r.value?"dark":"light");return Z(r,()=>{g.value=r.value?"dark":"light"}),(c,m)=>{const D=S("t-tag"),d=S("t-option"),l=S("t-select"),y=S("t-input"),B=S("t-radio-button"),o=S("t-radio-group"),C=S("t-textarea"),T=S("t-button"),X=S("t-loading"),q=S("t-dialog");return f(),J(q,{visible:L.value,"onUpdate:visible":m[6]||(m[6]=I=>L.value=I),width:"90%",top:"3vh",footer:!1,"close-on-overlay-click":!1,class:"log-analysis-dialog",onClose:W},{header:s(()=>[...m[7]||(m[7]=[e("div",{class:"dialog-title"},[e("span",{style:{display:"flex","align-items":"center",gap:"8px"}}," AI 错误日志分析 ")],-1)])]),default:s(()=>[t(X,{loading:v.value},{default:s(()=>[e("div",hn,[e("div",$n,[e("div",xn,[m[8]||(m[8]=e("div",{class:"label"},"选择分析模型",-1)),t(l,{modelValue:u.selectedModel,"onUpdate:modelValue":m[0]||(m[0]=I=>u.selectedModel=I),placeholder:"请选择AI模型",filterable:""},{default:s(()=>[(f(!0),E(ne,null,ue(x.value,I=>(f(),J(d,{key:I.name,value:I.name,label:I.name},{default:s(()=>[e("div",Cn,[e("span",null,A(I.name),1),t(D,{size:"small",variant:"light",theme:"default"},{default:s(()=>[p(" 倍率: "+A(I.rate)+"x ",1)]),_:2},1024)])]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),e("div",Vn,[m[9]||(m[9]=e("div",{class:"label"},"服务端核心/版本",-1)),t(y,{modelValue:u.coreVersion,"onUpdate:modelValue":m[1]||(m[1]=I=>u.coreVersion=I),readonly:"",placeholder:"例如: Arclight 1.21.1"},{"prefix-icon":s(()=>[t(U(Ue))]),_:1},8,["modelValue"])]),e("div",Sn,[m[12]||(m[12]=e("div",{class:"label"},"环境列表",-1)),e("div",Un,[t(o,{modelValue:u.envType,"onUpdate:modelValue":m[2]||(m[2]=I=>u.envType=I),variant:"default-filled",class:"custom-radio-group"},{default:s(()=>[t(B,{value:"mods"},{default:s(()=>[t(U(Ue),{class:"mr-1"}),m[10]||(m[10]=p(" 模组 (Mods) ",-1))]),_:1}),t(B,{value:"plugins"},{default:s(()=>[t(U(Le),{class:"mr-1"}),m[11]||(m[11]=p(" 插件 (Plugins) ",-1))]),_:1})]),_:1},8,["modelValue"])]),Re(t(C,{modelValue:u.modsList,"onUpdate:modelValue":m[3]||(m[3]=I=>u.modsList=I),readonly:"",autosize:{minRows:4,maxRows:6},placeholder:"暂无模组数据...",class:"mt-2 readonly-textarea"},null,8,["modelValue"]),[[ze,u.envType==="mods"]]),Re(t(C,{modelValue:u.pluginsList,"onUpdate:modelValue":m[4]||(m[4]=I=>u.pluginsList=I),readonly:"",autosize:{minRows:4,maxRows:6},placeholder:"暂无插件数据...",class:"mt-2 readonly-textarea"},null,8,["modelValue"]),[[ze,u.envType==="plugins"]])]),e("div",Mn,[m[13]||(m[13]=e("div",{class:"label"},"错误日志内容",-1)),t(C,{modelValue:u.logContent,"onUpdate:modelValue":m[5]||(m[5]=I=>u.logContent=I),placeholder:"没找到有效日志，您可以手动粘贴日志......",class:"log-textarea"},null,8,["modelValue"])]),e("div",In,[t(T,{loading:i.value,block:"",theme:"primary",size:"large",onClick:P},{icon:s(()=>[t(U(Wt))]),default:s(()=>[m[14]||(m[14]=p(" 开始 AI 诊断 ",-1))]),_:1},8,["loading"])])]),e("div",Rn,[e("div",Bn,[m[15]||(m[15]=e("span",{class:"title"},"AI 分析报告",-1)),e("div",Ln,[t(D,{theme:"default",variant:"light",size:"small"},{icon:s(()=>[t(U(qt))]),default:s(()=>[p(" 今日: "+A(_.today)+" / "+A(_.max),1)]),_:1}),t(D,{theme:"primary",variant:"light",size:"small"},{icon:s(()=>[t(U(Kt))]),default:s(()=>[p(" 额外: "+A(_.extra),1)]),_:1}),t(D,{theme:"warning",variant:"light",size:"small"},{icon:s(()=>[t(U(xe))]),default:s(()=>[p(" 上次: "+A(U(ca)(_.lastTime)),1)]),_:1})])]),e("div",En,[t(U(da),{"editor-id":"report-preview","model-value":u.result,theme:g.value,class:"md-preview-wrapper"},null,8,["model-value","theme"])])])])]),_:1},8,["loading"])]),_:1},8,["visible"])}}}),Pn=ie(An,[["__scopeId","data-v-88fa37cc"]]),Tn={class:"sidebar-content"},Dn={class:"control-header"},On={class:"control-actions"},zn={class:"running-action-group"},Fn={class:"action-row"},Nn={class:"card-content-area"},Gn={key:0,class:"info-list"},Jn={class:"info-item"},jn={class:"label"},Xn={class:"value"},Wn={class:"info-item"},qn={class:"label"},Kn={class:"value"},Hn={class:"info-item"},Yn={class:"label"},Zn={class:"value"},Qn={class:"info-item"},eo={class:"label"},to={class:"value"},ao={class:"info-item"},lo={class:"label"},so={class:"value"},no={class:"info-item"},oo={class:"label"},io={class:"value"},ro={class:"info-item"},uo={class:"label"},co={class:"value"},vo={key:1,class:"info-item"},mo={class:"label"},po={class:"info-item"},fo={class:"label"},go={class:"value"},yo={key:1,class:"monitor-view"},bo={key:1,class:"monitor-placeholder"},_o=oe({__name:"ServerControlPanel",props:{serverId:{},isRunning:{type:Boolean},loading:{type:Boolean},serverInfo:{}},emits:["start","stop","clear-log","refresh-info","backup","force-exit","restart"],setup(n,{emit:b}){const $=n,w=b,u=h(!1),x=h(null),_=h("info"),L=()=>{var P;(P=x.value)==null||P.open()},v=()=>{w("refresh-info")},i=h(0);let k=null;const z=P=>{if(!P)return 0;const r=P.match(/^(?:(\d+)\.)?(\d{1,2}):(\d{2}):(\d{2})(?:\.\d+)?$/);return r?parseInt(r[1]||"0",10)*86400+parseInt(r[2])*3600+parseInt(r[3])*60+parseInt(r[4]):0},W=ae(()=>{if(i.value<=0)return"00:00:00";const P=Math.floor(i.value/86400),r=new Date(i.value*1e3).toISOString().substr(11,8);return P>0?`${P}天 ${r}`:r});return Z(()=>{var P;return(P=$.serverInfo)==null?void 0:P.uptime},P=>P&&(i.value=z(P)),{immediate:!0}),Z(()=>$.isRunning,P=>{P?k||(k=window.setInterval(()=>i.value++,1e3)):k&&(clearInterval(k),k=null)},{immediate:!0}),Me(()=>{k&&clearInterval(k)}),(P,r)=>{const g=S("t-tag"),c=S("t-button"),m=S("t-dropdown-item"),D=S("t-dropdown-menu"),d=S("t-dropdown"),l=S("t-card"),y=S("t-radio-button"),B=S("t-radio-group");return f(),E("div",Tn,[t(l,{bordered:!1,class:"control-card"},{default:s(()=>[e("div",Dn,[e("div",{class:$e(["status-indicator",{running:n.isRunning}])},[r[10]||(r[10]=e("span",{class:"pulse"},null,-1)),p(A(n.isRunning?"Running":"Stopped"),1)],2),t(g,{theme:n.isRunning?"success":"default",variant:"light",shape:"round"},{default:s(()=>[p(A(n.isRunning?"运行中":"已停止"),1)]),_:1},8,["theme"])]),e("div",On,[n.isRunning?(f(),E(ne,{key:1},[e("div",zn,[t(c,{class:"stop-btn",theme:"danger",size:"large",loading:n.loading,variant:n.loading?"outline":"base",onClick:r[1]||(r[1]=o=>!n.loading&&P.$emit("stop"))},{icon:s(()=>[t(U(st))]),default:s(()=>[p(" "+A(n.loading?"停止中...":"停止"),1)]),_:1},8,["loading","variant"]),t(c,{theme:"warning",size:"large",shape:"square",disabled:n.loading,onClick:r[2]||(r[2]=o=>P.$emit("restart"))},{icon:s(()=>[t(U(we))]),_:1},8,["disabled"])]),n.loading?(f(),J(c,{key:0,class:"force-kill-btn glass-btn",theme:"danger",variant:"outline",block:"",onClick:r[3]||(r[3]=o=>P.$emit("force-exit"))},{icon:s(()=>[t(U(tt))]),default:s(()=>[r[12]||(r[12]=p(" 强制结束 ",-1))]),_:1})):O("",!0)],64)):(f(),J(c,{key:0,theme:"primary",size:"large",block:"",loading:n.loading,onClick:r[0]||(r[0]=o=>{P.$emit("clear-log"),P.$emit("start")})},{icon:s(()=>[t(U(lt))]),default:s(()=>[r[11]||(r[11]=p("启动实例 ",-1))]),_:1},8,["loading"])),e("div",Fn,[t(c,{class:"glass-btn",variant:"outline",block:"",onClick:r[4]||(r[4]=o=>U(Ae)(`/instance/files/${n.serverId}`))},{icon:s(()=>[t(U(Ge))]),default:s(()=>[r[13]||(r[13]=p("文件管理 ",-1))]),_:1}),t(c,{class:"glass-btn",variant:"outline",block:"",onClick:L},{icon:s(()=>[t(U(nt))]),default:s(()=>[r[14]||(r[14]=p("实例设置 ",-1))]),_:1})]),t(d,{trigger:"click","min-column-width":120,placement:"bottom"},{default:s(()=>[t(c,{theme:"primary",class:"glass-btn",variant:"outline",block:""},{icon:s(()=>[t(U(Ht))]),default:s(()=>[r[15]||(r[15]=p("更多功能 ",-1))]),_:1}),t(D,null,{default:s(()=>[t(m,{onClick:r[5]||(r[5]=o=>P.$emit("clear-log"))},{"prefix-icon":s(()=>[t(U(we))]),default:s(()=>[r[16]||(r[16]=p(" 清空日志 ",-1))]),_:1}),t(m,{disabled:!n.isRunning||n.loading,onClick:r[6]||(r[6]=o=>P.$emit("backup"))},{"prefix-icon":s(()=>[t(U(Yt))]),default:s(()=>[r[17]||(r[17]=p(" 立即备份 ",-1))]),_:1},8,["disabled"]),t(m,{onClick:r[7]||(r[7]=o=>u.value=!0)},{"prefix-icon":s(()=>[t(U(Zt))]),default:s(()=>[r[18]||(r[18]=p(" 日志分析 ",-1))]),_:1})]),_:1})]),_:1})])]),_:1}),t(l,{bordered:!1,title:"实例概览",class:"info-card"},{actions:s(()=>[t(B,{modelValue:_.value,"onUpdate:modelValue":r[8]||(r[8]=o=>_.value=o),variant:"default-filled",size:"small"},{default:s(()=>[t(y,{value:"info"},{default:s(()=>[t(U(sa)),r[19]||(r[19]=p(" 详情",-1))]),_:1}),t(y,{value:"monitor",disabled:!n.isRunning},{default:s(()=>[t(U(na)),r[20]||(r[20]=p(" 监控",-1))]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),default:s(()=>{var o,C,T,X,q,I,F,Y,N;return[e("div",Nn,[_.value==="info"?(f(),E("div",Gn,[e("div",Jn,[e("div",jn,[t(U(Qt)),r[21]||(r[21]=p(" 实例名称",-1))]),e("div",Xn,A((o=n.serverInfo)==null?void 0:o.name),1)]),((C=n.serverInfo)==null?void 0:C.java)!=="none"?(f(),E(ne,{key:0},[e("div",Wn,[e("div",qn,[t(U(Ee)),r[22]||(r[22]=p(" 内存限制",-1))]),e("div",Kn,A((T=n.serverInfo)==null?void 0:T.maxM)+" MB",1)]),r[28]||(r[28]=e("div",{class:"proxy-group"},null,-1)),e("div",Hn,[e("div",Yn,[t(U(ea)),r[23]||(r[23]=p(" 运行端口",-1))]),e("div",Zn,A((q=(X=n.serverInfo)==null?void 0:X.mcConfig)==null?void 0:q.serverPort),1)]),e("div",Qn,[e("div",eo,[t(U(ta)),r[24]||(r[24]=p(" 游戏难度",-1))]),e("div",to,[t(g,{theme:"primary"},{default:s(()=>{var Q,V;return[p(A((V=(Q=n.serverInfo)==null?void 0:Q.mcConfig)==null?void 0:V.difficulty),1)]}),_:1})])]),e("div",ao,[e("div",lo,[t(U(aa)),r[25]||(r[25]=p(" 游戏模式",-1))]),e("div",so,[t(g,null,{default:s(()=>{var Q,V;return[p(A((V=(Q=n.serverInfo)==null?void 0:Q.mcConfig)==null?void 0:V.gamemode),1)]}),_:1})])]),e("div",no,[e("div",oo,[t(U(Ge)),r[26]||(r[26]=p(" 游戏地图",-1))]),e("div",io,A((F=(I=n.serverInfo)==null?void 0:I.mcConfig)==null?void 0:F.levelName),1)]),e("div",ro,[e("div",uo,[t(U(la)),r[27]||(r[27]=p(" 正版验证",-1))]),e("div",co,[t(g,{theme:((N=(Y=n.serverInfo)==null?void 0:Y.mcConfig)==null?void 0:N.onlineMode)==="true"?"success":"warning"},{default:s(()=>{var Q,V;return[p(A(((V=(Q=n.serverInfo)==null?void 0:Q.mcConfig)==null?void 0:V.onlineMode)==="true"?"开启":"关闭"),1)]}),_:1},8,["theme"])])])],64)):(f(),E("div",vo,[e("div",mo,[t(U(Ee)),r[29]||(r[29]=p(" 模式",-1))]),r[30]||(r[30]=e("div",{class:"value"},"自定义模式",-1))])),r[32]||(r[32]=e("div",{class:"proxy-group"},null,-1)),e("div",po,[e("div",fo,[t(U(xe)),r[31]||(r[31]=p(" 运行时长",-1))]),e("div",go,A(n.isRunning?W.value:"--:--:--"),1)])])):_.value==="monitor"?(f(),E("div",yo,[n.serverInfo&&n.isRunning?(f(),J(bn,{key:0,"server-id":n.serverId,"is-running":n.isRunning,"max-memory":n.serverInfo.java==="none"?0:n.serverInfo.maxM||4096},null,8,["server-id","is-running","max-memory"])):(f(),E("div",bo,"实例未运行"))])):O("",!0)])]}),_:1}),t(an,{ref_key:"settingsRef",ref:x,"server-id":n.serverId,onSuccess:v},null,8,["server-id"]),t(Pn,{"server-id":n.serverId,visible:u.value,"onUpdate:visible":r[9]||(r[9]=o=>u.value=o)},null,8,["server-id","visible"])])}}}),ko=ie(_o,[["__scopeId","data-v-fa4380de"]]),wo={class:"console-page"},ho={class:"layout-container"},$o={class:"main-terminal-area"},xo={class:"sidebar-area"},Co={style:{"line-height":"1.6"}},Vo={style:{"margin-bottom":"12px"}},So=oe({__name:"index",setup(n){const b=he(),$=It(),w=Te(),u=h(parseInt(b.params.serverId)||0),x=h(!1),_=h(!1),L=h(null),v=h(null);async function i(){var d;if(u.value)try{_.value=!0;const l=await Ze(u.value);await $.refreshInstanceList(),x.value=l.status,L.value=l,_.value=!1}catch(l){(d=v.value)==null||d.writeln(`\x1B[1;31m[Error] 获取实例信息失败: ${l.message}\x1B[0m`),_.value=!1}}const k=async()=>{var d,l;_.value=!0;try{(d=v.value)==null||d.writeln("\x1B[1;32m[System] 正在发送启动指令...\x1B[0m"),await ve(u.value,"start"),G.success("实例启动指令已发送"),_.value=!1}catch(y){(l=v.value)==null||l.writeln(`\x1B[1;31m[Error] 启动失败: ${y.message}\x1B[0m`),_.value=!1}},z=async()=>{var d,l;_.value=!0;try{(d=v.value)==null||d.writeln("\x1B[1;32m[System] 正在发送停止指令...\x1B[0m"),await ve(u.value,"stop"),G.warning("实例停止指令已发送"),_.value=!1}catch(y){(l=v.value)==null||l.writeln(`\x1B[1;31m[Error] 停止失败: ${y.message}\x1B[0m`),_.value=!1}},W=async()=>{var d,l;_.value=!0;try{(d=v.value)==null||d.writeln("\x1B[1;32m[System] 正在发送强制退出指令...\x1B[0m"),await ve(u.value,"forceExit"),G.warning("强制退出指令已发送"),_.value=!1}catch(y){(l=v.value)==null||l.writeln(`\x1B[1;31m[Error] 强制退出失败: ${y.message}\x1B[0m`),_.value=!1}},P=async()=>{var d,l;_.value=!0;try{(d=v.value)==null||d.writeln("\x1B[1;32m[System] 正在发送重启指令...\x1B[0m"),await ve(u.value,"restart"),G.warning("重启执行成功"),_.value=!1}catch(y){(l=v.value)==null||l.writeln(`\x1B[1;31m[Error] 重启失败: ${y.message}\x1B[0m`),_.value=!1}},r=async()=>{var d,l;try{(d=v.value)==null||d.writeln("\x1B[1;32m[System] 正在发送备份任务...\x1B[0m"),await ve(u.value,"backup"),G.success("备份任务启动中···"),_.value=!1}catch(y){(l=v.value)==null||l.writeln(`\x1B[1;31m[Error] 备份任务启动失败: ${y.message}\x1B[0m`)}},g=()=>{var d;(d=v.value)==null||d.clear()},c=h(!1),m=async()=>{u.value&&(w.onEula(()=>{c.value=!0}),await w.connect(u.value))},D=async d=>{try{c.value=!1,await ve(u.value,`agreeEula?${d}`),G.success(d?"已发送同意请求":"已发送请求")}catch(l){G.error(l.message||"发送失败")}};return Z(()=>b.params.serverId,async d=>{b.name==="InstanceConsole"&&d&&(u.value=parseInt(d),await i())}),me(async()=>{u.value&&(await i(),await m())}),(d,l)=>{const y=S("t-link"),B=S("t-dialog");return f(),E("div",wo,[e("div",ho,[e("div",$o,[t(ya,{ref_key:"terminalRef",ref:v,"server-id":u.value,onUpdate:l[0]||(l[0]=o=>i())},null,8,["server-id"])]),e("div",xo,[t(ko,{"server-id":u.value,"is-running":x.value,loading:_.value,"server-info":L.value,onStart:k,onStop:z,onBackup:r,onClearLog:g,onForceExit:W,onRestart:P},null,8,["server-id","is-running","loading","server-info"])])]),t(B,{visible:c.value,"onUpdate:visible":l[1]||(l[1]=o=>c.value=o),header:"是否同意EULA","confirm-btn":{content:"同意",theme:"primary"},"cancel-btn":{content:"不同意",theme:"default"},onConfirm:l[2]||(l[2]=o=>D(!0)),onCancel:l[3]||(l[3]=o=>D(!1))},{default:s(()=>[e("div",Co,[e("p",Vo,[l[5]||(l[5]=p(" 开启Minecraft服务器需要您同意 ",-1)),l[6]||(l[6]=e("strong",null,"EULA",-1)),l[7]||(l[7]=p(" ！",-1)),t(y,{theme:"primary",underline:""},{default:s(()=>[...l[4]||(l[4]=[p(" (https://aka.ms/minecrafteula)",-1)])]),_:1})]),l[8]||(l[8]=e("p",{style:{"margin-bottom":"12px"}},[e("strong",{style:{color:"#e34d59"}},"请您务必认真仔细阅读！")],-1)),l[9]||(l[9]=e("p",{style:{"margin-bottom":"12px"}},[e("strong",null,"注意："),p("不论您选择是或否，服务器都会在您操作后继续运行。")],-1)),l[10]||(l[10]=e("p",{style:{"margin-bottom":"12px",color:"#f59a23"}},[p(" ⚠️ 如果您"),e("strong",null,"未同意 EULA"),p("，服务器可能会在运行时自动关闭！ ")],-1)),l[11]||(l[11]=e("p",{style:{"margin-top":"16px"}},[p("💡 提示：如要在每次启动实例时忽略此提示，请在"),e("strong",null,"设置"),p("里进行配置。")],-1))])]),_:1},8,["visible"])])}}}),Pi=ie(So,[["__scopeId","data-v-022267fb"]]);export{Pi as default};
