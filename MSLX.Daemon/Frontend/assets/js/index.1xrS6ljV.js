import{D as G,F as i,R as Ue,aa as de,P as A,K,b1 as R,b2 as o,b0 as k,aY as d,a$ as c,G as l,ap as B,b5 as z,bl as Ae,bm as Ge,bn as Xe,bo as He,bp as Ye,bq as Ze,aX as C,ao as L,b6 as I,b3 as Fe,O as Pe,am as Je,b7 as Qe,bh as et,b4 as tt,a_ as st}from"./index.BbdIPky0.js";import{a as at,u as lt}from"./vue-router.CTuarHf7.js";import{e as ot,h as nt,j as it,k as rt,l as ut,m as ct,n as $e,a as dt,o as vt,r as mt,p as pt,b as ft}from"./files.DL6cF1hP.js";import{T as ht}from"./vue-codemirror.BwymcuFK.js";import{_ as X,c as gt}from"./index.mEJ9vWkt.js";import{F as bt}from"./FileUploader.PP8wxkhk.js";import{a as _t,e as yt,ay as wt,az as kt,aA as $t,aB as Ct,U as xt,aC as Ut,aD as Ce,H as Ft,ad as Pt,_ as It,M as Dt,aE as zt,af as Vt,aq as xe,aF as St,ab as Bt,aG as Lt,X as Et}from"./tdesign-icons-vue-next.DieAbZNO.js";import{M as p,D as Rt}from"./tdesign-vue-next.EnwhK9x8.js";import"./core-js-pure.DghWRT_o.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./codemirror.CEpN6POG.js";import"./pinia.DE9DXmFR.js";import"./pinia-plugin-persistedstate.n2tMOXAx.js";import"./tvision-color.BU_YHHaJ.js";import"./chroma-js.Cmk4elvR.js";import"./bezier-easing.jp9ayU57.js";import"./lodash.BpjWTYO-.js";import"./axios.R-lXtGyY.js";import"./qs.CnepGyXr.js";import"./side-channel.Bf-JVZLg.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.CD-SYzlK.js";import"./cron-parser.BqMfRICj.js";import"./luxon.BVaPVz1w.js";import"./side-channel-list.CQN2BsdT.js";import"./side-channel-map.BJ69Knz3.js";import"./get-intrinsic.CAdfHqt8.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.Cbri-GHQ.js";import"./dunder-proto.q7lw_6_J.js";import"./call-bind-apply-helpers.BxcZtPLH.js";import"./function-bind.BbkWVFrm.js";import"./hasown.ckq0ukzO.js";import"./call-bound.BO70H6sD.js";import"./side-channel-weakmap.BkoVKe_V.js";import"./nprogress.CMq2Rk2a.js";import"./lodash-es.ClUTdtmA.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";const Mt={class:"editor-container"},jt={class:"editor-status-bar"},Tt={class:"mode-tag"},Nt=G({__name:"FileEditor",props:{visible:Boolean,fileName:String,content:String,loading:Boolean},emits:["update:visible","save"],setup(U,{emit:V}){const f=U,b=V,v=i(""),m=i(!1);let a=null;const n=()=>{const h=document.documentElement.getAttribute("theme-mode");m.value=h==="dark"};Ue(()=>{n(),a=new MutationObserver(n),a.observe(document.documentElement,{attributes:!0,attributeFilter:["theme-mode"]})}),de(()=>{a==null||a.disconnect()}),A(()=>f.content,h=>{v.value=h||""},{immediate:!0});const F=K(()=>{var y,u;const h=[];switch(m.value&&h.push(Ae),(u=(y=f.fileName)==null?void 0:y.split(".").pop())==null?void 0:u.toLowerCase()){case"json":h.push(Ze());break;case"yml":case"yaml":h.push(Ye());break;case"js":case"ts":h.push(He());break;case"css":case"less":case"scss":h.push(Xe());break;case"html":case"xml":h.push(Ge());break}return h}),_=()=>{b("update:visible",!1)},D=()=>{b("save",v.value)};return(h,x)=>{const y=k("t-dialog");return d(),R(y,{visible:U.visible,header:`正在编辑: ${U.fileName}`,width:"90%",attach:"body",top:"1vh","confirm-btn":{content:"保存",loading:f.loading,theme:"primary"},class:"editor-dialog",onClose:_,onConfirm:D},{default:o(()=>[c("div",Mt,[l(B(ht),{modelValue:v.value,"onUpdate:modelValue":x[0]||(x[0]=u=>v.value=u),placeholder:"文件内容为空...",style:{height:"70vh",fontSize:"14px"},autofocus:!0,"indent-with-tab":!0,"tab-size":2,extensions:F.value},null,8,["modelValue","extensions"])]),c("div",jt,[c("span",null,"行数: "+z(v.value.split(`
`).length),1),c("span",null,"长度: "+z(v.value.length),1),c("span",Tt,z(m.value?"Dark Mode":"Light Mode"),1)])]),_:1},8,["visible","header","confirm-btn"])}}}),Ot=X(Nt,[["__scopeId","data-v-a91f60c0"]]),Kt={class:"image-wrapper"},qt=["src","alt"],Wt={key:1,class:"loading-placeholder"},At=G({__name:"ImagePreview",props:{visible:{type:Boolean},fileName:{},imageBlobUrl:{}},emits:["update:visible"],setup(U,{emit:V}){const f=V,b=()=>{f("update:visible",!1)};return(v,m)=>{const a=k("t-dialog");return d(),R(a,{visible:U.visible,header:U.fileName,footer:!1,width:"auto",top:"10vh",class:"image-preview-dialog",onClose:b},{default:o(()=>[c("div",Kt,[U.imageBlobUrl?(d(),C("img",{key:0,src:U.imageBlobUrl,alt:U.fileName},null,8,qt)):(d(),C("div",Wt,"加载中..."))])]),_:1},8,["visible","header"])}}}),Gt=X(At,[["__scopeId","data-v-12b7ca8e"]]),Xt={key:0,class:"compress-form"},Ht={class:"file-list-preview"},Yt={class:"actions"},Zt={key:1,class:"progress-view"},Jt={class:"status-icon"},Qt={class:"status-text"},es=G({__name:"FileCompressor",props:{visible:{type:Boolean},instanceId:{},currentPath:{},files:{}},emits:["update:visible","success"],setup(U,{emit:V}){const f=U,b=V,v=i(""),m=i("idle"),a=i(0),n=i("");let F=null;A(()=>f.visible,y=>{y?(m.value="idle",a.value=0,n.value="",f.files.length>0&&(v.value=`${f.files[0]}_packed.zip`)):_()});const _=()=>{F&&(clearInterval(F),F=null)},D=async()=>{if(!v.value.trim()){p.warning("请输入压缩包名称");return}let y=v.value;y.endsWith(".zip")||(y+=".zip"),m.value="processing",a.value=0,n.value="正在提交任务...";try{const E=(await ot(f.instanceId,f.files,y,f.currentPath)).taskId;if(E)h(E);else throw new Error("未获取到任务ID")}catch(u){m.value="error",n.value=u.message||"提交失败"}},h=y=>{F=window.setInterval(async()=>{try{const u=await nt(y);a.value=u.progress,n.value=u.message,u.status==="success"?(_(),m.value="success",a.value=100,setTimeout(()=>{b("success"),b("update:visible",!1)},1e3)):u.status==="error"&&(_(),m.value="error")}catch(u){console.error(u)}},1e3)},x=()=>{m.value==="processing"&&p.warning("后台任务仍在进行中，关闭窗口不会取消任务"),_(),b("update:visible",!1)};return de(()=>_()),(y,u)=>{const E=k("t-input"),j=k("t-button"),S=k("t-loading"),w=k("t-progress"),$=k("t-dialog");return d(),R($,{visible:U.visible,header:m.value==="idle"?"创建压缩包":"正在压缩",footer:!1,"close-on-overlay-click":!1,width:"480px",onClose:x},{default:o(()=>[m.value==="idle"?(d(),C("div",Xt,[c("div",Ht,[u[1]||(u[1]=L(" 即将压缩 ",-1)),c("span",null,z(U.files.length),1),u[2]||(u[2]=L(" 个文件/文件夹 ",-1))]),l(E,{modelValue:v.value,"onUpdate:modelValue":u[0]||(u[0]=T=>v.value=T),placeholder:"请输入文件名",suffix:".zip",autofocus:"",onEnter:D},null,8,["modelValue"]),c("div",Yt,[l(j,{theme:"default",variant:"text",onClick:x},{default:o(()=>[...u[3]||(u[3]=[L("取消",-1)])]),_:1}),l(j,{theme:"primary",onClick:D},{default:o(()=>[...u[4]||(u[4]=[L("开始压缩",-1)])]),_:1})])])):(d(),C("div",Zt,[c("div",Jt,[m.value==="processing"?(d(),R(S,{key:0})):m.value==="success"?(d(),R(B(_t),{key:1,style:{color:"var(--td-success-color)","font-size":"40px"}})):m.value==="error"?(d(),R(B(yt),{key:2,style:{color:"var(--td-error-color)","font-size":"40px"}})):I("",!0)]),c("div",Qt,z(n.value),1),l(w,{theme:"plump",percentage:a.value,status:m.value==="error"?"error":m.value==="success"?"success":"active"},null,8,["percentage","status"])]))]),_:1},8,["visible","header"])}}}),ts=X(es,[["__scopeId","data-v-d36f5ae8"]]),ss={class:"decompress-container"},as={class:"file-info"},ls={class:"value"},os={key:0,class:"form-item"},ns={key:1,class:"switch-row"},is={key:2,class:"progress-area"},rs={class:"status-header"},us={class:"status-text"},cs={class:"status-percent"},ds={key:3,class:"actions"},vs=G({__name:"FileDecompress",props:{visible:{type:Boolean},instanceId:{},currentPath:{},fileName:{}},emits:["update:visible","success"],setup(U,{emit:V}){const f=U,b=V,v=K({get:()=>f.visible,set:w=>b("update:visible",w)}),m=i("auto"),a=i(!0),n=i(!1),F=i(0),_=i(""),D=i("");let h=null;const x=[{label:"自动检测 (推荐)",value:"auto"},{label:"UTF-8 (Linux/Mac通用)",value:"utf-8"},{label:"GBK (Windows传统)",value:"gbk"}],y=()=>{m.value="auto",a.value=!0,n.value=!1,F.value=0,_.value="",D.value="",h&&(clearInterval(h),h=null)};A(()=>f.visible,w=>{w&&y()});const u=()=>{h&&(clearInterval(h),h=null)},E=async()=>{if(!n.value)try{n.value=!0,_.value="正在提交任务...";const w=await it(f.instanceId,f.fileName,f.currentPath,m.value,a.value);if(w&&w.taskId)D.value=w.taskId,h=window.setInterval(j,1e3);else throw new Error("未能获取任务ID")}catch(w){p.error(w.message||"提交失败"),n.value=!1}},j=async()=>{if(D.value)try{const w=await rt(D.value);F.value=w.progress||0,_.value=w.message,w.status==="success"?(u(),p.success("解压成功"),F.value=100,setTimeout(()=>{v.value=!1,b("success")},800)):w.status==="error"&&(u(),n.value=!1,p.error(w.message||"解压出错"))}catch(w){console.error("轮询失败",w)}},S=()=>{n.value&&F.value<100&&p.warning("解压正在后台进行中"),u(),v.value=!1};return(w,$)=>{const T=k("t-select"),H=k("t-switch"),Y=k("t-progress"),Z=k("t-button"),q=k("t-dialog");return d(),R(q,{visible:v.value,"onUpdate:visible":$[2]||($[2]=M=>v.value=M),header:"解压文件",footer:!1,"close-on-overlay-click":!n.value,"on-close":S,width:"480px"},{default:o(()=>[c("div",ss,[c("div",as,[$[3]||($[3]=c("span",{class:"label"},"目标文件：",-1)),c("span",ls,z(U.fileName),1)]),n.value?I("",!0):(d(),C("div",os,[$[4]||($[4]=c("span",{class:"label"},"文件名编码",-1)),l(T,{modelValue:m.value,"onUpdate:modelValue":$[0]||($[0]=M=>m.value=M),options:x},null,8,["modelValue"])])),n.value?I("",!0):(d(),C("div",ns,[$[5]||($[5]=c("div",{class:"switch-info"},[c("span",{class:"switch-label"},"创建同名文件夹"),c("span",{class:"switch-tip"},"推荐开启，防止文件散乱在当前目录")],-1)),l(H,{modelValue:a.value,"onUpdate:modelValue":$[1]||($[1]=M=>a.value=M)},null,8,["modelValue"])])),n.value?(d(),C("div",is,[c("div",rs,[c("span",us,z(_.value),1),c("span",cs,z(F.value)+"%",1)]),l(Y,{theme:"line",percentage:F.value,label:!1,status:F.value===100?"success":"active"},null,8,["percentage","status"])])):I("",!0),n.value?I("",!0):(d(),C("div",ds,[l(Z,{variant:"outline",onClick:S},{default:o(()=>[...$[6]||($[6]=[L("取消",-1)])]),_:1}),l(Z,{theme:"primary",onClick:E},{default:o(()=>[...$[7]||($[7]=[L("开始解压",-1)])]),_:1})]))])]),_:1},8,["visible","close-on-overlay-click"])}}}),ms=X(vs,[["__scopeId","data-v-bec15531"]]),ps={class:"permission-form"},fs={class:"presets"},hs={class:"preset-list"},gs={key:0,class:"preset-desc"},bs={key:1,class:"preset-desc"},_s={key:2,class:"preset-desc"},ys=G({__name:"FilePermission",props:{visible:{type:Boolean},instanceId:{},currentPath:{},targets:{}},emits:["update:visible","success"],setup(U,{emit:V}){const f=U,b=V,v=i({mode:"755"}),m=i(!1),a=[{label:"755 (推荐: 所有者读写执/他人读执)",value:"755"},{label:"777 (全开: 所有权限)",value:"777"},{label:"644 (普通文件: 读写/读)",value:"644"}],n=K(()=>f.targets.length===1?`修改权限 - ${f.targets[0].name}`:`批量修改权限 (${f.targets.length} 项)`);A(()=>f.visible,h=>{h&&f.targets.length>0&&(f.targets.length===1&&f.targets[0].mode&&f.targets[0].mode!=="Unknown"?v.value.mode=f.targets[0].mode:v.value.mode="755")});const F=()=>{b("update:visible",!1),m.value=!1},_=async()=>{if(!v.value.mode||!/^[0-7]{3}$/.test(v.value.mode)){p.warning("请输入正确的3位八进制权限码 (如 755)");return}m.value=!0;let h=0,x=0;try{for(const y of f.targets)try{await ut(D,y.fullPath,v.value.mode),h++}catch(u){x++,console.error(u)}x===0?p.success("权限修改成功"):p.warning(`完成: 成功 ${h} 个, 失败 ${x} 个`),b("success"),F()}catch(y){p.error(y.message||"请求失败")}finally{m.value=!1}},D=f.instanceId;return(h,x)=>{const y=k("t-input"),u=k("t-form-item"),E=k("t-tag"),j=k("t-dialog");return d(),R(j,{visible:U.visible,header:n.value,"confirm-btn":{content:"保存修改",loading:m.value},"on-close":F,"on-confirm":_,width:"480px"},{default:o(()=>[c("div",ps,[l(u,{label:"权限代码","required-mark":""},{default:o(()=>[l(y,{modelValue:v.value.mode,"onUpdate:modelValue":x[0]||(x[0]=S=>v.value.mode=S),placeholder:"例如: 755",tips:"请输入3位八进制数字 (Linux Chmod)"},null,8,["modelValue"])]),_:1}),c("div",fs,[x[1]||(x[1]=c("div",{class:"preset-label"},"快捷设置：",-1)),c("div",hs,[(d(),C(Pe,null,Fe(a,S=>l(E,{key:S.value,variant:"light-outline",theme:"primary",class:"preset-tag",style:{cursor:"pointer"},onClick:w=>v.value.mode=S.value},{default:o(()=>[L(z(S.value),1)]),_:2},1032,["onClick"])),64))]),v.value.mode==="755"?(d(),C("div",gs,"适合可执行程序、脚本或文件夹")):I("",!0),v.value.mode==="644"?(d(),C("div",bs,"适合普通配置文件、日志等")):I("",!0),v.value.mode==="777"?(d(),C("div",_s,"允许任何人写入 (不安全)")):I("",!0)])])]),_:1},8,["visible","header","confirm-btn"])}}}),ws=X(ys,[["__scopeId","data-v-34bcd43c"]]),ks={class:"file-manager-wrapper"},$s={class:"toolbar"},Cs={class:"breadcrumb-area"},xs={class:"actions-area"},Us={key:0},Fs={key:0},Ps={key:0},Is={class:"table-wrapper"},Ds=["onClick"],zs={class:"name-text"},Vs={class:"op-actions"},Ss={key:0,class:"selection-bar"},Bs={key:0,class:"selection-info"},Ls={key:1,class:"selection-info"},Es={class:"selection-actions"},Rs={key:0},Ms={key:0},js={key:0},Ts={key:0},Ns=G({__name:"index",setup(U){const V=at(),f=lt(),b=K(()=>Number(V.params.serverFilesId)),v=i(!1),m=i([]),a=i(""),n=i([]),F=i(window.innerWidth),_=K(()=>F.value<768),D=i(!1),h=i(!1),x=i(!1),y=i(!1),u=i(!1),E=i(!1),j=i(!1),S=i(!1),w=i(!1),$=i(""),T=i(""),H=i(""),Y=i(!1),Z=i(""),q=i(""),M=i(""),W=i(""),le=i(null),ve=i([]),me=i(""),te=i([]),pe=()=>{F.value=window.innerWidth},se=t=>{var r;const e=(r=t.split(".").pop())==null?void 0:r.toLowerCase();return["png","jpg","jpeg","gif","ico","webp","bmp","svg"].includes(e||"")},fe=t=>{var r;const e=(r=t.split(".").pop())==null?void 0:r.toLowerCase();return["zip","jar"].includes(e||"")},he=t=>{var r;if(t.type==="folder"){const g=t.name.toLowerCase();return g==="config"||g==="settings"?{icon:Dt,color:"var(--td-warning-color)"}:g.startsWith("world")||g==="level"?{icon:zt,color:"var(--td-success-color)"}:["plugins","mods","libraries"].includes(g)?{icon:Vt,color:"var(--td-brand-color)"}:["logs","crash-reports","cache","temp"].includes(g)?{icon:xe,color:"var(--td-gray-color-6)"}:{icon:xe,color:"var(--td-brand-color)"}}const e=(r=t.name.split(".").pop())==null?void 0:r.toLowerCase();return["png","jpg","jpeg","gif","ico","webp"].includes(e||"")?{icon:St,color:"var(--td-success-color)"}:["jar","zip","rar","7z","tar","gz"].includes(e||"")?{icon:Ce,color:"#722ed1"}:["yml","yaml","json","properties","toml","xml","conf","sh","bat","cmd"].includes(e||"")?{icon:Bt,color:"var(--td-warning-color)"}:["log","txt","md","lock"].includes(e||"")?{icon:Lt,color:"var(--td-gray-color-6)"}:{icon:Et,color:"var(--td-text-color-secondary)"}},oe=K(()=>m.value.some(t=>t.permission&&t.permission!=="")),Ie=K(()=>{const t={colKey:"row-select",type:"multiple",width:_.value?34:40},e={colKey:"name",title:"文件名",ellipsis:!0,width:"auto"},r={colKey:"operation",title:"操作",width:_.value?50:80,align:"center",fixed:_.value?"right":void 0};return _.value?[t,e,r]:[t,e,{colKey:"size",title:"大小",width:100,align:"right"},...oe.value?[{colKey:"permission",title:"权限",width:80,align:"center"}]:[],{colKey:"lastModified",title:"修改时间",width:180,align:"center"},r]}),De=K(()=>{const t=a.value.split("/").filter(g=>g),e=[{name:"根目录",path:""}];let r="";return t.forEach(g=>{r=r?`${r}/${g}`:g,e.push({name:g,path:r})}),e}),ze=K(()=>n.value.length>0),Ve=t=>{if(t===0)return"-";const e=["B","KB","MB","GB","TB"];let r=0;for(;t>=1024&&r<e.length-1;)t/=1024,r++;return`${t.toFixed(1)} ${e[r]}`},Se=t=>t?new Date(t).toLocaleString():"-",ae=async()=>{v.value=!0,n.value=[];try{const t=await ct(b.value,a.value);m.value=t||[]}catch(t){console.error(t)}finally{v.value=!1}},ne=async t=>{q.value&&(window.URL.revokeObjectURL(q.value),q.value="");const e=a.value?`${a.value}/${t}`:t,r=p.loading("正在加载图片...");try{const g=await $e(b.value,e);if(!(g instanceof Blob))throw new Error("无效数据");q.value=window.URL.createObjectURL(g),Z.value=t,h.value=!0,p.close(r)}catch{p.close(r),p.error("加载失败")}},ie=async(t,e=!1)=>{if(e){T.value=t,H.value="",D.value=!0;return}if(se(t)){ne(t);return}const r=a.value?`${a.value}/${t}`:t,g=p.loading("正在读取文件...");try{const P=await dt(b.value,r);T.value=t,H.value=P,D.value=!0,p.close(g)}catch(P){p.close(g),p.error("读取失败: "+P.message)}},Be=()=>{M.value="",x.value=!0},ge=()=>{if(!M.value.trim()){p.warning("请输入文件名");return}x.value=!1,ie(M.value,!0)},Le=async t=>{Y.value=!0;try{const e=a.value?`${a.value}/${T.value}`:T.value;await ft(b.value,e,t),p.success("保存成功"),D.value=!1,N()}catch{p.error("保存失败")}finally{Y.value=!1}},Ee=()=>{$.value="",w.value=!0},be=async()=>{if(!$.value.trim()){p.warning("请输入文件夹名称");return}try{await vt(b.value,a.value,$.value),p.success("文件夹创建成功"),w.value=!1,N()}catch(t){p.error(`创建失败: ${t.message||"未知错误"}`)}},Re=t=>{le.value={name:t.name,fullPath:a.value?`${a.value}/${t.name}`:t.name},W.value=t.name,y.value=!0},_e=async()=>{if(!W.value||!le.value)return;const t=a.value?`${a.value}/${W.value}`:W.value;try{await mt(b.value,le.value.fullPath,t),p.success("重命名成功"),y.value=!1,N()}catch{p.error("重命名失败")}},ye=t=>{let e=[];if(t?e=[t.name]:e=[...n.value],e.length===0)return;const r=Rt.confirm({header:"确认删除",body:`确定要永久删除这 ${e.length} 项吗？`,theme:"danger",onConfirm:async()=>{try{const g=e.map(P=>a.value?`${a.value}/${P}`:P);await pt(b.value,g),p.success("删除成功"),n.value=[],N(),r.hide()}catch{p.error("删除失败")}}})},Me=t=>{if(t.type==="folder"){const e=a.value===""?"":"/";a.value=`${a.value}${e}${t.name}`}else se(t.name)?ne(t.name):ie(t.name)},je=t=>{a.value=t},N=()=>ae(),we=async t=>{var r;let e=[];if(t?e=[t.name]:e=[...n.value],e.length!==0){for(const g of e){if(((r=m.value.find(Q=>Q.name===g))==null?void 0:r.type)==="folder"){p.warning(`暂不支持下载文件夹: ${g} 请压缩后再下载！`);continue}const P=a.value?`${a.value}/${g}`:g,J=p.loading(`准备下载: ${g}...`);try{const Q=await $e(b.value,P),re=new Blob([Q]),O=document.createElement("a");O.href=window.URL.createObjectURL(re),O.download=g,O.style.display="none",document.body.appendChild(O),O.click(),document.body.removeChild(O),window.URL.revokeObjectURL(O.href),p.close(J)}catch{p.close(J),p.error(`下载失败: ${g}`)}}t||(n.value=[])}},Te=()=>{n.value.length!==0&&(ve.value=[...n.value],E.value=!0)},Ne=()=>{n.value=[],N()},Oe=t=>{me.value=t.name,j.value=!0},Ke=()=>{N()},ke=t=>{if(te.value=[],t)te.value.push({name:t.name,fullPath:a.value?`${a.value}/${t.name}`:t.name,mode:t.permission||"755"});else{if(n.value.length===0)return;n.value.forEach(e=>{const r=m.value.find(g=>g.name===e);r&&te.value.push({name:r.name,fullPath:a.value?`${a.value}/${r.name}`:r.name,mode:r.permission||"755"})})}S.value=!0},qe=()=>{n.value=[],N()},We=()=>N();return A(a,t=>{f.replace({query:{...V.query,path:t||void 0}}),ae()}),A(b,()=>{V.name==="InstanceFiles"&&(a.value="",n.value=[],ae())}),Ue(()=>{const t=V.query.path;window.addEventListener("resize",pe),t?a.value=t:ae()}),de(()=>{window.removeEventListener("resize",pe)}),(t,e)=>{const r=k("t-breadcrumb-item"),g=k("t-breadcrumb"),P=k("t-button"),J=k("t-dropdown"),Q=k("t-tag"),re=k("t-table"),O=k("t-card"),ue=k("t-input"),ce=k("t-dialog");return d(),C("div",ks,[l(O,{bordered:!1,class:"file-manager-card"},{default:o(()=>[c("div",$s,[c("div",Cs,[l(g,{"max-item-width":_.value?"80px":"150px"},{default:o(()=>[(d(!0),C(Pe,null,Fe(De.value,(s,ee)=>(d(),R(r,{key:ee,class:"crumb-item",onClick:Os=>je(s.path)},Qe({default:o(()=>[L(" "+z(s.name),1)]),_:2},[ee===0?{name:"icon",fn:o(()=>[l(B(wt))]),key:"0"}:void 0]),1032,["onClick"]))),128))]),_:1},8,["max-item-width"])]),c("div",xs,[l(P,{variant:"outline",size:"medium",onClick:e[0]||(e[0]=s=>B(gt)(`/instance/console/${b.value}`))},{icon:o(()=>[l(B(kt))]),default:o(()=>[_.value?I("",!0):(d(),C("span",Us,"控制台"))]),_:1}),l(J,{options:[{content:"新建文件",value:"file",onClick:Be},{content:"新建文件夹",value:"folder",onClick:Ee}]},{default:o(()=>[l(P,{variant:"outline",size:"medium"},{icon:o(()=>[l(B($t))]),default:o(()=>[_.value?I("",!0):(d(),C("span",Fs,"新建"))]),_:1})]),_:1},8,["options"]),l(P,{theme:"primary",size:"medium",onClick:e[1]||(e[1]=s=>u.value=!0)},{icon:o(()=>[l(B(Ct))]),default:o(()=>[_.value?I("",!0):(d(),C("span",Ps,"上传"))]),_:1}),l(P,{variant:"outline",size:"medium",onClick:N},{icon:o(()=>[l(B(xt))]),_:1})])]),c("div",Is,[l(re,{"selected-row-keys":n.value,"onUpdate:selectedRowKeys":e[2]||(e[2]=s=>n.value=s),data:m.value,columns:Ie.value,"row-key":"name",loading:v.value,hover:!0,size:"medium",class:"file-table"},{name:o(({row:s})=>[c("div",{class:"file-name-cell",onClick:et(ee=>Me(s),["stop"])},[(d(),R(tt(he(s).icon),{class:"file-icon",style:st({color:he(s).color})},null,8,["style"])),c("span",zs,z(s.name),1)],8,Ds)]),size:o(({row:s})=>[L(z(Ve(s.size)),1)]),permission:o(({row:s})=>[s.permission?(d(),R(Q,{key:0,variant:"light",size:"small"},{default:o(()=>[L(z(s.permission),1)]),_:2},1024)):I("",!0)]),lastModified:o(({row:s})=>[L(z(Se(s.lastModified)),1)]),operation:o(({row:s})=>[c("div",Vs,[l(J,{placement:_.value?"bottom-right":"bottom",options:[{content:"解压",value:"decompress",onClick:()=>Oe(s),show:fe(s.name)&&s.type!=="folder"},{content:se(s.name)?"预览":"编辑",value:"edit",onClick:()=>se(s.name)?ne(s.name):ie(s.name),disabled:s.type==="folder"||fe(s.name)},{content:"权限",value:"permission",onClick:()=>ke(s),show:oe.value},{content:"下载",value:"download",onClick:()=>we(s)},{content:"重命名",value:"rename",onClick:()=>Re(s)},{content:"删除",value:"delete",theme:"error",onClick:()=>ye(s)}].filter(ee=>ee.show!==!1)},{default:o(()=>[l(P,{variant:"text",shape:"square",size:"medium"},{default:o(()=>[l(B(Ut))]),_:1})]),_:1},8,["placement","options"])])]),empty:o(()=>[...e[20]||(e[20]=[c("div",{class:"empty-state"},"暂无文件",-1)])]),_:1},8,["selected-row-keys","data","columns","loading"])])]),_:1}),l(Je,{name:"slide-up"},{default:o(()=>[ze.value?(d(),C("div",Ss,[_.value?(d(),C("div",Ls,[c("span",null,z(n.value.length),1)])):(d(),C("div",Bs,[e[21]||(e[21]=L(" 已选 ",-1)),c("span",null,z(n.value.length),1),e[22]||(e[22]=L(" 项 ",-1))])),c("div",Es,[l(P,{size:"small",variant:"text",theme:"primary",onClick:e[3]||(e[3]=s=>Te())},{icon:o(()=>[l(B(Ce))]),default:o(()=>[_.value?I("",!0):(d(),C("span",Rs,"压缩"))]),_:1}),l(P,{size:"small",variant:"text",theme:"primary",onClick:e[4]||(e[4]=s=>we())},{icon:o(()=>[l(B(Ft))]),default:o(()=>[_.value?I("",!0):(d(),C("span",Ms,"下载"))]),_:1}),oe.value?(d(),R(P,{key:0,size:"small",variant:"text",theme:"primary",onClick:e[5]||(e[5]=s=>ke())},{icon:o(()=>[l(B(Pt))]),default:o(()=>[_.value?I("",!0):(d(),C("span",js,"权限"))]),_:1})):I("",!0),l(P,{size:"small",variant:"text",theme:"danger",onClick:e[6]||(e[6]=s=>ye())},{icon:o(()=>[l(B(It))]),default:o(()=>[_.value?I("",!0):(d(),C("span",Ts,"删除"))]),_:1}),l(P,{size:"small",variant:"text",onClick:e[7]||(e[7]=s=>n.value=[])},{default:o(()=>[...e[23]||(e[23]=[L("取消",-1)])]),_:1})])])):I("",!0)]),_:1}),l(Ot,{visible:D.value,"onUpdate:visible":e[8]||(e[8]=s=>D.value=s),"file-name":T.value,content:H.value,loading:Y.value,onSave:Le},null,8,["visible","file-name","content","loading"]),l(ce,{visible:x.value,"onUpdate:visible":e[10]||(e[10]=s=>x.value=s),header:"新建文件","on-confirm":ge},{default:o(()=>[l(ue,{modelValue:M.value,"onUpdate:modelValue":e[9]||(e[9]=s=>M.value=s),placeholder:"输入文件名",autofocus:!0,onEnter:ge},null,8,["modelValue"])]),_:1},8,["visible"]),l(ce,{visible:y.value,"onUpdate:visible":e[12]||(e[12]=s=>y.value=s),header:"重命名","on-confirm":_e},{default:o(()=>[l(ue,{modelValue:W.value,"onUpdate:modelValue":e[11]||(e[11]=s=>W.value=s),placeholder:"输入新名称",autofocus:!0,onEnter:_e},null,8,["modelValue"])]),_:1},8,["visible"]),l(bt,{visible:u.value,"onUpdate:visible":e[13]||(e[13]=s=>u.value=s),"instance-id":b.value,"current-path":a.value,onSuccess:We},null,8,["visible","instance-id","current-path"]),l(Gt,{visible:h.value,"onUpdate:visible":e[14]||(e[14]=s=>h.value=s),"file-name":Z.value,"image-blob-url":q.value},null,8,["visible","file-name","image-blob-url"]),l(ts,{visible:E.value,"onUpdate:visible":e[15]||(e[15]=s=>E.value=s),"instance-id":b.value,"current-path":a.value,files:ve.value,onSuccess:Ne},null,8,["visible","instance-id","current-path","files"]),l(ms,{visible:j.value,"onUpdate:visible":e[16]||(e[16]=s=>j.value=s),"instance-id":b.value,"current-path":a.value,"file-name":me.value,onSuccess:Ke},null,8,["visible","instance-id","current-path","file-name"]),l(ws,{visible:S.value,"onUpdate:visible":e[17]||(e[17]=s=>S.value=s),"instance-id":b.value,"current-path":a.value,targets:te.value,onSuccess:qe},null,8,["visible","instance-id","current-path","targets"]),l(ce,{visible:w.value,"onUpdate:visible":e[19]||(e[19]=s=>w.value=s),header:"新建文件夹","on-confirm":be},{default:o(()=>[l(ue,{modelValue:$.value,"onUpdate:modelValue":e[18]||(e[18]=s=>$.value=s),placeholder:"输入文件夹名称",autofocus:!0,onEnter:be},null,8,["modelValue"])]),_:1},8,["visible"])])}}}),Ba=X(Ns,[["__scopeId","data-v-a6917eac"]]);export{Ba as default};
