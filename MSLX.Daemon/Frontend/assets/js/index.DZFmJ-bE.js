import{a as J}from"./vue-router.CTuarHf7.js";import{u as q,_ as L}from"./index.Dh86awbc.js";import{D as M,F as C,P as H,R as X,V as O,aa as Z,aX as B,a$ as a,b5 as h,bi as K,bj as Q,bb as j,be as ee,aY as y,G as d,b0 as A,b2 as p,aZ as te,ao as v,b1 as T,ap as b,O as ne,b3 as ae,b6 as D}from"./index.BbdIPky0.js";import{c as x}from"./ansi-colors.gpWjHU8Z.js";import{M as $}from"./tdesign-vue-next.DWJvSscW.js";import{a9 as oe,aa as se,U as ie,a6 as re,a7 as le,ab as ce,ac as P,ad as V}from"./tdesign-icons-vue-next.Q06Erwsy.js";import{u as de,g as ue,b as z}from"./frp.CgWOz6sU.js";import"./pinia.DE9DXmFR.js";import"./pinia-plugin-persistedstate.n2tMOXAx.js";import"./tvision-color.BU_YHHaJ.js";import"./chroma-js.Cmk4elvR.js";import"./bezier-easing.jp9ayU57.js";import"./lodash.B5_zCkFd.js";import"./axios.R-lXtGyY.js";import"./qs.CnepGyXr.js";import"./side-channel.Bf-JVZLg.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.CD-SYzlK.js";import"./cron-parser.BqMfRICj.js";import"./luxon.BVaPVz1w.js";import"./side-channel-list.CQN2BsdT.js";import"./side-channel-map.BJ69Knz3.js";import"./get-intrinsic.CAdfHqt8.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.Cbri-GHQ.js";import"./dunder-proto.q7lw_6_J.js";import"./call-bind-apply-helpers.BxcZtPLH.js";import"./function-bind.BbkWVFrm.js";import"./hasown.ckq0ukzO.js";import"./call-bound.BO70H6sD.js";import"./side-channel-weakmap.BkoVKe_V.js";import"./nprogress.CMq2Rk2a.js";import"./core-js-pure.DghWRT_o.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./lodash-es.ClUTdtmA.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";const me={class:"terminal-header"},pe={class:"tab-title"},fe=M({__name:"ConsoleTerminal",props:{frpId:{}},emits:["update"],setup(s,{expose:f,emit:t}){const r=s,u=t,l=q(),g=C(null),n=C(null);let e=null,k=null,_=null,I=null,i=null;const m={dark:{background:"transparent",foreground:"#cccccc",cursor:"transparent",selectionBackground:"#264f78",black:"#000000",red:"#cd3131",green:"#0dbc79",yellow:"#e5e510",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"},light:{background:"transparent",foreground:"#333333",cursor:"transparent",selectionBackground:"#add6ff",black:"#000000",red:"#cd3131",green:"#00bc79",yellow:"#9d9d10",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"}};x.enabled=!0;const S=o=>o?(o=o.replace(/^(\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2}(\.\d{3})?)/,c=>x.gray(c)),o=o.replace(/\[I\]/g,x.green("[I]")),o=o.replace(/\[W\]/g,x.yellow("[W]")),o=o.replace(/\[E\]/g,x.red("[E]")),o=o.replace(/(success)/gi,c=>x.bold.green(c)),o=o.replace(/(start|starting)/gi,c=>x.blue(c)),o=o.replace(/(failed|error)/gi,c=>x.bgRed.white(` ${c} `)),o=o.replace(/(:\d{4,5})/g,c=>x.cyan(c)),o=o.replace(/(\[[0-9a-f]{8,}\])/g,c=>x.magenta(c)),o):"",U=()=>{if(!n.value||!g.value)return;if(e){e.clear(),E();return}const o=document.documentElement.getAttribute("theme-mode")==="dark";e=new K.Terminal({cursorBlink:!1,cursorStyle:"bar",fontSize:13,fontFamily:'Menlo, Monaco, "Courier New", monospace',lineHeight:1.4,theme:o?m.dark:m.light,allowTransparency:!0,disableStdin:!0,convertEol:!0}),k=new Q.FitAddon,e.loadAddon(k),e.open(n.value);const c=()=>{if(n.value&&n.value.clientWidth>0&&n.value.clientHeight>0)try{k==null||k.fit()}catch(R){console.warn(R)}};_=new ResizeObserver(()=>window.requestAnimationFrame(c)),_.observe(g.value),setTimeout(c,100),E()},Y=()=>{if(!e)return;const o=document.documentElement.getAttribute("theme-mode")==="dark";e.options.theme=o?m.dark:m.light},E=()=>{e==null||e.writeln("\x1B[1;34m[System]\x1B[0m 正在初始化Frp控制台 ..."),e==null||e.writeln(`\x1B[1;34m[System]\x1B[0m ID: ${r.frpId} | 状态: \x1B[32m已就绪！\x1B[0m`)},W=async()=>{if(i)try{await i.stop(),i=null}catch(o){console.error(o)}},N=async()=>{if(await W(),!r.frpId)return;const{baseUrl:o,token:c}=l,R=new URL("/api/hubs/frpLogsHub",o||window.location.origin);c&&R.searchParams.append("x-user-token",c),console.log(R.toString()),i=new j().withUrl(R.toString(),{withCredentials:!1}).configureLogging(ee.Warning).withAutomaticReconnect([0,2e3,5e3,1e4,3e4]).build(),i.on("ReceiveLog",w=>{e==null||e.writeln(S(w)),w.includes("[MSLX]")&&setTimeout(()=>{u("update")},2e3)}),i.onreconnecting(w=>{e==null||e.writeln("\x1B[1;33m[System] 检测到连接中断，正在尝试重连...\x1B[0m"),console.warn("SignalR Reconnecting:",w)}),i.onreconnected(async()=>{e==null||e.writeln("\x1B[1;32m[System] 网络已恢复，重新连接日志服务...\x1B[0m");try{await(i==null?void 0:i.invoke("JoinGroup",r.frpId)),e==null||e.writeln("\x1B[1;32m[System] 日志服务成功重新连接！\x1B[0m")}catch(w){e==null||e.writeln(`\x1B[1;31m[Error] 重新连接日志服务失败: ${w.message}\x1B[0m`)}}),i.onclose(w=>{w&&(e==null||e.writeln(`\x1B[1;31m[System] 日志服务连接已断开: ${w.message}\x1B[0m`),e==null||e.writeln("\x1B[1;31m[System] 请刷新页面或检查网络连接。\x1B[0m"))});try{await i.start(),e==null||e.writeln("\x1B[1;32m[System] 成功连接到Frpc日志服务\x1B[0m"),await i.invoke("JoinGroup",r.frpId)}catch(w){e==null||e.writeln(`\x1B[1;31m[Error] 连接失败: ${w.message}\x1B[0m`)}};return f({writeln:o=>e==null?void 0:e.writeln(o),clear:()=>{e==null||e.clear(),E()}}),H(()=>r.frpId,async o=>{o&&(U(),await N())}),X(async()=>{await O(),U(),I=new MutationObserver(Y),I.observe(document.documentElement,{attributes:!0,attributeFilter:["theme-mode"]}),r.frpId&&await N()}),Z(async()=>{I==null||I.disconnect(),await W(),e==null||e.dispose(),_==null||_.disconnect()}),(o,c)=>(y(),B("div",{ref_key:"terminalWrapper",ref:g,class:"terminal-wrapper"},[a("div",me,[c[0]||(c[0]=a("div",{class:"dots"},[a("span",{class:"dot red"}),a("span",{class:"dot yellow"}),a("span",{class:"dot green"})],-1)),a("div",pe,"MSLX - Frp 控制台 | "+h(s.frpId),1)]),a("div",{ref_key:"terminalBody",ref:n,class:"terminal-body"},null,512)],512))}}),ge=L(fe,[["__scopeId","data-v-df728588"]]),F=(s,f=!0,t="复制成功")=>new Promise((r,u)=>{navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(s).then(()=>{f&&$.success(t),r()}).catch(()=>{G(s,f,t,r,u)}):G(s,f,t,r,u)});function G(s,f,t,r,u){try{const l=document.createElement("textarea");l.value=s,l.style.top="0",l.style.left="0",l.style.position="fixed",document.body.appendChild(l),l.focus(),l.select();const g=document.execCommand("copy");document.body.removeChild(l),g?(f&&$.success(t),r()):(f&&$.error("复制失败"),u(new Error("execCommand returned false")))}catch(l){f&&$.error("复制出错"),u(l)}}const ve={class:"sidebar-content"},be={class:"control-header"},he={class:"control-actions"},ye={class:"info-list"},we={class:"info-item"},ke={class:"label"},xe={class:"value"},Be={key:0,class:"proxy-header"},_e={class:"info-item"},Ie={class:"label"},Ce=["onClick"],Se={class:"info-item"},$e={class:"label"},Re={class:"value highlight"},Te={class:"info-item"},Ae={class:"label"},Ee=["onClick"],Fe={key:1,class:"info-item"},Le={class:"label"},Me=["onClick"],Ue={class:"info-item"},We={class:"label"},Ne={class:"value"},De={key:1,class:"info-item empty-state"},Pe={class:"value"},Ve=M({__name:"ControlPanel",props:{frpId:{},isRunning:{type:Boolean},loading:{type:Boolean},tunnelInfo:{}},emits:["start","stop","clear-log"],setup(s){return(f,t)=>{const r=A("t-tag"),u=A("t-button"),l=A("t-card"),g=A("t-tooltip");return y(),B("div",ve,[d(l,{class:"control-card",bordered:!1},{default:p(()=>[a("div",be,[a("div",{class:te(["status-indicator",{running:s.isRunning}])},[t[3]||(t[3]=a("span",{class:"pulse"},null,-1)),v(h(s.isRunning?"Running":"Stopped"),1)],2),d(r,{theme:s.isRunning?"success":"default",variant:"light",shape:"round"},{default:p(()=>[v(h(s.isRunning?"正常运行":"未运行"),1)]),_:1},8,["theme"])]),a("div",he,[s.isRunning?(y(),T(u,{key:1,theme:"danger",size:"large",block:"",loading:s.loading,onClick:t[1]||(t[1]=n=>f.$emit("stop"))},{icon:p(()=>[d(b(se))]),default:p(()=>[t[5]||(t[5]=v("停止服务 ",-1))]),_:1},8,["loading"])):(y(),T(u,{key:0,theme:"primary",size:"large",block:"",loading:s.loading,onClick:t[0]||(t[0]=n=>f.$emit("start"))},{icon:p(()=>[d(b(oe))]),default:p(()=>[t[4]||(t[4]=v("启动服务 ",-1))]),_:1},8,["loading"])),d(u,{style:{margin:"0"},class:"glass-btn",variant:"outline",theme:"warning",block:"",onClick:t[2]||(t[2]=n=>f.$emit("clear-log"))},{icon:p(()=>[d(b(ie))]),default:p(()=>[t[6]||(t[6]=v("清空日志 ",-1))]),_:1})])]),_:1}),d(l,{title:"隧道概览",class:"info-card",bordered:!1},{actions:p(()=>[s.tunnelInfo&&s.tunnelInfo.proxies&&s.tunnelInfo.proxies.length>0&&s.tunnelInfo.proxies.some(n=>n.type==="xtcp")?(y(),T(r,{key:0,variant:"light-outline",theme:"primary"},{default:p(()=>[...t[7]||(t[7]=[v("联机房间 - 房主",-1)])]),_:1})):s.tunnelInfo&&s.tunnelInfo.proxies&&s.tunnelInfo.proxies.length>0&&s.tunnelInfo.proxies.some(n=>n.type==="xtcp - Visitors")?(y(),T(r,{key:1,variant:"light-outline",theme:"primary"},{default:p(()=>[...t[8]||(t[8]=[v("联机房间 - 访客",-1)])]),_:1})):(y(),T(u,{key:2,shape:"circle",variant:"text"},{default:p(()=>[d(b(V))]),_:1}))]),default:p(()=>[a("div",ye,[a("div",we,[a("div",ke,[d(b(re)),t[9]||(t[9]=v(" 隧道实例 ID",-1))]),a("div",xe,"#"+h(s.frpId),1)]),s.tunnelInfo&&s.tunnelInfo.proxies&&s.tunnelInfo.proxies.length>0?(y(!0),B(ne,{key:0},ae(s.tunnelInfo.proxies,(n,e)=>(y(),B("div",{key:e,class:"proxy-group"},[s.tunnelInfo.proxies.length>1?(y(),B("div",Be,"配置 #"+h(e+1),1)):D("",!0),a("div",_e,[a("div",Ie,[d(b(le)),v(" "+h(n.type.includes("xtcp")?"房间号":"隧道名称"),1)]),d(g,{content:n.proxyName,placement:"top","show-arrow":"","destroy-on-close":""},{default:p(()=>[a("div",{onClick:k=>b(F)(n.proxyName,!0,`${n.type.includes("xtcp")?"房间号":"隧道名称"}已复制！`),class:"value remote-addr pointer"},h(n.proxyName),9,Ce)]),_:2},1032,["content"])]),a("div",Se,[a("div",$e,[d(b(ce)),t[10]||(t[10]=v(" 协议类型",-1))]),a("div",Re,h(n.type.toUpperCase()),1)]),a("div",Te,[a("div",Ae,[d(b(P)),v(" "+h(n.type.includes("xtcp")?"房间密钥":"连接地址"),1)]),d(g,{content:n.remoteAddressMain,placement:"top","show-arrow":"","destroy-on-close":""},{default:p(()=>[a("div",{class:"value remote-addr pointer",onClick:k=>b(F)(n.remoteAddressMain,!0,`${n.type.includes("xtcp")?"房间密钥":"连接地址"}已复制！`)},h(n.remoteAddressMain||"获取中..."),9,Ee)]),_:2},1032,["content"])]),n.remoteAddressBackup&&n.remoteAddressBackup!==n.remoteAddressMain?(y(),B("div",Fe,[a("div",Le,[d(b(P)),t[11]||(t[11]=v(" 备用地址",-1))]),d(g,{content:n.remoteAddressBackup,placement:"top","show-arrow":"","destroy-on-close":""},{default:p(()=>[a("div",{class:"value remote-addr pointer",onClick:k=>b(F)(n.remoteAddressBackup,!0,"备用连接地址已复制！")},h(n.remoteAddressBackup),9,Me)]),_:2},1032,["content"])])):D("",!0),a("div",Ue,[a("div",We,[d(b(V)),t[12]||(t[12]=v(" 本地地址",-1))]),a("div",Ne,h(n.localAddress),1)])]))),128)):(y(),B("div",De,[t[13]||(t[13]=a("div",{class:"label"},"状态",-1)),a("div",Pe,h(s.loading?"正在加载配置...":"暂无详细信息"),1)]))])]),_:1})])}}}),ze=L(Ve,[["__scopeId","data-v-33ba6ddd"]]),Ge={class:"console-page"},He={class:"layout-container"},Xe={class:"main-terminal-area"},Ye={class:"sidebar-area"},Je=M({__name:"index",setup(s){const f=de(),t=J(),r=C(parseInt(t.params.frpId)||0),u=C(!1),l=C(!1),g=C(null),n=C(null);async function e(){var i;if(r.value)try{g.value=await ue(r.value),u.value=g.value.isRunning,await f.getTunnels()}catch(m){console.error("获取隧道信息失败",m),(i=n.value)==null||i.writeln(`\x1B[1;31m[Error] 获取隧道信息失败: ${m}\x1B[0m`)}}const k=async()=>{var i,m;l.value=!0;try{(i=n.value)==null||i.writeln("\x1B[1;32m[System] 正在发送启动指令...\x1B[0m"),await z("start",r.value),u.value=!0,$.success("启动指令已发送"),setTimeout(e,1500)}catch(S){(m=n.value)==null||m.writeln(`\x1B[1;31m[Error] Frpc启动失败: ${S.message}\x1B[0m`)}finally{l.value=!1}},_=async()=>{var i,m;l.value=!0;try{(i=n.value)==null||i.writeln("\x1B[1;32m[System] 正在发送停止指令...\x1B[0m"),await z("stop",r.value),u.value=!1,$.warning("停止指令已发送"),setTimeout(e,1e3)}catch(S){(m=n.value)==null||m.writeln(`\x1B[1;31m[Error] Frpc停止失败: ${S.message}\x1B[0m`)}finally{l.value=!1}},I=()=>{var i;(i=n.value)==null||i.clear()};return H(()=>t.params.frpId,async i=>{t.name==="FrpConsole"&&i&&(r.value=parseInt(i),await e())}),X(()=>{r.value&&e()}),(i,m)=>(y(),B("div",Ge,[a("div",He,[a("div",Xe,[d(ge,{ref_key:"terminalRef",ref:n,"frp-id":r.value,onUpdate:m[0]||(m[0]=S=>e())},null,8,["frp-id"])]),a("div",Ye,[d(ze,{"frp-id":r.value,"is-running":u.value,loading:l.value,"tunnel-info":g.value,onStart:k,onStop:_,onClearLog:I},null,8,["frp-id","is-running","loading","tunnel-info"])])])]))}}),Dt=L(Je,[["__scopeId","data-v-ab9e6eca"]]);export{Dt as default};
