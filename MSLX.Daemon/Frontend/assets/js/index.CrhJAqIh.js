import{u as J,_ as I,F as Z,G as ee,H as X}from"./index.CqgA5JBs.js";import{a as $,b as Q}from"./user.BaN6mxS-.js";import{z as te,aK as ae,aa as oe,aL as le,B as se,f as ne,U as re,ad as ie,ag as de,a3 as ue,aM as me,a1 as T}from"./tdesign-icons-vue-next.B3wvPiG1.js";import{M as h,D as j}from"./tdesign-vue-next.B9R1AJJu.js";import{D as A,F as k,W as N,P as pe,b0 as l,b1 as L,aY as P,b2 as t,a$ as b,G as e,ao as S,b5 as K,aX as z,b6 as H,ap as r,O as ce,R as fe}from"./index.BbdIPky0.js";import"./pinia.DE9DXmFR.js";import"./pinia-plugin-persistedstate.n2tMOXAx.js";import"./vue-router.CTuarHf7.js";import"./tvision-color.BU_YHHaJ.js";import"./chroma-js.Cmk4elvR.js";import"./bezier-easing.jp9ayU57.js";import"./lodash.B5_zCkFd.js";import"./axios.R-lXtGyY.js";import"./qs.pfv2Cuas.js";import"./side-channel.B7VpeXu7.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.CD-SYzlK.js";import"./cron-parser.BqMfRICj.js";import"./luxon.BVaPVz1w.js";import"./side-channel-list.CQN2BsdT.js";import"./side-channel-map.mJjiYxsE.js";import"./get-intrinsic.DZF4l_-S.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.GRuZvLsk.js";import"./dunder-proto.BfGlLUzx.js";import"./call-bind-apply-helpers.DPbVMkjK.js";import"./function-bind.CHqF18-c.js";import"./hasown.B1sN64jK.js";import"./call-bound.DTRAK3sj.js";import"./side-channel-weakmap.C4d6frlU.js";import"./nprogress.CMq2Rk2a.js";import"./core-js-pure.DghWRT_o.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./lodash-es.ClUTdtmA.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";const _e={class:"profile-header"},ge={class:"avatar-col"},ye={class:"info-col"},be={class:"main-row"},we={class:"nickname"},ve={class:"sub-row"},Ve={class:"username"},he={key:0,class:"last-login"},Pe=A({__name:"UserProfileCard",setup(F,{expose:i}){const v=J(),_=k(!1),o=k(!1),n=k(!1),w=k(""),f=k(""),c=k("qq"),s=N({id:"",username:"",name:"",avatar:"",role:"",apiKey:"",lastLoginTime:""}),d=N({changePassword:!1,newPassword:"",confirmPassword:""}),y=async()=>{_.value=!0;try{const p=await $();Object.assign(s,p),w.value=p.username;const a=p.avatar&&p.avatar.match(/nk=(\d+)/);a&&a[1]?(c.value="qq",f.value=a[1]):c.value="custom"}catch(p){h.error(p.message||"用户加载失败")}finally{_.value=!1}};pe(f,p=>{c.value==="qq"&&p&&(s.avatar=`https://q.qlogo.cn/g?b=qq&nk=${p}&s=640`)});const u=p=>{p==="qq"&&f.value&&(s.avatar=`https://q.qlogo.cn/g?b=qq&nk=${f.value}&s=640`)},q=()=>{s.apiKey&&navigator.clipboard.writeText(s.apiKey).then(()=>{h.success("API Key 已复制")})},B=()=>{const p=j.confirm({header:"重置 API 密钥",theme:"warning",body:"重置后，所有使用旧 Key 的外部工具将立即失效，确定要继续吗？",onConfirm:async()=>{try{p.hide(),await Q({resetApiKey:!0}),h.success("API Key 重置成功");const a=await $();s.apiKey=a.apiKey}catch(a){h.error(a.message||"重置失败")}}})},m=async()=>{if(d.changePassword){if(!d.newPassword){h.warning("请输入新密码");return}if(d.newPassword!==d.confirmPassword){h.error("两次输入的密码不一致");return}}const p=s.username!==w.value,a=d.changePassword&&!!d.newPassword;o.value=!0;try{const U={username:s.username,name:s.name,avatar:s.avatar,password:a?d.newPassword:void 0,resetApiKey:!1};await Q(U),d.changePassword=!1,d.newPassword="",d.confirmPassword="",w.value=s.username,h.success("个人信息保存成功"),p||a?j.alert({header:"重新登录",body:"账号或密码已变更，请重新登录以生效。",confirmBtn:"去登录",onConfirm:async()=>{await v.logout(),window.location.reload()}}):await v.getUserInfo()}catch(U){h.error(U.message)}finally{o.value=!1}};return i({initData:y}),(p,a)=>{const U=l("t-avatar"),M=l("t-tag"),D=l("t-divider"),O=l("t-radio-button"),R=l("t-radio-group"),x=l("t-input"),V=l("t-space"),C=l("t-form-item"),W=l("t-button"),G=l("t-switch"),E=l("t-form"),Y=l("t-card");return P(),L(Y,{bordered:!1,loading:_.value,class:"settings-card"},{default:t(()=>[b("div",_e,[b("div",ge,[e(U,{image:s.avatar,size:"80px",shape:"circle",class:"user-avatar-shadow"},{default:t(()=>[S(K(s.name?s.name.slice(0,1).toUpperCase():"U"),1)]),_:1},8,["image"])]),b("div",ye,[b("div",be,[b("span",we,K(s.name||"未设置昵称"),1),s.role==="admin"?(P(),L(M,{key:0,theme:"success",variant:"light",size:"small",shape:"round"},{default:t(()=>[...a[8]||(a[8]=[S("管理员",-1)])]),_:1})):(P(),L(M,{key:1,theme:"primary",variant:"light",size:"small",shape:"round"},{default:t(()=>[...a[9]||(a[9]=[S("普通用户",-1)])]),_:1}))]),b("div",ve,[b("span",Ve,"@"+K(s.username),1),s.lastLoginTime?(P(),z("span",he,[e(r(te)),S(" "+K(new Date(s.lastLoginTime).toLocaleString()),1)])):H("",!0)])])]),e(D),e(E,{ref:"userForm",data:s,"label-width":100,"label-align":"left",onSubmit:m},{default:t(()=>[e(C,{label:"头像设置"},{default:t(()=>[e(V,{direction:"vertical",style:{width:"100%"}},{default:t(()=>[e(R,{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=g=>c.value=g),variant:"default-filled",onChange:u},{default:t(()=>[e(O,{value:"qq"},{default:t(()=>[e(r(ae)),a[10]||(a[10]=S(" QQ头像",-1))]),_:1}),e(O,{value:"custom"},{default:t(()=>[e(r(oe)),a[11]||(a[11]=S(" 链接",-1))]),_:1})]),_:1},8,["modelValue"]),c.value==="qq"?(P(),L(x,{key:0,modelValue:f.value,"onUpdate:modelValue":a[1]||(a[1]=g=>f.value=g),placeholder:"输入QQ号自动获取",type:"number"},{"prefix-icon":t(()=>[e(r(le))]),_:1},8,["modelValue"])):(P(),L(x,{key:1,modelValue:s.avatar,"onUpdate:modelValue":a[2]||(a[2]=g=>s.avatar=g),placeholder:"输入图片 URL 链接"},{"prefix-icon":t(()=>[e(r(se))]),_:1},8,["modelValue"]))]),_:1})]),_:1}),e(C,{label:"用户昵称",name:"name"},{default:t(()=>[e(x,{modelValue:s.name,"onUpdate:modelValue":a[3]||(a[3]=g=>s.name=g),placeholder:"显示的名称"},null,8,["modelValue"])]),_:1}),e(C,{label:"登录账号",name:"username"},{default:t(()=>[e(x,{modelValue:s.username,"onUpdate:modelValue":a[4]||(a[4]=g=>s.username=g),placeholder:"登录唯一标识"},null,8,["modelValue"])]),_:1}),e(C,{label:"API Key",help:"用于第三方工具连接的凭证，请妥善保管"},{default:t(()=>[e(x,{value:s.apiKey,type:n.value?"text":"password",readonly:"",placeholder:"点击重置生成 Key"},{suffix:t(()=>[e(W,{variant:"text",size:"small",onClick:q},{icon:t(()=>[e(r(ne))]),_:1}),e(W,{variant:"text",theme:"danger",size:"small",onClick:B},{icon:t(()=>[e(r(re))]),_:1})]),_:1},8,["value","type"])]),_:1}),e(D,{dashed:""}),e(C,{label:"修改密码"},{default:t(()=>[e(G,{modelValue:d.changePassword,"onUpdate:modelValue":a[5]||(a[5]=g=>d.changePassword=g)},null,8,["modelValue"])]),_:1}),d.changePassword?(P(),z(ce,{key:0},[e(C,{label:"新密码","required-mark":""},{default:t(()=>[e(x,{modelValue:d.newPassword,"onUpdate:modelValue":a[6]||(a[6]=g=>d.newPassword=g),type:"password",placeholder:"请输入新密码"},{"prefix-icon":t(()=>[e(r(ie))]),_:1},8,["modelValue"])]),_:1}),e(C,{label:"确认密码","required-mark":""},{default:t(()=>[e(x,{modelValue:d.confirmPassword,"onUpdate:modelValue":a[7]||(a[7]=g=>d.confirmPassword=g),type:"password",placeholder:"请再次输入新密码"},{"prefix-icon":t(()=>[e(r(de))]),_:1},8,["modelValue"])]),_:1})],64)):H("",!0),e(C,null,{default:t(()=>[e(W,{theme:"primary",type:"submit",loading:o.value,block:"",class:"action-btn"},{default:t(()=>[...a[12]||(a[12]=[S(" 保存个人资料 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["data"])]),_:1},8,["loading"])}}}),Se=I(Pe,[["__scopeId","data-v-5a4f930e"]]),ke={class:"status-label"},xe=A({__name:"SystemSettingsCard",emits:["refresh"],setup(F,{expose:i,emit:v}){const _=k(!1),o=k(!1),n=N({fireWallBanLocalAddr:!1,openWebConsoleOnLaunch:!0,neoForgeInstallerMirrors:"MSL Mirrors",listenHost:"localhost",listenPort:1027}),w=[{label:"官方源 (较慢)",value:"Official"},{label:"MSL镜像源 (推荐)",value:"MSL Mirrors"},{label:"MSL镜像源 - 备用",value:"MSL Mirrors Backup"}],f=v,c=async()=>{_.value=!0;try{const y=await Z();Object.assign(n,y)}catch(y){h.error(y.message||"系统设置加载失败")}finally{_.value=!1}},s=async()=>{o.value=!0;try{await ee(n),h.success("系统设置保存成功")}catch(y){h.error(y.message)}finally{o.value=!1}},d=()=>{c(),f("refresh")};return i({initData:c}),(y,u)=>{const q=l("t-button"),B=l("t-switch"),m=l("t-form-item"),p=l("t-select"),a=l("t-divider"),U=l("t-space"),M=l("t-input"),D=l("t-col"),O=l("t-row"),R=l("t-form"),x=l("t-card");return P(),L(x,{bordered:!1,title:"系统偏好设置",loading:_.value,class:"settings-card"},{actions:t(()=>[e(q,{theme:"primary",variant:"text",size:"small",onClick:d},{default:t(()=>[...u[5]||(u[5]=[S("刷新数据",-1)])]),_:1})]),default:t(()=>[e(R,{ref:"sysForm",data:n,"label-width":120,"label-align":"left",onSubmit:s},{default:t(()=>[u[8]||(u[8]=b("div",{class:"group-title"},"守护进程",-1)),e(m,{label:"自动打开控制台",help:"MSLX 守护进程启动成功后，是否自动登录网页端控制台。"},{default:t(()=>[e(B,{modelValue:n.openWebConsoleOnLaunch,"onUpdate:modelValue":u[0]||(u[0]=V=>n.openWebConsoleOnLaunch=V)},null,8,["modelValue"])]),_:1}),e(m,{label:"安装镜像源",help:"选择在自动安装 NeoForge / Forge 时所使用的镜像源。",style:{"margin-top":"6px"}},{default:t(()=>[e(p,{modelValue:n.neoForgeInstallerMirrors,"onUpdate:modelValue":u[1]||(u[1]=V=>n.neoForgeInstallerMirrors=V),options:w},null,8,["modelValue"])]),_:1}),e(a,{dashed:""}),u[9]||(u[9]=b("div",{class:"group-title"},"网络与安全",-1)),e(m,{label:"禁止本地访问",help:"开启后将禁止本地回环地址访问，增强安全性。"},{default:t(()=>[e(U,{align:"center"},{default:t(()=>[e(B,{modelValue:n.fireWallBanLocalAddr,"onUpdate:modelValue":u[2]||(u[2]=V=>n.fireWallBanLocalAddr=V)},null,8,["modelValue"]),b("span",ke,K(n.fireWallBanLocalAddr?"已开启":"已关闭"),1)]),_:1})]),_:1}),e(m,{label:"监听地址设置",help:"设置MSLX守护进程的监听地址。(需要重启守护进程生效,若不明白这是干什么的请一定不要修改！)",style:{"margin-top":"6px"}},{default:t(()=>[e(O,{gutter:16,style:{width:"100%"}},{default:t(()=>[e(D,{span:6},{default:t(()=>[e(M,{modelValue:n.listenHost,"onUpdate:modelValue":u[3]||(u[3]=V=>n.listenHost=V),placeholder:"localhost"},{"prefix-icon":t(()=>[e(r(ue))]),_:1},8,["modelValue"])]),_:1}),e(D,{span:4,style:{display:"flex","align-items":"center"}},{default:t(()=>[u[6]||(u[6]=b("span",{style:{"margin-right":"8px",color:"var(--td-text-color-secondary)"}},":",-1)),e(M,{modelValue:n.listenPort,"onUpdate:modelValue":u[4]||(u[4]=V=>n.listenPort=V),placeholder:"1027",style:{width:"120px"}},{"prefix-icon":t(()=>[e(r(me))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(m,null,{default:t(()=>[e(q,{theme:"primary",type:"submit",loading:o.value,block:"",class:"action-btn"},{default:t(()=>[...u[7]||(u[7]=[S(" 保存系统设置 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["data"])]),_:1},8,["loading"])}}}),Ce=I(xe,[["__scopeId","data-v-2ba6686a"]]),Ue=A({__name:"WebPanelStyleCard",setup(F){const i=X(),v=async(_,o)=>{var f;const n=((f=_[0])==null?void 0:f.raw)||_.raw;if(!n)return;const w=await i.uploadImage(n);w&&(i.settings[o]=w)};return(_,o)=>{const n=l("t-button"),w=l("t-upload"),f=l("t-input"),c=l("t-form-item"),s=l("t-divider"),d=l("t-slider"),y=l("t-col"),u=l("t-row"),q=l("t-form"),B=l("t-card");return P(),L(B,{bordered:!1,title:"面板自定义样式",description:"这里设置的样式需要在面板左上角的样式面板中启用背景美化才会生效哦！",loading:r(i).loading,class:"settings-card"},{default:t(()=>[e(q,{data:r(i).settings,"label-width":120,"label-align":"left",onSubmit:r(i).saveSettings},{default:t(()=>[o[9]||(o[9]=b("div",{class:"group-title"},"背景图片设置",-1)),e(c,{label:"浅色背景",help:"留空则使用默认的背景图哦～"},{default:t(()=>[e(f,{modelValue:r(i).settings.webPanelStyleLightBackground,"onUpdate:modelValue":o[1]||(o[1]=m=>r(i).settings.webPanelStyleLightBackground=m),placeholder:"输入完整URL地址或者在右边上传图片"},{suffix:t(()=>[e(w,{theme:"custom",action:"","auto-upload":!1,"show-file-list":!1,accept:"image/png, image/jpeg, image/webp",onChange:o[0]||(o[0]=m=>v(m,"webPanelStyleLightBackground"))},{default:t(()=>[e(n,{variant:"text",shape:"square"},{default:t(()=>[e(r(T))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"深色背景"},{default:t(()=>[e(f,{modelValue:r(i).settings.webPanelStyleNightBackground,"onUpdate:modelValue":o[3]||(o[3]=m=>r(i).settings.webPanelStyleNightBackground=m),placeholder:"输入完整URL地址或者在右边上传图片"},{suffix:t(()=>[e(w,{theme:"custom","auto-upload":!1,"show-file-list":!1,accept:"image/png, image/jpeg, image/webp",onChange:o[2]||(o[2]=(m,p)=>v(p,"webPanelStyleNightBackground"))},{default:t(()=>[e(n,{variant:"text",shape:"square"},{default:t(()=>[e(r(T))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(s,{dashed:""}),o[10]||(o[10]=b("div",{class:"group-title"},"透明度调整 (0.1 - 1.0)",-1)),e(u,{gutter:[32,16]},{default:t(()=>[e(y,{span:6},{default:t(()=>[e(c,{label:"浅色背景透明度"},{default:t(()=>[e(d,{modelValue:r(i).settings.webPanelStyleLightBackgroundOpacity,"onUpdate:modelValue":o[4]||(o[4]=m=>r(i).settings.webPanelStyleLightBackgroundOpacity=m),min:.1,max:1,step:.01},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{span:6},{default:t(()=>[e(c,{label:"浅色组件透明度"},{default:t(()=>[e(d,{modelValue:r(i).settings.webPanelStyleLightComponentsOpacity,"onUpdate:modelValue":o[5]||(o[5]=m=>r(i).settings.webPanelStyleLightComponentsOpacity=m),min:.1,max:1,step:.01},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{span:6},{default:t(()=>[e(c,{label:"深色背景透明度"},{default:t(()=>[e(d,{modelValue:r(i).settings.webPanelStyleDarkBackgroundOpacity,"onUpdate:modelValue":o[6]||(o[6]=m=>r(i).settings.webPanelStyleDarkBackgroundOpacity=m),min:.1,max:1,step:.01},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{span:6},{default:t(()=>[e(c,{label:"深色组件透明度"},{default:t(()=>[e(d,{modelValue:r(i).settings.webPanelStyleDarkComponentsOpacity,"onUpdate:modelValue":o[7]||(o[7]=m=>r(i).settings.webPanelStyleDarkComponentsOpacity=m),min:.1,max:1,step:.01},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{style:{"margin-top":"24px"}},{default:t(()=>[e(n,{theme:"primary",type:"submit",loading:r(i).submitLoading,block:"",class:"action-btn"},{default:t(()=>[...o[8]||(o[8]=[S(" 应用样式设置 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["data","onSubmit"])]),_:1},8,["loading"])}}}),Le=I(Ue,[["__scopeId","data-v-bc74a0b8"]]),qe={class:"settings-page"},Be=A({__name:"index",setup(F){const i=X(),v=k(),_=k(),o=async()=>{const n=[];v.value&&n.push(v.value.initData()),_.value&&n.push(_.value.initData()),n.push(i.fetchSettings()),await Promise.all(n)};return fe(()=>{o()}),(n,w)=>{const f=l("t-space");return P(),z("div",qe,[e(f,{direction:"vertical",size:"large",style:{width:"100%"}},{default:t(()=>[e(Se,{ref_key:"userCardRef",ref:v},null,512),e(Ce,{ref_key:"sysCardRef",ref:_,onRefresh:o},null,512),e(Le)]),_:1})])}}}),vt=I(Be,[["__scopeId","data-v-51250a07"]]);export{vt as default};
