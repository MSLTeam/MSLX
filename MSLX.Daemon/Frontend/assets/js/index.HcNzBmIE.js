import{a as be}from"./vue-router.CTuarHf7.js";import{F as y,bb as Te,be as ze,D as se,P as Q,R as ce,V as xe,aa as Ce,aX as L,a$ as e,b5 as O,ak as rt,bd as ut,bk as dt,bi as ct,bj as vt,aY as v,K as te,G as t,b0 as M,b2 as l,b6 as F,aZ as ye,b1 as J,ap as B,O as re,ao as m,b3 as de,am as Fe,b4 as Ge}from"./index.BbdIPky0.js";import{c as G}from"./ansi-colors.gpWjHU8Z.js";import{d as mt}from"./pinia.DE9DXmFR.js";import{u as Je,_ as ne,f as pt,i as ft,g as gt,h as bt,k as yt,s as _t,l as kt,m as ht,r as Ve,c as je}from"./index.Dh86awbc.js";import{g as wt,b as $t,u as xt,c as Ct,d as we}from"./instance.Yptueto-.js";import{S as Vt,g as St,a as Ut}from"./localJava.B5otYkXM.js";import{M as H,N as Mt,D as Ie}from"./tdesign-vue-next.DWJvSscW.js";import{ae as Rt,a3 as It,af as Ee,ag as Pe,a1 as Bt,U as Se,y as Lt,_ as Xe,a4 as We,ah as Et,ai as Ke,aj as Pt,z as Ue,ak as At,g as Ot,c as Dt,al as Nt,a9 as qe,aa as He,ad as Tt,M as Ye,am as zt,an as Ft,ao as Ae,ap as Re,aq as Gt,ar as Oe,a7 as Jt,as as jt,at as Xt,au as Wt,av as Kt,aw as qt,ax as Ht,ay as Yt}from"./tdesign-icons-vue-next.Q06Erwsy.js";import{F as Zt}from"./FileUploader.D7DKgb94.js";import{d as Qt}from"./cron-parser.BqMfRICj.js";import{D as ea}from"./docs.CxArFray.js";import{i as De}from"./echarts.J8iroDPP.js";import{V as ta}from"./zrender.B_NAtvFA.js";import"./core-js-pure.DghWRT_o.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./pinia-plugin-persistedstate.n2tMOXAx.js";import"./tvision-color.BU_YHHaJ.js";import"./chroma-js.Cmk4elvR.js";import"./bezier-easing.jp9ayU57.js";import"./lodash.B5_zCkFd.js";import"./axios.R-lXtGyY.js";import"./qs.CnepGyXr.js";import"./side-channel.Bf-JVZLg.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.CD-SYzlK.js";import"./side-channel-list.CQN2BsdT.js";import"./side-channel-map.BJ69Knz3.js";import"./get-intrinsic.CAdfHqt8.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.Cbri-GHQ.js";import"./dunder-proto.q7lw_6_J.js";import"./call-bind-apply-helpers.BxcZtPLH.js";import"./function-bind.BbkWVFrm.js";import"./hasown.ckq0ukzO.js";import"./call-bound.BO70H6sD.js";import"./side-channel-weakmap.BkoVKe_V.js";import"./nprogress.CMq2Rk2a.js";import"./lodash-es.ClUTdtmA.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";import"./luxon.BVaPVz1w.js";import"./tslib.BDyQ-Jie.js";const Be=mt("instanceHub",()=>{const n=Je(),p=y(null),$=y(!1),f=y(null),C=y(0),w=y(0);let x=Promise.resolve();const E=y({cpu:0,memBytes:0,memPercent:0}),i=new Set,s=new Set,g=new Set,z=r=>{w.value=r},A=r=>(x=x.then(async()=>{var U;if(C.value++,((U=p.value)==null?void 0:U.state)==="Connected"&&f.value===r)return;p.value&&await T(),f.value=r,w.value=0;const{baseUrl:u,token:h}=n,I=new URL("/api/hubs/instanceControlHub",u||window.location.origin);h&&I.searchParams.append("x-user-token",h);const o=new Te().withUrl(I.toString(),{withCredentials:!1}).configureLogging(ze.Warning).withAutomaticReconnect([0,2e3,5e3,1e4]).build();o.on("ReceiveLog",D=>{i.forEach(j=>j(D))}),o.on("RequireEULA",()=>{s.forEach(D=>D())}),o.on("CommandResult",(D,j)=>{g.forEach(X=>X(D,j))}),o.on("ReceiveStatus",(D,j,X)=>{if(String(D)!==String(r))return;let P=0;if(w.value>0){const N=w.value*1024*1024;P=X/N*100,P>100&&(P=100)}E.value={cpu:j,memBytes:X,memPercent:P}}),o.onreconnecting(()=>i.forEach(D=>D("\x1B[1;31m[System] 连接中断，尝试重连...\x1B[0m"))),o.onreconnected(async()=>{i.forEach(D=>D("\x1B[1;32m[System] 网络恢复，重新加入会话...\x1B[0m"));try{await o.invoke("JoinGroup",r)}catch(D){console.error(D)}});try{await o.start(),await o.invoke("JoinGroup",r),p.value=o,$.value=!0,i.forEach(D=>D("\x1B[1;32m[System] 已连接到实例控制服务\x1B[0m"))}catch(D){$.value=!1,i.forEach(j=>j(`\x1B[1;31m[Error] 连接失败: ${D.message}\x1B[0m`)),f.value=null,p.value=null}}),x),d=()=>(x=x.then(async()=>{C.value>0&&C.value--,C.value===0&&await T()}),x),T=async()=>{if(p.value)try{p.value.state==="Connected"&&f.value&&await p.value.invoke("LeaveGroup",f.value),await p.value.stop()}catch(r){console.warn(r)}p.value=null,$.value=!1,f.value=null,w.value=0,E.value={cpu:0,memBytes:0,memPercent:0}};return{isConnected:$,stats:E,currentServerId:f,connect:A,disconnect:d,setMaxMemory:z,sendCommand:async r=>{if(!p.value||p.value.state!=="Connected"||!f.value)throw new Error("未连接到服务");await p.value.invoke("SendCommand",f.value,r)},onLog:r=>(i.add(r),()=>i.delete(r)),onEula:r=>(s.add(r),()=>i.delete(r)),onCommandResult:r=>(g.add(r),()=>g.delete(r))}});G.enabled=!0;const aa=n=>n?(n.includes("Done")&&n.includes("!")&&(n=n.replace(/Done \((.*?)\)!/g,(p,$)=>`${G.green.bold("Done")} (${G.blue($)})!`)),n.startsWith("[System]")&&(n=n.replace(/^\[System\]/,`[${G.blue.bold("System")}]`)),n.includes("[MSLX]")&&(n=n.replace(/\[MSLX\]/g,`[${G.magenta.bold("MSLX")}]`)),n.includes("[MSLX-Backup]")&&(n=n.replace(/\[MSLX-Backup\]/g,`[${G.magenta.bold("MSLX-Backup")}]`)),n.startsWith(">>>")&&(n=n.replace(/^>>>/,G.red.bold(">>>"))),n=n.replace(/^\[(\d{2}:\d{2}:\d{2})\s+(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]:/,(p,$,f)=>{let C=f;switch(f){case"INFO":C=G.green("INFO");break;case"WARN":case"WARNING":C=G.magenta.bold("WARN");break;case"ERROR":case"FATAL":C=G.red.bold(f);break;case"DEBUG":C=G.blue("DEBUG");break}return`[${G.gray($)} ${C}]:`}),/^\[\d{2}:\d{2}:\d{2}\]/.test(n)&&(n=n.replace(/^\[(\d{2}:\d{2}:\d{2})\]/,(p,$)=>`[${G.gray($)}]`)),n=n.replace(/\[([^/]+)\/(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]/g,(p,$,f)=>{const C=G.blue($);let w=f;switch(f){case"INFO":w=G.green("INFO");break;case"WARN":w=G.magenta("WARN");break;case"ERROR":w=G.red.bold("ERROR");break}return`[${C}/${w}]`}),n=n.replace(new RegExp("(?<=:\\s|^)\\s*\\[([a-zA-Z0-9_\\-.\\s]+)\\](?=\\s)","g"),(p,$)=>$==="System"||$.includes("MSLX")?p:` [${G.bold.black($)}]`),n=n.replace(/(https?:\/\/[^\s]+)/g,p=>G.blue.underline(p)),n=n.replace(/\b\d+\.\d+(\.\d+)?(-[a-zA-Z0-9]+)?\b/g,p=>G.magenta(p)),n=n.replace(/\b\d+(\.\d+)?\s?(ms|s|%|MB|GB|KB)\b/gi,p=>G.blue(p)),n=n.replace(new RegExp("(\\u001b\\[[\\d;]*m)|((?<!\\d:\\d)\\b\\d+\\b(?!\\s*:\\s*\\d))","g"),(p,$,f)=>{if($)return p;if(f){if(f.length>=4&&f.length<=6)return G.blue(f);if(f.length<=3)return G.blue(f)}return p}),n=n.replace(/(\*:\d{1,5})/,p=>G.blue.bold(p)),n=n.replace(/\b(Loaded|Saved|Starting|Started|Connected)\b/g,p=>G.green(p)),n=n.replace(/\bDone\b(?!\u001b)/g,G.green.bold("Done")),n=n.replace(/\b(Failed|Exception|Error|Caused by|Stopping|Closed)\b/g,p=>G.red.bold(p)),n=n.replace(/\b(Loading|Preparing|Generating|Saving|Using|Running)\b/g,p=>G.magenta(p)),n=n.replace(/\b(Minecraft|Paper|Velocity|Java)\b/gi,p=>G.bold.black(p)),n=n.replace(/'minecraft:[a-z_]+'/g,p=>G.magenta(p)),n=n.replace(/\n/g,`\r
`),n):"",la={class:"terminal-header"},sa={class:"tab-title"},na={class:"terminal-footer"},oa=se({__name:"ServerTerminal",props:{serverId:{}},emits:["update"],setup(n,{expose:p,emit:$}){const f=n,C=$,w=Be(),x=y(null),E=y(null);let i=null,s=null,g=null,z=null,A=null,d=null,T="";const c=y(""),b={dark:{background:"transparent",foreground:"#cccccc",cursor:"#cccccc",selectionBackground:"#264f78",black:"#000000",red:"#cd3131",green:"#0dbc79",yellow:"#e5e510",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"},light:{background:"transparent",foreground:"#333333",cursor:"#333333",selectionBackground:"#add6ff",black:"#000000",red:"#cd3131",green:"#00bc79",yellow:"#9d9d10",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"}};G.enabled=!0;const _=P=>aa(P),k=()=>{if(!E.value||!x.value)return;if(i){i.clear(),o();return}const P=document.documentElement.getAttribute("theme-mode")==="dark";i=new ct.Terminal({cursorBlink:!0,cursorStyle:"block",fontSize:13,fontFamily:'Menlo, Monaco, "Courier New", monospace',lineHeight:1.4,theme:P?b.dark:b.light,disableStdin:!1,convertEol:!0,allowTransparency:!0}),s=new vt.FitAddon,i.loadAddon(s),i.open(E.value),i.onData(Z=>r(Z));const N=()=>{if(E.value&&E.value.clientWidth>0&&E.value.clientHeight>0)try{s==null||s.fit()}catch(Z){console.warn(Z)}};g=new ResizeObserver(()=>window.requestAnimationFrame(N)),g.observe(x.value),setTimeout(N,100),o()},r=async P=>{!i||!f.serverId||(P==="\r"?(i.write(`\r
`),T.trim()&&await h(T),T=""):P===""?T.length>0&&(T=T.slice(0,-1),i.write("\b \b")):P>=" "&&(T+=P,i.write(P)))},u=async()=>{if(!c.value)return;const P=c.value;i==null||i.writeln(P),await h(P),c.value=""},h=async P=>{try{await w.sendCommand(P)}catch(N){i==null||i.writeln(`\x1B[1;31m[Error] ${N.message}\x1B[0m`)}},I=()=>{if(!i)return;const P=document.documentElement.getAttribute("theme-mode")==="dark";i.options.theme=P?b.dark:b.light},o=()=>{i==null||i.writeln("\x1B[1;34m[System]\x1B[0m 正在连接服务器控制台 ..."),i==null||i.writeln(`\x1B[1;34m[System]\x1B[0m 实例 ID: ${f.serverId}`),i==null||i.writeln("")},U=async()=>{f.serverId&&(A&&A(),A=w.onLog(P=>{i&&i.writeln(_(P)),P.startsWith("[MSLX]")&&C("update")}),d&&d(),d=w.onCommandResult((P,N)=>{P||i==null||i.writeln(`\x1B[1;31m[System] 指令执行反馈: ${N}\x1B[0m`)}),await w.connect(f.serverId))},D=async()=>{A&&A(),d&&d(),await w.disconnect()};return p({writeln:P=>i==null?void 0:i.writeln(P),clear:()=>{i==null||i.clear(),o()}}),Q(()=>f.serverId,async(P,N)=>{P!==N&&(await D(),k(),await U())}),ce(async()=>{await xe(),k(),z=new MutationObserver(I),z.observe(document.documentElement,{attributes:!0,attributeFilter:["theme-mode"]}),await U()}),Ce(async()=>{z==null||z.disconnect(),g==null||g.disconnect(),i==null||i.dispose(),await D()}),(P,N)=>(v(),L("div",{ref_key:"terminalWrapper",ref:x,class:"terminal-wrapper"},[e("div",la,[N[1]||(N[1]=e("div",{class:"dots"},[e("span",{class:"dot red"}),e("span",{class:"dot yellow"}),e("span",{class:"dot green"})],-1)),e("div",sa,"MSLX 服务端控制台 | #"+O(n.serverId),1)]),e("div",{ref_key:"terminalBody",ref:E,class:"terminal-body"},null,512),e("div",na,[rt(e("input",{"onUpdate:modelValue":N[0]||(N[0]=Z=>c.value=Z),class:"cmd-input",placeholder:"发送控制台指令...",onKeyup:dt(u,["enter"])},null,544),[[ut,c.value]]),e("button",{class:"send-btn",onClick:u},"发送")])],512))}}),ia=ne(oa,[["__scopeId","data-v-833db3ab"]]),ra={class:"settings-container"},ua={class:"setting-item"},da={class:"setting-control"},ca={class:"setting-item"},va={class:"setting-info"},ma={class:"desc"},pa={class:"setting-control"},fa={class:"setting-item"},ga={class:"setting-control"},ba={key:0,style:{"margin-top":"8px"}},ya={class:"setting-item"},_a={class:"setting-info"},ka={class:"title"},ha={class:"desc"},wa={class:"setting-control"},$a={class:"setting-item"},xa={class:"setting-control"},Ca={key:0,class:"core-tools-panel"},Va={key:0,class:"upload-progress"},Sa={class:"setting-item"},Ua={class:"setting-control flex-row"},Ma={class:"memory-input-group"},Ra={class:"memory-input-group"},Ia={class:"setting-item"},Ba={class:"setting-control flex-row"},La={class:"setting-info-desc-only"},Ea={style:{"font-size":"12px",color:"var(--td-text-color-placeholder)",cursor:"help"}},Pa={class:"setting-item"},Aa={class:"setting-control"},Oa={key:0,style:{"margin-top":"8px"}},Da={key:2,class:"setting-group-title"},Na={key:3,class:"setting-item"},Ta={class:"setting-control"},za={key:0,style:{"margin-top":"8px"}},Fa={class:"setting-item"},Ga={class:"setting-control"},Ja={key:4,class:"setting-item"},ja={class:"setting-control"},Xa={class:"setting-item"},Wa={class:"setting-control"},Ka={class:"setting-item"},qa={class:"setting-control"},Ha={class:"setting-item"},Ya={class:"setting-control flex-row"},Za={class:"setting-item"},Qa={class:"setting-control flex-row"},el={class:"form-actions"},tl={class:"progress-body"},al={id:"update-log-box",class:"log-box"},ll={class:"time"},sl={key:0,class:"dialog-actions"},nl=se({__name:"GeneralSettings",setup(n){const p=be(),$=Je(),f=te(()=>{const S=p.params.serverId;return S?parseInt(S):NaN}),C=y(null),w=y(!1),x=y(!1),E=y(!1),i=[{label:"UTF-8",value:"utf-8"},{label:"GBK",value:"gbk"}],s=y({id:f.value,name:"",base:"",java:"",core:"",minM:1024,maxM:4096,args:"",yggdrasilApiAddr:"",backupMaxCount:20,backupDelay:10,backupPath:"MSLX://Backup/Instance",autoRestart:!1,forceAutoRestart:!0,ignoreEula:!1,runOnStartup:!1,inputEncoding:"utf-8",outputEncoding:"utf-8",fileEncoding:"utf-8",coreUrl:"",coreSha256:"",coreFileKey:""}),g=y("MB"),z=y("MB"),A=[{label:"MB",value:"MB"},{label:"GB",value:"GB"}],d=te({get:()=>{if(g.value==="GB"){const S=s.value.minM/1024;return Math.round(S*100)/100}return s.value.minM},set:S=>{s.value.minM=g.value==="GB"?Math.round(S*1024):S}}),T=te({get:()=>{if(z.value==="GB"){const S=s.value.maxM/1024;return Math.round(S*100)/100}return s.value.maxM},set:S=>{s.value.maxM=z.value==="GB"?Math.round(S*1024):S}}),c=y("custom"),b=y([]),_=y([]),k=y(""),r=y(""),u=async(S=!1)=>{try{S&&H.info("正在扫描 Java 环境...");const a=await St($.userInfo.systemInfo.osType.toLowerCase().replace("os",""),$.userInfo.systemInfo.osArchitecture.toLowerCase());a&&Array.isArray(a)&&(b.value=a.map(K=>({label:`Java ${K} (在线)`,value:K})));const q=await Ut(S);_.value=q.map(K=>({label:`Java ${K.version} (${K.path})`,value:K.path})),S&&H.success("刷新成功")}catch(a){console.error(a)}};Q([c,k,r],([S,a,q])=>{S==="none"?s.value.java="none":S==="env"?s.value.java="java":S==="custom"||S==="local"?s.value.java=q:S==="online"&&(s.value.java=a?`MSLX://Java/${a}`:"")});const h=y("MSLX://Backup/Instance"),I=y("");Q([h,I],([S,a])=>{S==="custom"?s.value.backupPath=a:s.value.backupPath=S});const o=y(""),U=y(""),D=[{label:"官方/离线模式 (无)",value:"none"},{label:"MSL 统一身份验证 (MSL Skin)",value:"https://skin.mslmc.net/api/yggdrasil"},{label:"LittleSkin",value:"https://littleskin.cn/api/yggdrasil"},{label:"自定义服务器",value:"custom"}];Q([o,U],([S,a])=>{S==="none"?s.value.yggdrasilApiAddr="":S==="custom"?s.value.yggdrasilApiAddr=a:s.value.yggdrasilApiAddr=S});const j=y(!1),X=y(!1),P=y(null),N=y(!1),Z=y(0),W=y(""),oe=S=>{s.value.core=S.filename,s.value.coreUrl=S.url,s.value.coreSha256=S.sha256,s.value.coreFileKey="",j.value=!1,H.success(`已选择核心: ${S.filename}，保存后将自动下载`)},V=()=>{var S;return(S=P.value)==null?void 0:S.click()},ee=async S=>{var K;const a=S.target;if(!((K=a.files)!=null&&K.length))return;const q=a.files[0];if(s.value.coreFileKey)try{await pt(s.value.coreFileKey)}catch{console.error("删除上传失败")}W.value=q.name,N.value=!0,Z.value=0;try{const Y=(await ft()).uploadId,le=5*1024*1024,fe=Math.ceil(q.size/le);for(let ie=0;ie<fe;ie++){const Me=q.slice(ie*le,Math.min(q.size,(ie+1)*le));await gt(Y,ie,Me),Z.value=Math.floor((ie+1)/fe*100)}const ge=await bt(Y,fe);s.value.coreFileKey=ge.uploadId,s.value.core=q.name,s.value.coreUrl="",H.success("文件上传就绪，保存后生效"),j.value=!1}catch(ae){H.error(`上传失败: ${ae.message}`)}finally{N.value=!1,a.value=""}},Ze=()=>{E.value||Mt.warning({title:"风险操作",content:"修改实例路径会导致面板无法找到原有文件。请确保您已手动移动了文件，或您明确知道自己在做什么。",duration:5e3}),E.value=!E.value},ve=y(!1),me=y(0),_e=y([]),ue=y(null),Qe=te(()=>c.value==="none"?{name:[{required:!0,message:"服务器名称不能为空",trigger:"blur"}],base:[{required:!0,message:"基础路径不能为空",trigger:"blur"}],args:[{required:!0,message:"自定义模式必须填写启动命令",trigger:"blur"}]}:{name:[{required:!0,message:"服务器名称不能为空",trigger:"blur"}],base:[{required:!0,message:"基础路径不能为空",trigger:"blur"}],java:[{required:!0,message:"Java 环境不能为空",trigger:"change"}],core:[{required:!0,message:"核心文件名不能为空",trigger:"change"}],minM:[{required:!0,message:"必填",trigger:"blur"}],maxM:[{required:!0,message:"必填",trigger:"blur"}]}),pe=async()=>{if(f.value){w.value=!0;try{await u(),s.value.id=f.value;const S=await wt(f.value);if(s.value={...s.value,...S,coreUrl:"",coreFileKey:"",coreSha256:""},g.value=S.minM>0&&S.minM%1024===0?"GB":"MB",z.value=S.maxM>0&&S.maxM%1024===0?"GB":"MB",E.value=!1,S.java==="none")c.value="none";else if(S.java==="java")c.value="env";else if(S.java.startsWith("MSLX://Java/"))c.value="online",k.value=S.java.replace("MSLX://Java/","");else{const K=_.value.find(ae=>ae.value===S.java);c.value=K?"local":"custom",r.value=S.java}const a=S.backupPath;a==="MSLX://Backup/Instance"||a==="MSLX://Backup/Data"?h.value=a:(h.value="custom",I.value=a);const q=S.yggdrasilApiAddr;q?q==="https://skin.mslmc.net/api/yggdrasil"?o.value="https://skin.mslmc.net/api/yggdrasil":q==="https://littleskin.cn/api/yggdrasil"?o.value="https://littleskin.cn/api/yggdrasil":(o.value="custom",U.value=q):o.value="none"}catch(S){H.error("获取配置失败: "+S.message)}finally{w.value=!1}}};Q(()=>p.params.serverId,S=>{p.name==="InstanceConsole"&&S&&pe()}),ce(pe);const et=async()=>{var a,q;if(await((a=C.value)==null?void 0:a.validate())===!0&&!(c.value!=="none"&&(s.value.coreUrl||s.value.coreFileKey)&&!await new Promise(Y=>{const le=Ie.confirm({header:"确认变更核心文件?",body:"检测到您上传或选择了新的核心文件，这将覆盖服务器现有的部署。",theme:"warning",onConfirm:()=>{le.hide(),Y(!0)},onClose:()=>{le.hide(),Y(!1)}})}))){c.value==="none"&&(s.value.core="none",s.value.minM=1027,s.value.maxM=1102,s.value.java="none",s.value.coreUrl="",s.value.coreFileKey="",s.value.coreSha256=""),x.value=!0;try{const K=await $t(s.value);((q=K.data)==null?void 0:q.needListen)??K.needListen?tt():(H.success("配置已保存"),x.value=!1,pe())}catch(K){H.error(K.message||"保存失败"),x.value=!1}}},tt=async()=>{ve.value=!0,me.value=0,_e.value=[];const{baseUrl:S,token:a}=$,q=new URL("/api/hubs/updateProgressHub",S||window.location.origin);q.searchParams.append("x-user-token",a),ue.value=new Te().withUrl(q.toString(),{withCredentials:!1}).configureLogging(ze.None).build(),ue.value.on("UpdateStatus",(K,ae,Y)=>{_e.value.push({time:new Date().toLocaleTimeString(),msg:Y?`[错误] ${K}`:K}),xe(()=>{const le=document.getElementById("update-log-box");le&&(le.scrollTop=le.scrollHeight)}),ae>=0&&(me.value=Number(ae.toFixed(1))),ae===100&&(H.success("更新完成"),at(!0))});try{await ue.value.start(),await ue.value.invoke("JoinGroup",f.value.toString())}catch{_e.value.push({time:"-",msg:"连接失败"})}},at=(S=!1)=>{var a;(a=ue.value)==null||a.stop(),setTimeout(()=>{ve.value=!1,x.value=!1,S&&pe()},1e3)};return Ce(()=>{var S;(S=ue.value)==null||S.stop()}),(S,a)=>{const q=M("t-input"),K=M("t-button"),ae=M("t-tooltip"),Y=M("t-select"),le=M("t-textarea"),fe=M("t-alert"),ge=M("t-icon"),ie=M("t-col"),Me=M("t-row"),Le=M("t-progress"),lt=M("t-space"),ke=M("t-input-number"),he=M("t-switch"),st=M("t-form"),nt=M("t-loading"),ot=M("t-dialog");return v(),L("div",ra,[t(nt,{loading:w.value,"show-overlay":""},{default:l(()=>[t(st,{ref_key:"formRef",ref:C,data:s.value,rules:Qe.value,"label-width":"0",onSubmit:et},{default:l(()=>[a[53]||(a[53]=e("div",{class:"setting-group-title"},"基础设置",-1)),e("div",ua,[a[30]||(a[30]=e("div",{class:"setting-info"},[e("div",{class:"title"},"服务器名称"),e("div",{class:"desc"},"在面板列表中显示的别名，支持中文")],-1)),e("div",da,[t(q,{modelValue:s.value.name,"onUpdate:modelValue":a[0]||(a[0]=R=>s.value.name=R),placeholder:"请输入名称"},null,8,["modelValue"])])]),e("div",ca,[e("div",va,[a[31]||(a[31]=e("div",{class:"title"},"实例路径",-1)),e("div",ma,[e("span",{class:ye({"text-warning":E.value})},O(E.value?"警告：修改路径可能导致无法找到原文件":"服务器文件的物理存储路径，非必要请勿修改"),3)])]),e("div",pa,[t(q,{modelValue:s.value.base,"onUpdate:modelValue":a[1]||(a[1]=R=>s.value.base=R),disabled:!E.value},{suffix:l(()=>[t(ae,{content:E.value?"点击锁定":"点击解锁编辑 (慎重)"},{default:l(()=>[t(K,{variant:"text",shape:"square",onClick:Ze},{icon:l(()=>[E.value?(v(),J(B(Rt),{key:0,style:{color:"var(--td-warning-color)"}})):(v(),J(B(It),{key:1}))]),_:1})]),_:1},8,["content"])]),_:1},8,["modelValue","disabled"])])]),a[54]||(a[54]=e("div",{class:"setting-group-title"},"运行模式",-1)),e("div",fa,[a[32]||(a[32]=e("div",{class:"setting-info"},[e("div",{class:"title"},"启动方式"),e("div",{class:"desc"},"选择使用 Java 启动 Minecraft，或使用自定义命令启动其他程序 (如 Bedrock, Python 等)")],-1)),e("div",ga,[t(Y,{modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=R=>c.value=R),options:[{label:"MSLX 在线下载 (Java)",value:"online"},{label:"使用本地版本 (Java)",value:"local"},{label:"自定义路径 (Java)",value:"custom"},{label:"环境变量 (Java)",value:"env"},{label:"自定义命令 (无Java)",value:"none"}]},null,8,["modelValue"]),c.value!=="none"?(v(),L("div",ba,[c.value==="online"?(v(),J(Y,{key:0,modelValue:k.value,"onUpdate:modelValue":a[3]||(a[3]=R=>k.value=R),options:b.value,placeholder:"请选择版本",filterable:""},null,8,["modelValue","options"])):F("",!0),c.value==="local"?(v(),J(Y,{key:1,modelValue:r.value,"onUpdate:modelValue":a[4]||(a[4]=R=>r.value=R),options:_.value,placeholder:"选择已识别的 Java"},null,8,["modelValue","options"])):F("",!0),c.value==="custom"?(v(),J(q,{key:2,modelValue:r.value,"onUpdate:modelValue":a[5]||(a[5]=R=>r.value=R),placeholder:"输入 java 可执行文件完整路径"},null,8,["modelValue"])):F("",!0)])):F("",!0)])]),e("div",ya,[e("div",_a,[e("div",ka,O(c.value==="none"?"启动命令 (Command)":"启动参数 (JVM Args)"),1),e("div",ha,O(c.value==="none"?"完全自定义的启动命令。程序将直接执行此段内容，不依赖 Java 环境。":"传递给 Java 的启动参数，如 GC 策略 (例如 -XX:+UseG1GC)"),1)]),e("div",wa,[t(le,{modelValue:s.value.args,"onUpdate:modelValue":a[6]||(a[6]=R=>s.value.args=R),autosize:{minRows:2,maxRows:4},placeholder:c.value==="none"?"例如: ./bedrock_server_x64":"无特殊需求请留空"},null,8,["modelValue","placeholder"])])]),c.value!=="none"?(v(),L(re,{key:0},[a[36]||(a[36]=e("div",{class:"setting-group-title"},"核心管理",-1)),e("div",$a,[a[35]||(a[35]=e("div",{class:"setting-info"},[e("div",{class:"title"},"服务端核心文件"),e("div",{class:"desc"},[m(" 指定启动的 Jar 文件名。如果文件已存在于目录中，直接输入文件名即可。 "),e("br"),m("需要更新核心？点击下方“文件工具” ")])],-1)),e("div",xa,[t(q,{modelValue:s.value.core,"onUpdate:modelValue":a[8]||(a[8]=R=>s.value.core=R),placeholder:"例如 server.jar"},{suffix:l(()=>[t(K,{variant:"text",theme:"primary",size:"small",onClick:a[7]||(a[7]=R=>j.value=!j.value)},{default:l(()=>[m(O(j.value?"收起工具":"文件工具"),1)]),_:1})]),_:1},8,["modelValue"]),j.value?(v(),L("div",Ca,[t(lt,{direction:"vertical",style:{width:"100%"}},{default:l(()=>[t(fe,{theme:"info",message:"在此处操作会自动下载/上传文件，并填入上方的文件名。"}),t(Me,{gutter:12},{default:l(()=>[t(ie,{span:6},{default:l(()=>[t(K,{block:"",variant:"outline",onClick:a[9]||(a[9]=R=>X.value=!0)},{icon:l(()=>[t(ge,{name:"cloud-download"})]),default:l(()=>[a[33]||(a[33]=m(" 从版本库下载 ",-1))]),_:1})]),_:1}),t(ie,{span:6},{default:l(()=>[t(K,{block:"",variant:"outline",loading:N.value,onClick:V},{icon:l(()=>[t(ge,{name:"upload"})]),default:l(()=>[a[34]||(a[34]=m(" 上传本地文件 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1}),e("input",{ref_key:"uploadInputRef",ref:P,type:"file",accept:".jar",hidden:"",onChange:ee},null,544),N.value?(v(),L("div",Va,[e("span",null,"正在上传: "+O(W.value),1),t(Le,{theme:"line",percentage:Z.value},null,8,["percentage"])])):F("",!0)]),_:1})])):F("",!0)])])],64)):F("",!0),c.value!=="none"?(v(),L(re,{key:1},[a[39]||(a[39]=e("div",{class:"setting-group-title"},"资源限制",-1)),e("div",Sa,[a[38]||(a[38]=e("div",{class:"setting-info"},[e("div",{class:"title"},"内存分配"),e("div",{class:"desc"},"设置 Java 堆内存大小 (Xms / Xmx)")],-1)),e("div",Ua,[e("div",Ma,[t(ke,{modelValue:d.value,"onUpdate:modelValue":a[10]||(a[10]=R=>d.value=R),min:0,"decimal-places":g.value==="GB"?1:0,placeholder:"Xms",theme:"normal",class:"input-left"},null,8,["modelValue","decimal-places"]),t(Y,{modelValue:g.value,"onUpdate:modelValue":a[11]||(a[11]=R=>g.value=R),options:A,clearable:!1,class:"select-right"},null,8,["modelValue"])]),a[37]||(a[37]=e("span",{class:"separator"},"-",-1)),e("div",Ra,[t(ke,{modelValue:T.value,"onUpdate:modelValue":a[12]||(a[12]=R=>T.value=R),min:0,"decimal-places":z.value==="GB"?1:0,placeholder:"Xmx",theme:"normal",class:"input-left"},null,8,["modelValue","decimal-places"]),t(Y,{modelValue:z.value,"onUpdate:modelValue":a[13]||(a[13]=R=>z.value=R),options:A,clearable:!1,class:"select-right"},null,8,["modelValue"])])])])],64)):F("",!0),a[55]||(a[55]=e("div",{class:"setting-group-title"},"备份设置",-1)),e("div",Ia,[a[42]||(a[42]=e("div",{class:"setting-info"},[e("div",{class:"title"},"备份策略"),e("div",{class:"desc"},"设置自动备份保留的最大数量，以及触发备份的延迟时间")],-1)),e("div",Ba,[t(ke,{modelValue:s.value.backupMaxCount,"onUpdate:modelValue":a[14]||(a[14]=R=>s.value.backupMaxCount=R),min:1,max:100,placeholder:"保留份数",theme:"column",style:{width:"140px"},suffix:"份"},null,8,["modelValue"]),a[40]||(a[40]=e("span",{class:"separator"},"/",-1)),t(ke,{modelValue:s.value.backupDelay,"onUpdate:modelValue":a[15]||(a[15]=R=>s.value.backupDelay=R),min:0,placeholder:"延迟时间",theme:"column",style:{width:"140px"},suffix:"秒"},null,8,["modelValue"])]),e("div",La,[t(ae,{content:"MSLX 向服务器发送 save-all 指令后，会等待指定的秒数，确保数据完全写入硬盘后再开始打包备份。"},{default:l(()=>[e("span",Ea,[t(ge,{name:"help-circle"}),a[41]||(a[41]=m(" 什么是延迟时间？ ",-1))])]),_:1})])]),e("div",Pa,[a[43]||(a[43]=e("div",{class:"setting-info"},[e("div",{class:"title"},"备份存放路径"),e("div",{class:"desc"},"选择备份文件存储的位置。推荐存储在实例文件夹外部以免误删。")],-1)),e("div",Aa,[t(Y,{modelValue:h.value,"onUpdate:modelValue":a[16]||(a[16]=R=>h.value=R),options:[{label:"实例文件夹内 (Instance)",value:"MSLX://Backup/Instance"},{label:"全局数据目录 (Data)",value:"MSLX://Backup/Data"},{label:"自定义绝对路径",value:"custom"}]},null,8,["modelValue"]),h.value==="custom"?(v(),L("div",Oa,[t(q,{modelValue:I.value,"onUpdate:modelValue":a[17]||(a[17]=R=>I.value=R),placeholder:"输入备份存放的绝对路径"},null,8,["modelValue"])])):F("",!0)])]),c.value!=="none"?(v(),L("div",Da,"外置登录")):F("",!0),c.value!=="none"?(v(),L("div",Na,[a[44]||(a[44]=e("div",{class:"setting-info"},[e("div",{class:"title"},"Yggdrasil API"),e("div",{class:"desc"},"选择认证服务器。留空则表示使用官方正版登录 (或离线模式)。")],-1)),e("div",Ta,[t(Y,{modelValue:o.value,"onUpdate:modelValue":a[18]||(a[18]=R=>o.value=R),options:D},null,8,["modelValue"]),o.value==="custom"?(v(),L("div",za,[t(q,{modelValue:U.value,"onUpdate:modelValue":a[19]||(a[19]=R=>U.value=R),placeholder:"输入 Authlib-Injector API 地址"},null,8,["modelValue"])])):F("",!0)])])):F("",!0),a[56]||(a[56]=e("div",{class:"setting-group-title"},"高级设置",-1)),e("div",Fa,[a[45]||(a[45]=e("div",{class:"setting-info"},[e("div",{class:"title"},"自动重启"),e("div",{class:"desc"},"当服务器崩溃或意外停止时尝试自动重启"),e("div",{class:"desc"},"熔断机制: 若5分钟内尝试重启次数达到 5 次，则停止尝试重启")],-1)),e("div",Ga,[t(he,{modelValue:s.value.autoRestart,"onUpdate:modelValue":a[20]||(a[20]=R=>s.value.autoRestart=R),label:["已开启","已关闭"]},null,8,["modelValue"])])]),s.value.autoRestart?(v(),L("div",Ja,[a[46]||(a[46]=e("div",{class:"setting-info"},[e("div",{class:"title"},"强制自动重启"),e("div",{class:"desc"},"开启此功能后，就算服务器是正常退出的也会强制重启(正常退出 => 退出代码 0)"),e("div",{class:"desc"},"不影响手动在面板关闭服务器")],-1)),e("div",ja,[t(he,{modelValue:s.value.forceAutoRestart,"onUpdate:modelValue":a[21]||(a[21]=R=>s.value.forceAutoRestart=R),label:["已开启","已关闭"]},null,8,["modelValue"])])])):F("",!0),e("div",Xa,[a[47]||(a[47]=e("div",{class:"setting-info"},[e("div",{class:"title"},"忽略EULA提示"),e("div",{class:"desc"},"若您的实例并非MC服务器，可打开此选项")],-1)),e("div",Wa,[t(he,{modelValue:s.value.ignoreEula,"onUpdate:modelValue":a[22]||(a[22]=R=>s.value.ignoreEula=R),label:["已开启","已关闭"]},null,8,["modelValue"])])]),e("div",Ka,[a[48]||(a[48]=e("div",{class:"setting-info"},[e("div",{class:"title"},"随守护进程启动"),e("div",{class:"desc"},"当物理机开机/面板启动时，自动启动此实例")],-1)),e("div",qa,[t(he,{modelValue:s.value.runOnStartup,"onUpdate:modelValue":a[23]||(a[23]=R=>s.value.runOnStartup=R),label:["已开启","已关闭"]},null,8,["modelValue"])])]),e("div",Ha,[a[49]||(a[49]=e("div",{class:"setting-info"},[e("div",{class:"title"},"控制台编码"),e("div",{class:"desc"},"设置输入输出流的字符集，乱码时请尝试切换")],-1)),e("div",Ya,[t(Y,{modelValue:s.value.inputEncoding,"onUpdate:modelValue":a[24]||(a[24]=R=>s.value.inputEncoding=R),options:i,label:"输入",style:{width:"140px"}},null,8,["modelValue"]),t(Y,{modelValue:s.value.outputEncoding,"onUpdate:modelValue":a[25]||(a[25]=R=>s.value.outputEncoding=R),options:i,label:"输出",style:{width:"140px"}},null,8,["modelValue"])])]),e("div",Za,[a[50]||(a[50]=e("div",{class:"setting-info"},[e("div",{class:"title"},"文件编码"),e("div",{class:"desc"},"设置文件编辑和保存时的编码格式，乱码时请尝试切换。(一般Windows是GBK，其他是UTF-8。)")],-1)),e("div",Qa,[t(Y,{modelValue:s.value.fileEncoding,"onUpdate:modelValue":a[26]||(a[26]=R=>s.value.fileEncoding=R),options:i,style:{width:"140px"}},null,8,["modelValue"])])]),e("div",el,[t(K,{theme:"primary",type:"submit",size:"large",loading:x.value},{default:l(()=>[...a[51]||(a[51]=[m("保存设置",-1)])]),_:1},8,["loading"]),t(K,{theme:"default",variant:"base",size:"large",onClick:pe},{default:l(()=>[...a[52]||(a[52]=[m("重置更改",-1)])]),_:1})])]),_:1},8,["data","rules"])]),_:1},8,["loading"]),t(Vt,{visible:X.value,"onUpdate:visible":a[27]||(a[27]=R=>X.value=R),onConfirm:oe},null,8,["visible"]),t(ot,{visible:ve.value,"onUpdate:visible":a[29]||(a[29]=R=>ve.value=R),header:"正在应用更新",footer:!1,"close-on-overlay-click":!1,"close-btn":!1,width:"600px"},{default:l(()=>[e("div",tl,[t(Le,{theme:"plump",percentage:me.value,label:`${me.value}%`},null,8,["percentage","label"]),e("div",al,[(v(!0),L(re,null,de(_e.value,(R,it)=>(v(),L("div",{key:it,class:"log-line"},[e("span",ll,O(R.time),1),m(" "+O(R.msg),1)]))),128))]),me.value===100?(v(),L("div",sl,[t(K,{theme:"primary",onClick:a[28]||(a[28]=R=>ve.value=!1)},{default:l(()=>[...a[57]||(a[57]=[m("关闭并刷新",-1)])]),_:1})])):F("",!0)])]),_:1},8,["visible"])])}}}),ol=ne(nl,[["__scopeId","data-v-bd3d6d54"]]),il={class:"pm-container"},rl={class:"header-section"},ul={class:"mode-switcher"},dl={key:0,class:"error-alert-bar"},cl={class:"toolbar"},vl={class:"left-actions"},ml={key:0,class:"bulk-actions"},pl={class:"selected-count"},fl={class:"right-search"},gl={class:"table-wrapper"},bl={class:"empty-state"},yl={class:"tips-footer"},_l=se({__name:"ModsPluginsManager",setup(n){const p=be(),$=parseInt(p.params.serverId),f=y("mods"),C=y(!1),w=y([]),x=y(""),E=y([]),i=y(""),s=te(()=>[{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{title:"文件名",colKey:"name",sorter:(r,u)=>r.name.localeCompare(u.name),ellipsis:!0},{title:"状态",colKey:"status",width:100},{title:"操作",colKey:"op",width:180,fixed:"right",align:"right"}]),g=te(()=>{if(!x.value)return w.value;const r=x.value.toLowerCase();return w.value.filter(u=>u.name.toLowerCase().includes(r))}),z=async()=>{C.value=!0,E.value=[],i.value="";try{const r=await yt($,f.value),u=(r.jarFiles||[]).map(I=>({name:I,status:"enabled"})),h=(r.disableJarFiles||[]).map(I=>({name:I,status:"disabled"}));w.value=[...u,...h]}catch(r){const u=r.message||"获取列表失败";i.value=u,w.value=[]}finally{C.value=!1}},A=async(r,u)=>{if(u.length===0)return;const h={enable:"启用",disable:"禁用",delete:"删除"},I=async()=>{try{C.value=!0;const o=await _t($,f.value,r,u),{successCount:U,failCount:D}=o||{};D>0?H.warning(`操作完成：成功 ${U} 个，失败 ${D} 个`):H.success(`成功${h[r]} ${U} 个文件`),await z()}catch(o){H.error(o.message||"操作失败"),C.value=!1}};if(r==="delete"){const o=Ie.confirm({header:`确认删除 ${u.length} 个文件?`,body:"此操作不可逆，文件将被永久删除。",theme:"danger",onConfirm:()=>{o.hide(),I()}})}else await I()},d=r=>{f.value=r,z()},T=r=>{const u=r.status==="enabled"?"disable":"enable";A(u,[r.name])},c=r=>{const u=E.value;A(r,u)},b=y(!1),_=()=>{b.value=!0},k=()=>{b.value=!1,z()};return ce(()=>{z()}),Q(()=>p.params.serverId,r=>{r&&location.reload()}),(r,u)=>{const h=M("t-radio-button"),I=M("t-radio-group"),o=M("t-alert"),U=M("t-button"),D=M("t-input"),j=M("t-tag"),X=M("t-switch"),P=M("t-popconfirm"),N=M("t-space"),Z=M("t-table");return v(),L("div",il,[e("div",rl,[u[10]||(u[10]=e("div",{class:"setting-group-title"}," 资源管理 ",-1)),e("div",ul,[t(I,{modelValue:f.value,"onUpdate:modelValue":u[0]||(u[0]=W=>f.value=W),variant:"default-filled",onChange:d},{default:l(()=>[t(h,{value:"mods"},{icon:l(()=>[t(B(Ee))]),default:l(()=>[u[8]||(u[8]=m(" 模组 (Mods) ",-1))]),_:1}),t(h,{value:"plugins"},{icon:l(()=>[t(B(Pe))]),default:l(()=>[u[9]||(u[9]=m(" 插件 (Plugins) ",-1))]),_:1})]),_:1},8,["modelValue"])])]),i.value?(v(),L("div",dl,[t(o,{theme:"error",message:i.value,closeable:"",onClose:u[1]||(u[1]=W=>i.value="")},{operation:l(()=>[e("span",{style:{cursor:"pointer","margin-left":"8px"},onClick:z},"重试")]),_:1},8,["message"])])):F("",!0),e("div",cl,[e("div",vl,[t(U,{theme:"primary",disabled:i.value!=="",onClick:_},{icon:l(()=>[t(B(Bt))]),default:l(()=>[u[11]||(u[11]=m(" 上传文件 ",-1))]),_:1},8,["disabled"]),t(U,{variant:"outline",loading:C.value,onClick:z},{icon:l(()=>[t(B(Se))]),_:1},8,["loading"]),t(Fe,{name:"fade"},{default:l(()=>[E.value.length>0?(v(),L("div",ml,[u[15]||(u[15]=e("div",{class:"divider"},null,-1)),e("span",pl,"已选 "+O(E.value.length)+" 项",1),t(U,{size:"small",variant:"text",theme:"success",onClick:u[2]||(u[2]=W=>c("enable"))},{default:l(()=>[...u[12]||(u[12]=[m("启用",-1)])]),_:1}),t(U,{size:"small",variant:"text",theme:"warning",onClick:u[3]||(u[3]=W=>c("disable"))},{default:l(()=>[...u[13]||(u[13]=[m("禁用",-1)])]),_:1}),t(U,{size:"small",variant:"text",theme:"danger",onClick:u[4]||(u[4]=W=>c("delete"))},{default:l(()=>[...u[14]||(u[14]=[m("删除",-1)])]),_:1})])):F("",!0)]),_:1})]),e("div",fl,[t(D,{modelValue:x.value,"onUpdate:modelValue":u[5]||(u[5]=W=>x.value=W),placeholder:"搜索文件名...",clearable:""},{"prefix-icon":l(()=>[t(B(Lt))]),_:1},8,["modelValue"])])]),e("div",gl,[t(Z,{"selected-row-keys":E.value,"onUpdate:selectedRowKeys":u[6]||(u[6]=W=>E.value=W),data:g.value,columns:s.value,"row-key":"name",loading:C.value,pagination:{defaultPageSize:20,total:g.value.length,showJumper:!0},hover:"",stripe:"",class:"custom-table"},{status:l(({row:W})=>[W.status==="enabled"?(v(),J(j,{key:0,theme:"success",variant:"light"},{icon:l(()=>[t(B(We))]),default:l(()=>[u[16]||(u[16]=m(" 已启用 ",-1))]),_:1})):(v(),J(j,{key:1,theme:"default",variant:"light",style:{color:"var(--td-text-color-placeholder)"}},{icon:l(()=>[t(B(Et))]),default:l(()=>[u[17]||(u[17]=m(" 已禁用 ",-1))]),_:1}))]),op:l(({row:W})=>[t(N,{size:"small"},{default:l(()=>[t(X,{"model-value":W.status==="enabled",loading:C.value,size:"medium",onChange:oe=>T(W)},{label:l(oe=>[m(O(oe.value?"开":"关"),1)]),_:1},8,["model-value","loading","onChange"]),t(P,{content:"确定要删除此文件吗？",theme:"danger",onConfirm:oe=>A("delete",[W.name])},{default:l(()=>[t(U,{variant:"text",theme:"danger",shape:"square"},{default:l(()=>[t(B(Xe))]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)]),empty:l(()=>[e("div",bl,[f.value==="mods"?(v(),J(B(Ee),{key:0,size:"48px",style:{color:"var(--td-gray-color-4)"}})):(v(),J(B(Pe),{key:1,size:"48px",style:{color:"var(--td-gray-color-4)"}})),e("p",null,O(`暂无${f.value==="mods"?"模组":"插件"}文件`),1)])]),_:1},8,["selected-row-keys","data","columns","loading","pagination"])]),e("div",yl,[e("p",null,"提示："+O(f.value==="mods"?"模组":"插件")+"文件存放于服务器根目录的 /"+O(f.value)+" 文件夹下。",1),u[18]||(u[18]=e("p",null,"禁用文件后，会在文件名后添加 .disabled 后缀，服务器将忽略该文件。",-1))]),t(Zt,{visible:b.value,"onUpdate:visible":u[7]||(u[7]=W=>b.value=W),"instance-id":B($),"current-path":f.value,"allow-folder":!1,onSuccess:k},null,8,["visible","instance-id","current-path"])])}}}),kl=ne(_l,[["__scopeId","data-v-4e5df3f3"]]),Ne=[{key:"motd",label:"服务器标语",desc:"显示在多人游戏列表中的服务器介绍信息，支持颜色代码，不支持中文。",type:"string"},{key:"server-port",label:"服务器端口",desc:"默认为 25565。如果要在一台机器运行多个服务器，必须修改此端口。",type:"number"},{key:"max-players",label:"最大玩家数",desc:"服务器同时允许在线的最大玩家数量。",type:"number"},{key:"online-mode",label:"正版验证",desc:"开启后将验证玩家的正版账号。如果使用离线/皮肤站，请关闭此项。",type:"boolean"},{key:"white-list",label:"启用白名单",desc:"开启后只有在白名单内的玩家才能进入服务器。",type:"boolean"},{key:"enforce-whitelist",label:"强制白名单",desc:"开启后，当玩家不在白名单时，即使已在线也会被踢出（通常用于维护时重新加载白名单）。",type:"boolean"},{key:"level-name",label:"存档文件夹名称",desc:"服务器读取的世界存档文件夹名称（默认为 world）。",type:"string"},{key:"gamemode",label:"默认游戏模式",desc:"新玩家进入服务器时的默认模式。",type:"select",options:[{label:"生存 (Survival)",value:"survival"},{label:"创造 (Creative)",value:"creative"},{label:"冒险 (Adventure)",value:"adventure"},{label:"旁观 (Spectator)",value:"spectator"}]},{key:"force-gamemode",label:"强制游戏模式",desc:"开启后，玩家每次加入服务器都会被重置为默认游戏模式。",type:"boolean"},{key:"difficulty",label:"难度",desc:"世界的游戏难度设置。",type:"select",options:[{label:"和平 (Peaceful)",value:"peaceful"},{label:"简单 (Easy)",value:"easy"},{label:"普通 (Normal)",value:"normal"},{label:"困难 (Hard)",value:"hard"}]},{key:"hardcore",label:"极限模式",desc:"开启后，玩家死亡将被封禁。",type:"boolean"},{key:"allow-flight",label:"允许飞行",desc:"允许生存模式下的玩家飞行（防止被服务端反作弊踢出）。",type:"boolean"},{key:"spawn-protection",label:"出生点保护半径",desc:"出生点周围多少格内禁止非 OP 破坏。设为 0 可禁用。",type:"number"},{key:"player-idle-timeout",label:"挂机踢出时间",desc:"玩家闲置多少分钟后被自动踢出。0 为不限制。",type:"number"},{key:"level-seed",label:"世界种子",desc:"生成世界使用的种子，留空则随机生成。",type:"string"},{key:"level-type",label:"世界类型",desc:"例如 minecraft:normal, minecraft:flat, minecraft:amplified。",type:"string"},{key:"generate-structures",label:"生成结构",desc:"是否生成村庄、地牢等结构。",type:"boolean"},{key:"generator-settings",label:"生成器设置",desc:"用于自定义超平坦或特定生成器的 JSON 参数。",type:"string"},{key:"max-world-size",label:"世界边界半径",desc:"设置世界边界（World Border）的最大半径。",type:"number"},{key:"simulation-distance",label:"模拟距离",desc:"服务器实际运算实体/作物生长的区块半径（3-32）。",type:"number"},{key:"view-distance",label:"视距",desc:"客户端可以看见的区块半径。数值过大显著增加内存和带宽消耗。",type:"number"},{key:"entity-broadcast-range-percentage",label:"实体广播范围百分比",desc:"控制客户端能看到实体的距离系数（100表示默认）。",type:"number"},{key:"max-tick-time",label:"最大刻耗时 (Watchdog)",desc:"一刻的最长处理毫秒数。超过此数值服务器将强制关闭以防卡死。设为 -1 可禁用。",type:"number"},{key:"network-compression-threshold",label:"网络压缩阈值",desc:"数据包超过此字节数时进行压缩。设为 -1 禁用压缩。推荐保持默认 256。",type:"number"},{key:"rate-limit",label:"数据包限制",desc:"如果玩家发送数据包过快，将被踢出。0 为禁用。",type:"number"},{key:"use-native-transport",label:"使用原生传输优化",desc:"Linux 环境下是否启用 Epoll 优化网络性能。",type:"boolean"},{key:"prevent-proxy-connections",label:"防止代理连接",desc:"是否尝试阻止通过 VPN 或代理的连接（ISP/AS 号判断）。",type:"boolean"},{key:"sync-chunk-writes",label:"同步区块写入",desc:"开启后区块写入完成后才继续逻辑，数据更安全但可能掉帧；关闭可能提升性能。",type:"boolean"},{key:"region-file-compression",label:"区块文件压缩格式",desc:"用于保存区块的压缩算法。",type:"select",options:[{label:"Deflate (默认)",value:"deflate"},{label:"LZ4 (更快)",value:"lz4"},{label:"不压缩 (None)",value:"none"}]},{key:"max-chained-neighbor-updates",label:"最大连锁更新数",desc:"限制红石/方块连锁更新的数量以防止崩服。",type:"number"},{key:"log-ips",label:"控制台记录 IP",desc:"是否在控制台日志中显示玩家连接的 IP 地址。",type:"boolean"},{key:"hide-online-players",label:"隐藏在线玩家列表",desc:"开启后，服务器列表中将不显示具体的玩家名单。",type:"boolean"},{key:"enable-status",label:"启用状态查询",desc:"是否允许外部（如服务器列表网站）查询服务器状态。",type:"boolean"},{key:"accepts-transfers",label:"接受服务器传送",desc:"是否允许玩家从其他服务器无缝传送到此服务器。",type:"boolean"},{key:"pause-when-empty-seconds",label:"空载暂停时间",desc:"服务器内无玩家多少秒后暂停游戏循环（省资源）。-1 为不暂停。",type:"number"},{key:"op-permission-level",label:"OP 权限等级",desc:"设置 OP 的默认权限级别。",type:"select",options:[{label:"1 - 无视出生点保护",value:1},{label:"2 - 使用单机指令 (gamemode等)",value:2},{label:"3 - 多人管理 (kick/ban/op)",value:3},{label:"4 - 系统管理 (stop/save)",value:4}]},{key:"function-permission-level",label:"函数权限等级",desc:"数据包(Datapack)中函数的默认执行权限等级。",type:"number"},{key:"enforce-secure-profile",label:"强制安全配置 (签名)",desc:"强制玩家拥有官方签名的公钥（聊天报告相关）。离线服建议关闭。",type:"boolean"},{key:"enable-code-of-conduct",label:"启用行为准则提示",desc:"是否向玩家展示行为准则链接（遥测相关）。",type:"boolean"},{key:"bug-report-link",label:"Bug 反馈链接",desc:"自定义玩家遇到错误时显示的反馈网址。",type:"string"},{key:"resource-pack",label:"资源包下载地址",desc:"玩家进入服务器时提示下载的资源包直链 URL。",type:"string"},{key:"require-resource-pack",label:"强制资源包",desc:"开启后，拒绝下载资源包的玩家将被踢出。",type:"boolean"},{key:"resource-pack-sha1",label:"资源包 SHA1",desc:"资源包文件的 SHA-1 校验码，用于验证完整性和缓存。",type:"string"},{key:"resource-pack-prompt",label:"资源包提示语",desc:"下载资源包时向玩家显示的自定义消息（Json 格式）。",type:"string"},{key:"initial-enabled-packs",label:"初始启用数据包",desc:"世界生成时默认启用的数据包列表（逗号分隔）。",type:"string"},{key:"initial-disabled-packs",label:"初始禁用数据包",desc:"世界生成时默认禁用的数据包列表。",type:"string"},{key:"enable-rcon",label:"启用 RCON",desc:"开启远程控制台协议，允许外部工具发送指令。",type:"boolean"},{key:"rcon.port",label:"RCON 端口",desc:"RCON 监听端口（默认为 25575）。",type:"number"},{key:"rcon.password",label:"RCON 密码",desc:"连接 RCON 必须的密码。请设置复杂的密码。",type:"string"},{key:"broadcast-rcon-to-ops",label:"向 OP 广播 RCON",desc:"当 RCON 执行指令时，是否通知在线的 OP。",type:"boolean"},{key:"enable-query",label:"启用 Query",desc:"开启 GameSpy4 协议，用于获取服务器详细信息。",type:"boolean"},{key:"query.port",label:"Query 端口",desc:"Query 协议监听端口（默认为 25565）。",type:"number"},{key:"broadcast-console-to-ops",label:"向 OP 广播控制台",desc:"控制台执行的指令输出是否发给在线 OP。",type:"boolean"},{key:"enable-jmx-monitoring",label:"启用 JMX 监控",desc:"开启 Java JMX 性能监控（通常用于开发调试）。",type:"boolean"},{key:"management-server-enabled",label:"启用管理后台",desc:"是否启用 Minecraft 官方定义的管理服务器接口。",type:"boolean"},{key:"management-server-port",label:"管理后台端口",desc:"管理接口监听的端口。",type:"number"},{key:"management-server-host",label:"管理后台主机",desc:"管理接口绑定的主机名/IP。",type:"string"},{key:"management-server-allowed-origins",label:"管理后台允许源",desc:"允许访问管理接口的 Origin 列表。",type:"string"},{key:"server-ip",label:"服务器绑定 IP",desc:"指定服务器绑定的本地网卡 IP。留空表示监听所有网卡（0.0.0.0）。",type:"string"},{key:"debug",label:"调试模式",desc:"开启后控制台将输出更多调试信息。",type:"boolean"},{key:"text-filtering-config",label:"文本过滤配置",desc:"用于文本过滤服务的 API 配置。",type:"string"},{key:"status-heartbeat-interval",label:"状态心跳间隔",desc:"服务器向客户端发送状态心跳的间隔（0 为默认）。",type:"number"}],hl={class:"settings-container"},wl={class:"page-header"},$l={class:"config-list"},xl={key:0,class:"empty-tip"},Cl={class:"setting-info"},Vl={class:"title"},Sl={class:"key-name-row"},Ul={key:0,class:"key-name"},Ml={key:0,class:"desc"},Rl={class:"setting-control"},Il={class:"form-actions"},Bl=se({__name:"ServerProperties",setup(n){const p=be(),$=y(0),f=y(!1),C=y(!1),w=y({}),x=y(""),E=c=>{const b={};return c.split(`
`).forEach(k=>{const r=k.trim();if(!r||r.startsWith("#"))return;const u=r.indexOf("=");if(u!==-1){const h=r.substring(0,u).trim(),I=r.substring(u+1).trim();b[h]=I}}),b},i=c=>{let b=`#Minecraft server properties
#${new Date().toString()}
`;const _=Ne.map(r=>r.key),k=Object.keys(c);return _.forEach(r=>{Object.prototype.hasOwnProperty.call(c,r)&&(b+=`${r}=${c[r]}
`)}),k.forEach(r=>{_.includes(r)||(b+=`${r}=${c[r]}
`)}),b},s=async()=>{if($.value){f.value=!0;try{const c=await kt($.value,"server.properties");c&&(x.value=c,w.value=E(c))}catch(c){H.error(`读取配置文件失败: ${c.message}`)}finally{f.value=!1}}},g=async()=>{C.value=!0;try{const c=i(w.value);await ht($.value,"server.properties",c),H.success("配置文件已保存"),s()}catch(c){H.error(`保存失败: ${c.message}`)}finally{C.value=!1}},z=te(()=>{const c=[],b=w.value,_=new Set(Object.keys(b));return Ne.forEach(k=>{_.has(k.key)&&(c.push(k),_.delete(k.key))}),_.forEach(k=>{c.push({key:k,label:k,desc:"未收录的配置项",type:A(b[k]),isUnknown:!0})}),c}),A=c=>c==="true"||c==="false"?"boolean":!isNaN(Number(c))&&c!==""?"number":"string",d=(c,b)=>{const _=w.value[c];return _===void 0?b==="boolean"?!1:"":b==="boolean"?_==="true":b==="number"?Number(_):_},T=(c,b,_)=>{w.value[c]=String(b)};return Q(()=>p.params.serverId,c=>{p.name==="InstanceConsole"&&c&&($.value=parseInt(c),s())},{immediate:!0}),(c,b)=>{const _=M("t-button"),k=M("t-space"),r=M("t-switch"),u=M("t-select"),h=M("t-input-number"),I=M("t-input"),o=M("t-loading");return v(),L("div",hl,[e("div",wl,[b[1]||(b[1]=e("div",{class:"section-title"},"Server.properties 配置编辑器",-1)),t(k,null,{default:l(()=>[t(_,{variant:"text",shape:"square",loading:f.value,onClick:s},{icon:l(()=>[t(B(Se))]),_:1},8,["loading"]),t(_,{theme:"primary",loading:C.value,onClick:g},{icon:l(()=>[t(B(Ke))]),default:l(()=>[b[0]||(b[0]=m(" 保存配置 ",-1))]),_:1},8,["loading"])]),_:1})]),t(o,{loading:f.value,text:"正在读取配置文件..."},{default:l(()=>[e("div",$l,[!f.value&&z.value.length===0?(v(),L("div",xl," 无法找到配置项或文件为空 ")):F("",!0),(v(!0),L(re,null,de(z.value,U=>(v(),L("div",{key:U.key,class:ye(["setting-item",{"unknown-item":U.isUnknown}])},[e("div",Cl,[e("div",Vl,O(U.label),1),e("div",Sl,[U.isUnknown?F("",!0):(v(),L("span",Ul,O(U.key),1))]),U.isUnknown?F("",!0):(v(),L("div",Ml,O(U.desc||"暂无描述"),1))]),e("div",Rl,[U.type==="boolean"?(v(),J(r,{key:0,"model-value":d(U.key,"boolean"),"onUpdate:modelValue":D=>T(U.key,D,"boolean")},null,8,["model-value","onUpdate:modelValue"])):U.type==="select"?(v(),J(u,{key:1,"model-value":d(U.key,"string"),options:U.options,placeholder:"请选择","onUpdate:modelValue":D=>T(U.key,D,"string")},null,8,["model-value","options","onUpdate:modelValue"])):U.type==="number"?(v(),J(h,{key:2,"model-value":d(U.key,"number"),theme:"column",style:{width:"100%"},"onUpdate:modelValue":D=>T(U.key,D,"number")},null,8,["model-value","onUpdate:modelValue"])):(v(),J(I,{key:3,"model-value":d(U.key,"string"),placeholder:"未设置","onUpdate:modelValue":D=>T(U.key,D,"string")},null,8,["model-value","onUpdate:modelValue"]))])],2))),128))])]),_:1},8,["loading"]),e("div",Il,[t(_,{theme:"primary",size:"large",loading:C.value,onClick:g},{default:l(()=>[...b[2]||(b[2]=[m("保存设置",-1)])]),_:1},8,["loading"]),t(_,{theme:"default",variant:"base",size:"large",onClick:s},{default:l(()=>[...b[3]||(b[3]=[m("重置更改",-1)])]),_:1})])])}}}),Ll=ne(Bl,[["__scopeId","data-v-57d6b000"]]);async function El(n){return await Ve.get({url:`/api/instance/tasks/list/${n}`})}async function Pl(n,p,$,f,C,w){return await Ve.post({url:"/api/instance/tasks/create",data:{instanceId:n,name:p,cron:$,payload:f,type:C,enable:w}})}async function Al(n,p,$,f,C,w,x){return await Ve.post({url:"/api/instance/tasks/update",data:{instanceId:n,id:p,name:$,cron:f,payload:C,type:w,enable:x}})}async function Ol(n){return await Ve.post({url:`/api/instance/tasks/delete/${n}`})}const Dl={class:"cron-gen-container"},Nl={class:"mode-switch"},Tl={key:0,class:"mode-content novice-panel"},zl={class:"novice-input-group"},Fl={key:1,class:"mode-content pro-panel"},Gl={class:"tab-scroll-area"},Jl={key:0,class:"specific-box"},jl={class:"result-area"},Xl={class:"cron-display"},Wl={class:"code-box"},Kl={class:"next-runs"},ql={class:"runs-title"},Hl={key:0,class:"error-msg"},Yl={key:1,class:"runs-list"},Zl={class:"index"},Ql=se({__name:"CronGenerator",props:{visible:{type:Boolean,default:!1},initialValue:{type:String,default:""}},emits:["update:visible","confirm"],setup(n,{emit:p}){const $=n,f=p,C=y("novice"),w=y(10),x=y("minute"),E=[{label:"秒",value:"second"},{label:"分钟",value:"minute"},{label:"小时",value:"hour"},{label:"天",value:"day"}],i=y("second"),s=[{label:"秒",value:"second",min:0,max:59},{label:"分",value:"minute",min:0,max:59},{label:"时",value:"hour",min:0,max:23},{label:"日",value:"day",min:1,max:31},{label:"月",value:"month",min:1,max:12},{label:"周",value:"week",min:1,max:7}],g=y({second:{type:"every",start:0,step:1,specifics:[]},minute:{type:"every",start:0,step:1,specifics:[]},hour:{type:"every",start:0,step:1,specifics:[]},day:{type:"every",start:1,step:1,specifics:[]},month:{type:"every",start:1,step:1,specifics:[]},week:{type:"any",start:1,step:1,specifics:[]}}),z=[{label:"周日",value:1},{label:"周一",value:2},{label:"周二",value:3},{label:"周三",value:4},{label:"周四",value:5},{label:"周五",value:6},{label:"周六",value:7}],A=te(()=>{const u=(X,P="*")=>{const N=g.value[X];return X==="week"&&N.type==="any"||X==="week"&&g.value.day.type!=="every"||X==="day"&&g.value.week.type!=="any"?"?":N.type==="every"?"*":N.type==="interval"?`${N.start}/${N.step}`:N.type==="specific"?N.specifics.length===0?X==="day"||X==="month"?"1":"0":N.specifics.sort((Z,W)=>Z-W).join(","):P},h=u("second"),I=u("minute"),o=u("hour"),U=u("day"),D=u("month"),j=u("week","?");return`${h} ${I} ${o} ${U} ${D} ${j}`}),d=te(()=>{const u=w.value;switch(x.value){case"second":return`*/${u} * * * * *`;case"minute":return`0 */${u} * * * *`;case"hour":return`0 0 */${u} * * ?`;case"day":return`0 0 0 */${u} * ?`;default:return"* * * * * *"}}),T=te(()=>C.value==="novice"?d.value:A.value),c=y([]),b=y(""),_=()=>{try{const u=Qt.CronExpressionParser.parse(T.value,{currentDate:new Date});c.value=u.take(5).map(h=>new Date(h.toString()).toLocaleString()),b.value=""}catch{b.value="无法解析当前 Cron 表达式，请检查规则是否冲突",c.value=[]}};Q(T,()=>{_()},{immediate:!0}),Q(()=>$.visible,u=>{u&&$.initialValue&&(C.value="pro",_())});const k=()=>{if(b.value){H.warning("当前表达式无效，无法保存");return}f("confirm",T.value),f("update:visible",!1)},r=u=>{const h=s.find(o=>o.value===u);if(!h)return[];const I=[];for(let o=h.min;o<=h.max;o++)I.push({label:o.toString(),value:o});return I};return(u,h)=>{const I=M("t-radio-button"),o=M("t-radio-group"),U=M("t-input-number"),D=M("t-select"),j=M("t-alert"),X=M("t-radio"),P=M("t-checkbox-group"),N=M("t-tab-panel"),Z=M("t-tabs"),W=M("t-tag"),oe=M("t-dialog");return v(),J(oe,{visible:n.visible,header:"Cron 表达式生成器",width:"700px",top:"5vh",onClose:h[4]||(h[4]=V=>f("update:visible",!1)),onConfirm:k},{default:l(()=>[e("div",Dl,[e("div",Nl,[t(o,{modelValue:C.value,"onUpdate:modelValue":h[0]||(h[0]=V=>C.value=V),variant:"default-filled"},{default:l(()=>[t(I,{value:"novice"},{default:l(()=>[...h[5]||(h[5]=[m("🚀 新手模式",-1)])]),_:1}),t(I,{value:"pro"},{default:l(()=>[...h[6]||(h[6]=[m("🛠️ 专业模式",-1)])]),_:1})]),_:1},8,["modelValue"])]),C.value==="novice"?(v(),L("div",Tl,[e("div",zl,[h[7]||(h[7]=e("span",null,"每隔",-1)),t(U,{modelValue:w.value,"onUpdate:modelValue":h[1]||(h[1]=V=>w.value=V),min:1,theme:"column",style:{width:"100px"}},null,8,["modelValue"]),t(D,{modelValue:x.value,"onUpdate:modelValue":h[2]||(h[2]=V=>x.value=V),options:E,style:{width:"100px"}},null,8,["modelValue"]),h[8]||(h[8]=e("span",null,"执行一次",-1))]),t(j,{theme:"info",style:{"margin-top":"16px"}},{message:l(()=>[...h[9]||(h[9]=[m(" 此模式适用于简单的周期性任务。如果需要“每周五上午10点”等复杂规则，请切换到",-1),e("b",null,"专业模式",-1),m("。 ",-1)])]),_:1})])):(v(),L("div",Fl,[t(Z,{modelValue:i.value,"onUpdate:modelValue":h[3]||(h[3]=V=>i.value=V)},{default:l(()=>[(v(),L(re,null,de(s,V=>t(N,{key:V.value,value:V.value,label:V.label},{default:l(()=>[e("div",Gl,[t(o,{modelValue:g.value[V.value].type,"onUpdate:modelValue":ee=>g.value[V.value].type=ee,direction:"vertical"},{default:l(()=>[t(X,{value:"every"},{default:l(()=>[m(O(V.value==="week"?"不指定 (?)":`每${V.label} (*)`),1)]),_:2},1024),V.value!=="week"?(v(),J(X,{key:0,value:"interval"},{default:l(()=>[h[10]||(h[10]=m(" 周期: 从 ",-1)),t(U,{modelValue:g.value[V.value].start,"onUpdate:modelValue":ee=>g.value[V.value].start=ee,min:V.min,max:V.max,size:"small",theme:"column",style:{width:"60px"}},null,8,["modelValue","onUpdate:modelValue","min","max"]),m(" "+O(V.label)+"开始，每 ",1),t(U,{modelValue:g.value[V.value].step,"onUpdate:modelValue":ee=>g.value[V.value].step=ee,min:1,max:V.max,size:"small",theme:"column",style:{width:"60px"}},null,8,["modelValue","onUpdate:modelValue","max"]),m(" "+O(V.label)+"执行一次 ",1)]),_:2},1024)):F("",!0),V.value!=="week"?(v(),J(X,{key:1,value:"specific"},{default:l(()=>[m("指定: 选择具体的"+O(V.label),1)]),_:2},1024)):F("",!0),V.value==="week"?(v(),J(X,{key:2,value:"specific"},{default:l(()=>[...h[11]||(h[11]=[m("指定周几",-1)])]),_:1})):F("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),g.value[V.value].type==="specific"?(v(),L("div",Jl,[t(P,{modelValue:g.value[V.value].specifics,"onUpdate:modelValue":ee=>g.value[V.value].specifics=ee,options:V.value==="week"?z:r(V.value),class:"grid-checkbox"},null,8,["modelValue","onUpdate:modelValue","options"])])):F("",!0)])]),_:2},1032,["value","label"])),64))]),_:1},8,["modelValue"])])),e("div",jl,[e("div",Xl,[h[14]||(h[14]=e("span",{class:"label"},"当前表达式:",-1)),e("div",Wl,[m(O(T.value)+" ",1),b.value?(v(),J(W,{key:1,theme:"danger",variant:"light",size:"small"},{default:l(()=>[t(B(Pt)),h[13]||(h[13]=m(" 无效",-1))]),_:1})):(v(),J(W,{key:0,theme:"success",variant:"light",size:"small"},{default:l(()=>[t(B(We)),h[12]||(h[12]=m(" 有效",-1))]),_:1}))])]),e("div",Kl,[e("div",ql,[t(B(Ue)),h[15]||(h[15]=m(" 最近 5 次运行时间预测:",-1))]),b.value?(v(),L("div",Hl,O(b.value),1)):(v(),L("ul",Yl,[(v(!0),L(re,null,de(c.value,(V,ee)=>(v(),L("li",{key:ee},[e("span",Zl,"#"+O(ee+1),1),m(" "+O(V),1)]))),128))]))])])])]),_:1},8,["visible"])}}}),es=ne(Ql,[["__scopeId","data-v-135dd699"]]),ts={class:"page-container"},as={class:"page-header"},ls={key:0,class:"create-container"},ss={class:"container-header"},ns={class:"title"},os={class:"setting-item"},is={class:"setting-control"},rs={class:"setting-item"},us={class:"setting-control"},ds={class:"setting-item"},cs={class:"setting-control"},vs={key:0,class:"setting-item"},ms={class:"setting-info"},ps={class:"title"},fs={class:"desc"},gs={class:"setting-control"},bs={class:"setting-item"},ys={class:"setting-control"},_s={class:"form-actions"},ks={class:"task-list"},hs={key:0,class:"empty-state"},ws={class:"card-left"},$s={class:"task-header-row"},xs={class:"task-name"},Cs={class:"task-meta-row"},Vs={class:"cron-display"},Ss=["title"],Us={class:"card-right"},Ms=se({__name:"CronTasks",setup(n){const p=be(),$=te(()=>parseInt(p.params.serverId)),f=y([]),C=y(!1),w=y(!1),x=y(null),E=y(!1),i=y(null),s=y(!1),g=y({id:"",name:"",cron:"",type:"command",payload:"",enable:!0}),z=[{label:"发送命令 (Command)",value:"command"},{label:"备份存档 (Backup)",value:"backup"},{label:"开启服务器 (Start)",value:"start"},{label:"停止服务器 (Stop)",value:"stop"},{label:"重启服务器 (Restart)",value:"restart"}],A={name:[{required:!0,message:"必填",trigger:"blur"}],cron:[{required:!0,message:"必填",trigger:"blur"}],type:[{required:!0,message:"必选",trigger:"change"}],payload:[{validator:I=>g.value.type==="command"&&!I?{result:!1,message:"命令内容不能为空",type:"error"}:!0,trigger:"blur"}]},d=async()=>{if($.value){C.value=!0;try{const I=await El($.value);f.value=I||[]}catch(I){H.error(I.message||"获取列表失败")}finally{C.value=!1}}},T=()=>{w.value||(g.value={id:"",name:"",cron:"",type:"command",payload:"",enable:!0},x.value=null,w.value=!0)},c=I=>{g.value={id:I.id,name:I.name,cron:I.cron,type:I.type.toLowerCase(),payload:I.payload,enable:I.enable},x.value=I.id,w.value=!0,window.scrollTo({top:0,behavior:"smooth"})},b=()=>{w.value=!1,x.value=null},_=async()=>{var o;if(await((o=i.value)==null?void 0:o.validate())===!0){E.value=!0;try{x.value?(await Al($.value,g.value.id,g.value.name,g.value.cron,g.value.payload,g.value.type,g.value.enable),H.success("更新成功")):(await Pl($.value,g.value.name,g.value.cron,g.value.payload,g.value.type,g.value.enable),H.success("创建成功")),b(),d()}catch(U){H.error(U.message||"操作失败")}finally{E.value=!1}}},k=I=>{const o=Ie.confirm({header:"确认删除?",body:`确定删除任务 "${I.name}" 吗？`,theme:"danger",onConfirm:async()=>{try{await Ol(I.id),H.success("已删除"),d(),o.hide()}catch(U){H.error(U.message)}},onClose:()=>o.hide()})},r=I=>{g.value.cron=I},u=I=>{const o=I.toLowerCase();return o==="start"?qe:o==="stop"?He:o==="restart"?Se:Tt},h=I=>{const o=I.toLowerCase();return o==="start"?"success":o==="stop"?"danger":o==="restart"?"warning":"primary"};return Q(()=>$.value,d),ce(d),(I,o)=>{const U=M("t-button"),D=M("t-space"),j=M("t-input"),X=M("t-select"),P=M("t-textarea"),N=M("t-switch"),Z=M("t-form"),W=M("t-tag"),oe=M("t-loading");return v(),L("div",ts,[e("div",as,[o[10]||(o[10]=e("div",{class:"section-title"},"定时计划任务",-1)),t(D,null,{default:l(()=>[w.value?F("",!0):(v(),J(U,{key:0,theme:"default",onClick:o[0]||(o[0]=V=>B(je)(B(ea).cron))},{icon:l(()=>[t(B(At))]),default:l(()=>[o[8]||(o[8]=m(" 使用文档 ",-1))]),_:1})),w.value?F("",!0):(v(),J(U,{key:1,theme:"primary",onClick:T},{icon:l(()=>[t(B(Ot))]),default:l(()=>[o[9]||(o[9]=m(" 创建新任务 ",-1))]),_:1}))]),_:1})]),t(Fe,{name:"slide-fade"},{default:l(()=>[w.value?(v(),L("div",ls,[e("div",ss,[e("span",ns,O(x.value?"编辑任务":"创建新任务"),1),t(U,{size:"small",variant:"text",onClick:b},{default:l(()=>[t(B(Dt))]),_:1})]),t(Z,{ref_key:"formRef",ref:i,data:g.value,rules:A,"label-width":"0"},{default:l(()=>[e("div",os,[o[11]||(o[11]=e("div",{class:"setting-info"},[e("div",{class:"title"},"任务名称"),e("div",{class:"desc"},"给这个计划任务起个容易识别的名字，例如“每日自动重启”")],-1)),e("div",is,[t(j,{modelValue:g.value.name,"onUpdate:modelValue":o[1]||(o[1]=V=>g.value.name=V),placeholder:"请输入任务名称"},null,8,["modelValue"])])]),e("div",rs,[o[13]||(o[13]=e("div",{class:"setting-info"},[e("div",{class:"title"},"触发规则 (Cron)"),e("div",{class:"desc"},"使用 Cron 表达式定义执行时间。支持秒级精度 (秒 分 时 日 月 周)")],-1)),e("div",us,[t(j,{modelValue:g.value.cron,"onUpdate:modelValue":o[2]||(o[2]=V=>g.value.cron=V),placeholder:"例如: 0 0 12 * * ?"},null,8,["modelValue"]),t(U,{variant:"outline",theme:"default",onClick:o[3]||(o[3]=V=>s.value=!0)},{default:l(()=>[...o[12]||(o[12]=[m(" 表达式生成器 ",-1)])]),_:1})])]),e("div",ds,[o[14]||(o[14]=e("div",{class:"setting-info"},[e("div",{class:"title"},"执行操作"),e("div",{class:"desc"},"选择触发时要执行的动作类型")],-1)),e("div",cs,[t(X,{modelValue:g.value.type,"onUpdate:modelValue":o[4]||(o[4]=V=>g.value.type=V),options:z},null,8,["modelValue"])])]),g.value.type==="command"||g.value.type==="restart"?(v(),L("div",vs,[e("div",ms,[e("div",ps,O(g.value.type==="restart"?"重启提示语":"控制台命令"),1),e("div",fs,O(g.value.type==="restart"?"重启前发送给全服玩家的倒计时提示消息":"不需要加 /，直接输入命令内容"),1)]),e("div",gs,[t(P,{modelValue:g.value.payload,"onUpdate:modelValue":o[5]||(o[5]=V=>g.value.payload=V),autosize:{minRows:2,maxRows:5},placeholder:"请输入内容..."},null,8,["modelValue"])])])):F("",!0),e("div",bs,[o[15]||(o[15]=e("div",{class:"setting-info"},[e("div",{class:"title"},"启用状态"),e("div",{class:"desc"},"暂时禁用此任务而不删除它")],-1)),e("div",ys,[t(N,{modelValue:g.value.enable,"onUpdate:modelValue":o[6]||(o[6]=V=>g.value.enable=V)},null,8,["modelValue"])])]),e("div",_s,[t(U,{theme:"primary",loading:E.value,onClick:_},{icon:l(()=>[t(B(Ke))]),default:l(()=>[m(" "+O(x.value?"保存修改":"立即创建"),1)]),_:1},8,["loading"]),t(U,{theme:"default",variant:"base",onClick:b},{default:l(()=>[...o[16]||(o[16]=[m("取消",-1)])]),_:1})])]),_:1},8,["data"])])):F("",!0)]),_:1}),t(oe,{loading:C.value,"show-overlay":""},{default:l(()=>[e("div",ks,[f.value.length===0&&!C.value?(v(),L("div",hs,"暂无任务，请点击上方创建")):F("",!0),(v(!0),L(re,null,de(f.value,V=>(v(),L("div",{key:V.id,class:"task-card"},[e("div",ws,[e("div",$s,[t(W,{size:"small",theme:V.enable?"success":"warning",variant:"light",class:"status-tag"},{default:l(()=>[m(O(V.enable?"运行中":"已暂停"),1)]),_:2},1032,["theme"]),e("span",xs,O(V.name),1)]),e("div",Cs,[t(W,{size:"small",variant:"outline",theme:h(V.type),style:{"margin-right":"8px"}},{icon:l(()=>[(v(),J(Ge(u(V.type))))]),default:l(()=>[m(" "+O(V.type.toUpperCase()),1)]),_:2},1032,["theme"]),e("span",Vs,[t(B(Ue)),m(" "+O(V.cron),1)])]),V.payload?(v(),L("div",{key:0,class:"task-payload",title:V.payload},O(V.payload),9,Ss)):F("",!0)]),e("div",Us,[t(U,{variant:"text",theme:"primary",onClick:ee=>c(V)},{icon:l(()=>[t(B(Nt))]),default:l(()=>[o[17]||(o[17]=m(" 编辑 ",-1))]),_:1},8,["onClick"]),t(U,{variant:"text",theme:"danger",onClick:ee=>k(V)},{icon:l(()=>[t(B(Xe))]),default:l(()=>[o[18]||(o[18]=m(" 删除 ",-1))]),_:1},8,["onClick"])])]))),128))])]),_:1},8,["loading"]),t(es,{visible:s.value,"onUpdate:visible":o[7]||(o[7]=V=>s.value=V),"initial-value":g.value.cron,onConfirm:r},null,8,["visible","initial-value"])])}}}),Rs=ne(Ms,[["__scopeId","data-v-4da6281b"]]),Is={class:"layout-container"},Bs={class:"sidebar"},Ls=["onClick"],Es={class:"nav-text"},Ps={class:"main-content"},As={key:0,class:"panel-wrapper"},Os={key:1,class:"panel-wrapper"},Ds={key:2,class:"panel-wrapper"},Ns={key:3,class:"panel-wrapper"},Ts=se({__name:"InstanceSettings",setup(n,{expose:p}){const $=y(!1),f=y(0),C=[{label:"实例设置",icon:Ye},{label:"插件/模组",icon:zt},{label:"服务器属性",icon:Ft},{label:"定时任务",icon:Ue}];return p({open:()=>{$.value=!0}}),(x,E)=>{const i=M("t-dialog");return v(),J(i,{visible:$.value,"onUpdate:visible":E[0]||(E[0]=s=>$.value=s),header:"实例配置",width:"90%",top:"3vh",attach:"body",footer:!1,class:"settings-dialog"},{default:l(()=>[e("div",Is,[e("div",Bs,[(v(),L(re,null,de(C,(s,g)=>e("div",{key:g,class:ye(["nav-item",{active:f.value===g}]),onClick:z=>f.value=g},[(v(),J(Ge(s.icon),{class:"nav-icon"})),e("span",Es,O(s.label),1)],10,Ls)),64))]),e("div",Ps,[f.value===0?(v(),L("div",As,[t(ol)])):F("",!0),f.value===1?(v(),L("div",Os,[t(kl)])):F("",!0),f.value===2?(v(),L("div",Ds,[t(Ll,{"instance-id":21})])):F("",!0),f.value===3?(v(),L("div",Ns,[t(Rs)])):F("",!0)])])]),_:1},8,["visible"])}}}),zs=ne(Ts,[["__scopeId","data-v-29afc2cf"]]),Fs={class:"monitor-container"},Gs={class:"status-header"},Js={class:"status-text"},js={class:"monitor-content"},Xs={class:"monitor-block"},Ws={class:"info-item"},Ks={class:"label"},qs={class:"value"},Hs={class:"monitor-block"},Ys={class:"info-item"},Zs={class:"label"},Qs={class:"value"},en={key:0,class:"sub-val"},$e=20,tn=se({__name:"InstanceMonitor",props:{serverId:{},maxMemory:{},isRunning:{type:Boolean}},setup(n){const p=n,$=Be(),f=y(null),C=y(null);let w=null,x=null;const E=y(new Array($e).fill(0)),i=y(new Array($e).fill(0)),s=te(()=>p.maxMemory>0),g=(b,_,k=100)=>({grid:{top:4,right:0,bottom:4,left:0},xAxis:{type:"category",show:!1,boundaryGap:!1},yAxis:{type:"value",min:0,max:k===null?void 0:k,show:!1},series:[{type:"line",data:_,smooth:!0,showSymbol:!1,lineStyle:{width:2,color:b},areaStyle:{color:new ta(0,0,0,1,[{offset:0,color:b.replace(")",", 0.2)").replace("rgb","rgba")},{offset:1,color:"transparent"}])}}]}),z=()=>{const b=getComputedStyle(document.documentElement),_=b.getPropertyValue("--td-brand-color").trim()||"#0052d9",k=b.getPropertyValue("--td-warning-color").trim()||"#e37318";if(f.value&&(w=De(f.value),w.setOption(g(_,E.value,100))),C.value){x=De(C.value);const r=s.value?100:null;x.setOption(g(k,i.value,r))}window.addEventListener("resize",A)},A=()=>{w==null||w.resize(),x==null||x.resize()},d=te(()=>{const b=$.stats.memBytes/1024/1024;return b>1024?`${(b/1024).toFixed(2)} GB`:`${b.toFixed(0)} MB`}),T=async()=>{p.isRunning&&p.serverId&&($.setMaxMemory(p.maxMemory),await $.connect(p.serverId))},c=async()=>{await $.disconnect()};return Q(()=>p.maxMemory,b=>{if($.setMaxMemory(b),x){const _=b>0?100:null;x.setOption({yAxis:{max:_===null?void 0:_}})}},{immediate:!0}),Q(()=>$.stats,b=>{if(!(!p.isRunning||$.currentServerId!==p.serverId)){if(E.value.push(b.cpu),E.value.length>$e&&E.value.shift(),s.value)i.value.push(b.memPercent);else{const _=b.memBytes/1024/1024;i.value.push(_)}i.value.length>$e&&i.value.shift(),w==null||w.setOption({series:[{data:E.value}]}),x==null||x.setOption({series:[{data:i.value}]})}},{deep:!0}),Q(()=>p.isRunning,async b=>{b?xe(()=>{A(),T()}):(E.value.fill(0),i.value.fill(0),w==null||w.setOption({series:[{data:E.value}]}),x==null||x.setOption({series:[{data:i.value}]}),await c())}),Q(()=>p.serverId,async(b,_)=>{b!==_&&(await c(),p.isRunning&&await T())}),ce(async()=>{await xe(),z(),p.isRunning&&await T()}),Ce(async()=>{window.removeEventListener("resize",A),await c(),w==null||w.dispose(),x==null||x.dispose()}),(b,_)=>(v(),L("div",Fs,[e("div",Gs,[e("span",Js,[B($).isConnected?(v(),J(B(Ae),{key:0,style:{color:"var(--td-success-color)"}})):(v(),J(B(Ae),{key:1,style:{color:"var(--td-text-color-disabled)"}})),m(" "+O(B($).isConnected?"连接正常":"正在连接数据流..."),1)]),e("div",{class:ye(["monitor-dot",{active:B($).isConnected&&n.isRunning}])},null,2)]),e("div",js,[e("div",Xs,[e("div",Ws,[e("div",Ks,[t(B(Re)),_[0]||(_[0]=m(" CPU 使用率",-1))]),e("div",qs,O(B($).stats.cpu.toFixed(1))+" %",1)]),e("div",{ref_key:"cpuChartRef",ref:f,class:"chart-wrapper"},null,512)]),_[2]||(_[2]=e("div",{class:"divider"},null,-1)),e("div",Hs,[e("div",Ys,[e("div",Zs,[t(B(Gt)),_[1]||(_[1]=m(" 内存使用",-1))]),e("div",Qs,[m(O(d.value)+" ",1),s.value?(v(),L("span",en," ("+O(B($).stats.memPercent.toFixed(1))+"%) ",1)):F("",!0)])]),e("div",{ref_key:"memChartRef",ref:C,class:"chart-wrapper"},null,512)])])]))}}),an=ne(tn,[["__scopeId","data-v-128d3837"]]),ln={class:"sidebar-content"},sn={class:"control-header"},nn={class:"control-actions"},on={class:"action-row"},rn={class:"action-row"},un={class:"card-content-area"},dn={key:0,class:"info-list"},cn={class:"info-item"},vn={class:"label"},mn={class:"value"},pn={class:"info-item"},fn={class:"label"},gn={class:"value"},bn={class:"info-item"},yn={class:"label"},_n={class:"value"},kn={class:"info-item"},hn={class:"label"},wn={class:"value"},$n={class:"info-item"},xn={class:"label"},Cn={class:"value"},Vn={class:"info-item"},Sn={class:"label"},Un={class:"value"},Mn={class:"info-item"},Rn={class:"label"},In={class:"value"},Bn={key:1,class:"info-item"},Ln={class:"label"},En={class:"info-item"},Pn={class:"label"},An={class:"value"},On={key:1,class:"monitor-view"},Dn={key:1,class:"monitor-placeholder"},Nn=se({__name:"ServerControlPanel",props:{serverId:{},isRunning:{type:Boolean},loading:{type:Boolean},serverInfo:{}},emits:["start","stop","clear-log","refresh-info","backup"],setup(n,{emit:p}){const $=n,f=p,C=y(null),w=y("info"),x=()=>{var A;(A=C.value)==null||A.open()},E=()=>{f("refresh-info")},i=y(0);let s=null;const g=A=>{if(!A)return 0;const d=A.match(/^(?:(\d+)\.)?(\d{1,2}):(\d{2}):(\d{2})(?:\.\d+)?$/);return d?parseInt(d[1]||"0",10)*86400+parseInt(d[2])*3600+parseInt(d[3])*60+parseInt(d[4]):0},z=te(()=>{if(i.value<=0)return"00:00:00";const A=Math.floor(i.value/86400),d=new Date(i.value*1e3).toISOString().substr(11,8);return A>0?`${A}天 ${d}`:d});return Q(()=>{var A;return(A=$.serverInfo)==null?void 0:A.uptime},A=>A&&(i.value=g(A)),{immediate:!0}),Q(()=>$.isRunning,A=>{A?s||(s=window.setInterval(()=>i.value++,1e3)):s&&(clearInterval(s),s=null)},{immediate:!0}),Ce(()=>{s&&clearInterval(s)}),(A,d)=>{const T=M("t-tag"),c=M("t-button"),b=M("t-card"),_=M("t-radio-button"),k=M("t-radio-group");return v(),L("div",ln,[t(b,{bordered:!1,class:"control-card"},{default:l(()=>[e("div",sn,[e("div",{class:ye(["status-indicator",{running:n.isRunning}])},[d[6]||(d[6]=e("span",{class:"pulse"},null,-1)),m(O(n.isRunning?"Running":"Stopped"),1)],2),t(T,{theme:n.isRunning?"success":"default",variant:"light",shape:"round"},{default:l(()=>[m(O(n.isRunning?"运行中":"已停止"),1)]),_:1},8,["theme"])]),e("div",nn,[n.isRunning?(v(),J(c,{key:1,theme:"danger",size:"large",block:"",loading:n.loading,onClick:d[1]||(d[1]=r=>A.$emit("stop"))},{icon:l(()=>[t(B(He))]),default:l(()=>[d[8]||(d[8]=m("停止实例 ",-1))]),_:1},8,["loading"])):(v(),J(c,{key:0,theme:"primary",size:"large",block:"",loading:n.loading,onClick:d[0]||(d[0]=r=>{A.$emit("clear-log"),A.$emit("start")})},{icon:l(()=>[t(B(qe))]),default:l(()=>[d[7]||(d[7]=m("启动实例 ",-1))]),_:1},8,["loading"])),e("div",on,[t(c,{class:"glass-btn",variant:"outline",block:"",onClick:d[2]||(d[2]=r=>B(je)(`/instance/files/${n.serverId}`))},{icon:l(()=>[t(B(Oe))]),default:l(()=>[d[9]||(d[9]=m("文件 ",-1))]),_:1}),t(c,{class:"glass-btn",variant:"outline",block:"",disabled:!n.isRunning,loading:n.loading,onClick:d[3]||(d[3]=r=>A.$emit("backup"))},{icon:l(()=>[t(B(Jt))]),default:l(()=>[d[10]||(d[10]=m("备份 ",-1))]),_:1},8,["disabled","loading"])]),e("div",rn,[t(c,{class:"glass-btn",variant:"outline",theme:"warning",block:"",onClick:d[4]||(d[4]=r=>A.$emit("clear-log"))},{icon:l(()=>[t(B(Se))]),default:l(()=>[d[11]||(d[11]=m("清空 ",-1))]),_:1}),t(c,{class:"glass-btn",variant:"outline",theme:"primary",block:"",onClick:x},{icon:l(()=>[t(B(Ye))]),default:l(()=>[d[12]||(d[12]=m("设置 ",-1))]),_:1})])])]),_:1}),t(b,{bordered:!1,title:"实例概览",class:"info-card"},{actions:l(()=>[t(k,{modelValue:w.value,"onUpdate:modelValue":d[5]||(d[5]=r=>w.value=r),variant:"default-filled",size:"small"},{default:l(()=>[t(_,{value:"info"},{default:l(()=>[t(B(Ht)),d[13]||(d[13]=m(" 详情",-1))]),_:1}),t(_,{value:"monitor",disabled:!n.isRunning},{default:l(()=>[t(B(Yt)),d[14]||(d[14]=m(" 监控",-1))]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),default:l(()=>{var r,u,h,I,o,U,D,j,X;return[e("div",un,[w.value==="info"?(v(),L("div",dn,[e("div",cn,[e("div",vn,[t(B(jt)),d[15]||(d[15]=m(" 实例名称",-1))]),e("div",mn,O((r=n.serverInfo)==null?void 0:r.name),1)]),((u=n.serverInfo)==null?void 0:u.java)!=="none"?(v(),L(re,{key:0},[e("div",pn,[e("div",fn,[t(B(Re)),d[16]||(d[16]=m(" 内存限制",-1))]),e("div",gn,O((h=n.serverInfo)==null?void 0:h.maxM)+" MB",1)]),d[22]||(d[22]=e("div",{class:"proxy-group"},null,-1)),e("div",bn,[e("div",yn,[t(B(Xt)),d[17]||(d[17]=m(" 运行端口",-1))]),e("div",_n,O((o=(I=n.serverInfo)==null?void 0:I.mcConfig)==null?void 0:o.serverPort),1)]),e("div",kn,[e("div",hn,[t(B(Wt)),d[18]||(d[18]=m(" 游戏难度",-1))]),e("div",wn,[t(T,{theme:"primary"},{default:l(()=>{var P,N;return[m(O((N=(P=n.serverInfo)==null?void 0:P.mcConfig)==null?void 0:N.difficulty),1)]}),_:1})])]),e("div",$n,[e("div",xn,[t(B(Kt)),d[19]||(d[19]=m(" 游戏模式",-1))]),e("div",Cn,[t(T,null,{default:l(()=>{var P,N;return[m(O((N=(P=n.serverInfo)==null?void 0:P.mcConfig)==null?void 0:N.gamemode),1)]}),_:1})])]),e("div",Vn,[e("div",Sn,[t(B(Oe)),d[20]||(d[20]=m(" 游戏地图",-1))]),e("div",Un,O((D=(U=n.serverInfo)==null?void 0:U.mcConfig)==null?void 0:D.levelName),1)]),e("div",Mn,[e("div",Rn,[t(B(qt)),d[21]||(d[21]=m(" 正版验证",-1))]),e("div",In,[t(T,{theme:((X=(j=n.serverInfo)==null?void 0:j.mcConfig)==null?void 0:X.onlineMode)==="true"?"success":"warning"},{default:l(()=>{var P,N;return[m(O(((N=(P=n.serverInfo)==null?void 0:P.mcConfig)==null?void 0:N.onlineMode)==="true"?"开启":"关闭"),1)]}),_:1},8,["theme"])])])],64)):(v(),L("div",Bn,[e("div",Ln,[t(B(Re)),d[23]||(d[23]=m(" 模式",-1))]),d[24]||(d[24]=e("div",{class:"value"},"自定义模式",-1))])),d[26]||(d[26]=e("div",{class:"proxy-group"},null,-1)),e("div",En,[e("div",Pn,[t(B(Ue)),d[25]||(d[25]=m(" 运行时长",-1))]),e("div",An,O(n.isRunning?z.value:"--:--:--"),1)])])):w.value==="monitor"?(v(),L("div",On,[n.serverInfo&&n.isRunning?(v(),J(an,{key:0,"server-id":n.serverId,"is-running":n.isRunning,"max-memory":n.serverInfo.java==="none"?0:n.serverInfo.maxM||4096},null,8,["server-id","is-running","max-memory"])):(v(),L("div",Dn,"实例未运行"))])):F("",!0)])]}),_:1}),t(zs,{ref_key:"settingsRef",ref:C,"server-id":n.serverId,onSuccess:E},null,8,["server-id"])])}}}),Tn=ne(Nn,[["__scopeId","data-v-c872eff3"]]),zn={class:"console-page"},Fn={class:"layout-container"},Gn={class:"main-terminal-area"},Jn={class:"sidebar-area"},jn={style:{"line-height":"1.6"}},Xn={style:{"margin-bottom":"12px"}},Wn=se({__name:"index",setup(n){const p=be(),$=xt(),f=Be(),C=y(parseInt(p.params.serverId)||0),w=y(!1),x=y(!1),E=y(null),i=y(null);async function s(){var _;if(C.value)try{x.value=!0;const k=await Ct(C.value);await $.refreshInstanceList(),w.value=k.status,E.value=k,x.value=!1}catch(k){(_=i.value)==null||_.writeln(`\x1B[1;31m[Error] 获取实例信息失败: ${k.message}\x1B[0m`),x.value=!1}}const g=async()=>{var _,k;x.value=!0;try{(_=i.value)==null||_.writeln("\x1B[1;32m[System] 正在发送启动指令...\x1B[0m"),await we(C.value,"start"),H.success("实例启动指令已发送"),x.value=!1}catch(r){(k=i.value)==null||k.writeln(`\x1B[1;31m[Error] 启动失败: ${r.message}\x1B[0m`),x.value=!1}},z=async()=>{var _,k;x.value=!0;try{(_=i.value)==null||_.writeln("\x1B[1;32m[System] 正在发送停止指令...\x1B[0m"),await we(C.value,"stop"),H.warning("实例停止指令已发送"),x.value=!1}catch(r){(k=i.value)==null||k.writeln(`\x1B[1;31m[Error] 停止失败: ${r.message}\x1B[0m`),x.value=!1}},A=async()=>{var _,k;try{(_=i.value)==null||_.writeln("\x1B[1;32m[System] 正在发送备份任务...\x1B[0m"),await we(C.value,"backup"),H.success("备份任务启动中···"),x.value=!1}catch(r){(k=i.value)==null||k.writeln(`\x1B[1;31m[Error] 备份任务启动失败: ${r.message}\x1B[0m`)}},d=()=>{var _;(_=i.value)==null||_.clear()},T=y(!1),c=async()=>{C.value&&(f.onEula(()=>{T.value=!0}),await f.connect(C.value))},b=async _=>{try{T.value=!1,await we(C.value,`agreeEula?${_}`),H.success(_?"已发送同意请求":"已发送请求")}catch(k){H.error(k.message||"发送失败")}};return Q(()=>p.params.serverId,async _=>{p.name==="InstanceConsole"&&_&&(C.value=parseInt(_),await s())}),ce(async()=>{C.value&&(await s(),await c())}),(_,k)=>{const r=M("t-link"),u=M("t-dialog");return v(),L("div",zn,[e("div",Fn,[e("div",Gn,[t(ia,{ref_key:"terminalRef",ref:i,"server-id":C.value,onUpdate:k[0]||(k[0]=h=>s())},null,8,["server-id"])]),e("div",Jn,[t(Tn,{"server-id":C.value,"is-running":w.value,loading:x.value,"server-info":E.value,onStart:g,onStop:z,onBackup:A,onClearLog:d},null,8,["server-id","is-running","loading","server-info"])])]),t(u,{visible:T.value,"onUpdate:visible":k[1]||(k[1]=h=>T.value=h),header:"是否同意EULA","confirm-btn":{content:"同意",theme:"primary"},"cancel-btn":{content:"不同意",theme:"default"},onConfirm:k[2]||(k[2]=h=>b(!0)),onCancel:k[3]||(k[3]=h=>b(!1))},{default:l(()=>[e("div",jn,[e("p",Xn,[k[5]||(k[5]=m(" 开启Minecraft服务器需要您同意 ",-1)),k[6]||(k[6]=e("strong",null,"EULA",-1)),k[7]||(k[7]=m(" ！",-1)),t(r,{theme:"primary",underline:""},{default:l(()=>[...k[4]||(k[4]=[m(" (https://aka.ms/minecrafteula)",-1)])]),_:1})]),k[8]||(k[8]=e("p",{style:{"margin-bottom":"12px"}},[e("strong",{style:{color:"#e34d59"}},"请您务必认真仔细阅读！")],-1)),k[9]||(k[9]=e("p",{style:{"margin-bottom":"12px"}},[e("strong",null,"注意："),m("不论您选择是或否，服务器都会在您操作后继续运行。")],-1)),k[10]||(k[10]=e("p",{style:{"margin-bottom":"12px",color:"#f59a23"}},[m(" ⚠️ 如果您"),e("strong",null,"未同意 EULA"),m("，服务器可能会在运行时自动关闭！ ")],-1)),k[11]||(k[11]=e("p",{style:{"margin-top":"16px"}},[m("💡 提示：如要在每次启动实例时忽略此提示，请在"),e("strong",null,"设置"),m("里进行配置。")],-1))])]),_:1},8,["visible"])])}}}),Jo=ne(Wn,[["__scopeId","data-v-955f2165"]]);export{Jo as default};
