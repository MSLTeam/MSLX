import{u as re,b as ie}from"./frp.BiqVjG4L.js";import{c as X,_ as Z,r as B}from"./index.DKJwv0BD.js";import{M as w}from"./tdesign-vue-next.Csn1Y9JM.js";import{l as E,aZ as i,aU as m,aV as x,j as e,a$ as t,G as b,aY as l,r as P,k as ee,w as de,o as ne,a_ as C,F as j,b0 as J,b2 as h,J as T,b3 as H,c as O,f as ue,aW as me,b4 as pe}from"./index.DuVfB4dr.js";import{g as te,f as ce}from"./tools.CQnzORaS.js";import{a7 as se,ac as _e,aa as fe,U as ve,g as ge,ad as be,ab as ye}from"./tdesign-icons-vue-next.BalHEYKK.js";import"./pinia.K9HejpEf.js";import"./pinia-plugin-persistedstate_2eabddac918ad8d0cf74e67f4601f4c8.n2tMOXAx.js";import"./vue-router.BSuyFzNa.js";import"./tvision-color.Cy78gTfV.js";import"./chroma-js.DO2ptVd8.js";import"./core-js-pure.DbDavgKW.js";import"./bezier-easing.D5A5epFU.js";import"./lodash.CpoxsuHF.js";import"./axios.B9ygI19o.js";import"./qs.CsZETzAf.js";import"./side-channel.gyxQHTce.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.CWmL7r7A.js";import"./side-channel-list.DZ_HK50j.js";import"./side-channel-map.Ujj6CYbr.js";import"./get-intrinsic.DZF4l_-S.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.GRuZvLsk.js";import"./dunder-proto.BfGlLUzx.js";import"./call-bind-apply-helpers.DPbVMkjK.js";import"./function-bind.CHqF18-c.js";import"./hasown.B1sN64jK.js";import"./call-bound.DTRAK3sj.js";import"./side-channel-weakmap.D0YmY7JX.js";import"./nprogress.COlaCQ7y.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./lodash-es.sbUBen0f.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";const he=re();async function ae(M,u,g,V="toml"){await ie(M,u,g,V),w.success("添加成功"),await he.getTunnels(),X("/frp/list")}const we={class:"custom-frp-container"},ke=E({__name:"Custom",setup(M){const u=P(null),g=ee({name:"",type:"toml",content:""}),V={name:[{required:!0,message:"请输入隧道名称",type:"error"}],content:[{required:!0,message:"配置文件内容不能为空",type:"error"}]},k=async({validateResult:n})=>{n===!0?await ae(g.name,g.content,"Custom",g.type):w.warning("请检查表单填写")},_=()=>{w.info("表单已重置")};return(n,a)=>{const p=i("t-input"),f=i("t-form-item"),y=i("t-radio-button"),v=i("t-radio-group"),D=i("t-textarea"),c=i("t-button"),s=i("t-space"),z=i("t-form"),L=i("t-card");return m(),x("div",we,[e(L,{bordered:!1},{header:t(()=>[...a[3]||(a[3]=[l("span",{style:{"font-weight":"bold","font-size":"16px"}},"自定义 Frp 隧道",-1)])]),default:t(()=>[e(z,{ref_key:"formRef",ref:u,data:g,rules:V,"label-align":"top",onReset:_,onSubmit:k},{default:t(()=>[e(f,{label:"隧道名称",name:"name"},{default:t(()=>[e(p,{modelValue:g.name,"onUpdate:modelValue":a[0]||(a[0]=R=>g.name=R),placeholder:"请输入隧道名称"},null,8,["modelValue"])]),_:1}),e(f,{label:"配置类型",name:"type"},{default:t(()=>[e(v,{modelValue:g.type,"onUpdate:modelValue":a[1]||(a[1]=R=>g.type=R),variant:"default-filled"},{default:t(()=>[e(y,{value:"toml"},{default:t(()=>[...a[4]||(a[4]=[b("TOML",-1)])]),_:1}),e(y,{value:"ini"},{default:t(()=>[...a[5]||(a[5]=[b("INI",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"隧道配置内容",name:"content"},{default:t(()=>[e(D,{modelValue:g.content,"onUpdate:modelValue":a[2]||(a[2]=R=>g.content=R),placeholder:`[common]
server_addr = 0.0.0.0
server_port = 7000`,autosize:{minRows:10,maxRows:25},class:"code-font-textarea"},null,8,["modelValue"])]),_:1}),e(f,null,{default:t(()=>[e(s,null,{default:t(()=>[e(c,{theme:"primary",type:"submit"},{default:t(()=>[...a[6]||(a[6]=[b("保存配置",-1)])]),_:1}),e(c,{theme:"default",variant:"base",type:"reset"},{default:t(()=>[...a[7]||(a[7]=[b("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})])}}}),xe=Z(ke,[["__scopeId","data-v-1e7af47c"]]),Ve=(M,u="MSL Login",g=500,V=600)=>{if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return window.open(M,"_blank"),null;const _=window.screenLeft!==void 0?window.screenLeft:window.screenX,n=window.screenTop!==void 0?window.screenTop:window.screenY,a=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,p=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,f=a/window.screen.availWidth,y=(a-g)/2/f+_,v=(p-V)/2/f+n,D=`
    scrollbars=yes,
    width=${g/f},
    height=${V/f},
    top=${v},
    left=${y}
  `,c=window.open(M,u,D);return c&&c.focus(),c},$e={class:"custom-option-item"},Pe={class:"node-name-text"},Le={class:"node-tag-group"},Ie={class:"node-detail-area"},Ue={class:"detail-tags-row"},ze={class:"remarks-box"},Ce=E({__name:"CreateTunnelDialog",props:{visible:{type:Boolean},token:{}},emits:["update:visible","success"],setup(M,{emit:u}){const g=M,V=u,k=P(!1),_=P(!1),n=P([]),a=ee({nodeId:null,type:"tcp",localIP:"127.0.0.1",localPort:"25565",remotePort:"",name:"",remarks:"无",bindDomain:"",use_kcp:!1,extra_config:""}),p=O(()=>n.value.find(c=>c.id===a.nodeId)||null),f=O(()=>{const c=[{label:"免费节点",value:0,children:[]},{label:"高级节点",value:1,children:[]},{label:"超级节点",value:2,children:[]}];return n.value.forEach(s=>{const z=c.find(L=>L.value===s.allow_user_group);z&&z.children.push(s)}),c.filter(s=>s.children.length>0)}),y=()=>{if(p.value){const{min_open_port:c,max_open_port:s}=p.value;a.remotePort=(Math.floor(Math.random()*(s-c+1))+c).toString()}a.name=te(8)},v=async()=>{k.value=!0;try{const c=await B.get({url:"/api/frp/nodeList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${g.token}`}});c.code===200&&(n.value=c.data,g.visible&&n.value.length>0&&!a.nodeId&&(a.nodeId=n.value[0].id,y()))}catch(c){w.error("加载节点失败"+c.message)}finally{k.value=!1}};de(()=>g.visible,c=>{c&&(n.value.length>0?(a.nodeId||(a.nodeId=n.value[0].id),y()):v())});const D=async()=>{var c;if(a.nodeId){_.value=!0;try{const s=await B.post({url:"/api/frp/addTunnel",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${g.token}`},data:{id:a.nodeId,type:a.type,local_ip:a.localIP,local_port:a.localPort,remote_port:a.remotePort,name:a.name,remarks:a.remarks,bind_domain:a.bindDomain,use_kcp:((c=p.value)==null?void 0:c.kcp_support)===1?a.use_kcp:!1,extra_config:a.extra_config||null}});s.code===200?(w.success("创建成功"),V("success"),V("update:visible",!1)):w.error(s.msg)}finally{_.value=!1}}};return ne(()=>{g.token&&v()}),(c,s)=>{const z=i("t-tag"),L=i("t-option"),R=i("t-option-group"),q=i("t-select"),K=i("t-col"),W=i("t-button"),G=i("t-row"),U=i("t-form-item"),F=i("t-input"),d=i("t-textarea"),o=i("t-form"),$=i("t-dialog");return m(),C($,{attach:"body",visible:M.visible,header:"新建隧道",width:"580px","confirm-btn":{content:"提交创建",loading:_.value},onConfirm:D,onClose:s[10]||(s[10]=r=>V("update:visible",!1))},{default:t(()=>[e(o,{data:a,"label-align":"right","label-width":100,class:"dialog-inner-form"},{default:t(()=>[e(U,{label:"选择节点",name:"nodeId"},{default:t(()=>[e(G,{gutter:8,style:{width:"100%"}},{default:t(()=>[e(K,{flex:"auto"},{default:t(()=>[e(q,{modelValue:a.nodeId,"onUpdate:modelValue":s[0]||(s[0]=r=>a.nodeId=r),placeholder:"请选择节点",onChange:y},{default:t(()=>[(m(!0),x(j,null,J(f.value,r=>(m(),C(R,{key:r.value,label:r.label},{default:t(()=>[(m(!0),x(j,null,J(r.children,I=>(m(),C(L,{key:I.id,value:I.id,label:I.node},{default:t(()=>[l("div",$e,[l("span",Pe,h(I.node),1),l("div",Le,[e(z,{size:"small",variant:"outline",theme:"primary"},{default:t(()=>[b(h(I.bandwidth)+"M",1)]),_:2},1024),e(z,{size:"small",theme:I.status===1?"success":"danger"},{default:t(()=>[b(h(I.status===1?"在线":"离线"),1)]),_:2},1032,["theme"])])])]),_:2},1032,["value","label"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(K,{flex:"none"},{default:t(()=>[e(W,{variant:"outline",onClick:s[1]||(s[1]=r=>T(X)("https://user.mslmc.net/frp/createTunnel"))},{default:t(()=>[...s[11]||(s[11]=[b(" 前往源站创建 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),p.value?(m(),C(U,{key:0,label:"节点详情"},{default:t(()=>[l("div",Ie,[l("div",Ue,[e(z,{size:"small",variant:"outline",theme:"primary"},{default:t(()=>[b(h(p.value.bandwidth)+"Mbps",1)]),_:1}),e(z,{size:"small",theme:p.value.need_real_name?"success":"warning"},{default:t(()=>[b(h(p.value.need_real_name?"需要实名认证":"无需实名认证"),1)]),_:1},8,["theme"]),e(z,{size:"small",theme:p.value.status===1?"success":"danger"},{default:t(()=>[b(" 节点状态："+h(p.value.status===1?"在线":"离线"),1)]),_:1},8,["theme"])]),l("div",ze,[l("pre",null,h(p.value.remarks||"此节点暂无备注"),1)])])]),_:1})):H("",!0),e(U,{label:"隧道类型"},{default:t(()=>[e(q,{modelValue:a.type,"onUpdate:modelValue":s[2]||(s[2]=r=>a.type=r)},{default:t(()=>{var r,I,N;return[e(L,{label:"TCP",value:"tcp"}),(r=p.value)!=null&&r.udp_support?(m(),C(L,{key:0,label:"UDP",value:"udp"})):H("",!0),(I=p.value)!=null&&I.http_support?(m(),C(L,{key:1,label:"HTTP",value:"http"})):H("",!0),(N=p.value)!=null&&N.http_support?(m(),C(L,{key:2,label:"HTTPS",value:"https"})):H("",!0)]}),_:1},8,["modelValue"])]),_:1}),e(G,{gutter:[16,20]},{default:t(()=>[e(K,{span:6},{default:t(()=>[e(U,{label:"隧道名称"},{default:t(()=>[e(F,{modelValue:a.name,"onUpdate:modelValue":s[3]||(s[3]=r=>a.name=r)},null,8,["modelValue"])]),_:1})]),_:1}),e(K,{span:6},{default:t(()=>[e(U,{label:"远程端口"},{default:t(()=>[e(F,{modelValue:a.remotePort,"onUpdate:modelValue":s[4]||(s[4]=r=>a.remotePort=r)},{suffix:t(()=>[e(W,{variant:"text",size:"small",onClick:y},{default:t(()=>[...s[12]||(s[12]=[b("随机",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(K,{span:6},{default:t(()=>[e(U,{label:"本地IP"},{default:t(()=>[e(F,{modelValue:a.localIP,"onUpdate:modelValue":s[5]||(s[5]=r=>a.localIP=r)},null,8,["modelValue"])]),_:1})]),_:1}),e(K,{span:6},{default:t(()=>[e(U,{label:"本地端口"},{default:t(()=>[e(F,{modelValue:a.localPort,"onUpdate:modelValue":s[6]||(s[6]=r=>a.localPort=r)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a.type.includes("http")?(m(),C(U,{key:1,label:"绑定域名",class:"spacing-item"},{default:t(()=>[e(F,{modelValue:a.bindDomain,"onUpdate:modelValue":s[7]||(s[7]=r=>a.bindDomain=r),placeholder:"输入已解析的域名"},null,8,["modelValue"])]),_:1})):H("",!0),e(U,{label:"备注说明",class:"spacing-item"},{default:t(()=>[e(F,{modelValue:a.remarks,"onUpdate:modelValue":s[8]||(s[8]=r=>a.remarks=r)},null,8,["modelValue"])]),_:1}),e(U,{label:"额外参数",class:"spacing-item"},{default:t(()=>[e(d,{modelValue:a.extra_config,"onUpdate:modelValue":s[9]||(s[9]=r=>a.extra_config=r),autosize:{minRows:2},placeholder:"选填，高级配置参数（不懂清留空！！！）"},null,8,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:1},8,["visible","confirm-btn"])}}}),Se=Z(Ce,[["__scopeId","data-v-8a571b26"]]),Te={class:"page-container"},Me={key:0,class:"login-container"},Re={class:"login-card"},Be={class:"icon-wrapper"},Ae={key:1,class:"dashboard-container"},De={class:"stat-item"},He={class:"value"},Ke={class:"stat-item"},Fe={class:"value"},Ne={class:"stat-item"},Ee={class:"value"},qe={class:"stat-item"},We={class:"value date-text"},Ge={class:"list-header"},Oe={class:"tunnel-list"},Qe=["onClick"],Ye={class:"item-icon"},je={class:"item-content"},Je={class:"item-title"},Xe={class:"item-subtitle"},Ze={class:"item-status"},et={key:0,class:"empty-state"},tt={key:0,class:"detail-content"},at={class:"detail-header"},ot={class:"remarks"},lt={class:"detail-grid"},st={class:"val"},nt={class:"detail-grid"},rt={class:"val uppercase"},it={class:"detail-grid"},dt={class:"val"},ut={class:"detail-grid"},mt={class:"val highlight"},pt={class:"detail-grid"},ct={class:"val"},_t={class:"detail-grid"},ft={class:"val"},vt={class:"action-area"},gt={key:1,class:"empty-detail"},bt=E({__name:"index",setup(M){const u=P(!1),g=()=>{L()},V=P("tKYvKk48Sq5kGAy12IJQxLEKhXx"),k=P(null),_=P(""),n=P(!1),a=P(null),p=P([]),f=P({}),y=P(null),v=O(()=>p.value.find(d=>d.id===y.value)||null),D=O(()=>v.value?f.value[v.value.node_id]||`未知节点 (${v.value.node_id})`:"");ne(()=>{const d=localStorage.getItem("msl-user-token");d&&(_.value=d,L())}),ue(()=>{k.value&&!k.value.closed&&k.value.close()});async function c(){w.info("正在跳转至MSL用户中心登录...");try{const d=te(32),o=await B.post({url:"/api/oauth/createAppLogin",baseURL:"https://user.mslmc.net",data:{appid:V.value,csrf:d}});o.data.ssid?(k.value=Ve(o.data.url,"登录到您的MSL账户",600,600),setTimeout(()=>s(d,o.data.ssid),1e3)):w.error(o.msg)}catch(d){w.error(d.message)}}async function s(d,o){var $;if(!(($=k.value)!=null&&$.closed)){try{const r=await B.get({url:"/api/oauth/appLogin",baseURL:"https://user.mslmc.net",params:{csrf:d,ssid:o}});if(r.data.token){k.value&&k.value.close(),w.success("登录成功"),_.value=r.data.token,localStorage.setItem("msl-user-token",r.data.token),L();return}}catch(r){w.error("登录失败！"+r.message);return}setTimeout(()=>s(d,o),1e3)}}const z=d=>{if(d===0)return"0 B";const o=1024,$=["B","KB","MB","GB","TB"],r=Math.floor(Math.log(d)/Math.log(o));return parseFloat((d/Math.pow(o,r)).toFixed(2))+" "+$[r]};async function L(){n.value=!0;try{const[d,o]=await Promise.all([B.get({url:"/api/frp/userInfo",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${_.value}`}}),B.get({url:"/api/frp/nodeList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${_.value}`}})]);if(d.code===200)a.value=d.data;else{w.warning("登录已过期，请重新登录～"),_.value="",localStorage.removeItem("msl-user-token");return}if(o.code===200){const r={};o.data.forEach(I=>{r[I.id]=I.node}),f.value=r}const $=await B.get({url:"/api/frp/getTunnelList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${_.value}`}});$.code===200&&(p.value=$.data,p.value.length>0&&(y.value=p.value[0].id))}catch(d){w.error("数据加载失败: "+d.message)}finally{n.value=!1}}const R=P(!1);async function q(){if(v.value){R.value=!0;try{const d=await B.get({url:"/api/frp/getTunnelConfig",baseURL:"https://user.mslmc.net",params:{id:v.value.id},headers:{Authorization:`Bearer ${_.value}`}});d.code===200?await ae(v.value.name,d.data,"Index"):w.error(d.msg)}catch(d){w.error("获取配置失败: "+d.message)}R.value=!1}}const K=()=>{u.value=!0};async function W(){try{await B.get({url:"/api/user/logout",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${_.value}`}}),_.value="",a.value=null,p.value=[],localStorage.removeItem("msl-user-token"),w.success("已退出登录")}catch(d){w.error("退出失败: "+d.message)}}async function G(){await L(),w.success("数据已更新")}const U=P(!1);async function F(){if(v.value){U.value=!0;try{const d=await B.post({url:"/api/frp/deleteTunnel",baseURL:"https://user.mslmc.net",data:{id:v.value.id},headers:{Authorization:`Bearer ${_.value}`}});d.code===200?(w.success("隧道删除成功"),y.value=null,await L()):w.error(d.msg||"删除失败")}catch(d){w.error("操作失败: "+d.message)}finally{U.value=!1}}}return(d,o)=>{const $=i("t-button"),r=i("t-space"),I=i("t-loading"),N=i("t-tag"),oe=i("t-popconfirm"),S=i("t-col"),Q=i("t-row"),Y=i("t-card"),le=i("t-divider");return m(),x("div",Te,[_.value===""?(m(),x("div",Me,[l("div",Re,[l("div",Be,[e(T(se),{size:"48px",style:{color:"var(--td-brand-color)"}})]),o[4]||(o[4]=l("h2",{class:"title"},"欢迎登录 MSLFrp",-1)),o[5]||(o[5]=l("p",{class:"subtitle"},"登录您的MSL账户以使用 MSLFrp 服务",-1)),e(r,{direction:"vertical",size:"medium",style:{width:"100%"}},{default:t(()=>[e($,{block:"",theme:"primary",size:"large",onClick:c},{icon:t(()=>[e(T(se))]),default:t(()=>[o[2]||(o[2]=b(" 跳转用户中心登录 ",-1))]),_:1}),e($,{theme:"default",variant:"outline",block:"",size:"large",onClick:o[0]||(o[0]=A=>T(X)("https://user.mslmc.net/register"))},{icon:t(()=>[e(T(_e))]),default:t(()=>[o[3]||(o[3]=b(" 注册 MSL 账户 ",-1))]),_:1})]),_:1})])])):(m(),x("div",Ae,[e(I,{attach:"#app-space",loading:n.value,text:"加载数据中..."},null,8,["loading"]),e(r,{id:"app-space",direction:"vertical",size:"large",style:{width:"100%"}},{default:t(()=>[a.value?(m(),C(Y,{key:0,bordered:!1,title:"MSLFrp 用户信息",class:"info-card"},{actions:t(()=>[e(r,{size:"small"},{default:t(()=>[e(N,{theme:"primary",variant:"light"},{default:t(()=>[b(h(a.value.user_group_name),1)]),_:1}),e(oe,{content:"确认退出登录吗？",onConfirm:W},{default:t(()=>[e($,{variant:"text",theme:"danger",size:"small"},{default:t(()=>[...o[6]||(o[6]=[b(" 退出登录 ",-1)])]),_:1})]),_:1})]),_:1})]),default:t(()=>[e(Q,{gutter:[16,16]},{default:t(()=>[e(S,{xs:6,sm:3},{default:t(()=>[l("div",De,[o[7]||(o[7]=l("div",{class:"label"},"用户昵称",-1)),l("div",He,h(a.value.name),1)])]),_:1}),e(S,{xs:6,sm:3},{default:t(()=>[l("div",Ke,[o[8]||(o[8]=l("div",{class:"label"},"隧道限额",-1)),l("div",Fe,h(a.value.maxTunnelCount)+" 条",1)])]),_:1}),e(S,{xs:6,sm:3},{default:t(()=>[l("div",Ne,[o[9]||(o[9]=l("div",{class:"label"},"速率限制",-1)),l("div",Ee,h(a.value.boundLimit/1024*8)+" Mbps",1)])]),_:1}),e(S,{xs:6,sm:3},{default:t(()=>[l("div",qe,[o[10]||(o[10]=l("div",{class:"label"},"到期时间",-1)),l("div",We,h(T(ce)(a.value.outdated)),1)])]),_:1})]),_:1})]),_:1})):H("",!0),e(Q,{gutter:[16,16]},{default:t(()=>[e(S,{xs:12,md:5,lg:4},{default:t(()=>[e(Y,{bordered:!1,class:"full-height-card"},{title:t(()=>[l("div",Ge,[o[13]||(o[13]=l("span",null,"我的隧道",-1)),e(r,{size:"4px"},{default:t(()=>[e($,{style:{"margin-left":"3px"},size:"small",variant:"text",loading:n.value,onClick:G},{icon:t(()=>[e(T(ve))]),default:t(()=>[o[11]||(o[11]=b(" 刷新 ",-1))]),_:1},8,["loading"]),e($,{size:"small",variant:"text",onClick:K},{icon:t(()=>[e(T(ge))]),default:t(()=>[o[12]||(o[12]=b(" 新建 ",-1))]),_:1})]),_:1})])]),default:t(()=>[l("div",Oe,[(m(!0),x(j,null,J(p.value,A=>(m(),x("div",{key:A.id,class:me(["tunnel-item",{active:y.value===A.id}]),onClick:It=>y.value=A.id},[l("div",Ye,[e(T(fe))]),l("div",je,[l("div",Je,h(A.name),1),l("div",Xe,h(f.value[A.node_id]||`Node ${A.node_id}`),1)]),l("div",Ze,[A.status===1?(m(),C(N,{key:0,theme:"success",variant:"light",size:"small"},{default:t(()=>[...o[14]||(o[14]=[b("在线",-1)])]),_:1})):(m(),C(N,{key:1,theme:"default",variant:"light",size:"small"},{default:t(()=>[...o[15]||(o[15]=[b("未启动",-1)])]),_:1}))])],10,Qe))),128)),p.value.length===0?(m(),x("div",et,"暂无隧道")):H("",!0)])]),_:1})]),_:1}),e(S,{xs:12,md:7,lg:8},{default:t(()=>[e(Y,{bordered:!1,class:"full-height-card"},pe({title:t(()=>[o[16]||(o[16]=l("span",null,"隧道详情",-1))]),default:t(()=>[v.value?(m(),x("div",tt,[l("div",at,[l("h3",null,h(v.value.name),1),l("p",ot,h(v.value.remarks||"暂无备注"),1)]),e(le),e(Q,{gutter:[24,24]},{default:t(()=>[e(S,{span:6},{default:t(()=>[l("div",lt,[o[18]||(o[18]=l("span",{class:"label"},"所在节点",-1)),l("span",st,h(D.value),1)])]),_:1}),e(S,{span:6},{default:t(()=>[l("div",nt,[o[19]||(o[19]=l("span",{class:"label"},"协议类型",-1)),l("span",rt,h(v.value.type),1)])]),_:1}),e(S,{span:6},{default:t(()=>[l("div",it,[o[20]||(o[20]=l("span",{class:"label"},"本地地址",-1)),l("span",dt,h(v.value.local_ip)+":"+h(v.value.local_port),1)])]),_:1}),e(S,{span:6},{default:t(()=>[l("div",ut,[o[21]||(o[21]=l("span",{class:"label"},"远程端口",-1)),l("span",mt,h(v.value.remote_port),1)])]),_:1}),e(S,{span:6},{default:t(()=>[l("div",pt,[o[22]||(o[22]=l("span",{class:"label"},"今日流量",-1)),l("span",ct,h(z(v.value.today_traffic*1024*1024)),1)])]),_:1}),e(S,{span:6},{default:t(()=>[l("div",_t,[o[23]||(o[23]=l("span",{class:"label"},"总流量",-1)),l("span",ft,h(z(v.value.total_traffic*1024*1024)),1)])]),_:1})]),_:1}),e(le),l("div",vt,[e($,{theme:"primary",size:"large",loading:R.value,block:"",onClick:q},{icon:t(()=>[e(T(be))]),default:t(()=>[o[24]||(o[24]=b(" 使用此隧道 ",-1))]),_:1},8,["loading"])])])):(m(),x("div",gt,[e(T(ye),{size:"48px",style:{color:"var(--td-text-color-disabled)"}}),o[25]||(o[25]=l("p",null,"请在左侧选择一个隧道查看详情",-1))]))]),_:2},[v.value?{name:"actions",fn:t(()=>[e(oe,{content:"确认删除此隧道吗？",theme:"danger",placement:"bottom-right",onConfirm:F},{default:t(()=>[e($,{theme:"danger",variant:"text",loading:U.value},{default:t(()=>[...o[17]||(o[17]=[b(" 删除隧道 ",-1)])]),_:1},8,["loading"])]),_:1})]),key:"0"}:void 0]),1024)]),_:1})]),_:1})]),_:1})])),u.value?(m(),C(Se,{key:2,visible:u.value,"onUpdate:visible":o[1]||(o[1]=A=>u.value=A),token:_.value,onSuccess:g},null,8,["visible","token"])):H("",!0)])}}}),yt=Z(bt,[["__scopeId","data-v-3d120868"]]);async function ht(){return await B.get({url:"/query/p2p_server",baseURL:"https://api.mslmc.cn/v3"})}const wt={key:0},kt={key:1},xt={key:0},Vt={key:1},$t={key:0},Pt={key:1},Lt=E({__name:"MSLP2P",setup(M){const u=ee({roomId:"",roomKey:"",bindPort:25565,isHoster:!0}),g={roomId:[{required:!0,message:"请输入房间号",type:"error"}],roomKey:[{required:!0,message:"请输入房间密钥",type:"error"}],bindPort:[{required:!0,message:"请输入绑定端口",type:"error"}]},V=async({validateResult:_})=>{_===!0?await k(u.isHoster,u.roomId,u.roomKey,u.bindPort):w.warning("请检查参数是否全部填写完成！")};async function k(_,n,a,p){try{const f=await ht();let y;_?y=`serverAddr = "${f.ip}"
serverPort = ${f.port}

[[proxies]]
name = "${n}"
type = "xtcp"
secretKey = "${a}"
localIP = "127.0.0.1"
localPort = ${p}`:y=`serverAddr = "${f.ip}"
serverPort = ${f.port}

[[visitors]]
name = "p2p_visitor"
type = "xtcp"
serverName = "${n}"
secretKey = "${a}"
bindAddr = "127.0.0.1"
bindPort = ${p}`,await ae(_?`「联机 - 房主」${n}`:`「联机 - 访客」${n}`,y,"MSL P2P")}catch(f){w.error(`创建联机隧道失败！${f.message}`)}}return(_,n)=>{const a=i("t-radio"),p=i("t-radio-group"),f=i("t-form-item"),y=i("t-input"),v=i("t-button"),D=i("t-form"),c=i("t-card");return m(),x("div",null,[e(c,{bordered:!1},{header:t(()=>[...n[5]||(n[5]=[l("span",{style:{"font-weight":"bold","font-size":"16px"}},"MSL P2P 联机隧道",-1)])]),default:t(()=>[e(D,{data:u,rules:g,"label-width":100,"label-align":"top","reset-type":"initial",onSubmit:V},{default:t(()=>[e(f,{label:"请选择联机类型",name:"isHoster"},{default:t(()=>[e(p,{modelValue:u.isHoster,"onUpdate:modelValue":n[0]||(n[0]=s=>u.isHoster=s)},{default:t(()=>[e(a,{value:!0},{default:t(()=>[...n[6]||(n[6]=[b("创建房间 - 房主",-1)])]),_:1}),e(a,{value:!1},{default:t(()=>[...n[7]||(n[7]=[b("加入房间 - 成员",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"房间号",name:"roomId"},{help:t(()=>[u.isHoster?(m(),x("span",wt,"建议填写您的QQ号码。")):(m(),x("span",kt,"请输入房间创建者提供的房间号。"))]),default:t(()=>[e(y,{modelValue:u.roomId,"onUpdate:modelValue":n[1]||(n[1]=s=>u.roomId=s),placeholder:"请输入房间号"},null,8,["modelValue"])]),_:1}),e(f,{label:"房间密钥",name:"roomKey"},{help:t(()=>[u.isHoster?(m(),x("span",xt,"随便写一个你喜欢的密钥。")):(m(),x("span",Vt,"请输入房间创建者提供的密钥。"))]),default:t(()=>[e(y,{modelValue:u.roomKey,"onUpdate:modelValue":n[2]||(n[2]=s=>u.roomKey=s),placeholder:"请输入房间密钥"},null,8,["modelValue"]),u.isHoster?(m(),C(v,{key:0,theme:"default",variant:"base",style:{"margin-left":"5px"},onClick:n[3]||(n[3]=s=>{u.roomKey=T(te)(16)})},{default:t(()=>[...n[8]||(n[8]=[b("随机生成",-1)])]),_:1})):H("",!0)]),_:1}),e(f,{label:"绑定端口",name:"bindPort"},{help:t(()=>[u.isHoster?(m(),x("span",$t,"请输入游戏内提示的开放联机端口。")):(m(),x("span",Pt,"建议保持默认。"))]),default:t(()=>[e(y,{modelValue:u.bindPort,"onUpdate:modelValue":n[4]||(n[4]=s=>u.bindPort=s),placeholder:"请输入绑定端口"},null,8,["modelValue"])]),_:1}),e(f,{style:{"margin-top":"16px"}},{default:t(()=>[e(v,{theme:"primary",type:"submit"},{default:t(()=>[...n[9]||(n[9]=[b("添加隧道",-1)])]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})])}}}),va=E({__name:"index",setup(M){const u=P(1);return(g,V)=>{const k=i("t-tab-panel"),_=i("t-tabs"),n=i("t-card");return m(),x("div",null,[e(n,{direction:"vertical"},{default:t(()=>[e(_,{modelValue:u.value,"onUpdate:modelValue":V[0]||(V[0]=a=>u.value=a)},{default:t(()=>[e(k,{value:1,label:"MSLFrp","destroy-on-hide":!1},{default:t(()=>[e(yt,{style:{margin:"15px"}})]),_:1}),e(k,{value:2,label:"MSL 联机","destroy-on-hide":!1},{default:t(()=>[e(Lt,{style:{margin:"15px"}})]),_:1}),e(k,{value:3,label:"自定义Frp","destroy-on-hide":!1},{default:t(()=>[e(xe,{style:{margin:"15px"}})]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}});export{va as default};
