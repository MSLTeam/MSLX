import{u as be,b as ye}from"./frp.U0JUx8_N.js";import{c as J,_ as ne,r as N}from"./index.Cr1BKOIM.js";import{M as h,D as he}from"./tdesign-vue-next.4sGFOLeu.js";import{l as ee,aZ as m,aU as c,aV as C,j as e,a$ as t,G as b,a_ as M,b3 as B,aY as l,r as P,k as se,w as ie,o as re,F as Q,b0 as Y,b2 as x,J as I,c as X,f as ke,aW as we}from"./index.DuVfB4dr.js";import{g as de,f as $e}from"./tools.CQnzORaS.js";import{ac as xe,g as _e,a6 as Ve,ad as Ce,_ as Pe,ae as Se,a7 as ce,af as Le,aa as Ue,U as ze,ab as pe,ag as Ie}from"./tdesign-icons-vue-next.ELWhrgRC.js";import"./pinia.K9HejpEf.js";import"./pinia-plugin-persistedstate_2eabddac918ad8d0cf74e67f4601f4c8.n2tMOXAx.js";import"./vue-router.BSuyFzNa.js";import"./tvision-color.Cy78gTfV.js";import"./chroma-js.DO2ptVd8.js";import"./core-js-pure.DbDavgKW.js";import"./bezier-easing.D5A5epFU.js";import"./lodash.CpoxsuHF.js";import"./axios.B9ygI19o.js";import"./qs.B2qFNmGA.js";import"./side-channel.BIlHSgJq.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.CWmL7r7A.js";import"./side-channel-list.DZ_HK50j.js";import"./side-channel-map.DDbmCn0b.js";import"./get-intrinsic.DL3knghB.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.Cbri-GHQ.js";import"./dunder-proto.q7lw_6_J.js";import"./call-bind-apply-helpers.BxcZtPLH.js";import"./function-bind.BbkWVFrm.js";import"./hasown.ckq0ukzO.js";import"./call-bound.Cne7q6oT.js";import"./side-channel-weakmap.BTkyjVO1.js";import"./nprogress.COlaCQ7y.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./lodash-es.sbUBen0f.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";const Me=be();async function ue(K,y,p,A="toml"){await ye(K,y,p,A),h.success("添加成功"),await Me.getTunnels(),J("/frp/list")}const Te={class:"custom-frp-container"},Re=ee({__name:"Custom",setup(K){const y=P(null),p=se({name:"",type:"toml",content:""}),A={name:[{required:!0,message:"请输入隧道名称",type:"error"}],content:[{required:!0,message:"配置文件内容不能为空",type:"error"}]},L=async({validateResult:s})=>{s===!0?await ue(p.name,p.content,"Custom",p.type):h.warning("请检查表单填写")},w=()=>{h.info("表单已重置")},d=()=>{const s=p.content.trim();if(!s){h.warning("请先输入 INI 配置内容");return}const r={tls_enable:"transport.tls.enable",token:"auth.token",protocol:"transport.protocol",pool_count:"transport.poolCount",tcp_mux:"transport.tcpMux",login_fail_exit:"loginFailExit",custom_domains:"customDomains",locations:"locations",host_header_rewrite:"hostHeaderRewrite",role:"role",sk:"sk"};try{const _=s.split(/\r?\n/);let $="";const S={},n=[];let g=null;_.forEach(U=>{const V=U.trim();if(!V||V.startsWith("#")||V.startsWith(";"))return;const T=V.match(/^\[(.+)\]$/);if(T){$=T[1],$==="common"?g=null:(g={name:$},n.push(g));return}const R=V.match(/^([^=]+)=(.*)$/);if(R){const W=R[1].trim();let D=R[2].trim(),q=W;r[W]?q=r[W]:(q=q.replace(/_([a-z])/g,(E,F)=>F.toUpperCase()),q=q.replace(/Ip/g,"IP")),D==="true"?D=!0:D==="false"?D=!1:!isNaN(Number(D))&&D!==""?D=Number(D):D=String(D),$==="common"||!$?S[q]=D:g&&(g[q]=D)}});let u="";Object.entries(S).forEach(([U,V])=>{const T=typeof V=="string"?`"${V}"`:V;u+=`${U} = ${T}
`}),n.forEach(U=>{u+=`
[[proxies]]
`,Object.entries(U).forEach(([V,T])=>{const R=typeof T=="string"?`"${T}"`:T;u+=`${V} = ${R}
`})}),p.content=u.trim(),p.type="toml",h.success("已转换为 TOML")}catch(_){console.error(_),h.error("转换失败，请检查输入格式")}};return(s,r)=>{const _=m("t-input"),$=m("t-form-item"),S=m("t-radio-button"),n=m("t-radio-group"),g=m("t-button"),u=m("t-textarea"),U=m("t-space"),V=m("t-form"),T=m("t-card");return c(),C("div",Te,[e(T,{bordered:!1},{header:t(()=>[...r[3]||(r[3]=[l("span",{style:{"font-weight":"bold","font-size":"16px"}},"自定义 Frp 隧道",-1)])]),default:t(()=>[e(V,{ref_key:"formRef",ref:y,data:p,rules:A,"label-align":"top",onReset:w,onSubmit:L},{default:t(()=>[e($,{label:"隧道名称",name:"name"},{default:t(()=>[e(_,{modelValue:p.name,"onUpdate:modelValue":r[0]||(r[0]=R=>p.name=R),placeholder:"请输入隧道名称"},null,8,["modelValue"])]),_:1}),e($,{label:"配置类型",name:"type"},{default:t(()=>[e(n,{modelValue:p.type,"onUpdate:modelValue":r[1]||(r[1]=R=>p.type=R),variant:"default-filled"},{default:t(()=>[e(S,{value:"toml"},{default:t(()=>[...r[4]||(r[4]=[b("TOML",-1)])]),_:1}),e(S,{value:"ini"},{default:t(()=>[...r[5]||(r[5]=[b("INI",-1)])]),_:1})]),_:1},8,["modelValue"]),p.type==="ini"?(c(),M(g,{key:0,style:{"margin-left":"8px"},variant:"outline",theme:"primary",size:"small",onClick:d},{default:t(()=>[...r[6]||(r[6]=[b(" 一键转 TOML ",-1)])]),_:1})):B("",!0)]),_:1}),e($,{label:"隧道配置内容",name:"content"},{default:t(()=>[e(u,{modelValue:p.content,"onUpdate:modelValue":r[2]||(r[2]=R=>p.content=R),placeholder:`serverAddr = "0.0.0.0"
serverPort = 1027

[[proxies]]
name = "nahida_tcp"
...`,autosize:{minRows:10,maxRows:25},class:"code-font-textarea"},null,8,["modelValue"])]),_:1}),e($,null,{default:t(()=>[e(U,null,{default:t(()=>[e(g,{theme:"primary",type:"submit"},{default:t(()=>[...r[7]||(r[7]=[b("保存配置",-1)])]),_:1}),e(g,{theme:"default",variant:"base",type:"reset"},{default:t(()=>[...r[8]||(r[8]=[b("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})])}}}),Ae=ne(Re,[["__scopeId","data-v-4ef2421f"]]),De=(K,y="MSL Login",p=500,A=600)=>{if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return window.open(K,"_blank"),null;const w=window.screenLeft!==void 0?window.screenLeft:window.screenX,d=window.screenTop!==void 0?window.screenTop:window.screenY,s=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,r=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,_=s/window.screen.availWidth,$=(s-p)/2/_+w,S=(r-A)/2/_+d,n=`
    scrollbars=yes,
    width=${p/_},
    height=${A/_},
    top=${S},
    left=${$}
  `,g=window.open(K,y,n);return g&&g.focus(),g},Be={class:"custom-option-item"},Ne={class:"node-name-text"},Ee={class:"node-tag-group"},Fe={class:"node-detail-area"},He={class:"detail-tags-row"},Ke={class:"remarks-box"},We=ee({__name:"CreateTunnelDialog",props:{visible:{type:Boolean},token:{}},emits:["update:visible","success"],setup(K,{emit:y}){const p=K,A=y,L=P(!1),w=P(!1),d=P([]),s=se({nodeId:null,type:"tcp",localIP:"127.0.0.1",localPort:"25565",remotePort:"",name:"",remarks:"无",bindDomain:"",use_kcp:!1,extra_config:""}),r=X(()=>d.value.find(g=>g.id===s.nodeId)||null),_=X(()=>{const g=[{label:"免费节点",value:0,children:[]},{label:"高级节点",value:1,children:[]},{label:"超级节点",value:2,children:[]}];return d.value.forEach(u=>{const U=g.find(V=>V.value===u.allow_user_group);U&&U.children.push(u)}),g.filter(u=>u.children.length>0)}),$=()=>{if(r.value){const{min_open_port:g,max_open_port:u}=r.value;s.remotePort=(Math.floor(Math.random()*(u-g+1))+g).toString()}s.name=de(8)},S=async()=>{L.value=!0;try{const g=await N.get({url:"/api/frp/nodeList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${p.token}`}});g.code===200&&(d.value=g.data,p.visible&&d.value.length>0&&!s.nodeId&&(s.nodeId=d.value[0].id,$()))}catch(g){h.error("加载节点失败"+g.message)}finally{L.value=!1}};ie(()=>p.visible,g=>{g&&(d.value.length>0?(s.nodeId||(s.nodeId=d.value[0].id),$()):S())});const n=async()=>{var g;if(s.nodeId){w.value=!0;try{const u=await N.post({url:"/api/frp/addTunnel",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${p.token}`},data:{id:s.nodeId,type:s.type,local_ip:s.localIP,local_port:s.localPort,remote_port:s.remotePort,name:s.name,remarks:s.remarks,bind_domain:s.bindDomain,use_kcp:((g=r.value)==null?void 0:g.kcp_support)===1?s.use_kcp:!1,extra_config:s.extra_config||null}});u.code===200?(h.success("创建成功"),A("success"),A("update:visible",!1)):h.error(u.msg)}finally{w.value=!1}}};return re(()=>{p.token&&S()}),(g,u)=>{const U=m("t-tag"),V=m("t-option"),T=m("t-option-group"),R=m("t-select"),W=m("t-col"),D=m("t-button"),q=m("t-row"),E=m("t-form-item"),F=m("t-input"),te=m("t-textarea"),v=m("t-form"),a=m("t-loading"),i=m("t-dialog");return c(),M(i,{attach:"body",visible:K.visible,header:"新建隧道",width:"580px","confirm-btn":{content:"提交创建",loading:w.value},onConfirm:n,onClose:u[10]||(u[10]=o=>A("update:visible",!1))},{default:t(()=>[e(a,{loading:L.value},{default:t(()=>[e(v,{data:s,"label-align":"right","label-width":100,class:"dialog-inner-form"},{default:t(()=>[e(E,{label:"选择节点",name:"nodeId"},{default:t(()=>[e(q,{gutter:8,style:{width:"100%"}},{default:t(()=>[e(W,{flex:"auto"},{default:t(()=>[e(R,{modelValue:s.nodeId,"onUpdate:modelValue":u[0]||(u[0]=o=>s.nodeId=o),placeholder:"请选择节点",onChange:$},{default:t(()=>[(c(!0),C(Q,null,Y(_.value,o=>(c(),M(T,{key:o.value,label:o.label},{default:t(()=>[(c(!0),C(Q,null,Y(o.children,f=>(c(),M(V,{key:f.id,value:f.id,label:f.node},{default:t(()=>[l("div",Be,[l("span",Ne,x(f.node),1),l("div",Ee,[e(U,{size:"small",variant:"outline",theme:"primary"},{default:t(()=>[b(x(f.bandwidth)+"M",1)]),_:2},1024),e(U,{size:"small",theme:f.status===1?"success":"danger"},{default:t(()=>[b(x(f.status===1?"在线":"离线"),1)]),_:2},1032,["theme"])])])]),_:2},1032,["value","label"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(W,{flex:"none"},{default:t(()=>[e(D,{variant:"outline",onClick:u[1]||(u[1]=o=>I(J)("https://user.mslmc.net/frp/createTunnel"))},{default:t(()=>[...u[11]||(u[11]=[b(" 前往源站创建 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),r.value?(c(),M(E,{key:0,label:"节点详情"},{default:t(()=>[l("div",Fe,[l("div",He,[e(U,{size:"small",variant:"outline",theme:"primary"},{default:t(()=>[b(x(r.value.bandwidth)+"Mbps",1)]),_:1}),e(U,{size:"small",theme:r.value.need_real_name?"success":"warning"},{default:t(()=>[b(x(r.value.need_real_name?"需要实名认证":"无需实名认证"),1)]),_:1},8,["theme"]),e(U,{size:"small",theme:r.value.status===1?"success":"danger"},{default:t(()=>[b(" 节点状态："+x(r.value.status===1?"在线":"离线"),1)]),_:1},8,["theme"])]),l("div",Ke,[l("pre",null,x(r.value.remarks||"此节点暂无备注"),1)])])]),_:1})):B("",!0),e(E,{label:"隧道类型"},{default:t(()=>[e(R,{modelValue:s.type,"onUpdate:modelValue":u[2]||(u[2]=o=>s.type=o)},{default:t(()=>{var o,f,O;return[e(V,{label:"TCP",value:"tcp"}),(o=r.value)!=null&&o.udp_support?(c(),M(V,{key:0,label:"UDP",value:"udp"})):B("",!0),(f=r.value)!=null&&f.http_support?(c(),M(V,{key:1,label:"HTTP",value:"http"})):B("",!0),(O=r.value)!=null&&O.http_support?(c(),M(V,{key:2,label:"HTTPS",value:"https"})):B("",!0)]}),_:1},8,["modelValue"])]),_:1}),e(q,{gutter:[16,20]},{default:t(()=>[e(W,{xs:12,sm:6},{default:t(()=>[e(E,{label:"隧道名称"},{default:t(()=>[e(F,{modelValue:s.name,"onUpdate:modelValue":u[3]||(u[3]=o=>s.name=o)},null,8,["modelValue"])]),_:1})]),_:1}),e(W,{xs:12,sm:6},{default:t(()=>[e(E,{label:"远程端口"},{default:t(()=>[e(F,{modelValue:s.remotePort,"onUpdate:modelValue":u[4]||(u[4]=o=>s.remotePort=o)},{suffix:t(()=>[e(D,{variant:"text",size:"small",onClick:$},{default:t(()=>[...u[12]||(u[12]=[b("随机",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(W,{xs:12,sm:6},{default:t(()=>[e(E,{label:"本地IP"},{default:t(()=>[e(F,{modelValue:s.localIP,"onUpdate:modelValue":u[5]||(u[5]=o=>s.localIP=o)},null,8,["modelValue"])]),_:1})]),_:1}),e(W,{xs:12,sm:6},{default:t(()=>[e(E,{label:"本地端口"},{default:t(()=>[e(F,{modelValue:s.localPort,"onUpdate:modelValue":u[6]||(u[6]=o=>s.localPort=o)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),s.type.includes("http")?(c(),M(E,{key:1,label:"绑定域名",class:"spacing-item"},{default:t(()=>[e(F,{modelValue:s.bindDomain,"onUpdate:modelValue":u[7]||(u[7]=o=>s.bindDomain=o),placeholder:"输入已解析的域名"},null,8,["modelValue"])]),_:1})):B("",!0),e(E,{label:"备注说明",class:"spacing-item"},{default:t(()=>[e(F,{modelValue:s.remarks,"onUpdate:modelValue":u[8]||(u[8]=o=>s.remarks=o)},null,8,["modelValue"])]),_:1}),e(E,{label:"额外参数",class:"spacing-item"},{default:t(()=>[e(te,{modelValue:s.extra_config,"onUpdate:modelValue":u[9]||(u[9]=o=>s.extra_config=o),autosize:{minRows:2},placeholder:"选填，高级配置参数（不懂清留空！！！）"},null,8,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:1},8,["loading"])]),_:1},8,["visible","confirm-btn"])}}}),qe=ne(We,[["__scopeId","data-v-a8b2caa6"]]),Oe={key:0,class:"manager-container"},je={class:"toolbar"},Ze={class:"record-list"},Ge={key:0,class:"empty-state"},Je={class:"card-main"},Qe={class:"domain-title"},Ye={class:"sub"},Xe={class:"root"},et={class:"info-badges"},tt=["title"],at={key:0,class:"srv-helper"},ot={class:"card-actions"},lt={key:1,class:"form-container"},nt={class:"form-header"},st={class:"remark-display"},it={key:0,class:"prefix-hint"},rt={class:"row-fields"},dt={class:"form-actions"},ut=ee({__name:"DomainManagerDialog",props:{visible:{type:Boolean},token:{},tunnels:{}},emits:["update:visible"],setup(K,{emit:y}){const p=K,A=y,L=P("list"),w=P("mc_srv"),d=P(!1),s=P(!1),r=P([]),_=P([]),$=P([]),S=P(null),n=se({id:0,domain_id:void 0,name:"",type:"A",record:""}),g=X(()=>p.tunnels?p.tunnels.filter(i=>i.type&&i.type.toUpperCase()==="TCP"):[]),u=X(()=>{const i=_.value.find(o=>o.id===n.domain_id);return i?i.remark:""}),U=async()=>{if(p.token){d.value=!0;try{await Promise.all([V(),T(),R()])}catch(i){console.error(i)}finally{d.value=!1}}},V=async()=>{const i=await N.get({url:"/api/domain/dns/list",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${p.token}`}});i.code===200&&(r.value=i.data||[])},T=async()=>{const i=await N.get({url:"/api/domain/list",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${p.token}`}});i.code===200&&(_.value=i.data||[])},R=async()=>{try{const i=await N.get({url:"/api/frp/nodeList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${p.token}`}});i.code===200&&($.value=i.data||[])}catch(i){console.error("Fetch nodes failed",i)}},W=i=>{const o=p.tunnels.find(f=>f.id===i);if(o){const f=$.value.find(j=>j.id===o.node_id),O=f?f.domain||f.ip:null;O?(n.record=`5 5 ${o.remote_port} ${O}`,h.success("已自动生成解析值")):(h.warning(`无法获取节点(ID:${o.node_id})地址，请手动填写`),n.record=`5 5 ${o.remote_port} 请输入节点地址`),n.type="SRV"}};re(()=>{p.visible&&p.token&&U()}),ie(()=>p.visible,i=>{i&&(L.value="list",U())}),ie(_,i=>{i.length>0&&n.domain_id===void 0&&n.id===0&&(n.domain_id=i[0].id)});const D=i=>i.type!=="SRV"?"":`${i.name.replace("_minecraft._tcp.","")}.${i.domain}`,q=()=>{L.value="form",w.value="mc_srv",S.value=null,n.id=0,n.name="",n.type="SRV",n.record="",_.value.length>0&&(n.domain_id=_.value[0].id)},E=i=>{L.value="form",w.value="custom",n.id=i.id,n.domain_id=Number(i.domain_id),n.name=i.name,n.type=i.type,n.record=i.record},F=()=>{L.value="list"},te=async()=>{const i=n.type.toUpperCase()==="SRV"||w.value==="mc_srv",o=i?/^[a-zA-Z0-9._-]+$/:/^[a-zA-Z0-9]+$/;let f=n.name;if(f.length<1)return h.warning("请输入子域名名称");if(!o.test(f))return h.warning(i?"SRV支持英文、数字、下划线及点":"普通解析仅支持英文数字");w.value==="mc_srv"&&n.id===0&&(f.startsWith("_minecraft._tcp.")||(f="_minecraft._tcp."+f),n.type="SRV"),s.value=!0;const O=n.id!==0?"/api/domain/dns/edit":"/api/domain/dns/add";try{const j=await N.post({url:O,baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${p.token}`},data:{...n,name:f}});j.code===200?(h.success(j.msg||"操作成功"),await V(),L.value="list"):h.error(j.msg)}catch(j){h.error("请求失败: "+j.message)}finally{s.value=!1}},v=async i=>{const o=he.confirm({header:"确认删除",body:"确定要删除这条解析记录吗？删除后无法恢复。",onConfirm:async()=>{o.hide();try{const f=await N.post({url:"/api/domain/dns/delete",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${p.token}`},data:{id:i}});f.code===200?(h.success("删除成功"),V()):h.error(f.msg)}catch(f){h.error(f.message)}}})},a=()=>{A("update:visible",!1)};return(i,o)=>{const f=m("t-button"),O=m("t-empty"),j=m("t-tag"),H=m("t-tooltip"),ae=m("t-loading"),Z=m("t-tab-panel"),oe=m("t-tabs"),z=m("t-option"),le=m("t-select"),G=m("t-form-item"),me=m("t-input"),fe=m("t-form"),ve=m("t-dialog");return c(),M(ve,{visible:K.visible,header:L.value==="list"?"MSLFrp免费子域名管理":n.id===0?"创建新解析":"编辑解析",width:"650px",attach:"body",footer:!1,onClose:a},{default:t(()=>[L.value==="list"?(c(),C("div",Oe,[l("div",je,[e(f,{variant:"text",theme:"default",onClick:o[0]||(o[0]=k=>I(J)("https://www.mslmc.cn/docs/proxy/server-no-port/"))},{icon:t(()=>[e(I(xe))]),default:t(()=>[o[7]||(o[7]=b("查看文档 ",-1))]),_:1}),e(f,{theme:"primary",onClick:q},{icon:t(()=>[e(I(_e))]),default:t(()=>[o[8]||(o[8]=b("新建解析 ",-1))]),_:1})]),e(ae,{loading:d.value,text:"加载中..."},{default:t(()=>[l("div",Ze,[r.value.length===0?(c(),C("div",Ge,[e(O,{title:"暂无解析记录",description:"点击上方按钮创建一个吧"})])):B("",!0),(c(!0),C(Q,null,Y(r.value,k=>(c(),C("div",{key:k.id,class:"record-card"},[l("div",Je,[l("div",Qe,[l("span",Ye,x(k.name),1),l("span",Xe,"."+x(k.domain),1)]),l("div",et,[e(j,{size:"small",theme:k.type==="SRV"?"warning":"primary",variant:"light"},{default:t(()=>[b(x(k.type),1)]),_:2},1032,["theme"]),l("span",{class:"record-value",title:k.record},x(k.record),9,tt)]),k.type==="SRV"?(c(),C("div",at,[e(I(Ve)),l("span",null,[o[9]||(o[9]=b("地址: ",-1)),l("strong",null,x(D(k)),1)])])):B("",!0)]),l("div",ot,[e(H,{content:"编辑"},{default:t(()=>[e(f,{shape:"circle",variant:"text",onClick:ge=>E(k)},{icon:t(()=>[e(I(Ce))]),_:1},8,["onClick"])]),_:2},1024),e(H,{content:"删除"},{default:t(()=>[e(f,{shape:"circle",variant:"text",theme:"danger",onClick:ge=>v(k.id)},{icon:t(()=>[e(I(Pe))]),_:1},8,["onClick"])]),_:2},1024)])]))),128))])]),_:1},8,["loading"])])):(c(),C("div",lt,[l("div",nt,[e(f,{variant:"text",size:"small",onClick:F},{icon:t(()=>[e(I(Se))]),default:t(()=>[o[10]||(o[10]=b(" 返回列表 ",-1))]),_:1})]),n.id===0?(c(),M(oe,{key:0,modelValue:w.value,"onUpdate:modelValue":o[1]||(o[1]=k=>w.value=k),class:"mode-tabs"},{default:t(()=>[e(Z,{value:"mc_srv",label:"MC Java版隐藏端口"}),e(Z,{value:"custom",label:"自定义解析"})]),_:1},8,["modelValue"])):B("",!0),e(fe,{"label-align":"top",data:n,class:"dns-form"},{default:t(()=>[e(G,{label:"选择域名后缀"},{default:t(()=>[e(le,{modelValue:n.domain_id,"onUpdate:modelValue":o[2]||(o[2]=k=>n.domain_id=k),disabled:n.id!==0,placeholder:"请选择后缀",filterable:""},{default:t(()=>[(c(!0),C(Q,null,Y(_.value,k=>(c(),M(z,{key:k.id,value:k.id,label:k.domain},{default:t(()=>[b(x(k.domain),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),u.value?(c(),M(G,{key:0,label:"备注"},{default:t(()=>[l("div",st,x(u.value),1)]),_:1})):B("",!0),e(G,{label:"子域名称",help:"起一个你喜欢的前缀即可"},{default:t(()=>[e(me,{modelValue:n.name,"onUpdate:modelValue":o[3]||(o[3]=k=>n.name=k),placeholder:"例如: myserver"},{"prefix-icon":t(()=>[w.value==="mc_srv"&&n.id===0?(c(),C("span",it,"_minecraft._tcp.")):B("",!0)]),_:1},8,["modelValue"])]),_:1}),w.value==="mc_srv"&&n.id===0?(c(),M(G,{key:1,label:"选择隧道 (自动生成解析值)"},{default:t(()=>[e(le,{modelValue:S.value,"onUpdate:modelValue":o[4]||(o[4]=k=>S.value=k),placeholder:"点击选择已有的 TCP 隧道",onChange:W},{default:t(()=>[(c(!0),C(Q,null,Y(g.value,k=>(c(),M(z,{key:k.id,value:k.id,label:`${k.name} (端口: ${k.remote_port})`},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})):B("",!0),l("div",rt,[e(G,{label:"记录类型",class:"half-width"},{default:t(()=>[e(le,{modelValue:n.type,"onUpdate:modelValue":o[5]||(o[5]=k=>n.type=k)},{default:t(()=>[e(z,{label:"A (IPv4)",value:"A"}),e(z,{label:"CNAME (别名)",value:"CNAME"}),e(z,{label:"AAAA (IPv6)",value:"AAAA"}),e(z,{label:"SRV (服务记录)",value:"SRV"})]),_:1},8,["modelValue"])]),_:1}),e(G,{label:"解析记录值",class:"half-width"},{default:t(()=>[e(me,{modelValue:n.record,"onUpdate:modelValue":o[6]||(o[6]=k=>n.record=k),placeholder:"例: 5 5 25565 node.mslmc.net"},null,8,["modelValue"])]),_:1})]),l("div",dt,[e(f,{theme:"default",variant:"base",onClick:F},{default:t(()=>[...o[11]||(o[11]=[b("取消",-1)])]),_:1}),e(f,{theme:"primary",loading:s.value,onClick:te},{default:t(()=>[b(x(n.id===0?"立即创建":"保存修改"),1)]),_:1},8,["loading"])])]),_:1},8,["data"])]))]),_:1},8,["visible","header"])}}}),mt=ne(ut,[["__scopeId","data-v-e04d368f"]]),ct={class:"page-container"},pt={key:0,class:"login-container"},_t={class:"login-card"},ft={class:"icon-wrapper"},vt={key:1,class:"dashboard-container"},gt={class:"stat-item"},bt={class:"value"},yt={class:"stat-item"},ht={class:"value"},kt={class:"stat-item"},wt={class:"value"},$t={class:"stat-item"},xt={class:"value date-text"},Vt={class:"list-header"},Ct={class:"tunnel-list"},Pt=["onClick"],St={class:"item-icon"},Lt={class:"item-content"},Ut={class:"item-title"},zt={class:"item-subtitle"},It={class:"item-status"},Mt={key:0,class:"empty-state"},Tt={key:0,class:"detail-content"},Rt={class:"detail-header"},At={class:"remarks"},Dt={class:"detail-grid"},Bt={class:"val"},Nt={class:"detail-grid"},Et={class:"val uppercase"},Ft={class:"detail-grid"},Ht={class:"val"},Kt={class:"detail-grid"},Wt={class:"val highlight"},qt={class:"detail-grid"},Ot={class:"val"},jt={class:"detail-grid"},Zt={class:"val"},Gt={class:"action-area"},Jt={key:1,class:"empty-detail"},Qt=ee({__name:"index",setup(K){const y=P(!1),p=P(!1),A=()=>{T()},L=P("tKYvKk48Sq5kGAy12IJQxLEKhXx"),w=P(null),d=P(""),s=P(!1),r=P(null),_=P([]),$=P({}),S=P(null),n=X(()=>_.value.find(v=>v.id===S.value)||null),g=X(()=>n.value?$.value[n.value.node_id]||`未知节点 (${n.value.node_id})`:"");re(()=>{const v=localStorage.getItem("msl-user-token");v&&(d.value=v,T())}),ke(()=>{w.value&&!w.value.closed&&w.value.close()});async function u(){h.info("正在跳转至MSL用户中心登录...");try{const v=de(32),a=await N.post({url:"/api/oauth/createAppLogin",baseURL:"https://user.mslmc.net",data:{appid:L.value,csrf:v}});a.data.ssid?(w.value=De(a.data.url,"登录到您的MSL账户",600,600),setTimeout(()=>U(v,a.data.ssid),1e3)):h.error(a.msg)}catch(v){h.error(v.message)}}async function U(v,a){var i;if(!((i=w.value)!=null&&i.closed)){try{const o=await N.get({url:"/api/oauth/appLogin",baseURL:"https://user.mslmc.net",params:{csrf:v,ssid:a}});if(o.data.token){w.value&&w.value.close(),h.success("登录成功"),d.value=o.data.token,localStorage.setItem("msl-user-token",o.data.token),T();return}}catch(o){h.error("登录失败！"+o.message);return}setTimeout(()=>U(v,a),1e3)}}const V=v=>{if(v===0)return"0 B";const a=1024,i=["B","KB","MB","GB","TB"],o=Math.floor(Math.log(v)/Math.log(a));return parseFloat((v/Math.pow(a,o)).toFixed(2))+" "+i[o]};async function T(){s.value=!0;try{const[v,a]=await Promise.all([N.get({url:"/api/frp/userInfo",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${d.value}`}}),N.get({url:"/api/frp/nodeList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${d.value}`}})]);if(v.code===200)r.value=v.data;else{h.warning("登录已过期，请重新登录～"),d.value="",localStorage.removeItem("msl-user-token");return}if(a.code===200){const o={};a.data.forEach(f=>{o[f.id]=f.node}),$.value=o}const i=await N.get({url:"/api/frp/getTunnelList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${d.value}`}});i.code===200&&(_.value=i.data,_.value.length>0&&(S.value=_.value[0].id))}catch(v){h.error("数据加载失败: "+v.message)}finally{s.value=!1}}const R=P(!1);async function W(){if(n.value){R.value=!0;try{const v=await N.get({url:"/api/frp/getTunnelConfig",baseURL:"https://user.mslmc.net",params:{id:n.value.id},headers:{Authorization:`Bearer ${d.value}`}});v.code===200?await ue(n.value.name,v.data,"MSLFrp"):h.error(v.msg)}catch(v){h.error("获取配置失败: "+v.message)}R.value=!1}}const D=()=>{p.value=!0};async function q(){try{await N.get({url:"/api/user/logout",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${d.value}`}}),d.value="",r.value=null,_.value=[],localStorage.removeItem("msl-user-token"),h.success("已退出登录")}catch(v){h.error("退出失败: "+v.message)}}async function E(){await T(),h.success("数据已更新")}const F=P(!1);async function te(){if(n.value){F.value=!0;try{const v=await N.post({url:"/api/frp/deleteTunnel",baseURL:"https://user.mslmc.net",data:{id:n.value.id},headers:{Authorization:`Bearer ${d.value}`}});v.code===200?(h.success("隧道删除成功"),S.value=null,await T()):h.error(v.msg||"删除失败")}catch(v){h.error("操作失败: "+v.message)}finally{F.value=!1}}}return(v,a)=>{const i=m("t-button"),o=m("t-space"),f=m("t-loading"),O=m("t-tag"),j=m("t-popconfirm"),H=m("t-col"),ae=m("t-row"),Z=m("t-card"),oe=m("t-divider");return c(),C("div",ct,[d.value===""?(c(),C("div",pt,[l("div",_t,[l("div",ft,[e(I(ce),{size:"48px",style:{color:"var(--td-brand-color)"}})]),a[8]||(a[8]=l("h2",{class:"title"},"欢迎登录 MSLFrp",-1)),a[9]||(a[9]=l("p",{class:"subtitle"},"登录您的MSL账户以使用 MSLFrp 服务",-1)),e(o,{direction:"vertical",size:"medium",style:{width:"100%"}},{default:t(()=>[e(i,{block:"",theme:"primary",size:"large",onClick:u},{icon:t(()=>[e(I(ce))]),default:t(()=>[a[6]||(a[6]=b(" 跳转用户中心登录 ",-1))]),_:1}),e(i,{theme:"default",variant:"outline",block:"",size:"large",onClick:a[0]||(a[0]=z=>I(J)("https://user.mslmc.net/register"))},{icon:t(()=>[e(I(Le))]),default:t(()=>[a[7]||(a[7]=b(" 注册 MSL 账户 ",-1))]),_:1})]),_:1})])])):(c(),C("div",vt,[e(f,{attach:"#app-space",loading:s.value,text:"加载数据中..."},null,8,["loading"]),e(o,{id:"app-space",direction:"vertical",size:"large",style:{width:"100%"}},{default:t(()=>[r.value?(c(),M(Z,{key:0,bordered:!1,title:"MSLFrp 用户信息",class:"info-card"},{actions:t(()=>[e(o,{size:"small"},{default:t(()=>[e(i,{variant:"outline",theme:"success",size:"small",onClick:a[1]||(a[1]=z=>I(J)("https://user.mslmc.net/store/buy"))},{default:t(()=>[...a[10]||(a[10]=[b(" 订阅会员服务 ",-1)])]),_:1}),e(O,{theme:"primary",variant:"light-outline"},{default:t(()=>[b(x(r.value.user_group_name),1)]),_:1}),e(j,{content:"确认退出登录吗？",onConfirm:q},{default:t(()=>[e(i,{variant:"outline",theme:"danger",size:"small"},{default:t(()=>[...a[11]||(a[11]=[b(" 退出登录 ",-1)])]),_:1})]),_:1})]),_:1})]),default:t(()=>[e(ae,{gutter:[16,16]},{default:t(()=>[e(H,{xs:6,sm:3},{default:t(()=>[l("div",gt,[a[12]||(a[12]=l("div",{class:"label"},"用户昵称",-1)),l("div",bt,[b(x(r.value.name)+" ",1),e(O,{theme:r.value.realNameStatus?"success":"warning",variant:"dark",size:"small",style:{cursor:"pointer"},onClick:a[2]||(a[2]=z=>I(J)("https://user.mslmc.net/user/profile"))},{default:t(()=>[b(x(r.value.realNameStatus?"已实名":"未实名"),1)]),_:1},8,["theme"])])])]),_:1}),e(H,{xs:6,sm:3},{default:t(()=>[l("div",yt,[a[13]||(a[13]=l("div",{class:"label"},"隧道限额",-1)),l("div",ht,x(r.value.maxTunnelCount)+" 条",1)])]),_:1}),e(H,{xs:6,sm:3},{default:t(()=>[l("div",kt,[a[14]||(a[14]=l("div",{class:"label"},"速率限制",-1)),l("div",wt,x(r.value.boundLimit/1024*8)+" Mbps",1)])]),_:1}),e(H,{xs:6,sm:3},{default:t(()=>[l("div",$t,[a[15]||(a[15]=l("div",{class:"label"},"会员到期时间",-1)),l("div",xt,x(r.value.outdated===3749682420?"长期有效":I($e)(r.value.outdated)),1)])]),_:1})]),_:1})]),_:1})):B("",!0),e(ae,{gutter:[16,16]},{default:t(()=>[e(H,{xs:12,md:5,lg:4},{default:t(()=>[e(Z,{bordered:!1,class:"full-height-card"},{title:t(()=>[l("div",Vt,[a[19]||(a[19]=l("span",null,"我的隧道",-1)),e(o,{size:"4px"},{default:t(()=>[e(i,{style:{"margin-left":"3px"},size:"small",variant:"text",loading:s.value,onClick:E},{icon:t(()=>[e(I(ze))]),default:t(()=>[a[16]||(a[16]=b(" 刷新 ",-1))]),_:1},8,["loading"]),e(i,{size:"small",variant:"text",onClick:a[3]||(a[3]=z=>y.value=!0)},{icon:t(()=>[e(I(pe))]),default:t(()=>[a[17]||(a[17]=b(" 免费子域名 ",-1))]),_:1}),e(i,{size:"small",variant:"text",onClick:D},{icon:t(()=>[e(I(_e))]),default:t(()=>[a[18]||(a[18]=b(" 新建 ",-1))]),_:1})]),_:1})])]),default:t(()=>[l("div",Ct,[(c(!0),C(Q,null,Y(_.value,z=>(c(),C("div",{key:z.id,class:we(["tunnel-item",{active:S.value===z.id}]),onClick:le=>S.value=z.id},[l("div",St,[e(I(Ue))]),l("div",Lt,[l("div",Ut,x(z.name),1),l("div",zt,x($.value[z.node_id]||`Node ${z.node_id}`),1)]),l("div",It,[z.status===1?(c(),M(O,{key:0,theme:"success",variant:"light",size:"small"},{default:t(()=>[...a[20]||(a[20]=[b("在线",-1)])]),_:1})):(c(),M(O,{key:1,theme:"default",variant:"light",size:"small"},{default:t(()=>[...a[21]||(a[21]=[b("未启动",-1)])]),_:1}))])],10,Pt))),128)),_.value.length===0?(c(),C("div",Mt,"暂无隧道")):B("",!0)])]),_:1})]),_:1}),e(H,{xs:12,md:7,lg:8},{default:t(()=>[e(Z,{bordered:!1,class:"full-height-card"},{title:t(()=>[...a[22]||(a[22]=[l("span",null,"隧道详情",-1)])]),actions:t(()=>[n.value?(c(),M(j,{key:0,content:"确认删除此隧道吗？",theme:"danger",placement:"bottom-right",onConfirm:te},{default:t(()=>[e(i,{theme:"danger",variant:"text",loading:F.value},{default:t(()=>[...a[23]||(a[23]=[b(" 删除隧道 ",-1)])]),_:1},8,["loading"])]),_:1})):B("",!0)]),default:t(()=>[n.value?(c(),C("div",Tt,[l("div",Rt,[l("h3",null,x(n.value.name),1),l("p",At,x(n.value.remarks||"暂无备注"),1)]),e(oe),e(ae,{gutter:[24,24]},{default:t(()=>[e(H,{span:6},{default:t(()=>[l("div",Dt,[a[24]||(a[24]=l("span",{class:"label"},"所在节点",-1)),l("span",Bt,x(g.value),1)])]),_:1}),e(H,{span:6},{default:t(()=>[l("div",Nt,[a[25]||(a[25]=l("span",{class:"label"},"协议类型",-1)),l("span",Et,x(n.value.type),1)])]),_:1}),e(H,{span:6},{default:t(()=>[l("div",Ft,[a[26]||(a[26]=l("span",{class:"label"},"本地地址",-1)),l("span",Ht,x(n.value.local_ip)+":"+x(n.value.local_port),1)])]),_:1}),e(H,{span:6},{default:t(()=>[l("div",Kt,[a[27]||(a[27]=l("span",{class:"label"},"远程端口",-1)),l("span",Wt,x(n.value.remote_port),1)])]),_:1}),e(H,{span:6},{default:t(()=>[l("div",qt,[a[28]||(a[28]=l("span",{class:"label"},"今日流量",-1)),l("span",Ot,x(V(n.value.today_traffic*1024*1024)),1)])]),_:1}),e(H,{span:6},{default:t(()=>[l("div",jt,[a[29]||(a[29]=l("span",{class:"label"},"总流量",-1)),l("span",Zt,x(V(n.value.total_traffic*1024*1024)),1)])]),_:1})]),_:1}),e(oe),l("div",Gt,[e(i,{theme:"primary",size:"large",loading:R.value,block:"",onClick:W},{icon:t(()=>[e(I(Ie))]),default:t(()=>[a[30]||(a[30]=b(" 使用此隧道 ",-1))]),_:1},8,["loading"])])])):(c(),C("div",Jt,[e(I(pe),{size:"48px",style:{color:"var(--td-text-color-disabled)"}}),a[31]||(a[31]=l("p",null,"请在左侧选择一个隧道查看详情",-1))]))]),_:1})]),_:1})]),_:1})]),_:1})])),p.value?(c(),M(qe,{key:2,visible:p.value,"onUpdate:visible":a[4]||(a[4]=z=>p.value=z),token:d.value,onSuccess:A},null,8,["visible","token"])):B("",!0),y.value?(c(),M(mt,{key:3,visible:y.value,"onUpdate:visible":a[5]||(a[5]=z=>y.value=z),token:d.value,tunnels:_.value},null,8,["visible","token","tunnels"])):B("",!0)])}}}),Yt=ne(Qt,[["__scopeId","data-v-a5e7f491"]]);async function Xt(){return await N.get({url:"/query/p2p_server",baseURL:"https://api.mslmc.cn/v3"})}const ea={key:0},ta={key:1},aa={key:0},oa={key:1},la={key:0},na={key:1},sa=ee({__name:"MSLP2P",setup(K){const y=se({roomId:"",roomKey:"",bindPort:25565,isHoster:!0}),p={roomId:[{required:!0,message:"请输入房间号",type:"error"}],roomKey:[{required:!0,message:"请输入房间密钥",type:"error"}],bindPort:[{required:!0,message:"请输入绑定端口",type:"error"}]},A=async({validateResult:w})=>{w===!0?await L(y.isHoster,y.roomId,y.roomKey,y.bindPort):h.warning("请检查参数是否全部填写完成！")};async function L(w,d,s,r){try{const _=await Xt();let $;w?$=`serverAddr = "${_.ip}"
serverPort = ${_.port}

[[proxies]]
name = "${d}"
type = "xtcp"
secretKey = "${s}"
localIP = "127.0.0.1"
localPort = ${r}`:$=`serverAddr = "${_.ip}"
serverPort = ${_.port}

[[visitors]]
name = "p2p_visitor"
type = "xtcp"
serverName = "${d}"
secretKey = "${s}"
bindAddr = "127.0.0.1"
bindPort = ${r}`,await ue(w?`「联机 - 房主」${d}`:`「联机 - 访客」${d}`,$,"MSL P2P")}catch(_){h.error(`创建联机隧道失败！${_.message}`)}}return(w,d)=>{const s=m("t-radio"),r=m("t-radio-group"),_=m("t-form-item"),$=m("t-input"),S=m("t-button"),n=m("t-form"),g=m("t-card");return c(),C("div",null,[e(g,{bordered:!1},{header:t(()=>[...d[5]||(d[5]=[l("span",{style:{"font-weight":"bold","font-size":"16px"}},"MSL P2P 联机隧道",-1)])]),default:t(()=>[e(n,{data:y,rules:p,"label-width":100,"label-align":"top","reset-type":"initial",onSubmit:A},{default:t(()=>[e(_,{label:"请选择联机类型",name:"isHoster"},{default:t(()=>[e(r,{modelValue:y.isHoster,"onUpdate:modelValue":d[0]||(d[0]=u=>y.isHoster=u)},{default:t(()=>[e(s,{value:!0},{default:t(()=>[...d[6]||(d[6]=[b("创建房间 - 房主",-1)])]),_:1}),e(s,{value:!1},{default:t(()=>[...d[7]||(d[7]=[b("加入房间 - 成员",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"房间号",name:"roomId"},{help:t(()=>[y.isHoster?(c(),C("span",ea,"建议填写您的QQ号码。")):(c(),C("span",ta,"请输入房间创建者提供的房间号。"))]),default:t(()=>[e($,{modelValue:y.roomId,"onUpdate:modelValue":d[1]||(d[1]=u=>y.roomId=u),placeholder:"请输入房间号"},null,8,["modelValue"])]),_:1}),e(_,{label:"房间密钥",name:"roomKey"},{help:t(()=>[y.isHoster?(c(),C("span",aa,"随便写一个你喜欢的密钥。")):(c(),C("span",oa,"请输入房间创建者提供的密钥。"))]),default:t(()=>[e($,{modelValue:y.roomKey,"onUpdate:modelValue":d[2]||(d[2]=u=>y.roomKey=u),placeholder:"请输入房间密钥"},null,8,["modelValue"]),y.isHoster?(c(),M(S,{key:0,theme:"default",variant:"base",style:{"margin-left":"5px"},onClick:d[3]||(d[3]=u=>{y.roomKey=I(de)(16)})},{default:t(()=>[...d[8]||(d[8]=[b("随机生成",-1)])]),_:1})):B("",!0)]),_:1}),e(_,{label:"绑定端口",name:"bindPort"},{help:t(()=>[y.isHoster?(c(),C("span",la,"请输入游戏内提示的开放联机端口。")):(c(),C("span",na,"建议保持默认。"))]),default:t(()=>[e($,{modelValue:y.bindPort,"onUpdate:modelValue":d[4]||(d[4]=u=>y.bindPort=u),placeholder:"请输入绑定端口"},null,8,["modelValue"])]),_:1}),e(_,{style:{"margin-top":"16px"}},{default:t(()=>[e(S,{theme:"primary",type:"submit"},{default:t(()=>[...d[9]||(d[9]=[b("添加隧道",-1)])]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})])}}}),Za=ee({__name:"index",setup(K){const y=P(1);return(p,A)=>{const L=m("t-tab-panel"),w=m("t-tabs"),d=m("t-card");return c(),C("div",null,[e(d,{direction:"vertical"},{default:t(()=>[e(w,{modelValue:y.value,"onUpdate:modelValue":A[0]||(A[0]=s=>y.value=s)},{default:t(()=>[e(L,{value:1,label:"MSLFrp","destroy-on-hide":!1},{default:t(()=>[e(Yt,{style:{margin:"15px"}})]),_:1}),e(L,{value:2,label:"MSL 联机","destroy-on-hide":!1},{default:t(()=>[e(sa,{style:{margin:"15px"}})]),_:1}),e(L,{value:3,label:"自定义Frp","destroy-on-hide":!1},{default:t(()=>[e(Ae,{style:{margin:"15px"}})]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}});export{Za as default};
