import{D as Y,F as n,R as De,aa as fe,P as J,K as T,b1 as M,b2 as o,b0 as C,aY as r,a$ as u,G as l,ap as D,b5 as V,bl as st,bm as at,bn as lt,bo as ot,bp as nt,bq as it,aX as b,ao as S,b6 as I,b3 as ze,O as Se,am as rt,b7 as ut,bh as ct,b4 as dt,a_ as vt}from"./index.BbdIPky0.js";import{a as mt,u as pt}from"./vue-router.CTuarHf7.js";import{_ as Z,n as ft,o as ht,q as gt,t as bt,v as _t,u as yt,w as kt,c as wt,x as $t,l as Ct,y as xt,z as Pt,A as Ft,C as Ut,D as It,m as Dt}from"./index.AC7et5r1.js";import{T as zt}from"./vue-codemirror.BwymcuFK.js";import{F as St}from"./FileUploader.DPl3W5fj.js";import{a as Vt,e as Bt,aD as Et,aE as Lt,aF as Mt,aG as Rt,U as Tt,au as Nt,f as jt,aH as Kt,aI as Fe,H as Ot,a4 as qt,_ as Wt,aJ as Ue,c as At,M as Gt,aK as Ht,ah as Xt,at as Ie,aL as Jt,ae as Yt,X as Zt}from"./tdesign-icons-vue-next.1welRF8W.js";import{M as v,D as Qt}from"./tdesign-vue-next.DAtQqNrG.js";import"./core-js-pure.DghWRT_o.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./pinia.DE9DXmFR.js";import"./pinia-plugin-persistedstate_561243483b11dd07f5acf9e797fda690.n2tMOXAx.js";import"./tvision-color.BU_YHHaJ.js";import"./chroma-js.Cmk4elvR.js";import"./bezier-easing.jp9ayU57.js";import"./lodash.B5_zCkFd.js";import"./axios.R-lXtGyY.js";import"./qs.CGkucJ2S.js";import"./side-channel.Bf-JVZLg.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.CD-SYzlK.js";import"./cron-parser.BqMfRICj.js";import"./luxon.BVaPVz1w.js";import"./side-channel-list.CQN2BsdT.js";import"./side-channel-map.BJ69Knz3.js";import"./get-intrinsic.CAdfHqt8.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.Cbri-GHQ.js";import"./dunder-proto.q7lw_6_J.js";import"./call-bind-apply-helpers.BxcZtPLH.js";import"./function-bind.BbkWVFrm.js";import"./hasown.ckq0ukzO.js";import"./call-bound.BO70H6sD.js";import"./side-channel-weakmap.BkoVKe_V.js";import"./nprogress.CMq2Rk2a.js";import"./lodash-es.ClUTdtmA.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";import"./codemirror.CEpN6POG.js";const es={class:"editor-container"},ts={class:"editor-status-bar"},ss={class:"mode-tag"},as=Y({__name:"FileEditor",props:{visible:Boolean,fileName:String,content:String,loading:Boolean},emits:["update:visible","save"],setup(U,{emit:B}){const p=U,g=B,f=n(""),h=n(!1);let y=null;const s=()=>{const m=document.documentElement.getAttribute("theme-mode");h.value=m==="dark"};De(()=>{s(),y=new MutationObserver(s),y.observe(document.documentElement,{attributes:!0,attributeFilter:["theme-mode"]})}),fe(()=>{y==null||y.disconnect()}),J(()=>p.content,m=>{f.value=m||""},{immediate:!0});const i=T(()=>{var k,d;const m=[];switch(h.value&&m.push(st),(d=(k=p.fileName)==null?void 0:k.split(".").pop())==null?void 0:d.toLowerCase()){case"json":m.push(it());break;case"yml":case"yaml":m.push(nt());break;case"js":case"ts":m.push(ot());break;case"css":case"less":case"scss":m.push(lt());break;case"html":case"xml":m.push(at());break}return m}),z=()=>{g("update:visible",!1)},_=()=>{g("save",f.value)};return(m,F)=>{const k=C("t-dialog");return r(),M(k,{visible:U.visible,header:`正在编辑: ${U.fileName}`,width:"90%",attach:"body",top:"1vh","confirm-btn":{content:"保存",loading:p.loading,theme:"primary"},class:"editor-dialog",onClose:z,onConfirm:_},{default:o(()=>[u("div",es,[l(D(zt),{modelValue:f.value,"onUpdate:modelValue":F[0]||(F[0]=d=>f.value=d),placeholder:"文件内容为空...",style:{height:"70vh",fontSize:"14px"},autofocus:!0,"indent-with-tab":!0,"tab-size":2,extensions:i.value},null,8,["modelValue","extensions"])]),u("div",ts,[u("span",null,"行数: "+V(f.value.split(`
`).length),1),u("span",null,"长度: "+V(f.value.length),1),u("span",ss,V(h.value?"Dark Mode":"Light Mode"),1)])]),_:1},8,["visible","header","confirm-btn"])}}}),ls=Z(as,[["__scopeId","data-v-97640eff"]]),os={class:"image-wrapper"},ns=["src","alt"],is={key:1,class:"loading-placeholder"},rs=Y({__name:"ImagePreview",props:{visible:{type:Boolean},fileName:{},imageBlobUrl:{}},emits:["update:visible"],setup(U,{emit:B}){const p=B,g=()=>{p("update:visible",!1)};return(f,h)=>{const y=C("t-dialog");return r(),M(y,{visible:U.visible,header:U.fileName,footer:!1,width:"auto",top:"10vh",class:"image-preview-dialog",onClose:g},{default:o(()=>[u("div",os,[U.imageBlobUrl?(r(),b("img",{key:0,src:U.imageBlobUrl,alt:U.fileName},null,8,ns)):(r(),b("div",is,"加载中..."))])]),_:1},8,["visible","header"])}}}),us=Z(rs,[["__scopeId","data-v-9d5acf17"]]),cs={key:0,class:"compress-form"},ds={class:"file-list-preview"},vs={class:"actions"},ms={key:1,class:"progress-view"},ps={class:"status-icon"},fs={class:"status-text"},hs=Y({__name:"FileCompressor",props:{visible:{type:Boolean},instanceId:{},currentPath:{},files:{}},emits:["update:visible","success"],setup(U,{emit:B}){const p=U,g=B,f=n(""),h=n("idle"),y=n(0),s=n("");let i=null;J(()=>p.visible,k=>{k?(h.value="idle",y.value=0,s.value="",p.files.length>0&&(f.value=`${p.files[0]}_packed.zip`)):z()});const z=()=>{i&&(clearInterval(i),i=null)},_=async()=>{if(!f.value.trim()){v.warning("请输入压缩包名称");return}let k=f.value;k.endsWith(".zip")||(k+=".zip"),h.value="processing",y.value=0,s.value="正在提交任务...";try{const L=(await ft(p.instanceId,p.files,k,p.currentPath)).taskId;if(L)m(L);else throw new Error("未获取到任务ID")}catch(d){h.value="error",s.value=d.message||"提交失败"}},m=k=>{i=window.setInterval(async()=>{try{const d=await ht(k);y.value=d.progress,s.value=d.message,d.status==="success"?(z(),h.value="success",y.value=100,setTimeout(()=>{g("success"),g("update:visible",!1)},1e3)):d.status==="error"&&(z(),h.value="error")}catch(d){console.error(d)}},1e3)},F=()=>{h.value==="processing"&&v.warning("后台任务仍在进行中，关闭窗口不会取消任务"),z(),g("update:visible",!1)};return fe(()=>z()),(k,d)=>{const L=C("t-input"),N=C("t-button"),E=C("t-loading"),$=C("t-progress"),x=C("t-dialog");return r(),M(x,{visible:U.visible,header:h.value==="idle"?"创建压缩包":"正在压缩",footer:!1,"close-on-overlay-click":!1,width:"480px",onClose:F},{default:o(()=>[h.value==="idle"?(r(),b("div",cs,[u("div",ds,[d[1]||(d[1]=S(" 即将压缩 ",-1)),u("span",null,V(U.files.length),1),d[2]||(d[2]=S(" 个文件/文件夹 ",-1))]),l(L,{modelValue:f.value,"onUpdate:modelValue":d[0]||(d[0]=O=>f.value=O),placeholder:"请输入文件名",suffix:".zip",autofocus:"",onEnter:_},null,8,["modelValue"]),u("div",vs,[l(N,{theme:"default",variant:"text",onClick:F},{default:o(()=>[...d[3]||(d[3]=[S("取消",-1)])]),_:1}),l(N,{theme:"primary",onClick:_},{default:o(()=>[...d[4]||(d[4]=[S("开始压缩",-1)])]),_:1})])])):(r(),b("div",ms,[u("div",ps,[h.value==="processing"?(r(),M(E,{key:0})):h.value==="success"?(r(),M(D(Vt),{key:1,style:{color:"var(--td-success-color)","font-size":"40px"}})):h.value==="error"?(r(),M(D(Bt),{key:2,style:{color:"var(--td-error-color)","font-size":"40px"}})):I("",!0)]),u("div",fs,V(s.value),1),l($,{theme:"plump",percentage:y.value,status:h.value==="error"?"error":h.value==="success"?"success":"active"},null,8,["percentage","status"])]))]),_:1},8,["visible","header"])}}}),gs=Z(hs,[["__scopeId","data-v-da286579"]]),bs={class:"decompress-container"},_s={class:"file-info"},ys={class:"value"},ks={key:0,class:"form-item"},ws={key:1,class:"switch-row"},$s={key:2,class:"progress-area"},Cs={class:"status-header"},xs={class:"status-text"},Ps={class:"status-percent"},Fs={key:3,class:"actions"},Us=Y({__name:"FileDecompress",props:{visible:{type:Boolean},instanceId:{},currentPath:{},fileName:{}},emits:["update:visible","success"],setup(U,{emit:B}){const p=U,g=B,f=T({get:()=>p.visible,set:$=>g("update:visible",$)}),h=n("auto"),y=n(!0),s=n(!1),i=n(0),z=n(""),_=n("");let m=null;const F=[{label:"自动检测 (推荐)",value:"auto"},{label:"UTF-8 (Linux/Mac通用)",value:"utf-8"},{label:"GBK (Windows传统)",value:"gbk"}],k=()=>{h.value="auto",y.value=!0,s.value=!1,i.value=0,z.value="",_.value="",m&&(clearInterval(m),m=null)};J(()=>p.visible,$=>{$&&k()});const d=()=>{m&&(clearInterval(m),m=null)},L=async()=>{if(!s.value)try{s.value=!0,z.value="正在提交任务...";const $=await gt(p.instanceId,p.fileName,p.currentPath,h.value,y.value);if($&&$.taskId)_.value=$.taskId,m=window.setInterval(N,1e3);else throw new Error("未能获取任务ID")}catch($){v.error($.message||"提交失败"),s.value=!1}},N=async()=>{if(_.value)try{const $=await bt(_.value);i.value=$.progress||0,z.value=$.message,$.status==="success"?(d(),v.success("解压成功"),i.value=100,setTimeout(()=>{f.value=!1,g("success")},800)):$.status==="error"&&(d(),s.value=!1,v.error($.message||"解压出错"))}catch($){console.error("轮询失败",$)}},E=()=>{s.value&&i.value<100&&v.warning("解压正在后台进行中"),d(),f.value=!1};return($,x)=>{const O=C("t-select"),G=C("t-switch"),Q=C("t-progress"),H=C("t-button"),ae=C("t-dialog");return r(),M(ae,{visible:f.value,"onUpdate:visible":x[2]||(x[2]=R=>f.value=R),header:"解压文件",footer:!1,"close-on-overlay-click":!s.value,"on-close":E,width:"480px"},{default:o(()=>[u("div",bs,[u("div",_s,[x[3]||(x[3]=u("span",{class:"label"},"目标文件：",-1)),u("span",ys,V(U.fileName),1)]),s.value?I("",!0):(r(),b("div",ks,[x[4]||(x[4]=u("span",{class:"label"},"文件名编码",-1)),l(O,{modelValue:h.value,"onUpdate:modelValue":x[0]||(x[0]=R=>h.value=R),options:F},null,8,["modelValue"])])),s.value?I("",!0):(r(),b("div",ws,[x[5]||(x[5]=u("div",{class:"switch-info"},[u("span",{class:"switch-label"},"创建同名文件夹"),u("span",{class:"switch-tip"},"推荐开启，防止文件散乱在当前目录")],-1)),l(G,{modelValue:y.value,"onUpdate:modelValue":x[1]||(x[1]=R=>y.value=R)},null,8,["modelValue"])])),s.value?(r(),b("div",$s,[u("div",Cs,[u("span",xs,V(z.value),1),u("span",Ps,V(i.value)+"%",1)]),l(Q,{theme:"line",percentage:i.value,label:!1,status:i.value===100?"success":"active"},null,8,["percentage","status"])])):I("",!0),s.value?I("",!0):(r(),b("div",Fs,[l(H,{variant:"outline",onClick:E},{default:o(()=>[...x[6]||(x[6]=[S("取消",-1)])]),_:1}),l(H,{theme:"primary",onClick:L},{default:o(()=>[...x[7]||(x[7]=[S("开始解压",-1)])]),_:1})]))])]),_:1},8,["visible","close-on-overlay-click"])}}}),Is=Z(Us,[["__scopeId","data-v-9c603684"]]),Ds={class:"permission-form"},zs={class:"presets"},Ss={class:"preset-list"},Vs={key:0,class:"preset-desc"},Bs={key:1,class:"preset-desc"},Es={key:2,class:"preset-desc"},Ls=Y({__name:"FilePermission",props:{visible:{type:Boolean},instanceId:{},currentPath:{},targets:{}},emits:["update:visible","success"],setup(U,{emit:B}){const p=U,g=B,f=n({mode:"755"}),h=n(!1),y=[{label:"755 (推荐: 所有者读写执/他人读执)",value:"755"},{label:"777 (全开: 所有权限)",value:"777"},{label:"644 (普通文件: 读写/读)",value:"644"}],s=T(()=>p.targets.length===1?`修改权限 - ${p.targets[0].name}`:`批量修改权限 (${p.targets.length} 项)`);J(()=>p.visible,m=>{m&&p.targets.length>0&&(p.targets.length===1&&p.targets[0].mode&&p.targets[0].mode!=="Unknown"?f.value.mode=p.targets[0].mode:f.value.mode="755")});const i=()=>{g("update:visible",!1),h.value=!1},z=async()=>{if(!f.value.mode||!/^[0-7]{3}$/.test(f.value.mode)){v.warning("请输入正确的3位八进制权限码 (如 755)");return}h.value=!0;let m=0,F=0;try{for(const k of p.targets)try{await _t(_,k.fullPath,f.value.mode),m++}catch(d){F++,console.error(d)}F===0?v.success("权限修改成功"):v.warning(`完成: 成功 ${m} 个, 失败 ${F} 个`),g("success"),i()}catch(k){v.error(k.message||"请求失败")}finally{h.value=!1}},_=p.instanceId;return(m,F)=>{const k=C("t-input"),d=C("t-form-item"),L=C("t-tag"),N=C("t-dialog");return r(),M(N,{visible:U.visible,header:s.value,"confirm-btn":{content:"保存修改",loading:h.value},"on-close":i,"on-confirm":z,width:"480px"},{default:o(()=>[u("div",Ds,[l(d,{label:"权限代码","required-mark":""},{default:o(()=>[l(k,{modelValue:f.value.mode,"onUpdate:modelValue":F[0]||(F[0]=E=>f.value.mode=E),placeholder:"例如: 755",tips:"请输入3位八进制数字 (Linux Chmod)"},null,8,["modelValue"])]),_:1}),u("div",zs,[F[1]||(F[1]=u("div",{class:"preset-label"},"快捷设置：",-1)),u("div",Ss,[(r(),b(Se,null,ze(y,E=>l(L,{key:E.value,variant:"light-outline",theme:"primary",class:"preset-tag",style:{cursor:"pointer"},onClick:$=>f.value.mode=E.value},{default:o(()=>[S(V(E.value),1)]),_:2},1032,["onClick"])),64))]),f.value.mode==="755"?(r(),b("div",Vs,"适合可执行程序、脚本或文件夹")):I("",!0),f.value.mode==="644"?(r(),b("div",Bs,"适合普通配置文件、日志等")):I("",!0),f.value.mode==="777"?(r(),b("div",Es,"允许任何人写入 (不安全)")):I("",!0)])])]),_:1},8,["visible","header","confirm-btn"])}}}),Ms=Z(Ls,[["__scopeId","data-v-6dc7353c"]]),Rs={class:"file-manager-wrapper"},Ts={class:"toolbar"},Ns={class:"breadcrumb-area"},js={class:"actions-area"},Ks={key:0},Os={key:0},qs={key:0},Ws={class:"table-wrapper"},As=["onClick"],Gs={class:"name-text"},Hs={class:"op-actions"},Xs={key:0,class:"selection-bar"},Js={key:0,class:"selection-info"},Ys={key:1,class:"selection-info"},Zs={class:"selection-actions"},Qs={key:0},ea={key:0},ta={key:0},sa={key:0},aa={key:0},la={key:0},oa={key:1,class:"selection-bar clipboard-bar"},na={class:"selection-info"},ia={key:0},ra={key:1},ua={class:"selection-actions"},ca=Y({__name:"index",setup(U){const B=mt(),p=pt(),g=T(()=>Number(B.params.serverFilesId)),f=yt(),h=n(!1),y=n([]),s=n(""),i=n([]),z=n(window.innerWidth),_=T(()=>z.value<768),m=n(!1),F=n(!1),k=n(!1),d=n(!1),L=n(!1),N=n(!1),E=n(!1),$=n(!1),x=n(!1),O=n(""),G=n(""),Q=n(""),H=n(!1),ae=n(""),R=n(""),ee=n(""),X=n(""),ue=n(null),he=n([]),ge=n(""),le=n([]),be=()=>{z.value=window.innerWidth},oe=t=>{var c;const e=(c=t.split(".").pop())==null?void 0:c.toLowerCase();return["png","jpg","jpeg","gif","ico","webp","bmp","svg"].includes(e||"")},_e=t=>{var c;const e=(c=t.split(".").pop())==null?void 0:c.toLowerCase();return["zip","jar"].includes(e||"")},ye=t=>{var c;if(t.type==="folder"){const w=t.name.toLowerCase();return w==="config"||w==="settings"?{icon:Gt,color:"var(--td-warning-color)"}:w.startsWith("world")||w==="level"?{icon:Ht,color:"var(--td-success-color)"}:["plugins","mods","libraries"].includes(w)?{icon:Xt,color:"var(--td-brand-color)"}:["logs","crash-reports","cache","temp"].includes(w)?{icon:Ie,color:"var(--td-gray-color-6)"}:{icon:Ie,color:"var(--td-brand-color)"}}const e=(c=t.name.split(".").pop())==null?void 0:c.toLowerCase();return["png","jpg","jpeg","gif","ico","webp"].includes(e||"")?{icon:Jt,color:"var(--td-success-color)"}:["jar","zip","rar","7z","tar","gz"].includes(e||"")?{icon:Fe,color:"#722ed1"}:["yml","yaml","json","properties","toml","xml","conf","sh","bat","cmd"].includes(e||"")?{icon:Yt,color:"var(--td-warning-color)"}:["log","txt","md","lock"].includes(e||"")?{icon:Ue,color:"var(--td-gray-color-6)"}:{icon:Zt,color:"var(--td-text-color-secondary)"}},ce=T(()=>y.value.some(t=>t.permission&&t.permission!=="")),Ve=T(()=>{const t={colKey:"row-select",type:"multiple",width:_.value?34:40},e={colKey:"name",title:"文件名",ellipsis:!0,width:"auto"},c={colKey:"operation",title:"操作",width:_.value?50:80,align:"center",fixed:_.value?"right":void 0};return _.value?[t,e,c]:[t,e,{colKey:"size",title:"大小",width:100,align:"right"},...ce.value?[{colKey:"permission",title:"权限",width:80,align:"center"}]:[],{colKey:"lastModified",title:"修改时间",width:180,align:"center"},c]}),Be=T(()=>{const t=s.value.split("/").filter(w=>w),e=[{name:"根目录",path:""}];let c="";return t.forEach(w=>{c=c?`${c}/${w}`:w,e.push({name:w,path:c})}),e}),Ee=T(()=>i.value.length>0),Le=t=>{if(t===0)return"-";const e=["B","KB","MB","GB","TB"];let c=0;for(;t>=1024&&c<e.length-1;)t/=1024,c++;return`${t.toFixed(1)} ${e[c]}`},Me=t=>t?new Date(t).toLocaleString():"-",ne=async()=>{h.value=!0,i.value=[];try{const t=await kt(g.value,s.value);y.value=t||[]}catch(t){console.error(t)}finally{h.value=!1}},de=async t=>{R.value&&(window.URL.revokeObjectURL(R.value),R.value="");const e=s.value?`${s.value}/${t}`:t,c=v.loading("正在加载图片...");try{const w=await $t(g.value,e);if(!(w instanceof Blob))throw new Error("无效数据");R.value=window.URL.createObjectURL(w),ae.value=t,F.value=!0,v.close(c)}catch{v.close(c),v.error("加载失败")}},ve=async(t,e=!1)=>{if(e){G.value=t,Q.value="",m.value=!0;return}if(oe(t)){de(t);return}const c=s.value?`${s.value}/${t}`:t,w=v.loading("正在读取文件...");try{const P=await Ct(g.value,c);G.value=t,Q.value=P,m.value=!0,v.close(w)}catch(P){v.close(w),v.error("读取失败: "+P.message)}},Re=()=>{ee.value="",k.value=!0},ke=()=>{if(!ee.value.trim()){v.warning("请输入文件名");return}k.value=!1,ve(ee.value,!0)},Te=async t=>{H.value=!0;try{const e=s.value?`${s.value}/${G.value}`:G.value;await Dt(g.value,e,t),v.success("保存成功"),m.value=!1,j()}catch{v.error("保存失败")}finally{H.value=!1}},Ne=()=>{O.value="",x.value=!0},we=async()=>{if(!O.value.trim()){v.warning("请输入文件夹名称");return}try{await xt(g.value,s.value,O.value),v.success("文件夹创建成功"),x.value=!1,j()}catch(t){v.error(`创建失败: ${t.message||"未知错误"}`)}},je=t=>{ue.value={name:t.name,fullPath:s.value?`${s.value}/${t.name}`:t.name},X.value=t.name,d.value=!0},$e=async()=>{if(!X.value||!ue.value)return;const t=s.value?`${s.value}/${X.value}`:X.value;try{await Pt(g.value,ue.value.fullPath,t),v.success("重命名成功"),d.value=!1,j()}catch{v.error("重命名失败")}},Ce=t=>{let e=[];if(t?e=[t.name]:e=[...i.value],e.length===0)return;const c=Qt.confirm({header:"确认删除",body:`确定要永久删除这 ${e.length} 项吗？`,theme:"danger",onConfirm:async()=>{try{const w=e.map(P=>s.value?`${s.value}/${P}`:P);await Ft(g.value,w),v.success("删除成功"),i.value=[],j(),c.hide()}catch{v.error("删除失败")}}})},Ke=t=>{if(t.type==="folder"){const e=s.value===""?"":"/";s.value=`${s.value}${e}${t.name}`}else oe(t.name)?de(t.name):ve(t.name)},Oe=t=>{s.value=t},j=()=>ne(),xe=async t=>{var te;let e=[];if(t?e=[t.name]:e=[...i.value],e.length===0)return;const{baseUrl:c,token:w}=f,P=c.endsWith("/")?c.slice(0,-1):c;for(const A of e){if(((te=y.value.find(W=>W.name===A))==null?void 0:te.type)==="folder"){v.warning(`暂不支持下载文件夹: ${A} 请压缩后再下载！`);continue}const me=s.value?`${s.value}/${A}`:A;try{const W=new URL(`${P||window.location.origin}/api/files/instance/${g.value}/download`);W.searchParams.append("path",me),W.searchParams.append("x-user-token",w);const K=document.createElement("a");K.href=W.toString(),K.style.display="none",K.download=A,document.body.appendChild(K),K.click(),document.body.removeChild(K)}catch(W){console.error(W),v.error(`创建下载链接失败: ${A}`)}}t||(i.value=[])},qe=()=>{i.value.length!==0&&(he.value=[...i.value],N.value=!0)},We=()=>{i.value=[],j()},Ae=t=>{ge.value=t.name,E.value=!0},Ge=()=>{j()},Pe=t=>{if(le.value=[],t)le.value.push({name:t.name,fullPath:s.value?`${s.value}/${t.name}`:t.name,mode:t.permission||"755"});else{if(i.value.length===0)return;i.value.forEach(e=>{const c=y.value.find(w=>w.name===e);c&&le.value.push({name:c.name,fullPath:s.value?`${s.value}/${c.name}`:c.name,mode:c.permission||"755"})})}$.value=!0},He=()=>{i.value=[],j()},Xe=()=>j(),q=n([]),ie=n("copy"),re=n(""),Je=T(()=>q.value.length>0),Ye=T(()=>s.value===re.value),Ze=()=>{if(i.value.length===0)return;const t=i.value.map(e=>s.value?`${s.value}/${e}`:e);q.value=t,ie.value="copy",re.value=s.value,i.value=[],v.info(`已复制 ${t.length} 项，请前往目标目录粘贴`)},Qe=()=>{if(i.value.length===0)return;const t=i.value.map(e=>s.value?`${s.value}/${e}`:e);q.value=t,ie.value="move",re.value=s.value,i.value=[],v.info(`已剪切 ${t.length} 项，请前往目标目录粘贴`)},et=()=>{q.value=[],re.value="",v.info("已取消操作")},tt=async()=>{if(q.value.length===0)return;const t=v.loading("正在粘贴中...");try{ie.value==="copy"?await Ut(g.value,q.value,s.value):await It(g.value,q.value,s.value),v.success("粘贴成功"),q.value=[],j()}catch(e){v.error(`粘贴失败: ${e.message||"未知错误"}`)}finally{v.close(t)}};return J(s,t=>{p.replace({query:{...B.query,path:t||void 0}}),ne()}),J(g,()=>{B.name==="InstanceFiles"&&(s.value="",i.value=[],ne())}),De(()=>{const t=B.query.path;window.addEventListener("resize",be),t?s.value=t:ne()}),fe(()=>{window.removeEventListener("resize",be)}),(t,e)=>{const c=C("t-breadcrumb-item"),w=C("t-breadcrumb"),P=C("t-button"),te=C("t-dropdown"),A=C("t-tag"),me=C("t-table"),W=C("t-card"),K=C("t-input"),pe=C("t-dialog");return r(),b("div",Rs,[l(W,{bordered:!1,class:"file-manager-card"},{default:o(()=>[u("div",Ts,[u("div",Ns,[l(w,{"max-item-width":_.value?"80px":"150px"},{default:o(()=>[(r(!0),b(Se,null,ze(Be.value,(a,se)=>(r(),M(c,{key:se,class:"crumb-item",onClick:da=>Oe(a.path)},ut({default:o(()=>[S(" "+V(a.name),1)]),_:2},[se===0?{name:"icon",fn:o(()=>[l(D(Et))]),key:"0"}:void 0]),1032,["onClick"]))),128))]),_:1},8,["max-item-width"])]),u("div",js,[l(P,{variant:"outline",size:"medium",onClick:e[0]||(e[0]=a=>D(wt)(`/instance/console/${g.value}`))},{icon:o(()=>[l(D(Lt))]),default:o(()=>[_.value?I("",!0):(r(),b("span",Ks,"控制台"))]),_:1}),l(te,{options:[{content:"新建文件",value:"file",onClick:Re},{content:"新建文件夹",value:"folder",onClick:Ne}]},{default:o(()=>[l(P,{variant:"outline",size:"medium"},{icon:o(()=>[l(D(Mt))]),default:o(()=>[_.value?I("",!0):(r(),b("span",Os,"新建"))]),_:1})]),_:1},8,["options"]),l(P,{theme:"primary",size:"medium",onClick:e[1]||(e[1]=a=>L.value=!0)},{icon:o(()=>[l(D(Rt))]),default:o(()=>[_.value?I("",!0):(r(),b("span",qs,"上传"))]),_:1}),l(P,{variant:"outline",size:"medium",onClick:j},{icon:o(()=>[l(D(Tt))]),_:1})])]),u("div",Ws,[l(me,{"selected-row-keys":i.value,"onUpdate:selectedRowKeys":e[2]||(e[2]=a=>i.value=a),data:y.value,columns:Ve.value,"row-key":"name",loading:h.value,hover:!0,size:"medium",class:"file-table"},{name:o(({row:a})=>[u("div",{class:"file-name-cell",onClick:ct(se=>Ke(a),["stop"])},[(r(),M(dt(ye(a).icon),{class:"file-icon",style:vt({color:ye(a).color})},null,8,["style"])),u("span",Gs,V(a.name),1)],8,As)]),size:o(({row:a})=>[S(V(Le(a.size)),1)]),permission:o(({row:a})=>[a.permission?(r(),M(A,{key:0,variant:"light",size:"small"},{default:o(()=>[S(V(a.permission),1)]),_:2},1024)):I("",!0)]),lastModified:o(({row:a})=>[S(V(Me(a.lastModified)),1)]),operation:o(({row:a})=>[u("div",Hs,[l(te,{placement:_.value?"bottom-right":"bottom",options:[{content:"解压",value:"decompress",onClick:()=>Ae(a),show:_e(a.name)&&a.type!=="folder"},{content:oe(a.name)?"预览":"编辑",value:"edit",onClick:()=>oe(a.name)?de(a.name):ve(a.name),disabled:a.type==="folder"||_e(a.name)},{content:"权限",value:"permission",onClick:()=>Pe(a),show:ce.value},{content:"下载",value:"download",onClick:()=>xe(a)},{content:"重命名",value:"rename",onClick:()=>je(a)},{content:"删除",value:"delete",theme:"error",onClick:()=>Ce(a)}].filter(se=>se.show!==!1)},{default:o(()=>[l(P,{variant:"text",shape:"square",size:"medium"},{default:o(()=>[l(D(Nt))]),_:1})]),_:1},8,["placement","options"])])]),empty:o(()=>[...e[22]||(e[22]=[u("div",{class:"empty-state"},"暂无文件",-1)])]),_:1},8,["selected-row-keys","data","columns","loading"])])]),_:1}),l(rt,{name:"slide-up"},{default:o(()=>[Ee.value?(r(),b("div",Xs,[_.value?(r(),b("div",Ys,[u("span",null,V(i.value.length),1)])):(r(),b("div",Js,[e[23]||(e[23]=S(" 已选 ",-1)),u("span",null,V(i.value.length),1),e[24]||(e[24]=S(" 项 ",-1))])),u("div",Zs,[l(P,{size:"small",variant:"text",theme:"primary",onClick:e[3]||(e[3]=a=>Ze())},{icon:o(()=>[l(D(jt))]),default:o(()=>[_.value?I("",!0):(r(),b("span",Qs,"复制"))]),_:1}),l(P,{size:"small",variant:"text",theme:"primary",onClick:e[4]||(e[4]=a=>Qe())},{icon:o(()=>[l(D(Kt))]),default:o(()=>[_.value?I("",!0):(r(),b("span",ea,"剪切"))]),_:1}),l(P,{size:"small",variant:"text",theme:"primary",onClick:e[5]||(e[5]=a=>qe())},{icon:o(()=>[l(D(Fe))]),default:o(()=>[_.value?I("",!0):(r(),b("span",ta,"压缩"))]),_:1}),l(P,{size:"small",variant:"text",theme:"primary",onClick:e[6]||(e[6]=a=>xe())},{icon:o(()=>[l(D(Ot))]),default:o(()=>[_.value?I("",!0):(r(),b("span",sa,"下载"))]),_:1}),ce.value?(r(),M(P,{key:0,size:"small",variant:"text",theme:"primary",onClick:e[7]||(e[7]=a=>Pe())},{icon:o(()=>[l(D(qt))]),default:o(()=>[_.value?I("",!0):(r(),b("span",aa,"权限"))]),_:1})):I("",!0),l(P,{size:"small",variant:"text",theme:"danger",onClick:e[8]||(e[8]=a=>Ce())},{icon:o(()=>[l(D(Wt))]),default:o(()=>[_.value?I("",!0):(r(),b("span",la,"删除"))]),_:1}),l(P,{size:"small",variant:"text",onClick:e[9]||(e[9]=a=>i.value=[])},{default:o(()=>[...e[25]||(e[25]=[S("取消",-1)])]),_:1})])])):Je.value?(r(),b("div",oa,[u("div",na,[ie.value==="copy"?(r(),b("span",ia,"准备复制")):(r(),b("span",ra,"准备移动")),u("span",null,V(q.value.length),1),e[26]||(e[26]=S(" 项 ",-1))]),u("div",ua,[l(P,{theme:"primary",disabled:Ye.value,onClick:tt},{icon:o(()=>[l(D(Ue))]),default:o(()=>[e[27]||(e[27]=S(" 粘贴在此处 ",-1))]),_:1},8,["disabled"]),l(P,{variant:"text",theme:"default",onClick:et},{icon:o(()=>[l(D(At))]),default:o(()=>[e[28]||(e[28]=S(" 取消 ",-1))]),_:1})])])):I("",!0)]),_:1}),l(ls,{visible:m.value,"onUpdate:visible":e[10]||(e[10]=a=>m.value=a),"file-name":G.value,content:Q.value,loading:H.value,onSave:Te},null,8,["visible","file-name","content","loading"]),l(pe,{visible:k.value,"onUpdate:visible":e[12]||(e[12]=a=>k.value=a),header:"新建文件","on-confirm":ke},{default:o(()=>[l(K,{modelValue:ee.value,"onUpdate:modelValue":e[11]||(e[11]=a=>ee.value=a),placeholder:"输入文件名",autofocus:!0,onEnter:ke},null,8,["modelValue"])]),_:1},8,["visible"]),l(pe,{visible:d.value,"onUpdate:visible":e[14]||(e[14]=a=>d.value=a),header:"重命名","on-confirm":$e},{default:o(()=>[l(K,{modelValue:X.value,"onUpdate:modelValue":e[13]||(e[13]=a=>X.value=a),placeholder:"输入新名称",autofocus:!0,onEnter:$e},null,8,["modelValue"])]),_:1},8,["visible"]),l(St,{visible:L.value,"onUpdate:visible":e[15]||(e[15]=a=>L.value=a),"instance-id":g.value,"current-path":s.value,onSuccess:Xe},null,8,["visible","instance-id","current-path"]),l(us,{visible:F.value,"onUpdate:visible":e[16]||(e[16]=a=>F.value=a),"file-name":ae.value,"image-blob-url":R.value},null,8,["visible","file-name","image-blob-url"]),l(gs,{visible:N.value,"onUpdate:visible":e[17]||(e[17]=a=>N.value=a),"instance-id":g.value,"current-path":s.value,files:he.value,onSuccess:We},null,8,["visible","instance-id","current-path","files"]),l(Is,{visible:E.value,"onUpdate:visible":e[18]||(e[18]=a=>E.value=a),"instance-id":g.value,"current-path":s.value,"file-name":ge.value,onSuccess:Ge},null,8,["visible","instance-id","current-path","file-name"]),l(Ms,{visible:$.value,"onUpdate:visible":e[19]||(e[19]=a=>$.value=a),"instance-id":g.value,"current-path":s.value,targets:le.value,onSuccess:He},null,8,["visible","instance-id","current-path","targets"]),l(pe,{visible:x.value,"onUpdate:visible":e[21]||(e[21]=a=>x.value=a),header:"新建文件夹","on-confirm":we},{default:o(()=>[l(K,{modelValue:O.value,"onUpdate:modelValue":e[20]||(e[20]=a=>O.value=a),placeholder:"输入文件夹名称",autofocus:!0,onEnter:we},null,8,["modelValue"])]),_:1},8,["visible"])])}}}),sl=Z(ca,[["__scopeId","data-v-1fa8ea78"]]);export{sl as default};
