import{a as ve}from"./vue-router.D-iQ2OF3.js";import{u as Ie,_ as oe,r as ge,d as qe}from"./index.CN3ZU4M_.js";import{D as ie,F as m,P as ae,R as pe,V as Re,aa as he,aX as M,a$ as e,b5 as A,bi as He,bj as Ye,bd as Be,be as Me,aY as d,K as ne,G as a,b0 as _,b2 as s,b6 as D,aZ as be,b1 as X,ap as N,O as re,ao as y,b3 as ue,am as Le,b4 as Pe}from"./index.jXwDIiIy.js";import{c as z}from"./ansi-colors.Byja0Ro8.js";import{g as Ze,b as Qe,u as et,c as tt,d as Ce}from"./instance.CiUTKvDm.js";import{S as at,g as lt,a as st}from"./localJava.x1Uz-edn.js";import{d as nt,i as ot,u as it,f as rt,g as ut,s as dt,a as ct,b as vt}from"./files.B5PWLoXT.js";import{M as K,N as pt,D as we}from"./tdesign-vue-next.B-7BKoqk.js";import{ac as mt,ad as ft,ae as Ve,af as Se,a1 as gt,U as ye,y as bt,_ as Ee,ag as Ae,ah as yt,ai as Oe,aj as _t,z as _e,g as kt,c as ht,ak as wt,a7 as Te,a8 as Ne,ab as $t,M as De,al as xt,am as Ct,an as Vt,ao as St,ap as Ut}from"./tdesign-icons-vue-next.pM9rkfXR.js";import{F as It}from"./FileUploader.BsUTW1H2.js";import{d as Rt}from"./cron-parser.DOnFJhWU.js";import"./pinia.0hRipQgY.js";import"./pinia-plugin-persistedstate.n2tMOXAx.js";import"./tvision-color.C7wwferE.js";import"./chroma-js.CkGq980d.js";import"./bezier-easing.CPMHfRa9.js";import"./lodash.iY27rsMZ.js";import"./axios.R-lXtGyY.js";import"./qs.D0saImlE.js";import"./side-channel.DWC36ANH.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.B1mntT96.js";import"./side-channel-list.Df5Vde-x.js";import"./side-channel-map.4MBLZtF4.js";import"./get-intrinsic.CAdfHqt8.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.Cbri-GHQ.js";import"./dunder-proto.q7lw_6_J.js";import"./call-bind-apply-helpers.BxcZtPLH.js";import"./function-bind.BbkWVFrm.js";import"./hasown.ckq0ukzO.js";import"./call-bound.BO70H6sD.js";import"./side-channel-weakmap.BIAXU6K3.js";import"./nprogress.Nt2Hi8cf.js";import"./core-js-pure.B3GbnEth.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./lodash-es.ClUTdtmA.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";import"./luxon.BVaPVz1w.js";z.enabled=!0;const Bt=r=>r?(r.includes("Done")&&r.includes("!")&&(r=r.replace(/Done \((.*?)\)!/g,(k,I)=>`${z.green.bold("Done")} (${z.blue(I)})!`)),r.startsWith("[System]")&&(r=r.replace(/^\[System\]/,`[${z.blue.bold("System")}]`)),r.includes("[MSLX]")&&(r=r.replace(/\[MSLX\]/g,`[${z.magenta.bold("MSLX")}]`)),r.startsWith(">>>")&&(r=r.replace(/^>>>/,z.red.bold(">>>"))),r=r.replace(/^\[(\d{2}:\d{2}:\d{2})\s+(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]:/,(k,I,c)=>{let U=c;switch(c){case"INFO":U=z.green("INFO");break;case"WARN":case"WARNING":U=z.magenta.bold("WARN");break;case"ERROR":case"FATAL":U=z.red.bold(c);break;case"DEBUG":U=z.blue("DEBUG");break}return`[${z.gray(I)} ${U}]:`}),/^\[\d{2}:\d{2}:\d{2}\]/.test(r)&&(r=r.replace(/^\[(\d{2}:\d{2}:\d{2})\]/,(k,I)=>`[${z.gray(I)}]`)),r=r.replace(/\[([^/]+)\/(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]/g,(k,I,c)=>{const U=z.blue(I);let V=c;switch(c){case"INFO":V=z.green("INFO");break;case"WARN":V=z.magenta("WARN");break;case"ERROR":V=z.red.bold("ERROR");break}return`[${U}/${V}]`}),r=r.replace(new RegExp("(?<=:\\s|^)\\s*\\[([a-zA-Z0-9_\\-.\\s]+)\\](?=\\s)","g"),(k,I)=>I==="System"||I.includes("MSLX")?k:` [${z.bold.black(I)}]`),r=r.replace(/(https?:\/\/[^\s]+)/g,k=>z.blue.underline(k)),r=r.replace(/\b\d+\.\d+(\.\d+)?(-[a-zA-Z0-9]+)?\b/g,k=>z.magenta(k)),r=r.replace(/\b\d+(\.\d+)?\s?(ms|s|%|MB|GB|KB)\b/gi,k=>z.blue(k)),r=r.replace(new RegExp("(?<!\\d:\\d)\\b\\d+\\b(?!\\s*:\\s*\\d)","g"),k=>k.length>=4&&k.length<=6?z.blue(k):k.length<=3?z.blue(k):k),r=r.replace(/(\*:\d{1,5})/,k=>z.blue.bold(k)),r=r.replace(/\b(Loaded|Saved|Starting|Started|Connected)\b/g,k=>z.green(k)),r=r.replace(/\bDone\b(?!\u001b)/g,z.green.bold("Done")),r=r.replace(/\b(Failed|Exception|Error|Caused by|Stopping|Closed)\b/g,k=>z.red.bold(k)),r=r.replace(/\b(Loading|Preparing|Generating|Saving|Using|Running)\b/g,k=>z.magenta(k)),r=r.replace(/\b(Minecraft|Paper|Velocity|Java)\b/gi,k=>z.bold.black(k)),r=r.replace(/'minecraft:[a-z_]+'/g,k=>z.magenta(k)),r=r.replace(/\n/g,`\r
`),r):"",Mt={class:"terminal-header"},Lt={class:"tab-title"},Pt=ie({__name:"ServerTerminal",props:{serverId:{}},emits:["update"],setup(r,{expose:k,emit:I}){const c=r,U=I,V=Ie(),T=m(null),S=m(null);let l=null,o=null,i=null,j=null,x=null,f="";const v={dark:{background:"#181818",foreground:"#cccccc",cursor:"#cccccc",selectionBackground:"#264f78",black:"#000000",red:"#cd3131",green:"#0dbc79",yellow:"#e5e510",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"},light:{background:"#ffffff",foreground:"#333333",cursor:"#333333",selectionBackground:"#add6ff",black:"#000000",red:"#cd3131",green:"#00bc79",yellow:"#9d9d10",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"}};z.enabled=!0;const h=B=>Bt(B),g=()=>{if(!S.value||!T.value)return;if(l){l.clear(),n();return}const B=document.documentElement.getAttribute("theme-mode")==="dark";l=new He.Terminal({cursorBlink:!0,cursorStyle:"block",fontSize:13,fontFamily:'Menlo, Monaco, "Courier New", monospace',lineHeight:1.4,theme:B?v.dark:v.light,disableStdin:!1,convertEol:!0}),o=new Ye.FitAddon,l.loadAddon(o),l.open(S.value),l.onData(W=>{P(W)});const q=()=>{if(S.value&&S.value.clientWidth>0&&S.value.clientHeight>0)try{o==null||o.fit()}catch(W){console.warn(W)}};i=new ResizeObserver(()=>window.requestAnimationFrame(q)),i.observe(T.value),setTimeout(q,100),n()},P=async B=>{!l||!c.serverId||(B==="\r"?(l.write(`\r
`),f.trim()&&await E(f),f=""):B===""?f.length>0&&(f=f.slice(0,-1),l.write("\b \b")):B>=" "&&(f+=B,l.write(B)))},E=async B=>{if(!x){l==null||l.writeln("\x1B[1;31m[System] 未连接到控制服务，无法发送指令。\x1B[0m");return}try{await x.invoke("SendCommand",c.serverId,B)}catch(q){l==null||l.writeln(`\x1B[1;31m[Error] 指令发送失败: ${q.message}\x1B[0m`)}},b=()=>{if(!l)return;const B=document.documentElement.getAttribute("theme-mode")==="dark";l.options.theme=B?v.dark:v.light},n=()=>{l==null||l.writeln("\x1B[1;34m[System]\x1B[0m 正在连接服务器控制台 ..."),l==null||l.writeln(`\x1B[1;34m[System]\x1B[0m 实例 ID: ${c.serverId}`),l==null||l.writeln("\x1B[90mTip: 直接输入指令并回车即可发送到服务器。\x1B[0m"),l==null||l.writeln("")},p=async()=>{if(x)try{x.state==="Connected"&&await x.invoke("LeaveGroup",c.serverId),await x.stop(),x=null}catch(B){console.error(B)}},$=async()=>{if(await p(),!c.serverId)return;const{baseUrl:B,token:q}=V,W=new URL("/api/hubs/instanceControlHub",B||window.location.origin);q&&W.searchParams.append("x-user-token",q),x=new Be().withUrl(W.toString(),{withCredentials:!1}).configureLogging(Me.Warning).withAutomaticReconnect([0,2e3,5e3,1e4,3e4]).build(),x.on("ReceiveLog",H=>{l==null||l.writeln(h(H)),H.startsWith("[MSLX]")&&U("update")}),x.on("CommandResult",(H,Y)=>{H||l==null||l.writeln(`\x1B[1;31m[System] 指令执行反馈: ${Y}\x1B[0m`)}),x.onreconnecting(()=>{l==null||l.writeln("\x1B[1;31m[System] 连接中断，尝试重连...\x1B[0m")}),x.onreconnected(async()=>{l==null||l.writeln("\x1B[1;32m[System] 网络恢复，重新订阅日志...\x1B[0m");try{await(x==null?void 0:x.invoke("JoinGroup",c.serverId))}catch(H){l==null||l.writeln(`\x1B[1;31m[Error] 重新订阅失败: ${H.message}\x1B[0m`)}}),x.onclose(H=>{H&&(l==null||l.writeln(`\x1B[1;31m[System] 连接已断开: ${H.message}\x1B[0m`))});try{await x.start(),l==null||l.writeln("\x1B[1;32m[System] 已连接到实例控制服务\x1B[0m"),await x.invoke("JoinGroup",c.serverId)}catch(H){l==null||l.writeln(`\x1B[1;31m[Error] 连接失败: ${H.message}\x1B[0m`)}};return k({writeln:B=>l==null?void 0:l.writeln(B),clear:()=>{l==null||l.clear(),n()}}),ae(()=>c.serverId,async B=>{B&&(g(),await $())}),pe(async()=>{await Re(),g(),j=new MutationObserver(b),j.observe(document.documentElement,{attributes:!0,attributeFilter:["theme-mode"]}),c.serverId&&await $()}),he(async()=>{j==null||j.disconnect(),await p(),l==null||l.dispose(),i==null||i.disconnect()}),(B,q)=>(d(),M("div",{ref_key:"terminalWrapper",ref:T,class:"terminal-wrapper"},[e("div",Mt,[q[0]||(q[0]=e("div",{class:"dots"},[e("span",{class:"dot red"}),e("span",{class:"dot yellow"}),e("span",{class:"dot green"})],-1)),e("div",Lt,"MSLX 服务端控制台 | #"+A(r.serverId),1)]),e("div",{ref_key:"terminalBody",ref:S,class:"terminal-body"},null,512)],512))}}),Et=oe(Pt,[["__scopeId","data-v-69c2e437"]]),At={class:"settings-container"},Ot={class:"setting-item"},Tt={class:"setting-control"},Nt={class:"setting-item"},Dt={class:"setting-info"},Ft={class:"desc"},zt={class:"setting-control"},Jt={class:"setting-item"},jt={class:"setting-control"},Gt={key:0,style:{"margin-top":"8px"}},Xt={class:"setting-item"},Wt={class:"setting-info"},Kt={class:"title"},qt={class:"desc"},Ht={class:"setting-control"},Yt={class:"setting-item"},Zt={class:"setting-control"},Qt={key:0,class:"core-tools-panel"},ea={key:0,class:"upload-progress"},ta={class:"setting-item"},aa={class:"setting-control flex-row"},la={class:"setting-item"},sa={class:"setting-control flex-row"},na={class:"setting-info-desc-only"},oa={style:{"font-size":"12px",color:"var(--td-text-color-placeholder)",cursor:"help"}},ia={class:"setting-item"},ra={class:"setting-control"},ua={key:0,style:{"margin-top":"8px"}},da={key:2,class:"setting-group-title"},ca={key:3,class:"setting-item"},va={class:"setting-control"},pa={key:0,style:{"margin-top":"8px"}},ma={class:"setting-item"},fa={class:"setting-control"},ga={class:"setting-item"},ba={class:"setting-control"},ya={class:"setting-item"},_a={class:"setting-control flex-row"},ka={class:"setting-item"},ha={class:"setting-control flex-row"},wa={class:"form-actions"},$a={class:"progress-body"},xa={id:"update-log-box",class:"log-box"},Ca={class:"time"},Va={key:0,class:"dialog-actions"},Sa=ie({__name:"GeneralSettings",setup(r){const k=ve(),I=Ie(),c=parseInt(k.params.id),U=m(null),V=m(!1),T=m(!1),S=m(!1),l=[{label:"UTF-8",value:"utf-8"},{label:"GBK",value:"gbk"}],o=m({id:c,name:"",base:"",java:"",core:"",minM:1024,maxM:4096,args:"",yggdrasilApiAddr:"",backupMaxCount:20,backupDelay:10,backupPath:"MSLX://Backup/Instance",autoRestart:!1,runOnStartup:!1,inputEncoding:"utf-8",outputEncoding:"utf-8",fileEncoding:"utf-8",coreUrl:"",coreSha256:"",coreFileKey:""}),i=m("custom"),j=m([]),x=m([]),f=m(""),v=m(""),h=async(R=!1)=>{try{R&&K.info("正在扫描 Java 环境...");const t=await lt(I.userInfo.systemInfo.osType.toLowerCase().replace("os",""),I.userInfo.systemInfo.osArchitecture.toLowerCase());t&&Array.isArray(t)&&(j.value=t.map(J=>({label:`Java ${J} (在线)`,value:J})));const G=await st(R);x.value=G.map(J=>({label:`Java ${J.version} (${J.path})`,value:J.path})),R&&K.success("刷新成功")}catch(t){console.error(t)}};ae([i,f,v],([R,t,G])=>{R==="none"?o.value.java="none":R==="env"?o.value.java="java":R==="custom"||R==="local"?o.value.java=G:R==="online"&&(o.value.java=t?`MSLX://Java/${t}`:"")});const g=m("MSLX://Backup/Instance"),P=m("");ae([g,P],([R,t])=>{R==="custom"?o.value.backupPath=t:o.value.backupPath=R});const E=m(""),b=m(""),n=[{label:"官方/离线模式 (无)",value:"none"},{label:"MSL 统一身份验证",value:"https://skin.mslmc.net/api/yggdrasil"},{label:"LittleSkin",value:"https://littleskin.cn/api/yggdrasil"},{label:"自定义服务器",value:"custom"}];ae([E,b],([R,t])=>{R==="none"?o.value.yggdrasilApiAddr="":R==="custom"?o.value.yggdrasilApiAddr=t:o.value.yggdrasilApiAddr=R});const p=m(!1),$=m(!1),u=m(null),w=m(!1),B=m(0),q=m(""),W=R=>{o.value.core=R.filename,o.value.coreUrl=R.url,o.value.coreSha256=R.sha256,o.value.coreFileKey="",p.value=!1,K.success(`已选择核心: ${R.filename}，保存后将自动下载`)},H=()=>{var R;return(R=u.value)==null?void 0:R.click()},Y=async R=>{var J;const t=R.target;if(!((J=t.files)!=null&&J.length))return;const G=t.files[0];if(o.value.coreFileKey)try{await nt(o.value.coreFileKey)}catch{console.error("删除上传失败")}q.value=G.name,w.value=!0,B.value=0;try{const Q=(await ot()).uploadId,te=5*1024*1024,de=Math.ceil(G.size/te);for(let se=0;se<de;se++){const ke=G.slice(se*te,Math.min(G.size,(se+1)*te));await it(Q,se,ke),B.value=Math.floor((se+1)/de*100)}const ce=await rt(Q,de);o.value.coreFileKey=ce.uploadId,o.value.core=G.name,o.value.coreUrl="",K.success("文件上传就绪，保存后生效"),p.value=!1}catch(ee){K.error(`上传失败: ${ee.message}`)}finally{w.value=!1,t.value=""}},le=()=>{S.value||pt.warning({title:"风险操作",content:"修改实例路径会导致面板无法找到原有文件。请确保您已手动移动了文件，或您明确知道自己在做什么。",duration:5e3}),S.value=!S.value},F=m(!1),O=m(0),L=m([]),Z=m(null),Fe=ne(()=>i.value==="none"?{name:[{required:!0,message:"服务器名称不能为空",trigger:"blur"}],base:[{required:!0,message:"基础路径不能为空",trigger:"blur"}],args:[{required:!0,message:"自定义模式必须填写启动命令",trigger:"blur"}]}:{name:[{required:!0,message:"服务器名称不能为空",trigger:"blur"}],base:[{required:!0,message:"基础路径不能为空",trigger:"blur"}],java:[{required:!0,message:"Java 环境不能为空",trigger:"change"}],core:[{required:!0,message:"核心文件名不能为空",trigger:"change"}],minM:[{required:!0,message:"必填",trigger:"blur"}],maxM:[{required:!0,message:"必填",trigger:"blur"}]}),me=async()=>{V.value=!0;try{await h();const R=await Ze(c);if(o.value={...o.value,...R,coreUrl:"",coreFileKey:"",coreSha256:""},S.value=!1,R.java==="none")i.value="none";else if(R.java==="java")i.value="env";else if(R.java.startsWith("MSLX://Java/"))i.value="online",f.value=R.java.replace("MSLX://Java/","");else{const J=x.value.find(ee=>ee.value===R.java);i.value=J?"local":"custom",v.value=R.java}const t=R.backupPath;t==="MSLX://Backup/Instance"||t==="MSLX://Backup/Data"?g.value=t:(g.value="custom",P.value=t);const G=R.yggdrasilApiAddr;G?G==="https://skin.mslmc.net/api/yggdrasil"?E.value="https://skin.mslmc.net/api/yggdrasil":G==="https://littleskin.cn/api/yggdrasil"?E.value="https://littleskin.cn/api/yggdrasil":(E.value="custom",b.value=G):E.value="none"}catch(R){K.error("获取配置失败: "+R.message)}finally{V.value=!1}};pe(me);const ze=async()=>{var t,G;if(await((t=U.value)==null?void 0:t.validate())===!0&&!(i.value!=="none"&&(o.value.coreUrl||o.value.coreFileKey)&&!await new Promise(Q=>{const te=we.confirm({header:"确认变更核心文件?",body:"检测到您上传或选择了新的核心文件，这将覆盖服务器现有的部署。",theme:"warning",onConfirm:()=>{te.hide(),Q(!0)},onClose:()=>{te.hide(),Q(!1)}})}))){i.value==="none"&&(o.value.core="none",o.value.minM=1027,o.value.maxM=1102,o.value.java="none",o.value.coreUrl="",o.value.coreFileKey="",o.value.coreSha256=""),T.value=!0;try{const J=await Qe(o.value);((G=J.data)==null?void 0:G.needListen)??J.needListen?Je():(K.success("配置已保存"),T.value=!1,me())}catch(J){K.error(J.message||"保存失败"),T.value=!1}}},Je=async()=>{F.value=!0,O.value=0,L.value=[];const{baseUrl:R,token:t}=I,G=new URL("/api/hubs/updateProgressHub",R);G.searchParams.append("x-user-token",t),Z.value=new Be().withUrl(G.toString(),{withCredentials:!1}).configureLogging(Me.None).build(),Z.value.on("UpdateStatus",(J,ee,Q)=>{L.value.push({time:new Date().toLocaleTimeString(),msg:Q?`[错误] ${J}`:J}),Re(()=>{const te=document.getElementById("update-log-box");te&&(te.scrollTop=te.scrollHeight)}),ee>=0&&(O.value=Number(ee.toFixed(1))),ee===100&&(K.success("更新完成"),je(!0))});try{await Z.value.start(),await Z.value.invoke("JoinGroup",c.toString())}catch{L.value.push({time:"-",msg:"连接失败"})}},je=(R=!1)=>{var t;(t=Z.value)==null||t.stop(),setTimeout(()=>{F.value=!1,T.value=!1,R&&me()},1e3)};return he(()=>{var R;(R=Z.value)==null||R.stop()}),(R,t)=>{const G=_("t-input"),J=_("t-button"),ee=_("t-tooltip"),Q=_("t-select"),te=_("t-textarea"),de=_("t-alert"),ce=_("t-icon"),se=_("t-col"),ke=_("t-row"),$e=_("t-progress"),Ge=_("t-space"),fe=_("t-input-number"),xe=_("t-switch"),Xe=_("t-form"),We=_("t-dialog");return d(),M("div",At,[a(Xe,{ref_key:"formRef",ref:U,data:o.value,rules:Fe.value,"label-width":"0",onSubmit:ze},{default:s(()=>[t[47]||(t[47]=e("div",{class:"setting-group-title"},"基础设置",-1)),e("div",Ot,[t[26]||(t[26]=e("div",{class:"setting-info"},[e("div",{class:"title"},"服务器名称"),e("div",{class:"desc"},"在面板列表中显示的别名，支持中文")],-1)),e("div",Tt,[a(G,{modelValue:o.value.name,"onUpdate:modelValue":t[0]||(t[0]=C=>o.value.name=C),placeholder:"请输入名称"},null,8,["modelValue"])])]),e("div",Nt,[e("div",Dt,[t[27]||(t[27]=e("div",{class:"title"},"实例路径",-1)),e("div",Ft,[e("span",{class:be({"text-warning":S.value})},A(S.value?"警告：修改路径可能导致无法找到原文件":"服务器文件的物理存储路径，非必要请勿修改"),3)])]),e("div",zt,[a(G,{modelValue:o.value.base,"onUpdate:modelValue":t[1]||(t[1]=C=>o.value.base=C),disabled:!S.value},{suffix:s(()=>[a(ee,{content:S.value?"点击锁定":"点击解锁编辑 (慎重)"},{default:s(()=>[a(J,{variant:"text",shape:"square",onClick:le},{icon:s(()=>[S.value?(d(),X(N(mt),{key:0,style:{color:"var(--td-warning-color)"}})):(d(),X(N(ft),{key:1}))]),_:1})]),_:1},8,["content"])]),_:1},8,["modelValue","disabled"])])]),t[48]||(t[48]=e("div",{class:"setting-group-title"},"运行模式",-1)),e("div",Jt,[t[28]||(t[28]=e("div",{class:"setting-info"},[e("div",{class:"title"},"启动方式"),e("div",{class:"desc"},"选择使用 Java 启动 Minecraft，或使用自定义命令启动其他程序 (如 Bedrock, Python 等)")],-1)),e("div",jt,[a(Q,{modelValue:i.value,"onUpdate:modelValue":t[2]||(t[2]=C=>i.value=C),options:[{label:"MSLX 在线下载 (Java)",value:"online"},{label:"使用本地版本 (Java)",value:"local"},{label:"自定义路径 (Java)",value:"custom"},{label:"环境变量 (Java)",value:"env"},{label:"自定义命令 (无Java)",value:"none"}]},null,8,["modelValue"]),i.value!=="none"?(d(),M("div",Gt,[i.value==="online"?(d(),X(Q,{key:0,modelValue:f.value,"onUpdate:modelValue":t[3]||(t[3]=C=>f.value=C),options:j.value,placeholder:"请选择版本",filterable:""},null,8,["modelValue","options"])):D("",!0),i.value==="local"?(d(),X(Q,{key:1,modelValue:v.value,"onUpdate:modelValue":t[4]||(t[4]=C=>v.value=C),options:x.value,placeholder:"选择已识别的 Java"},null,8,["modelValue","options"])):D("",!0),i.value==="custom"?(d(),X(G,{key:2,modelValue:v.value,"onUpdate:modelValue":t[5]||(t[5]=C=>v.value=C),placeholder:"输入 java 可执行文件完整路径"},null,8,["modelValue"])):D("",!0)])):D("",!0)])]),e("div",Xt,[e("div",Wt,[e("div",Kt,A(i.value==="none"?"启动命令 (Command)":"启动参数 (JVM Args)"),1),e("div",qt,A(i.value==="none"?"完全自定义的启动命令。程序将直接执行此段内容，不依赖 Java 环境。":"传递给 Java 的启动参数，如 GC 策略 (例如 -XX:+UseG1GC)"),1)]),e("div",Ht,[a(te,{modelValue:o.value.args,"onUpdate:modelValue":t[6]||(t[6]=C=>o.value.args=C),autosize:{minRows:2,maxRows:4},placeholder:i.value==="none"?"例如: ./bedrock_server_x64":"无特殊需求请留空"},null,8,["modelValue","placeholder"])])]),i.value!=="none"?(d(),M(re,{key:0},[t[32]||(t[32]=e("div",{class:"setting-group-title"},"核心管理",-1)),e("div",Yt,[t[31]||(t[31]=e("div",{class:"setting-info"},[e("div",{class:"title"},"服务端核心文件"),e("div",{class:"desc"},[y(" 指定启动的 Jar 文件名。如果文件已存在于目录中，直接输入文件名即可。 "),e("br"),y("需要更新核心？点击下方“文件工具” ")])],-1)),e("div",Zt,[a(G,{modelValue:o.value.core,"onUpdate:modelValue":t[8]||(t[8]=C=>o.value.core=C),placeholder:"例如 server.jar"},{suffix:s(()=>[a(J,{variant:"text",theme:"primary",size:"small",onClick:t[7]||(t[7]=C=>p.value=!p.value)},{default:s(()=>[y(A(p.value?"收起工具":"文件工具"),1)]),_:1})]),_:1},8,["modelValue"]),p.value?(d(),M("div",Qt,[a(Ge,{direction:"vertical",style:{width:"100%"}},{default:s(()=>[a(de,{theme:"info",message:"在此处操作会自动下载/上传文件，并填入上方的文件名。"}),a(ke,{gutter:12},{default:s(()=>[a(se,{span:6},{default:s(()=>[a(J,{block:"",variant:"outline",onClick:t[9]||(t[9]=C=>$.value=!0)},{icon:s(()=>[a(ce,{name:"cloud-download"})]),default:s(()=>[t[29]||(t[29]=y(" 从版本库下载 ",-1))]),_:1})]),_:1}),a(se,{span:6},{default:s(()=>[a(J,{block:"",variant:"outline",loading:w.value,onClick:H},{icon:s(()=>[a(ce,{name:"upload"})]),default:s(()=>[t[30]||(t[30]=y(" 上传本地文件 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1}),e("input",{ref_key:"uploadInputRef",ref:u,type:"file",accept:".jar",hidden:"",onChange:Y},null,544),w.value?(d(),M("div",ea,[e("span",null,"正在上传: "+A(q.value),1),a($e,{theme:"line",percentage:B.value},null,8,["percentage"])])):D("",!0)]),_:1})])):D("",!0)])])],64)):D("",!0),i.value!=="none"?(d(),M(re,{key:1},[t[35]||(t[35]=e("div",{class:"setting-group-title"},"资源限制",-1)),e("div",ta,[t[34]||(t[34]=e("div",{class:"setting-info"},[e("div",{class:"title"},"内存分配 (MB)"),e("div",{class:"desc"},"设置 Java 堆内存大小 (Xms / Xmx)")],-1)),e("div",aa,[a(fe,{modelValue:o.value.minM,"onUpdate:modelValue":t[10]||(t[10]=C=>o.value.minM=C),min:0,placeholder:"最小(Xms)",theme:"column",style:{width:"140px"},suffix:"MB"},null,8,["modelValue"]),t[33]||(t[33]=e("span",{class:"separator"},"-",-1)),a(fe,{modelValue:o.value.maxM,"onUpdate:modelValue":t[11]||(t[11]=C=>o.value.maxM=C),min:0,placeholder:"最大(Xmx)",theme:"column",style:{width:"140px"},suffix:"MB"},null,8,["modelValue"])])])],64)):D("",!0),t[49]||(t[49]=e("div",{class:"setting-group-title"},"自动备份",-1)),e("div",la,[t[38]||(t[38]=e("div",{class:"setting-info"},[e("div",{class:"title"},"备份策略"),e("div",{class:"desc"},"设置自动备份保留数量，以及触发备份的延迟时间")],-1)),e("div",sa,[a(fe,{modelValue:o.value.backupMaxCount,"onUpdate:modelValue":t[12]||(t[12]=C=>o.value.backupMaxCount=C),min:1,max:100,placeholder:"保留份数",theme:"column",style:{width:"140px"},suffix:"份"},null,8,["modelValue"]),t[36]||(t[36]=e("span",{class:"separator"},"/",-1)),a(fe,{modelValue:o.value.backupDelay,"onUpdate:modelValue":t[13]||(t[13]=C=>o.value.backupDelay=C),min:0,placeholder:"延迟时间",theme:"column",style:{width:"140px"},suffix:"秒"},null,8,["modelValue"])]),e("div",na,[a(ee,{content:"MSLX 向服务器发送 save-all 指令后，会等待指定的秒数，确保数据完全写入硬盘后再开始打包备份。"},{default:s(()=>[e("span",oa,[a(ce,{name:"help-circle"}),t[37]||(t[37]=y(" 什么是延迟时间？ ",-1))])]),_:1})])]),e("div",ia,[t[39]||(t[39]=e("div",{class:"setting-info"},[e("div",{class:"title"},"备份存放路径"),e("div",{class:"desc"},"选择备份文件存储的位置。推荐存储在实例文件夹外部以免误删。")],-1)),e("div",ra,[a(Q,{modelValue:g.value,"onUpdate:modelValue":t[14]||(t[14]=C=>g.value=C),options:[{label:"实例文件夹内 (Instance)",value:"MSLX://Backup/Instance"},{label:"全局数据目录 (Data)",value:"MSLX://Backup/Data"},{label:"自定义绝对路径",value:"custom"}]},null,8,["modelValue"]),g.value==="custom"?(d(),M("div",ua,[a(G,{modelValue:P.value,"onUpdate:modelValue":t[15]||(t[15]=C=>P.value=C),placeholder:"输入备份存放的绝对路径"},null,8,["modelValue"])])):D("",!0)])]),i.value!=="none"?(d(),M("div",da,"外置登录")):D("",!0),i.value!=="none"?(d(),M("div",ca,[t[40]||(t[40]=e("div",{class:"setting-info"},[e("div",{class:"title"},"Yggdrasil API"),e("div",{class:"desc"}," 选择认证服务器。留空则表示使用官方正版登录 (或离线模式)。 ")],-1)),e("div",va,[a(Q,{modelValue:E.value,"onUpdate:modelValue":t[16]||(t[16]=C=>E.value=C),options:n},null,8,["modelValue"]),E.value==="custom"?(d(),M("div",pa,[a(G,{modelValue:b.value,"onUpdate:modelValue":t[17]||(t[17]=C=>b.value=C),placeholder:"输入 Authlib-Injector API 地址"},null,8,["modelValue"])])):D("",!0)])])):D("",!0),t[50]||(t[50]=e("div",{class:"setting-group-title"},"高级设置",-1)),e("div",ma,[t[41]||(t[41]=e("div",{class:"setting-info"},[e("div",{class:"title"},"自动重启"),e("div",{class:"desc"},"当服务器崩溃或意外停止时尝试自动重启")],-1)),e("div",fa,[a(xe,{modelValue:o.value.autoRestart,"onUpdate:modelValue":t[18]||(t[18]=C=>o.value.autoRestart=C),label:["已开启","已关闭"]},null,8,["modelValue"])])]),e("div",ga,[t[42]||(t[42]=e("div",{class:"setting-info"},[e("div",{class:"title"},"随守护进程启动"),e("div",{class:"desc"},"当物理机开机/面板启动时，自动启动此实例")],-1)),e("div",ba,[a(xe,{modelValue:o.value.runOnStartup,"onUpdate:modelValue":t[19]||(t[19]=C=>o.value.runOnStartup=C),label:["已开启","已关闭"]},null,8,["modelValue"])])]),e("div",ya,[t[43]||(t[43]=e("div",{class:"setting-info"},[e("div",{class:"title"},"控制台编码"),e("div",{class:"desc"},"设置输入输出流的字符集，乱码时请尝试切换")],-1)),e("div",_a,[a(Q,{modelValue:o.value.inputEncoding,"onUpdate:modelValue":t[20]||(t[20]=C=>o.value.inputEncoding=C),options:l,label:"输入",style:{width:"140px"}},null,8,["modelValue"]),a(Q,{modelValue:o.value.outputEncoding,"onUpdate:modelValue":t[21]||(t[21]=C=>o.value.outputEncoding=C),options:l,label:"输出",style:{width:"140px"}},null,8,["modelValue"])])]),e("div",ka,[t[44]||(t[44]=e("div",{class:"setting-info"},[e("div",{class:"title"},"文件编码"),e("div",{class:"desc"},"设置文件编辑和保存时的编码格式，乱码时请尝试切换。(一般Windows是GBK，其他是UTF-8。)")],-1)),e("div",ha,[a(Q,{modelValue:o.value.fileEncoding,"onUpdate:modelValue":t[22]||(t[22]=C=>o.value.fileEncoding=C),options:l,style:{width:"140px"}},null,8,["modelValue"])])]),e("div",wa,[a(J,{theme:"primary",type:"submit",size:"large",loading:T.value},{default:s(()=>[...t[45]||(t[45]=[y("保存设置",-1)])]),_:1},8,["loading"]),a(J,{theme:"default",variant:"base",size:"large",onClick:me},{default:s(()=>[...t[46]||(t[46]=[y("重置更改",-1)])]),_:1})])]),_:1},8,["data","rules"]),a(at,{visible:$.value,"onUpdate:visible":t[23]||(t[23]=C=>$.value=C),onConfirm:W},null,8,["visible"]),a(We,{visible:F.value,"onUpdate:visible":t[25]||(t[25]=C=>F.value=C),header:"正在应用更新",footer:!1,"close-on-overlay-click":!1,"close-btn":!1,width:"600px"},{default:s(()=>[e("div",$a,[a($e,{theme:"plump",percentage:O.value,label:`${O.value}%`},null,8,["percentage","label"]),e("div",xa,[(d(!0),M(re,null,ue(L.value,(C,Ke)=>(d(),M("div",{key:Ke,class:"log-line"},[e("span",Ca,A(C.time),1),y(" "+A(C.msg),1)]))),128))]),O.value===100?(d(),M("div",Va,[a(J,{theme:"primary",onClick:t[24]||(t[24]=C=>F.value=!1)},{default:s(()=>[...t[51]||(t[51]=[y("关闭并刷新",-1)])]),_:1})])):D("",!0)])]),_:1},8,["visible"])])}}}),Ua=oe(Sa,[["__scopeId","data-v-e5a5df43"]]),Ia={class:"pm-container"},Ra={class:"header-section"},Ba={class:"mode-switcher"},Ma={key:0,class:"error-alert-bar"},La={class:"toolbar"},Pa={class:"left-actions"},Ea={key:0,class:"bulk-actions"},Aa={class:"selected-count"},Oa={class:"right-search"},Ta={class:"table-wrapper"},Na={class:"empty-state"},Da={class:"tips-footer"},Fa=ie({__name:"ModsPluginsManager",setup(r){const k=ve(),I=parseInt(k.params.id),c=m("mods"),U=m(!1),V=m([]),T=m(""),S=m([]),l=m(""),o=ne(()=>[{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{title:"文件名",colKey:"name",sorter:(b,n)=>b.name.localeCompare(n.name),ellipsis:!0},{title:"状态",colKey:"status",width:100},{title:"操作",colKey:"op",width:180,fixed:"right",align:"right"}]),i=ne(()=>{if(!T.value)return V.value;const b=T.value.toLowerCase();return V.value.filter(n=>n.name.toLowerCase().includes(b))}),j=async()=>{U.value=!0,S.value=[],l.value="";try{const b=await ut(I,c.value),n=(b.jarFiles||[]).map($=>({name:$,status:"enabled"})),p=(b.disableJarFiles||[]).map($=>({name:$,status:"disabled"}));V.value=[...n,...p]}catch(b){const n=b.message||"获取列表失败";l.value=n,V.value=[]}finally{U.value=!1}},x=async(b,n)=>{if(n.length===0)return;const p={enable:"启用",disable:"禁用",delete:"删除"},$=async()=>{try{U.value=!0;const u=await dt(I,c.value,b,n),{successCount:w,failCount:B}=u||{};B>0?K.warning(`操作完成：成功 ${w} 个，失败 ${B} 个`):K.success(`成功${p[b]} ${w} 个文件`),await j()}catch(u){K.error(u.message||"操作失败"),U.value=!1}};if(b==="delete"){const u=we.confirm({header:`确认删除 ${n.length} 个文件?`,body:"此操作不可逆，文件将被永久删除。",theme:"danger",onConfirm:()=>{u.hide(),$()}})}else await $()},f=b=>{c.value=b,j()},v=b=>{const n=b.status==="enabled"?"disable":"enable";x(n,[b.name])},h=b=>{const n=S.value;x(b,n)},g=m(!1),P=()=>{g.value=!0},E=()=>{g.value=!1,j()};return pe(()=>{j()}),ae(()=>k.params.id,b=>{b&&location.reload()}),(b,n)=>{const p=_("t-radio-button"),$=_("t-radio-group"),u=_("t-alert"),w=_("t-button"),B=_("t-input"),q=_("t-tag"),W=_("t-switch"),H=_("t-popconfirm"),Y=_("t-space"),le=_("t-table");return d(),M("div",Ia,[e("div",Ra,[n[10]||(n[10]=e("div",{class:"setting-group-title"}," 资源管理 ",-1)),e("div",Ba,[a($,{modelValue:c.value,"onUpdate:modelValue":n[0]||(n[0]=F=>c.value=F),variant:"default-filled",onChange:f},{default:s(()=>[a(p,{value:"mods"},{icon:s(()=>[a(N(Ve))]),default:s(()=>[n[8]||(n[8]=y(" 模组 (Mods) ",-1))]),_:1}),a(p,{value:"plugins"},{icon:s(()=>[a(N(Se))]),default:s(()=>[n[9]||(n[9]=y(" 插件 (Plugins) ",-1))]),_:1})]),_:1},8,["modelValue"])])]),l.value?(d(),M("div",Ma,[a(u,{theme:"error",message:l.value,closeable:"",onClose:n[1]||(n[1]=F=>l.value="")},{operation:s(()=>[e("span",{style:{cursor:"pointer","margin-left":"8px"},onClick:j},"重试")]),_:1},8,["message"])])):D("",!0),e("div",La,[e("div",Pa,[a(w,{theme:"primary",disabled:l.value!=="",onClick:P},{icon:s(()=>[a(N(gt))]),default:s(()=>[n[11]||(n[11]=y(" 上传文件 ",-1))]),_:1},8,["disabled"]),a(w,{variant:"outline",loading:U.value,onClick:j},{icon:s(()=>[a(N(ye))]),_:1},8,["loading"]),a(Le,{name:"fade"},{default:s(()=>[S.value.length>0?(d(),M("div",Ea,[n[15]||(n[15]=e("div",{class:"divider"},null,-1)),e("span",Aa,"已选 "+A(S.value.length)+" 项",1),a(w,{size:"small",variant:"text",theme:"success",onClick:n[2]||(n[2]=F=>h("enable"))},{default:s(()=>[...n[12]||(n[12]=[y("启用",-1)])]),_:1}),a(w,{size:"small",variant:"text",theme:"warning",onClick:n[3]||(n[3]=F=>h("disable"))},{default:s(()=>[...n[13]||(n[13]=[y("禁用",-1)])]),_:1}),a(w,{size:"small",variant:"text",theme:"danger",onClick:n[4]||(n[4]=F=>h("delete"))},{default:s(()=>[...n[14]||(n[14]=[y("删除",-1)])]),_:1})])):D("",!0)]),_:1})]),e("div",Oa,[a(B,{modelValue:T.value,"onUpdate:modelValue":n[5]||(n[5]=F=>T.value=F),placeholder:"搜索文件名...",clearable:""},{"prefix-icon":s(()=>[a(N(bt))]),_:1},8,["modelValue"])])]),e("div",Ta,[a(le,{"selected-row-keys":S.value,"onUpdate:selectedRowKeys":n[6]||(n[6]=F=>S.value=F),data:i.value,columns:o.value,"row-key":"name",loading:U.value,pagination:{defaultPageSize:20,total:i.value.length,showJumper:!0},hover:"",stripe:"",class:"custom-table"},{status:s(({row:F})=>[F.status==="enabled"?(d(),X(q,{key:0,theme:"success",variant:"light"},{icon:s(()=>[a(N(Ae))]),default:s(()=>[n[16]||(n[16]=y(" 已启用 ",-1))]),_:1})):(d(),X(q,{key:1,theme:"default",variant:"light",style:{color:"var(--td-text-color-placeholder)"}},{icon:s(()=>[a(N(yt))]),default:s(()=>[n[17]||(n[17]=y(" 已禁用 ",-1))]),_:1}))]),op:s(({row:F})=>[a(Y,{size:"small"},{default:s(()=>[a(W,{"model-value":F.status==="enabled",loading:U.value,size:"medium",onChange:O=>v(F)},{label:s(O=>[y(A(O.value?"开":"关"),1)]),_:1},8,["model-value","loading","onChange"]),a(H,{content:"确定要删除此文件吗？",theme:"danger",onConfirm:O=>x("delete",[F.name])},{default:s(()=>[a(w,{variant:"text",theme:"danger",shape:"square"},{default:s(()=>[a(N(Ee))]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)]),empty:s(()=>[e("div",Na,[c.value==="mods"?(d(),X(N(Ve),{key:0,size:"48px",style:{color:"var(--td-gray-color-4)"}})):(d(),X(N(Se),{key:1,size:"48px",style:{color:"var(--td-gray-color-4)"}})),e("p",null,A(`暂无${c.value==="mods"?"模组":"插件"}文件`),1)])]),_:1},8,["selected-row-keys","data","columns","loading","pagination"])]),e("div",Da,[e("p",null,"提示："+A(c.value==="mods"?"模组":"插件")+"文件存放于服务器根目录的 /"+A(c.value)+" 文件夹下。",1),n[18]||(n[18]=e("p",null,"禁用文件后，会在文件名后添加 .disabled 后缀，服务器将忽略该文件。",-1))]),a(It,{visible:g.value,"onUpdate:visible":n[7]||(n[7]=F=>g.value=F),"instance-id":N(I),"current-path":c.value,"allow-folder":!1,onSuccess:E},null,8,["visible","instance-id","current-path"])])}}}),za=oe(Fa,[["__scopeId","data-v-336551da"]]),Ue=[{key:"motd",label:"服务器标语",desc:"显示在多人游戏列表中的服务器介绍信息，支持颜色代码，不支持中文。",type:"string"},{key:"server-port",label:"服务器端口",desc:"默认为 25565。如果要在一台机器运行多个服务器，必须修改此端口。",type:"number"},{key:"max-players",label:"最大玩家数",desc:"服务器同时允许在线的最大玩家数量。",type:"number"},{key:"online-mode",label:"正版验证",desc:"开启后将验证玩家的正版账号。如果使用离线/皮肤站，请关闭此项。",type:"boolean"},{key:"white-list",label:"启用白名单",desc:"开启后只有在白名单内的玩家才能进入服务器。",type:"boolean"},{key:"enforce-whitelist",label:"强制白名单",desc:"开启后，当玩家不在白名单时，即使已在线也会被踢出（通常用于维护时重新加载白名单）。",type:"boolean"},{key:"level-name",label:"存档文件夹名称",desc:"服务器读取的世界存档文件夹名称（默认为 world）。",type:"string"},{key:"gamemode",label:"默认游戏模式",desc:"新玩家进入服务器时的默认模式。",type:"select",options:[{label:"生存 (Survival)",value:"survival"},{label:"创造 (Creative)",value:"creative"},{label:"冒险 (Adventure)",value:"adventure"},{label:"旁观 (Spectator)",value:"spectator"}]},{key:"force-gamemode",label:"强制游戏模式",desc:"开启后，玩家每次加入服务器都会被重置为默认游戏模式。",type:"boolean"},{key:"difficulty",label:"难度",desc:"世界的游戏难度设置。",type:"select",options:[{label:"和平 (Peaceful)",value:"peaceful"},{label:"简单 (Easy)",value:"easy"},{label:"普通 (Normal)",value:"normal"},{label:"困难 (Hard)",value:"hard"}]},{key:"hardcore",label:"极限模式",desc:"开启后，玩家死亡将被封禁。",type:"boolean"},{key:"allow-flight",label:"允许飞行",desc:"允许生存模式下的玩家飞行（防止被服务端反作弊踢出）。",type:"boolean"},{key:"spawn-protection",label:"出生点保护半径",desc:"出生点周围多少格内禁止非 OP 破坏。设为 0 可禁用。",type:"number"},{key:"player-idle-timeout",label:"挂机踢出时间",desc:"玩家闲置多少分钟后被自动踢出。0 为不限制。",type:"number"},{key:"level-seed",label:"世界种子",desc:"生成世界使用的种子，留空则随机生成。",type:"string"},{key:"level-type",label:"世界类型",desc:"例如 minecraft:normal, minecraft:flat, minecraft:amplified。",type:"string"},{key:"generate-structures",label:"生成结构",desc:"是否生成村庄、地牢等结构。",type:"boolean"},{key:"generator-settings",label:"生成器设置",desc:"用于自定义超平坦或特定生成器的 JSON 参数。",type:"string"},{key:"max-world-size",label:"世界边界半径",desc:"设置世界边界（World Border）的最大半径。",type:"number"},{key:"simulation-distance",label:"模拟距离",desc:"服务器实际运算实体/作物生长的区块半径（3-32）。",type:"number"},{key:"view-distance",label:"视距",desc:"客户端可以看见的区块半径。数值过大显著增加内存和带宽消耗。",type:"number"},{key:"entity-broadcast-range-percentage",label:"实体广播范围百分比",desc:"控制客户端能看到实体的距离系数（100表示默认）。",type:"number"},{key:"max-tick-time",label:"最大刻耗时 (Watchdog)",desc:"一刻的最长处理毫秒数。超过此数值服务器将强制关闭以防卡死。设为 -1 可禁用。",type:"number"},{key:"network-compression-threshold",label:"网络压缩阈值",desc:"数据包超过此字节数时进行压缩。设为 -1 禁用压缩。推荐保持默认 256。",type:"number"},{key:"rate-limit",label:"数据包限制",desc:"如果玩家发送数据包过快，将被踢出。0 为禁用。",type:"number"},{key:"use-native-transport",label:"使用原生传输优化",desc:"Linux 环境下是否启用 Epoll 优化网络性能。",type:"boolean"},{key:"prevent-proxy-connections",label:"防止代理连接",desc:"是否尝试阻止通过 VPN 或代理的连接（ISP/AS 号判断）。",type:"boolean"},{key:"sync-chunk-writes",label:"同步区块写入",desc:"开启后区块写入完成后才继续逻辑，数据更安全但可能掉帧；关闭可能提升性能。",type:"boolean"},{key:"region-file-compression",label:"区块文件压缩格式",desc:"用于保存区块的压缩算法。",type:"select",options:[{label:"Deflate (默认)",value:"deflate"},{label:"LZ4 (更快)",value:"lz4"},{label:"不压缩 (None)",value:"none"}]},{key:"max-chained-neighbor-updates",label:"最大连锁更新数",desc:"限制红石/方块连锁更新的数量以防止崩服。",type:"number"},{key:"log-ips",label:"控制台记录 IP",desc:"是否在控制台日志中显示玩家连接的 IP 地址。",type:"boolean"},{key:"hide-online-players",label:"隐藏在线玩家列表",desc:"开启后，服务器列表中将不显示具体的玩家名单。",type:"boolean"},{key:"enable-status",label:"启用状态查询",desc:"是否允许外部（如服务器列表网站）查询服务器状态。",type:"boolean"},{key:"accepts-transfers",label:"接受服务器传送",desc:"是否允许玩家从其他服务器无缝传送到此服务器。",type:"boolean"},{key:"pause-when-empty-seconds",label:"空载暂停时间",desc:"服务器内无玩家多少秒后暂停游戏循环（省资源）。-1 为不暂停。",type:"number"},{key:"op-permission-level",label:"OP 权限等级",desc:"设置 OP 的默认权限级别。",type:"select",options:[{label:"1 - 无视出生点保护",value:1},{label:"2 - 使用单机指令 (gamemode等)",value:2},{label:"3 - 多人管理 (kick/ban/op)",value:3},{label:"4 - 系统管理 (stop/save)",value:4}]},{key:"function-permission-level",label:"函数权限等级",desc:"数据包(Datapack)中函数的默认执行权限等级。",type:"number"},{key:"enforce-secure-profile",label:"强制安全配置 (签名)",desc:"强制玩家拥有官方签名的公钥（聊天报告相关）。离线服建议关闭。",type:"boolean"},{key:"enable-code-of-conduct",label:"启用行为准则提示",desc:"是否向玩家展示行为准则链接（遥测相关）。",type:"boolean"},{key:"bug-report-link",label:"Bug 反馈链接",desc:"自定义玩家遇到错误时显示的反馈网址。",type:"string"},{key:"resource-pack",label:"资源包下载地址",desc:"玩家进入服务器时提示下载的资源包直链 URL。",type:"string"},{key:"require-resource-pack",label:"强制资源包",desc:"开启后，拒绝下载资源包的玩家将被踢出。",type:"boolean"},{key:"resource-pack-sha1",label:"资源包 SHA1",desc:"资源包文件的 SHA-1 校验码，用于验证完整性和缓存。",type:"string"},{key:"resource-pack-prompt",label:"资源包提示语",desc:"下载资源包时向玩家显示的自定义消息（Json 格式）。",type:"string"},{key:"initial-enabled-packs",label:"初始启用数据包",desc:"世界生成时默认启用的数据包列表（逗号分隔）。",type:"string"},{key:"initial-disabled-packs",label:"初始禁用数据包",desc:"世界生成时默认禁用的数据包列表。",type:"string"},{key:"enable-rcon",label:"启用 RCON",desc:"开启远程控制台协议，允许外部工具发送指令。",type:"boolean"},{key:"rcon.port",label:"RCON 端口",desc:"RCON 监听端口（默认为 25575）。",type:"number"},{key:"rcon.password",label:"RCON 密码",desc:"连接 RCON 必须的密码。请设置复杂的密码。",type:"string"},{key:"broadcast-rcon-to-ops",label:"向 OP 广播 RCON",desc:"当 RCON 执行指令时，是否通知在线的 OP。",type:"boolean"},{key:"enable-query",label:"启用 Query",desc:"开启 GameSpy4 协议，用于获取服务器详细信息。",type:"boolean"},{key:"query.port",label:"Query 端口",desc:"Query 协议监听端口（默认为 25565）。",type:"number"},{key:"broadcast-console-to-ops",label:"向 OP 广播控制台",desc:"控制台执行的指令输出是否发给在线 OP。",type:"boolean"},{key:"enable-jmx-monitoring",label:"启用 JMX 监控",desc:"开启 Java JMX 性能监控（通常用于开发调试）。",type:"boolean"},{key:"management-server-enabled",label:"启用管理后台",desc:"是否启用 Minecraft 官方定义的管理服务器接口。",type:"boolean"},{key:"management-server-port",label:"管理后台端口",desc:"管理接口监听的端口。",type:"number"},{key:"management-server-host",label:"管理后台主机",desc:"管理接口绑定的主机名/IP。",type:"string"},{key:"management-server-allowed-origins",label:"管理后台允许源",desc:"允许访问管理接口的 Origin 列表。",type:"string"},{key:"server-ip",label:"服务器绑定 IP",desc:"指定服务器绑定的本地网卡 IP。留空表示监听所有网卡（0.0.0.0）。",type:"string"},{key:"debug",label:"调试模式",desc:"开启后控制台将输出更多调试信息。",type:"boolean"},{key:"text-filtering-config",label:"文本过滤配置",desc:"用于文本过滤服务的 API 配置。",type:"string"},{key:"status-heartbeat-interval",label:"状态心跳间隔",desc:"服务器向客户端发送状态心跳的间隔（0 为默认）。",type:"number"}],Ja={class:"settings-container"},ja={class:"page-header"},Ga={class:"config-list"},Xa={key:0,class:"empty-tip"},Wa={class:"setting-info"},Ka={class:"title"},qa={class:"key-name-row"},Ha={key:0,class:"key-name"},Ya={key:0,class:"desc"},Za={class:"setting-control"},Qa={class:"form-actions"},el=ie({__name:"ServerProperties",setup(r){const k=ve(),I=m(0),c=m(!1),U=m(!1),V=m({}),T=m(""),S=h=>{const g={};return h.split(`
`).forEach(E=>{const b=E.trim();if(!b||b.startsWith("#"))return;const n=b.indexOf("=");if(n!==-1){const p=b.substring(0,n).trim(),$=b.substring(n+1).trim();g[p]=$}}),g},l=h=>{let g=`#Minecraft server properties
#${new Date().toString()}
`;const P=Ue.map(b=>b.key),E=Object.keys(h);return P.forEach(b=>{Object.prototype.hasOwnProperty.call(h,b)&&(g+=`${b}=${h[b]}
`)}),E.forEach(b=>{P.includes(b)||(g+=`${b}=${h[b]}
`)}),g},o=async()=>{if(I.value){c.value=!0;try{const h=await ct(I.value,"server.properties");h&&(T.value=h,V.value=S(h))}catch(h){K.error(`读取配置文件失败: ${h.message}`)}finally{c.value=!1}}},i=async()=>{U.value=!0;try{const h=l(V.value);await vt(I.value,"server.properties",h),K.success("配置文件已保存"),o()}catch(h){K.error(`保存失败: ${h.message}`)}finally{U.value=!1}},j=ne(()=>{const h=[],g=V.value,P=new Set(Object.keys(g));return Ue.forEach(E=>{P.has(E.key)&&(h.push(E),P.delete(E.key))}),P.forEach(E=>{h.push({key:E,label:E,desc:"未收录的配置项",type:x(g[E]),isUnknown:!0})}),h}),x=h=>h==="true"||h==="false"?"boolean":!isNaN(Number(h))&&h!==""?"number":"string",f=(h,g)=>{const P=V.value[h];return P===void 0?g==="boolean"?!1:"":g==="boolean"?P==="true":g==="number"?Number(P):P},v=(h,g,P)=>{V.value[h]=String(g)};return ae(()=>k.params.id,h=>{h&&(I.value=parseInt(h),o())},{immediate:!0}),(h,g)=>{const P=_("t-button"),E=_("t-space"),b=_("t-switch"),n=_("t-select"),p=_("t-input-number"),$=_("t-input"),u=_("t-loading");return d(),M("div",Ja,[e("div",ja,[g[1]||(g[1]=e("div",{class:"section-title"},"Server.properties 配置编辑器",-1)),a(E,null,{default:s(()=>[a(P,{variant:"text",shape:"square",loading:c.value,onClick:o},{icon:s(()=>[a(N(ye))]),_:1},8,["loading"]),a(P,{theme:"primary",loading:U.value,onClick:i},{icon:s(()=>[a(N(Oe))]),default:s(()=>[g[0]||(g[0]=y(" 保存配置 ",-1))]),_:1},8,["loading"])]),_:1})]),a(u,{loading:c.value,text:"正在读取配置文件..."},{default:s(()=>[e("div",Ga,[!c.value&&j.value.length===0?(d(),M("div",Xa," 无法找到配置项或文件为空 ")):D("",!0),(d(!0),M(re,null,ue(j.value,w=>(d(),M("div",{key:w.key,class:be(["setting-item",{"unknown-item":w.isUnknown}])},[e("div",Wa,[e("div",Ka,A(w.label),1),e("div",qa,[w.isUnknown?D("",!0):(d(),M("span",Ha,A(w.key),1))]),w.isUnknown?D("",!0):(d(),M("div",Ya,A(w.desc||"暂无描述"),1))]),e("div",Za,[w.type==="boolean"?(d(),X(b,{key:0,"model-value":f(w.key,"boolean"),"onUpdate:modelValue":B=>v(w.key,B,"boolean")},null,8,["model-value","onUpdate:modelValue"])):w.type==="select"?(d(),X(n,{key:1,"model-value":f(w.key,"string"),options:w.options,placeholder:"请选择","onUpdate:modelValue":B=>v(w.key,B,"string")},null,8,["model-value","options","onUpdate:modelValue"])):w.type==="number"?(d(),X(p,{key:2,"model-value":f(w.key,"number"),theme:"column",style:{width:"100%"},"onUpdate:modelValue":B=>v(w.key,B,"number")},null,8,["model-value","onUpdate:modelValue"])):(d(),X($,{key:3,"model-value":f(w.key,"string"),placeholder:"未设置","onUpdate:modelValue":B=>v(w.key,B,"string")},null,8,["model-value","onUpdate:modelValue"]))])],2))),128))])]),_:1},8,["loading"]),e("div",Qa,[a(P,{theme:"primary",size:"large",loading:U.value,onClick:i},{default:s(()=>[...g[2]||(g[2]=[y("保存设置",-1)])]),_:1},8,["loading"]),a(P,{theme:"default",variant:"base",size:"large",onClick:o},{default:s(()=>[...g[3]||(g[3]=[y("重置更改",-1)])]),_:1})])])}}}),tl=oe(el,[["__scopeId","data-v-fe4f8014"]]);async function al(r){return await ge.get({url:`/api/instance/tasks/list/${r}`})}async function ll(r,k,I,c,U,V){return await ge.post({url:"/api/instance/tasks/create",data:{instanceId:r,name:k,cron:I,payload:c,type:U,enable:V}})}async function sl(r,k,I,c,U,V,T){return await ge.post({url:"/api/instance/tasks/update",data:{instanceId:r,id:k,name:I,cron:c,payload:U,type:V,enable:T}})}async function nl(r){return await ge.post({url:`/api/instance/tasks/delete${r}`})}const ol={class:"cron-gen-container"},il={class:"mode-switch"},rl={key:0,class:"mode-content novice-panel"},ul={class:"novice-input-group"},dl={key:1,class:"mode-content pro-panel"},cl={class:"tab-scroll-area"},vl={key:0,class:"specific-box"},pl={class:"result-area"},ml={class:"cron-display"},fl={class:"code-box"},gl={class:"next-runs"},bl={class:"runs-title"},yl={key:0,class:"error-msg"},_l={key:1,class:"runs-list"},kl={class:"index"},hl=ie({__name:"CronGenerator",props:{visible:{type:Boolean,default:!1},initialValue:{type:String,default:""}},emits:["update:visible","confirm"],setup(r,{emit:k}){const I=r,c=k,U=m("novice"),V=m(10),T=m("minute"),S=[{label:"秒",value:"second"},{label:"分钟",value:"minute"},{label:"小时",value:"hour"},{label:"天",value:"day"}],l=m("second"),o=[{label:"秒",value:"second",min:0,max:59},{label:"分",value:"minute",min:0,max:59},{label:"时",value:"hour",min:0,max:23},{label:"日",value:"day",min:1,max:31},{label:"月",value:"month",min:1,max:12},{label:"周",value:"week",min:1,max:7}],i=m({second:{type:"every",start:0,step:1,specifics:[]},minute:{type:"every",start:0,step:1,specifics:[]},hour:{type:"every",start:0,step:1,specifics:[]},day:{type:"every",start:1,step:1,specifics:[]},month:{type:"every",start:1,step:1,specifics:[]},week:{type:"any",start:1,step:1,specifics:[]}}),j=[{label:"周日",value:1},{label:"周一",value:2},{label:"周二",value:3},{label:"周三",value:4},{label:"周四",value:5},{label:"周五",value:6},{label:"周六",value:7}],x=ne(()=>{const n=(W,H="*")=>{const Y=i.value[W];return W==="week"&&Y.type==="any"||W==="week"&&i.value.day.type!=="every"||W==="day"&&i.value.week.type!=="any"?"?":Y.type==="every"?"*":Y.type==="interval"?`${Y.start}/${Y.step}`:Y.type==="specific"?Y.specifics.length===0?W==="day"||W==="month"?"1":"0":Y.specifics.sort((le,F)=>le-F).join(","):H},p=n("second"),$=n("minute"),u=n("hour"),w=n("day"),B=n("month"),q=n("week","?");return`${p} ${$} ${u} ${w} ${B} ${q}`}),f=ne(()=>{const n=V.value;switch(T.value){case"second":return`*/${n} * * * * *`;case"minute":return`0 */${n} * * * *`;case"hour":return`0 0 */${n} * * ?`;case"day":return`0 0 0 */${n} * ?`;default:return"* * * * * *"}}),v=ne(()=>U.value==="novice"?f.value:x.value),h=m([]),g=m(""),P=()=>{try{const n=Rt.CronExpressionParser.parse(v.value,{currentDate:new Date});h.value=n.take(5).map(p=>new Date(p.toString()).toLocaleString()),g.value=""}catch{g.value="无法解析当前 Cron 表达式，请检查规则是否冲突",h.value=[]}};ae(v,()=>{P()},{immediate:!0}),ae(()=>I.visible,n=>{n&&I.initialValue&&(U.value="pro",P())});const E=()=>{if(g.value){K.warning("当前表达式无效，无法保存");return}c("confirm",v.value),c("update:visible",!1)},b=n=>{const p=o.find(u=>u.value===n);if(!p)return[];const $=[];for(let u=p.min;u<=p.max;u++)$.push({label:u.toString(),value:u});return $};return(n,p)=>{const $=_("t-radio-button"),u=_("t-radio-group"),w=_("t-input-number"),B=_("t-select"),q=_("t-alert"),W=_("t-radio"),H=_("t-checkbox-group"),Y=_("t-tab-panel"),le=_("t-tabs"),F=_("t-tag"),O=_("t-dialog");return d(),X(O,{visible:r.visible,header:"Cron 表达式生成器",width:"700px",top:"5vh",onClose:p[4]||(p[4]=L=>c("update:visible",!1)),onConfirm:E},{default:s(()=>[e("div",ol,[e("div",il,[a(u,{modelValue:U.value,"onUpdate:modelValue":p[0]||(p[0]=L=>U.value=L),variant:"default-filled"},{default:s(()=>[a($,{value:"novice"},{default:s(()=>[...p[5]||(p[5]=[y("🚀 新手模式",-1)])]),_:1}),a($,{value:"pro"},{default:s(()=>[...p[6]||(p[6]=[y("🛠️ 专业模式",-1)])]),_:1})]),_:1},8,["modelValue"])]),U.value==="novice"?(d(),M("div",rl,[e("div",ul,[p[7]||(p[7]=e("span",null,"每隔",-1)),a(w,{modelValue:V.value,"onUpdate:modelValue":p[1]||(p[1]=L=>V.value=L),min:1,theme:"column",style:{width:"100px"}},null,8,["modelValue"]),a(B,{modelValue:T.value,"onUpdate:modelValue":p[2]||(p[2]=L=>T.value=L),options:S,style:{width:"100px"}},null,8,["modelValue"]),p[8]||(p[8]=e("span",null,"执行一次",-1))]),a(q,{theme:"info",style:{"margin-top":"16px"}},{message:s(()=>[...p[9]||(p[9]=[y(" 此模式适用于简单的周期性任务。如果需要“每周五上午10点”等复杂规则，请切换到",-1),e("b",null,"专业模式",-1),y("。 ",-1)])]),_:1})])):(d(),M("div",dl,[a(le,{modelValue:l.value,"onUpdate:modelValue":p[3]||(p[3]=L=>l.value=L)},{default:s(()=>[(d(),M(re,null,ue(o,L=>a(Y,{key:L.value,value:L.value,label:L.label},{default:s(()=>[e("div",cl,[a(u,{modelValue:i.value[L.value].type,"onUpdate:modelValue":Z=>i.value[L.value].type=Z,direction:"vertical"},{default:s(()=>[a(W,{value:"every"},{default:s(()=>[y(A(L.value==="week"?"不指定 (?)":`每${L.label} (*)`),1)]),_:2},1024),L.value!=="week"?(d(),X(W,{key:0,value:"interval"},{default:s(()=>[p[10]||(p[10]=y(" 周期: 从 ",-1)),a(w,{modelValue:i.value[L.value].start,"onUpdate:modelValue":Z=>i.value[L.value].start=Z,min:L.min,max:L.max,size:"small",theme:"column",style:{width:"60px"}},null,8,["modelValue","onUpdate:modelValue","min","max"]),y(" "+A(L.label)+"开始，每 ",1),a(w,{modelValue:i.value[L.value].step,"onUpdate:modelValue":Z=>i.value[L.value].step=Z,min:1,max:L.max,size:"small",theme:"column",style:{width:"60px"}},null,8,["modelValue","onUpdate:modelValue","max"]),y(" "+A(L.label)+"执行一次 ",1)]),_:2},1024)):D("",!0),L.value!=="week"?(d(),X(W,{key:1,value:"specific"},{default:s(()=>[y("指定: 选择具体的"+A(L.label),1)]),_:2},1024)):D("",!0),L.value==="week"?(d(),X(W,{key:2,value:"specific"},{default:s(()=>[...p[11]||(p[11]=[y("指定周几",-1)])]),_:1})):D("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),i.value[L.value].type==="specific"?(d(),M("div",vl,[a(H,{modelValue:i.value[L.value].specifics,"onUpdate:modelValue":Z=>i.value[L.value].specifics=Z,options:L.value==="week"?j:b(L.value),class:"grid-checkbox"},null,8,["modelValue","onUpdate:modelValue","options"])])):D("",!0)])]),_:2},1032,["value","label"])),64))]),_:1},8,["modelValue"])])),e("div",pl,[e("div",ml,[p[14]||(p[14]=e("span",{class:"label"},"当前表达式:",-1)),e("div",fl,[y(A(v.value)+" ",1),g.value?(d(),X(F,{key:1,theme:"danger",variant:"light",size:"small"},{default:s(()=>[a(N(_t)),p[13]||(p[13]=y(" 无效",-1))]),_:1})):(d(),X(F,{key:0,theme:"success",variant:"light",size:"small"},{default:s(()=>[a(N(Ae)),p[12]||(p[12]=y(" 有效",-1))]),_:1}))])]),e("div",gl,[e("div",bl,[a(N(_e)),p[15]||(p[15]=y(" 最近 5 次运行时间预测:",-1))]),g.value?(d(),M("div",yl,A(g.value),1)):(d(),M("ul",_l,[(d(!0),M(re,null,ue(h.value,(L,Z)=>(d(),M("li",{key:Z},[e("span",kl,"#"+A(Z+1),1),y(" "+A(L),1)]))),128))]))])])])]),_:1},8,["visible"])}}}),wl=oe(hl,[["__scopeId","data-v-135dd699"]]),$l={class:"page-container"},xl={class:"page-header"},Cl={key:0,class:"create-container"},Vl={class:"container-header"},Sl={class:"title"},Ul={class:"setting-item"},Il={class:"setting-control"},Rl={class:"setting-item"},Bl={class:"setting-control"},Ml={class:"setting-item"},Ll={class:"setting-control"},Pl={key:0,class:"setting-item"},El={class:"setting-info"},Al={class:"title"},Ol={class:"desc"},Tl={class:"setting-control"},Nl={class:"setting-item"},Dl={class:"setting-control"},Fl={class:"form-actions"},zl={class:"task-list"},Jl={key:0,class:"empty-state"},jl={class:"card-left"},Gl={class:"task-header-row"},Xl={class:"task-name"},Wl={class:"task-meta-row"},Kl={class:"cron-display"},ql=["title"],Hl={class:"card-right"},Yl=ie({__name:"CronTasks",setup(r){const k=ve(),I=ne(()=>parseInt(k.params.id)),c=m([]),U=m(!1),V=m(!1),T=m(null),S=m(!1),l=m(null),o=m(!1),i=m({id:"",name:"",cron:"",type:"command",payload:"",enable:!0}),j=[{label:"发送命令 (Command)",value:"command"},{label:"开启服务器 (Start)",value:"start"},{label:"停止服务器 (Stop)",value:"stop"},{label:"重启服务器 (Restart)",value:"restart"}],x={name:[{required:!0,message:"必填",trigger:"blur"}],cron:[{required:!0,message:"必填",trigger:"blur"}],type:[{required:!0,message:"必选",trigger:"change"}],payload:[{validator:$=>i.value.type==="command"&&!$?{result:!1,message:"命令内容不能为空",type:"error"}:!0,trigger:"blur"}]},f=async()=>{if(I.value){U.value=!0;try{const $=await al(I.value);c.value=$||[]}catch($){K.error($.message||"获取列表失败")}finally{U.value=!1}}},v=()=>{V.value||(i.value={id:"",name:"",cron:"",type:"command",payload:"",enable:!0},T.value=null,V.value=!0)},h=$=>{i.value={id:$.id,name:$.name,cron:$.cron,type:$.type.toLowerCase(),payload:$.payload,enable:$.enable},T.value=$.id,V.value=!0,window.scrollTo({top:0,behavior:"smooth"})},g=()=>{V.value=!1,T.value=null},P=async()=>{var u;if(await((u=l.value)==null?void 0:u.validate())===!0){S.value=!0;try{T.value?(await sl(I.value,i.value.id,i.value.name,i.value.cron,i.value.payload,i.value.type,i.value.enable),K.success("更新成功")):(await ll(I.value,i.value.name,i.value.cron,i.value.payload,i.value.type,i.value.enable),K.success("创建成功")),g(),f()}catch(w){K.error(w.message||"操作失败")}finally{S.value=!1}}},E=$=>{const u=we.confirm({header:"确认删除?",body:`确定删除任务 "${$.name}" 吗？`,theme:"danger",onConfirm:async()=>{try{await nl($.id),K.success("已删除"),f(),u.hide()}catch(w){K.error(w.message)}},onClose:()=>u.hide()})},b=$=>{i.value.cron=$},n=$=>{const u=$.toLowerCase();return u==="start"?Te:u==="stop"?Ne:u==="restart"?ye:$t},p=$=>{const u=$.toLowerCase();return u==="start"?"success":u==="stop"?"danger":u==="restart"?"warning":"primary"};return ae(()=>I.value,f),pe(f),($,u)=>{const w=_("t-button"),B=_("t-input"),q=_("t-select"),W=_("t-textarea"),H=_("t-switch"),Y=_("t-form"),le=_("t-tag"),F=_("t-loading");return d(),M("div",$l,[e("div",xl,[u[8]||(u[8]=e("div",{class:"section-title"},"定时计划任务",-1)),V.value?D("",!0):(d(),X(w,{key:0,theme:"primary",onClick:v},{icon:s(()=>[a(N(kt))]),default:s(()=>[u[7]||(u[7]=y(" 创建新任务 ",-1))]),_:1}))]),a(Le,{name:"slide-fade"},{default:s(()=>[V.value?(d(),M("div",Cl,[e("div",Vl,[e("span",Sl,A(T.value?"编辑任务":"创建新任务"),1),a(w,{size:"small",variant:"text",onClick:g},{default:s(()=>[a(N(ht))]),_:1})]),a(Y,{ref_key:"formRef",ref:l,data:i.value,rules:x,"label-width":"0"},{default:s(()=>[e("div",Ul,[u[9]||(u[9]=e("div",{class:"setting-info"},[e("div",{class:"title"},"任务名称"),e("div",{class:"desc"},"给这个计划任务起个容易识别的名字，例如“每日自动重启”")],-1)),e("div",Il,[a(B,{modelValue:i.value.name,"onUpdate:modelValue":u[0]||(u[0]=O=>i.value.name=O),placeholder:"请输入任务名称"},null,8,["modelValue"])])]),e("div",Rl,[u[11]||(u[11]=e("div",{class:"setting-info"},[e("div",{class:"title"},"触发规则 (Cron)"),e("div",{class:"desc"},"使用 Cron 表达式定义执行时间。支持秒级精度 (秒 分 时 日 月 周)")],-1)),e("div",Bl,[a(B,{modelValue:i.value.cron,"onUpdate:modelValue":u[1]||(u[1]=O=>i.value.cron=O),placeholder:"例如: 0 0 12 * * ?"},null,8,["modelValue"]),a(w,{variant:"outline",theme:"default",onClick:u[2]||(u[2]=O=>o.value=!0)},{default:s(()=>[...u[10]||(u[10]=[y(" 表达式生成器 ",-1)])]),_:1})])]),e("div",Ml,[u[12]||(u[12]=e("div",{class:"setting-info"},[e("div",{class:"title"},"执行操作"),e("div",{class:"desc"},"选择触发时要执行的动作类型")],-1)),e("div",Ll,[a(q,{modelValue:i.value.type,"onUpdate:modelValue":u[3]||(u[3]=O=>i.value.type=O),options:j},null,8,["modelValue"])])]),i.value.type==="command"||i.value.type==="restart"?(d(),M("div",Pl,[e("div",El,[e("div",Al,A(i.value.type==="restart"?"重启提示语":"控制台命令"),1),e("div",Ol,A(i.value.type==="restart"?"重启前发送给全服玩家的倒计时提示消息":"不需要加 /，直接输入命令内容"),1)]),e("div",Tl,[a(W,{modelValue:i.value.payload,"onUpdate:modelValue":u[4]||(u[4]=O=>i.value.payload=O),autosize:{minRows:2,maxRows:5},placeholder:"请输入内容..."},null,8,["modelValue"])])])):D("",!0),e("div",Nl,[u[13]||(u[13]=e("div",{class:"setting-info"},[e("div",{class:"title"},"启用状态"),e("div",{class:"desc"},"暂时禁用此任务而不删除它")],-1)),e("div",Dl,[a(H,{modelValue:i.value.enable,"onUpdate:modelValue":u[5]||(u[5]=O=>i.value.enable=O)},null,8,["modelValue"])])]),e("div",Fl,[a(w,{theme:"primary",loading:S.value,onClick:P},{icon:s(()=>[a(N(Oe))]),default:s(()=>[y(" "+A(T.value?"保存修改":"立即创建"),1)]),_:1},8,["loading"]),a(w,{theme:"default",variant:"base",onClick:g},{default:s(()=>[...u[14]||(u[14]=[y("取消",-1)])]),_:1})])]),_:1},8,["data"])])):D("",!0)]),_:1}),a(F,{loading:U.value,"show-overlay":""},{default:s(()=>[e("div",zl,[c.value.length===0&&!U.value?(d(),M("div",Jl," 暂无任务，请点击上方创建 ")):D("",!0),(d(!0),M(re,null,ue(c.value,O=>(d(),M("div",{key:O.id,class:"task-card"},[e("div",jl,[e("div",Gl,[a(le,{size:"small",theme:O.enable?"success":"default",variant:"light",class:"status-tag"},{default:s(()=>[y(A(O.enable?"运行中":"已暂停"),1)]),_:2},1032,["theme"]),e("span",Xl,A(O.name),1)]),e("div",Wl,[a(le,{size:"small",variant:"outline",theme:p(O.type),style:{"margin-right":"8px"}},{icon:s(()=>[(d(),X(Pe(n(O.type))))]),default:s(()=>[y(" "+A(O.type.toUpperCase()),1)]),_:2},1032,["theme"]),e("span",Kl,[a(N(_e)),y(" "+A(O.cron),1)])]),O.payload?(d(),M("div",{key:0,class:"task-payload",title:O.payload},A(O.payload),9,ql)):D("",!0)]),e("div",Hl,[a(w,{variant:"text",theme:"primary",onClick:L=>h(O)},{icon:s(()=>[a(N(wt))]),default:s(()=>[u[15]||(u[15]=y(" 编辑 ",-1))]),_:1},8,["onClick"]),a(w,{variant:"text",theme:"danger",onClick:L=>E(O)},{icon:s(()=>[a(N(Ee))]),default:s(()=>[u[16]||(u[16]=y(" 删除 ",-1))]),_:1},8,["onClick"])])]))),128))])]),_:1},8,["loading"]),a(wl,{visible:o.value,"onUpdate:visible":u[6]||(u[6]=O=>o.value=O),"initial-value":i.value.cron,onConfirm:b},null,8,["visible","initial-value"])])}}}),Zl=oe(Yl,[["__scopeId","data-v-acfdc411"]]),Ql={class:"layout-container"},es={class:"sidebar"},ts=["onClick"],as={class:"nav-text"},ls={class:"main-content"},ss={key:0,class:"panel-wrapper"},ns={key:1,class:"panel-wrapper"},os={key:2,class:"panel-wrapper"},is={key:3,class:"panel-wrapper"},rs=ie({__name:"InstanceSettings",setup(r,{expose:k}){const I=m(!1),c=m(0),U=[{label:"实例设置",icon:De},{label:"插件/模组",icon:xt},{label:"服务器属性",icon:Ct},{label:"定时任务",icon:_e}];return k({open:()=>{I.value=!0}}),(T,S)=>{const l=_("t-dialog");return d(),X(l,{visible:I.value,"onUpdate:visible":S[0]||(S[0]=o=>I.value=o),header:"实例配置",width:"90%",top:"3vh",attach:"body",footer:!1,"destroy-on-close":"",class:"settings-dialog"},{default:s(()=>[e("div",Ql,[e("div",es,[(d(),M(re,null,ue(U,(o,i)=>e("div",{key:i,class:be(["nav-item",{active:c.value===i}]),onClick:j=>c.value=i},[(d(),X(Pe(o.icon),{class:"nav-icon"})),e("span",as,A(o.label),1)],10,ts)),64))]),e("div",ls,[c.value===0?(d(),M("div",ss,[a(Ua)])):D("",!0),c.value===1?(d(),M("div",ns,[a(za)])):D("",!0),c.value===2?(d(),M("div",os,[a(tl,{"instance-id":21})])):D("",!0),c.value===3?(d(),M("div",is,[a(Zl)])):D("",!0)])])]),_:1},8,["visible"])}}}),us=oe(rs,[["__scopeId","data-v-5ef5512d"]]),ds={class:"sidebar-content"},cs={class:"control-header"},vs={class:"control-actions"},ps={class:"action-row"},ms={class:"info-list"},fs={class:"info-item"},gs={class:"label"},bs={class:"value"},ys={class:"info-item"},_s={class:"label"},ks={class:"value"},hs={class:"proxy-group"},ws={class:"info-item"},$s={class:"label"},xs={class:"value"},Cs=ie({__name:"ServerControlPanel",props:{serverId:{},isRunning:{type:Boolean},loading:{type:Boolean},serverInfo:{}},emits:["start","stop","clear-log","refresh-info"],setup(r,{emit:k}){const I=r,c=k,U=m(null),V=()=>{U.value&&U.value.open()},T=()=>{c("refresh-info")},S=m(0);let l=null;const o=f=>{if(!f)return 0;const v=f.match(/^(?:(\d+)\.)?(\d{1,2}):(\d{2}):(\d{2})(?:\.\d+)?$/);return v?parseInt(v[1]||"0",10)*86400+parseInt(v[2])*3600+parseInt(v[3])*60+parseInt(v[4]):0},i=ne(()=>{if(S.value<=0)return"00:00:00";const f=Math.floor(S.value/86400),v=Math.floor(S.value%86400/3600),h=Math.floor(S.value%3600/60),g=Math.floor(S.value%60),P=b=>b.toString().padStart(2,"0"),E=`${P(v)}:${P(h)}:${P(g)}`;return f>0?`${f}天 ${E}`:E}),j=()=>{l&&clearInterval(l),l=window.setInterval(()=>S.value++,1e3)},x=()=>{l&&(clearInterval(l),l=null)};return ae(()=>{var f;return(f=I.serverInfo)==null?void 0:f.uptime},f=>f&&(S.value=o(f)),{immediate:!0}),ae(()=>I.isRunning,f=>f?!l&&j():x(),{immediate:!0}),he(()=>x()),(f,v)=>{const h=_("t-tag"),g=_("t-button"),P=_("t-card");return d(),M("div",ds,[a(P,{class:"control-card",bordered:!1},{default:s(()=>[e("div",cs,[e("div",{class:be(["status-indicator",{running:r.isRunning}])},[v[4]||(v[4]=e("span",{class:"pulse"},null,-1)),y(A(r.isRunning?"Running":"Stopped"),1)],2),a(h,{theme:r.isRunning?"success":"default",variant:"light",shape:"round"},{default:s(()=>[y(A(r.isRunning?"运行中":"已停止"),1)]),_:1},8,["theme"])]),e("div",vs,[r.isRunning?(d(),X(g,{key:1,theme:"danger",size:"large",block:"",loading:r.loading,onClick:v[1]||(v[1]=E=>f.$emit("stop"))},{icon:s(()=>[a(N(Ne))]),default:s(()=>[v[6]||(v[6]=y("停止实例 ",-1))]),_:1},8,["loading"])):(d(),X(g,{key:0,theme:"primary",size:"large",block:"",loading:r.loading,onClick:v[0]||(v[0]=E=>{f.$emit("clear-log"),f.$emit("start")})},{icon:s(()=>[a(N(Te))]),default:s(()=>[v[5]||(v[5]=y("启动实例 ",-1))]),_:1},8,["loading"])),a(g,{variant:"outline",style:{margin:"0"},block:"",onClick:v[2]||(v[2]=E=>N(qe)(`/instance/files/${r.serverId}`))},{icon:s(()=>[a(N(Vt))]),default:s(()=>[v[7]||(v[7]=y("文件管理 ",-1))]),_:1}),e("div",ps,[a(g,{variant:"outline",theme:"warning",block:"",onClick:v[3]||(v[3]=E=>f.$emit("clear-log"))},{icon:s(()=>[a(N(ye))]),default:s(()=>[v[8]||(v[8]=y("清空 ",-1))]),_:1}),a(g,{variant:"outline",theme:"primary",block:"",onClick:V},{icon:s(()=>[a(N(De))]),default:s(()=>[v[9]||(v[9]=y("设置 ",-1))]),_:1})])])]),_:1}),a(P,{title:"实例详情",class:"info-card",bordered:!1},{default:s(()=>{var E,b;return[e("div",ms,[e("div",fs,[e("div",gs,[a(N(St)),v[10]||(v[10]=y(" 实例名称",-1))]),e("div",bs,A(((E=r.serverInfo)==null?void 0:E.name)||"Minecraft Server"),1)]),e("div",ys,[e("div",_s,[a(N(Ut)),v[11]||(v[11]=y(" 内存限制",-1))]),e("div",ks,A(((b=r.serverInfo)==null?void 0:b.maxM)||"?")+" MB",1)]),e("div",hs,[e("div",ws,[e("div",$s,[a(N(_e)),v[12]||(v[12]=y(" 运行时长",-1))]),e("div",xs,A(r.isRunning?i.value:"--:--:--"),1)])])])]}),_:1}),a(us,{ref_key:"settingsRef",ref:U,"server-id":r.serverId,onSuccess:T},null,8,["server-id"])])}}}),Vs=oe(Cs,[["__scopeId","data-v-16a17375"]]),Ss={class:"console-page"},Us={class:"layout-container"},Is={class:"main-terminal-area"},Rs={class:"sidebar-area"},Bs=ie({__name:"index",setup(r){const k=ve(),I=et(),c=m(parseInt(k.params.id)||0),U=m(!1),V=m(!1),T=m(null),S=m(null);async function l(){var x;if(c.value)try{V.value=!0;const f=await tt(c.value);await I.refreshInstanceList(),U.value=f.status,T.value=f,V.value=!1}catch(f){(x=S.value)==null||x.writeln(`\x1B[1;31m[Error] 获取实例信息失败: ${f.message}\x1B[0m`),V.value=!1}}const o=async()=>{var x,f;V.value=!0;try{(x=S.value)==null||x.writeln("\x1B[1;32m[System] 正在发送启动指令...\x1B[0m"),await Ce(c.value,"start"),K.success("实例启动指令已发送"),V.value=!1}catch(v){(f=S.value)==null||f.writeln(`\x1B[1;31m[Error] 启动失败: ${v.message}\x1B[0m`),V.value=!1}},i=async()=>{var x,f;V.value=!0;try{(x=S.value)==null||x.writeln("\x1B[1;32m[System] 正在发送停止指令...\x1B[0m"),await Ce(c.value,"stop"),K.warning("实例停止指令已发送"),V.value=!1}catch(v){(f=S.value)==null||f.writeln(`\x1B[1;31m[Error] 停止失败: ${v.message}\x1B[0m`),V.value=!1}},j=()=>{var x;(x=S.value)==null||x.clear()};return ae(()=>k.params.id,async x=>{x&&(c.value=parseInt(x),await l())}),pe(()=>{c.value&&l()}),(x,f)=>(d(),M("div",Ss,[e("div",Us,[e("div",Is,[a(Et,{ref_key:"terminalRef",ref:S,"server-id":c.value,onUpdate:f[0]||(f[0]=v=>l())},null,8,["server-id"])]),e("div",Rs,[a(Vs,{"server-id":c.value,"is-running":U.value,loading:V.value,"server-info":T.value,onStart:o,onStop:i,onClearLog:j},null,8,["server-id","is-running","loading","server-info"])])])]))}}),Cn=oe(Bs,[["__scopeId","data-v-7bea9131"]]);export{Cn as default};
