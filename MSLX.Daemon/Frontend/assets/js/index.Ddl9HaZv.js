import{u as j,a as J}from"./frp.CfhXo569.js";import{c as q,_ as Q,r as U}from"./index.DUo0lIWi.js";import{M as v}from"./tdesign-vue-next.B9R1AJJu.js";import{D as F,F as M,W as X,b0 as u,aX as _,aY as p,G as e,b2 as t,ao as g,a$ as s,K as O,R as ee,aa as te,ap as V,b1 as A,b6 as E,b5 as f,O as oe,b3 as se,aZ as ae}from"./index.BbdIPky0.js";import{a5 as G,a6 as ne,a3 as le,g as re,a7 as ie,a4 as de}from"./tdesign-icons-vue-next.B3wvPiG1.js";import"./pinia.DE9DXmFR.js";import"./pinia-plugin-persistedstate.n2tMOXAx.js";import"./vue-router.CTuarHf7.js";import"./tvision-color.BU_YHHaJ.js";import"./chroma-js.Cmk4elvR.js";import"./bezier-easing.jp9ayU57.js";import"./lodash.B5_zCkFd.js";import"./axios.R-lXtGyY.js";import"./qs.CnepGyXr.js";import"./side-channel.Bf-JVZLg.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.CD-SYzlK.js";import"./cron-parser.BqMfRICj.js";import"./luxon.BVaPVz1w.js";import"./side-channel-list.CQN2BsdT.js";import"./side-channel-map.BJ69Knz3.js";import"./get-intrinsic.CAdfHqt8.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.Cbri-GHQ.js";import"./dunder-proto.q7lw_6_J.js";import"./call-bind-apply-helpers.BxcZtPLH.js";import"./function-bind.BbkWVFrm.js";import"./hasown.ckq0ukzO.js";import"./call-bound.BO70H6sD.js";import"./side-channel-weakmap.BkoVKe_V.js";import"./nprogress.CMq2Rk2a.js";import"./core-js-pure.DghWRT_o.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./lodash-es.ClUTdtmA.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";const ue=j();async function W(S,l,d,m="toml"){await J(S,l,d,m),v.success("添加成功"),await ue.getTunnels(),q("/frp/list")}const me={class:"custom-frp-container"},pe=F({__name:"Custom",setup(S){const l=M(null),d=X({name:"",type:"toml",content:""}),m={name:[{required:!0,message:"请输入隧道名称",type:"error"}],content:[{required:!0,message:"配置文件内容不能为空",type:"error"}]},w=async({validateResult:a})=>{a===!0?await W(d.name,d.content,"Custom",d.type):v.warning("请检查表单填写")},c=()=>{v.info("表单已重置")};return(a,r)=>{const h=u("t-input"),n=u("t-form-item"),y=u("t-radio-button"),P=u("t-radio-group"),T=u("t-textarea"),$=u("t-button"),k=u("t-space"),I=u("t-form"),B=u("t-card");return p(),_("div",me,[e(B,{bordered:!1},{header:t(()=>[...r[3]||(r[3]=[s("span",{style:{"font-weight":"bold","font-size":"16px"}},"自定义 Frp 隧道",-1)])]),default:t(()=>[e(I,{ref_key:"formRef",ref:l,data:d,rules:m,"label-align":"top",onReset:c,onSubmit:w},{default:t(()=>[e(n,{label:"隧道名称",name:"name"},{default:t(()=>[e(h,{modelValue:d.name,"onUpdate:modelValue":r[0]||(r[0]=z=>d.name=z),placeholder:"请输入隧道名称"},null,8,["modelValue"])]),_:1}),e(n,{label:"配置类型",name:"type"},{default:t(()=>[e(P,{modelValue:d.type,"onUpdate:modelValue":r[1]||(r[1]=z=>d.type=z),variant:"default-filled"},{default:t(()=>[e(y,{value:"toml"},{default:t(()=>[...r[4]||(r[4]=[g("TOML",-1)])]),_:1}),e(y,{value:"ini"},{default:t(()=>[...r[5]||(r[5]=[g("INI",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(n,{label:"隧道配置内容",name:"content"},{default:t(()=>[e(T,{modelValue:d.content,"onUpdate:modelValue":r[2]||(r[2]=z=>d.content=z),placeholder:`[common]
server_addr = 0.0.0.0
server_port = 7000`,autosize:{minRows:10,maxRows:25},class:"code-font-textarea"},null,8,["modelValue"])]),_:1}),e(n,null,{default:t(()=>[e(k,null,{default:t(()=>[e($,{theme:"primary",type:"submit"},{default:t(()=>[...r[6]||(r[6]=[g("保存配置",-1)])]),_:1}),e($,{theme:"default",variant:"base",type:"reset"},{default:t(()=>[...r[7]||(r[7]=[g("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})])}}}),ce=Q(pe,[["__scopeId","data-v-10dc3649"]]);function Y(S){const l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let d="";for(let m=0;m<S;m++)d+=l.charAt(Math.floor(Math.random()*l.length));return d}const _e=(S,l="MSL Login",d=500,m=600)=>{if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return window.open(S,"_blank"),null;const c=window.screenLeft!==void 0?window.screenLeft:window.screenX,a=window.screenTop!==void 0?window.screenTop:window.screenY,r=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,h=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,n=r/window.screen.availWidth,y=(r-d)/2/n+c,P=(h-m)/2/n+a,T=`
    scrollbars=yes,
    width=${d/n},
    height=${m/n},
    top=${P},
    left=${y}
  `,$=window.open(S,l,T);return $&&$.focus(),$},fe={class:"page-container"},ve={key:0,class:"login-container"},ge={class:"login-card"},ye={class:"icon-wrapper"},be={key:1,class:"dashboard-container"},he={class:"stat-item"},we={class:"value"},ke={class:"stat-item"},Le={class:"value"},xe={class:"stat-item"},$e={class:"value"},Me={class:"stat-item"},Se={class:"value date-text"},Ve={class:"list-header"},Pe={class:"tunnel-list"},Te=["onClick"],Ce={class:"item-icon"},ze={class:"item-content"},Ue={class:"item-title"},Be={class:"item-subtitle"},Ie={class:"item-status"},Re={key:0,class:"empty-state"},Ae={key:0,class:"detail-content"},Fe={class:"detail-header"},Ke={class:"remarks"},He={class:"detail-grid"},Ne={class:"val"},qe={class:"detail-grid"},Ee={class:"val uppercase"},We={class:"detail-grid"},De={class:"val"},Oe={class:"detail-grid"},Ge={class:"val highlight"},Qe={class:"detail-grid"},Xe={class:"val"},Ye={class:"detail-grid"},Ze={class:"val"},je={class:"action-area"},Je={key:1,class:"empty-detail"},et=F({__name:"MSLFrp",setup(S){const l=M("tKYvKk48Sq5kGAy12IJQxLEKhXx"),d=M(null),m=M(""),w=M(!1),c=M(null),a=M([]),r=M({}),h=M(null),n=O(()=>a.value.find(i=>i.id===h.value)||null),y=O(()=>n.value?r.value[n.value.node_id]||`未知节点 (${n.value.node_id})`:"");ee(()=>{const i=localStorage.getItem("msl-user-token");i&&(m.value=i,I())}),te(()=>{d.value&&!d.value.closed&&d.value.close()});async function P(){v.info("正在跳转至MSL用户中心登录...");try{const i=Y(32),o=await U.post({url:"/api/oauth/createAppLogin",baseURL:"https://user.mslmc.net",data:{appid:l.value,csrf:i}});o.data.ssid?(d.value=_e(o.data.url,"登录到您的MSL账户",600,600),setTimeout(()=>T(i,o.data.ssid),1e3)):v.error(o.msg)}catch(i){v.error(i.message)}}async function T(i,o){var L;if(!((L=d.value)!=null&&L.closed)){try{const b=await U.get({url:"/api/oauth/appLogin",baseURL:"https://user.mslmc.net",params:{csrf:i,ssid:o}});if(b.data.token){d.value&&d.value.close(),v.success("登录成功"),m.value=b.data.token,localStorage.setItem("msl-user-token",b.data.token),I();return}}catch(b){v.error("登录失败！"+b.message);return}setTimeout(()=>T(i,o),1e3)}}const $=i=>{if(i===0)return"0 B";const o=1024,L=["B","KB","MB","GB","TB"],b=Math.floor(Math.log(i)/Math.log(o));return parseFloat((i/Math.pow(o,b)).toFixed(2))+" "+L[b]},k=i=>new Date(i*1e3).toLocaleString();async function I(){w.value=!0;try{const[i,o]=await Promise.all([U.get({url:"/api/frp/userInfo",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${m.value}`}}),U.get({url:"/api/frp/nodeList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${m.value}`}})]);if(i.code===200)c.value=i.data;else{v.warning("登录已过期，请重新登录～"),m.value="",localStorage.removeItem("msl-user-token");return}if(o.code===200){const b={};o.data.forEach(R=>{b[R.id]=R.node}),r.value=b}const L=await U.get({url:"/api/frp/getTunnelList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${m.value}`}});L.code===200&&(a.value=L.data,a.value.length>0&&(h.value=a.value[0].id))}catch(i){v.error("数据加载失败: "+i.message)}finally{w.value=!1}}const B=M(!1);async function z(){if(n.value){B.value=!0;try{const i=await U.get({url:"/api/frp/getTunnelConfig",baseURL:"https://user.mslmc.net",params:{id:n.value.id},headers:{Authorization:`Bearer ${m.value}`}});i.code===200?await W(n.value.name,i.data,"MSLFrp"):v.error(i.msg)}catch(i){v.error("获取配置失败: "+i.message)}B.value=!1}}const Z=()=>{v.info("请前往 MSL用户中心 创建新隧道"),q("https://user.mslmc.net/frp/createTunnel")};return(i,o)=>{const L=u("t-button"),b=u("t-space"),R=u("t-loading"),K=u("t-tag"),x=u("t-col"),H=u("t-row"),N=u("t-card"),D=u("t-divider");return p(),_("div",fe,[m.value===""?(p(),_("div",ve,[s("div",ge,[s("div",ye,[e(V(G),{size:"48px",style:{color:"var(--td-brand-color)"}})]),o[3]||(o[3]=s("h2",{class:"title"},"欢迎登录 MSLFrp",-1)),o[4]||(o[4]=s("p",{class:"subtitle"},"登录您的MSL账户以使用 MSLFrp 服务",-1)),e(b,{direction:"vertical",size:"medium",style:{width:"100%"}},{default:t(()=>[e(L,{block:"",theme:"primary",size:"large",onClick:P},{icon:t(()=>[e(V(G))]),default:t(()=>[o[1]||(o[1]=g(" 跳转用户中心登录 ",-1))]),_:1}),e(L,{theme:"default",variant:"outline",block:"",size:"large",onClick:o[0]||(o[0]=C=>V(q)("https://user.mslmc.net/register"))},{icon:t(()=>[e(V(ne))]),default:t(()=>[o[2]||(o[2]=g(" 注册 MSL 账户 ",-1))]),_:1})]),_:1})])])):(p(),_("div",be,[e(R,{attach:"#app-space",loading:w.value,text:"加载数据中..."},null,8,["loading"]),e(b,{id:"app-space",direction:"vertical",size:"large",style:{width:"100%"}},{default:t(()=>[c.value?(p(),A(N,{key:0,bordered:!1,title:"MSLFrp 用户信息",class:"info-card"},{actions:t(()=>[e(K,{theme:"primary",variant:"light"},{default:t(()=>[g(f(c.value.user_group_name),1)]),_:1})]),default:t(()=>[e(H,{gutter:[16,16]},{default:t(()=>[e(x,{xs:6,sm:3},{default:t(()=>[s("div",he,[o[5]||(o[5]=s("div",{class:"label"},"用户昵称",-1)),s("div",we,f(c.value.name),1)])]),_:1}),e(x,{xs:6,sm:3},{default:t(()=>[s("div",ke,[o[6]||(o[6]=s("div",{class:"label"},"隧道限额",-1)),s("div",Le,f(c.value.maxTunnelCount)+" 条",1)])]),_:1}),e(x,{xs:6,sm:3},{default:t(()=>[s("div",xe,[o[7]||(o[7]=s("div",{class:"label"},"速率限制",-1)),s("div",$e,f(c.value.boundLimit/1024*8)+" Mbps",1)])]),_:1}),e(x,{xs:6,sm:3},{default:t(()=>[s("div",Me,[o[8]||(o[8]=s("div",{class:"label"},"到期时间",-1)),s("div",Se,f(k(c.value.outdated)),1)])]),_:1})]),_:1})]),_:1})):E("",!0),e(H,{gutter:[16,16]},{default:t(()=>[e(x,{xs:12,md:5,lg:4},{default:t(()=>[e(N,{bordered:!1,class:"full-height-card"},{title:t(()=>[s("div",Ve,[o[10]||(o[10]=s("span",null,"我的隧道",-1)),e(L,{size:"small",variant:"text",onClick:Z},{icon:t(()=>[e(V(re))]),default:t(()=>[o[9]||(o[9]=g(" 新建 ",-1))]),_:1})])]),default:t(()=>[s("div",Pe,[(p(!0),_(oe,null,se(a.value,C=>(p(),_("div",{key:C.id,class:ae(["tunnel-item",{active:h.value===C.id}]),onClick:ut=>h.value=C.id},[s("div",Ce,[e(V(le))]),s("div",ze,[s("div",Ue,f(C.name),1),s("div",Be,f(r.value[C.node_id]||`Node ${C.node_id}`),1)]),s("div",Ie,[C.status===1?(p(),A(K,{key:0,theme:"success",variant:"light",size:"small"},{default:t(()=>[...o[11]||(o[11]=[g("在线",-1)])]),_:1})):(p(),A(K,{key:1,theme:"default",variant:"light",size:"small"},{default:t(()=>[...o[12]||(o[12]=[g("未启动",-1)])]),_:1}))])],10,Te))),128)),a.value.length===0?(p(),_("div",Re," 暂无隧道 ")):E("",!0)])]),_:1})]),_:1}),e(x,{xs:12,md:7,lg:8},{default:t(()=>[e(N,{bordered:!1,class:"full-height-card"},{title:t(()=>[...o[13]||(o[13]=[s("span",null,"隧道详情",-1)])]),default:t(()=>[n.value?(p(),_("div",Ae,[s("div",Fe,[s("h3",null,f(n.value.name),1),s("p",Ke,f(n.value.remarks||"暂无备注"),1)]),e(D),e(H,{gutter:[24,24]},{default:t(()=>[e(x,{span:6},{default:t(()=>[s("div",He,[o[14]||(o[14]=s("span",{class:"label"},"所在节点",-1)),s("span",Ne,f(y.value),1)])]),_:1}),e(x,{span:6},{default:t(()=>[s("div",qe,[o[15]||(o[15]=s("span",{class:"label"},"协议类型",-1)),s("span",Ee,f(n.value.type),1)])]),_:1}),e(x,{span:6},{default:t(()=>[s("div",We,[o[16]||(o[16]=s("span",{class:"label"},"本地地址",-1)),s("span",De,f(n.value.local_ip)+":"+f(n.value.local_port),1)])]),_:1}),e(x,{span:6},{default:t(()=>[s("div",Oe,[o[17]||(o[17]=s("span",{class:"label"},"远程端口",-1)),s("span",Ge,f(n.value.remote_port),1)])]),_:1}),e(x,{span:6},{default:t(()=>[s("div",Qe,[o[18]||(o[18]=s("span",{class:"label"},"今日流量",-1)),s("span",Xe,f($(n.value.today_traffic*1024*1024)),1)])]),_:1}),e(x,{span:6},{default:t(()=>[s("div",Ye,[o[19]||(o[19]=s("span",{class:"label"},"总流量",-1)),s("span",Ze,f($(n.value.total_traffic*1024*1024)),1)])]),_:1})]),_:1}),e(D),s("div",je,[e(L,{theme:"primary",size:"large",loading:B.value,block:"",onClick:z},{icon:t(()=>[e(V(ie))]),default:t(()=>[o[20]||(o[20]=g(" 使用此隧道 ",-1))]),_:1},8,["loading"])])])):(p(),_("div",Je,[e(V(de),{size:"48px",style:{color:"var(--td-text-color-disabled)"}}),o[21]||(o[21]=s("p",null,"请在左侧选择一个隧道查看详情",-1))]))]),_:1})]),_:1})]),_:1})]),_:1})]))])}}}),tt=Q(et,[["__scopeId","data-v-0f9a76cf"]]);async function ot(){return await U.get({url:"/query/p2p_server",baseURL:"https://api.mslmc.cn/v3"})}const st={key:0},at={key:1},nt={key:0},lt={key:1},rt={key:0},it={key:1},dt=F({__name:"MSLP2P",setup(S){const l=X({roomId:"",roomKey:"",bindPort:25565,isHoster:!0}),d={roomId:[{required:!0,message:"请输入房间号",type:"error"}],roomKey:[{required:!0,message:"请输入房间密钥",type:"error"}],bindPort:[{required:!0,message:"请输入绑定端口",type:"error"}]},m=async({validateResult:c})=>{c===!0?await w(l.isHoster,l.roomId,l.roomKey,l.bindPort):v.warning("请检查参数是否全部填写完成！")};async function w(c,a,r,h){try{const n=await ot();let y;c?y=`serverAddr = "${n.ip}"
serverPort = ${n.port}

[[proxies]]
name = "${a}"
type = "xtcp"
secretKey = "${r}"
localIP = "127.0.0.1"
localPort = ${h}`:y=`serverAddr = "${n.ip}"
serverPort = ${n.port}

[[visitors]]
name = "p2p_visitor"
type = "xtcp"
serverName = "${a}"
secretKey = "${r}"
bindAddr = "127.0.0.1"
bindPort = ${h}`,await W(c?`「联机 - 房主」${a}`:`「联机 - 访客」${a}`,y,"MSL P2P")}catch(n){v.error(`创建联机隧道失败！${n.message}`)}}return(c,a)=>{const r=u("t-radio"),h=u("t-radio-group"),n=u("t-form-item"),y=u("t-input"),P=u("t-button"),T=u("t-form"),$=u("t-card");return p(),_("div",null,[e($,{bordered:!1},{header:t(()=>[...a[5]||(a[5]=[s("span",{style:{"font-weight":"bold","font-size":"16px"}},"MSL P2P 联机隧道",-1)])]),default:t(()=>[e(T,{data:l,rules:d,"label-width":100,"label-align":"top","reset-type":"initial",onSubmit:m},{default:t(()=>[e(n,{label:"请选择联机类型",name:"isHoster"},{default:t(()=>[e(h,{modelValue:l.isHoster,"onUpdate:modelValue":a[0]||(a[0]=k=>l.isHoster=k)},{default:t(()=>[e(r,{value:!0},{default:t(()=>[...a[6]||(a[6]=[g("创建房间 - 房主",-1)])]),_:1}),e(r,{value:!1},{default:t(()=>[...a[7]||(a[7]=[g("加入房间 - 成员",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(n,{label:"房间号",name:"roomId"},{help:t(()=>[l.isHoster?(p(),_("span",st,"建议填写您的QQ号码。")):(p(),_("span",at,"请输入房间创建者提供的房间号。"))]),default:t(()=>[e(y,{modelValue:l.roomId,"onUpdate:modelValue":a[1]||(a[1]=k=>l.roomId=k),placeholder:"请输入房间号"},null,8,["modelValue"])]),_:1}),e(n,{label:"房间密钥",name:"roomKey"},{help:t(()=>[l.isHoster?(p(),_("span",nt,"随便写一个你喜欢的密钥。")):(p(),_("span",lt,"请输入房间创建者提供的密钥。"))]),default:t(()=>[e(y,{modelValue:l.roomKey,"onUpdate:modelValue":a[2]||(a[2]=k=>l.roomKey=k),placeholder:"请输入房间密钥"},null,8,["modelValue"]),l.isHoster?(p(),A(P,{key:0,theme:"default",variant:"base",style:{"margin-left":"5px"},onClick:a[3]||(a[3]=k=>{l.roomKey=V(Y)(16)})},{default:t(()=>[...a[8]||(a[8]=[g("随机生成",-1)])]),_:1})):E("",!0)]),_:1}),e(n,{label:"绑定端口",name:"bindPort"},{help:t(()=>[l.isHoster?(p(),_("span",rt,"请输入游戏内提示的开放联机端口。")):(p(),_("span",it,"建议保持默认。"))]),default:t(()=>[e(y,{modelValue:l.bindPort,"onUpdate:modelValue":a[4]||(a[4]=k=>l.bindPort=k),placeholder:"请输入绑定端口"},null,8,["modelValue"])]),_:1}),e(n,{style:{"margin-top":"16px"}},{default:t(()=>[e(P,{theme:"primary",type:"submit"},{default:t(()=>[...a[9]||(a[9]=[g("添加隧道",-1)])]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})])}}}),Jt=F({__name:"index",setup(S){const l=M(1);return(d,m)=>{const w=u("t-tab-panel"),c=u("t-tabs"),a=u("t-card");return p(),_("div",null,[e(a,{direction:"vertical"},{default:t(()=>[e(c,{modelValue:l.value,"onUpdate:modelValue":m[0]||(m[0]=r=>l.value=r)},{default:t(()=>[e(w,{value:1,label:"MSLFrp","destroy-on-hide":!1},{default:t(()=>[e(tt,{style:{margin:"15px"}})]),_:1}),e(w,{value:2,label:"MSL 联机","destroy-on-hide":!1},{default:t(()=>[e(dt,{style:{margin:"15px"}})]),_:1}),e(w,{value:3,label:"自定义Frp","destroy-on-hide":!1},{default:t(()=>[e(ce,{style:{margin:"15px"}})]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}});export{Jt as default};
