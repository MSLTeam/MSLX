import{a as Y}from"./vue-router.CTuarHf7.js";import{u as J,_ as E}from"./index.AC7et5r1.js";import{D as F,F as S,P,R as H,V as j,aa as q,aX as B,a$ as a,b5 as f,bi as O,bj as Z,bb as K,be as Q,aY as g,G as c,b0 as T,b2 as u,aZ as ee,ao as m,b1 as R,ap as p,O as te,b3 as ne,b6 as N}from"./index.BbdIPky0.js";import{c as k}from"./ansi-colors.gpWjHU8Z.js";import{c as M}from"./clipboard.BQCIBdQ6.js";import{aa as ae,ab as oe,U as se,a7 as ie,a8 as re,ac as le,ad as D,ae as V}from"./tdesign-icons-vue-next.1welRF8W.js";import{u as ce,g as de,b as z}from"./frp.D1or3L0T.js";import{M as G}from"./tdesign-vue-next.DAtQqNrG.js";import"./pinia.DE9DXmFR.js";import"./pinia-plugin-persistedstate_561243483b11dd07f5acf9e797fda690.n2tMOXAx.js";import"./tvision-color.BU_YHHaJ.js";import"./chroma-js.Cmk4elvR.js";import"./bezier-easing.jp9ayU57.js";import"./lodash.B5_zCkFd.js";import"./axios.R-lXtGyY.js";import"./qs.CGkucJ2S.js";import"./side-channel.Bf-JVZLg.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.CD-SYzlK.js";import"./cron-parser.BqMfRICj.js";import"./luxon.BVaPVz1w.js";import"./side-channel-list.CQN2BsdT.js";import"./side-channel-map.BJ69Knz3.js";import"./get-intrinsic.CAdfHqt8.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.Cbri-GHQ.js";import"./dunder-proto.q7lw_6_J.js";import"./call-bind-apply-helpers.BxcZtPLH.js";import"./function-bind.BbkWVFrm.js";import"./hasown.ckq0ukzO.js";import"./call-bound.BO70H6sD.js";import"./side-channel-weakmap.BkoVKe_V.js";import"./nprogress.CMq2Rk2a.js";import"./core-js-pure.DghWRT_o.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./lodash-es.ClUTdtmA.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";const ue={class:"terminal-header"},me={class:"tab-title"},pe=F({__name:"ConsoleTerminal",props:{frpId:{}},emits:["update"],setup(i,{expose:x,emit:n}){const l=i,v=n,w=J(),b=S(null),t=S(null);let e=null,y=null,_=null,I=null,s=null;const d={dark:{background:"transparent",foreground:"#cccccc",cursor:"transparent",selectionBackground:"#264f78",black:"#000000",red:"#cd3131",green:"#0dbc79",yellow:"#e5e510",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"},light:{background:"transparent",foreground:"#333333",cursor:"transparent",selectionBackground:"#add6ff",black:"#000000",red:"#cd3131",green:"#00bc79",yellow:"#9d9d10",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"}};k.enabled=!0;const $=o=>o?(o=o.replace(/^(\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2}(\.\d{3})?)/,r=>k.gray(r)),o=o.replace(/\[I\]/g,k.green("[I]")),o=o.replace(/\[W\]/g,k.yellow("[W]")),o=o.replace(/\[E\]/g,k.red("[E]")),o=o.replace(/(success)/gi,r=>k.bold.green(r)),o=o.replace(/(start|starting)/gi,r=>k.blue(r)),o=o.replace(/(failed|error)/gi,r=>k.bgRed.white(` ${r} `)),o=o.replace(/(:\d{4,5})/g,r=>k.cyan(r)),o=o.replace(/(\[[0-9a-f]{8,}\])/g,r=>k.magenta(r)),o):"",L=()=>{if(!t.value||!b.value)return;if(e){e.clear(),A();return}const o=document.documentElement.getAttribute("theme-mode")==="dark";e=new O.Terminal({cursorBlink:!1,cursorStyle:"bar",fontSize:13,fontFamily:'Menlo, Monaco, "Courier New", monospace',lineHeight:1.4,theme:o?d.dark:d.light,allowTransparency:!0,disableStdin:!0,convertEol:!0}),y=new Z.FitAddon,e.loadAddon(y),e.open(t.value);const r=()=>{if(t.value&&t.value.clientWidth>0&&t.value.clientHeight>0)try{y==null||y.fit()}catch(C){console.warn(C)}};_=new ResizeObserver(()=>window.requestAnimationFrame(r)),_.observe(b.value),setTimeout(r,100),A()},X=()=>{if(!e)return;const o=document.documentElement.getAttribute("theme-mode")==="dark";e.options.theme=o?d.dark:d.light},A=()=>{e==null||e.writeln("\x1B[1;34m[System]\x1B[0m 正在初始化Frp控制台 ..."),e==null||e.writeln(`\x1B[1;34m[System]\x1B[0m ID: ${l.frpId} | 状态: \x1B[32m已就绪！\x1B[0m`)},U=async()=>{if(s)try{await s.stop(),s=null}catch(o){console.error(o)}},W=async()=>{if(await U(),!l.frpId)return;const{baseUrl:o,token:r}=w,C=new URL("/api/hubs/frpLogsHub",o||window.location.origin);r&&C.searchParams.append("x-user-token",r),console.log(C.toString()),s=new K().withUrl(C.toString(),{withCredentials:!1}).configureLogging(Q.Warning).withAutomaticReconnect([0,2e3,5e3,1e4,3e4]).build(),s.on("ReceiveLog",h=>{e==null||e.writeln($(h)),h.includes("[MSLX]")&&setTimeout(()=>{v("update")},2e3)}),s.onreconnecting(h=>{e==null||e.writeln("\x1B[1;33m[System] 检测到连接中断，正在尝试重连...\x1B[0m"),console.warn("SignalR Reconnecting:",h)}),s.onreconnected(async()=>{e==null||e.writeln("\x1B[1;32m[System] 网络已恢复，重新连接日志服务...\x1B[0m");try{await(s==null?void 0:s.invoke("JoinGroup",l.frpId)),e==null||e.writeln("\x1B[1;32m[System] 日志服务成功重新连接！\x1B[0m")}catch(h){e==null||e.writeln(`\x1B[1;31m[Error] 重新连接日志服务失败: ${h.message}\x1B[0m`)}}),s.onclose(h=>{h&&(e==null||e.writeln(`\x1B[1;31m[System] 日志服务连接已断开: ${h.message}\x1B[0m`),e==null||e.writeln("\x1B[1;31m[System] 请刷新页面或检查网络连接。\x1B[0m"))});try{await s.start(),e==null||e.writeln("\x1B[1;32m[System] 成功连接到Frpc日志服务\x1B[0m"),await s.invoke("JoinGroup",l.frpId)}catch(h){e==null||e.writeln(`\x1B[1;31m[Error] 连接失败: ${h.message}\x1B[0m`)}};return x({writeln:o=>e==null?void 0:e.writeln(o),clear:()=>{e==null||e.clear(),A()}}),P(()=>l.frpId,async o=>{o&&(L(),await W())}),H(async()=>{await j(),L(),I=new MutationObserver(X),I.observe(document.documentElement,{attributes:!0,attributeFilter:["theme-mode"]}),l.frpId&&await W()}),q(async()=>{I==null||I.disconnect(),await U(),e==null||e.dispose(),_==null||_.disconnect()}),(o,r)=>(g(),B("div",{ref_key:"terminalWrapper",ref:b,class:"terminal-wrapper"},[a("div",ue,[r[0]||(r[0]=a("div",{class:"dots"},[a("span",{class:"dot red"}),a("span",{class:"dot yellow"}),a("span",{class:"dot green"})],-1)),a("div",me,"MSLX - Frp 控制台 | "+f(i.frpId),1)]),a("div",{ref_key:"terminalBody",ref:t,class:"terminal-body"},null,512)],512))}}),fe=E(pe,[["__scopeId","data-v-c605b515"]]),ge={class:"sidebar-content"},ve={class:"control-header"},be={class:"control-actions"},he={class:"info-list"},we={class:"info-item"},ye={class:"label"},ke={class:"value"},Be={key:0,class:"proxy-header"},xe={class:"info-item"},_e={class:"label"},Ie=["onClick"],Se={class:"info-item"},$e={class:"label"},Ce={class:"value highlight"},Re={class:"info-item"},Te={class:"label"},Ae=["onClick"],Me={key:1,class:"info-item"},Ee={class:"label"},Fe=["onClick"],Le={class:"info-item"},Ue={class:"label"},We={class:"value"},Ne={key:1,class:"info-item empty-state"},De={class:"value"},Ve=F({__name:"ControlPanel",props:{frpId:{},isRunning:{type:Boolean},loading:{type:Boolean},tunnelInfo:{}},emits:["start","stop","clear-log"],setup(i){return(x,n)=>{const l=T("t-tag"),v=T("t-button"),w=T("t-card"),b=T("t-tooltip");return g(),B("div",ge,[c(w,{class:"control-card",bordered:!1},{default:u(()=>[a("div",ve,[a("div",{class:ee(["status-indicator",{running:i.isRunning}])},[n[3]||(n[3]=a("span",{class:"pulse"},null,-1)),m(f(i.isRunning?"Running":"Stopped"),1)],2),c(l,{theme:i.isRunning?"success":"default",variant:"light",shape:"round"},{default:u(()=>[m(f(i.isRunning?"正常运行":"未运行"),1)]),_:1},8,["theme"])]),a("div",be,[i.isRunning?(g(),R(v,{key:1,theme:"danger",size:"large",block:"",loading:i.loading,onClick:n[1]||(n[1]=t=>x.$emit("stop"))},{icon:u(()=>[c(p(oe))]),default:u(()=>[n[5]||(n[5]=m("停止服务 ",-1))]),_:1},8,["loading"])):(g(),R(v,{key:0,theme:"primary",size:"large",block:"",loading:i.loading,onClick:n[0]||(n[0]=t=>x.$emit("start"))},{icon:u(()=>[c(p(ae))]),default:u(()=>[n[4]||(n[4]=m("启动服务 ",-1))]),_:1},8,["loading"])),c(v,{style:{margin:"0"},class:"glass-btn",variant:"outline",theme:"warning",block:"",onClick:n[2]||(n[2]=t=>x.$emit("clear-log"))},{icon:u(()=>[c(p(se))]),default:u(()=>[n[6]||(n[6]=m("清空日志 ",-1))]),_:1})])]),_:1}),c(w,{title:"隧道概览",class:"info-card",bordered:!1},{actions:u(()=>[i.tunnelInfo&&i.tunnelInfo.proxies&&i.tunnelInfo.proxies.length>0&&i.tunnelInfo.proxies.some(t=>t.type==="xtcp")?(g(),R(l,{key:0,variant:"light-outline",theme:"primary"},{default:u(()=>[...n[7]||(n[7]=[m("联机房间 - 房主",-1)])]),_:1})):i.tunnelInfo&&i.tunnelInfo.proxies&&i.tunnelInfo.proxies.length>0&&i.tunnelInfo.proxies.some(t=>t.type==="xtcp - Visitors")?(g(),R(l,{key:1,variant:"light-outline",theme:"primary"},{default:u(()=>[...n[8]||(n[8]=[m("联机房间 - 访客",-1)])]),_:1})):(g(),R(v,{key:2,shape:"circle",variant:"text"},{default:u(()=>[c(p(V))]),_:1}))]),default:u(()=>[a("div",he,[a("div",we,[a("div",ye,[c(p(ie)),n[9]||(n[9]=m(" 隧道实例 ID",-1))]),a("div",ke,"#"+f(i.frpId),1)]),i.tunnelInfo&&i.tunnelInfo.proxies&&i.tunnelInfo.proxies.length>0?(g(!0),B(te,{key:0},ne(i.tunnelInfo.proxies,(t,e)=>(g(),B("div",{key:e,class:"proxy-group"},[i.tunnelInfo.proxies.length>1?(g(),B("div",Be,"配置 #"+f(e+1),1)):N("",!0),a("div",xe,[a("div",_e,[c(p(re)),m(" "+f(t.type.includes("xtcp")?"房间号":"隧道名称"),1)]),c(b,{content:t.proxyName,placement:"top","show-arrow":"","destroy-on-close":""},{default:u(()=>[a("div",{onClick:y=>p(M)(t.proxyName,!0,`${t.type.includes("xtcp")?"房间号":"隧道名称"}已复制！`),class:"value remote-addr pointer"},f(t.proxyName),9,Ie)]),_:2},1032,["content"])]),a("div",Se,[a("div",$e,[c(p(le)),n[10]||(n[10]=m(" 协议类型",-1))]),a("div",Ce,f(t.type.toUpperCase()),1)]),a("div",Re,[a("div",Te,[c(p(D)),m(" "+f(t.type.includes("xtcp")?"房间密钥":"连接地址"),1)]),c(b,{content:t.remoteAddressMain,placement:"top","show-arrow":"","destroy-on-close":""},{default:u(()=>[a("div",{class:"value remote-addr pointer",onClick:y=>p(M)(t.remoteAddressMain,!0,`${t.type.includes("xtcp")?"房间密钥":"连接地址"}已复制！`)},f(t.remoteAddressMain||"获取中..."),9,Ae)]),_:2},1032,["content"])]),t.remoteAddressBackup&&t.remoteAddressBackup!==t.remoteAddressMain?(g(),B("div",Me,[a("div",Ee,[c(p(D)),n[11]||(n[11]=m(" 备用地址",-1))]),c(b,{content:t.remoteAddressBackup,placement:"top","show-arrow":"","destroy-on-close":""},{default:u(()=>[a("div",{class:"value remote-addr pointer",onClick:y=>p(M)(t.remoteAddressBackup,!0,"备用连接地址已复制！")},f(t.remoteAddressBackup),9,Fe)]),_:2},1032,["content"])])):N("",!0),a("div",Le,[a("div",Ue,[c(p(V)),n[12]||(n[12]=m(" 本地地址",-1))]),a("div",We,f(t.localAddress),1)])]))),128)):(g(),B("div",Ne,[n[13]||(n[13]=a("div",{class:"label"},"状态",-1)),a("div",De,f(i.loading?"正在加载配置...":"暂无详细信息"),1)]))])]),_:1})])}}}),ze=E(Ve,[["__scopeId","data-v-552ba546"]]),Ge={class:"console-page"},Pe={class:"layout-container"},He={class:"main-terminal-area"},Xe={class:"sidebar-area"},Ye=F({__name:"index",setup(i){const x=ce(),n=Y(),l=S(parseInt(n.params.frpId)||0),v=S(!1),w=S(!1),b=S(null),t=S(null);async function e(){var s;if(l.value)try{b.value=await de(l.value),v.value=b.value.isRunning,await x.getTunnels()}catch(d){console.error("获取隧道信息失败",d),(s=t.value)==null||s.writeln(`\x1B[1;31m[Error] 获取隧道信息失败: ${d}\x1B[0m`)}}const y=async()=>{var s,d;w.value=!0;try{(s=t.value)==null||s.writeln("\x1B[1;32m[System] 正在发送启动指令...\x1B[0m"),await z("start",l.value),v.value=!0,G.success("启动指令已发送"),setTimeout(e,1500)}catch($){(d=t.value)==null||d.writeln(`\x1B[1;31m[Error] Frpc启动失败: ${$.message}\x1B[0m`)}finally{w.value=!1}},_=async()=>{var s,d;w.value=!0;try{(s=t.value)==null||s.writeln("\x1B[1;32m[System] 正在发送停止指令...\x1B[0m"),await z("stop",l.value),v.value=!1,G.warning("停止指令已发送"),setTimeout(e,1e3)}catch($){(d=t.value)==null||d.writeln(`\x1B[1;31m[Error] Frpc停止失败: ${$.message}\x1B[0m`)}finally{w.value=!1}},I=()=>{var s;(s=t.value)==null||s.clear()};return P(()=>n.params.frpId,async s=>{n.name==="FrpConsole"&&s&&(l.value=parseInt(s),await e())}),H(()=>{l.value&&e()}),(s,d)=>(g(),B("div",Ge,[a("div",Pe,[a("div",He,[c(fe,{ref_key:"terminalRef",ref:t,"frp-id":l.value,onUpdate:d[0]||(d[0]=$=>e())},null,8,["frp-id"])]),a("div",Xe,[c(ze,{"frp-id":l.value,"is-running":v.value,loading:w.value,"tunnel-info":b.value,onStart:y,onStop:_,onClearLog:I},null,8,["frp-id","is-running","loading","tunnel-info"])])])]))}}),Dt=E(Ye,[["__scopeId","data-v-340db74c"]]);export{Dt as default};
