import{a as me}from"./vue-router.BSuyFzNa.js";import{r as w,b7 as We,b8 as Xe,l as oe,w as Z,o as pe,n as Se,f as Ue,aV as E,aY as e,b2 as P,A as Me,bb as gt,bh as yt,bf as bt,bg as _t,aU as g,aZ as V,j as t,a$ as l,aW as $e,a_ as j,J as R,b3 as z,F as ne,G as m,b0 as ue,c as ae,D as qe,b1 as Ke,ba as kt,B as Fe,k as De}from"./index.DuVfB4dr.js";import{c as D}from"./ansi-colors.DNitgexK.js";import{d as wt}from"./pinia.K9HejpEf.js";import{u as He,m as ht,_ as ie,g as $t,i as xt,h as Ct,j as Vt,n as Be,o as St,l as Ye,s as Rt,r as de,c as Ee}from"./index.BBb2Hw3e.js";import{g as Ut,b as It,c as Ze,u as Mt,d as ve}from"./instance.BTs4zqrH.js";import{S as Bt,g as Lt,a as At}from"./localJava.DDAVzJ4J.js";import{ag as Et,a8 as Pt,ah as Le,ai as Re,a1 as Tt,z as Ne,U as he,_ as Qe,a2 as et,aj as tt,ak as at,a4 as Ot,x as xe,al as Ft,g as Dt,c as Nt,am as zt,ad as st,a3 as lt,af as Gt,M as nt,an as Jt,ao as jt,ap as ze,aq as Ae,ar as Wt,as as Xt,m as qt,X as Kt,at as Ge,au as Ht,ab as Yt,av as Zt,aw as Qt,ax as ea,ay as ta,az as aa,aA as sa,aB as la,aC as na}from"./tdesign-icons-vue-next.Dm5w0YWL.js";import{M as J,N as oa,D as Pe}from"./tdesign-vue-next.DXysdKln.js";import{F as ia}from"./FileUploader.CLj9zHn4.js";import{d as ra}from"./cron-parser.CaUSrRUy.js";import{D as ua}from"./docs.C8YcrvFA.js";import{i as Je}from"./echarts.DjUoIeYL.js";import{V as da}from"./zrender.CtWC8fqq.js";import{a as ca}from"./md-editor-v3.CoCwYQ4W.js";import{f as va}from"./tools.CQnzORaS.js";import"./core-js-pure.DbDavgKW.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./pinia-plugin-persistedstate_2eabddac918ad8d0cf74e67f4601f4c8.n2tMOXAx.js";import"./tvision-color.Cy78gTfV.js";import"./chroma-js.DO2ptVd8.js";import"./bezier-easing.D5A5epFU.js";import"./lodash.CpoxsuHF.js";import"./axios.B9ygI19o.js";import"./qs.B2qFNmGA.js";import"./side-channel.BIlHSgJq.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.CWmL7r7A.js";import"./side-channel-list.DZ_HK50j.js";import"./side-channel-map.DDbmCn0b.js";import"./get-intrinsic.DL3knghB.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.Cbri-GHQ.js";import"./dunder-proto.q7lw_6_J.js";import"./call-bind-apply-helpers.BxcZtPLH.js";import"./function-bind.BbkWVFrm.js";import"./hasown.ckq0ukzO.js";import"./call-bound.Cne7q6oT.js";import"./side-channel-weakmap.BTkyjVO1.js";import"./nprogress.COlaCQ7y.js";import"./lodash-es.sbUBen0f.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";import"./luxon.BVaPVz1w.js";import"./tslib.BDyQ-Jie.js";import"./markdown-it.Baj76ayU.js";import"./mdurl.k9Sl0PQj.js";import"./uc.micro.kMc2yuuw.js";import"./entities.C20TfXL6.js";import"./linkify-it.DWYhiEiT.js";import"./punycode.js.Dj65hjkv.js";import"./markdown-it-image-figures.IpqUZCLv.js";import"./markdown-it-sub.Bxi31R0z.js";import"./markdown-it-sup.Bp2DoVCN.js";import"./lru-cache.aBL3gNlE.js";import"./medium-zoom.bWEtUbjf.js";const Te=wt("instanceHub",()=>{const n=He(),I=w(null),v=w(!1),p=w(null),h=w(0),r=w(0);let _=Promise.resolve();const B=w({cpu:0,memBytes:0,memPercent:0}),c=new Set,i=new Set,k=new Set,N=d=>{r.value=d},X=d=>(_=_.then(async()=>{var S;if(h.value++,((S=I.value)==null?void 0:S.state)==="Connected"&&p.value===d)return;I.value&&await u(),p.value=d,r.value=0;const{baseUrl:s,token:b}=n,L=new URL("/api/hubs/instanceControlHub",s||window.location.origin);b&&L.searchParams.append("x-user-token",b);const o=new We().withUrl(L.toString(),{withCredentials:!1}).configureLogging(Xe.Warning).withAutomaticReconnect([0,2e3,5e3,1e4]).build();o.on("ReceiveLog",O=>{c.forEach(W=>W(O))}),o.on("RequireEULA",()=>{i.forEach(O=>O())}),o.on("CommandResult",(O,W)=>{k.forEach(q=>q(O,W))}),o.on("ReceiveStatus",(O,W,q)=>{if(String(O)!==String(d))return;let F=0;if(r.value>0){const A=r.value*1024*1024;F=q/A*100,F>100&&(F=100)}B.value={cpu:W,memBytes:q,memPercent:F}}),o.onreconnecting(()=>c.forEach(O=>O("\x1B[1;31m[System] 连接中断，尝试重连...\x1B[0m"))),o.onreconnected(async()=>{c.forEach(O=>O("\x1B[1;32m[System] 网络恢复，重新加入会话...\x1B[0m"));try{await o.invoke("JoinGroup",d)}catch(O){console.error(O)}});try{await o.start(),await o.invoke("JoinGroup",d),I.value=o,v.value=!0,c.forEach(O=>O("\x1B[1;32m[System] 已连接到实例控制服务\x1B[0m"))}catch(O){v.value=!1,c.forEach(W=>W(`\x1B[1;31m[Error] 连接失败: ${O.message}\x1B[0m`)),p.value=null,I.value=null}}),_),T=()=>(_=_.then(async()=>{h.value>0&&h.value--,h.value===0&&await u()}),_),u=async()=>{if(I.value)try{I.value.state==="Connected"&&p.value&&await I.value.invoke("LeaveGroup",p.value),await I.value.stop()}catch(d){console.warn(d)}I.value=null,v.value=!1,p.value=null,r.value=0,B.value={cpu:0,memBytes:0,memPercent:0}};return{isConnected:v,stats:B,currentServerId:p,connect:X,disconnect:T,setMaxMemory:N,sendCommand:async d=>{if(!I.value||I.value.state!=="Connected"||!p.value)throw new Error("未连接到服务");await I.value.invoke("SendCommand",p.value,d)},onLog:d=>(c.add(d),()=>c.delete(d)),onEula:d=>(i.add(d),()=>c.delete(d)),onCommandResult:d=>(k.add(d),()=>k.delete(d))}}),ma=ht();D.enabled=!0;const pa=(n,I=-1)=>n?(I===-1&&(I=ma.settings.webPanelColorizeLogLevel),I===0?n:(n=n.replace(/\n/g,`\r
`),n.includes("Done")&&n.includes("!")&&(n=n.replace(/Done \((.*?)\)!/g,(v,p)=>`${D.green.bold("Done")} (${D.blue(p)})!`)),n.startsWith("[System]")&&(n=n.replace(/^\[System]/,`[${D.blue.bold("System")}]`)),n.includes("[MSLX]")&&(n=n.replace(/\[MSLX]/g,`[${D.magenta.bold("MSLX")}]`)),n.includes("[MSLX-Backup]")&&(n=n.replace(/\[MSLX-Backup]/g,`[${D.magenta.bold("MSLX-Backup")}]`)),n.includes("[MSLX-Daemon]")&&(n=n.replace(/\[MSLX-Daemon]/g,`[${D.magenta.bold("MSLX-Daemon")}]`)),n.startsWith(">>>")&&(n=n.replace(/^>>>/,D.red.bold(">>>"))),I===1?(n=n.replace(/^\[\d{2}:\d{2}:\d{2}\s+(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]/,(v,p)=>{switch(p){case"INFO":return D.green(v);case"WARN":case"WARNING":return D.yellow(v);case"ERROR":case"FATAL":return D.red(v);case"DEBUG":return D.blue(v);default:return v}}),n=n.replace(/^\[\d{2}:\d{2}:\d{2}\]\s+\[[^/]+\/(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]/,(v,p)=>{switch(p){case"INFO":return D.green(v);case"WARN":case"WARNING":return D.yellow(v);case"ERROR":case"FATAL":return D.red(v);default:return v}}),n=n.replace(new RegExp("(?<=:\\s|^)\\s*([([][a-zA-Z0-9_\\-.\\s]+[)\\]])(?=\\s)","g"),v=>D.cyan(v)),n):(n=n.replace(/^\[(\d{2}:\d{2}:\d{2})\s+(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]:/,(v,p,h)=>{let r=h;switch(h){case"INFO":r=D.green("INFO");break;case"WARN":case"WARNING":r=D.magenta.bold("WARN");break;case"ERROR":case"FATAL":r=D.red.bold(h);break;case"DEBUG":r=D.blue("DEBUG");break}return`[${D.gray(p)} ${r}]:`}),/^\[\d{2}:\d{2}:\d{2}\]/.test(n)&&(n=n.replace(/^\[(\d{2}:\d{2}:\d{2})\]/,(v,p)=>`[${D.gray(p)}]`)),n=n.replace(/\[([^/]+)\/(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]/g,(v,p,h)=>{const r=D.blue(p);let _=h;switch(h){case"INFO":_=D.green("INFO");break;case"WARN":_=D.magenta("WARN");break;case"ERROR":_=D.red.bold("ERROR");break}return`[${r}/${_}]`}),n=n.replace(new RegExp("(?<=:\\s|^)\\s*\\[([a-zA-Z0-9_\\-.\\s]+)\\](?=\\s)","g"),(v,p)=>p==="System"||p.includes("MSLX")?v:` [${D.bold.black(p)}]`),n=n.replace(/(https?:\/\/[^\s]+)/g,v=>D.blue.underline(v)),n=n.replace(new RegExp("\\b\\d+\\.\\d+[\\w.+\\-@]*(?<!ms|s|MB|GB|KB|%)\\b","g"),v=>D.magenta(v)),n=n.replace(/\b\d+(\.\d+)?\s?(ms|s|%|MB|GB|KB)\b/gi,v=>D.blue(v)),n=n.replace(new RegExp("(\\u001b\\[[\\d;]*m)|((?<!\\d:\\d)(?<![.\\-+])\\b\\d+\\b(?![.\\-+])(?!\\s*:\\s*\\d))","g"),(v,p,h)=>{if(p)return v;if(h){if(h.length>=4&&h.length<=6)return D.blue(h);if(h.length<=3)return D.blue(h)}return v}),n=n.replace(/(\*:\d{1,5})/,v=>D.blue.bold(v)),n=n.replace(/\b(Loaded|Saved|Starting|Started|Connected)\b/g,v=>D.green(v)),n=n.replace(/\bDone\b(?!\u001b)/g,D.green.bold("Done")),n=n.replace(/\b(Failed|Exception|Error|Caused by|Stopping|Closed)\b/g,v=>D.red.bold(v)),n=n.replace(/\b(Loading|Preparing|Generating|Saving|Using|Running)\b/g,v=>D.magenta(v)),n=n.replace(/\b(Minecraft|Paper|Velocity|Java)\b/gi,v=>D.bold.black(v)),n=n.replace(/'minecraft:[a-z_]+'/g,v=>D.magenta(v)),n))):"",fa={class:"terminal-header"},ga={class:"tab-title"},ya={class:"terminal-footer"},ba=oe({__name:"ServerTerminal",props:{serverId:{}},emits:["update"],setup(n,{expose:I,emit:v}){const p=n,h=v,r=Te(),_=w(null),B=w(null);let c=null,i=null,k=null,N=null,X=null,T=null,u="";const f=w(""),y={dark:{background:"transparent",foreground:"#cccccc",cursor:"#cccccc",selectionBackground:"#264f78",black:"#000000",red:"#cd3131",green:"#0dbc79",yellow:"#e5e510",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"},light:{background:"transparent",foreground:"#333333",cursor:"#333333",selectionBackground:"#add6ff",black:"#000000",red:"#cd3131",green:"#00bc79",yellow:"#9d9d10",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"}};D.enabled=!0;const x=F=>pa(F),$=()=>{if(!B.value||!_.value)return;if(c){c.clear(),o();return}const F=document.documentElement.getAttribute("theme-mode")==="dark";c=new bt.Terminal({cursorBlink:!1,cursorStyle:"bar",fontSize:14,fontFamily:'"Maple Mono", "Maple Mono CN", "Cascadia Code", Consolas, Menlo, "PingFang SC", "Microsoft YaHei", monospace',lineHeight:1.4,theme:F?y.dark:y.light,allowTransparency:!0,disableStdin:!0,convertEol:!0,overviewRulerWidth:0}),i=new _t.FitAddon,c.loadAddon(i),c.open(B.value),c.onData(Y=>d(Y));const A=()=>{if(B.value&&B.value.clientWidth>0&&B.value.clientHeight>0)try{i==null||i.fit()}catch(Y){console.warn(Y)}};k=new ResizeObserver(()=>window.requestAnimationFrame(A)),k.observe(_.value),setTimeout(A,100),o()},d=async F=>{!c||!p.serverId||(F==="\r"?(c.write(`\r
`),u.trim()&&await b(u),u=""):F===""?u.length>0&&(u=u.slice(0,-1),c.write("\b \b")):F>=" "&&(u+=F,c.write(F)))},s=async()=>{if(!f.value)return;const F=f.value;c==null||c.writeln(F),await b(F),f.value=""},b=async F=>{try{await r.sendCommand(F)}catch(A){c==null||c.writeln(`\x1B[1;31m[Error] ${A.message}\x1B[0m`)}},L=()=>{if(!c)return;const F=document.documentElement.getAttribute("theme-mode")==="dark";c.options.theme=F?y.dark:y.light},o=()=>{c==null||c.writeln("\x1B[1;34m[System]\x1B[0m 正在连接服务器控制台 ..."),c==null||c.writeln(`\x1B[1;34m[System]\x1B[0m 实例 ID: ${p.serverId}`),c==null||c.writeln("")},S=async()=>{p.serverId&&(X&&X(),X=r.onLog(F=>{c&&c.writeln(x(F)),F.startsWith("[MSLX]")&&h("update")}),T&&T(),T=r.onCommandResult((F,A)=>{F||c==null||c.writeln(`\x1B[1;31m[System] 指令执行反馈: ${A}\x1B[0m`)}),await r.connect(p.serverId))},O=async()=>{X&&X(),T&&T(),await r.disconnect()};return I({writeln:F=>c==null?void 0:c.writeln(F),clear:()=>{c==null||c.clear(),o()}}),Z(()=>p.serverId,async(F,A)=>{F!==A&&(await O(),$(),await S())}),pe(async()=>{await Se(),$(),N=new MutationObserver(L),N.observe(document.documentElement,{attributes:!0,attributeFilter:["theme-mode"]}),await S()}),Ue(async()=>{N==null||N.disconnect(),k==null||k.disconnect(),c==null||c.dispose(),await O()}),(F,A)=>(g(),E("div",{ref_key:"terminalWrapper",ref:_,class:"terminal-wrapper"},[e("div",fa,[A[1]||(A[1]=e("div",{class:"dots"},[e("span",{class:"dot red"}),e("span",{class:"dot yellow"}),e("span",{class:"dot green"})],-1)),e("div",ga,"MSLX 服务端控制台 | #"+P(n.serverId),1)]),e("div",{ref_key:"terminalBody",ref:B,class:"terminal-body"},null,512),e("div",ya,[Me(e("input",{"onUpdate:modelValue":A[0]||(A[0]=Y=>f.value=Y),class:"cmd-input",placeholder:"发送控制台指令...",onKeyup:yt(s,["enter"])},null,544),[[gt,f.value]]),e("button",{class:"send-btn",onClick:s},"发送")])],512))}}),_a=ie(ba,[["__scopeId","data-v-69a4d153"]]),ka={class:"settings-container"},wa={class:"setting-item"},ha={class:"setting-control"},$a={class:"setting-item"},xa={class:"setting-info"},Ca={class:"desc"},Va={class:"setting-control"},Sa={class:"setting-item"},Ra={class:"setting-control"},Ua={key:0,style:{"margin-top":"8px"}},Ia={class:"setting-item"},Ma={class:"setting-info"},Ba={class:"title"},La={class:"desc"},Aa={class:"setting-control"},Ea={class:"setting-item"},Pa={class:"setting-control"},Ta={key:0,class:"core-tools-panel"},Oa={key:0,class:"upload-progress"},Fa={class:"setting-item"},Da={class:"setting-control flex-row"},Na={class:"memory-input-group"},za={class:"memory-input-group"},Ga={class:"setting-item"},Ja={class:"setting-control flex-row"},ja={class:"setting-info-desc-only"},Wa={style:{"font-size":"12px",color:"var(--td-text-color-placeholder)",cursor:"help"}},Xa={class:"setting-item"},qa={class:"setting-control"},Ka={key:0,style:{"margin-top":"8px"}},Ha={key:2,class:"setting-group-title"},Ya={key:3,class:"setting-item"},Za={class:"setting-control"},Qa={key:0,style:{"margin-top":"8px"}},es={class:"setting-item"},ts={class:"setting-control"},as={key:4,class:"setting-item"},ss={class:"setting-control"},ls={class:"setting-item"},ns={class:"setting-control"},os={class:"setting-item"},is={class:"setting-control"},rs={class:"setting-item"},us={class:"setting-control"},ds={key:5,class:"setting-item"},cs={class:"setting-control"},vs={class:"setting-item"},ms={class:"setting-control flex-row"},ps={class:"setting-item"},fs={class:"setting-control flex-row"},gs={class:"form-actions"},ys={class:"progress-body"},bs={id:"update-log-box",class:"log-box"},_s={class:"time"},ks={key:0,class:"dialog-actions"},ws=oe({__name:"GeneralSettings",setup(n){const I=me(),v=He(),p=ae(()=>{const U=I.params.serverId;return U?parseInt(U):NaN}),h=w(null),r=w(!1),_=w(!1),B=w(!1),c=[{label:"UTF-8",value:"utf-8"},{label:"GBK",value:"gbk"}],i=w({id:p.value,name:"",base:"",java:"",core:"",minM:1024,maxM:4096,args:"",yggdrasilApiAddr:"",backupMaxCount:20,backupDelay:10,backupPath:"MSLX://Backup/Instance",autoRestart:!1,forceAutoRestart:!0,ignoreEula:!1,runOnStartup:!1,inputEncoding:"utf-8",outputEncoding:"utf-8",fileEncoding:"utf-8",coreUrl:"",coreSha256:"",coreFileKey:""}),k=w("MB"),N=w("MB"),X=[{label:"MB",value:"MB"},{label:"GB",value:"GB"}],T=ae({get:()=>{if(k.value==="GB"){const U=i.value.minM/1024;return Math.round(U*100)/100}return i.value.minM},set:U=>{i.value.minM=k.value==="GB"?Math.round(U*1024):U}}),u=ae({get:()=>{if(N.value==="GB"){const U=i.value.maxM/1024;return Math.round(U*100)/100}return i.value.maxM},set:U=>{i.value.maxM=N.value==="GB"?Math.round(U*1024):U}}),f=w("custom"),y=w([]),x=w([]),$=w(""),d=w(""),s=async(U=!1)=>{try{U&&J.info("正在扫描 Java 环境...");const a=await Lt(v.userInfo.systemInfo.osType.toLowerCase().replace("os",""),v.userInfo.systemInfo.osArchitecture.toLowerCase());a&&Array.isArray(a)&&(y.value=a.map(K=>({label:`Java ${K} (在线)`,value:K})));const H=await At(U);x.value=H.map(K=>({label:`Java ${K.version} (${K.path})`,value:K.path})),U&&J.success("刷新成功")}catch(a){console.error(a)}};Z([f,$,d],([U,a,H])=>{U==="none"?i.value.java="none":U==="env"?i.value.java="java":U==="custom"||U==="local"?i.value.java=H:U==="online"&&(i.value.java=a?`MSLX://Java/${a}`:"")});const b=w("MSLX://Backup/Instance"),L=w("");Z([b,L],([U,a])=>{U==="custom"?i.value.backupPath=a:i.value.backupPath=U});const o=w(""),S=w(""),O=[{label:"官方/离线模式 (无)",value:"none"},{label:"MSL 统一身份验证 (MSL Skin)",value:"https://skin.mslmc.net/api/yggdrasil"},{label:"LittleSkin",value:"https://littleskin.cn/api/yggdrasil"},{label:"自定义服务器",value:"custom"}];Z([o,S],([U,a])=>{U==="none"?i.value.yggdrasilApiAddr="":U==="custom"?i.value.yggdrasilApiAddr=a:i.value.yggdrasilApiAddr=U});const W=w(!1),q=w(!1),F=w(null),A=w(!1),Y=w(0),G=w(""),Q=U=>{i.value.core=U.filename,i.value.coreUrl=U.url,i.value.coreSha256=U.sha256,i.value.coreFileKey="",W.value=!1,J.success(`已选择核心: ${U.filename}，保存后将自动下载`)},C=()=>{var U;return(U=F.value)==null?void 0:U.click()},te=async U=>{var K;const a=U.target;if(!((K=a.files)!=null&&K.length))return;const H=a.files[0];if(i.value.coreFileKey)try{await $t(i.value.coreFileKey)}catch{console.error("删除上传失败")}G.value=H.name,A.value=!0,Y.value=0;try{const ee=(await xt()).uploadId,le=5*1024*1024,be=Math.ceil(H.size/le);for(let re=0;re<be;re++){const Ie=H.slice(re*le,Math.min(H.size,(re+1)*le));await Ct(ee,re,Ie),Y.value=Math.floor((re+1)/be*100)}const _e=await Vt(ee,be);i.value.coreFileKey=_e.uploadId,i.value.core=H.name,i.value.coreUrl="",J.success("文件上传就绪，保存后生效"),W.value=!1}catch(se){J.error(`上传失败: ${se.message}`)}finally{A.value=!1,a.value=""}},ot=()=>{B.value||oa.warning({title:"风险操作",content:"修改实例路径会导致面板无法找到原有文件。请确保您已手动移动了文件，或您明确知道自己在做什么。",duration:5e3}),B.value=!B.value},fe=w(!1),ge=w(0),Ce=w([]),ce=w(null),it=ae(()=>f.value==="none"?{name:[{required:!0,message:"服务器名称不能为空",trigger:"blur"}],base:[{required:!0,message:"基础路径不能为空",trigger:"blur"}],args:[{required:!0,message:"自定义模式必须填写启动命令",trigger:"blur"}]}:{name:[{required:!0,message:"服务器名称不能为空",trigger:"blur"}],base:[{required:!0,message:"基础路径不能为空",trigger:"blur"}],java:[{required:!0,message:"Java 环境不能为空",trigger:"change"}],core:[{required:!0,message:"核心文件名不能为空",trigger:"change"}],minM:[{required:!0,message:"必填",trigger:"blur"}],maxM:[{required:!0,message:"必填",trigger:"blur"}]}),ye=async()=>{if(p.value){r.value=!0;try{await s(),i.value.id=p.value;const U=await Ut(p.value);if(i.value={...i.value,...U,coreUrl:"",coreFileKey:"",coreSha256:""},k.value=U.minM>0&&U.minM%1024===0?"GB":"MB",N.value=U.maxM>0&&U.maxM%1024===0?"GB":"MB",B.value=!1,U.java==="none")f.value="none";else if(U.java==="java")f.value="env";else if(U.java.startsWith("MSLX://Java/"))f.value="online",$.value=U.java.replace("MSLX://Java/","");else{const K=x.value.find(se=>se.value===U.java);f.value=K?"local":"custom",d.value=U.java}const a=U.backupPath;a==="MSLX://Backup/Instance"||a==="MSLX://Backup/Data"?b.value=a:(b.value="custom",L.value=a);const H=U.yggdrasilApiAddr;H?H==="https://skin.mslmc.net/api/yggdrasil"?o.value="https://skin.mslmc.net/api/yggdrasil":H==="https://littleskin.cn/api/yggdrasil"?o.value="https://littleskin.cn/api/yggdrasil":(o.value="custom",S.value=H):o.value="none"}catch(U){J.error("获取配置失败: "+U.message)}finally{r.value=!1}}};Z(()=>I.params.serverId,U=>{I.name==="InstanceConsole"&&U&&ye()}),pe(ye);const rt=async()=>{var a,H;if(await((a=h.value)==null?void 0:a.validate())===!0&&!(f.value!=="none"&&(i.value.coreUrl||i.value.coreFileKey)&&!await new Promise(ee=>{const le=Pe.confirm({header:"确认变更核心文件?",body:"检测到您上传或选择了新的核心文件，这将覆盖服务器现有的部署。",theme:"warning",onConfirm:()=>{le.hide(),ee(!0)},onClose:()=>{le.hide(),ee(!1)}})}))){f.value==="none"&&(i.value.core="none",i.value.minM=1027,i.value.maxM=1102,i.value.java="none",i.value.coreUrl="",i.value.coreFileKey="",i.value.coreSha256=""),_.value=!0;try{const K=await It(i.value);((H=K.data)==null?void 0:H.needListen)??K.needListen?ut():(J.success("配置已保存"),_.value=!1,ye())}catch(K){J.error(K.message||"保存失败"),_.value=!1}}},ut=async()=>{fe.value=!0,ge.value=0,Ce.value=[];const{baseUrl:U,token:a}=v,H=new URL("/api/hubs/updateProgressHub",U||window.location.origin);H.searchParams.append("x-user-token",a),ce.value=new We().withUrl(H.toString(),{withCredentials:!1}).configureLogging(Xe.None).build(),ce.value.on("UpdateStatus",(K,se,ee)=>{Ce.value.push({time:new Date().toLocaleTimeString(),msg:ee?`[错误] ${K}`:K}),Se(()=>{const le=document.getElementById("update-log-box");le&&(le.scrollTop=le.scrollHeight)}),se>=0&&(ge.value=Number(se.toFixed(1))),se===100&&(J.success("更新完成"),dt(!0))});try{await ce.value.start(),await ce.value.invoke("JoinGroup",p.value.toString())}catch{Ce.value.push({time:"-",msg:"连接失败"})}},dt=(U=!1)=>{var a;(a=ce.value)==null||a.stop(),setTimeout(()=>{fe.value=!1,_.value=!1,U&&ye()},1e3)};return Ue(()=>{var U;(U=ce.value)==null||U.stop()}),(U,a)=>{const H=V("t-input"),K=V("t-button"),se=V("t-tooltip"),ee=V("t-select"),le=V("t-textarea"),be=V("t-alert"),_e=V("t-icon"),re=V("t-col"),Ie=V("t-row"),Oe=V("t-progress"),ct=V("t-space"),ke=V("t-input-number"),we=V("t-switch"),vt=V("t-form"),mt=V("t-loading"),pt=V("t-dialog");return g(),E("div",ka,[t(mt,{loading:r.value,"show-overlay":""},{default:l(()=>[t(vt,{ref_key:"formRef",ref:h,data:i.value,rules:it.value,"label-width":"0",onSubmit:rt},{default:l(()=>[a[57]||(a[57]=e("div",{class:"setting-group-title"},"基础设置",-1)),e("div",wa,[a[32]||(a[32]=e("div",{class:"setting-info"},[e("div",{class:"title"},"服务器名称"),e("div",{class:"desc"},"在面板列表中显示的别名，支持中文")],-1)),e("div",ha,[t(H,{modelValue:i.value.name,"onUpdate:modelValue":a[0]||(a[0]=M=>i.value.name=M),placeholder:"请输入名称"},null,8,["modelValue"])])]),e("div",$a,[e("div",xa,[a[33]||(a[33]=e("div",{class:"title"},"实例路径",-1)),e("div",Ca,[e("span",{class:$e({"text-warning":B.value})},P(B.value?"警告：修改路径可能导致无法找到原文件":"服务器文件的物理存储路径，非必要请勿修改"),3)])]),e("div",Va,[t(H,{modelValue:i.value.base,"onUpdate:modelValue":a[1]||(a[1]=M=>i.value.base=M),disabled:!B.value},{suffix:l(()=>[t(se,{content:B.value?"点击锁定":"点击解锁编辑 (慎重)"},{default:l(()=>[t(K,{variant:"text",shape:"square",onClick:ot},{icon:l(()=>[B.value?(g(),j(R(Et),{key:0,style:{color:"var(--td-warning-color)"}})):(g(),j(R(Pt),{key:1}))]),_:1})]),_:1},8,["content"])]),_:1},8,["modelValue","disabled"])])]),a[58]||(a[58]=e("div",{class:"setting-group-title"},"运行模式",-1)),e("div",Sa,[a[34]||(a[34]=e("div",{class:"setting-info"},[e("div",{class:"title"},"启动方式"),e("div",{class:"desc"},"选择使用 Java 启动 Minecraft，或使用自定义命令启动其他程序 (如 Bedrock, Python 等)")],-1)),e("div",Ra,[t(ee,{modelValue:f.value,"onUpdate:modelValue":a[2]||(a[2]=M=>f.value=M),options:[{label:"MSLX 在线下载 (Java)",value:"online"},{label:"使用本地版本 (Java)",value:"local"},{label:"自定义路径 (Java)",value:"custom"},{label:"环境变量 (Java)",value:"env"},{label:"自定义命令 (无Java)",value:"none"}]},null,8,["modelValue"]),f.value!=="none"?(g(),E("div",Ua,[f.value==="online"?(g(),j(ee,{key:0,modelValue:$.value,"onUpdate:modelValue":a[3]||(a[3]=M=>$.value=M),options:y.value,placeholder:"请选择版本",filterable:""},null,8,["modelValue","options"])):z("",!0),f.value==="local"?(g(),j(ee,{key:1,modelValue:d.value,"onUpdate:modelValue":a[4]||(a[4]=M=>d.value=M),options:x.value,placeholder:"选择已识别的 Java"},null,8,["modelValue","options"])):z("",!0),f.value==="custom"?(g(),j(H,{key:2,modelValue:d.value,"onUpdate:modelValue":a[5]||(a[5]=M=>d.value=M),placeholder:"输入 java 可执行文件完整路径"},null,8,["modelValue"])):z("",!0)])):z("",!0)])]),e("div",Ia,[e("div",Ma,[e("div",Ba,P(f.value==="none"?"启动命令 (Command)":"启动参数 (JVM Args)"),1),e("div",La,P(f.value==="none"?"完全自定义的启动命令。程序将直接执行此段内容，不依赖 Java 环境。":"传递给 Java 的启动参数，如 GC 策略 (例如 -XX:+UseG1GC)"),1)]),e("div",Aa,[t(le,{modelValue:i.value.args,"onUpdate:modelValue":a[6]||(a[6]=M=>i.value.args=M),autosize:{minRows:2,maxRows:4},placeholder:f.value==="none"?"例如: ./bedrock_server_x64":"无特殊需求请留空"},null,8,["modelValue","placeholder"])])]),f.value!=="none"?(g(),E(ne,{key:0},[a[38]||(a[38]=e("div",{class:"setting-group-title"},"核心管理",-1)),e("div",Ea,[a[37]||(a[37]=e("div",{class:"setting-info"},[e("div",{class:"title"},"服务端核心文件"),e("div",{class:"desc"},[m(" 指定启动的 Jar 文件名。如果文件已存在于目录中，直接输入文件名即可。 "),e("br"),m("需要更新核心？点击下方“文件工具” ")])],-1)),e("div",Pa,[t(H,{modelValue:i.value.core,"onUpdate:modelValue":a[8]||(a[8]=M=>i.value.core=M),placeholder:"例如 server.jar"},{suffix:l(()=>[t(K,{variant:"text",theme:"primary",size:"small",onClick:a[7]||(a[7]=M=>W.value=!W.value)},{default:l(()=>[m(P(W.value?"收起工具":"文件工具"),1)]),_:1})]),_:1},8,["modelValue"]),W.value?(g(),E("div",Ta,[t(ct,{direction:"vertical",style:{width:"100%"}},{default:l(()=>[t(be,{theme:"info",message:"在此处操作会自动下载/上传文件，并填入上方的文件名。"}),t(Ie,{gutter:12},{default:l(()=>[t(re,{span:6},{default:l(()=>[t(K,{block:"",variant:"outline",onClick:a[9]||(a[9]=M=>q.value=!0)},{icon:l(()=>[t(_e,{name:"cloud-download"})]),default:l(()=>[a[35]||(a[35]=m(" 从版本库下载 ",-1))]),_:1})]),_:1}),t(re,{span:6},{default:l(()=>[t(K,{block:"",variant:"outline",loading:A.value,onClick:C},{icon:l(()=>[t(_e,{name:"upload"})]),default:l(()=>[a[36]||(a[36]=m(" 上传本地文件 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1}),e("input",{ref_key:"uploadInputRef",ref:F,type:"file",accept:".jar",hidden:"",onChange:te},null,544),A.value?(g(),E("div",Oa,[e("span",null,"正在上传: "+P(G.value),1),t(Oe,{theme:"line",percentage:Y.value},null,8,["percentage"])])):z("",!0)]),_:1})])):z("",!0)])])],64)):z("",!0),f.value!=="none"?(g(),E(ne,{key:1},[a[41]||(a[41]=e("div",{class:"setting-group-title"},"资源限制",-1)),e("div",Fa,[a[40]||(a[40]=e("div",{class:"setting-info"},[e("div",{class:"title"},"内存分配"),e("div",{class:"desc"},"设置 Java 堆内存大小 (Xms / Xmx)")],-1)),e("div",Da,[e("div",Na,[t(ke,{modelValue:T.value,"onUpdate:modelValue":a[10]||(a[10]=M=>T.value=M),min:0,"decimal-places":k.value==="GB"?1:0,placeholder:"Xms",theme:"normal",class:"input-left"},null,8,["modelValue","decimal-places"]),t(ee,{modelValue:k.value,"onUpdate:modelValue":a[11]||(a[11]=M=>k.value=M),options:X,clearable:!1,class:"select-right"},null,8,["modelValue"])]),a[39]||(a[39]=e("span",{class:"separator"},"-",-1)),e("div",za,[t(ke,{modelValue:u.value,"onUpdate:modelValue":a[12]||(a[12]=M=>u.value=M),min:0,"decimal-places":N.value==="GB"?1:0,placeholder:"Xmx",theme:"normal",class:"input-left"},null,8,["modelValue","decimal-places"]),t(ee,{modelValue:N.value,"onUpdate:modelValue":a[13]||(a[13]=M=>N.value=M),options:X,clearable:!1,class:"select-right"},null,8,["modelValue"])])])])],64)):z("",!0),a[59]||(a[59]=e("div",{class:"setting-group-title"},"备份设置",-1)),e("div",Ga,[a[44]||(a[44]=e("div",{class:"setting-info"},[e("div",{class:"title"},"备份策略"),e("div",{class:"desc"},"设置自动备份保留的最大数量，以及触发备份的延迟时间")],-1)),e("div",Ja,[t(ke,{modelValue:i.value.backupMaxCount,"onUpdate:modelValue":a[14]||(a[14]=M=>i.value.backupMaxCount=M),min:1,max:100,placeholder:"保留份数",theme:"column",style:{width:"140px"},suffix:"份"},null,8,["modelValue"]),a[42]||(a[42]=e("span",{class:"separator"},"/",-1)),t(ke,{modelValue:i.value.backupDelay,"onUpdate:modelValue":a[15]||(a[15]=M=>i.value.backupDelay=M),min:0,placeholder:"延迟时间",theme:"column",style:{width:"140px"},suffix:"秒"},null,8,["modelValue"])]),e("div",ja,[t(se,{content:"MSLX 向服务器发送 save-all 指令后，会等待指定的秒数，确保数据完全写入硬盘后再开始打包备份。"},{default:l(()=>[e("span",Wa,[t(_e,{name:"help-circle"}),a[43]||(a[43]=m(" 什么是延迟时间？ ",-1))])]),_:1})])]),e("div",Xa,[a[45]||(a[45]=e("div",{class:"setting-info"},[e("div",{class:"title"},"备份存放路径"),e("div",{class:"desc"},"选择备份文件存储的位置。推荐存储在实例文件夹外部以免误删。")],-1)),e("div",qa,[t(ee,{modelValue:b.value,"onUpdate:modelValue":a[16]||(a[16]=M=>b.value=M),options:[{label:"实例文件夹内 (Instance)",value:"MSLX://Backup/Instance"},{label:"全局数据目录 (Data)",value:"MSLX://Backup/Data"},{label:"自定义绝对路径",value:"custom"}]},null,8,["modelValue"]),b.value==="custom"?(g(),E("div",Ka,[t(H,{modelValue:L.value,"onUpdate:modelValue":a[17]||(a[17]=M=>L.value=M),placeholder:"输入备份存放的绝对路径"},null,8,["modelValue"])])):z("",!0)])]),f.value!=="none"?(g(),E("div",Ha,"外置登录")):z("",!0),f.value!=="none"?(g(),E("div",Ya,[a[46]||(a[46]=e("div",{class:"setting-info"},[e("div",{class:"title"},"Yggdrasil API"),e("div",{class:"desc"},"选择认证服务器。留空则表示使用官方正版登录 (或离线模式)。")],-1)),e("div",Za,[t(ee,{modelValue:o.value,"onUpdate:modelValue":a[18]||(a[18]=M=>o.value=M),options:O},null,8,["modelValue"]),o.value==="custom"?(g(),E("div",Qa,[t(H,{modelValue:S.value,"onUpdate:modelValue":a[19]||(a[19]=M=>S.value=M),placeholder:"输入 Authlib-Injector API 地址"},null,8,["modelValue"])])):z("",!0)])])):z("",!0),a[60]||(a[60]=e("div",{class:"setting-group-title"},"高级设置",-1)),e("div",es,[a[47]||(a[47]=e("div",{class:"setting-info"},[e("div",{class:"title"},"自动重启"),e("div",{class:"desc"},"当服务器崩溃或意外停止时尝试自动重启"),e("div",{class:"desc"},"熔断机制: 若5分钟内尝试重启次数达到 5 次，则停止尝试重启")],-1)),e("div",ts,[t(we,{modelValue:i.value.autoRestart,"onUpdate:modelValue":a[20]||(a[20]=M=>i.value.autoRestart=M),label:["已开启","已关闭"]},null,8,["modelValue"])])]),i.value.autoRestart?(g(),E("div",as,[a[48]||(a[48]=e("div",{class:"setting-info"},[e("div",{class:"title"},"强制自动重启"),e("div",{class:"desc"},"开启此功能后，就算服务器是正常退出的也会强制重启(正常退出 => 退出代码 0)"),e("div",{class:"desc"},"不影响手动在面板关闭服务器")],-1)),e("div",ss,[t(we,{modelValue:i.value.forceAutoRestart,"onUpdate:modelValue":a[21]||(a[21]=M=>i.value.forceAutoRestart=M),label:["已开启","已关闭"]},null,8,["modelValue"])])])):z("",!0),e("div",ls,[a[49]||(a[49]=e("div",{class:"setting-info"},[e("div",{class:"title"},"关服强制结束时间"),e("div",{class:"desc"},"设置在发出Stop指令或关服请求后，等待多久后强制结束进程"),e("div",{class:"desc"},"可设置10 - 120 s")],-1)),e("div",ns,[t(ke,{modelValue:i.value.forceExitDelay,"onUpdate:modelValue":a[22]||(a[22]=M=>i.value.forceExitDelay=M)},null,8,["modelValue"])])]),e("div",os,[a[50]||(a[50]=e("div",{class:"setting-info"},[e("div",{class:"title"},"忽略EULA提示"),e("div",{class:"desc"},"若您的实例并非MC服务器，可打开此选项")],-1)),e("div",is,[t(we,{modelValue:i.value.ignoreEula,"onUpdate:modelValue":a[23]||(a[23]=M=>i.value.ignoreEula=M),label:["已开启","已关闭"]},null,8,["modelValue"])])]),e("div",rs,[a[51]||(a[51]=e("div",{class:"setting-info"},[e("div",{class:"title"},"随守护进程启动"),e("div",{class:"desc"},"当物理机开机/面板启动时，自动启动此实例")],-1)),e("div",us,[t(we,{modelValue:i.value.runOnStartup,"onUpdate:modelValue":a[24]||(a[24]=M=>i.value.runOnStartup=M),label:["已开启","已关闭"]},null,8,["modelValue"])])]),f.value!=="none"?(g(),E("div",ds,[a[52]||(a[52]=e("div",{class:"setting-info"},[e("div",{class:"title"},"强制Java使用UTF8"),e("div",{class:"desc"},"此功能可以解决部分游戏内中文乱码的问题（特别是Windows系统上）"),e("div",{class:"desc"},[m("开启此功能后请务必将下面的"),e("b",null,"文件编码"),m("设置设置为"),e("b",null,"UTF-8")])],-1)),e("div",cs,[t(we,{modelValue:i.value.forceJvmUTF8,"onUpdate:modelValue":a[25]||(a[25]=M=>i.value.forceJvmUTF8=M),label:["已开启","已关闭"]},null,8,["modelValue"])])])):z("",!0),e("div",vs,[a[53]||(a[53]=e("div",{class:"setting-info"},[e("div",{class:"title"},"控制台编码"),e("div",{class:"desc"},"设置输入输出流的字符集，乱码时请尝试切换")],-1)),e("div",ms,[t(ee,{modelValue:i.value.inputEncoding,"onUpdate:modelValue":a[26]||(a[26]=M=>i.value.inputEncoding=M),options:c,label:"输入",style:{width:"140px"}},null,8,["modelValue"]),t(ee,{modelValue:i.value.outputEncoding,"onUpdate:modelValue":a[27]||(a[27]=M=>i.value.outputEncoding=M),options:c,label:"输出",style:{width:"140px"}},null,8,["modelValue"])])]),e("div",ps,[a[54]||(a[54]=e("div",{class:"setting-info"},[e("div",{class:"title"},"文件编码"),e("div",{class:"desc"},"设置文件编辑和保存时的编码格式，乱码时请尝试切换。(一般Windows是GBK，其他是UTF-8。)")],-1)),e("div",fs,[t(ee,{modelValue:i.value.fileEncoding,"onUpdate:modelValue":a[28]||(a[28]=M=>i.value.fileEncoding=M),options:c,style:{width:"140px"}},null,8,["modelValue"])])]),e("div",gs,[t(K,{theme:"primary",type:"submit",size:"large",loading:_.value},{default:l(()=>[...a[55]||(a[55]=[m("保存设置",-1)])]),_:1},8,["loading"]),t(K,{theme:"default",variant:"base",size:"large",onClick:ye},{default:l(()=>[...a[56]||(a[56]=[m("重置更改",-1)])]),_:1})])]),_:1},8,["data","rules"])]),_:1},8,["loading"]),t(Bt,{visible:q.value,"onUpdate:visible":a[29]||(a[29]=M=>q.value=M),onConfirm:Q},null,8,["visible"]),t(pt,{visible:fe.value,"onUpdate:visible":a[31]||(a[31]=M=>fe.value=M),header:"正在应用更新",footer:!1,"close-on-overlay-click":!1,"close-btn":!1,width:"600px"},{default:l(()=>[e("div",ys,[t(Oe,{theme:"plump",percentage:ge.value,label:`${ge.value}%`},null,8,["percentage","label"]),e("div",bs,[(g(!0),E(ne,null,ue(Ce.value,(M,ft)=>(g(),E("div",{key:ft,class:"log-line"},[e("span",_s,P(M.time),1),m(" "+P(M.msg),1)]))),128))]),ge.value===100?(g(),E("div",ks,[t(K,{theme:"primary",onClick:a[30]||(a[30]=M=>fe.value=!1)},{default:l(()=>[...a[61]||(a[61]=[m("关闭并刷新",-1)])]),_:1})])):z("",!0)])]),_:1},8,["visible"])])}}}),hs=ie(ws,[["__scopeId","data-v-700c134f"]]),$s={class:"pm-container"},xs={class:"header-section"},Cs={class:"mode-switcher"},Vs={key:0,class:"error-alert-bar"},Ss={class:"toolbar"},Rs={class:"left-actions"},Us={key:0,class:"bulk-actions"},Is={class:"selected-count"},Ms={class:"right-search"},Bs={class:"table-wrapper"},Ls={style:{display:"flex","align-items":"center",gap:"8px"}},As={class:"empty-state"},Es={class:"tips-footer"},Ps=oe({__name:"ModsPluginsManager",setup(n){const I=me(),v=parseInt(I.params.serverId),p=w("mods"),h=w(!1),r=w([]),_=w(""),B=w([]),c=w(""),i=ae(()=>{if(!_.value)return r.value;const d=_.value.toLowerCase();return r.value.filter(s=>s.name.toLowerCase().includes(d))}),k=ae(()=>[{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{title:"文件名",colKey:"name",sorter:(d,s)=>d.name.localeCompare(s.name),ellipsis:!0},{title:"状态",colKey:"status",width:100},{title:"操作",colKey:"op",width:180,fixed:"right",align:"right"}]),N=async(d=!1)=>{h.value=!0,B.value=[],c.value="";try{const s=await Be(v,p.value,d),b=(s.clientJarFiles||[]).map(S=>({name:S,status:"enabled",isClient:!0})),L=(s.jarFiles||[]).map(S=>({name:S,status:"enabled"})),o=(s.disableJarFiles||[]).map(S=>({name:S,status:"disabled"}));r.value=[...b,...L,...o],d&&b.length>0?(B.value=b.map(S=>S.name),J.success(`检测到 ${b.length} 个客户端模组`)):d&&J.info("未检测到仅客户端模组")}catch(s){const b=s.message||"获取列表失败";c.value=b,r.value=[]}finally{h.value=!1}},X=async(d,s)=>{if(s.length===0)return;const b={enable:"启用",disable:"禁用",delete:"删除"},L=async()=>{try{h.value=!0;const o=await St(v,p.value,d,s),{successCount:S,failCount:O}=o||{};O>0?J.warning(`操作完成：成功 ${S} 个，失败 ${O} 个`):J.success(`成功${b[d]} ${S} 个文件`),await N()}catch(o){J.error(o.message||"操作失败"),h.value=!1}};if(d==="delete"){const o=Pe.confirm({header:`确认删除 ${s.length} 个文件?`,body:"此操作不可逆，文件将被永久删除。",theme:"danger",onConfirm:()=>{o.hide(),L()}})}else await L()},T=d=>{p.value=d,N()},u=d=>{const s=d.status==="enabled"?"disable":"enable";X(s,[d.name])},f=d=>{const s=B.value;X(d,s)},y=w(!1),x=()=>{y.value=!0},$=()=>{y.value=!1,N()};return pe(()=>{N()}),Z(()=>I.params.serverId,d=>{d&&location.reload()}),(d,s)=>{const b=V("t-radio-button"),L=V("t-radio-group"),o=V("t-alert"),S=V("t-button"),O=V("t-input"),W=V("t-tag"),q=V("t-switch"),F=V("t-popconfirm"),A=V("t-space"),Y=V("t-table");return g(),E("div",$s,[e("div",xs,[s[13]||(s[13]=e("div",{class:"setting-group-title"}," 资源管理 ",-1)),e("div",Cs,[t(L,{modelValue:p.value,"onUpdate:modelValue":s[0]||(s[0]=G=>p.value=G),variant:"default-filled",onChange:T},{default:l(()=>[t(b,{value:"mods"},{icon:l(()=>[t(R(Le))]),default:l(()=>[s[11]||(s[11]=m(" 模组 (Mods) ",-1))]),_:1}),t(b,{value:"plugins"},{icon:l(()=>[t(R(Re))]),default:l(()=>[s[12]||(s[12]=m(" 插件 (Plugins) ",-1))]),_:1})]),_:1},8,["modelValue"])])]),c.value?(g(),E("div",Vs,[t(o,{theme:"error",message:c.value,closeable:"",onClose:s[2]||(s[2]=G=>c.value="")},{operation:l(()=>[e("span",{style:{cursor:"pointer","margin-left":"8px"},onClick:s[1]||(s[1]=G=>N(!1))},"重试")]),_:1},8,["message"])])):z("",!0),e("div",Ss,[e("div",Rs,[t(S,{theme:"primary",disabled:c.value!=="",onClick:x},{icon:l(()=>[t(R(Tt))]),default:l(()=>[s[14]||(s[14]=m(" 上传文件 ",-1))]),_:1},8,["disabled"]),p.value==="mods"?(g(),j(S,{key:0,disabled:c.value!=="",variant:"outline",loading:h.value,onClick:s[3]||(s[3]=G=>N(!0))},{icon:l(()=>[t(R(Ne))]),default:l(()=>[s[15]||(s[15]=m(" 检测客户端模组 ",-1))]),_:1},8,["disabled","loading"])):z("",!0),t(S,{variant:"outline",loading:h.value,onClick:s[4]||(s[4]=G=>N(!1))},{icon:l(()=>[t(R(he))]),_:1},8,["loading"]),t(qe,{name:"fade"},{default:l(()=>[B.value.length>0?(g(),E("div",Us,[s[19]||(s[19]=e("div",{class:"divider"},null,-1)),e("span",Is,"已选 "+P(B.value.length)+" 项",1),t(S,{size:"small",variant:"text",theme:"success",onClick:s[5]||(s[5]=G=>f("enable"))},{default:l(()=>[...s[16]||(s[16]=[m("启用",-1)])]),_:1}),t(S,{size:"small",variant:"text",theme:"warning",onClick:s[6]||(s[6]=G=>f("disable"))},{default:l(()=>[...s[17]||(s[17]=[m("禁用",-1)])]),_:1}),t(S,{size:"small",variant:"text",theme:"danger",onClick:s[7]||(s[7]=G=>f("delete"))},{default:l(()=>[...s[18]||(s[18]=[m("删除",-1)])]),_:1})])):z("",!0)]),_:1})]),e("div",Ms,[t(O,{modelValue:_.value,"onUpdate:modelValue":s[8]||(s[8]=G=>_.value=G),placeholder:"搜索文件名...",clearable:""},{"prefix-icon":l(()=>[t(R(Ne))]),_:1},8,["modelValue"])])]),e("div",Bs,[t(Y,{"selected-row-keys":B.value,"onUpdate:selectedRowKeys":s[9]||(s[9]=G=>B.value=G),pagination:{defaultPageSize:20,total:i.value.length,showJumper:!0,defaultCurrent:1},data:i.value,columns:k.value,"row-key":"name",loading:h.value,hover:"",stripe:"",class:"custom-table"},{name:l(({row:G})=>[e("div",Ls,[e("span",null,P(G.name),1),G.isClient?(g(),j(W,{key:0,theme:"warning",variant:"light",size:"small"},{default:l(()=>[...s[20]||(s[20]=[m(" 客户端 ",-1)])]),_:1})):z("",!0)])]),status:l(({row:G})=>[G.status==="enabled"?(g(),j(W,{key:0,theme:"success",variant:"light"},{icon:l(()=>[t(R(et))]),default:l(()=>[s[21]||(s[21]=m(" 已启用 ",-1))]),_:1})):(g(),j(W,{key:1,theme:"default",variant:"light",style:{color:"var(--td-text-color-placeholder)"}},{icon:l(()=>[t(R(tt))]),default:l(()=>[s[22]||(s[22]=m(" 已禁用 ",-1))]),_:1}))]),op:l(({row:G})=>[t(A,{size:"small"},{default:l(()=>[t(q,{"model-value":G.status==="enabled",loading:h.value,size:"medium",onChange:Q=>u(G)},{label:l(Q=>[m(P(Q.value?"开":"关"),1)]),_:1},8,["model-value","loading","onChange"]),t(F,{content:"确定要删除此文件吗？",theme:"danger",onConfirm:Q=>X("delete",[G.name])},{default:l(()=>[t(S,{variant:"text",theme:"danger",shape:"square"},{default:l(()=>[t(R(Qe))]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)]),empty:l(()=>[e("div",As,[p.value==="mods"?(g(),j(R(Le),{key:0,size:"48px",style:{color:"var(--td-gray-color-4)"}})):(g(),j(R(Re),{key:1,size:"48px",style:{color:"var(--td-gray-color-4)"}})),e("p",null,P(`暂无${p.value==="mods"?"模组":"插件"}文件`),1)])]),_:1},8,["selected-row-keys","pagination","data","columns","loading"])]),e("div",Es,[e("p",null,"提示："+P(p.value==="mods"?"模组":"插件")+"文件存放于服务器根目录的 /"+P(p.value)+" 文件夹下。",1),s[23]||(s[23]=e("p",null,"禁用文件后，会在文件名后添加 .disabled 后缀，服务器将忽略该文件。",-1))]),t(ia,{visible:y.value,"onUpdate:visible":s[10]||(s[10]=G=>y.value=G),"instance-id":R(v),"current-path":p.value,"allow-folder":!1,onSuccess:$},null,8,["visible","instance-id","current-path"])])}}}),Ts=ie(Ps,[["__scopeId","data-v-c8641ed4"]]),je=[{key:"motd",label:"服务器标语",desc:"显示在多人游戏列表中的服务器介绍信息，支持颜色代码，不支持中文。",type:"string"},{key:"server-port",label:"服务器端口",desc:"默认为 25565。如果要在一台机器运行多个服务器，必须修改此端口。",type:"number"},{key:"max-players",label:"最大玩家数",desc:"服务器同时允许在线的最大玩家数量。",type:"number"},{key:"online-mode",label:"正版验证",desc:"开启后将验证玩家的正版账号。如果使用离线/皮肤站，请关闭此项。",type:"boolean"},{key:"white-list",label:"启用白名单",desc:"开启后只有在白名单内的玩家才能进入服务器。",type:"boolean"},{key:"enforce-whitelist",label:"强制白名单",desc:"开启后，当玩家不在白名单时，即使已在线也会被踢出（通常用于维护时重新加载白名单）。",type:"boolean"},{key:"level-name",label:"存档文件夹名称",desc:"服务器读取的世界存档文件夹名称（默认为 world）。",type:"string"},{key:"gamemode",label:"默认游戏模式",desc:"新玩家进入服务器时的默认模式。",type:"select",options:[{label:"生存 (Survival)",value:"survival"},{label:"创造 (Creative)",value:"creative"},{label:"冒险 (Adventure)",value:"adventure"},{label:"旁观 (Spectator)",value:"spectator"}]},{key:"force-gamemode",label:"强制游戏模式",desc:"开启后，玩家每次加入服务器都会被重置为默认游戏模式。",type:"boolean"},{key:"difficulty",label:"难度",desc:"世界的游戏难度设置。",type:"select",options:[{label:"和平 (Peaceful)",value:"peaceful"},{label:"简单 (Easy)",value:"easy"},{label:"普通 (Normal)",value:"normal"},{label:"困难 (Hard)",value:"hard"}]},{key:"hardcore",label:"极限模式",desc:"开启后，玩家死亡将被封禁。",type:"boolean"},{key:"allow-flight",label:"允许飞行",desc:"允许生存模式下的玩家飞行（防止被服务端反作弊踢出）。",type:"boolean"},{key:"spawn-protection",label:"出生点保护半径",desc:"出生点周围多少格内禁止非 OP 破坏。设为 0 可禁用。",type:"number"},{key:"player-idle-timeout",label:"挂机踢出时间",desc:"玩家闲置多少分钟后被自动踢出。0 为不限制。",type:"number"},{key:"level-seed",label:"世界种子",desc:"生成世界使用的种子，留空则随机生成。",type:"string"},{key:"level-type",label:"世界类型",desc:"例如 minecraft:normal, minecraft:flat, minecraft:amplified。",type:"string"},{key:"generate-structures",label:"生成结构",desc:"是否生成村庄、地牢等结构。",type:"boolean"},{key:"generator-settings",label:"生成器设置",desc:"用于自定义超平坦或特定生成器的 JSON 参数。",type:"string"},{key:"max-world-size",label:"世界边界半径",desc:"设置世界边界（World Border）的最大半径。",type:"number"},{key:"simulation-distance",label:"模拟距离",desc:"服务器实际运算实体/作物生长的区块半径（3-32）。",type:"number"},{key:"view-distance",label:"视距",desc:"客户端可以看见的区块半径。数值过大显著增加内存和带宽消耗。",type:"number"},{key:"entity-broadcast-range-percentage",label:"实体广播范围百分比",desc:"控制客户端能看到实体的距离系数（100表示默认）。",type:"number"},{key:"max-tick-time",label:"最大刻耗时 (Watchdog)",desc:"一刻的最长处理毫秒数。超过此数值服务器将强制关闭以防卡死。设为 -1 可禁用。",type:"number"},{key:"network-compression-threshold",label:"网络压缩阈值",desc:"数据包超过此字节数时进行压缩。设为 -1 禁用压缩。推荐保持默认 256。",type:"number"},{key:"rate-limit",label:"数据包限制",desc:"如果玩家发送数据包过快，将被踢出。0 为禁用。",type:"number"},{key:"use-native-transport",label:"使用原生传输优化",desc:"Linux 环境下是否启用 Epoll 优化网络性能。",type:"boolean"},{key:"prevent-proxy-connections",label:"防止代理连接",desc:"是否尝试阻止通过 VPN 或代理的连接（ISP/AS 号判断）。",type:"boolean"},{key:"sync-chunk-writes",label:"同步区块写入",desc:"开启后区块写入完成后才继续逻辑，数据更安全但可能掉帧；关闭可能提升性能。",type:"boolean"},{key:"region-file-compression",label:"区块文件压缩格式",desc:"用于保存区块的压缩算法。",type:"select",options:[{label:"Deflate (默认)",value:"deflate"},{label:"LZ4 (更快)",value:"lz4"},{label:"不压缩 (None)",value:"none"}]},{key:"max-chained-neighbor-updates",label:"最大连锁更新数",desc:"限制红石/方块连锁更新的数量以防止崩服。",type:"number"},{key:"log-ips",label:"控制台记录 IP",desc:"是否在控制台日志中显示玩家连接的 IP 地址。",type:"boolean"},{key:"hide-online-players",label:"隐藏在线玩家列表",desc:"开启后，服务器列表中将不显示具体的玩家名单。",type:"boolean"},{key:"enable-status",label:"启用状态查询",desc:"是否允许外部（如服务器列表网站）查询服务器状态。",type:"boolean"},{key:"accepts-transfers",label:"接受服务器传送",desc:"是否允许玩家从其他服务器无缝传送到此服务器。",type:"boolean"},{key:"pause-when-empty-seconds",label:"空载暂停时间",desc:"服务器内无玩家多少秒后暂停游戏循环（省资源）。-1 为不暂停。",type:"number"},{key:"op-permission-level",label:"OP 权限等级",desc:"设置 OP 的默认权限级别。",type:"select",options:[{label:"1 - 无视出生点保护",value:1},{label:"2 - 使用单机指令 (gamemode等)",value:2},{label:"3 - 多人管理 (kick/ban/op)",value:3},{label:"4 - 系统管理 (stop/save)",value:4}]},{key:"function-permission-level",label:"函数权限等级",desc:"数据包(Datapack)中函数的默认执行权限等级。",type:"number"},{key:"enforce-secure-profile",label:"强制安全配置 (签名)",desc:"强制玩家拥有官方签名的公钥（聊天报告相关）。离线服建议关闭。",type:"boolean"},{key:"enable-code-of-conduct",label:"启用行为准则提示",desc:"是否向玩家展示行为准则链接（遥测相关）。",type:"boolean"},{key:"bug-report-link",label:"Bug 反馈链接",desc:"自定义玩家遇到错误时显示的反馈网址。",type:"string"},{key:"resource-pack",label:"资源包下载地址",desc:"玩家进入服务器时提示下载的资源包直链 URL。",type:"string"},{key:"require-resource-pack",label:"强制资源包",desc:"开启后，拒绝下载资源包的玩家将被踢出。",type:"boolean"},{key:"resource-pack-sha1",label:"资源包 SHA1",desc:"资源包文件的 SHA-1 校验码，用于验证完整性和缓存。",type:"string"},{key:"resource-pack-prompt",label:"资源包提示语",desc:"下载资源包时向玩家显示的自定义消息（Json 格式）。",type:"string"},{key:"initial-enabled-packs",label:"初始启用数据包",desc:"世界生成时默认启用的数据包列表（逗号分隔）。",type:"string"},{key:"initial-disabled-packs",label:"初始禁用数据包",desc:"世界生成时默认禁用的数据包列表。",type:"string"},{key:"enable-rcon",label:"启用 RCON",desc:"开启远程控制台协议，允许外部工具发送指令。",type:"boolean"},{key:"rcon.port",label:"RCON 端口",desc:"RCON 监听端口（默认为 25575）。",type:"number"},{key:"rcon.password",label:"RCON 密码",desc:"连接 RCON 必须的密码。请设置复杂的密码。",type:"string"},{key:"broadcast-rcon-to-ops",label:"向 OP 广播 RCON",desc:"当 RCON 执行指令时，是否通知在线的 OP。",type:"boolean"},{key:"enable-query",label:"启用 Query",desc:"开启 GameSpy4 协议，用于获取服务器详细信息。",type:"boolean"},{key:"query.port",label:"Query 端口",desc:"Query 协议监听端口（默认为 25565）。",type:"number"},{key:"broadcast-console-to-ops",label:"向 OP 广播控制台",desc:"控制台执行的指令输出是否发给在线 OP。",type:"boolean"},{key:"enable-jmx-monitoring",label:"启用 JMX 监控",desc:"开启 Java JMX 性能监控（通常用于开发调试）。",type:"boolean"},{key:"management-server-enabled",label:"启用管理后台",desc:"是否启用 Minecraft 官方定义的管理服务器接口。",type:"boolean"},{key:"management-server-port",label:"管理后台端口",desc:"管理接口监听的端口。",type:"number"},{key:"management-server-host",label:"管理后台主机",desc:"管理接口绑定的主机名/IP。",type:"string"},{key:"management-server-allowed-origins",label:"管理后台允许源",desc:"允许访问管理接口的 Origin 列表。",type:"string"},{key:"server-ip",label:"服务器绑定 IP",desc:"指定服务器绑定的本地网卡 IP。留空表示监听所有网卡（0.0.0.0）。",type:"string"},{key:"debug",label:"调试模式",desc:"开启后控制台将输出更多调试信息。",type:"boolean"},{key:"text-filtering-config",label:"文本过滤配置",desc:"用于文本过滤服务的 API 配置。",type:"string"},{key:"status-heartbeat-interval",label:"状态心跳间隔",desc:"服务器向客户端发送状态心跳的间隔（0 为默认）。",type:"number"}],Os={class:"settings-container"},Fs={class:"page-header"},Ds={class:"config-list"},Ns={key:0,class:"empty-tip"},zs={class:"setting-info"},Gs={class:"title"},Js={class:"key-name-row"},js={key:0,class:"key-name"},Ws={key:0,class:"desc"},Xs={class:"setting-control"},qs={class:"form-actions"},Ks=oe({__name:"ServerProperties",setup(n){const I=me(),v=w(0),p=w(!1),h=w(!1),r=w({}),_=w(""),B=f=>{const y={};return f.split(`
`).forEach($=>{const d=$.trim();if(!d||d.startsWith("#"))return;const s=d.indexOf("=");if(s!==-1){const b=d.substring(0,s).trim(),L=d.substring(s+1).trim();y[b]=L}}),y},c=f=>{let y=`#Minecraft server properties
#${new Date().toString()}
`;const x=je.map(d=>d.key),$=Object.keys(f);return x.forEach(d=>{Object.prototype.hasOwnProperty.call(f,d)&&(y+=`${d}=${f[d]}
`)}),$.forEach(d=>{x.includes(d)||(y+=`${d}=${f[d]}
`)}),y},i=async()=>{if(v.value){p.value=!0;try{const f=await Ye(v.value,"server.properties");f&&(_.value=f,r.value=B(f))}catch(f){J.error(`读取配置文件失败: ${f.message}`)}finally{p.value=!1}}},k=async()=>{h.value=!0;try{const f=c(r.value);await Rt(v.value,"server.properties",f),J.success("配置文件已保存"),i()}catch(f){J.error(`保存失败: ${f.message}`)}finally{h.value=!1}},N=ae(()=>{const f=[],y=r.value,x=new Set(Object.keys(y));return je.forEach($=>{x.has($.key)&&(f.push($),x.delete($.key))}),x.forEach($=>{f.push({key:$,label:$,desc:"未收录的配置项",type:X(y[$]),isUnknown:!0})}),f}),X=f=>f==="true"||f==="false"?"boolean":!isNaN(Number(f))&&f!==""?"number":"string",T=(f,y)=>{const x=r.value[f];return x===void 0?y==="boolean"?!1:"":y==="boolean"?x==="true":y==="number"?Number(x):x},u=(f,y,x)=>{r.value[f]=String(y)};return Z(()=>I.params.serverId,f=>{I.name==="InstanceConsole"&&f&&(v.value=parseInt(f),i())},{immediate:!0}),(f,y)=>{const x=V("t-button"),$=V("t-space"),d=V("t-switch"),s=V("t-select"),b=V("t-input-number"),L=V("t-input"),o=V("t-loading");return g(),E("div",Os,[e("div",Fs,[y[1]||(y[1]=e("div",{class:"section-title"},"Server.properties 配置编辑器",-1)),t($,null,{default:l(()=>[t(x,{variant:"text",shape:"square",loading:p.value,onClick:i},{icon:l(()=>[t(R(he))]),_:1},8,["loading"]),t(x,{theme:"primary",loading:h.value,onClick:k},{icon:l(()=>[t(R(at))]),default:l(()=>[y[0]||(y[0]=m(" 保存配置 ",-1))]),_:1},8,["loading"])]),_:1})]),t(o,{loading:p.value,text:"正在读取配置文件..."},{default:l(()=>[e("div",Ds,[!p.value&&N.value.length===0?(g(),E("div",Ns," 无法找到配置项或文件为空 ")):z("",!0),(g(!0),E(ne,null,ue(N.value,S=>(g(),E("div",{key:S.key,class:$e(["setting-item",{"unknown-item":S.isUnknown}])},[e("div",zs,[e("div",Gs,P(S.label),1),e("div",Js,[S.isUnknown?z("",!0):(g(),E("span",js,P(S.key),1))]),S.isUnknown?z("",!0):(g(),E("div",Ws,P(S.desc||"暂无描述"),1))]),e("div",Xs,[S.type==="boolean"?(g(),j(d,{key:0,"model-value":T(S.key,"boolean"),"onUpdate:modelValue":O=>u(S.key,O,"boolean")},null,8,["model-value","onUpdate:modelValue"])):S.type==="select"?(g(),j(s,{key:1,"model-value":T(S.key,"string"),options:S.options,placeholder:"请选择","onUpdate:modelValue":O=>u(S.key,O,"string")},null,8,["model-value","options","onUpdate:modelValue"])):S.type==="number"?(g(),j(b,{key:2,"model-value":T(S.key,"number"),theme:"column",style:{width:"100%"},"onUpdate:modelValue":O=>u(S.key,O,"number")},null,8,["model-value","onUpdate:modelValue"])):(g(),j(L,{key:3,"model-value":T(S.key,"string"),placeholder:"未设置","onUpdate:modelValue":O=>u(S.key,O,"string")},null,8,["model-value","onUpdate:modelValue"]))])],2))),128))])]),_:1},8,["loading"]),e("div",qs,[t(x,{theme:"primary",size:"large",loading:h.value,onClick:k},{default:l(()=>[...y[2]||(y[2]=[m("保存设置",-1)])]),_:1},8,["loading"]),t(x,{theme:"default",variant:"base",size:"large",onClick:i},{default:l(()=>[...y[3]||(y[3]=[m("重置更改",-1)])]),_:1})])])}}}),Hs=ie(Ks,[["__scopeId","data-v-6dfcc71c"]]);async function Ys(n){return await de.get({url:`/api/instance/tasks/list/${n}`})}async function Zs(n,I,v,p,h,r){return await de.post({url:"/api/instance/tasks/create",data:{instanceId:n,name:I,cron:v,payload:p,type:h,enable:r}})}async function Qs(n,I,v,p,h,r,_){return await de.post({url:"/api/instance/tasks/update",data:{instanceId:n,id:I,name:v,cron:p,payload:h,type:r,enable:_}})}async function el(n){return await de.post({url:`/api/instance/tasks/delete/${n}`})}const tl={class:"cron-gen-container"},al={class:"mode-switch"},sl={key:0,class:"mode-content novice-panel"},ll={class:"novice-input-group"},nl={key:1,class:"mode-content pro-panel"},ol={class:"tab-scroll-area"},il={key:0,class:"specific-box"},rl={class:"result-area"},ul={class:"cron-display"},dl={class:"code-box"},cl={class:"next-runs"},vl={class:"runs-title"},ml={key:0,class:"error-msg"},pl={key:1,class:"runs-list"},fl={class:"index"},gl=oe({__name:"CronGenerator",props:{visible:{type:Boolean,default:!1},initialValue:{type:String,default:""}},emits:["update:visible","confirm"],setup(n,{emit:I}){const v=n,p=I,h=w("novice"),r=w(10),_=w("minute"),B=[{label:"秒",value:"second"},{label:"分钟",value:"minute"},{label:"小时",value:"hour"},{label:"天",value:"day"}],c=w("second"),i=[{label:"秒",value:"second",min:0,max:59},{label:"分",value:"minute",min:0,max:59},{label:"时",value:"hour",min:0,max:23},{label:"日",value:"day",min:1,max:31},{label:"月",value:"month",min:1,max:12},{label:"周",value:"week",min:1,max:7}],k=w({second:{type:"every",start:0,step:1,specifics:[]},minute:{type:"every",start:0,step:1,specifics:[]},hour:{type:"every",start:0,step:1,specifics:[]},day:{type:"every",start:1,step:1,specifics:[]},month:{type:"every",start:1,step:1,specifics:[]},week:{type:"any",start:1,step:1,specifics:[]}}),N=[{label:"周日",value:1},{label:"周一",value:2},{label:"周二",value:3},{label:"周三",value:4},{label:"周四",value:5},{label:"周五",value:6},{label:"周六",value:7}],X=ae(()=>{const s=(q,F="*")=>{const A=k.value[q];return q==="week"&&A.type==="any"||q==="week"&&k.value.day.type!=="every"||q==="day"&&k.value.week.type!=="any"?"?":A.type==="every"?"*":A.type==="interval"?`${A.start}/${A.step}`:A.type==="specific"?A.specifics.length===0?q==="day"||q==="month"?"1":"0":A.specifics.sort((Y,G)=>Y-G).join(","):F},b=s("second"),L=s("minute"),o=s("hour"),S=s("day"),O=s("month"),W=s("week","?");return`${b} ${L} ${o} ${S} ${O} ${W}`}),T=ae(()=>{const s=r.value;switch(_.value){case"second":return`*/${s} * * * * *`;case"minute":return`0 */${s} * * * *`;case"hour":return`0 0 */${s} * * ?`;case"day":return`0 0 0 */${s} * ?`;default:return"* * * * * *"}}),u=ae(()=>h.value==="novice"?T.value:X.value),f=w([]),y=w(""),x=()=>{try{const s=ra.CronExpressionParser.parse(u.value,{currentDate:new Date});f.value=s.take(5).map(b=>new Date(b.toString()).toLocaleString()),y.value=""}catch{y.value="无法解析当前 Cron 表达式，请检查规则是否冲突",f.value=[]}};Z(u,()=>{x()},{immediate:!0}),Z(()=>v.visible,s=>{s&&v.initialValue&&(h.value="pro",x())});const $=()=>{if(y.value){J.warning("当前表达式无效，无法保存");return}p("confirm",u.value),p("update:visible",!1)},d=s=>{const b=i.find(o=>o.value===s);if(!b)return[];const L=[];for(let o=b.min;o<=b.max;o++)L.push({label:o.toString(),value:o});return L};return(s,b)=>{const L=V("t-radio-button"),o=V("t-radio-group"),S=V("t-input-number"),O=V("t-select"),W=V("t-alert"),q=V("t-radio"),F=V("t-checkbox-group"),A=V("t-tab-panel"),Y=V("t-tabs"),G=V("t-tag"),Q=V("t-dialog");return g(),j(Q,{visible:n.visible,header:"Cron 表达式生成器",width:"700px",top:"5vh",onClose:b[4]||(b[4]=C=>p("update:visible",!1)),onConfirm:$},{default:l(()=>[e("div",tl,[e("div",al,[t(o,{modelValue:h.value,"onUpdate:modelValue":b[0]||(b[0]=C=>h.value=C),variant:"default-filled"},{default:l(()=>[t(L,{value:"novice"},{default:l(()=>[...b[5]||(b[5]=[m("🚀 新手模式",-1)])]),_:1}),t(L,{value:"pro"},{default:l(()=>[...b[6]||(b[6]=[m("🛠️ 专业模式",-1)])]),_:1})]),_:1},8,["modelValue"])]),h.value==="novice"?(g(),E("div",sl,[e("div",ll,[b[7]||(b[7]=e("span",null,"每隔",-1)),t(S,{modelValue:r.value,"onUpdate:modelValue":b[1]||(b[1]=C=>r.value=C),min:1,theme:"column",style:{width:"100px"}},null,8,["modelValue"]),t(O,{modelValue:_.value,"onUpdate:modelValue":b[2]||(b[2]=C=>_.value=C),options:B,style:{width:"100px"}},null,8,["modelValue"]),b[8]||(b[8]=e("span",null,"执行一次",-1))]),t(W,{theme:"info",style:{"margin-top":"16px"}},{message:l(()=>[...b[9]||(b[9]=[m(" 此模式适用于简单的周期性任务。如果需要“每周五上午10点”等复杂规则，请切换到",-1),e("b",null,"专业模式",-1),m("。 ",-1)])]),_:1})])):(g(),E("div",nl,[t(Y,{modelValue:c.value,"onUpdate:modelValue":b[3]||(b[3]=C=>c.value=C)},{default:l(()=>[(g(),E(ne,null,ue(i,C=>t(A,{key:C.value,value:C.value,label:C.label},{default:l(()=>[e("div",ol,[t(o,{modelValue:k.value[C.value].type,"onUpdate:modelValue":te=>k.value[C.value].type=te,direction:"vertical"},{default:l(()=>[t(q,{value:"every"},{default:l(()=>[m(P(C.value==="week"?"不指定 (?)":`每${C.label} (*)`),1)]),_:2},1024),C.value!=="week"?(g(),j(q,{key:0,value:"interval"},{default:l(()=>[b[10]||(b[10]=m(" 周期: 从 ",-1)),t(S,{modelValue:k.value[C.value].start,"onUpdate:modelValue":te=>k.value[C.value].start=te,min:C.min,max:C.max,size:"small",theme:"column",style:{width:"60px"}},null,8,["modelValue","onUpdate:modelValue","min","max"]),m(" "+P(C.label)+"开始，每 ",1),t(S,{modelValue:k.value[C.value].step,"onUpdate:modelValue":te=>k.value[C.value].step=te,min:1,max:C.max,size:"small",theme:"column",style:{width:"60px"}},null,8,["modelValue","onUpdate:modelValue","max"]),m(" "+P(C.label)+"执行一次 ",1)]),_:2},1024)):z("",!0),C.value!=="week"?(g(),j(q,{key:1,value:"specific"},{default:l(()=>[m("指定: 选择具体的"+P(C.label),1)]),_:2},1024)):z("",!0),C.value==="week"?(g(),j(q,{key:2,value:"specific"},{default:l(()=>[...b[11]||(b[11]=[m("指定周几",-1)])]),_:1})):z("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),k.value[C.value].type==="specific"?(g(),E("div",il,[t(F,{modelValue:k.value[C.value].specifics,"onUpdate:modelValue":te=>k.value[C.value].specifics=te,options:C.value==="week"?N:d(C.value),class:"grid-checkbox"},null,8,["modelValue","onUpdate:modelValue","options"])])):z("",!0)])]),_:2},1032,["value","label"])),64))]),_:1},8,["modelValue"])])),e("div",rl,[e("div",ul,[b[14]||(b[14]=e("span",{class:"label"},"当前表达式:",-1)),e("div",dl,[m(P(u.value)+" ",1),y.value?(g(),j(G,{key:1,theme:"danger",variant:"light",size:"small"},{default:l(()=>[t(R(Ot)),b[13]||(b[13]=m(" 无效",-1))]),_:1})):(g(),j(G,{key:0,theme:"success",variant:"light",size:"small"},{default:l(()=>[t(R(et)),b[12]||(b[12]=m(" 有效",-1))]),_:1}))])]),e("div",cl,[e("div",vl,[t(R(xe)),b[15]||(b[15]=m(" 最近 5 次运行时间预测:",-1))]),y.value?(g(),E("div",ml,P(y.value),1)):(g(),E("ul",pl,[(g(!0),E(ne,null,ue(f.value,(C,te)=>(g(),E("li",{key:te},[e("span",fl,"#"+P(te+1),1),m(" "+P(C),1)]))),128))]))])])])]),_:1},8,["visible"])}}}),yl=ie(gl,[["__scopeId","data-v-b81cfe41"]]),bl={class:"page-container"},_l={class:"page-header"},kl={key:0,class:"create-container"},wl={class:"container-header"},hl={class:"title"},$l={class:"setting-item"},xl={class:"setting-control"},Cl={class:"setting-item"},Vl={class:"setting-control"},Sl={class:"setting-item"},Rl={class:"setting-control"},Ul={key:0,class:"setting-item"},Il={class:"setting-info"},Ml={class:"title"},Bl={class:"desc"},Ll={class:"setting-control"},Al={class:"setting-item"},El={class:"setting-control"},Pl={class:"form-actions"},Tl={class:"task-list"},Ol={key:0,class:"empty-state"},Fl={class:"card-left"},Dl={class:"task-header-row"},Nl={class:"task-name"},zl={class:"task-meta-row"},Gl={class:"cron-display"},Jl=["title"],jl={class:"card-right"},Wl=oe({__name:"CronTasks",setup(n){const I=me(),v=ae(()=>parseInt(I.params.serverId)),p=w([]),h=w(!1),r=w(!1),_=w(null),B=w(!1),c=w(null),i=w(!1),k=w({id:"",name:"",cron:"",type:"command",payload:"",enable:!0}),N=[{label:"发送命令 (Command)",value:"command"},{label:"备份存档 (Backup)",value:"backup"},{label:"开启服务器 (Start)",value:"start"},{label:"停止服务器 (Stop)",value:"stop"},{label:"重启服务器 (Restart)",value:"restart"}],X={name:[{required:!0,message:"必填",trigger:"blur"}],cron:[{required:!0,message:"必填",trigger:"blur"}],type:[{required:!0,message:"必选",trigger:"change"}],payload:[{validator:L=>k.value.type==="command"&&!L?{result:!1,message:"命令内容不能为空",type:"error"}:!0,trigger:"blur"}]},T=async()=>{if(v.value){h.value=!0;try{const L=await Ys(v.value);p.value=L||[]}catch(L){J.error(L.message||"获取列表失败")}finally{h.value=!1}}},u=()=>{r.value||(k.value={id:"",name:"",cron:"",type:"command",payload:"",enable:!0},_.value=null,r.value=!0)},f=L=>{k.value={id:L.id,name:L.name,cron:L.cron,type:L.type.toLowerCase(),payload:L.payload,enable:L.enable},_.value=L.id,r.value=!0,window.scrollTo({top:0,behavior:"smooth"})},y=()=>{r.value=!1,_.value=null},x=async()=>{var o;if(await((o=c.value)==null?void 0:o.validate())===!0){B.value=!0;try{_.value?(await Qs(v.value,k.value.id,k.value.name,k.value.cron,k.value.payload,k.value.type,k.value.enable),J.success("更新成功")):(await Zs(v.value,k.value.name,k.value.cron,k.value.payload,k.value.type,k.value.enable),J.success("创建成功")),y(),T()}catch(S){J.error(S.message||"操作失败")}finally{B.value=!1}}},$=L=>{const o=Pe.confirm({header:"确认删除?",body:`确定删除任务 "${L.name}" 吗？`,theme:"danger",onConfirm:async()=>{try{await el(L.id),J.success("已删除"),T(),o.hide()}catch(S){J.error(S.message)}},onClose:()=>o.hide()})},d=L=>{k.value.cron=L},s=L=>{const o=L.toLowerCase();return o==="start"?st:o==="stop"?lt:o==="restart"?he:Gt},b=L=>{const o=L.toLowerCase();return o==="start"?"success":o==="stop"?"danger":o==="restart"?"warning":"primary"};return Z(()=>v.value,T),pe(T),(L,o)=>{const S=V("t-button"),O=V("t-space"),W=V("t-input"),q=V("t-select"),F=V("t-textarea"),A=V("t-switch"),Y=V("t-form"),G=V("t-tag"),Q=V("t-loading");return g(),E("div",bl,[e("div",_l,[o[10]||(o[10]=e("div",{class:"section-title"},"定时计划任务",-1)),t(O,null,{default:l(()=>[r.value?z("",!0):(g(),j(S,{key:0,theme:"default",onClick:o[0]||(o[0]=C=>R(Ee)(R(ua).cron))},{icon:l(()=>[t(R(Ft))]),default:l(()=>[o[8]||(o[8]=m(" 使用文档 ",-1))]),_:1})),r.value?z("",!0):(g(),j(S,{key:1,theme:"primary",onClick:u},{icon:l(()=>[t(R(Dt))]),default:l(()=>[o[9]||(o[9]=m(" 创建新任务 ",-1))]),_:1}))]),_:1})]),t(qe,{name:"slide-fade"},{default:l(()=>[r.value?(g(),E("div",kl,[e("div",wl,[e("span",hl,P(_.value?"编辑任务":"创建新任务"),1),t(S,{size:"small",variant:"text",onClick:y},{default:l(()=>[t(R(Nt))]),_:1})]),t(Y,{ref_key:"formRef",ref:c,data:k.value,rules:X,"label-width":"0"},{default:l(()=>[e("div",$l,[o[11]||(o[11]=e("div",{class:"setting-info"},[e("div",{class:"title"},"任务名称"),e("div",{class:"desc"},"给这个计划任务起个容易识别的名字，例如“每日自动重启”")],-1)),e("div",xl,[t(W,{modelValue:k.value.name,"onUpdate:modelValue":o[1]||(o[1]=C=>k.value.name=C),placeholder:"请输入任务名称"},null,8,["modelValue"])])]),e("div",Cl,[o[13]||(o[13]=e("div",{class:"setting-info"},[e("div",{class:"title"},"触发规则 (Cron)"),e("div",{class:"desc"},"使用 Cron 表达式定义执行时间。支持秒级精度 (秒 分 时 日 月 周)")],-1)),e("div",Vl,[t(W,{modelValue:k.value.cron,"onUpdate:modelValue":o[2]||(o[2]=C=>k.value.cron=C),placeholder:"例如: 0 0 12 * * ?"},null,8,["modelValue"]),t(S,{variant:"outline",theme:"default",onClick:o[3]||(o[3]=C=>i.value=!0)},{default:l(()=>[...o[12]||(o[12]=[m(" 表达式生成器 ",-1)])]),_:1})])]),e("div",Sl,[o[14]||(o[14]=e("div",{class:"setting-info"},[e("div",{class:"title"},"执行操作"),e("div",{class:"desc"},"选择触发时要执行的动作类型")],-1)),e("div",Rl,[t(q,{modelValue:k.value.type,"onUpdate:modelValue":o[4]||(o[4]=C=>k.value.type=C),options:N},null,8,["modelValue"])])]),k.value.type==="command"||k.value.type==="restart"?(g(),E("div",Ul,[e("div",Il,[e("div",Ml,P(k.value.type==="restart"?"重启提示语":"控制台命令"),1),e("div",Bl,P(k.value.type==="restart"?"重启前发送给全服玩家的倒计时提示消息":"不需要加 /，直接输入命令内容"),1)]),e("div",Ll,[t(F,{modelValue:k.value.payload,"onUpdate:modelValue":o[5]||(o[5]=C=>k.value.payload=C),autosize:{minRows:2,maxRows:5},placeholder:"请输入内容..."},null,8,["modelValue"])])])):z("",!0),e("div",Al,[o[15]||(o[15]=e("div",{class:"setting-info"},[e("div",{class:"title"},"启用状态"),e("div",{class:"desc"},"暂时禁用此任务而不删除它")],-1)),e("div",El,[t(A,{modelValue:k.value.enable,"onUpdate:modelValue":o[6]||(o[6]=C=>k.value.enable=C)},null,8,["modelValue"])])]),e("div",Pl,[t(S,{theme:"primary",loading:B.value,onClick:x},{icon:l(()=>[t(R(at))]),default:l(()=>[m(" "+P(_.value?"保存修改":"立即创建"),1)]),_:1},8,["loading"]),t(S,{theme:"default",variant:"base",onClick:y},{default:l(()=>[...o[16]||(o[16]=[m("取消",-1)])]),_:1})])]),_:1},8,["data"])])):z("",!0)]),_:1}),t(Q,{loading:h.value,"show-overlay":""},{default:l(()=>[e("div",Tl,[p.value.length===0&&!h.value?(g(),E("div",Ol,"暂无任务，请点击上方创建")):z("",!0),(g(!0),E(ne,null,ue(p.value,C=>(g(),E("div",{key:C.id,class:"task-card"},[e("div",Fl,[e("div",Dl,[t(G,{size:"small",theme:C.enable?"success":"warning",variant:"light",class:"status-tag"},{default:l(()=>[m(P(C.enable?"运行中":"已暂停"),1)]),_:2},1032,["theme"]),e("span",Nl,P(C.name),1)]),e("div",zl,[t(G,{size:"small",variant:"outline",theme:b(C.type),style:{"margin-right":"8px"}},{icon:l(()=>[(g(),j(Ke(s(C.type))))]),default:l(()=>[m(" "+P(C.type.toUpperCase()),1)]),_:2},1032,["theme"]),e("span",Gl,[t(R(xe)),m(" "+P(C.cron),1)])]),C.payload?(g(),E("div",{key:0,class:"task-payload",title:C.payload},P(C.payload),9,Jl)):z("",!0)]),e("div",jl,[t(S,{variant:"text",theme:"primary",onClick:te=>f(C)},{icon:l(()=>[t(R(zt))]),default:l(()=>[o[17]||(o[17]=m(" 编辑 ",-1))]),_:1},8,["onClick"]),t(S,{variant:"text",theme:"danger",onClick:te=>$(C)},{icon:l(()=>[t(R(Qe))]),default:l(()=>[o[18]||(o[18]=m(" 删除 ",-1))]),_:1},8,["onClick"])])]))),128))])]),_:1},8,["loading"]),t(yl,{visible:i.value,"onUpdate:visible":o[7]||(o[7]=C=>i.value=C),"initial-value":k.value.cron,onConfirm:d},null,8,["visible","initial-value"])])}}}),Xl=ie(Wl,[["__scopeId","data-v-98dd2a72"]]),ql={class:"layout-container"},Kl={class:"sidebar"},Hl=["onClick"],Yl={class:"nav-text"},Zl={class:"main-content"},Ql={key:0,class:"panel-wrapper"},en={key:1,class:"panel-wrapper"},tn={key:2,class:"panel-wrapper"},an={key:3,class:"panel-wrapper"},sn=oe({__name:"InstanceSettings",setup(n,{expose:I}){const v=w(!1),p=w(0),h=[{label:"实例设置",icon:nt},{label:"插件/模组",icon:Jt},{label:"服务器属性",icon:jt},{label:"定时任务",icon:xe}];return I({open:()=>{v.value=!0}}),(_,B)=>{const c=V("t-dialog");return g(),j(c,{visible:v.value,"onUpdate:visible":B[0]||(B[0]=i=>v.value=i),header:"实例配置",width:"90%",top:"3vh",attach:"body",footer:!1,class:"settings-dialog"},{default:l(()=>[e("div",ql,[e("div",Kl,[(g(),E(ne,null,ue(h,(i,k)=>e("div",{key:k,class:$e(["nav-item",{active:p.value===k}]),onClick:N=>p.value=k},[(g(),j(Ke(i.icon),{class:"nav-icon"})),e("span",Yl,P(i.label),1)],10,Hl)),64))]),e("div",Zl,[p.value===0?(g(),E("div",Ql,[t(hs)])):z("",!0),p.value===1?(g(),E("div",en,[t(Ts)])):z("",!0),p.value===2?(g(),E("div",tn,[t(Hs,{"instance-id":21})])):z("",!0),p.value===3?(g(),E("div",an,[t(Xl)])):z("",!0)])])]),_:1},8,["visible"])}}}),ln=ie(sn,[["__scopeId","data-v-5ed0e6e3"]]),nn={class:"monitor-container"},on={class:"status-header"},rn={class:"status-text"},un={class:"monitor-content"},dn={class:"monitor-block"},cn={class:"info-item"},vn={class:"label"},mn={class:"value"},pn={class:"monitor-block"},fn={class:"info-item"},gn={class:"label"},yn={class:"value"},bn={key:0,class:"sub-val"},Ve=20,_n=oe({__name:"InstanceMonitor",props:{serverId:{},maxMemory:{},isRunning:{type:Boolean}},setup(n){const I=n,v=Te(),p=w(null),h=w(null);let r=null,_=null;const B=w(new Array(Ve).fill(0)),c=w(new Array(Ve).fill(0)),i=ae(()=>I.maxMemory>0),k=(y,x,$=100)=>({grid:{top:4,right:0,bottom:4,left:0},xAxis:{type:"category",show:!1,boundaryGap:!1},yAxis:{type:"value",min:0,max:$===null?void 0:$,show:!1},series:[{type:"line",data:x,smooth:!0,showSymbol:!1,lineStyle:{width:2,color:y},areaStyle:{color:new da(0,0,0,1,[{offset:0,color:y.replace(")",", 0.2)").replace("rgb","rgba")},{offset:1,color:"transparent"}])}}]}),N=()=>{const y=getComputedStyle(document.documentElement),x=y.getPropertyValue("--td-brand-color").trim()||"#0052d9",$=y.getPropertyValue("--td-warning-color").trim()||"#e37318";if(p.value&&(r=Je(p.value),r.setOption(k(x,B.value,100))),h.value){_=Je(h.value);const d=i.value?100:null;_.setOption(k($,c.value,d))}window.addEventListener("resize",X)},X=()=>{r==null||r.resize(),_==null||_.resize()},T=ae(()=>{const y=v.stats.memBytes/1024/1024;return y>1024?`${(y/1024).toFixed(2)} GB`:`${y.toFixed(0)} MB`}),u=async()=>{I.isRunning&&I.serverId&&(v.setMaxMemory(I.maxMemory),await v.connect(I.serverId))},f=async()=>{await v.disconnect()};return Z(()=>I.maxMemory,y=>{if(v.setMaxMemory(y),_){const x=y>0?100:null;_.setOption({yAxis:{max:x===null?void 0:x}})}},{immediate:!0}),Z(()=>v.stats,y=>{if(!(!I.isRunning||v.currentServerId!==I.serverId)){if(B.value.push(y.cpu),B.value.length>Ve&&B.value.shift(),i.value)c.value.push(y.memPercent);else{const x=y.memBytes/1024/1024;c.value.push(x)}c.value.length>Ve&&c.value.shift(),r==null||r.setOption({series:[{data:B.value}]}),_==null||_.setOption({series:[{data:c.value}]})}},{deep:!0}),Z(()=>I.isRunning,async y=>{y?Se(()=>{X(),u()}):(B.value.fill(0),c.value.fill(0),r==null||r.setOption({series:[{data:B.value}]}),_==null||_.setOption({series:[{data:c.value}]}),await f())}),Z(()=>I.serverId,async(y,x)=>{y!==x&&(await f(),I.isRunning&&await u())}),pe(async()=>{await Se(),N(),I.isRunning&&await u()}),Ue(async()=>{window.removeEventListener("resize",X),await f(),r==null||r.dispose(),_==null||_.dispose()}),(y,x)=>(g(),E("div",nn,[e("div",on,[e("span",rn,[R(v).isConnected?(g(),j(R(ze),{key:0,style:{color:"var(--td-success-color)"}})):(g(),j(R(ze),{key:1,style:{color:"var(--td-text-color-disabled)"}})),m(" "+P(R(v).isConnected?"连接正常":"正在连接数据流..."),1)]),e("div",{class:$e(["monitor-dot",{active:R(v).isConnected&&n.isRunning}])},null,2)]),e("div",un,[e("div",dn,[e("div",cn,[e("div",vn,[t(R(Ae)),x[0]||(x[0]=m(" CPU 使用率",-1))]),e("div",mn,P(R(v).stats.cpu.toFixed(1))+" %",1)]),e("div",{ref_key:"cpuChartRef",ref:p,class:"chart-wrapper"},null,512)]),x[2]||(x[2]=e("div",{class:"divider"},null,-1)),e("div",pn,[e("div",fn,[e("div",gn,[t(R(Wt)),x[1]||(x[1]=m(" 内存使用",-1))]),e("div",yn,[m(P(T.value)+" ",1),i.value?(g(),E("span",bn," ("+P(R(v).stats.memPercent.toFixed(1))+"%) ",1)):z("",!0)])]),e("div",{ref_key:"memChartRef",ref:h,class:"chart-wrapper"},null,512)])])]))}}),kn=ie(_n,[["__scopeId","data-v-ddbf668d"]]);async function wn(n){return await de.get({url:"/api/tools/ai/usage",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${n}`}})}async function hn(n){return await de.get({url:"/api/tools/ai/models",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${n}`}})}async function $n(n,I,v,p,h,r){return I===""&&(I=null),v===""&&(v=null),await de.post({url:"/api/tools/ai/analysis",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${n}`},data:{mods:I,plugins:v,core:p,logs:h,model:r,usemd:!0},timeout:300*1e3})}const xn={class:"analysis-container"},Cn={class:"panel-left"},Vn={class:"form-group"},Sn={class:"model-option-item"},Rn={class:"form-group"},Un={class:"form-group"},In={class:"env-tabs"},Mn={class:"form-group flex-grow"},Bn={class:"action-bar"},Ln={class:"panel-right"},An={class:"panel-header"},En={class:"stats-tags"},Pn={class:"report-content"},Tn=oe({__name:"LogAnalysis",props:{visible:{type:Boolean},serverId:{}},emits:["update:visible","submit"],setup(n,{emit:I}){const v=me(),p=n,h=I,r=De({coreVersion:"",envType:"mods",modsList:"",pluginsList:"",logContent:"",result:"> ✨ 等待日志分析开始······",selectedModel:"qwen-flash"}),_=w([]),B=De({max:0,today:0,extra:0,lastTime:0}),c=w(!1),i=w(!1),k=w(!1);async function N(){const x=await wn(localStorage.getItem("msl-user-token"));if(x.code===200)B.max=x.data.max_per_day,B.extra=x.data.extra_tokens,B.lastTime=x.data.last_use_time,B.today=x.data.today_usage;else{J.error("MSL账号未登录或已失效，请重新登录！"),Ee("/frp/create");return}}async function X(){try{i.value=!0,await N();try{const $=await hn(localStorage.getItem("msl-user-token")||"");$.code===200&&(_.value=$.data,!r.selectedModel&&_.value.length>0&&(r.selectedModel=_.value[0].name))}catch($){J.error("获取模型列表失败"+$.message)}const x=await Ze(p.serverId);r.coreVersion=x.core;try{const $=await Be(p.serverId,"mods",!1);r.modsList=($.jarFiles||[]).join(`
`),r.envType="mods"}catch{r.modsList=""}try{const $=await Be(p.serverId,"plugins",!1);r.pluginsList=($.jarFiles||[]).join(`
`),r.modsList==""&&(r.envType="plugins")}catch{r.pluginsList=""}try{r.logContent=await Ye(p.serverId,"logs/latest.log")}catch{}}catch(x){J.error(x.message)}i.value=!1}Z(()=>p.visible,x=>{v.name==="InstanceConsole"&&(c.value=x,x&&X())});const T=()=>{h("update:visible",!1)};async function u(){if(r.logContent){if(!r.selectedModel){J.warning("请先选择分析模型");return}k.value=!0,r.result="> ⌛️ 分析日志中··· 请稍等";try{const x=await $n(localStorage.getItem("msl-user-token"),r.modsList,r.pluginsList,r.coreVersion,r.logContent,r.selectedModel);r.result=x.data.content}catch(x){r.result=`> ❌ 分析出现错误: ${x.message}`}k.value=!1,await N()}}const f=kt(),y=w(f.value?"dark":"light");return Z(f,()=>{y.value=f.value?"dark":"light"}),(x,$)=>{const d=V("t-tag"),s=V("t-option"),b=V("t-select"),L=V("t-input"),o=V("t-radio-button"),S=V("t-radio-group"),O=V("t-textarea"),W=V("t-button"),q=V("t-loading"),F=V("t-dialog");return g(),j(F,{visible:c.value,"onUpdate:visible":$[6]||($[6]=A=>c.value=A),width:"90%",top:"3vh",footer:!1,"close-on-overlay-click":!1,class:"log-analysis-dialog",onClose:T},{header:l(()=>[...$[7]||($[7]=[e("div",{class:"dialog-title"},[e("span",{style:{display:"flex","align-items":"center",gap:"8px"}}," AI 错误日志分析 ")],-1)])]),default:l(()=>[t(q,{loading:i.value},{default:l(()=>[e("div",xn,[e("div",Cn,[e("div",Vn,[$[8]||($[8]=e("div",{class:"label"},"选择分析模型",-1)),t(b,{modelValue:r.selectedModel,"onUpdate:modelValue":$[0]||($[0]=A=>r.selectedModel=A),placeholder:"请选择AI模型",filterable:""},{default:l(()=>[(g(!0),E(ne,null,ue(_.value,A=>(g(),j(s,{key:A.name,value:A.name,label:A.name},{default:l(()=>[e("div",Sn,[e("span",null,P(A.name),1),t(d,{size:"small",variant:"light",theme:"default"},{default:l(()=>[m(" 倍率: "+P(A.rate)+"x ",1)]),_:2},1024)])]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),e("div",Rn,[$[9]||($[9]=e("div",{class:"label"},"服务端核心/版本",-1)),t(L,{modelValue:r.coreVersion,"onUpdate:modelValue":$[1]||($[1]=A=>r.coreVersion=A),readonly:"",placeholder:"例如: Arclight 1.21.1"},{"prefix-icon":l(()=>[t(R(Re))]),_:1},8,["modelValue"])]),e("div",Un,[$[12]||($[12]=e("div",{class:"label"},"环境列表",-1)),e("div",In,[t(S,{modelValue:r.envType,"onUpdate:modelValue":$[2]||($[2]=A=>r.envType=A),variant:"default-filled",class:"custom-radio-group"},{default:l(()=>[t(o,{value:"mods"},{default:l(()=>[t(R(Re),{class:"mr-1"}),$[10]||($[10]=m(" 模组 (Mods) ",-1))]),_:1}),t(o,{value:"plugins"},{default:l(()=>[t(R(Le),{class:"mr-1"}),$[11]||($[11]=m(" 插件 (Plugins) ",-1))]),_:1})]),_:1},8,["modelValue"])]),Me(t(O,{modelValue:r.modsList,"onUpdate:modelValue":$[3]||($[3]=A=>r.modsList=A),readonly:"",autosize:{minRows:4,maxRows:6},placeholder:"暂无模组数据...",class:"mt-2 readonly-textarea"},null,8,["modelValue"]),[[Fe,r.envType==="mods"]]),Me(t(O,{modelValue:r.pluginsList,"onUpdate:modelValue":$[4]||($[4]=A=>r.pluginsList=A),readonly:"",autosize:{minRows:4,maxRows:6},placeholder:"暂无插件数据...",class:"mt-2 readonly-textarea"},null,8,["modelValue"]),[[Fe,r.envType==="plugins"]])]),e("div",Mn,[$[13]||($[13]=e("div",{class:"label"},"错误日志内容",-1)),t(O,{modelValue:r.logContent,"onUpdate:modelValue":$[5]||($[5]=A=>r.logContent=A),placeholder:"没找到有效日志，您可以手动粘贴日志......",class:"log-textarea"},null,8,["modelValue"])]),e("div",Bn,[t(W,{loading:k.value,block:"",theme:"primary",size:"large",onClick:u},{icon:l(()=>[t(R(Xt))]),default:l(()=>[$[14]||($[14]=m(" 开始 AI 诊断 ",-1))]),_:1},8,["loading"])])]),e("div",Ln,[e("div",An,[$[15]||($[15]=e("span",{class:"title"},"AI 分析报告",-1)),e("div",En,[t(d,{theme:"default",variant:"light",size:"small"},{icon:l(()=>[t(R(qt))]),default:l(()=>[m(" 今日: "+P(B.today)+" / "+P(B.max),1)]),_:1}),t(d,{theme:"primary",variant:"light",size:"small"},{icon:l(()=>[t(R(Kt))]),default:l(()=>[m(" 额外: "+P(B.extra),1)]),_:1}),t(d,{theme:"warning",variant:"light",size:"small"},{icon:l(()=>[t(R(xe))]),default:l(()=>[m(" 上次: "+P(R(va)(B.lastTime)),1)]),_:1})])]),e("div",Pn,[t(R(ca),{"editor-id":"report-preview","model-value":r.result,theme:y.value,class:"md-preview-wrapper"},null,8,["model-value","theme"])])])])]),_:1},8,["loading"])]),_:1},8,["visible"])}}}),On=ie(Tn,[["__scopeId","data-v-bbd660a8"]]),Fn={class:"sidebar-content"},Dn={class:"control-header"},Nn={class:"control-actions"},zn={class:"running-action-group"},Gn={class:"action-row"},Jn={class:"card-content-area"},jn={key:0,class:"info-list"},Wn={class:"info-item"},Xn={class:"label"},qn={class:"value"},Kn={class:"info-item"},Hn={class:"label"},Yn={class:"value"},Zn={class:"info-item"},Qn={class:"label"},eo={class:"value"},to={class:"info-item"},ao={class:"label"},so={class:"value"},lo={class:"info-item"},no={class:"label"},oo={class:"value"},io={class:"info-item"},ro={class:"label"},uo={class:"value"},co={class:"info-item"},vo={class:"label"},mo={class:"value"},po={key:1,class:"info-item"},fo={class:"label"},go={class:"info-item"},yo={class:"label"},bo={class:"value"},_o={key:1,class:"monitor-view"},ko={key:1,class:"monitor-placeholder"},wo=oe({__name:"ServerControlPanel",props:{serverId:{},isRunning:{type:Boolean},loading:{type:Boolean},serverInfo:{}},emits:["start","stop","clear-log","refresh-info","backup","force-exit","restart"],setup(n,{emit:I}){const v=n,p=I,h=w(!1),r=w(null),_=w("info"),B=()=>{var T;(T=r.value)==null||T.open()},c=()=>{p("refresh-info")},i=w(0);let k=null;const N=T=>{if(!T)return 0;const u=T.match(/^(?:(\d+)\.)?(\d{1,2}):(\d{2}):(\d{2})(?:\.\d+)?$/);return u?parseInt(u[1]||"0",10)*86400+parseInt(u[2])*3600+parseInt(u[3])*60+parseInt(u[4]):0},X=ae(()=>{if(i.value<=0)return"00:00:00";const T=Math.floor(i.value/86400),u=new Date(i.value*1e3).toISOString().substr(11,8);return T>0?`${T}天 ${u}`:u});return Z(()=>{var T;return(T=v.serverInfo)==null?void 0:T.uptime},T=>T&&(i.value=N(T)),{immediate:!0}),Z(()=>v.isRunning,T=>{T?k||(k=window.setInterval(()=>i.value++,1e3)):k&&(clearInterval(k),k=null)},{immediate:!0}),Ue(()=>{k&&clearInterval(k)}),(T,u)=>{const f=V("t-tag"),y=V("t-button"),x=V("t-dropdown-item"),$=V("t-dropdown-menu"),d=V("t-dropdown"),s=V("t-card"),b=V("t-radio-button"),L=V("t-radio-group");return g(),E("div",Fn,[t(s,{bordered:!1,class:"control-card"},{default:l(()=>[e("div",Dn,[e("div",{class:$e(["status-indicator",{running:n.isRunning}])},[u[10]||(u[10]=e("span",{class:"pulse"},null,-1)),m(P(n.isRunning?"Running":"Stopped"),1)],2),t(f,{theme:n.isRunning?"success":"default",variant:"light",shape:"round"},{default:l(()=>[m(P(n.isRunning?"运行中":"已停止"),1)]),_:1},8,["theme"])]),e("div",Nn,[n.isRunning?(g(),E(ne,{key:1},[e("div",zn,[t(y,{class:"stop-btn",theme:"danger",size:"large",loading:n.loading,variant:n.loading?"outline":"base",onClick:u[1]||(u[1]=o=>!n.loading&&T.$emit("stop"))},{icon:l(()=>[t(R(lt))]),default:l(()=>[m(" "+P(n.loading?"停止中...":"停止"),1)]),_:1},8,["loading","variant"]),t(y,{theme:"warning",size:"large",shape:"square",disabled:n.loading,onClick:u[2]||(u[2]=o=>T.$emit("restart"))},{icon:l(()=>[t(R(he))]),_:1},8,["disabled"])]),n.loading?(g(),j(y,{key:0,class:"force-kill-btn glass-btn",theme:"danger",variant:"outline",block:"",onClick:u[3]||(u[3]=o=>T.$emit("force-exit"))},{icon:l(()=>[t(R(tt))]),default:l(()=>[u[12]||(u[12]=m(" 强制结束 ",-1))]),_:1})):z("",!0)],64)):(g(),j(y,{key:0,theme:"primary",size:"large",block:"",loading:n.loading,onClick:u[0]||(u[0]=o=>{T.$emit("clear-log"),T.$emit("start")})},{icon:l(()=>[t(R(st))]),default:l(()=>[u[11]||(u[11]=m("启动实例 ",-1))]),_:1},8,["loading"])),e("div",Gn,[t(y,{class:"glass-btn",variant:"outline",block:"",onClick:u[4]||(u[4]=o=>R(Ee)(`/instance/files/${n.serverId}`))},{icon:l(()=>[t(R(Ge))]),default:l(()=>[u[13]||(u[13]=m("文件管理 ",-1))]),_:1}),t(y,{class:"glass-btn",variant:"outline",block:"",onClick:B},{icon:l(()=>[t(R(nt))]),default:l(()=>[u[14]||(u[14]=m("实例设置 ",-1))]),_:1})]),t(d,{trigger:"click","min-column-width":120,placement:"bottom"},{default:l(()=>[t(y,{theme:"primary",class:"glass-btn",variant:"outline",block:""},{icon:l(()=>[t(R(Ht))]),default:l(()=>[u[15]||(u[15]=m("更多功能 ",-1))]),_:1}),t($,null,{default:l(()=>[t(x,{onClick:u[5]||(u[5]=o=>T.$emit("clear-log"))},{"prefix-icon":l(()=>[t(R(he))]),default:l(()=>[u[16]||(u[16]=m(" 清空日志 ",-1))]),_:1}),t(x,{disabled:!n.isRunning||n.loading,onClick:u[6]||(u[6]=o=>T.$emit("backup"))},{"prefix-icon":l(()=>[t(R(Yt))]),default:l(()=>[u[17]||(u[17]=m(" 立即备份 ",-1))]),_:1},8,["disabled"]),t(x,{onClick:u[7]||(u[7]=o=>h.value=!0)},{"prefix-icon":l(()=>[t(R(Zt))]),default:l(()=>[u[18]||(u[18]=m(" 日志分析 ",-1))]),_:1})]),_:1})]),_:1})])]),_:1}),t(s,{bordered:!1,title:"实例概览",class:"info-card"},{actions:l(()=>[t(L,{modelValue:_.value,"onUpdate:modelValue":u[8]||(u[8]=o=>_.value=o),variant:"default-filled",size:"small"},{default:l(()=>[t(b,{value:"info"},{default:l(()=>[t(R(la)),u[19]||(u[19]=m(" 详情",-1))]),_:1}),t(b,{value:"monitor",disabled:!n.isRunning},{default:l(()=>[t(R(na)),u[20]||(u[20]=m(" 监控",-1))]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),default:l(()=>{var o,S,O,W,q,F,A,Y,G;return[e("div",Jn,[_.value==="info"?(g(),E("div",jn,[e("div",Wn,[e("div",Xn,[t(R(Qt)),u[21]||(u[21]=m(" 实例名称",-1))]),e("div",qn,P((o=n.serverInfo)==null?void 0:o.name),1)]),((S=n.serverInfo)==null?void 0:S.java)!=="none"?(g(),E(ne,{key:0},[e("div",Kn,[e("div",Hn,[t(R(Ae)),u[22]||(u[22]=m(" 内存限制",-1))]),e("div",Yn,P((O=n.serverInfo)==null?void 0:O.maxM)+" MB",1)]),u[28]||(u[28]=e("div",{class:"proxy-group"},null,-1)),e("div",Zn,[e("div",Qn,[t(R(ea)),u[23]||(u[23]=m(" 运行端口",-1))]),e("div",eo,P((q=(W=n.serverInfo)==null?void 0:W.mcConfig)==null?void 0:q.serverPort),1)]),e("div",to,[e("div",ao,[t(R(ta)),u[24]||(u[24]=m(" 游戏难度",-1))]),e("div",so,[t(f,{theme:"primary"},{default:l(()=>{var Q,C;return[m(P((C=(Q=n.serverInfo)==null?void 0:Q.mcConfig)==null?void 0:C.difficulty),1)]}),_:1})])]),e("div",lo,[e("div",no,[t(R(aa)),u[25]||(u[25]=m(" 游戏模式",-1))]),e("div",oo,[t(f,null,{default:l(()=>{var Q,C;return[m(P((C=(Q=n.serverInfo)==null?void 0:Q.mcConfig)==null?void 0:C.gamemode),1)]}),_:1})])]),e("div",io,[e("div",ro,[t(R(Ge)),u[26]||(u[26]=m(" 游戏地图",-1))]),e("div",uo,P((A=(F=n.serverInfo)==null?void 0:F.mcConfig)==null?void 0:A.levelName),1)]),e("div",co,[e("div",vo,[t(R(sa)),u[27]||(u[27]=m(" 正版验证",-1))]),e("div",mo,[t(f,{theme:((G=(Y=n.serverInfo)==null?void 0:Y.mcConfig)==null?void 0:G.onlineMode)==="true"?"success":"warning"},{default:l(()=>{var Q,C;return[m(P(((C=(Q=n.serverInfo)==null?void 0:Q.mcConfig)==null?void 0:C.onlineMode)==="true"?"开启":"关闭"),1)]}),_:1},8,["theme"])])])],64)):(g(),E("div",po,[e("div",fo,[t(R(Ae)),u[29]||(u[29]=m(" 模式",-1))]),u[30]||(u[30]=e("div",{class:"value"},"自定义模式",-1))])),u[32]||(u[32]=e("div",{class:"proxy-group"},null,-1)),e("div",go,[e("div",yo,[t(R(xe)),u[31]||(u[31]=m(" 运行时长",-1))]),e("div",bo,P(n.isRunning?X.value:"--:--:--"),1)])])):_.value==="monitor"?(g(),E("div",_o,[n.serverInfo&&n.isRunning?(g(),j(kn,{key:0,"server-id":n.serverId,"is-running":n.isRunning,"max-memory":n.serverInfo.java==="none"?0:n.serverInfo.maxM||4096},null,8,["server-id","is-running","max-memory"])):(g(),E("div",ko,"实例未运行"))])):z("",!0)])]}),_:1}),t(ln,{ref_key:"settingsRef",ref:r,"server-id":n.serverId,onSuccess:c},null,8,["server-id"]),t(On,{"server-id":n.serverId,visible:h.value,"onUpdate:visible":u[9]||(u[9]=o=>h.value=o)},null,8,["server-id","visible"])])}}}),ho=ie(wo,[["__scopeId","data-v-fa4380de"]]),$o={class:"console-page"},xo={class:"layout-container"},Co={class:"main-terminal-area"},Vo={class:"sidebar-area"},So={style:{"line-height":"1.6"}},Ro={style:{"margin-bottom":"12px"}},Uo=oe({__name:"index",setup(n){const I=me(),v=Mt(),p=Te(),h=w(parseInt(I.params.serverId)||0),r=w(!1),_=w(!1),B=w(null),c=w(null);async function i(){var d;if(h.value)try{_.value=!0;const s=await Ze(h.value);await v.refreshInstanceList(),r.value=s.status,B.value=s,_.value=!1}catch(s){(d=c.value)==null||d.writeln(`\x1B[1;31m[Error] 获取实例信息失败: ${s.message}\x1B[0m`),_.value=!1}}const k=async()=>{var d,s;_.value=!0;try{(d=c.value)==null||d.writeln("\x1B[1;32m[System] 正在发送启动指令...\x1B[0m"),await ve(h.value,"start"),J.success("实例启动指令已发送"),_.value=!1}catch(b){(s=c.value)==null||s.writeln(`\x1B[1;31m[Error] 启动失败: ${b.message}\x1B[0m`),_.value=!1}},N=async()=>{var d,s;_.value=!0;try{(d=c.value)==null||d.writeln("\x1B[1;32m[System] 正在发送停止指令...\x1B[0m"),await ve(h.value,"stop"),J.warning("实例停止指令已发送"),_.value=!1}catch(b){(s=c.value)==null||s.writeln(`\x1B[1;31m[Error] 停止失败: ${b.message}\x1B[0m`),_.value=!1}},X=async()=>{var d,s;_.value=!0;try{(d=c.value)==null||d.writeln("\x1B[1;32m[System] 正在发送强制退出指令...\x1B[0m"),await ve(h.value,"forceExit"),J.warning("强制退出指令已发送"),_.value=!1}catch(b){(s=c.value)==null||s.writeln(`\x1B[1;31m[Error] 强制退出失败: ${b.message}\x1B[0m`),_.value=!1}},T=async()=>{var d,s;_.value=!0;try{(d=c.value)==null||d.writeln("\x1B[1;32m[System] 正在发送重启指令...\x1B[0m"),await ve(h.value,"restart"),J.warning("重启执行成功"),_.value=!1}catch(b){(s=c.value)==null||s.writeln(`\x1B[1;31m[Error] 重启失败: ${b.message}\x1B[0m`),_.value=!1}},u=async()=>{var d,s;try{(d=c.value)==null||d.writeln("\x1B[1;32m[System] 正在发送备份任务...\x1B[0m"),await ve(h.value,"backup"),J.success("备份任务启动中···"),_.value=!1}catch(b){(s=c.value)==null||s.writeln(`\x1B[1;31m[Error] 备份任务启动失败: ${b.message}\x1B[0m`)}},f=()=>{var d;(d=c.value)==null||d.clear()},y=w(!1),x=async()=>{h.value&&(p.onEula(()=>{y.value=!0}),await p.connect(h.value))},$=async d=>{try{y.value=!1,await ve(h.value,`agreeEula?${d}`),J.success(d?"已发送同意请求":"已发送请求")}catch(s){J.error(s.message||"发送失败")}};return Z(()=>I.params.serverId,async d=>{I.name==="InstanceConsole"&&d&&(h.value=parseInt(d),await i())}),pe(async()=>{h.value&&(await i(),await x())}),(d,s)=>{const b=V("t-link"),L=V("t-dialog");return g(),E("div",$o,[e("div",xo,[e("div",Co,[t(_a,{ref_key:"terminalRef",ref:c,"server-id":h.value,onUpdate:s[0]||(s[0]=o=>i())},null,8,["server-id"])]),e("div",Vo,[t(ho,{"server-id":h.value,"is-running":r.value,loading:_.value,"server-info":B.value,onStart:k,onStop:N,onBackup:u,onClearLog:f,onForceExit:X,onRestart:T},null,8,["server-id","is-running","loading","server-info"])])]),t(L,{visible:y.value,"onUpdate:visible":s[1]||(s[1]=o=>y.value=o),header:"是否同意EULA","confirm-btn":{content:"同意",theme:"primary"},"cancel-btn":{content:"不同意",theme:"default"},onConfirm:s[2]||(s[2]=o=>$(!0)),onCancel:s[3]||(s[3]=o=>$(!1))},{default:l(()=>[e("div",So,[e("p",Ro,[s[5]||(s[5]=m(" 开启Minecraft服务器需要您同意 ",-1)),s[6]||(s[6]=e("strong",null,"EULA",-1)),s[7]||(s[7]=m(" ！",-1)),t(b,{theme:"primary",underline:""},{default:l(()=>[...s[4]||(s[4]=[m(" (https://aka.ms/minecrafteula)",-1)])]),_:1})]),s[8]||(s[8]=e("p",{style:{"margin-bottom":"12px"}},[e("strong",{style:{color:"#e34d59"}},"请您务必认真仔细阅读！")],-1)),s[9]||(s[9]=e("p",{style:{"margin-bottom":"12px"}},[e("strong",null,"注意："),m("不论您选择是或否，服务器都会在您操作后继续运行。")],-1)),s[10]||(s[10]=e("p",{style:{"margin-bottom":"12px",color:"#f59a23"}},[m(" ⚠️ 如果您"),e("strong",null,"未同意 EULA"),m("，服务器可能会在运行时自动关闭！ ")],-1)),s[11]||(s[11]=e("p",{style:{"margin-top":"16px"}},[m("💡 提示：如要在每次启动实例时忽略此提示，请在"),e("strong",null,"设置"),m("里进行配置。")],-1))])]),_:1},8,["visible"])])}}}),Oi=ie(Uo,[["__scopeId","data-v-4ce7e6e4"]]);export{Oi as default};
