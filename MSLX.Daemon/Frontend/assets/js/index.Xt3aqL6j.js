import{u as re,b as ie}from"./frp.C8FMdY1m.js";import{c as j,_ as ee,r as K}from"./index.BBb2Hw3e.js";import{M as k}from"./tdesign-vue-next.DXysdKln.js";import{l as G,aZ as i,aU as p,aV as V,j as e,a$ as t,G as b,a_ as R,b3 as W,aY as l,r as z,k as te,w as de,o as ne,F as X,b0 as Z,b2 as w,J as B,c as Q,f as ue,aW as me}from"./index.DuVfB4dr.js";import{g as ae,f as pe}from"./tools.CQnzORaS.js";import{a7 as se,ac as ce,aa as _e,U as fe,g as ve,ad as ge,ab as be}from"./tdesign-icons-vue-next.Dm5w0YWL.js";import"./pinia.K9HejpEf.js";import"./pinia-plugin-persistedstate_2eabddac918ad8d0cf74e67f4601f4c8.n2tMOXAx.js";import"./vue-router.BSuyFzNa.js";import"./tvision-color.Cy78gTfV.js";import"./chroma-js.DO2ptVd8.js";import"./core-js-pure.DbDavgKW.js";import"./bezier-easing.D5A5epFU.js";import"./lodash.CpoxsuHF.js";import"./axios.B9ygI19o.js";import"./qs.B2qFNmGA.js";import"./side-channel.BIlHSgJq.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.CWmL7r7A.js";import"./side-channel-list.DZ_HK50j.js";import"./side-channel-map.DDbmCn0b.js";import"./get-intrinsic.DL3knghB.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.Cbri-GHQ.js";import"./dunder-proto.q7lw_6_J.js";import"./call-bind-apply-helpers.BxcZtPLH.js";import"./function-bind.BbkWVFrm.js";import"./hasown.ckq0ukzO.js";import"./call-bound.Cne7q6oT.js";import"./side-channel-weakmap.BTkyjVO1.js";import"./nprogress.COlaCQ7y.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./lodash-es.sbUBen0f.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";const ye=re();async function oe(F,m,v,I="toml"){await ie(F,m,v,I),k.success("添加成功"),await ye.getTunnels(),j("/frp/list")}const he={class:"custom-frp-container"},ke=G({__name:"Custom",setup(F){const m=z(null),v=te({name:"",type:"toml",content:""}),I={name:[{required:!0,message:"请输入隧道名称",type:"error"}],content:[{required:!0,message:"配置文件内容不能为空",type:"error"}]},x=async({validateResult:o})=>{o===!0?await oe(v.name,v.content,"Custom",v.type):k.warning("请检查表单填写")},y=()=>{k.info("表单已重置")},r=()=>{const o=v.content.trim();if(!o){k.warning("请先输入 INI 配置内容");return}const n={tls_enable:"transport.tls.enable",token:"auth.token",protocol:"transport.protocol",pool_count:"transport.poolCount",tcp_mux:"transport.tcpMux",login_fail_exit:"loginFailExit",custom_domains:"customDomains",locations:"locations",host_header_rewrite:"hostHeaderRewrite",role:"role",sk:"sk"};try{const g=o.split(/\r?\n/);let _="";const c={},A=[];let u=null;g.forEach($=>{const h=$.trim();if(!h||h.startsWith("#")||h.startsWith(";"))return;const C=h.match(/^\[(.+)\]$/);if(C){_=C[1],_==="common"?u=null:(u={name:_},A.push(u));return}const M=h.match(/^([^=]+)=(.*)$/);if(M){const N=M[1].trim();let S=M[2].trim(),D=N;n[N]?D=n[N]:(D=D.replace(/_([a-z])/g,(T,q)=>q.toUpperCase()),D=D.replace(/Ip/g,"IP")),S==="true"?S=!0:S==="false"?S=!1:!isNaN(Number(S))&&S!==""?S=Number(S):S=String(S),_==="common"||!_?c[D]=S:u&&(u[D]=S)}});let s="";Object.entries(c).forEach(([$,h])=>{const C=typeof h=="string"?`"${h}"`:h;s+=`${$} = ${C}
`}),A.forEach($=>{s+=`
[[proxies]]
`,Object.entries($).forEach(([h,C])=>{const M=typeof C=="string"?`"${C}"`:C;s+=`${h} = ${M}
`})}),v.content=s.trim(),v.type="toml",k.success("已转换为 TOML")}catch(g){console.error(g),k.error("转换失败，请检查输入格式")}};return(o,n)=>{const g=i("t-input"),_=i("t-form-item"),c=i("t-radio-button"),A=i("t-radio-group"),u=i("t-button"),s=i("t-textarea"),$=i("t-space"),h=i("t-form"),C=i("t-card");return p(),V("div",he,[e(C,{bordered:!1},{header:t(()=>[...n[3]||(n[3]=[l("span",{style:{"font-weight":"bold","font-size":"16px"}},"自定义 Frp 隧道",-1)])]),default:t(()=>[e(h,{ref_key:"formRef",ref:m,data:v,rules:I,"label-align":"top",onReset:y,onSubmit:x},{default:t(()=>[e(_,{label:"隧道名称",name:"name"},{default:t(()=>[e(g,{modelValue:v.name,"onUpdate:modelValue":n[0]||(n[0]=M=>v.name=M),placeholder:"请输入隧道名称"},null,8,["modelValue"])]),_:1}),e(_,{label:"配置类型",name:"type"},{default:t(()=>[e(A,{modelValue:v.type,"onUpdate:modelValue":n[1]||(n[1]=M=>v.type=M),variant:"default-filled"},{default:t(()=>[e(c,{value:"toml"},{default:t(()=>[...n[4]||(n[4]=[b("TOML",-1)])]),_:1}),e(c,{value:"ini"},{default:t(()=>[...n[5]||(n[5]=[b("INI",-1)])]),_:1})]),_:1},8,["modelValue"]),v.type==="ini"?(p(),R(u,{key:0,style:{"margin-left":"8px"},variant:"outline",theme:"primary",size:"small",onClick:r},{default:t(()=>[...n[6]||(n[6]=[b(" 一键转 TOML ",-1)])]),_:1})):W("",!0)]),_:1}),e(_,{label:"隧道配置内容",name:"content"},{default:t(()=>[e(s,{modelValue:v.content,"onUpdate:modelValue":n[2]||(n[2]=M=>v.content=M),placeholder:`serverAddr = "0.0.0.0"
serverPort = 1027

[[proxies]]
name = "nahida_tcp"
...`,autosize:{minRows:10,maxRows:25},class:"code-font-textarea"},null,8,["modelValue"])]),_:1}),e(_,null,{default:t(()=>[e($,null,{default:t(()=>[e(u,{theme:"primary",type:"submit"},{default:t(()=>[...n[7]||(n[7]=[b("保存配置",-1)])]),_:1}),e(u,{theme:"default",variant:"base",type:"reset"},{default:t(()=>[...n[8]||(n[8]=[b("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})])}}}),we=ee(ke,[["__scopeId","data-v-4ef2421f"]]),xe=(F,m="MSL Login",v=500,I=600)=>{if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return window.open(F,"_blank"),null;const y=window.screenLeft!==void 0?window.screenLeft:window.screenX,r=window.screenTop!==void 0?window.screenTop:window.screenY,o=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,n=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,g=o/window.screen.availWidth,_=(o-v)/2/g+y,c=(n-I)/2/g+r,A=`
    scrollbars=yes,
    width=${v/g},
    height=${I/g},
    top=${c},
    left=${_}
  `,u=window.open(F,m,A);return u&&u.focus(),u},$e={class:"custom-option-item"},Ve={class:"node-name-text"},Pe={class:"node-tag-group"},Le={class:"node-detail-area"},Ie={class:"detail-tags-row"},Se={class:"remarks-box"},Ce=G({__name:"CreateTunnelDialog",props:{visible:{type:Boolean},token:{}},emits:["update:visible","success"],setup(F,{emit:m}){const v=F,I=m,x=z(!1),y=z(!1),r=z([]),o=te({nodeId:null,type:"tcp",localIP:"127.0.0.1",localPort:"25565",remotePort:"",name:"",remarks:"无",bindDomain:"",use_kcp:!1,extra_config:""}),n=Q(()=>r.value.find(u=>u.id===o.nodeId)||null),g=Q(()=>{const u=[{label:"免费节点",value:0,children:[]},{label:"高级节点",value:1,children:[]},{label:"超级节点",value:2,children:[]}];return r.value.forEach(s=>{const $=u.find(h=>h.value===s.allow_user_group);$&&$.children.push(s)}),u.filter(s=>s.children.length>0)}),_=()=>{if(n.value){const{min_open_port:u,max_open_port:s}=n.value;o.remotePort=(Math.floor(Math.random()*(s-u+1))+u).toString()}o.name=ae(8)},c=async()=>{x.value=!0;try{const u=await K.get({url:"/api/frp/nodeList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${v.token}`}});u.code===200&&(r.value=u.data,v.visible&&r.value.length>0&&!o.nodeId&&(o.nodeId=r.value[0].id,_()))}catch(u){k.error("加载节点失败"+u.message)}finally{x.value=!1}};de(()=>v.visible,u=>{u&&(r.value.length>0?(o.nodeId||(o.nodeId=r.value[0].id),_()):c())});const A=async()=>{var u;if(o.nodeId){y.value=!0;try{const s=await K.post({url:"/api/frp/addTunnel",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${v.token}`},data:{id:o.nodeId,type:o.type,local_ip:o.localIP,local_port:o.localPort,remote_port:o.remotePort,name:o.name,remarks:o.remarks,bind_domain:o.bindDomain,use_kcp:((u=n.value)==null?void 0:u.kcp_support)===1?o.use_kcp:!1,extra_config:o.extra_config||null}});s.code===200?(k.success("创建成功"),I("success"),I("update:visible",!1)):k.error(s.msg)}finally{y.value=!1}}};return ne(()=>{v.token&&c()}),(u,s)=>{const $=i("t-tag"),h=i("t-option"),C=i("t-option-group"),M=i("t-select"),N=i("t-col"),S=i("t-button"),D=i("t-row"),T=i("t-form-item"),q=i("t-input"),d=i("t-textarea"),a=i("t-form"),P=i("t-loading"),L=i("t-dialog");return p(),R(L,{attach:"body",visible:F.visible,header:"新建隧道",width:"580px","confirm-btn":{content:"提交创建",loading:y.value},onConfirm:A,onClose:s[10]||(s[10]=f=>I("update:visible",!1))},{default:t(()=>[e(P,{loading:x.value},{default:t(()=>[e(a,{data:o,"label-align":"right","label-width":100,class:"dialog-inner-form"},{default:t(()=>[e(T,{label:"选择节点",name:"nodeId"},{default:t(()=>[e(D,{gutter:8,style:{width:"100%"}},{default:t(()=>[e(N,{flex:"auto"},{default:t(()=>[e(M,{modelValue:o.nodeId,"onUpdate:modelValue":s[0]||(s[0]=f=>o.nodeId=f),placeholder:"请选择节点",onChange:_},{default:t(()=>[(p(!0),V(X,null,Z(g.value,f=>(p(),R(C,{key:f.value,label:f.label},{default:t(()=>[(p(!0),V(X,null,Z(f.children,U=>(p(),R(h,{key:U.id,value:U.id,label:U.node},{default:t(()=>[l("div",$e,[l("span",Ve,w(U.node),1),l("div",Pe,[e($,{size:"small",variant:"outline",theme:"primary"},{default:t(()=>[b(w(U.bandwidth)+"M",1)]),_:2},1024),e($,{size:"small",theme:U.status===1?"success":"danger"},{default:t(()=>[b(w(U.status===1?"在线":"离线"),1)]),_:2},1032,["theme"])])])]),_:2},1032,["value","label"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(N,{flex:"none"},{default:t(()=>[e(S,{variant:"outline",onClick:s[1]||(s[1]=f=>B(j)("https://user.mslmc.net/frp/createTunnel"))},{default:t(()=>[...s[11]||(s[11]=[b(" 前往源站创建 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),n.value?(p(),R(T,{key:0,label:"节点详情"},{default:t(()=>[l("div",Le,[l("div",Ie,[e($,{size:"small",variant:"outline",theme:"primary"},{default:t(()=>[b(w(n.value.bandwidth)+"Mbps",1)]),_:1}),e($,{size:"small",theme:n.value.need_real_name?"success":"warning"},{default:t(()=>[b(w(n.value.need_real_name?"需要实名认证":"无需实名认证"),1)]),_:1},8,["theme"]),e($,{size:"small",theme:n.value.status===1?"success":"danger"},{default:t(()=>[b(" 节点状态："+w(n.value.status===1?"在线":"离线"),1)]),_:1},8,["theme"])]),l("div",Se,[l("pre",null,w(n.value.remarks||"此节点暂无备注"),1)])])]),_:1})):W("",!0),e(T,{label:"隧道类型"},{default:t(()=>[e(M,{modelValue:o.type,"onUpdate:modelValue":s[2]||(s[2]=f=>o.type=f)},{default:t(()=>{var f,U,O;return[e(h,{label:"TCP",value:"tcp"}),(f=n.value)!=null&&f.udp_support?(p(),R(h,{key:0,label:"UDP",value:"udp"})):W("",!0),(U=n.value)!=null&&U.http_support?(p(),R(h,{key:1,label:"HTTP",value:"http"})):W("",!0),(O=n.value)!=null&&O.http_support?(p(),R(h,{key:2,label:"HTTPS",value:"https"})):W("",!0)]}),_:1},8,["modelValue"])]),_:1}),e(D,{gutter:[16,20]},{default:t(()=>[e(N,{span:6},{default:t(()=>[e(T,{label:"隧道名称"},{default:t(()=>[e(q,{modelValue:o.name,"onUpdate:modelValue":s[3]||(s[3]=f=>o.name=f)},null,8,["modelValue"])]),_:1})]),_:1}),e(N,{span:6},{default:t(()=>[e(T,{label:"远程端口"},{default:t(()=>[e(q,{modelValue:o.remotePort,"onUpdate:modelValue":s[4]||(s[4]=f=>o.remotePort=f)},{suffix:t(()=>[e(S,{variant:"text",size:"small",onClick:_},{default:t(()=>[...s[12]||(s[12]=[b("随机",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(N,{span:6},{default:t(()=>[e(T,{label:"本地IP"},{default:t(()=>[e(q,{modelValue:o.localIP,"onUpdate:modelValue":s[5]||(s[5]=f=>o.localIP=f)},null,8,["modelValue"])]),_:1})]),_:1}),e(N,{span:6},{default:t(()=>[e(T,{label:"本地端口"},{default:t(()=>[e(q,{modelValue:o.localPort,"onUpdate:modelValue":s[6]||(s[6]=f=>o.localPort=f)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o.type.includes("http")?(p(),R(T,{key:1,label:"绑定域名",class:"spacing-item"},{default:t(()=>[e(q,{modelValue:o.bindDomain,"onUpdate:modelValue":s[7]||(s[7]=f=>o.bindDomain=f),placeholder:"输入已解析的域名"},null,8,["modelValue"])]),_:1})):W("",!0),e(T,{label:"备注说明",class:"spacing-item"},{default:t(()=>[e(q,{modelValue:o.remarks,"onUpdate:modelValue":s[8]||(s[8]=f=>o.remarks=f)},null,8,["modelValue"])]),_:1}),e(T,{label:"额外参数",class:"spacing-item"},{default:t(()=>[e(d,{modelValue:o.extra_config,"onUpdate:modelValue":s[9]||(s[9]=f=>o.extra_config=f),autosize:{minRows:2},placeholder:"选填，高级配置参数（不懂清留空！！！）"},null,8,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:1},8,["loading"])]),_:1},8,["visible","confirm-btn"])}}}),Me=ee(Ce,[["__scopeId","data-v-8f82e481"]]),ze={class:"page-container"},Te={key:0,class:"login-container"},Ue={class:"login-card"},Re={class:"icon-wrapper"},Be={key:1,class:"dashboard-container"},Ae={class:"stat-item"},Ne={class:"value"},De={class:"stat-item"},He={class:"value"},Ee={class:"stat-item"},Fe={class:"value"},Ke={class:"stat-item"},We={class:"value date-text"},qe={class:"list-header"},Oe={class:"tunnel-list"},je=["onClick"],Ge={class:"item-icon"},Qe={class:"item-content"},Ye={class:"item-title"},Je={class:"item-subtitle"},Xe={class:"item-status"},Ze={key:0,class:"empty-state"},et={key:0,class:"detail-content"},tt={class:"detail-header"},at={class:"remarks"},ot={class:"detail-grid"},lt={class:"val"},st={class:"detail-grid"},nt={class:"val uppercase"},rt={class:"detail-grid"},it={class:"val"},dt={class:"detail-grid"},ut={class:"val highlight"},mt={class:"detail-grid"},pt={class:"val"},ct={class:"detail-grid"},_t={class:"val"},ft={class:"action-area"},vt={key:1,class:"empty-detail"},gt=G({__name:"index",setup(F){const m=z(!1),v=()=>{h()},I=z("tKYvKk48Sq5kGAy12IJQxLEKhXx"),x=z(null),y=z(""),r=z(!1),o=z(null),n=z([]),g=z({}),_=z(null),c=Q(()=>n.value.find(d=>d.id===_.value)||null),A=Q(()=>c.value?g.value[c.value.node_id]||`未知节点 (${c.value.node_id})`:"");ne(()=>{const d=localStorage.getItem("msl-user-token");d&&(y.value=d,h())}),ue(()=>{x.value&&!x.value.closed&&x.value.close()});async function u(){k.info("正在跳转至MSL用户中心登录...");try{const d=ae(32),a=await K.post({url:"/api/oauth/createAppLogin",baseURL:"https://user.mslmc.net",data:{appid:I.value,csrf:d}});a.data.ssid?(x.value=xe(a.data.url,"登录到您的MSL账户",600,600),setTimeout(()=>s(d,a.data.ssid),1e3)):k.error(a.msg)}catch(d){k.error(d.message)}}async function s(d,a){var P;if(!((P=x.value)!=null&&P.closed)){try{const L=await K.get({url:"/api/oauth/appLogin",baseURL:"https://user.mslmc.net",params:{csrf:d,ssid:a}});if(L.data.token){x.value&&x.value.close(),k.success("登录成功"),y.value=L.data.token,localStorage.setItem("msl-user-token",L.data.token),h();return}}catch(L){k.error("登录失败！"+L.message);return}setTimeout(()=>s(d,a),1e3)}}const $=d=>{if(d===0)return"0 B";const a=1024,P=["B","KB","MB","GB","TB"],L=Math.floor(Math.log(d)/Math.log(a));return parseFloat((d/Math.pow(a,L)).toFixed(2))+" "+P[L]};async function h(){r.value=!0;try{const[d,a]=await Promise.all([K.get({url:"/api/frp/userInfo",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${y.value}`}}),K.get({url:"/api/frp/nodeList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${y.value}`}})]);if(d.code===200)o.value=d.data;else{k.warning("登录已过期，请重新登录～"),y.value="",localStorage.removeItem("msl-user-token");return}if(a.code===200){const L={};a.data.forEach(f=>{L[f.id]=f.node}),g.value=L}const P=await K.get({url:"/api/frp/getTunnelList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${y.value}`}});P.code===200&&(n.value=P.data,n.value.length>0&&(_.value=n.value[0].id))}catch(d){k.error("数据加载失败: "+d.message)}finally{r.value=!1}}const C=z(!1);async function M(){if(c.value){C.value=!0;try{const d=await K.get({url:"/api/frp/getTunnelConfig",baseURL:"https://user.mslmc.net",params:{id:c.value.id},headers:{Authorization:`Bearer ${y.value}`}});d.code===200?await oe(c.value.name,d.data,"MSLFrp"):k.error(d.msg)}catch(d){k.error("获取配置失败: "+d.message)}C.value=!1}}const N=()=>{m.value=!0};async function S(){try{await K.get({url:"/api/user/logout",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${y.value}`}}),y.value="",o.value=null,n.value=[],localStorage.removeItem("msl-user-token"),k.success("已退出登录")}catch(d){k.error("退出失败: "+d.message)}}async function D(){await h(),k.success("数据已更新")}const T=z(!1);async function q(){if(c.value){T.value=!0;try{const d=await K.post({url:"/api/frp/deleteTunnel",baseURL:"https://user.mslmc.net",data:{id:c.value.id},headers:{Authorization:`Bearer ${y.value}`}});d.code===200?(k.success("隧道删除成功"),_.value=null,await h()):k.error(d.msg||"删除失败")}catch(d){k.error("操作失败: "+d.message)}finally{T.value=!1}}}return(d,a)=>{const P=i("t-button"),L=i("t-space"),f=i("t-loading"),U=i("t-tag"),O=i("t-popconfirm"),H=i("t-col"),Y=i("t-row"),J=i("t-card"),le=i("t-divider");return p(),V("div",ze,[y.value===""?(p(),V("div",Te,[l("div",Ue,[l("div",Re,[e(B(se),{size:"48px",style:{color:"var(--td-brand-color)"}})]),a[6]||(a[6]=l("h2",{class:"title"},"欢迎登录 MSLFrp",-1)),a[7]||(a[7]=l("p",{class:"subtitle"},"登录您的MSL账户以使用 MSLFrp 服务",-1)),e(L,{direction:"vertical",size:"medium",style:{width:"100%"}},{default:t(()=>[e(P,{block:"",theme:"primary",size:"large",onClick:u},{icon:t(()=>[e(B(se))]),default:t(()=>[a[4]||(a[4]=b(" 跳转用户中心登录 ",-1))]),_:1}),e(P,{theme:"default",variant:"outline",block:"",size:"large",onClick:a[0]||(a[0]=E=>B(j)("https://user.mslmc.net/register"))},{icon:t(()=>[e(B(ce))]),default:t(()=>[a[5]||(a[5]=b(" 注册 MSL 账户 ",-1))]),_:1})]),_:1})])])):(p(),V("div",Be,[e(f,{attach:"#app-space",loading:r.value,text:"加载数据中..."},null,8,["loading"]),e(L,{id:"app-space",direction:"vertical",size:"large",style:{width:"100%"}},{default:t(()=>[o.value?(p(),R(J,{key:0,bordered:!1,title:"MSLFrp 用户信息",class:"info-card"},{actions:t(()=>[e(L,{size:"small"},{default:t(()=>[e(P,{variant:"outline",theme:"success",size:"small",onClick:a[1]||(a[1]=E=>B(j)("https://user.mslmc.net/store/buy"))},{default:t(()=>[...a[8]||(a[8]=[b(" 订阅会员服务 ",-1)])]),_:1}),e(U,{theme:"primary",variant:"light-outline"},{default:t(()=>[b(w(o.value.user_group_name),1)]),_:1}),e(O,{content:"确认退出登录吗？",onConfirm:S},{default:t(()=>[e(P,{variant:"outline",theme:"danger",size:"small"},{default:t(()=>[...a[9]||(a[9]=[b(" 退出登录 ",-1)])]),_:1})]),_:1})]),_:1})]),default:t(()=>[e(Y,{gutter:[16,16]},{default:t(()=>[e(H,{xs:6,sm:3},{default:t(()=>[l("div",Ae,[a[10]||(a[10]=l("div",{class:"label"},"用户昵称",-1)),l("div",Ne,[b(w(o.value.name)+" ",1),e(U,{theme:o.value.realNameStatus?"success":"warning",variant:"dark",size:"small",style:{cursor:"pointer"},onClick:a[2]||(a[2]=E=>B(j)("https://user.mslmc.net/user/profile"))},{default:t(()=>[b(w(o.value.realNameStatus?"已实名":"未实名"),1)]),_:1},8,["theme"])])])]),_:1}),e(H,{xs:6,sm:3},{default:t(()=>[l("div",De,[a[11]||(a[11]=l("div",{class:"label"},"隧道限额",-1)),l("div",He,w(o.value.maxTunnelCount)+" 条",1)])]),_:1}),e(H,{xs:6,sm:3},{default:t(()=>[l("div",Ee,[a[12]||(a[12]=l("div",{class:"label"},"速率限制",-1)),l("div",Fe,w(o.value.boundLimit/1024*8)+" Mbps",1)])]),_:1}),e(H,{xs:6,sm:3},{default:t(()=>[l("div",Ke,[a[13]||(a[13]=l("div",{class:"label"},"会员到期时间",-1)),l("div",We,w(o.value.outdated===3749682420?"长期有效":B(pe)(o.value.outdated)),1)])]),_:1})]),_:1})]),_:1})):W("",!0),e(Y,{gutter:[16,16]},{default:t(()=>[e(H,{xs:12,md:5,lg:4},{default:t(()=>[e(J,{bordered:!1,class:"full-height-card"},{title:t(()=>[l("div",qe,[a[16]||(a[16]=l("span",null,"我的隧道",-1)),e(L,{size:"4px"},{default:t(()=>[e(P,{style:{"margin-left":"3px"},size:"small",variant:"text",loading:r.value,onClick:D},{icon:t(()=>[e(B(fe))]),default:t(()=>[a[14]||(a[14]=b(" 刷新 ",-1))]),_:1},8,["loading"]),e(P,{size:"small",variant:"text",onClick:N},{icon:t(()=>[e(B(ve))]),default:t(()=>[a[15]||(a[15]=b(" 新建 ",-1))]),_:1})]),_:1})])]),default:t(()=>[l("div",Oe,[(p(!0),V(X,null,Z(n.value,E=>(p(),V("div",{key:E.id,class:me(["tunnel-item",{active:_.value===E.id}]),onClick:Lt=>_.value=E.id},[l("div",Ge,[e(B(_e))]),l("div",Qe,[l("div",Ye,w(E.name),1),l("div",Je,w(g.value[E.node_id]||`Node ${E.node_id}`),1)]),l("div",Xe,[E.status===1?(p(),R(U,{key:0,theme:"success",variant:"light",size:"small"},{default:t(()=>[...a[17]||(a[17]=[b("在线",-1)])]),_:1})):(p(),R(U,{key:1,theme:"default",variant:"light",size:"small"},{default:t(()=>[...a[18]||(a[18]=[b("未启动",-1)])]),_:1}))])],10,je))),128)),n.value.length===0?(p(),V("div",Ze,"暂无隧道")):W("",!0)])]),_:1})]),_:1}),e(H,{xs:12,md:7,lg:8},{default:t(()=>[e(J,{bordered:!1,class:"full-height-card"},{title:t(()=>[...a[19]||(a[19]=[l("span",null,"隧道详情",-1)])]),actions:t(()=>[c.value?(p(),R(O,{key:0,content:"确认删除此隧道吗？",theme:"danger",placement:"bottom-right",onConfirm:q},{default:t(()=>[e(P,{theme:"danger",variant:"text",loading:T.value},{default:t(()=>[...a[20]||(a[20]=[b(" 删除隧道 ",-1)])]),_:1},8,["loading"])]),_:1})):W("",!0)]),default:t(()=>[c.value?(p(),V("div",et,[l("div",tt,[l("h3",null,w(c.value.name),1),l("p",at,w(c.value.remarks||"暂无备注"),1)]),e(le),e(Y,{gutter:[24,24]},{default:t(()=>[e(H,{span:6},{default:t(()=>[l("div",ot,[a[21]||(a[21]=l("span",{class:"label"},"所在节点",-1)),l("span",lt,w(A.value),1)])]),_:1}),e(H,{span:6},{default:t(()=>[l("div",st,[a[22]||(a[22]=l("span",{class:"label"},"协议类型",-1)),l("span",nt,w(c.value.type),1)])]),_:1}),e(H,{span:6},{default:t(()=>[l("div",rt,[a[23]||(a[23]=l("span",{class:"label"},"本地地址",-1)),l("span",it,w(c.value.local_ip)+":"+w(c.value.local_port),1)])]),_:1}),e(H,{span:6},{default:t(()=>[l("div",dt,[a[24]||(a[24]=l("span",{class:"label"},"远程端口",-1)),l("span",ut,w(c.value.remote_port),1)])]),_:1}),e(H,{span:6},{default:t(()=>[l("div",mt,[a[25]||(a[25]=l("span",{class:"label"},"今日流量",-1)),l("span",pt,w($(c.value.today_traffic*1024*1024)),1)])]),_:1}),e(H,{span:6},{default:t(()=>[l("div",ct,[a[26]||(a[26]=l("span",{class:"label"},"总流量",-1)),l("span",_t,w($(c.value.total_traffic*1024*1024)),1)])]),_:1})]),_:1}),e(le),l("div",ft,[e(P,{theme:"primary",size:"large",loading:C.value,block:"",onClick:M},{icon:t(()=>[e(B(ge))]),default:t(()=>[a[27]||(a[27]=b(" 使用此隧道 ",-1))]),_:1},8,["loading"])])])):(p(),V("div",vt,[e(B(be),{size:"48px",style:{color:"var(--td-text-color-disabled)"}}),a[28]||(a[28]=l("p",null,"请在左侧选择一个隧道查看详情",-1))]))]),_:1})]),_:1})]),_:1})]),_:1})])),m.value?(p(),R(Me,{key:2,visible:m.value,"onUpdate:visible":a[3]||(a[3]=E=>m.value=E),token:y.value,onSuccess:v},null,8,["visible","token"])):W("",!0)])}}}),bt=ee(gt,[["__scopeId","data-v-4ad63842"]]);async function yt(){return await K.get({url:"/query/p2p_server",baseURL:"https://api.mslmc.cn/v3"})}const ht={key:0},kt={key:1},wt={key:0},xt={key:1},$t={key:0},Vt={key:1},Pt=G({__name:"MSLP2P",setup(F){const m=te({roomId:"",roomKey:"",bindPort:25565,isHoster:!0}),v={roomId:[{required:!0,message:"请输入房间号",type:"error"}],roomKey:[{required:!0,message:"请输入房间密钥",type:"error"}],bindPort:[{required:!0,message:"请输入绑定端口",type:"error"}]},I=async({validateResult:y})=>{y===!0?await x(m.isHoster,m.roomId,m.roomKey,m.bindPort):k.warning("请检查参数是否全部填写完成！")};async function x(y,r,o,n){try{const g=await yt();let _;y?_=`serverAddr = "${g.ip}"
serverPort = ${g.port}

[[proxies]]
name = "${r}"
type = "xtcp"
secretKey = "${o}"
localIP = "127.0.0.1"
localPort = ${n}`:_=`serverAddr = "${g.ip}"
serverPort = ${g.port}

[[visitors]]
name = "p2p_visitor"
type = "xtcp"
serverName = "${r}"
secretKey = "${o}"
bindAddr = "127.0.0.1"
bindPort = ${n}`,await oe(y?`「联机 - 房主」${r}`:`「联机 - 访客」${r}`,_,"MSL P2P")}catch(g){k.error(`创建联机隧道失败！${g.message}`)}}return(y,r)=>{const o=i("t-radio"),n=i("t-radio-group"),g=i("t-form-item"),_=i("t-input"),c=i("t-button"),A=i("t-form"),u=i("t-card");return p(),V("div",null,[e(u,{bordered:!1},{header:t(()=>[...r[5]||(r[5]=[l("span",{style:{"font-weight":"bold","font-size":"16px"}},"MSL P2P 联机隧道",-1)])]),default:t(()=>[e(A,{data:m,rules:v,"label-width":100,"label-align":"top","reset-type":"initial",onSubmit:I},{default:t(()=>[e(g,{label:"请选择联机类型",name:"isHoster"},{default:t(()=>[e(n,{modelValue:m.isHoster,"onUpdate:modelValue":r[0]||(r[0]=s=>m.isHoster=s)},{default:t(()=>[e(o,{value:!0},{default:t(()=>[...r[6]||(r[6]=[b("创建房间 - 房主",-1)])]),_:1}),e(o,{value:!1},{default:t(()=>[...r[7]||(r[7]=[b("加入房间 - 成员",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"房间号",name:"roomId"},{help:t(()=>[m.isHoster?(p(),V("span",ht,"建议填写您的QQ号码。")):(p(),V("span",kt,"请输入房间创建者提供的房间号。"))]),default:t(()=>[e(_,{modelValue:m.roomId,"onUpdate:modelValue":r[1]||(r[1]=s=>m.roomId=s),placeholder:"请输入房间号"},null,8,["modelValue"])]),_:1}),e(g,{label:"房间密钥",name:"roomKey"},{help:t(()=>[m.isHoster?(p(),V("span",wt,"随便写一个你喜欢的密钥。")):(p(),V("span",xt,"请输入房间创建者提供的密钥。"))]),default:t(()=>[e(_,{modelValue:m.roomKey,"onUpdate:modelValue":r[2]||(r[2]=s=>m.roomKey=s),placeholder:"请输入房间密钥"},null,8,["modelValue"]),m.isHoster?(p(),R(c,{key:0,theme:"default",variant:"base",style:{"margin-left":"5px"},onClick:r[3]||(r[3]=s=>{m.roomKey=B(ae)(16)})},{default:t(()=>[...r[8]||(r[8]=[b("随机生成",-1)])]),_:1})):W("",!0)]),_:1}),e(g,{label:"绑定端口",name:"bindPort"},{help:t(()=>[m.isHoster?(p(),V("span",$t,"请输入游戏内提示的开放联机端口。")):(p(),V("span",Vt,"建议保持默认。"))]),default:t(()=>[e(_,{modelValue:m.bindPort,"onUpdate:modelValue":r[4]||(r[4]=s=>m.bindPort=s),placeholder:"请输入绑定端口"},null,8,["modelValue"])]),_:1}),e(g,{style:{"margin-top":"16px"}},{default:t(()=>[e(c,{theme:"primary",type:"submit"},{default:t(()=>[...r[9]||(r[9]=[b("添加隧道",-1)])]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})])}}}),fa=G({__name:"index",setup(F){const m=z(1);return(v,I)=>{const x=i("t-tab-panel"),y=i("t-tabs"),r=i("t-card");return p(),V("div",null,[e(r,{direction:"vertical"},{default:t(()=>[e(y,{modelValue:m.value,"onUpdate:modelValue":I[0]||(I[0]=o=>m.value=o)},{default:t(()=>[e(x,{value:1,label:"MSLFrp","destroy-on-hide":!1},{default:t(()=>[e(bt,{style:{margin:"15px"}})]),_:1}),e(x,{value:2,label:"MSL 联机","destroy-on-hide":!1},{default:t(()=>[e(Pt,{style:{margin:"15px"}})]),_:1}),e(x,{value:3,label:"自定义Frp","destroy-on-hide":!1},{default:t(()=>[e(we,{style:{margin:"15px"}})]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}});export{fa as default};
