import{g as W,c as X,u as Y,d as j}from"./user.DJJ8p2_M.js";import{u as H,_ as O}from"./index.CJ_U555v.js";import{M as u,D as Q}from"./tdesign-vue-next.EnwhK9x8.js";import{g as Z,y as ee,U as te}from"./tdesign-icons-vue-next.DieAbZNO.js";import{D as ae,F as p,W as oe,K as A,R as se,aX as w,G as o,b2 as s,b0 as r,aY as c,a$ as d,ao as i,ap as y,b5 as h,b1 as C,b6 as le}from"./index.BbdIPky0.js";import"./pinia.DE9DXmFR.js";import"./pinia-plugin-persistedstate.n2tMOXAx.js";import"./vue-router.CTuarHf7.js";import"./tvision-color.BU_YHHaJ.js";import"./chroma-js.Cmk4elvR.js";import"./bezier-easing.jp9ayU57.js";import"./lodash.BpjWTYO-.js";import"./axios.R-lXtGyY.js";import"./qs.CnepGyXr.js";import"./side-channel.Bf-JVZLg.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.CD-SYzlK.js";import"./cron-parser.BqMfRICj.js";import"./luxon.BVaPVz1w.js";import"./side-channel-list.CQN2BsdT.js";import"./side-channel-map.BJ69Knz3.js";import"./get-intrinsic.CAdfHqt8.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.Cbri-GHQ.js";import"./dunder-proto.q7lw_6_J.js";import"./call-bind-apply-helpers.BxcZtPLH.js";import"./function-bind.BbkWVFrm.js";import"./hasown.ckq0ukzO.js";import"./call-bound.BO70H6sD.js";import"./side-channel-weakmap.BkoVKe_V.js";import"./nprogress.CMq2Rk2a.js";import"./core-js-pure.DghWRT_o.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./lodash-es.ClUTdtmA.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";const re={class:"user-manage"},ie={class:"toolbar"},ne={class:"left-action"},de={class:"right-search"},me={class:"user-info-cell"},ue={class:"text-info"},pe={class:"nickname"},ce={class:"username"},fe={key:0,class:"time-text"},_e={key:1,class:"time-placeholder"},ve={class:"op-buttons"},ge=ae({__name:"index",setup(be){const V=p(!1),x=p([]),v=p(""),L=H(),f=p(!1),n=p("create"),k=p(!1),t=oe({id:"",username:"",name:"",password:"",role:"user",resetApiKey:!1}),z={username:[{required:!0,message:"请输入用户名",type:"error"}],role:[{required:!0,message:"请选择角色",type:"error"}],password:[{validator:l=>n.value==="create"&&!l?{result:!1,message:"创建用户时密码必填",type:"error"}:!0}]},S=A(()=>[{colKey:"info",title:"用户信息",width:200,fixed:"left",cell:"info-slot"},{colKey:"role",title:"角色",width:100,cell:"role-slot"},{colKey:"lastLogin",title:"最后登录",width:180,cell:"time-slot",className:"hidden-xs"},{colKey:"op",title:"操作",width:140,fixed:"right",cell:"op-slot"}]),U=A(()=>{if(!v.value)return x.value;const l=v.value.toLowerCase();return x.value.filter(e=>e.username.toLowerCase().includes(l)||e.name&&e.name.toLowerCase().includes(l))}),g=async()=>{V.value=!0;try{const l=await W();x.value=l}catch(l){u.error(l.message||"获取用户列表失败")}finally{V.value=!1}},N=()=>{n.value="create",t.id="",t.username="",t.name="",t.password="",t.role="user",t.resetApiKey=!1,f.value=!0},P=l=>{n.value="edit",t.id=l.id,t.username=l.username,t.name=l.name,t.password="",t.role=l.role,t.resetApiKey=!1,f.value=!0},$=async({validateResult:l})=>{if(l===!0){k.value=!0;try{n.value==="create"?(await X({username:t.username,password:t.password,name:t.name,role:t.role}),u.success("用户创建成功")):(await Y(t.id,{name:t.name,password:t.password||void 0,role:t.role,resetApiKey:t.resetApiKey}),u.success("用户更新成功")),f.value=!1,g()}catch(e){u.error(e.message||"操作失败")}finally{k.value=!1}}},B=l=>{const e=Q.confirm({header:"删除警告",body:`确定要删除用户 "${l.username}" 吗？此操作不可恢复。`,theme:"danger",onConfirm:async()=>{try{e.hide(),await j(l.id),u.success("删除成功"),g()}catch(m){u.error(m.message||"删除失败")}}})};return se(()=>{g()}),(l,e)=>{const m=r("t-button"),b=r("t-input"),I=r("t-avatar"),K=r("t-tag"),M=r("t-divider"),T=r("t-table"),q=r("t-card"),_=r("t-form-item"),D=r("t-radio-button"),R=r("t-radio-group"),E=r("t-checkbox"),F=r("t-form"),G=r("t-dialog");return c(),w("div",re,[o(q,{bordered:!1,class:"main-card"},{default:s(()=>[d("div",ie,[d("div",ne,[o(m,{theme:"primary",onClick:N},{icon:s(()=>[o(y(Z))]),default:s(()=>[e[7]||(e[7]=i(" 新增用户 ",-1))]),_:1})]),d("div",de,[o(b,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=a=>v.value=a),placeholder:"搜索用户名或昵称",clearable:""},{"prefix-icon":s(()=>[o(y(ee))]),_:1},8,["modelValue"]),o(m,{variant:"text",shape:"square",onClick:g},{icon:s(()=>[o(y(te))]),_:1})])]),o(T,{"row-key":"id",data:U.value,columns:S.value,loading:V.value,hover:!0,pagination:{defaultPageSize:20,total:U.value.length,showJumper:!0},class:"user-table","table-layout":"auto"},{"info-slot":s(({row:a})=>[d("div",me,[o(I,{image:a.avatar,size:"40px",shape:"circle","hide-on-load-failed":!1},{default:s(()=>[i(h(a.name?a.name[0].toUpperCase():"U"),1)]),_:2},1032,["image"]),d("div",ue,[d("div",pe,h(a.name||"未设置昵称"),1),d("div",ce,"@"+h(a.username),1)])])]),"role-slot":s(({row:a})=>[a.role==="admin"?(c(),C(K,{key:0,theme:"success",variant:"light",size:"small",shape:"round"},{default:s(()=>[...e[8]||(e[8]=[i("管理员",-1)])]),_:1})):(c(),C(K,{key:1,theme:"primary",variant:"light",size:"small",shape:"round"},{default:s(()=>[...e[9]||(e[9]=[i("普通用户",-1)])]),_:1}))]),"time-slot":s(({row:a})=>[a.lastLoginTime?(c(),w("span",fe,h(new Date(a.lastLoginTime).toLocaleString()),1)):(c(),w("span",_e,"从未登录"))]),"op-slot":s(({row:a})=>[d("div",ve,[o(m,{variant:"text",theme:"primary",size:"small",onClick:J=>P(a)},{default:s(()=>[...e[10]||(e[10]=[i(" 编辑 ",-1)])]),_:1},8,["onClick"]),o(M,{layout:"vertical"}),o(m,{variant:"text",theme:"danger",size:"small",disabled:a.id===y(L).userInfo.id||a.username==="admin",onClick:J=>B(a)},{default:s(()=>[...e[11]||(e[11]=[i(" 删除 ",-1)])]),_:1},8,["disabled","onClick"])])]),_:1},8,["data","columns","loading","pagination"])]),_:1}),o(G,{visible:f.value,"onUpdate:visible":e[6]||(e[6]=a=>f.value=a),header:n.value==="create"?"新增用户":"编辑用户","confirm-btn":{content:"提交",loading:k.value},"on-confirm":()=>l.$refs.formRef.submit(),width:"480px"},{default:s(()=>[o(F,{ref:"formRef",data:t,rules:z,"label-align":"top",onSubmit:$},{default:s(()=>[o(_,{label:"用户名",name:"username"},{default:s(()=>[o(b,{modelValue:t.username,"onUpdate:modelValue":e[1]||(e[1]=a=>t.username=a),placeholder:"登录账号",disabled:n.value==="edit"},null,8,["modelValue","disabled"])]),_:1}),o(_,{label:"昵称",name:"name"},{default:s(()=>[o(b,{modelValue:t.name,"onUpdate:modelValue":e[2]||(e[2]=a=>t.name=a),placeholder:"显示名称"},null,8,["modelValue"])]),_:1}),o(_,{label:"角色",name:"role"},{default:s(()=>[o(R,{modelValue:t.role,"onUpdate:modelValue":e[3]||(e[3]=a=>t.role=a),variant:"default-filled"},{default:s(()=>[o(D,{value:"user",disabled:""},{default:s(()=>[...e[12]||(e[12]=[i("普通用户",-1)])]),_:1}),o(D,{value:"admin"},{default:s(()=>[...e[13]||(e[13]=[i("管理员",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(_,{label:"密码",name:"password",help:n.value==="edit"?"留空则不修改密码":""},{default:s(()=>[o(b,{modelValue:t.password,"onUpdate:modelValue":e[4]||(e[4]=a=>t.password=a),type:"password",placeholder:"设置密码",autocomplete:"new-password"},null,8,["modelValue"])]),_:1},8,["help"]),n.value==="edit"?(c(),C(_,{key:0,label:"API 密钥"},{default:s(()=>[o(E,{modelValue:t.resetApiKey,"onUpdate:modelValue":e[5]||(e[5]=a=>t.resetApiKey=a)},{default:s(()=>[...e[14]||(e[14]=[i("重置该用户的 API Key",-1)])]),_:1},8,["modelValue"])]),_:1})):le("",!0)]),_:1},8,["data"])]),_:1},8,["visible","header","confirm-btn","on-confirm"])])}}}),it=O(ge,[["__scopeId","data-v-366d0627"]]);export{it as default};
