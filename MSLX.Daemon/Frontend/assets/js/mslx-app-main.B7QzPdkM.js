import{d as se,o,b as C,n as ke,e as ee,f as rt,h as t,r as x,i as Ce,j as nl,w as ol,k as m,l as O,m as a,p as e,F as de,q as ye,s as ot,t as I,u as K,v as Xt,x as xs,y as k,z as v,A as Da,T as Qt,K as il,B as Ze,C as oa,D as kt,M as B,E as we,G as rl,H as ul,I as dl,J as cl,L as Qe,N as Oa,O as St,P as va,Q as As,R as Cs,S as fa,U as It,V as Mt,W as Et,X as ml,Y as pl,Z as dt,_ as ja,$ as Ca,a0 as vl,a1 as bt,a2 as Xe,a3 as Ss,a4 as fl,a5 as Is,a6 as gl,a7 as $t,a8 as _l,a9 as st,aa as hl,ab as ga,ac as yl,ad as Je,ae as tt,af as Vs,ag as bl,ah as wt,ai as Vt,aj as wl,ak as kl,al as $l,am as at,an as Tt,ao as xl,ap as Nt,aq as Al,ar as Ms,as as Yt,at as Ls,au as Us,av as zt,aw as Cl,ax as Ft,ay as Zt,az as Bs,aA as Sl,aB as Il,aC as Pt,aD as Vl,aE as Ml,aF as Ll,aG as zs,aH as Ps,aI as Gt,aJ as Rt,aK as Ul,aL as _a,aM as Rs,aN as Ia,aO as Va,aP as Bl,aQ as Ma,aR as Ht,aS as La,aT as ua,aU as Es,aV as pt,aW as da,aX as ha,aY as zl,aZ as Pl,a_ as Rl,a$ as ts,b0 as Ua,b1 as El,b2 as Tl,b3 as Fl,b4 as Dl,b5 as Ts,b6 as Fs,b7 as Ds,b8 as Ol,b9 as jl,ba as Kl,bb as Nl,bc as ql,bd as Gl,be as Hl,bf as Jl,bg as Os,bh as Wl,bi as Xl,bj as Ql,bk as js,bl as Yl,bm as Zl,bn as en,bo as tn,bp as as,bq as an,br as sn,bs as ln}from"./mslx-core.DTFuMkGy.js";import{a3 as Ba,a4 as Ks,a5 as nn,a6 as yt,a7 as on,a8 as rn,a9 as At,aa as un,ab as dn,ac as cn,ad as qt,ae as ue,af as Ns,ag as qs,ah as mn}from"./mslx-libs.DIcl6gaG.js";import{i as ca,L as Gs}from"./mslx-charts.C2hKlx9i.js";import{o as pn,a as vn,d as fn,t as gn,h as _n,e as hn,j as yn,y as bn,f as wn}from"./mslx-editor.Bra70VGV.js";import{H as kn,w as $n,_ as xn,K as ss,T as ls,C as An}from"./mslx-formatter.B-70lPdB.js";const Cn="modulepreload",Sn=function(s){return"/"+s},ns={},We=function(l,n,d){let i=Promise.resolve();if(n&&n.length>0){let c=function(_){return Promise.all(_.map(y=>Promise.resolve(y).then(M=>({status:"fulfilled",value:M}),M=>({status:"rejected",reason:M}))))};document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),r=f?.nonce||f?.getAttribute("nonce");i=c(n.map(_=>{if(_=Sn(_),_ in ns)return;ns[_]=!0;const y=_.endsWith(".css"),M=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${_}"]${M}`))return;const $=document.createElement("link");if($.rel=y?"stylesheet":Cn,y||($.as="script"),$.crossOrigin="",$.href=_,r&&$.setAttribute("nonce",r),document.head.appendChild($),y)return new Promise((V,h)=>{$.addEventListener("load",V),$.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${_}`)))})}))}function u(f){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=f,window.dispatchEvent(r),!r.defaultPrevented)throw f}return i.then(f=>{for(const r of f||[])r.status==="rejected"&&u(r.reason);return l().catch(u)})},In=["src"],Vn=se({__name:"index",props:{url:String,type:{type:String,default:"layout"}},setup(s){const l=s,n=ee(()=>{const{type:d}=l;return["thumbnail-container",{"thumbnail-circle":d==="circle","thumbnail-layout":d==="layout"}]});return(d,i)=>(o(),C("img",{class:ke(n.value),src:s.url},null,10,In))}}),ie=(s,l)=>{const n=s.__vccOpts||s;for(const[d,i]of l)n[d]=i;return n},Mn=ie(Vn,[["__scopeId","data-v-bc3a7420"]]),Ln={DEFAULT:{"--td-brand-color":"#0052d9","--td-brand-color-1":"#f2f3ff","--td-brand-color-2":"#d9e1ff","--td-brand-color-3":"#b5c7ff","--td-brand-color-4":"#8eabff","--td-brand-color-5":"#618dff","--td-brand-color-6":"#366ef4","--td-brand-color-7":"#0052d9","--td-brand-color-8":"#003cab","--td-brand-color-9":"#002a7c","--td-brand-color-10":"#001a57"},CYAN:{"--td-brand-color":"#0594FA","--td-brand-color-1":"#d7eefe","--td-brand-color-2":"#aeddfd","--td-brand-color-3":"#84cafd","--td-brand-color-4":"#58b8fc","--td-brand-color-5":"#29a4fb","--td-brand-color-6":"#0594FA","--td-brand-color-7":"#29a4fb","--td-brand-color-8":"#0594FA","--td-brand-color-9":"#0378df","--td-brand-color-10":"#01409b"},GREEN:{"--td-brand-color":"#00A870","--td-brand-color-1":"#8dffd9","--td-brand-color-2":"#00f2a2","--td-brand-color-3":"#00dc92","--td-brand-color-4":"#00c583","--td-brand-color-5":"#00A870","--td-brand-color-6":"#009a5d","--td-brand-color-7":"#00c583","--td-brand-color-8":"#00A870","--td-brand-color-9":"#009a5d","--td-brand-color-10":"#004a14"},ORANGE:{"--td-brand-color":"#ED7B2F","--td-brand-color-1":"#fce5d7","--td-brand-color-2":"#f8cdaf","--td-brand-color-3":"#f4b285","--td-brand-color-4":"#f19659","--td-brand-color-5":"#ED7B2F","--td-brand-color-6":"#e75510","--td-brand-color-7":"#f19659","--td-brand-color-8":"#ED7B2F","--td-brand-color-9":"#e75510","--td-brand-color-10":"#7f0a02"},RED:{"--td-brand-color":"#E34D59","--td-brand-color-1":"#fbe5e7","--td-brand-color-2":"#f7ccd0","--td-brand-color-3":"#f3b2b8","--td-brand-color-4":"#ef989f","--td-brand-color-5":"#ea7b84","--td-brand-color-6":"#E34D59","--td-brand-color-7":"#ea7b84","--td-brand-color-8":"#E34D59","--td-brand-color-9":"#e42c3a","--td-brand-color-10":"#8d0309"},PINK:{"--td-brand-color":"#ED49B4","--td-brand-color-1":"#fce5f4","--td-brand-color-2":"#facae9","--td-brand-color-3":"#f7aede","--td-brand-color-4":"#f491d2","--td-brand-color-5":"#f172c5","--td-brand-color-6":"#ED49B4","--td-brand-color-7":"#f172c5","--td-brand-color-8":"#ED49B4","--td-brand-color-9":"#e80f9d","--td-brand-color-10":"#8f025e"},PURPLE:{"--td-brand-color":"#834EC2","--td-brand-color-1":"#eee6f7","--td-brand-color-2":"#ddceee","--td-brand-color-3":"#ccb6e6","--td-brand-color-4":"#bb9edc","--td-brand-color-5":"#ab87d5","--td-brand-color-6":"#9a6fce","--td-brand-color-7":"#9a6fce","--td-brand-color-8":"#834EC2","--td-brand-color-9":"#783ac3","--td-brand-color-10":"#4c1397"},YELLOW:{"--td-brand-color":"#EBB105","--td-brand-color-1":"#fde9ab","--td-brand-color-2":"#fbd152","--td-brand-color-3":"#EBB105","--td-brand-color-4":"#dda204","--td-brand-color-5":"#ca8d03","--td-brand-color-6":"#b67803","--td-brand-color-7":"#fbd152","--td-brand-color-8":"#EBB105","--td-brand-color-9":"#dda204","--td-brand-color-10":"#603100"}},Hs={textColor:"rgba(0, 0, 0, 0.9)",placeholderColor:"rgba(0, 0, 0, 0.35)",borderColor:"#dcdcdc",containerColor:"#fff"},Un={textColor:"rgba(255, 255, 255, 0.9)",placeholderColor:"rgba(255, 255, 255, 0.35)",borderColor:"#5e5e5e",containerColor:"#242424"};function Bn(s){return s.replace(/([A-Z])/g,"_$1").toUpperCase()}function zn(s,l){const n=/^#[A-F\d]{6}$/i.test(s)?s:Bn(s);return l[n||"DEFAULT"]}function Pn(s,l,n){const d=n==="dark";let i=l.indexOf(s);return d&&(l.reverse().map(f=>{const[r,c,_]=Ba.colorTransform(f,"hex","hsl");return Ba.colorTransform([r,Number(c)-4,_],"hsl","hex")}),i=5,l[0]=`${l[i]}20`),{"--td-brand-color":l[i],"--td-brand-color-1":l[0],"--td-brand-color-2":l[1],"--td-brand-color-3":l[2],"--td-brand-color-4":l[3],"--td-brand-color-5":l[4],"--td-brand-color-6":l[5],"--td-brand-color-7":i>0?l[i-1]:s,"--td-brand-color-8":l[i],"--td-brand-color-9":i>8?s:l[i+1],"--td-brand-color-10":l[9]}}function Rn(s,l,n){const i=n==="dark"?`:root[theme-color='${s}'][theme-mode='dark']`:`:root[theme-color='${s}']`,u=document.createElement("style");u.type="text/css",u.innerText=`${i}{
    --td-brand-color: ${l["--td-brand-color"]};
    --td-brand-color-1: ${l["--td-brand-color-1"]};
    --td-brand-color-2: ${l["--td-brand-color-2"]};
    --td-brand-color-3: ${l["--td-brand-color-3"]};
    --td-brand-color-4: ${l["--td-brand-color-4"]};
    --td-brand-color-5: ${l["--td-brand-color-5"]};
    --td-brand-color-6: ${l["--td-brand-color-6"]};
    --td-brand-color-7: ${l["--td-brand-color-7"]};
    --td-brand-color-8: ${l["--td-brand-color-8"]};
    --td-brand-color-9: ${l["--td-brand-color-9"]};
    --td-brand-color-10: ${l["--td-brand-color-10"]};
  }`,document.head.appendChild(u)}const En="conic-gradient(from 90deg at 50% 50%, #FF0000 -19.41deg, #FF0000 18.76deg, #FF8A00 59.32deg, #FFE600 99.87deg, #14FF00 141.65deg, #00A3FF 177.72deg, #0500FF 220.23deg, #AD00FF 260.13deg, #FF00C7 300.69deg, #FF0000 340.59deg, #FF0000 378.76deg)",Tn=se({__name:"index",props:{value:{type:String}},setup(s){const l=it(),n=s,d=ee(()=>{const{value:i}=n,{colorList:u}=l;return{background:i!=="dynamic"?zn(i,u)["--td-brand-color"]:En}});return(i,u)=>(o(),C("div",{style:rt(d.value),class:"color-container"},null,4))}}),os=ie(Tn,[["__scopeId","data-v-e8478b14"]]),Ka={showFooter:!0,isSidebarCompact:!1,showBreadcrumb:!1,mode:"auto",layout:"side",splitMenu:!1,isFooterAside:!1,isSidebarFixed:!0,isHeaderFixed:!0,showHeader:!0,backgroundTheme:"blueGrey",brandTheme:"default",enableCustomTheme:!1},Fn={xmlns:"http://www.w3.org/2000/svg",width:"88",height:"48",fill:"none"};function Dn(s,l){return o(),C("svg",Fn,[...l[0]||(l[0]=[t("path",{fill:"#13161B",d:"M0 0h88v48H0z"},null,-1),t("path",{fill:"#949EAA","fill-rule":"evenodd",d:"M52.533 26.87q-.748.129-1.533.13a9 9 0 0 1-8.533-11.87A9 9 0 0 0 44 33a9 9 0 0 0 8.533-6.13","clip-rule":"evenodd"},null,-1)])])}const On={render:Dn},jn={xmlns:"http://www.w3.org/2000/svg",width:"88",height:"48",fill:"none"};function Kn(s,l){return o(),C("svg",jn,[...l[0]||(l[0]=[t("path",{fill:"var(--td-component-border)",d:"M0 0h88v48H0z"},null,-1),t("path",{fill:"var(--td-text-color-primary)","fill-rule":"evenodd",d:"M44 20.583a3.417 3.417 0 1 0 0 6.833 3.417 3.417 0 0 0 0-6.833M39.083 24a4.917 4.917 0 1 1 9.834 0 4.917 4.917 0 0 1-9.834 0M43.25 17.333v-2.5h1.5v2.5zM48.184 18.755l1.767-1.767 1.06 1.06-1.767 1.768zM50.667 23.25h2.5v1.5h-2.5zM49.244 28.184l1.768 1.767-1.06 1.06-1.768-1.767zM44.75 30.666v2.5h-1.5v-2.5zM39.816 29.244l-1.767 1.768-1.061-1.061 1.767-1.768zM37.333 24.75h-2.5v-1.5h2.5zM38.756 19.816l-1.768-1.768 1.06-1.06 1.768 1.767z","clip-rule":"evenodd"},null,-1)])])}const Nn={render:Kn},qn={xmlns:"http://www.w3.org/2000/svg",width:"88",height:"48",fill:"none"};function Gn(s,l){return o(),C("svg",qn,[...l[0]||(l[0]=[t("path",{fill:"var(--td-component-border)",d:"M0 0h88v48H0z"},null,-1),t("path",{fill:"var(--td-text-color-primary)",d:"M42.863 14.052v2.708h1.625v-2.708z"},null,-1),t("path",{fill:"var(--td-text-color-primary)","fill-rule":"evenodd",d:"M38.349 23.982a5.326 5.326 0 1 1 10.653 0 5.326 5.326 0 0 1-10.653 0m5.326-3.701a3.701 3.701 0 1 0 0 7.403 3.701 3.701 0 0 0 0-7.403M52.208 26.781h-2.621l-2.06 6.699 1.552.478.511-1.661h2.614l.511 1.66 1.554-.477zm-.503 3.89-.697-2.265h-.221l-.697 2.266z","clip-rule":"evenodd"},null,-1),t("path",{fill:"var(--td-text-color-primary)",d:"m48.208 18.3 1.915-1.914 1.149 1.15-1.915 1.914zM53.606 23.17h-2.709v1.625h2.709zM44.488 31.205v2.708h-1.625v-2.708zM37.228 31.579l1.915-1.915-1.15-1.15-1.914 1.916zM36.453 24.795h-2.708V23.17h2.708zM36.079 17.535l1.915 1.915 1.149-1.15-1.915-1.914z"},null,-1)])])}const Hn={render:Gn},Jn={class:"setting-container"},Wn={style:{textAlign:"center",marginTop:"8px"}},Xn={class:"setting-item-row"},Qn={class:"setting-layout-drawer"},Yn=se({__name:"setting",setup(s){const l=it(),n=x(window.innerWidth),d=ee(()=>n.value<480),i=ee(()=>d.value?"85%":"408px"),u=()=>{n.value=window.innerWidth},f=["side","top"],r=["default","cyan","green","yellow","orange","red","pink","purple","dynamic"],c=[{type:"auto",text:"跟随系统"},{type:"light",text:"明亮"},{type:"dark",text:"暗黑"}],y=x({...(()=>{const p={...Ka};for(const S in p)Object.prototype.hasOwnProperty.call(p,S)&&(p[S]=l[S]);return p})()});d.value&&y.value.layout==="side"&&(y.value.layout="top");const M=x(!1),$=ee({get(){return l.showSettingPanel},set(p){l.updateConfig({showSettingPanel:p})}}),V=p=>{const S=Ba.getPaletteByGradation({colors:[p],step:10})[0],{mode:b}=l,R=Pn(p,S,b);l.addColor({[p]:R}),l.updateConfig({...y.value,brandTheme:p}),Rn(p,R,b)};Ce(()=>{const p=document.querySelector(".dynamic-color-btn");p&&p.addEventListener("click",()=>{M.value=!0}),window.addEventListener("resize",u)}),nl(()=>{window.removeEventListener("resize",u)});const h=(p,S)=>{!p&&S.trigger==="document"&&(M.value=p)},g=p=>p==="light"?Nn:p==="dark"?On:Hn,z=()=>{l.updateConfig({showSettingPanel:!1})},U=p=>`https://tdesign.gtimg.com/tdesign-pro/setting/${p}.png`;return ol(()=>{l.updateConfig(y.value)}),(p,S)=>{const b=m("t-radio-button"),R=m("t-radio-group"),T=m("t-switch"),P=m("t-color-picker-panel"),G=m("t-popup"),N=m("t-form"),E=m("t-drawer");return o(),O(E,{visible:$.value,"onUpdate:visible":S[4]||(S[4]=w=>$.value=w),size:i.value,footer:!1,header:"面板样式","close-btn":!0,class:"setting-drawer-container",onCloseBtnClick:z},{default:a(()=>[t("div",Jn,[e(N,{ref:"form",data:y.value,"label-align":"left"},{default:a(()=>[S[6]||(S[6]=t("div",{class:"setting-group-title"},"主题模式",-1)),e(R,{modelValue:y.value.mode,"onUpdate:modelValue":S[0]||(S[0]=w=>y.value.mode=w)},{default:a(()=>[(o(),C(de,null,ye(c,(w,A)=>t("div",{key:A,class:"setting-layout-drawer"},[t("div",null,[(o(),O(b,{key:A,value:w.type},{default:a(()=>[(o(),O(ot(g(w.type))))]),_:2},1032,["value"])),t("p",Wn,I(w.text),1)])])),64))]),_:1},8,["modelValue"]),S[7]||(S[7]=t("div",{class:"setting-group-title"},"个性化",-1)),t("div",Xn,[S[5]||(S[5]=t("span",{class:"setting-item-label"},"开启背景美化",-1)),e(T,{modelValue:y.value.enableCustomTheme,"onUpdate:modelValue":S[1]||(S[1]=w=>y.value.enableCustomTheme=w)},null,8,["modelValue"])]),S[8]||(S[8]=t("div",{class:"setting-group-title"},"主题色",-1)),e(R,{modelValue:y.value.brandTheme,"onUpdate:modelValue":S[2]||(S[2]=w=>y.value.brandTheme=w)},{default:a(()=>[(o(!0),C(de,null,ye(r.slice(0,r.length-1),(w,A)=>(o(),C("div",{key:A,class:"setting-layout-drawer"},[(o(),O(b,{key:A,value:w,class:"setting-layout-color-group"},{default:a(()=>[e(os,{value:w},null,8,["value"])]),_:2},1032,["value"]))]))),128)),t("div",Qn,[e(G,{"destroy-on-close":"","expand-animation":"",placement:"bottom-right",trigger:"click",visible:M.value,"overlay-style":{padding:0},onVisibleChange:h},{content:a(()=>[e(P,{"on-change":V,"color-modes":["monochrome"],format:"HEX","swatch-colors":[]})]),default:a(()=>[e(b,{value:r[r.length-1],class:"setting-layout-color-group dynamic-color-btn"},{default:a(()=>[e(os,{value:r[r.length-1]},null,8,["value"])]),_:1},8,["value"])]),_:1},8,["visible"])])]),_:1},8,["modelValue"]),S[9]||(S[9]=t("div",{class:"setting-group-title"},"导航布局",-1)),e(R,{modelValue:y.value.layout,"onUpdate:modelValue":S[3]||(S[3]=w=>y.value.layout=w)},{default:a(()=>[(o(),C(de,null,ye(f,(w,A)=>t("div",{key:A,class:"setting-layout-drawer"},[(o(),O(b,{key:A,value:w},{default:a(()=>[e(Mn,{src:U(w)},null,8,["src"])]),_:2},1032,["value"]))])),64))]),_:1},8,["modelValue"])]),_:1},8,["data"])])]),_:1},8,["visible","size"])}}}),Na=ie(Yn,[["__scopeId","data-v-9f31e17e"]]),ze="mslx-webpanel",Ut="mslx-web-token",Bt="mslx-base-url",Zn={class:"menu-text"},eo={class:"menu-text"},to=se({name:"MenuContent",__name:"MenuContent",props:{navData:{type:Array,default:()=>[]},isHorizontal:{type:Boolean,default:!1},maxItemCount:{type:Number,default:3}},setup(s){const l=s,n=ee(()=>ma()),d=ee(()=>{const{navData:$}=l;return f($)}),i=ee(()=>l.isHorizontal?d.value.slice(0,l.maxItemCount):d.value),u=ee(()=>l.isHorizontal?d.value.slice(l.maxItemCount):[]),f=($,V)=>$?($.sort((h,g)=>(h.meta?.orderNo||0)-(g.meta?.orderNo||0)),$.map(h=>{const g=V&&!h.path.includes(V)?`${V}/${h.path}`:h.path;return{path:g,title:h.meta?.title,icon:h.meta?.icon||"",children:f(h.children,g),meta:h.meta,redirect:h.redirect}}).filter(h=>h.meta&&h.meta.hidden!==!0)):[],r=$=>{const{frameSrc:V,frameBlank:h}=$.meta;return V&&h?V.match(/(http|https):\/\/([\w.]+\/?)\S*/):null},c=$=>n.value.startsWith($.path)?n.value:$.meta?.single?$.redirect:$.path,_=$=>$.icon&&typeof $.icon=="string",y=$=>Ks($.icon)&&typeof $.icon.render=="function"?{can:!0,render:$.icon.render}:{can:!1,render:null},M=$=>{window.open($)};return($,V)=>{const h=m("t-icon"),g=m("t-menu-item"),z=m("menu-content",!0),U=m("t-submenu");return o(),C("div",{id:"menu-wrapper",class:ke(["modern-menu-wrapper",{"is-horizontal":s.isHorizontal}])},[(o(!0),C(de,null,ye(i.value,p=>(o(),C(de,{key:p.path},[!p.children||!p.children.length||p.meta?.single?(o(),C(de,{key:0},[r(p)?(o(),O(g,{key:0,name:p.path,value:c(p),class:"modern-menu-item",onClick:S=>M(r(p)[0])},{icon:a(()=>[_(p)?(o(),O(h,{key:0,name:p.icon},null,8,["name"])):y(p).can?(o(),O(ot(y(p).render),{key:1,class:"t-icon"})):K("",!0)]),default:a(()=>[t("span",Zn,I(p.title),1)]),_:2},1032,["name","value","onClick"])):(o(),O(g,{key:1,name:p.path,value:c(p),to:p.path,class:"modern-menu-item"},{icon:a(()=>[_(p)?(o(),O(h,{key:0,name:p.icon},null,8,["name"])):y(p).can?(o(),O(ot(y(p).render),{key:1,class:"t-icon"})):K("",!0)]),default:a(()=>[t("span",eo,I(p.title),1)]),_:2},1032,["name","value","to"]))],64)):(o(),O(U,{key:1,name:p.path,value:p.path,title:p.title,class:"modern-submenu"},{icon:a(()=>[_(p)?(o(),O(h,{key:0,name:p.icon},null,8,["name"])):y(p).can?(o(),O(ot(y(p).render),{key:1,class:"t-icon"})):K("",!0)]),default:a(()=>[p.children?(o(),O(z,{key:0,"nav-data":p.children,"is-horizontal":!1},null,8,["nav-data"])):K("",!0)]),_:2},1032,["name","value","title"]))],64))),128)),s.isHorizontal&&u.value.length>0?(o(),O(U,{key:0,name:"more-menu",title:"更多",class:"modern-submenu"},{icon:a(()=>[e(h,{name:"ellipsis"})]),default:a(()=>[e(z,{"nav-data":u.value,"is-horizontal":!1},null,8,["nav-data"])]),_:1})):K("",!0)],2)}}}),za=ie(to,[["__scopeId","data-v-3b61b27d"]]),qa="/assets/png/mslx-logo.BqgIBdpC.png",ao=["src"],so={key:1,class:"header-operate-left show-on-mobile"},lo={class:"operations-container"},no={class:"header-user-account",style:{"margin-left":"6px"}},oo=se({__name:"Header",props:{theme:{type:String,default:"light"},layout:{type:String,default:"top"},showLogo:{type:Boolean,default:!0},menu:{type:Array,default:()=>[]},isFixed:{type:Boolean,default:!1},isCompact:{type:Boolean,default:!1},maxLevel:{type:Number,default:3}},setup(s){const l=Ee(),n=s,d=Xt(),i=it(),u=()=>{i.updateConfig({showSettingPanel:!0})},f=ee(()=>ma()),r=ee(()=>[`${ze}-header-layout`]),c=ee(()=>{const{isFixed:g,layout:z,isCompact:U}=n;return[{[`${ze}-header-menu`]:!g,[`${ze}-header-menu-fixed`]:g,[`${ze}-header-menu-fixed-side`]:z==="side"&&g,[`${ze}-header-menu-fixed-side-compact`]:z==="side"&&g&&U}]}),_=()=>{i.updateConfig({isSidebarCompact:!i.isSidebarCompact})},y=g=>{d.push(g)},M=g=>{g&&d.push(g)},$=()=>{d.push({path:"/login",query:{redirect:encodeURIComponent(d.currentRoute.value.fullPath)}})},V=()=>{window.open("https://github.com/MSLTeam/MSLX")},h=()=>{window.open("https://mslx.mslmc.cn")};return(g,z)=>{const U=m("t-icon"),p=m("t-button"),S=m("t-menu"),b=m("t-popup"),R=m("t-tooltip"),T=m("t-dropdown-item"),P=m("t-dropdown-menu"),G=m("t-avatar"),N=m("t-dropdown"),E=m("t-head-menu");return o(),C("div",{class:ke(r.value)},[e(E,{class:ke(c.value),theme:s.theme,"expand-type":"popup",value:f.value},xs({logo:a(()=>[s.showLogo?(o(),C("span",{key:0,class:ke(`${k(ze)}-side-nav-logo-wrapper`),onClick:z[0]||(z[0]=w=>y("/dashboard/base"))},[t("img",{style:{width:"32px"},src:k(qa),class:ke(`${k(ze)}-side-nav-logo-img`),alt:"logo"},null,10,ao),t("span",{style:{"margin-left":"8px","font-size":"18px","font-weight":"bold","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap"},class:ke(`${k(ze)}-side-nav-logo-text hide-on-mobile`)}," MSLX 管理中心 ",2)],2)):K("",!0),s.layout=="side"?(o(),C("div",so,[e(p,{theme:"default",shape:"square",variant:"text",onClick:_},{default:a(()=>[e(U,{class:"collapsed-icon",name:"view-list"})]),_:1})])):K("",!0)]),operations:a(()=>[t("div",lo,[e(R,{placement:"bottom",content:"代码仓库",class:"hide-on-mobile"},{default:a(()=>[e(p,{theme:"default",shape:"square",variant:"text",onClick:V},{default:a(()=>[e(U,{name:"logo-github"})]),_:1})]),_:1}),e(R,{placement:"bottom",content:"帮助文档",class:"hide-on-mobile"},{default:a(()=>[e(p,{theme:"default",shape:"square",variant:"text",onClick:h},{default:a(()=>[e(U,{name:"help-circle"})]),_:1})]),_:1}),e(N,{"min-column-width":135,trigger:"click"},{dropdown:a(()=>[e(P,null,{default:a(()=>[e(T,{class:"operations-dropdown-container-item",onClick:z[1]||(z[1]=w=>y("/settings"))},{default:a(()=>[e(U,{name:"user-circle"}),z[2]||(z[2]=v("个人中心 ",-1))]),_:1}),e(T,{class:"operations-dropdown-container-item",onClick:$},{default:a(()=>[e(U,{name:"poweroff"}),z[3]||(z[3]=v("退出登录 ",-1))]),_:1})]),_:1})]),default:a(()=>[e(p,{class:"header-user-btn",theme:"default",variant:"text"},{icon:a(()=>[e(G,{image:k(l).userInfo.avatar},null,8,["image"])]),suffix:a(()=>[e(U,{name:"chevron-down"})]),default:a(()=>[t("div",no,I(k(l).userInfo.name),1)]),_:1})]),_:1}),e(N,{"min-column-width":135,trigger:"click",class:"show-on-mobile"},{dropdown:a(()=>[e(P,null,{default:a(()=>[e(T,{class:"operations-dropdown-container-item",onClick:V},{default:a(()=>[e(U,{name:"logo-github"}),z[4]||(z[4]=v("代码仓库 ",-1))]),_:1}),e(T,{class:"operations-dropdown-container-item",onClick:h},{default:a(()=>[e(U,{name:"help-circle"}),z[5]||(z[5]=v("帮助文档 ",-1))]),_:1}),e(T,{class:"operations-dropdown-container-item",onClick:u},{default:a(()=>[e(U,{name:"setting"}),z[6]||(z[6]=v("系统设置 ",-1))]),_:1})]),_:1})]),default:a(()=>[e(p,{theme:"default",shape:"square",variant:"text"},{default:a(()=>[e(U,{name:"more"})]),_:1})]),_:1}),e(R,{placement:"bottom",content:"系统设置",class:"hide-on-mobile"},{default:a(()=>[e(p,{theme:"default",shape:"square",variant:"text",onClick:u},{default:a(()=>[e(U,{name:"setting"})]),_:1})]),_:1})])]),_:2},[s.layout!=="side"?{name:"default",fn:a(()=>[e(za,{class:"header-menu hide-on-mobile","nav-data":s.menu,"is-horizontal":!0},null,8,["nav-data"]),e(b,{placement:"bottom-left",class:"show-on-mobile header-menu-mobile-popup","overlay-style":{padding:"0",width:"100%",marginTop:"2px",boxShadow:"none",borderTop:"1px solid var(--td-border-level-1-color)"}},{content:a(()=>[e(S,{value:f.value,theme:s.theme,"expand-mutex":"",style:{width:"100vw"},onChange:M},{default:a(()=>[e(za,{"nav-data":s.menu},null,8,["nav-data"])]),_:1},8,["value","theme"])]),default:a(()=>[e(p,{style:{"margin-left":"-16px"},theme:"default",shape:"square",variant:"text"},{default:a(()=>[e(U,{name:"app"})]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["class","theme","value"])],2)}}}),io=ie(oo,[["__scopeId","data-v-f5039bf3"]]),is=se({__name:"LayoutHeader",setup(s){const l=Jt(),n=it(),{routers:d}=Da(l),i=ee(()=>n.layout==="mix"?n.splitMenu?d.value.map(u=>({...u,children:[]})):[]:d.value);return(u,f)=>k(n).showHeader?(o(),O(io,{key:0,"show-logo":k(n).showHeaderLogo,theme:k(n).displayMode,layout:k(n).layout,"is-fixed":k(n).isHeaderFixed,menu:i.value,"is-compact":k(n).isSidebarCompact},null,8,["show-logo","theme","layout","is-fixed","menu","is-compact"])):K("",!0)}}),ro={};function uo(s,l){const n=m("router-view");return o(),O(n,null,{default:a(({Component:d})=>[e(Qt,{name:"fade",mode:"out-in"},{default:a(()=>[(o(),O(il,null,[(o(),O(ot(d)))],1024))]),_:2},1024)]),_:1})}const co=ie(ro,[["render",uo],["__scopeId","data-v-6214f40c"]]),mo=se({__name:"Breadcrumb",setup(s){const l=ee(()=>{const n=Ze(),d=n.path.split("/");return d.shift(),d.reduce((u,f,r)=>(n.matched[r]?.meta?.hiddenBreadcrumb||Object.values(n.params).includes(f)||u.push({path:f,to:u[r-1]?`/${u[r-1].path}/${f}`:`/${f}`,title:n.matched[r]?.meta?.title??f}),u),[])});return(n,d)=>{const i=m("t-breadcrumbItem"),u=m("t-breadcrumb");return o(),O(u,{"max-item-width":"150",class:"tdesign-breadcrumb"},{default:a(()=>[(o(!0),C(de,null,ye(l.value,f=>(o(),O(i,{key:f.to,to:f.to},{default:a(()=>[v(I(f.title),1)]),_:2},1032,["to"]))),128))]),_:1})}}}),po=ie(mo,[["__scopeId","data-v-b4121266"]]),vo={class:"glass-capsule design-card"},fo={class:"copyright"},go=se({__name:"Footer",setup(s){return(l,n)=>(o(),C("footer",{class:ke(`${k(ze)}-footer-centered-lite`)},[t("div",vo,[n[0]||(n[0]=t("span",{class:"brand"},"MSLX-WEBPANEL",-1)),n[1]||(n[1]=t("span",{class:"divider"},"/",-1)),n[2]||(n[2]=t("span",{class:"brand"},"MSLTEAM",-1)),n[3]||(n[3]=t("span",{class:"divider"},"/",-1)),t("span",fo,"© 2021-"+I(new Date().getFullYear()),1)])],2))}}),_o=ie(go,[["__scopeId","data-v-05d9fb24"]]),rs=se({__name:"LayoutContent",setup(s){const l=it();return(n,d)=>{const i=m("t-content"),u=m("t-footer"),f=m("t-layout");return o(),O(f,{class:ke(`${k(ze)}-layout`)},{default:a(()=>[e(i,{class:ke(`${k(ze)}-content-layout`)},{default:a(()=>[k(l).showBreadcrumb?(o(),O(po,{key:0})):K("",!0),e(co)]),_:1},8,["class"]),k(l).showFooter?(o(),O(u,{key:0,class:ke(`${k(ze)}-footer-layout`)},{default:a(()=>[e(_o)]),_:1},8,["class"])):K("",!0)]),_:1},8,["class"])}}}),ho="mslx-webpanel",yo="1.2.1",bo={dev:"vite --mode development","dev:linux":"vite --mode development","build:test":"vite build --mode test",build:"vue-tsc --noEmit && vite build --mode release && node generate-build-info.js",preview:"vite preview",lint:"eslint --ext .vue,.js,.jsx,.ts,.tsx ./ --max-warnings 0","lint:fix":"eslint --ext .vue,.js,jsx,.ts,.tsx ./ --max-warnings 0 --fix",stylelint:"stylelint src/**/*.{html,vue,sass,less}","stylelint:fix":"stylelint --fix src/**/*.{html,vue,vss,sass,less}",prepare:`node -e "if(require('fs').existsSync('.git')){process.exit(1)}" || is-ci || husky install`,"site:preview":"npm run build && cp -r dist _site",test:'echo "no test specified,work in process"',"test:coverage":'echo "no test:coverage specified,work in process"'},wo={"@codemirror/lang-javascript":"^6.2.4","@codemirror/lang-json":"^6.0.2","@codemirror/lang-yaml":"^6.1.2","@codemirror/language":"^6.12.1","@codemirror/legacy-modes":"^6.5.2","@codemirror/state":"^6.5.2","@codemirror/theme-one-dark":"^6.1.3","@codemirror/view":"^6.39.2","@eslint/js":"^9.38.0","@microsoft/signalr":"^10.0.0","@vueuse/core":"^14.2.1","@xterm/addon-fit":"^0.11.0","@xterm/xterm":"^6.0.0","ansi-colors":"^4.1.3",axios:"^1.13.5","cron-parser":"^5.4.0",dayjs:"^1.11.11",echarts:"^6.0.0",lodash:"4.17.23","md-editor-v3":"^6.1.0",nprogress:"^0.2.0",pinia:"^2.1.7","pinia-plugin-persistedstate":"^3.2.1","qrcode.vue":"^3.4.1",qs:"6.14.2","tdesign-icons-vue-next":"^0.4.1","tdesign-vue-next":"^1.18.2","tvision-color":"^1.6.0","typescript-eslint":"^8.46.2",vue:"^3.5.29","vue-clipboard3":"^2.0.0","vue-codemirror":"^6.1.1","vue-router":"^4.4.0"},ko={"@commitlint/cli":"^19.3.0","@commitlint/config-conventional":"^19.2.2","@types/lodash":"^4.17.23","@types/qs":"^6.9.15","@types/ws":"^8.5.10","@typescript-eslint/eslint-plugin":"^8.46.2","@typescript-eslint/parser":"^8.46.2","@vitejs/plugin-vue":"^6.0.3","@vitejs/plugin-vue-jsx":"^5.1.3","@vue/compiler-sfc":"^3.4.31","@vue/eslint-config-typescript":"^14.6.0",commitizen:"^4.3.0","cz-conventional-changelog":"^3.3.0",eslint:"^9.38.0","eslint-config-prettier":"^9.1.0","eslint-plugin-import":"^2.32.0","eslint-plugin-prettier":"^5.1.3","eslint-plugin-vue":"^10.7.0","eslint-plugin-vue-scoped-css":"^2.12.0",husky:"^9.1.1",less:"^4.2.0","lint-staged":"^15.2.7",prettier:"^3.3.3",stylelint:"^16.25.0","stylelint-less":"^3.0.0","stylelint-order":"^6.0.4",typescript:"^5.5.3",vite:"^7.3.1","vite-svg-loader":"^5.1.0","vue-tsc":"^2.0.26"},$o={commitizen:{path:"./node_modules/cz-conventional-changelog"}},xo="MSLX Web Panel",Kt={name:ho,version:yo,scripts:bo,dependencies:wo,devDependencies:ko,config:$o,"lint-staged":{"*.{js,jsx,vue,ts,tsx}":["prettier --write","npm run lint:fix","git add ."],"*.{html,vue,vss,sass,less}":["npm run stylelint:fix","git add ."]},description:xo},Ao=["src"],Co={class:"version-container"},So=991,Io=se({__name:"SideNav",props:{menu:{type:Array,default:()=>[]},showLogo:{type:Boolean,default:!0},isFixed:{type:Boolean,default:!0},layout:{type:String,default:""},headerHeight:{type:String,default:"64px"},theme:{type:String,default:"light"},isCompact:{type:Boolean,default:!1}},setup(s){const l=s,n=ee(()=>it().isSidebarCompact),d=ee(()=>ma()),i=ee(()=>{const M=ma(),$=M.substring(0,M.lastIndexOf("/")),V=ci();return nn(V,$===""?[]:[$])}),u=ee(()=>{const{isCompact:M}=l;return[`${ze}-sidebar-layout`,{[`${ze}-sidebar-compact`]:M}]}),f=ee(()=>{const{showLogo:M,isFixed:$,layout:V}=l;return[`${ze}-side-nav`,{[`${ze}-side-nav-no-logo`]:!M,[`${ze}-side-nav-no-fixed`]:!$,[`${ze}-side-nav-mix-fixed`]:V==="mix"&&$}]}),r=Xt(),c=it(),_=()=>{const M=window.innerWidth<=So;c.updateConfig({isSidebarCompact:M})};Ce(()=>{_(),window.onresize=()=>{_()}});const y=()=>{r.push("/dashboard/base")};return(M,$)=>{const V=m("t-menu");return o(),C("div",{class:ke(u.value)},[e(V,{class:ke(f.value),theme:s.theme,value:d.value,collapsed:n.value,"default-expanded":i.value},{logo:a(()=>[s.showLogo?(o(),C("span",{key:0,class:ke(`${k(ze)}-side-nav-logo-wrapper`),style:rt(n.value?"display: flex; justify-content: center; width: 100%;":"display: flex; align-items: center; justify-content: flex-start; width: 100%;"),onClick:y},[t("img",{style:{width:"32px","margin-right":"8px"},src:k(qa),class:ke(`${k(ze)}-side-nav-logo-img`),alt:"logo"},null,10,Ao),n.value?K("",!0):(o(),C("span",{key:0,style:{"font-size":"18px","font-weight":"bold","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap"},class:ke(`${k(ze)}-side-nav-logo-text`)}," MSLX 管理中心 ",2))],6)):K("",!0)]),operations:a(()=>[t("span",Co,I(n.value?"":"MSLX-WEBPANEL")+" v"+I(k(Kt).version),1)]),default:a(()=>[e(za,{"nav-data":s.menu},null,8,["nav-data"])]),_:1},8,["class","theme","value","collapsed","default-expanded"]),t("div",{class:ke(`${k(ze)}-side-nav-placeholder${n.value?"-hidden":""}`)},null,2)],2)}}}),us=se({__name:"LayoutSideNav",setup(s){const l=Ze(),n=Jt(),d=it(),{routers:i}=Da(n),u=ee(()=>{const{layout:f,splitMenu:r}=d;let c=i.value;return f==="mix"&&r&&c.forEach(_=>{l.path.indexOf(_.path)===0&&(c=_.children.map(y=>({...y,path:`${_.path}/${y.path}`})))}),c});return(f,r)=>k(d).showSidebar?(o(),O(Io,{key:0,"show-logo":k(d).showSidebarLogo,layout:k(d).layout,"is-fixed":k(d).isSidebarFixed,menu:u.value,theme:k(d).displayMode,"is-compact":k(d).isSidebarCompact},null,8,["show-logo","layout","is-fixed","menu","theme","is-compact"])):K("",!0)}}),Ga="/assets/jpg/mslx-bg_light_new.CL71WzMj.jpg",Ha="/assets/jpg/mslx-bg_night_new.CfCwUDBl.jpg";let ht=new Map;const ds=s=>[s.method,s.url].join("&");class Vo{addPending(l){this.removePending(l);const n=ds(l);l.cancelToken=l.cancelToken||new oa.CancelToken(d=>{ht.has(n)||ht.set(n,d)})}removeAllPending(){ht.forEach(l=>{l&&yt(l)&&l()}),ht.clear()}removePending(l){const n=ds(l);if(ht.has(n)){const d=ht.get(n);d&&d(n),ht.delete(n)}}reset(){ht=new Map}}class Mo{instance;options;constructor(l){this.options=l,this.instance=oa.create(l),this.setupInterceptors()}createAxios(l){this.instance=oa.create(l)}getTransform(){const{transform:l}=this.options;return l}getAxios(){return this.instance}configAxios(l){this.instance&&this.createAxios(l)}setHeader(l){this.instance&&Object.assign(this.instance.defaults.headers,l)}setupInterceptors(){const l=this.getTransform();if(!l)return;const{requestInterceptors:n,requestInterceptorsCatch:d,responseInterceptors:i,responseInterceptorsCatch:u}=l,f=new Vo;this.instance.interceptors.request.use(r=>{const{headers:{ignoreRepeatRequest:c}}=r;return(c??this.options.requestOptions?.ignoreRepeatRequest)||f.addPending(r),n&&yt(n)&&(r=n(r,this.options)),r},void 0),d&&yt(d)&&this.instance.interceptors.request.use(void 0,d),this.instance.interceptors.response.use(r=>(r&&f.removePending(r.config),i&&yt(i)&&(r=i(r)),r),void 0),u&&yt(u)&&this.instance.interceptors.response.use(void 0,u)}supportFormData(l){const n=l.headers||this.options.headers;return(n?.["Content-Type"]||n?.["content-type"])!=="application/x-www-form-urlencoded;charset=UTF-8"||!Reflect.has(l,"data")||l.method?.toUpperCase()==="GET"?l:{...l,data:on.stringify(l.data,{arrayFormat:"brackets"})}}get(l,n){return this.request({...l,method:"GET"},n)}post(l,n){return this.request({...l,method:"POST"},n)}put(l,n){return this.request({...l,method:"PUT"},n)}delete(l,n){return this.request({...l,method:"DELETE"},n)}patch(l,n){return this.request({...l,method:"PATCH"},n)}async request(l,n){let d=rn(l);const i=this.getTransform(),{requestOptions:u}=this.options,f={...u,...n},{beforeRequestHook:r,requestCatchHook:c,transformRequestHook:_}=i||{};return r&&yt(r)&&(d=r(d,f)),d.requestOptions=f,d=this.supportFormData(d),new Promise((y,M)=>{this.instance.request(l.retryCount?l:d).then($=>{if(_&&yt(_)){try{const V=_($,f);y(V)}catch(V){M(V||new Error("请求错误!"))}return}y($)}).catch($=>{if(c&&yt(c)){M(c($,f));return}oa.isAxiosError($),M($)})})}}const Lo="YYYY-MM-DD HH:mm:ss";function cs(s,l=!1){if(!s)return l?"":{};const n=new Date().getTime();return l?`?_t=${n}`:{_t:n}}function Pa(s){if(Object.prototype.toString.call(s)==="[object Object]")for(const l in s){if(s[l]&&s[l]._isAMomentObject&&(s[l]=s[l].format(Lo)),At(l)){const n=s[l];if(n)try{s[l]=At(n)?n.trim():n}catch(d){throw new Error(d)}}Ks(s[l])&&Pa(s[l])}}function Uo(s,l){let n="";for(const d in l)n+=`${d}=${encodeURIComponent(l[d])}&`;return n=n.replace(/&$/,""),/\?$/.test(s)?s+n:s.replace(/\/?$/,"?")+n}const Bo={transformRequestHook:(s,l)=>{const{isTransformResponse:n,isReturnNativeResponse:d}=l,i=s.config.method?.toLowerCase();if(s.status===204||i==="put"||i==="patch"||d)return s;if(!n)return s.data;const{data:u}=s;if(!u)throw new Error("请求接口错误");if(u&&Reflect.has(u,"code")&&Reflect.has(u,"message")){const{code:r,message:c}=u;if(r===200)return u.data;throw new Error(c||`请求接口错误, 错误码: ${r}`)}else return u},beforeRequestHook:(s,l)=>{const{apiUrl:n,isJoinPrefix:d,urlPrefix:i,joinParamsToUrl:u,formatDate:f,joinTime:r=!0}=l;d&&i&&At(i)&&(s.url=`${i}${s.url}`),n&&At(n)&&!s.baseURL&&(s.url=`${n}${s.url}`);const c=s.params||{},_=s.data||!1;return f&&_&&!At(_)&&Pa(_),s.method?.toUpperCase()==="GET"?At(c)?(s.url=`${s.url+c}${cs(r,!0)}`,s.params=void 0):s.params=Object.assign(c||{},cs(r,!1)):At(c)?(s.url+=c,s.params=void 0):(f&&Pa(c),Reflect.has(s,"data")&&s.data&&(Object.keys(s.data).length>0||_ instanceof FormData)?(s.data=_,s.params=c):(s.data=c,s.params=void 0),u&&(s.url=Uo(s.url,{...s.params,...s.data}))),s},requestInterceptors:(s,l)=>{const n=localStorage.getItem(Ut),d=localStorage.getItem(Bt);return d&&!/^(https?:)?\/\//.test(s.url||"")&&!s.baseURL&&(s.baseURL=d),n&&s?.requestOptions?.withToken!==!1&&(s.headers.hasAuthorization()||(s.headers["x-user-token"]=n)),s},responseInterceptors:s=>s,responseInterceptorsCatch:s=>{const{response:l}=s;if(l&&l.data){const d=l.data?.message;return d?Promise.reject(new Error(d)):Promise.reject(s)}return Promise.reject(s)}};function zo(s){return new Mo(un({authenticationScheme:"",timeout:10*1e3,withCredentials:!1,headers:{"Content-Type":"application/json;charset=UTF-8"},transform:Bo,requestOptions:{apiUrl:"",isJoinPrefix:!0,urlPrefix:"",isReturnNativeResponse:!1,isTransformResponse:!0,joinParamsToUrl:!1,formatDate:!0,joinTime:!1,ignoreRepeatRequest:!0,withToken:!0,retry:{count:3,delay:1e3}}},{}))}const Q=zo();function Po(){return Q.get({url:"/api/settings"})}function Ro(s){return Q.post({url:"/api/settings",data:s})}function Eo(s){return Q.post({url:"/api/settings/webpanel/style",data:s})}function To(){return Q.get({url:"/api/settings/webpanel/style"})}async function ea(){return await Q.post({url:"/api/files/upload/init"})}async function ta(s,l,n,d,i){const u=new FormData;return u.append("index",l.toString()),u.append("file",n),await Q.post({url:`/api/files/upload/chunk/${s}`,data:u,headers:{"Content-Type":"multipart/form-data"},timeout:300*1e3,onUploadProgress:d,signal:i})}async function aa(s,l){return await Q.post({url:`/api/files/upload/finish/${s}`,data:{totalChunks:l},timeout:120*1e3})}async function Ct(s){return await Q.post({url:`/api/files/upload/delete/${s}`})}async function Fo(s){return await Q.get({url:`/api/files/upload/inspect/${s}`,timeout:60*1e3})}async function Do(s,l=""){return await Q.get({url:`/api/files/instance/${s}/lists`,params:{path:l}})}async function ya(s,l){return await Q.get({url:`/api/files/instance/${s}/content`,params:{path:l}})}function Ja(s,l,n){return Q.post({url:`/api/files/instance/${s}/content`,data:{path:l,content:n}})}function Oo(s,l,n){return Q.post({url:`/api/files/instance/${s}/directory`,data:{path:l,name:n}})}function jo(s,l,n){return Q.post({url:`/api/files/instance/${s}/rename`,data:{oldPath:l,newPath:n}})}function Ko(s,l){return Q.post({url:`/api/files/instance/${s}/delete`,data:{paths:l}})}function No(s,l,n,d){return Q.post({url:`/api/files/instance/${s}/upload`,data:{uploadId:l,fileName:n,currentPath:d}})}function qo(s,l){return Q.get({url:`/api/files/instance/${s}/download`,params:{path:l},responseType:"blob"})}function Go(s,l,n,d){return Q.post({url:`/api/files/instance/${s}/compress`,data:{sources:l,targetName:n,currentPath:d}})}function Ho(s){return Q.get({url:`/api/files/task/compress/${s}`})}function Jo(s,l,n,d="utf-8",i=!0){return Q.post({url:`/api/files/instance/${s}/decompress`,data:{fileName:l,currentPath:n,encoding:d,createSubFolder:i}})}function Wo(s){return Q.get({url:`/api/files/task/decompress/${s}`})}async function Xo(s,l,n){return await Q.post({url:`/api/files/instance/${s}/chmod`,data:{path:l,mode:n}})}async function Ra(s,l,n){return await Q.get({url:`/api/files/pm/instance/${s}/list?${n?"checkClient=true":""}`,params:{mode:l}})}async function Qo(s,l,n,d){return await Q.post({url:`/api/files/pm/instance/${s}/set`,data:{mode:l,action:n,targets:d}})}function Yo(s,l,n){return Q.post({url:`/api/files/instance/${s}/copy`,data:{sourcePaths:l,targetPath:n},timeout:120*1e3})}function Zo(s,l,n){return Q.post({url:`/api/files/instance/${s}/move`,data:{sourcePaths:l,targetPath:n},timeout:120*1e3})}function ei(s,l){return Q.post({url:"api/static/images/upload",data:{fileKey:s,fileName:l}})}const Dt=kt("webpanel",{state:()=>({settings:{webPanelStyleDarkBackgroundOpacity:1,webPanelStyleDarkComponentsOpacity:.4,webpPanelTerminalBlurDark:5,webPanelStyleLightBackground:"",webPanelStyleLightBackgroundOpacity:1,webPanelStyleLightComponentsOpacity:.6,webpPanelTerminalBlurLight:5,webPanelStyleDarkBackground:"",webPanelColorizeLogLevel:1},loading:!1,submitLoading:!1}),actions:{async fetchSettings(){this.loading=!0;try{const s=await To();this.settings=s}catch(s){console.error("获取面板样式失败",s)}finally{this.loading=!1}},async saveSettings(){this.submitLoading=!0;try{await Eo(this.settings),B.success("面板样式保存成功")}catch(s){B.error("保存失败: "+s.message)}finally{this.submitLoading=!1}},async uploadImage(s){if(!s)return B.error("文件对象无效"),null;if(!["image/png","image/jpeg","image/webp"].includes(s.type))return B.error("仅支持 PNG, JPG, WEBP 格式的图片"),null;if(!(s.size/1024/1024<10))return B.error("图片大小不能超过 10MB"),null;try{const{uploadId:d}=await ea();return await ta(d,1,s),await aa(d,1),await ei(d,s.name),B.success(`上传成功: ${s.name}`),s.name}catch(d){return B.error("上传失败: "+(d.message||"网络错误")),null}}},persist:{key:"webpanel-style-storage",paths:["settings"]}}),ti=se({__name:"index",setup(s){const l=Ze(),n=it(),d=Ee(),i=Dt(),u=Da(n),f=(y,M)=>y?y.startsWith("http")?y:`${d.baseUrl||window.location.origin}/api/static/images/${y}`:M,r=ee(()=>{const y=i.settings,M=f(y.webPanelStyleLightBackground,Ga),$=f(y.webPanelStyleDarkBackground,Ha);return{"--bg-img-light":`url('${M}')`,"--bg-img-dark":`url('${$}')`,"--bg-op-light":y.webPanelStyleLightBackgroundOpacity,"--bg-op-dark":y.webPanelStyleDarkBackgroundOpacity,"--comp-op-light":y.webPanelStyleLightComponentsOpacity,"--comp-op-dark":y.webPanelStyleDarkComponentsOpacity,"--term-blur-light":`${y.webpPanelTerminalBlurLight??5}px`,"--term-blur-dark":`${y.webpPanelTerminalBlurDark??5}px`}}),c=ee(()=>n.enableCustomTheme),_=ee(()=>[{"t-layout--with-sider":n.showSidebar}]);return Ce(()=>{i.fetchSettings()}),we(()=>l.path,()=>{document.querySelector(`.${ze}-layout`).scrollTo({top:0,behavior:"smooth"})}),(y,M)=>{const $=m("t-aside"),V=m("t-header"),h=m("t-content"),g=m("t-layout");return o(),C("div",{class:ke(["global-layout-bg",{"custom-theme-enabled":c.value}]),style:rt(r.value)},[k(u).layout.value==="side"?(o(),O(g,{key:"side",class:ke(_.value)},{default:a(()=>[e($,null,{default:a(()=>[e(us)]),_:1}),e(g,null,{default:a(()=>[e(V,null,{default:a(()=>[e(is)]),_:1}),e(h,null,{default:a(()=>[e(rs)]),_:1})]),_:1})]),_:1},8,["class"])):(o(),O(g,{key:"no-side"},{default:a(()=>[e(V,null,{default:a(()=>[e(is)]),_:1}),e(g,{class:ke(_.value)},{default:a(()=>[e(us),e(rs)]),_:1},8,["class"])]),_:1})),e(Na)],6)}}}),ct=ie(ti,[["__scopeId","data-v-f3c5347d"]]),ai=[{path:"/dashboard",redirect:"/dashboard/base",component:ct,name:"dashboard",meta:{title:"仪表盘",icon:"dashboard"},children:[{path:"base",name:"DashboardBaseIndex",component:()=>We(()=>Promise.resolve().then(()=>eu),void 0),meta:{title:"仪表盘",hidden:!0}}]},{path:"/instance",component:ct,name:"instance",meta:{title:"服务端管理",icon:"server"},children:[{path:"list",name:"InstanceList",component:()=>We(()=>Promise.resolve().then(()=>bu),void 0),meta:{title:"服务端列表",icon:"grid-view"}},{path:"create",name:"InstanceCreate",component:()=>We(()=>Promise.resolve().then(()=>Vm),void 0),meta:{title:"创建服务端",icon:"add"}},{path:"backup",name:"InstanceBackupManager",component:()=>We(()=>Promise.resolve().then(()=>Qm),void 0),meta:{title:"备份管理",icon:"backup"}}]},{path:"/frp",component:ct,name:"frp",meta:{title:"隧道管理",icon:"rocket"},children:[{path:"list",name:"FrpList",component:()=>We(()=>Promise.resolve().then(()=>Gp),void 0),meta:{title:"隧道列表",icon:"format-vertical-align-left"}},{path:"create",name:"FrpCreate",component:()=>We(()=>Promise.resolve().then(()=>ff),void 0),meta:{title:"创建隧道",icon:"add"}}]}],si=Object.freeze(Object.defineProperty({__proto__:null,default:ai},Symbol.toStringTag,{value:"Module"})),li=[{path:"/frp/console",component:ct,meta:{hidden:!0},children:[{path:":frpId",name:"FrpConsole",component:()=>We(()=>Promise.resolve().then(()=>ig),void 0),meta:{title:"隧道控制台",hidden:!0,activeMenu:"/frp/list"}}]},{path:"/instance/console",component:ct,meta:{hidden:!0},children:[{path:":serverId",name:"InstanceConsole",component:()=>We(()=>Promise.resolve().then(()=>E0),void 0),meta:{title:"服务器控制台",hidden:!0,activeMenu:"/instance/list"}}]},{path:"/instance/files",component:ct,meta:{hidden:!0},children:[{path:":serverFilesId",name:"InstanceFiles",component:()=>We(()=>Promise.resolve().then(()=>q2),void 0),meta:{title:"文件管理",hidden:!0,activeMenu:"/instance/list"}}]}],ni=Object.freeze(Object.defineProperty({__proto__:null,default:li},Symbol.toStringTag,{value:"Module"})),ms=()=>We(()=>Promise.resolve().then(()=>W2),void 0),oi=[{path:"/frame",name:"Frame",component:ct,redirect:"/frame/doc",meta:{icon:"earth",title:"链接"},children:[{path:"MSLX",name:"MSLX",component:ms,meta:{frameSrc:"https://mslx.mslmc.cn",frameBlank:!0,title:"MSLX 文档",icon:"book"}},{path:"MSLUser",name:"MSLUser",component:ms,meta:{frameSrc:"https://user.mslmc.net",frameBlank:!0,title:"MSL 用户中心",icon:"user-arrow-left"}}]}],ii=Object.freeze(Object.defineProperty({__proto__:null,default:oi},Symbol.toStringTag,{value:"Module"})),ri=[{path:"/users",component:ct,name:"usersBase",meta:{title:"用户管理",icon:"user"},children:[{path:"",name:"users",component:()=>We(()=>Promise.resolve().then(()=>pw),void 0),meta:{title:"用户管理",hidden:!0}}]},{path:"/settings",component:ct,name:"settingsBase",meta:{title:"设置",icon:"setting"},children:[{path:"",name:"settings",component:()=>We(()=>Promise.resolve().then(()=>Pw),void 0),meta:{title:"设置",hidden:!0}}]},{path:"/about",component:ct,name:"aboutBase",meta:{title:"关于面板",icon:"info-circle"},children:[{path:"",name:"about",component:()=>We(()=>Promise.resolve().then(()=>Sk),void 0),meta:{title:"关于面板",hidden:!0}}]}],ui=Object.freeze(Object.defineProperty({__proto__:null,default:ri},Symbol.toStringTag,{value:"Module"})),ps=Object.assign({"./modules/base.ts":si,"./modules/components.ts":ni,"./modules/iframe.ts":ii,"./modules/others.ts":ui}),Js=[];Object.keys(ps).forEach(s=>{const l=ps[s].default||{},n=Array.isArray(l)?[...l]:[l];Js.push(...n)});const Ea=[...Js],di=[{path:"/login",name:"login",component:()=>We(()=>Promise.resolve().then(()=>s3),void 0)},{path:"/oauth/callback",name:"oauth",component:()=>We(()=>Promise.resolve().then(()=>b3),void 0)},{path:"/",redirect:"/dashboard/base"},{path:"/404",name:"404",component:()=>We(()=>Promise.resolve().then(()=>S3),void 0)},{path:"/:w+",name:"404Page",redirect:"/404"}],Ws=[...di,...Ea],ci=()=>{const s=[];return Ws.forEach(l=>{l.meta&&l.meta.expanded&&s.push(l.path),l.children&&l.children.length>0&&l.children.filter(n=>n.meta&&n.meta.expanded).forEach(n=>{s.push(l.path),s.push(`${l.path}/${n.path}`)})}),dn(s)},ma=(s=3)=>{const l=mt.currentRoute.value;return l.path?l.meta?.activeMenu?l.meta.activeMenu:l.path.split("/").filter((n,d)=>d<=s&&d>0).map(n=>`/${n}`).join(""):""};function Ie(s){s.includes("http")?window.open(s):mt.replace(s)}const mt=rl({history:ul(),routes:Ws,scrollBehavior(){return{el:"#app",top:0,behavior:"smooth"}}});function mi(s,l){const n=[],d=[];return s.forEach(i=>{const u=[];i.children?.forEach(f=>{const r=f.meta?.roleCode||f.name;l.indexOf(r)!==-1?u.push(f):d.push(f)}),u.length>0&&(i.children=u,n.push(i))}),{accessedRouters:n,removeRoutes:d}}const Jt=kt("permission",{state:()=>({whiteListRouters:["/login","/oauth/callback"],routers:[],removeRoutes:[],dynamicRoutesAdded:[]}),actions:{async initRoutes(s){this.clearRoutes();let l=[],n=[];if(s.includes("all"))l=Ea;else{const i=mi(Ea,s);l=i.accessedRouters,n=i.removeRoutes}const d=[];l.forEach(i=>{mt.addRoute(i),i.name&&d.push(i.name)}),this.routers=l,this.removeRoutes=n,this.dynamicRoutesAdded=d},async clearRoutes(){this.dynamicRoutesAdded.forEach(l=>{mt.hasRoute(l)&&mt.removeRoute(l)}),this.routers=[],this.removeRoutes=[],this.dynamicRoutesAdded=[]}}});function pi(){return Jt(ba)}const vs="remembered_url",fs="remembered_username",Sa={name:"",username:"",avatar:"",id:"",version:"",systemInfo:{netVersion:"",osType:"",osVersion:"",osArchitecture:"",hostname:"",docker:!1},targetFrontendVersion:{desktop:"",panel:""},roles:[]},Ee=kt("user",{state:()=>({token:localStorage.getItem(Ut)||"",baseUrl:localStorage.getItem(Bt)||window.location.origin,userInfo:{...Sa}}),getters:{roles:s=>s.userInfo?.roles||[]},actions:{async checkConnection(s){let l=s;s&&!/^(https?:)?\/\//.test(s)&&(l=`http://${s}`);try{return await Q.get({url:"/api/ping",baseURL:l||void 0,timeout:3e3}),!0}catch{return!1}},async login(s){const{url:l,username:n,password:d,checked:i}=s;let u=l;u&&!/^(https?:)?\/\//.test(u)&&(u=`http://${u}`);const f=u||"";try{const r=await Q.post({url:"/api/auth/login",baseURL:f,data:{username:n,password:d}});this.token=r.token,this.baseUrl=f,localStorage.setItem(Ut,r.token),localStorage.setItem(Bt,f),i?(localStorage.setItem(vs,l||""),localStorage.setItem(fs,n)):(localStorage.removeItem(vs),localStorage.removeItem(fs)),await this.getUserInfo()}catch(r){throw console.error("Login failed:",r),r}},async loginByOAuth(s){try{this.token=s.token,localStorage.setItem(Ut,s.token),this.baseUrl||(this.baseUrl=window.location.origin,localStorage.setItem(Bt,this.baseUrl)),await this.getUserInfo()}catch(l){throw console.error("OAuth登录失败:",l),l}},async getUserInfo(){if(this.token)try{const s=await Q.get({url:"/api/status"});this.userInfo={...Sa,...s,name:s.user||s.username,roles:["all"]},await Jt().initRoutes(this.userInfo.roles)}catch(s){console.error("Get user info failed:",s),await this.logout(),Ie("/login")}},async logout(){await Jt().clearRoutes(),localStorage.removeItem(Ut),localStorage.removeItem(Bt),this.token="",this.baseUrl="",this.userInfo={...Sa}},async removeToken(){this.token=""}},persist:{afterRestore:s=>{s.store.token&&s.store.getUserInfo()}}});function Xs(){return Ee(ba)}const vi={...Ka,showSettingPanel:!1,colorList:Ln,chartColors:Hs,systemTheme:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"},it=kt("setting",{state:()=>vi,getters:{showSidebar:s=>s.layout!=="top",showSidebarLogo:s=>s.layout==="side",showHeaderLogo:s=>s.layout!=="side",displayMode:s=>s.mode==="auto"?s.systemTheme:s.mode},actions:{async changeMode(s){let l=s;s==="auto"&&(l=this.systemTheme);const n=l==="dark";document.documentElement.setAttribute("theme-mode",n?"dark":""),this.chartColors=n?Un:Hs},setSystemTheme(s){this.systemTheme=s,this.mode==="auto"&&this.changeMode("auto")},changeBrandTheme(s){document.documentElement.setAttribute("theme-color",s)},addColor(s){this.colorList={...this.colorList,...s}},updateConfig(s){for(const l in s)s[l]!==void 0&&(this[l]=s[l]),l==="mode"&&this.changeMode(s[l]),l==="brandTheme"&&this.changeBrandTheme(s[l])}},persist:{paths:[...cn(Ka),"colorList","chartColors"]}});async function fi(){return Q.get({url:"/api/update/info"})}async function gi(){return Q.get({url:"/api/update/download"})}async function _i(){return Q.post({url:"/api/update"})}const Wa=kt("update",()=>{const s=x(!1),l=x(null),n=x(null),d=x(!1);return{showUpdateModal:s,updateInfo:l,downloadInfo:n,loading:d,checkAppUpdate:async(f=!1)=>{if(!d.value){d.value=!0;try{const c=await fi();if(c&&c.needUpdate){if(!f&&localStorage.getItem("mslx-skip-version")===c.latestVersion){console.log(`[Update] 用户已跳过版本 ${c.latestVersion}`);return}l.value=c;try{const _=await gi();n.value=_}catch(_){console.error("获取下载链接失败",_),n.value={web:"",file:""}}s.value=!0,f&&B.success("发现新版本！")}else f&&B.success("当前已是最新版本")}catch(r){console.error("[Update] 检查更新失败:",r),f&&B.error("检查更新失败，请检查网络日志")}finally{d.value=!1}}},handleSkipVersion:()=>{l.value?.latestVersion&&(localStorage.setItem("mslx-skip-version",l.value.latestVersion),B.success("已跳过该版本，下次将不再提醒"),s.value=!1)}}}),ba=dl();ba.use(cl());qt.configure({showSpinner:!1});mt.beforeEach(async(s,l,n)=>{window.document.title=s.meta.title?`${s.meta.title} | MSLX 控制台`:"MSLX 控制台",qt.start();const d=Xs(),i=pi(),{whiteListRouters:u}=i,{token:f}=d;if(f){if(s.path==="/login"||s.path==="/oauth/callback"){n();return}const{roles:r}=d;if(r&&r.length>0)n();else try{await d.getUserInfo();const{roles:c}=d;await i.initRoutes(c),mt.hasRoute(s.name)?n():n("/")}catch(c){B.error(c),n({path:"/login",query:{redirect:encodeURIComponent(s.fullPath)}}),qt.done()}}else u.indexOf(s.path)!==-1?n():n({path:"/login",query:{redirect:encodeURIComponent(s.fullPath)}}),qt.done()});mt.afterEach(s=>{s.path==="/login"&&Xs().logout(),qt.done()});const hi={class:"modal-header"},yi={class:"header-content"},bi={class:"title-row"},wi={class:"version-row"},ki={class:"modal-body"},$i={key:0,class:"status-container success"},xi={key:1,class:"status-container docker-warn"},Ai={key:2,class:"status-container server-running-warn"},Ci={class:"warn-icon-wrapper"},Si={key:3,class:"status-container permission-wait"},Ii={key:4,class:"status-container updating"},Vi={key:0,class:"error-box"},Mi={class:"progress-info"},Li={class:"speed"},Ui={key:5},Bi={style:{margin:"4px 0 0 0","line-height":"1.6"}},zi={class:"log-scroll-area"},Pi={class:"log-text"},Ri={key:0,class:"modal-footer"},Ei={class:"primary-actions"},Ti={class:"secondary-grid"},Fi={key:0,class:"sub-actions"},Di={key:1,class:"modal-footer"},Oi={key:2,class:"modal-footer"},ji={key:3,class:"modal-footer"},Ki={class:"primary-actions"},Ni=se({__name:"UpdateModal",props:{visible:{type:Boolean},updateInfo:{},downloadInfo:{}},emits:["close","skip","success"],setup(s,{emit:l}){const n=s,d=l,i=Ee(),u=x(!1),f=x(0),r=x("0 KB/s"),c=x("准备中..."),_=x(!1),y=x(!1),M=x(!1),$=x("");let V=null;const h=ee(()=>n.updateInfo?.status==="beta"),g=ee(()=>{const E=i.userInfo?.systemInfo?.osType||"";return E.includes("macOS")||E.includes("OSX")}),z=ee(()=>(i.userInfo?.systemInfo?.osType||"").toLowerCase().includes("linux")),U=E=>{E&&window.open(E,"_blank")},p=()=>{d("close"),Ie("/instance/list")},S=()=>{if(u.value&&!M.value){B.warning("正在更新中，请勿关闭窗口");return}T(),d("close")},b=()=>{d("skip")},R=()=>{window.location.reload()},T=async()=>{if(V){try{await V.stop()}catch(E){console.error("Stop Hub Error:",E)}V=null}},P=async()=>{await T();const{baseUrl:E,token:w}=i,A=new URL("/api/hubs/daemonUpdate",E||window.location.origin);w&&A.searchParams.append("x-user-token",w),V=new Mt().withUrl(A.toString(),{withCredentials:!1}).configureLogging(Et.Warning).withAutomaticReconnect([0,2e3,5e3,1e4]).build(),V.on("UpdateProgress",L=>{f.value=L.progress||0,r.value=L.speed||"",L.stage==="permission_check"?c.value="等待服务端确认权限...":L.stage==="restarting"?(console.log("[Update] 收到重启信号，准备轮询..."),c.value="服务正在重启...",T(),setTimeout(()=>{N()},3e3)):c.value=L.status||"正在处理..."}),V.on("UpdateFailed",L=>{u.value=!1,$.value=L||"更新失败",T()}),V.onclose(L=>{V&&(u.value&&f.value>=100?setTimeout(()=>{N()},6e3):L&&(u.value=!1,$.value=`连接断开: ${L.message}`))});try{await V.start()}catch(L){$.value=`连接更新服务失败: ${L.message}`,u.value=!1}},G=async()=>{if(!u.value){u.value=!0,_.value=!1,y.value=!1,$.value="",f.value=0,M.value=!1,await P();try{await _i()}catch(E){u.value=!1,T();const w=E.message||"";w.includes("Docker")||w.includes("容器")?_.value=!0:w.includes("运行")&&(w.includes("服务器")||w.includes("实例"))?y.value=!0:$.value=w||"请求更新失败，请检查网络或日志"}}},N=async()=>{c.value="服务正在重启，请稍候...";const E=async()=>{try{return await Q.get({url:"/api/ping",timeout:3e3}),!0}catch{return!1}},w=60;let A=0;const L=setInterval(async()=>{A++,await E()?(clearInterval(L),u.value=!1,M.value=!0,c.value="更新成功！",T(),setTimeout(()=>d("success"),1e3)):A>w&&(clearInterval(L),u.value=!1,$.value="服务重启超时，请手动刷新页面检查状态。",T())},2e3)};return Qe(()=>{T()}),(E,w)=>{const A=m("t-tag"),L=m("t-button"),H=m("t-link"),J=m("t-alert"),X=m("t-progress"),q=m("t-popconfirm"),_e=m("t-dialog");return o(),O(_e,{visible:n.visible,header:!1,footer:!1,"close-on-overlay-click":!1,"close-btn":!1,width:"500px",class:"update-modal","destroy-on-close":"",onClose:S},{default:a(()=>[t("div",hi,[t("div",yi,[t("div",bi,[t("h3",null,I(M.value?"更新完成":"发现新版本"),1),h.value?(o(),O(A,{key:0,theme:"warning",variant:"light"},{default:a(()=>[...w[2]||(w[2]=[v("Beta",-1)])]),_:1})):(o(),O(A,{key:1,theme:"success",variant:"light"},{default:a(()=>[...w[3]||(w[3]=[v("Release",-1)])]),_:1}))]),t("div",wi,[e(A,{variant:"outline",size:"small"},{default:a(()=>[v(I(s.updateInfo?.currentVersion),1)]),_:1}),w[4]||(w[4]=t("span",{class:"arrow"},"→",-1)),e(A,{theme:"primary",variant:"light-outline",size:"small"},{default:a(()=>[v(I(s.updateInfo?.latestVersion),1)]),_:1})])]),u.value?K("",!0):(o(),O(L,{key:0,variant:"text",shape:"circle",onClick:S},{icon:a(()=>[e(k(Oa))]),_:1}))]),t("div",ki,[M.value?(o(),C("div",$i,[e(k(St),{size:"48px",class:"success-icon"}),w[5]||(w[5]=t("p",null,[t("b",null,"MSLX守护进程端"),v("已成功更新至最新版本")],-1)),w[6]||(w[6]=t("p",{class:"sub-text"},"请刷新页面以加载最新功能",-1))])):_.value?(o(),C("div",xi,[e(J,{theme:"warning",title:"检测到 Docker 环境"},{message:a(()=>[w[8]||(w[8]=v(" 当前程序运行在 ",-1)),w[9]||(w[9]=t("b",null,"Docker 容器",-1)),w[10]||(w[10]=v(" 内，不支持热更新。",-1)),w[11]||(w[11]=t("br",null,null,-1)),w[12]||(w[12]=v("请使用以下命令或者参照 ",-1)),w[13]||(w[13]=t("b",null,"官方文档",-1)),w[14]||(w[14]=v(" 更新。",-1)),w[15]||(w[15]=t("br",null,null,-1)),e(H,{theme:"primary",href:"https://mslx.mslmc.cn/docs/install/docker/",target:"_blank",style:{"vertical-align":"baseline"}},{default:a(()=>[...w[7]||(w[7]=[t("b",null,"Docker安装/更新文档",-1)])]),_:1})]),_:1}),w[16]||(w[16]=t("div",{class:"code-block"},"sudo docker compose pull && docker compose up -d # 指令仅适用于Docker Compose安装方式。",-1))])):y.value?(o(),C("div",Ai,[t("div",Ci,[e(k(va),{size:"48px",style:{color:"var(--td-warning-color)"}})]),w[17]||(w[17]=t("p",{class:"warn-title"},"无法开始更新",-1)),w[18]||(w[18]=t("p",{class:"warn-desc"},[v(" 检测到当前有服务器实例正在运行。 "),t("br"),v("为了防止数据丢失，请先停止所有实例。 ")],-1))])):c.value.includes("等待服务端确认权限")?(o(),C("div",Si,[...w[19]||(w[19]=[t("p",{class:"warn-title"},"请在服务端确认权限",-1),t("p",{class:"warn-desc"},[v(" macOS 系统已弹出提示： "),t("br"),t("strong",null,"“MSLX-Daemon 想要控制应用程序 终端.app”"),v(),t("br"),v("请务必点击 "),t("strong",null,"【好/OK】"),v(" 以继续更新。 ")],-1)])])):u.value||$.value?(o(),C("div",Ii,[$.value?(o(),C("div",Vi,[e(k(As),{style:{color:"var(--td-error-color)"}}),t("span",null,I($.value),1)])):(o(),C(de,{key:1},[t("div",Mi,[t("span",null,I(c.value),1),t("span",Li,I(r.value),1)]),e(X,{theme:"plump",percentage:f.value,status:f.value>=100?"active":"success"},null,8,["percentage","status"])],64))])):(o(),C("div",Ui,[g.value?(o(),O(J,{key:0,theme:"warning",variant:"outline",class:"macos-alert"},{message:a(()=>[...w[20]||(w[20]=[t("strong",null,"macOS 用户请注意：",-1),t("br",null,null,-1),v("受 Apple 安全机制 (Gatekeeper) 限制，更新重启后应用可能无法自动启动。如遇此情况，请前往「系统设置 > 隐私与安全性」手动允许应用运行。 ",-1)])]),_:1})):K("",!0),z.value?(o(),O(J,{key:1,theme:"info",variant:"outline",class:"macos-alert"},{message:a(()=>[w[26]||(w[26]=t("strong",null,"Linux 用户提示：",-1)),t("ul",Bi,[t("li",null,[w[22]||(w[22]=v(" 如使用一键脚本部署，推荐优先参考 ",-1)),e(H,{theme:"primary",href:"https://mslx.mslmc.cn/docs/install/linux/",target:"_blank",style:{"vertical-align":"baseline"}},{default:a(()=>[...w[21]||(w[21]=[v(" 官方文档 ",-1)])]),_:1}),w[23]||(w[23]=v(" 使用脚本进行更新。 ",-1))]),w[24]||(w[24]=t("li",null,[v(" 若启用 "),t("strong",null,"Systemd"),v(" 托管，请确保服务名称为 "),t("code",null,"mslx"),v("，否则自动更新后可能无法自动重启。 ")],-1)),w[25]||(w[25]=t("li",null,"如果更新完成后仍然是旧版本，请尝试手动重启服务或手动更新！",-1))])]),_:1})):K("",!0),w[27]||(w[27]=t("div",{class:"log-title"},"更新内容：",-1)),t("div",zi,[t("div",Pi,I(s.updateInfo?.log||"暂无详细日志"),1)])]))]),!M.value&&!_.value&&!y.value?(o(),C("div",Ri,[t("div",Ei,[e(L,{theme:"primary",block:"",loading:u.value,disabled:u.value,onClick:G},{icon:a(()=>[e(k(Cs))]),default:a(()=>[v(" "+I(u.value?"正在更新...":"立即更新"),1)]),_:1},8,["loading","disabled"]),t("div",Ti,[e(L,{variant:"outline",disabled:!s.downloadInfo?.file||u.value,onClick:w[0]||(w[0]=De=>U(s.downloadInfo?.file||""))},{icon:a(()=>[e(k(fa))]),default:a(()=>[w[28]||(w[28]=v(" 下载新版本 ",-1))]),_:1},8,["disabled"]),e(L,{variant:"dashed",disabled:!s.downloadInfo?.web||u.value,onClick:w[1]||(w[1]=De=>U(s.downloadInfo?.web||""))},{icon:a(()=>[e(k(It))]),default:a(()=>[w[29]||(w[29]=v(" 前往下载页 ",-1))]),_:1},8,["disabled"])])]),u.value?K("",!0):(o(),C("div",Fi,[e(q,{content:"确定要跳过此版本吗？跳过后将不再提示该版本的更新。若跳过后需要更新也可以前往设置页面进行更新哦~",theme:"warning",onConfirm:b},{default:a(()=>[e(H,{theme:"default",hover:"color",size:"small"},{default:a(()=>[...w[30]||(w[30]=[v(" 跳过此版本 ",-1)])]),_:1})]),_:1})]))])):K("",!0),M.value?(o(),C("div",Di,[e(L,{theme:"primary",block:"",onClick:R},{default:a(()=>[...w[31]||(w[31]=[v("刷新页面",-1)])]),_:1})])):K("",!0),_.value?(o(),C("div",Oi,[e(L,{variant:"outline",block:"",onClick:S},{default:a(()=>[...w[32]||(w[32]=[v("我知道了",-1)])]),_:1})])):K("",!0),y.value?(o(),C("div",ji,[t("div",Ki,[e(L,{theme:"primary",block:"",onClick:p},{default:a(()=>[...w[33]||(w[33]=[v(" 前往实例列表管理 ",-1)])]),_:1}),e(L,{variant:"outline",style:{"margin-left":"0"},block:"",onClick:S},{default:a(()=>[...w[34]||(w[34]=[v(" 暂不更新 ",-1)])]),_:1})])])):K("",!0)]),_:1},8,["visible"])}}}),qi=ie(Ni,[["__scopeId","data-v-24684c9a"]]),Gi=se({__name:"App",setup(s){const l=it(),n=Wa(),d=ee(()=>l.displayMode),i=window.matchMedia("(prefers-color-scheme: dark)"),u=f=>{l.setSystemTheme(f.matches?"dark":"light")};return Ce(()=>{n.checkAppUpdate(!1),i.addEventListener("change",u),l.setSystemTheme(i.matches?"dark":"light")}),Qe(()=>{i.removeEventListener("change",u)}),(f,r)=>{const c=m("router-view");return o(),C(de,null,[e(c,{class:ke([d.value])},null,8,["class"]),e(qi,{visible:k(n).showUpdateModal,"update-info":k(n).updateInfo,"download-info":k(n).downloadInfo,onClose:r[0]||(r[0]=_=>k(n).showUpdateModal=!1),onSkip:k(n).handleSkipVersion},null,8,["visible","update-info","download-info","onSkip"])],64)}}}),Hi=ie(Gi,[["__scopeId","data-v-579b9e12"]]),wa=ml(Hi);wa.use(pl);wa.use(ba);wa.use(mt);wa.mount("#app");console.log(`
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣤⣤⣶⣶⣤⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣴⣾⠿⠛⠋⠉⠩⣄⠘⢿⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⣿⡏⠑⠒⠀⠀⣀⣀⠀⠀⢹⠈⣿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣿⣷⡀⢀⣰⣿⡿⣿⣧⠀⠀⢡⣾⣧⣀⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⣿⣿⣿⣿⣯⣴⣿⠿⣄⣤⣾⡿⠟⠛⠛⠿⢿⣶⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣴⣶⠿⠛⠋⠙⣿⣏⠀⠀⢻⣿⣡⣀⣀⠀⠀⠀⠀⢹⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣾⠿⠋⠁⠀⣀⣤⣶⣾⣿⣿⣤⣤⣾⣿⠉⠉⠙⠻⣿⠆⢀⣾⡿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⡿⠋⠁⠀⣀⣴⣿⠿⠛⠉⠀⢀⣿⡿⠿⠟⢿⣆⠀⢀⣴⣯⣴⣿⠟⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⣠⡾⠋⠀⠀⣠⣾⠟⠋⠀⠀⠀⠀⠀⣈⣿⣷⣤⣴⣾⣿⣈⣻⣿⡟⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⣰⡿⠁⠀⣠⡾⠋⠁⠀⠀⢀⣠⣴⠶⠞⠛⠛⠋⠉⠉⠉⠉⠙⠛⠻⠷⣦⣤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠰⣿⠁⠀⠀⣿⣄⣀⣠⣴⡾⠛⠉⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⣿⠿⣶⣄⠀⠀⠀⢀⣠⡄⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠈⠛⠶⠶⢾⣿⠿⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢷⣄⠉⠙⠻⠿⠟⢹⡇⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⠟⠁⠀⠀⠀⠀⠀⠀⠀⢀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣄⠀⠀⠀⠀⠘⣿⣿⣦⣀⠀⠲⣾⣁⠀⠀⠀⠀⠀⡀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⢀⡾⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢹⣦⡀⠀⠀⠀⣿⡿⣿⣿⣿⡆⠀⠉⠛⠛⠛⠛⢻⡏⠀
⠀⠀⠀⠀⠀⠀⠀⣠⡾⠁⠀⠀⠀⠀⠀⠀⠀⠀⢀⡄⣸⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⣿⠛⢦⡀⠰⣿⣿⣿⣽⣿⡇⠀⠀⠀⠀⠀⢠⡿⠀⠀
⠀⠀⠀⠀⣀⣤⡾⢻⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠀⡏⠙⣷⡀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡇⠰⣽⣶⣄⠉⠻⣿⣿⣧⠀⠀⢀⣤⣾⠟⠁⠀⠀
⢰⣶⡾⠛⠋⠉⠀⠀⠀⠀⠀⢀⡀⠀⠀⠀⠀⠀⢸⣸⡇⠀⣨⣿⣾⡋⠀⠀⠀⠀⢀⠀⠀⣿⡀⠀⠈⠛⢷⣄⠈⠛⣿⡆⠀⠘⣿⡀⠀⠀⠀⠀
⠀⠙⠿⣦⣀⠀⠀⠀⠀⠀⠀⡾⠀⠀⠀⠀⠀⠀⣿⣿⠀⠀⠋⠀⠙⢿⣦⣀⠀⠀⠘⣷⣄⣹⣧⠀⠀⠀⠈⢻⣦⠀⠈⠋⠀⠀⠘⣧⠀⠀⠀⠀
⠀⠀⠀⠈⠛⠿⢶⡶⠃⠀⣰⠃⠀⠀⠀⠀⠀⢠⣿⠃⠀⠀⠀⠀⠀⠀⠉⠻⢷⣦⣤⣘⣿⡛⠛⠀⢀⣴⣶⣦⡹⣷⡀⠀⠀⠀⠀⠸⣧⠀⠀⠀
⠀⠀⠀⠀⠀⢠⡿⠃⠀⢀⡟⠀⠀⠀⠀⠀⠀⣼⣿⠀⠀⢀⣴⣿⣿⣷⡄⠀⠀⠈⠉⠉⠉⠉⠀⠀⢸⣿⣿⣿⣷⠻⣧⠀⠀⠀⠀⠀⢿⡆⠀⠀
⠀⠀⠀⠀⢰⣿⠁⠀⠀⢸⠁⠀⠀⠀⠀⠀⠈⠋⣿⠀⠀⠸⣿⣿⣿⣿⡷⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠛⠿⠟⠃⠀⢻⣧⠀⠀⠀⠀⠸⣧⠀⠀
⠀⠀⠀⠀⣿⡇⠀⠀⠀⣿⠀⠀⠀⠀⠀⠀⠀⠀⣿⠀⠀⠀⠉⠻⠿⠋⠀⠀⢠⡀⠀⠀⣀⣀⣀⣸⠇⠀⠀⠀⠀⠀⠈⢿⣧⠀⠀⠀⠀⣿⡀⠀
⠀⠀⠀⢰⣿⠁⠀⠀⢰⡏⠀⠀⠀⠀⠀⠀⠀⠀⢿⡀⠀⠀⠀⠀⠀⣸⠀⠀⠈⠛⠒⠛⠉⠈⠉⠀⠀⠀⠀⠀⠀⠀⠀⢸⡟⠀⠀⠀⠀⢸⡇⠀
⠀⠀⠀⢸⣿⠀⠀⠀⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⢸⡇⠀⠀⠀⠀⠚⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣿⠁⠀⠀⠀⠀⢸⣿⠀
⠀⠀⠀⢸⣿⠀⠀⠀⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⠘⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣀⣀⣀⣤⣶⡿⠋⣿⠀⠀⠀⠀⠀⠀⣿⠀
⠀⠀⠀⠘⣿⡄⠀⠀⢸⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀⢿⣧⣄⣀⣀⣀⣠⣤⣶⣶⣾⣿⣿⣿⣿⠿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠀⠀⣠⠀⠀⢠⣿⡄
⠀⠀⠀⠀⢻⣧⠀⠀⠸⣿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠈⣿⣿⣿⣟⠛⢻⡟⢻⡉⠉⣫⣀⠀⠀⠀⠉⠉⠛⠙⠿⣷⣿⡿⠁⢀⣰⡟⠀⠀⢸⣿⠀
⠀⠀⠀⠀⠈⢻⣧⡀⠀⠹⣷⡀⠀⠀⠀⠀⢠⠀⠀⠀⠘⣿⣿⣿⢻⡿⠀⠈⠷⠟⠁⠘⢾⣿⣶⣤⣶⣾⡇⠀⣿⣿⣤⣶⣿⣿⠃⠀⠀⣾⡟⠀
⠀⠀⠀⠀⠀⠈⠻⣷⣄⡀⠹⣷⣄⠀⠀⠀⢸⣷⣤⡀⠀⠈⢻⣿⣯⣤⠀⠀⣠⡀⠀⢀⣼⣿⣿⣿⣿⣟⠁⠐⠿⣿⣿⣿⣿⠋⠀⢀⣾⠟⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠈⠙⠿⣷⣮⣽⣷⣶⣤⣤⣿⣿⣿⣷⣶⣦⣭⣿⣿⣧⣠⠵⢯⡆⠚⣯⢿⠋⠛⠛⢫⣀⣠⣾⣿⢿⣿⣥⣤⠶⠛⠁⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠉⠉⢁⣾⣿⣿⣿⠿⠿⠿⠿⠻⢿⣿⣿⣷⣦⣤⣤⣀⣤⣤⣄⣶⣿⣿⡿⠟⠉⠀⠀⢻⡄⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣴⣿⣿⣿⣿⣿⡇⠀⠀⣀⡀⠈⢿⣧⠀⠉⠙⠛⠛⠛⠛⠛⠛⠉⠁⠀⠀⠀⠀⠀⠀⢿⡄⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣴⣿⣿⡏⠛⠉⢻⣿⣿⣿⣾⣿⣿⠀⢸⣿⠀⠀⠀⠀⠀⠙⠓⠢⠀⠀⠀⠀⠀⠸⠀⠀⠀⠘⣿⡄⠀⠀⠀⠀⠀`);console.log("人生得意须尽吃，莫使金箸空对月。 —— 派蒙");const Ji={class:"welcome-header"},Wi={class:"avatar-section"},Xi=["src"],Qi={class:"welcome-info"},Yi={class:"welcome-text"},Zi={class:"hitokoto-text"},er=se({__name:"Banner",setup(s){const l=Ee(),n=x("");async function d(){const i=`Every little creature in the world has their own piece of paradise.
Plants take root in the boundless earth, and their leaves grow toward the stars.`;try{const u=await Q.get({url:"/?c=a&c=b&c=c&c=d",baseURL:"https://v1.hitokoto.cn"});u&&u.hitokoto?n.value=`${u.hitokoto} —— 《${u.from}》${u.from_who?` (${u.from_who})`:""}`:n.value=i}catch(u){n.value=i,console.error("获取一言(Hitokoto)失败:",u)}}return Ce(()=>{d()}),(i,u)=>(o(),O(k(ja),{shadow:"",bordered:!1,class:"welcome-card"},{default:a(()=>[t("div",Ji,[t("div",Wi,[t("img",{src:k(l).userInfo.avatar,alt:"头像",class:"user-avatar"},null,8,Xi)]),t("div",Qi,[t("h3",Yi,[e(k(dt),{name:"sunny",class:"welcome-icon"}),v(" 你好, "+I(k(l).userInfo.name),1)]),t("p",Zi,I(n.value),1)])])]),_:1}))}}),tr=ie(er,[["__scopeId","data-v-bfba57a3"]]),ar=Ee();async function Xa(s){return await Q.post({url:"/api/instance/createServer",data:s})}async function sr(s,l=!1){return await Q.post({url:"/api/instance/delete",data:{id:s,deleteFiles:l}})}async function lr(){return await Q.get({url:"/api/instance/list"})}async function Lt(s,l){return await Q.post({url:"/api/instance/action",data:{id:s,action:l},timeout:60*1e3})}async function Qs(s){return await Q.get({url:"/api/instance/info",params:{id:s}})}async function nr(s){return await Q.get({url:`/api/instance/settings/general/${s}`})}async function or(s){return await Q.post({url:`/api/instance/settings/general/${s.id}`,data:s})}async function ir(s){return await Q.get({url:`/api/instance/backups/${s}`})}async function rr(){return await Q.get({url:"/api/instance/backups/all"})}async function Ta(s,l){return await Q.post({url:"/api/instance/backups/delete",data:{id:s,fileName:l}})}function Fa(s,l){const{baseUrl:n,token:d}=ar;return`${n||window.location.origin}/api/instance/backups/download?id=${s}&fileName=${encodeURIComponent(l)}&x-user-token=${d}`}async function Ys(s){return await Q.get({url:`/api/instance/players/online/${s}`})}const sa=kt("instanceList",()=>{const s=x([]),l=x(0),n=x(0);async function d(){try{s.value=await lr(),l.value=s.value.length,n.value=s.value.filter(i=>i.status).length}catch(i){B.error("获取实例列表失败:"+i.message)}}return{instanceList:s,refreshInstanceList:d,totalInstanceCount:l,onlineInstanceCount:n}}),ur={class:"info-grid"},dr={class:"info-item"},cr={class:"info-label"},mr={class:"info-value"},pr={class:"info-item"},vr={class:"info-label"},fr={class:"info-value"},gr={class:"info-item"},_r={class:"info-label"},hr={class:"info-value truncate-value"},yr={class:"info-item"},br={class:"info-label"},wr={class:"info-value truncate-value"},kr={class:"info-item"},$r={class:"info-label"},xr={class:"info-value truncate-value"},Ar={class:"info-item"},Cr={class:"info-label"},Sr={class:"info-value"},Ir={class:"info-item"},Vr={class:"info-label"},Mr={class:"info-value truncate-value"},Lr={class:"info-item"},Ur={class:"info-label"},Br={class:"info-value"},zr=se({__name:"InfoCard",setup(s){const l=Ee(),n=sa();return Ce(()=>{n.refreshInstanceList()}),(d,i)=>(o(),O(k(ja),{shadow:"",bordered:!1,class:"system-info-card"},{default:a(()=>[t("div",ur,[t("div",dr,[t("span",cr,[e(k(dt),{name:"server"}),i[0]||(i[0]=t("span",null,"在线实例：",-1))]),t("span",mr,I(k(n).onlineInstanceCount)+" / "+I(k(n).totalInstanceCount),1)]),t("div",pr,[t("span",vr,[e(k(dt),{name:"logo-codepen"}),i[1]||(i[1]=t("span",null,"NET环境：",-1))]),t("span",fr,I(k(l).userInfo.systemInfo.netVersion),1)]),t("div",gr,[t("span",_r,[e(k(dt),{name:"dashboard"}),i[2]||(i[2]=t("span",null,"面板版本：",-1))]),e(k(Ca),{content:k(Kt).version,"max-width":"400px"},{default:a(()=>[t("span",hr," v"+I(k(Kt).version),1)]),_:1},8,["content"])]),t("div",yr,[t("span",br,[e(k(dt),{name:"cloud"}),i[3]||(i[3]=t("span",null,"节点版本：",-1))]),e(k(Ca),{content:`v${k(l).userInfo.version}`,"max-width":"400px"},{default:a(()=>[t("span",wr," v"+I(k(l).userInfo.version),1)]),_:1},8,["content"])]),t("div",kr,[t("span",$r,[e(k(dt),{name:"desktop"}),i[4]||(i[4]=t("span",null,"主机名：",-1))]),t("span",xr,I(k(l).userInfo.systemInfo.hostname),1)]),t("div",Ar,[t("span",Cr,[e(k(dt),{name:"system-code"}),i[5]||(i[5]=t("span",null,"系统类型：",-1))]),t("span",Sr,I(k(l).userInfo.systemInfo.osType)+" ("+I(k(l).userInfo.systemInfo.osArchitecture)+")",1)]),t("div",Ir,[t("span",Vr,[e(k(dt),{name:"system-setting"}),i[6]||(i[6]=t("span",null,"系统版本：",-1))]),e(k(Ca),{content:k(l).userInfo.systemInfo.osVersion,"max-width":"400px"},{default:a(()=>[t("span",Mr,I(k(l).userInfo.systemInfo.osVersion),1)]),_:1},8,["content"])]),t("div",Lr,[t("span",Ur,[e(k(dt),{name:"check-circle"}),i[7]||(i[7]=t("span",null,"版本匹配：",-1))]),t("span",Br,[e(k(vl),{theme:k(Kt).version.startsWith(k(l).userInfo.targetFrontendVersion.panel)?"success":"danger",variant:"light"},{default:a(()=>[v(I(k(Kt).version.startsWith(k(l).userInfo.targetFrontendVersion.panel)?"正确匹配":"请更新"),1)]),_:1},8,["theme"])])])])]),_:1}))}}),Pr=ie(zr,[["__scopeId","data-v-00dad172"]]),Rr={class:"monitor-dashboard"},Er={class:"card-content"},Tr={class:"info-section"},Fr={class:"value-group"},Dr={class:"value"},Or={class:"card-content"},jr={class:"info-section"},Kr={class:"value-group"},Nr={class:"value"},qr={class:"sub-text"},Gr=30,Hr=se({__name:"SystemStatus",setup(s){const l=Ee(),n=x(null),d=x(!1),i=x(null),u=x(null);let f=null,r=null;const c=Xe({cpu:0,memUsage:0,memUsed:0,memTotal:0}),_=[],y=[],M=[],$=U=>getComputedStyle(document.documentElement).getPropertyValue(U).trim()||"#999999",V=(U,p,S)=>({grid:{top:10,right:10,bottom:0,left:0,containLabel:!1},tooltip:{trigger:"axis",backgroundColor:"var(--td-bg-color-container)",borderColor:"var(--td-component-border)",textStyle:{color:"var(--td-text-color-primary)"},formatter:b=>{const R=b[0];return`${R.name}<br/><span style="color:${U}">●</span> ${p}: <b>${R.value}%</b>`}},xAxis:{type:"category",boundaryGap:!1,data:_,show:!1},yAxis:{type:"value",max:100,min:0,show:!1},series:[{name:p,type:"line",smooth:!0,showSymbol:!1,lineStyle:{width:2,color:U},areaStyle:{opacity:.2,color:new Gs(0,0,0,1,[{offset:0,color:U},{offset:1,color:"transparent"}])},data:S}]}),h=()=>{const U=$("--td-brand-color"),p=$("--td-success-color");i.value&&(f=ca(i.value),f.setOption(V(U,"CPU",[]))),u.value&&(r=ca(u.value),r.setOption(V(p,"Memory",[]))),window.addEventListener("resize",g)},g=()=>{f?.resize(),r?.resize()},z=async()=>{const{baseUrl:U,token:p}=l,S=new URL("/api/hubs/system",U||window.location.origin);p&&S.searchParams.append("x-user-token",p),n.value=new Mt().withUrl(S.toString(),{withCredentials:!1}).withAutomaticReconnect().build(),n.value.on("ReceiveSystemStats",b=>{c.cpu=b.cpu,c.memUsage=b.memUsage,c.memUsed=b.memUsed,c.memTotal=b.memTotal,_.length>=Gr&&(_.shift(),y.shift(),M.shift()),_.push(b.timestamp),y.push(b.cpu),M.push(b.memUsage),f?.setOption({xAxis:{data:_},series:[{data:y}]}),r?.setOption({xAxis:{data:_},series:[{data:M}]})});try{await n.value.start(),d.value=!0,await n.value.invoke("JoinMonitor")}catch(b){console.error("SignalR 连接失败:",b)}n.value.onclose(()=>{d.value=!1})};return Ce(()=>{bt(()=>{setTimeout(()=>{h(),z()},100)})}),Qe(async()=>{if(window.removeEventListener("resize",g),n.value)try{await n.value.invoke("LeaveMonitor"),await n.value.stop()}catch(U){console.error(U)}f?.dispose(),r?.dispose()}),(U,p)=>{const S=m("t-tag"),b=m("t-card"),R=m("t-col"),T=m("t-row");return o(),C("div",Rr,[e(T,{gutter:[12,12]},{default:a(()=>[e(R,{xs:12,md:6},{default:a(()=>[e(b,{shadow:"",bordered:!1,class:"chart-card",size:"small"},{default:a(()=>[t("div",Er,[t("div",Tr,[p[3]||(p[3]=t("div",{class:"label"},"CPU 使用率",-1)),t("div",Fr,[t("span",Dr,I(c.cpu),1),p[0]||(p[0]=t("span",{class:"unit"},"%",-1))]),d.value?(o(),O(S,{key:0,theme:"success",variant:"light",size:"small",class:"status-tag"},{default:a(()=>[...p[1]||(p[1]=[v(" 实时 ",-1)])]),_:1})):(o(),O(S,{key:1,theme:"danger",variant:"light",size:"small",class:"status-tag"},{default:a(()=>[...p[2]||(p[2]=[v(" 离线 ",-1)])]),_:1}))]),t("div",{ref_key:"cpuChartRef",ref:i,class:"chart-container"},null,512)])]),_:1})]),_:1}),e(R,{xs:12,md:6},{default:a(()=>[e(b,{shadow:"",bordered:!1,class:"chart-card",size:"small"},{default:a(()=>[t("div",Or,[t("div",jr,[p[5]||(p[5]=t("div",{class:"label"},"内存使用率",-1)),t("div",Kr,[t("span",Nr,I(c.memUsage),1),p[4]||(p[4]=t("span",{class:"unit"},"%",-1))]),t("div",qr,I((c.memUsed/1024).toFixed(1))+" / "+I((c.memTotal/1024).toFixed(1))+" GB ",1)]),t("div",{ref_key:"memChartRef",ref:u,class:"chart-container"},null,512)])]),_:1})]),_:1})]),_:1})])}}}),Jr=ie(Hr,[["__scopeId","data-v-e256825a"]]),Wr={class:"card-header"},Xr={class:"announcement-wrapper"},Qr=se({__name:"Announcement",setup(s){const l=x(!0),n=x(""),d=Ss(),i=x(d.value?"dark":"light");we(d,()=>{i.value=d.value?"dark":"light"});async function u(){l.value=!0;const f=`## 🔴 公告加载失败
- 请检查网络连接或联系管理员。`;try{const r=await Q.get({url:"https://api.mslmc.cn/v3/query/notice?query=mslxNoticeMd"});r&&r.mslxNoticeMd?n.value=r.mslxNoticeMd:n.value=f}catch(r){console.error("获取公告失败:",r),n.value=f}finally{l.value=!1}}return Ce(()=>{u()}),(f,r)=>(o(),O(k(ja),{shadow:"",bordered:!1,class:"announcement-card"},{title:a(()=>[t("div",Wr,[e(k(dt),{name:"system-messages"}),r[0]||(r[0]=t("span",null,"系统公告",-1))])]),default:a(()=>[e(k(fl),{loading:l.value,text:"加载中...",size:"small",style:{width:"100%"}},{default:a(()=>[t("div",Xr,[e(k(Is),{"editor-id":"announcement-preview","model-value":n.value,theme:i.value,class:"md-preview-wrapper"},null,8,["model-value","theme"])])]),_:1},8,["loading"])]),_:1}))}}),Yr=ie(Qr,[["__scopeId","data-v-0d5b602c"]]),Zr=se({__name:"index",setup(s){const l=Ee(),n=ee(()=>l.userInfo?.username==="mslx");return(d,i)=>{const u=m("t-alert");return o(),C("div",null,[n.value?(o(),O(u,{key:0,theme:"warning",title:"安全风险提示",message:"检测到您当前正在使用默认账号 (mslx)。为了保障系统安全，请务必尽快修改用户名和密码！",style:{"margin-bottom":"16px"}},{operation:a(()=>[t("span",{style:{cursor:"pointer"},onClick:i[0]||(i[0]=f=>k(Ie)("/settings"))},"去修改")]),_:1})):K("",!0),e(tr),e(Pr,{style:{"margin-top":"12px"}}),e(Jr,{style:{"margin-top":"12px"}}),e(Yr,{style:{"margin-top":"12px"}})])}}}),eu=Object.freeze(Object.defineProperty({__proto__:null,default:Zr},Symbol.toStringTag,{value:"Module"})),tu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAACXBIWXMAAAsSAAALEgHS3X78AAADgklEQVR42u2dPWhTYRSGk2qlZKia+BMNFuJQERehuFiogoNSJ7tIi4MKFkELInapVYOIS8SlCqKoiwji5OhStLQOlUz+YUFrC2li7I26hGCwEbXrOTec5OKN93nWw/363S8PJ7w9yU0oBAAAASWsFdPXb1Q5ouZn+Oxp8XVu4XiCDQIgACAAIAAgAASQlVrU6+07aFp0bTTqq5v8WiwG/XWu0gEAAQABAAEAAQABYDkGWuPc5PiEWIttXCfWIpGIebP3L4+arjt28YpYK5VKYu3Rtaumv3f43IgnL5bzedF05nQAQABAAEAAQABAAKgxBr5781asbUl2mKKVVnOLXts6EmLt/XzWdADWWKrtRbuHeiKiNerRAQABAAEAAQABAAGgxhgY3xQXa/lc3hSt3CZ6WrwaOHlKrF0akePVhwuDttNp3WDay8NbN00RsZ6YqE0K6QCAAIAAgACAAIAAgABQy/8BtKyvoY18eyoF9dqJebn2aXrBtG4i9tN0Hz1OwbQXbTTtdv9WtFHx3Mc5OgAgACAAIAAgACAA1BID/wX97TmxVh4/L9a6OitibXW8zbSXeL4sR2RlL/3t8ppZZ4Un58Y4GBAAEAAQABAAEAB8GgPdJnPxWKUpDs6rfS7RAQABAAEAAQABAAGg+WJgy+0hc3zampoSa8XsrFj7dueIaa/flYmfxpoTD8RaNJGUL0x1q+vmlbNbGhyjAwACAAIAAgACAAJAvTGwkFts+KJaXNFizp8YqNT2HDoq1p70Nj7qhYx7eTX9XL5/p1Vdt+3MXdN+HKWmvcZ0AN4CAAEAAQABAAEgcDHQeqH2XbQf9+QfatS+w/cbbeLnfMkpV643Ry8JbXKp7UW7B7dpaEZ5rO2q46N0AEAAQABAAEAAQACok/DwcKoqFQ/07TfFQA0tIv6NieX/+sAzM/rjaryIei+nMnQAQABAAEAAQABAAFjGd08KtU7udo89E2ubk52mNRdmZ8Tai6G9dABAAEAAQABAAEAAQADg/wAuuI07sy7jYguvJ582fE3rL394Me6lAwACAAIAAgACAAJAg2Kg9slf7ZOmu7q7PIuJEo8H9vkqznqBF2dOB+AtABAAEAAQABAAiIE1smPndl/diN+mbF7gxZnTAXgLAAQABAAEAASAoBHWitrzg6B5SKdTYToAIAAgACAAIAAgAAAAAECQ+QUUBtshXi5agwAAAABJRU5ErkJggg==",au="/assets/png/mslx-150px-Anvil.BV3t5jxS.png",su="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAACWElEQVR42u3dPS8EURQG4G1RU6GWoFUqRK9Ao1BoJRJ+gEgUG4XERyJRKIQIFYVE0Gn8rPUPzolc1+zOPG/yljs7e89Tnczu9notz9zsxKBmewKAACAACAACgAAgAMjQDPBoYyns2+l+2O/DtbCAAAAAAAAAAAAAAAAAAAAAAADA3w0wG1DW99eXsDv95bDZ9TNgnQcCAAAAAAAAAAAAAAAAAAAAQKsAZB8wW6SUDvBxcz3sx/1l2M/r87DZ+3d+kQQAAAAAAAAAAAAAAAAAAAAAAL9obSAPdxdhn6/Own5vb4XtPBAAAAAAAAAAAAAAAAAAAAAAWgVgcmpqELV0wLW/2PHVXw5bOsDaD4xkzeYDAAAAAAAAAAAAAAAAAAAAAAC/yfzC4iBqdgO1D6gUSNMDzK6fnS8AAAAAAAAAAAAAAAAAAAAAAPwngJvbp7BNAyldRJX+gEXpAI+OT8ICAAAAAAAAAAAAAAAAAAAAAMB/AshusDaQ2g+clA5wd+8gbHZ+2esBAAAAAAAAAAAAAAAAAAAAAGCYFkFNA6m9iKk94JHfBAIAAAAAAAAAAAAAAAAAAADQKgClA64NpOkB2QQCAAAAAAAAAAAAAAAAAAAAMEoAhh3Iyupq2GEfcHZ+Y2PjYRv/xxAAAAAAAAAAAAAAAAAAAAAAOgWgaSAZgKYXMVmzAWfnBwAAAAAAAAAAAAAAAAAAAAAAo5RSIKWLoNYvYgAAAAAAAAAAAAAAAAAAAAAAoEVApmdmw1rEAAAAAAAAAAAAAAAAAAAAAACAiIiIiIiIiHQwP/KhHMCviKP2AAAAAElFTkSuQmCC",lu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAABi0lEQVR42u3cMWoCQRSAYW9mkzYHECGFYJXCKrWVTYpcQwIpUliICAaLEDxASiHn2GIs070njMgy+33wyhWZ91fD6mgEAAAAAAAAANAzh5euRLOdx5M974QFgAAQAAJAAAgAAXA/p7euRJMteL+I57yLJ/t8GxIAAkAACAABIAAEwO0ucrIF1T6fLXgzjed7FY8NCwABIAAEgAAQAALgX3bA2fy+x1MbQLbg7PvZsAAQAAJAAAgAASAArvd37Eo0tT8Mqb1osiEBIAAEgAAQAAJAAPTnImn+8RBO7QslNiAABIAAEAACQAAIgP54/ZmVaJyQABAAAkAACAABIADasdg8lmickAAQAAJAAAgAASAA2pG9EOKEBIAAEAACQAAIAAHQDhdBAhCAAAQgAAEIQAACEIAABCAAAQzH8mtSonFCAkAACAABIAAEgABohz+IEIAABCAAAQhAAAIQgAAEIAABCGA4nj/HJRonJAAEgAAQAAJAAAiAdjytxyUaJyQABIAAEAACQAAIYEAu6/zodBuokO4AAAAASUVORK5CYII=",nu={class:"server-list-container"},ou={class:"page-header"},iu={class:"card-header"},ru={class:"status-badge"},uu={class:"card-content"},du={class:"server-name text-ellipsis"},cu={class:"server-info"},mu={class:"info-item"},pu={class:"info-item id-tag"},vu={class:"card-actions"},fu={key:0,class:"empty-state"},gu={class:"delete-dialog-body"},_u={class:"checkbox-area"},hu=se({__name:"index",setup(s){const l=sa();Ce(()=>{l.refreshInstanceList()});const n=_=>{switch(_){case 1:return{label:"启动中",theme:"primary",icon:yl,loading:!0};case 2:return{label:"运行中",theme:"success",icon:ga,loading:!1};case 3:return{label:"停止中",theme:"warning",icon:hl,loading:!1};case 4:return{label:"重启中",theme:"primary",icon:st,loading:!0};default:return{label:"未启动",theme:"default",icon:_l,loading:!1}}},d=_=>{Ie(`/instance/console/${_.id}`)},i=(_,y)=>{if(_.includes("http"))return _;switch(_){case"neoforge":return tu;case"forge":return au;case"custom":return su;case"server-icon":return new URL(`${localStorage.getItem(Bt)}/api/instance/icon/${y}.png?x-user-token=${localStorage.getItem(Ut)}`,import.meta.url).href;default:return lu}},u=_=>_==="none"?"自定义模式":_.startsWith("@")?_.includes("neoforge")?"NeoForge":"Forge":_.replace(".jar",""),f=Xe({visible:!1,loading:!1,deleteFile:!1,item:null}),r=(_,y)=>{_.stopPropagation(),f.item=y,f.deleteFile=!1,f.loading=!1,f.visible=!0},c=async()=>{if(f.item){f.loading=!0;try{await sr(f.item.id,f.deleteFile),B.success("删除成功"),f.visible=!1,await l.refreshInstanceList()}catch(_){B.error("删除失败: "+_.message)}finally{f.loading=!1}}};return(_,y)=>{const M=m("t-button"),$=m("t-space"),V=m("t-loading"),h=m("t-avatar"),g=m("t-tag"),z=m("t-card"),U=m("t-col"),p=m("t-row"),S=m("t-empty"),b=m("t-checkbox"),R=m("t-dialog");return o(),C("div",nu,[t("div",ou,[y[5]||(y[5]=t("h2",{class:"title"},"服务端列表",-1)),e($,null,{default:a(()=>[e(M,{theme:"primary",variant:"dashed",onClick:k(l).refreshInstanceList},{default:a(()=>[...y[3]||(y[3]=[v(" 刷新列表 ",-1)])]),_:1},8,["onClick"]),e(M,{theme:"primary",onClick:y[0]||(y[0]=T=>k(Ie)("/instance/create"))},{default:a(()=>[...y[4]||(y[4]=[v(" 添加服务端 ",-1)])]),_:1})]),_:1})]),e(V,{loading:!1,text:"加载中...",fullscreen:""}),e(p,{gutter:[24,24]},{default:a(()=>[(o(!0),C(de,null,ye(k(l).instanceList,T=>(o(),O(U,{key:T.id,xs:12,sm:6,md:4,lg:3,xl:3},{default:a(()=>[e(z,{class:ke(["server-card",`status-${T.status}`]),bordered:!1,onClick:P=>d(T)},{default:a(()=>[t("div",iu,[t("div",{class:ke(["icon-wrapper",`status-${T.status}`])},[e(h,{image:i(T.icon,T.id),size:"large",shape:"round",class:"server-icon"},null,8,["image"])],2),t("div",ru,[e(g,{theme:n(T.status).theme,variant:"light",shape:"round"},{icon:a(()=>[(o(),O(ot(n(T.status).icon),{class:ke({"spin-icon":n(T.status).loading})},null,8,["class"]))]),default:a(()=>[v(" "+I(n(T.status).label),1)]),_:2},1032,["theme"])])]),t("div",uu,[t("h3",du,I(T.name),1),t("div",cu,[t("div",mu,[e(k(gl),{class:"info-icon"}),t("span",null,I(u(T.core)),1)]),t("div",pu,[t("span",null,"#"+I(T.id),1)])])]),t("div",vu,[y[6]||(y[6]=t("span",{class:"action-hint"},"点击管理",-1)),e(M,{shape:"circle",theme:"danger",variant:"text",class:"delete-btn",onClick:P=>r(P,T)},{default:a(()=>[e(k($t))]),_:1},8,["onClick"])])]),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:1}),k(l).instanceList.length===0?(o(),C("div",fu,[e(S,{description:"暂无服务端实例"})])):K("",!0),e(R,{visible:f.visible,"onUpdate:visible":y[2]||(y[2]=T=>f.visible=T),header:"确认删除",theme:"danger","confirm-btn":{content:"确认删除",loading:f.loading},onConfirm:c},{default:a(()=>[t("div",gu,[t("p",null,[y[7]||(y[7]=v(" 您确定要删除服务端 ",-1)),t("strong",null,I(f.item?.name),1),v(" (ID: "+I(f.item?.id)+") 吗？ ",1)]),y[9]||(y[9]=t("p",{class:"warning-text"},"此操作不可恢复！",-1)),t("div",_u,[e(b,{modelValue:f.deleteFile,"onUpdate:modelValue":y[1]||(y[1]=T=>f.deleteFile=T)},{default:a(()=>[...y[8]||(y[8]=[v("同时删除服务端文件数据",-1)])]),_:1},8,["modelValue"])])])]),_:1},8,["visible","confirm-btn"])])}}}),yu=ie(hu,[["__scopeId","data-v-5b2fff09"]]),bu=Object.freeze(Object.defineProperty({__proto__:null,default:yu},Symbol.toStringTag,{value:"Module"}));async function wu(){return await Q.get({url:"/query/server_classify",baseURL:"https://api.mslmc.cn/v3"})}async function ku(s){return await Q.get({url:`/query/available_versions/${s}`,baseURL:"https://api.mslmc.cn/v3"})}async function $u(s,l){return await Q.get({url:`/download/server/${s}/${l}`,baseURL:"https://api.mslmc.cn/v3"})}const xu={class:"core-selector-layout"},Au={class:"sidebar"},Cu={key:1,class:"category-list"},Su=["onClick"],Iu={class:"cat-icon"},Vu={class:"cat-info"},Mu={class:"cat-name"},Lu={class:"cat-desc"},Uu={key:0,class:"cat-count"},Bu={class:"main-panel"},zu={class:"panel-section"},Pu={class:"section-header"},Ru={class:"core-grid"},Eu=["onClick"],Tu={key:0,class:"empty-text"},Fu={key:0,class:"panel-section"},Du={class:"section-header"},Ou={class:"section-title"},ju={class:"version-grid"},Ku=["onClick"],Nu={key:0,class:"empty-text"},qu=se({__name:"ServerCoreSelector",props:{visible:{type:Boolean}},emits:["update:visible","confirm"],setup(s,{emit:l}){const n=s,d=l,i=ee({get:()=>n.visible,set:b=>d("update:visible",b)}),u=x(!1),f=x(!1),r=x({}),c=x("plugins"),_=x(""),y=x([]),M=x(""),$=[{key:"plugins",name:"插件服务端",desc:"支持 Bukkit/Spigot/Paper 插件",icon:"app",dataKey:"pluginsCore"},{key:"forge_hybrid",name:"NeoForge 系混合服务端",desc:"同时支持 Neoforge/Forge模组 和 插件",icon:"layers",dataKey:"pluginsAndModsCore_Forge"},{key:"fabric_hybrid",name:"Fabric 混合服务端",desc:"同时支持 Fabric模组 和 插件",icon:"cpu",dataKey:"pluginsAndModsCore_Fabric"},{key:"mod_forge",name:"NeoForge 模组服务端",desc:"纯 NeoForge/Forge 模组支持",icon:"tools",dataKey:"modsCore_Forge"},{key:"mod_fabric",name:"Fabric 模组服务端",desc:"纯 Fabric 模组支持",icon:"ai-tool",dataKey:"modsCore_Fabric"},{key:"vanilla",name:"原版服务端",desc:"Minecraft 官方原版核心",icon:"tea",dataKey:"vanillaCore"},{key:"bedrock",name:"基岩版第三方端",desc:"第三方的基岩版服务端",icon:"gift",dataKey:"bedrockCore"},{key:"proxy",name:"代理服务端",desc:"BungeeCord / Velocity 等 用于群组服",icon:"share",dataKey:"proxyCore"}],V=ee(()=>{const b=$.find(R=>R.key===c.value);return!b||!r.value?[]:r.value[b.dataKey]||[]}),h=ee(()=>M.value?V.value.filter(b=>b.toLowerCase().includes(M.value.toLowerCase())):V.value),g=async()=>{u.value=!0;try{const b=await wu();Array.isArray(b)&&b.length>0?r.value=b[0]:b&&!Array.isArray(b)&&(r.value=b)}catch(b){B.error("获取服务端分类失败"),console.error(b)}finally{u.value=!1}},z=b=>{c.value=b,_.value="",y.value=[],M.value=""},U=b=>{_.value!==b&&(_.value=b,p(b))},p=async b=>{f.value=!0,y.value=[];try{const R=await ku(b);Array.isArray(R)&&R.length>0?y.value=R[0].versionList||[]:R&&!Array.isArray(R)&&(y.value=R.versionList||[])}catch(R){B.error(`获取 ${b} 版本列表失败`),console.error(R)}finally{f.value=!1}},S=async b=>{const R=B.loading("正在获取核心版本信息...",0);try{const T=await $u(_.value,b),P={core:_.value,version:b,url:T.url,sha256:T.sha256||"",filename:`${_.value}-${b}.jar`};B.close(R),d("confirm",P),i.value=!1}catch(T){B.close(R),B.error("获取核心的版本信息失败"),console.error(T)}};return we(()=>n.visible,b=>{b&&!r.value.pluginsCore&&g()}),(b,R)=>{const T=m("t-loading"),P=m("t-icon"),G=m("t-input"),N=m("t-divider"),E=m("t-button"),w=m("t-dialog");return o(),O(w,{visible:i.value,"onUpdate:visible":R[2]||(R[2]=A=>i.value=A),header:"选择服务端核心",width:"85%",top:"5vh",attach:"body",footer:!1,"destroy-on-close":"",class:"core-selector-dialog"},{default:a(()=>[t("div",xu,[t("div",Au,[R[3]||(R[3]=t("div",{class:"sidebar-title"},"服务端分类",-1)),R[4]||(R[4]=t("div",{class:"sidebar-desc"},"选择您需要的服务端类型",-1)),u.value?(o(),O(T,{key:0,loading:u.value,size:"small",text:"加载分类中..."},null,8,["loading"])):(o(),C("div",Cu,[(o(),C(de,null,ye($,A=>t("div",{key:A.key,class:ke(["category-item",{active:c.value===A.key}]),onClick:L=>z(A.key)},[t("div",Iu,[e(P,{name:A.icon},null,8,["name"])]),t("div",Vu,[t("div",Mu,I(A.name),1),t("div",Lu,I(A.desc),1),r.value[A.dataKey]?(o(),C("div",Uu,I(r.value[A.dataKey]?.length||0)+" 个核心 ",1)):K("",!0)])],10,Su)),64))]))]),t("div",Bu,[t("div",zu,[t("div",Pu,[R[5]||(R[5]=t("div",{class:"section-title"},"选择服务端核心",-1)),e(G,{modelValue:M.value,"onUpdate:modelValue":R[0]||(R[0]=A=>M.value=A),placeholder:"搜索核心...",class:"search-input"},{"suffix-icon":a(()=>[e(P,{name:"search"})]),_:1},8,["modelValue"])]),t("div",Ru,[(o(!0),C(de,null,ye(h.value,A=>(o(),C("div",{key:A,class:ke(["core-card",{active:_.value===A}]),onClick:L=>U(A)},[v(I(A)+" ",1),_.value===A?(o(),O(P,{key:0,name:"check",class:"check-icon"})):K("",!0)],10,Eu))),128)),h.value.length===0?(o(),C("div",Tu,"该分类下暂无核心")):K("",!0)])]),_.value?(o(),C("div",Fu,[e(N),t("div",Du,[t("div",Ou,I(_.value)+" 版本列表",1),e(E,{size:"small",variant:"text",onClick:R[1]||(R[1]=A=>p(_.value))},{icon:a(()=>[e(P,{name:"refresh"})]),default:a(()=>[R[6]||(R[6]=v("刷新 ",-1))]),_:1})]),e(T,{loading:f.value,size:"small",text:"获取版本中...",class:"loading-wrapper"},{default:a(()=>[t("div",ju,[(o(!0),C(de,null,ye(y.value,A=>(o(),C("div",{key:A,class:"version-item",onClick:L=>S(A)},I(A),9,Ku))),128)),y.value.length===0&&!f.value?(o(),C("div",Nu,"未找到该核心的版本信息")):K("",!0)])]),_:1},8,["loading"])])):K("",!0)])])]),_:1},8,["visible"])}}}),Qa=ie(qu,[["__scopeId","data-v-9e97180c"]]);async function Ya(s,l){return await Q.get({url:"/query/jdk",baseURL:"https://api.mslmc.cn/v3",params:{os:s,arch:l}})}async function Za(s=!1){return await Q.get({url:"/api/java/list",params:{refresh:s},timeout:60*1e3})}const Gu={class:"main-layout-container"},Hu={class:"steps-aside"},Ju={class:"main-content"},Wu={key:0,class:"form-step-container"},Xu={class:"step-content"},Qu={class:"step-content"},Yu={style:{"margin-top":"6px",display:"flex","flex-direction":"column",gap:"6px"}},Zu={style:{"margin-top":"4px",color:"var(--td-text-color-placeholder)","font-size":"12px"}},ed={style:{width:"100%"}},td={class:"java-option-panel"},ad={key:0,class:"flex-row"},sd={class:"tip"},ld={key:1,class:"flex-row"},nd={key:2},od={key:3},id={class:"step-content"},rd={key:0,class:"online-select-area"},ud={class:"select-core-wrapper"},dd={key:0,class:"selected-core-card"},cd={class:"core-icon"},md={class:"core-info"},pd={class:"core-filename"},vd={key:1,class:"online-select-area"},fd={class:"select-core-wrapper"},gd={key:1,class:"uploading-state"},_d={class:"core-filename"},hd={key:2,class:"selected-core-card"},yd={class:"core-icon"},bd={class:"core-info"},wd={class:"core-filename"},kd={class:"core-url"},$d={key:2,class:"online-select-area"},xd={class:"step-content"},Ad={class:"step-content"},Cd={class:"confirm-container"},Sd={class:"confirm-header"},Id={class:"server-icon-placeholder"},Vd={class:"server-title-info"},Md={class:"server-name"},Ld={class:"server-path"},Ud={class:"confirm-item"},Bd={class:"value-row"},zd={class:"main-text"},Pd={key:0,class:"sub-text"},Rd={key:1,class:"sub-text"},Ed={class:"confirm-item"},Td={class:"value-row"},Fd={key:0,class:"main-text"},Dd=["title"],Od={key:0,class:"sub-text text-truncate"},jd=["title"],Kd={class:"confirm-item"},Nd={class:"memory-viz"},qd={class:"mem-block"},Gd={class:"mem-val"},Hd={class:"mem-arrow"},Jd={class:"mem-block"},Wd={class:"mem-val"},Xd={class:"confirm-item"},Qd={key:0,class:"args-box"},Yd={key:1,class:"sub-text"},Zd={key:1,class:"step-content creation-progress"},ec={class:"progress-title"},tc={class:"log-time"},ac={class:"log-message"},sc={key:2,class:"result-success"},lc={class:"result-success-title"},nc=se({__name:"QuickMode",setup(s){const l=Ee(),n=x(null),d=sa(),i=x(0),u=x(!1),f=x(!1),r=x(!1),c=x(0),_=x([]),y=x(null),M=x(null),$=x(null),V=x("online"),h=x(!1),g=x(null),z=x(!1),U=x(0),p=x(""),S=x(""),b=x("online"),R=x([]),T=x([]),P=x(""),G=x(""),N=async(F=!1)=>{try{F&&B.info("正在刷新Java版本列表(重新扫描耗时较长)...");const j=await Ya(l.userInfo.systemInfo.osType.toLowerCase().replace("os",""),l.userInfo.systemInfo.osArchitecture.toLowerCase());j&&Array.isArray(j)&&(R.value=j.map(ae=>({label:`Java ${ae}`,value:ae})),R.value.length>0&&!P.value&&(P.value=R.value[1].value)),T.value=(await Za(F)).map(ae=>({label:`Java ${ae.version}${ae.is64Bit?"":" (32位)"} (${ae.vendor} | ${ae.path})`,value:ae.path})),T.value.length>0&&(G.value=T.value[0].value),F&&B.success("已刷新Java版本列表")}catch(j){B.warning("获取在线Java版本失败"+j.message)}};Ce(()=>{N()});const E=x({name:"新建服务器",path:"",java:"",core:"",coreUrl:"",coreSha256:"",coreFileKey:"",packageFileKey:"",minM:1024,maxM:4096,args:""}),w=[{label:"GB",value:"GB"},{label:"MB",value:"MB"}],A=x("GB"),L=x("GB"),H=ee({get:()=>A.value==="GB"?E.value.minM/1024:E.value.minM,set:F=>{E.value.minM=A.value==="GB"?Math.round(F*1024):F}}),J=ee({get:()=>L.value==="GB"?E.value.maxM/1024:E.value.maxM,set:F=>{E.value.maxM=L.value==="GB"?Math.round(F*1024):F}});we([b,P,G],([F,j,ae])=>{F==="env"?E.value.java="java":F==="custom"||F==="local"?E.value.java=ae:F==="online"&&(E.value.java=j?`MSLX://Java/${j}`:""),E.value.java&&n.value?.validate({fields:["java"]})},{immediate:!0});const X=ee(()=>({name:[{required:!0,message:"实例名称不能为空",trigger:"blur"}],java:[{required:!0,message:"请配置 Java 环境",trigger:"change"}],core:[{required:!0,message:"核心名称/文件不能为空",trigger:"change"}],coreUrl:[{validator:F=>{if(V.value==="online"){if(!F)return{result:!1,message:"请选择一个服务端核心",type:"error"};if(F&&!/^https?:\/\/.+/.test(F))return{result:!1,message:"下载地址必须以 http(s) 开头",type:"error"}}return!0},trigger:"change"}],coreFileKey:[{validator:F=>V.value==="manual"&&!F?{result:!1,message:"请上传核心文件",type:"error"}:!0,trigger:"change"}],minM:[{required:!0,min:1,message:"最小内存必须大于0",trigger:"blur"}],maxM:[{required:!0,min:1,message:"最大内存必须大于0",trigger:"blur"}]})),q=[["name","path"],["java"],["core","coreUrl","coreSha256","coreFileKey"],["minM","maxM","args"],[]],_e=()=>{i.value>0&&(i.value-=1)},De=async()=>{if(i.value===2){if(V.value==="online"){if(!E.value.coreUrl||!E.value.core){B.warning("请点击按钮选择一个服务端核心");return}}else if(V.value==="custom"){if(!E.value.core){B.warning("请输入核心文件名");return}}else if(!E.value.coreFileKey){B.warning("请先上传核心文件");return}}const F=await n.value.validate();if(F===!0){i.value<4&&(i.value+=1);return}const j=new Set(q[i.value]);Object.keys(F).some(pe=>j.has(pe))?B.warning("请检查当前步骤的输入"):i.value<4&&(i.value+=1)},fe=F=>{E.value.core=F.filename,E.value.coreUrl=F.url,E.value.coreSha256=F.sha256,E.value.coreFileKey="",B.success(`已选择: ${F.core} (${F.version})`),n.value.validate({fields:["core","coreUrl"]})},Pe=()=>{g.value?.click()},Le=F=>{if(F===0)return"0 B";const j=1024,ae=["B","KB","MB","GB"],pe=Math.floor(Math.log(F)/Math.log(j));return parseFloat((F/Math.pow(j,pe)).toFixed(2))+" "+ae[pe]},Ve=async F=>{const j=F.target;if(!j.files||j.files.length===0)return;if(E.value.coreFileKey)try{await Ct(E.value.coreFileKey),console.log("旧临时文件已清理:",E.value.coreFileKey)}catch(te){console.warn("清理旧文件失败，可能文件已过期",te)}const ae=j.files[0],pe=ae.name;E.value.core=pe,E.value.coreUrl="",E.value.coreSha256="",E.value.coreFileKey="",p.value=pe,S.value=Le(ae.size),await Oe(ae),j.value=""};let Be=null;const Oe=async F=>{Be&&Be.abort(),Be=new AbortController,z.value=!0,U.value=0;const ae=F.size>200*1024*1024?50*1024*1024:5*1024*1024,pe=Math.ceil(F.size/ae),te=4,D=5,ne=new Map;let me=0;const be=()=>{const he=Date.now();if(he-me<100)return;me=he;const $e=Array.from(ne.values()).reduce((Me,Se)=>Me+Se,0),Ue=Math.min($e/F.size*98,98);U.value=Number(Ue.toFixed(1))};try{const $e=(await ea()).uploadId;if(!$e)throw new Error("无法获取上传凭证");const Ue=Array.from({length:pe},(Y,xe)=>xe),Me=async Y=>{if(Be?.signal.aborted)throw new Error("已取消");const xe=Y*ae,Ne=Math.min(F.size,xe+ae),qe=F.slice(xe,Ne);let Fe;for(let Re=1;Re<=D;Re++){if(Be?.signal.aborted)throw new Error("已取消");try{await ta($e,Y,qe,et=>{et&&et.loaded&&(ne.set(Y,et.loaded),be())},Be?.signal),ne.set(Y,qe.size),be();return}catch(et){Fe=et,ne.set(Y,0),be(),Re<D&&await new Promise(ge=>setTimeout(ge,1e3*Re))}}throw new Error(`分片 ${Y} 失败: ${Fe?.message}`)},Se=async()=>{for(;Ue.length>0&&!Be?.signal.aborted;){const Y=Ue.shift();Y!==void 0&&await Me(Y)}},Ge=Array(Math.min(te,pe)).fill(null).map(()=>Se());if(await Promise.all(Ge),Be?.signal.aborted)throw new Error("已取消");const Te=(await aa($e,pe)).uploadId;U.value=100,E.value.coreFileKey=Te,B.success("核心文件上传成功！"),n.value?.validate({fields:["core","coreFileKey"]})}catch(he){if(he.message==="已取消")return;console.error(he),B.error(`上传失败: ${he.message||"未知错误"}`),E.value.core="",p.value="",U.value=0,E.value.coreFileKey&&(Ct(E.value.coreFileKey).catch(()=>{}),E.value.coreFileKey="")}finally{Be?.signal.aborted||(z.value=!1)}},re=async()=>{E.value.coreFileKey&&(await Ct(E.value.coreFileKey),E.value.coreFileKey="",E.value.core="",p.value="",B.success("文件已移除"))},ce=async()=>{if(!(await n.value.validate()===!0)){B.warning("请检查表单所有内容");return}u.value=!0,_.value=[];const ae={...E.value,path:E.value.path||null,coreUrl:E.value.coreUrl||null,coreSha256:E.value.coreSha256||null,coreFileKey:E.value.coreFileKey||null,args:E.value.args||null};V.value==="manual"?(ae.coreUrl=null,ae.coreSha256=null):ae.coreFileKey=null;try{const te=(await Xa(ae)).serverId;if(!te)throw new Error("服务器未返回 ServerId");M.value=te.toString(),f.value=!0,i.value=5,await Ke(M.value)}catch(pe){const te=pe.message||"创建请求失败，请检查网络或后端服务";B.error(te),u.value=!1}},Ke=async F=>{const{baseUrl:j,token:ae}=l;let pe=!1;const te=new URL("/api/hubs/creationProgressHub",j||window.location.origin);te.searchParams.append("x-user-token",ae),y.value=new Mt().withUrl(te.toString(),{withCredentials:!1}).configureLogging(Et.Information).build();const D=(ne,me=null)=>{_.value.push({time:new Date().toLocaleTimeString(),message:ne,progress:me}),bt(()=>{$.value&&($.value.scrollTop=$.value.scrollHeight)})};y.value.on("StatusUpdate",(ne,me,be)=>{ne.toString()===F&&(D(me,be),be!==null&&be>=0&&(c.value=be),be===100?(pe=!0,B.success("服务器创建成功！"),y.value?.stop(),f.value=!1,r.value=!0,i.value=6,u.value=!1,d.refreshInstanceList()):be===-1&&(B.error(me||"创建过程中发生未知错误"),y.value?.stop(),f.value=!1,u.value=!1,i.value=0))});try{await y.value.start(),D("已连接到实时进度服务..."),await y.value.invoke("TrackServer",F),D("已订阅任务，等待服务器响应...")}catch(ne){pe||(D(`SignalR 连接失败: ${ne.message}`,-1),B.error("无法连接到实时进度服务"),f.value=!1,u.value=!1,i.value=0)}};Qe(()=>{y.value?.stop(),Be&&Be.abort()});const le=()=>{r.value=!1,i.value=0,E.value={...E.value,name:"新建服务器",core:"",coreUrl:"",coreSha256:"",path:"",args:"",coreFileKey:""},p.value="",V.value="online",b.value="online",G.value=""};return(F,j)=>{const ae=m("t-step-item"),pe=m("t-steps"),te=m("t-input"),D=m("t-form-item"),ne=m("t-tag"),me=m("t-space"),be=m("t-icon"),he=m("t-alert"),$e=m("t-radio-button"),Ue=m("t-radio-group"),Me=m("t-select"),Se=m("t-button"),Ge=m("t-progress"),Ye=m("t-input-number"),Te=m("t-col"),Y=m("t-row"),xe=m("t-textarea"),Ne=m("t-divider"),qe=m("t-form"),Fe=m("t-list-item-meta"),Re=m("t-list-item"),et=m("t-list");return o(),C("div",null,[t("div",Gu,[t("div",Hu,[e(pe,{layout:"vertical",style:{"margin-top":"16px"},current:i.value,status:"process",readonly:""},{default:a(()=>[e(ae,{title:"基本信息",content:"填写实例名称和路径"}),e(ae,{title:"Java 环境",content:"配置 Java 运行时"}),e(ae,{title:"核心文件",content:"指定核心文件及下载"}),e(ae,{title:"资源配置",content:"设置内存与 JVM 参数"}),e(ae,{title:"确认信息",content:"核对并提交"}),e(ae,{title:"创建实例",content:"提交并等待创建"}),e(ae,{title:"完成",content:"查看创建结果"})]),_:1},8,["current"])]),t("div",Ju,[!f.value&&!r.value?(o(),C("div",Wu,[e(qe,{ref_key:"formRef",ref:n,data:E.value,rules:X.value,"label-align":"top",class:"step-form",onSubmit:ce},{default:a(()=>[Je(t("div",Xu,[e(D,{label:"实例名称",name:"name"},{default:a(()=>[e(te,{modelValue:E.value.name,"onUpdate:modelValue":j[0]||(j[0]=ge=>E.value.name=ge),placeholder:"为你的服务器起个名字"},null,8,["modelValue"])]),_:1}),e(D,{label:"实例路径",name:"path",help:k(l).userInfo.systemInfo.docker?"您正在使用Docker容器部署，为保数据安全，仅支持使用默认数据路径":"选填，留空将使用默认路径"},{default:a(()=>[e(te,{modelValue:E.value.path,"onUpdate:modelValue":j[1]||(j[1]=ge=>E.value.path=ge),disabled:k(l).userInfo.systemInfo.docker,placeholder:"例如: D:\\MyServer"},null,8,["modelValue","disabled"])]),_:1},8,["help"])],512),[[tt,i.value===0]]),Je(t("div",Qu,[e(he,{theme:"info",title:"Java 版本选择指南"},{message:a(()=>[t("div",Yu,[e(me,{align:"center",size:12},{default:a(()=>[e(ne,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...j[20]||(j[20]=[v("MC 26.1 - 最新版本",-1)])]),_:1}),e(ne,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...j[21]||(j[21]=[v("Java 25",-1)])]),_:1})]),_:1}),e(me,{align:"center",size:12},{default:a(()=>[e(ne,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...j[22]||(j[22]=[v("MC 1.20.5 - 1.21.11",-1)])]),_:1}),e(ne,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...j[23]||(j[23]=[v("Java 21",-1)])]),_:1})]),_:1}),e(me,{align:"center",size:12},{default:a(()=>[e(ne,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...j[24]||(j[24]=[v("MC 1.18 - 1.20.4",-1)])]),_:1}),e(ne,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...j[25]||(j[25]=[v("Java 17",-1)])]),_:1})]),_:1}),e(me,{align:"center",size:12},{default:a(()=>[e(ne,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...j[26]||(j[26]=[v("MC 1.17 / 1.17.1",-1)])]),_:1}),e(ne,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...j[27]||(j[27]=[v("Java 16",-1)])]),_:1})]),_:1}),e(me,{align:"center",size:12},{default:a(()=>[e(ne,{theme:"default",variant:"outline",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...j[28]||(j[28]=[v("MC 1.13 - 更低版本",-1)])]),_:1}),e(ne,{theme:"default",variant:"light",shape:"round"},{default:a(()=>[...j[29]||(j[29]=[v("Java 8",-1)])]),_:1})]),_:1}),t("div",Zu,[e(be,{name:"info-circle",size:"small",style:{"margin-right":"4px"}}),j[30]||(j[30]=v(" 建议直接使用推荐版本，避免兼容性问题。 ",-1))])])]),_:1}),e(D,{label:"Java 来源",name:"java"},{default:a(()=>[t("div",ed,[e(Ue,{modelValue:b.value,"onUpdate:modelValue":j[2]||(j[2]=ge=>b.value=ge),variant:"default-filled"},{default:a(()=>[e($e,{value:"online"},{default:a(()=>[...j[31]||(j[31]=[v("在线下载",-1)])]),_:1}),e($e,{value:"local"},{default:a(()=>[...j[32]||(j[32]=[v("选择电脑上的 Java",-1)])]),_:1}),e($e,{value:"env"},{default:a(()=>[...j[33]||(j[33]=[v("环境变量",-1)])]),_:1}),e($e,{value:"custom"},{default:a(()=>[...j[34]||(j[34]=[v("自定义路径",-1)])]),_:1})]),_:1},8,["modelValue"]),t("div",td,[b.value==="online"?(o(),C("div",ad,[e(Me,{modelValue:P.value,"onUpdate:modelValue":j[3]||(j[3]=ge=>P.value=ge),options:R.value,placeholder:"请选择 Java 版本"},null,8,["modelValue","options"]),t("div",sd," 将下载并使用 Java "+I(P.value||"?")+" "+I(k(l).userInfo.systemInfo.osType.toLowerCase().replace("os",""))+" / "+I(k(l).userInfo.systemInfo.osArchitecture.toLowerCase()),1)])):K("",!0),b.value==="local"?(o(),C("div",ld,[e(Me,{modelValue:G.value,"onUpdate:modelValue":j[4]||(j[4]=ge=>G.value=ge),options:T.value,placeholder:"请选择 Java 版本"},null,8,["modelValue","options"]),e(Se,{variant:"outline",theme:"primary",onClick:j[5]||(j[5]=ge=>N(!0))},{default:a(()=>[...j[35]||(j[35]=[v("重新扫描",-1)])]),_:1})])):K("",!0),b.value==="env"?(o(),C("div",nd,[e(te,{"model-value":"java",readonly:"",disabled:""}),j[36]||(j[36]=t("div",{class:"tip"},"将使用系统环境变量中的 java 命令",-1))])):K("",!0),b.value==="custom"?(o(),C("div",od,[e(te,{modelValue:G.value,"onUpdate:modelValue":j[6]||(j[6]=ge=>G.value=ge),placeholder:"例如: C:\\Program Files\\Java\\jdk-17\\bin\\java.exe"},null,8,["modelValue"])])):K("",!0)])])]),_:1})],512),[[tt,i.value===1]]),Je(t("div",id,[e(D,{label:"选择您的Minecraft开服使用的服务端核心"},{default:a(()=>[e(Ue,{modelValue:V.value,"onUpdate:modelValue":j[7]||(j[7]=ge=>V.value=ge),variant:"default-filled"},{default:a(()=>[e($e,{value:"online"},{default:a(()=>[...j[37]||(j[37]=[v("在线下载 (推荐)",-1)])]),_:1}),e($e,{value:"manual"},{default:a(()=>[...j[38]||(j[38]=[v("选择本地文件",-1)])]),_:1}),e($e,{value:"custom"},{default:a(()=>[...j[39]||(j[39]=[v("自定义文件名",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),V.value==="online"?(o(),C("div",rd,[e(D,{label:"选择服务端核心",name:"coreUrl"},{default:a(()=>[t("div",ud,[e(Se,{variant:"outline",onClick:j[8]||(j[8]=ge=>h.value=!0)},{icon:a(()=>[e(be,{name:"cloud-download"})]),default:a(()=>[j[40]||(j[40]=v(" 点击打开服务端核心选择库 ",-1))]),_:1}),E.value.core?(o(),C("div",dd,[t("div",cd,[e(be,{name:"check-circle-filled"})]),t("div",md,[t("div",pd,I(E.value.core),1),j[41]||(j[41]=t("div",{class:"core-url",title:"MSLX 将在稍后帮您自动下载此文件..."}," MSLX 将在稍后帮您自动下载此文件... ",-1))]),e(Se,{shape:"circle",variant:"text",theme:"danger",onClick:j[9]||(j[9]=ge=>{E.value.core="",E.value.coreUrl=""})},{default:a(()=>[e(be,{name:"close"})]),_:1})])):K("",!0)])]),_:1}),Je(t("input",{"onUpdate:modelValue":j[10]||(j[10]=ge=>E.value.coreSha256=ge),type:"hidden"},null,512),[[Vs,E.value.coreSha256]])])):K("",!0),V.value==="manual"?(o(),C("div",vd,[e(D,{label:"上传核心文件",name:"coreFileKey"},{default:a(()=>[t("div",fd,[t("input",{ref_key:"uploadInputRef",ref:g,accept:".jar",type:"file",style:{display:"none"},onChange:Ve},null,544),!z.value&&!E.value.coreFileKey?(o(),O(Se,{key:0,variant:"outline",onClick:Pe},{icon:a(()=>[e(be,{name:"upload"})]),default:a(()=>[j[42]||(j[42]=v(" 点击选择文件并上传 ",-1))]),_:1})):K("",!0),z.value?(o(),C("div",gd,[t("div",_d,"正在上传: "+I(p.value)+" ("+I(S.value)+")",1),e(Ge,{theme:"line",percentage:U.value},null,8,["percentage"]),j[43]||(j[43]=t("div",{class:"tip"},"别着急，喝杯茶🍵...",-1))])):K("",!0),E.value.coreFileKey&&!z.value?(o(),C("div",hd,[t("div",yd,[e(be,{name:"check-circle-filled"})]),t("div",bd,[t("div",wd,I(p.value),1),t("div",kd,I(S.value)+" | 已上传准备就绪",1)]),e(Se,{shape:"circle",variant:"text",theme:"primary",onClick:Pe},{icon:a(()=>[e(be,{name:"swap"})]),_:1}),e(Se,{shape:"circle",variant:"text",theme:"danger",onClick:re},{icon:a(()=>[e(be,{name:"delete"})]),_:1})])):K("",!0)])]),_:1})])):K("",!0),V.value==="custom"?(o(),C("div",$d,[e(he,{theme:"warning",message:"此模式通常用于服务器目录中已经存在核心文件，或者您打算稍后手动通过文件管理上传核心。",style:{"margin-bottom":"16px"}}),e(D,{label:"核心文件名",name:"core",help:"请确保文件名包含后缀，例如: server.jar"},{default:a(()=>[e(te,{modelValue:E.value.core,"onUpdate:modelValue":j[11]||(j[11]=ge=>E.value.core=ge),placeholder:"请输入核心文件名 (例如 server.jar)"},null,8,["modelValue"])]),_:1})])):K("",!0)],512),[[tt,i.value===2]]),Je(t("div",xd,[e(Y,{gutter:[16,24]},{default:a(()=>[e(Te,{xs:12,span:6},{default:a(()=>[e(D,{label:"最小内存",name:"minM"},{default:a(()=>[e(me,{size:8,style:{width:"100%"}},{default:a(()=>[e(Ye,{modelValue:H.value,"onUpdate:modelValue":j[12]||(j[12]=ge=>H.value=ge),min:0,"decimal-places":A.value==="GB"?1:0,placeholder:"Xms",theme:"column",style:{width:"100%"}},null,8,["modelValue","decimal-places"]),e(Me,{modelValue:A.value,"onUpdate:modelValue":j[13]||(j[13]=ge=>A.value=ge),options:w,clearable:!1,style:{width:"80px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Te,{xs:12,span:6},{default:a(()=>[e(D,{label:"最大内存",name:"maxM"},{default:a(()=>[e(me,{size:8,style:{width:"100%"}},{default:a(()=>[e(Ye,{modelValue:J.value,"onUpdate:modelValue":j[14]||(j[14]=ge=>J.value=ge),min:0,"decimal-places":L.value==="GB"?1:0,placeholder:"Xmx",theme:"column",style:{width:"100%"}},null,8,["modelValue","decimal-places"]),e(Me,{modelValue:L.value,"onUpdate:modelValue":j[15]||(j[15]=ge=>L.value=ge),options:w,clearable:!1,style:{width:"80px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(D,{label:"额外 JVM 参数 (可选)",name:"args",help:"例如: -XX:+UseG1GC",style:{"margin-top":"16px"}},{default:a(()=>[e(xe,{modelValue:E.value.args,"onUpdate:modelValue":j[16]||(j[16]=ge=>E.value.args=ge),placeholder:"-XX:+UseG1GC"},null,8,["modelValue"])]),_:1})],512),[[tt,i.value===3]]),Je(t("div",Ad,[t("div",Cd,[t("div",Sd,[t("div",Id,[e(be,{name:"server",size:"32px"})]),t("div",Vd,[t("div",Md,I(E.value.name),1),t("div",Ld,[e(be,{name:"folder-open",size:"small"}),v(" "+I(E.value.path||"默认数据路径 (/DaemonData/Servers)"),1)])])]),e(Ne,{dashed:"",style:{margin:"16px 0"}}),e(Y,{gutter:[24,24]},{default:a(()=>[e(Te,{span:6},{default:a(()=>[t("div",Ud,[j[47]||(j[47]=t("div",{class:"label"},"服务端核心",-1)),t("div",Bd,[t("span",zd,I(E.value.core),1),V.value==="online"?(o(),O(ne,{key:0,theme:"primary",variant:"light",size:"small"},{default:a(()=>[...j[44]||(j[44]=[v(" 在线下载 ",-1)])]),_:1})):V.value==="manual"?(o(),O(ne,{key:1,theme:"warning",variant:"light",size:"small"},{default:a(()=>[...j[45]||(j[45]=[v(" 手动上传 ",-1)])]),_:1})):(o(),O(ne,{key:2,theme:"default",variant:"light",size:"small",shape:"round"},{default:a(()=>[...j[46]||(j[46]=[v("自定义",-1)])]),_:1}))]),V.value==="online"?(o(),C("div",Pd," 来源: MSL 镜像源 ("+I(E.value.coreUrl?"已匹配":"未匹配")+") ",1)):(o(),C("div",Rd,"大小: "+I(S.value||"未知"),1))])]),_:1}),e(Te,{span:6},{default:a(()=>[t("div",Ed,[j[52]||(j[52]=t("div",{class:"label"},"Java 运行时",-1)),t("div",Td,[b.value==="online"?(o(),C("span",Fd," Java "+I(P.value),1)):(o(),C("span",{key:1,class:"main-text text-truncate",title:E.value.java},I(E.value.java),9,Dd)),b.value==="online"?(o(),O(ne,{key:2,theme:"success",variant:"light",size:"small"},{default:a(()=>[...j[48]||(j[48]=[v(" 自动安装 ",-1)])]),_:1})):b.value==="local"?(o(),O(ne,{key:3,theme:"primary",variant:"light",size:"small",shape:"round"},{default:a(()=>[...j[49]||(j[49]=[v(" 本机环境 ",-1)])]),_:1})):b.value==="env"?(o(),O(ne,{key:4,theme:"warning",variant:"light",size:"small",shape:"round"},{default:a(()=>[...j[50]||(j[50]=[v(" 环境变量 ",-1)])]),_:1})):(o(),O(ne,{key:5,theme:"default",variant:"light",size:"small"},{default:a(()=>[...j[51]||(j[51]=[v("自定义路径",-1)])]),_:1}))]),b.value==="online"?(o(),C("div",Od," 将自动从镜像源下载并解压 JDK ")):(o(),C("div",{key:1,class:"sub-text text-truncate",title:E.value.java}," 本机环境: "+I(E.value.java),9,jd))])]),_:1}),e(Te,{span:6},{default:a(()=>[t("div",Kd,[j[55]||(j[55]=t("div",{class:"label"},"内存分配 (JVM)",-1)),t("div",Nd,[t("div",qd,[j[53]||(j[53]=t("span",{class:"mem-label"},"初始 (Xms)",-1)),t("span",Gd,I(H.value)+" "+I(A.value),1)]),t("div",Hd,[e(be,{name:"arrow-right"})]),t("div",Jd,[j[54]||(j[54]=t("span",{class:"mem-label"},"最大 (Xmx)",-1)),t("span",Wd,I(J.value)+" "+I(L.value),1)])])])]),_:1}),e(Te,{span:6},{default:a(()=>[t("div",Xd,[j[56]||(j[56]=t("div",{class:"label"},"启动参数",-1)),E.value.args?(o(),C("div",Qd,I(E.value.args),1)):(o(),C("div",Yd,"无额外参数"))])]),_:1})]),_:1}),e(he,{style:{"margin-top":"24px"},theme:"info"},{message:a(()=>[...j[57]||(j[57]=[v(" 确认无误后点击下方 ",-1),t("b",null,"提交创建",-1),v("，系统将自动开始下载资源并部署实例。 ",-1)])]),_:1})])],512),[[tt,i.value===4]]),e(D,{class:"step-actions"},{default:a(()=>[i.value>0?(o(),O(Se,{key:0,theme:"default",onClick:_e},{default:a(()=>[...j[58]||(j[58]=[v("上一步",-1)])]),_:1})):K("",!0),i.value<4?(o(),O(Se,{key:1,type:"button",onClick:De},{default:a(()=>[...j[59]||(j[59]=[v("下一步",-1)])]),_:1})):K("",!0),i.value===4?(o(),O(Se,{key:2,theme:"primary",type:"submit",loading:u.value},{default:a(()=>[...j[60]||(j[60]=[v(" 提交创建 ",-1)])]),_:1},8,["loading"])):K("",!0)]),_:1})]),_:1},8,["data","rules"])])):K("",!0),f.value?(o(),C("div",Zd,[t("div",ec,"正在创建实例 ("+I(M.value)+")",1),j[61]||(j[61]=t("p",null,"请勿关闭此页面，创建过程可能需要几分钟...",-1)),e(Ge,{theme:"plump",percentage:c.value,label:`${c.value.toFixed(2)}%`},null,8,["percentage","label"]),t("div",{ref_key:"logContainerRef",ref:$,class:"log-container"},[e(et,{split:!0},{default:a(()=>[(o(!0),C(de,null,ye(_.value,(ge,vt)=>(o(),O(Re,{key:vt},{default:a(()=>[e(Fe,null,{description:a(()=>[t("span",tc,"["+I(ge.time)+"]",1),t("span",ac,I(ge.message),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})],512)])):K("",!0),r.value?(o(),C("div",sc,[e(be,{class:"result-success-icon",name:"check-circle"}),t("div",lc,"服务器 ("+I(M.value)+") 已创建成功",1),j[64]||(j[64]=t("div",{class:"result-success-describe"},"你现在可以去服务器列表启动它了",-1)),t("div",null,[e(Se,{onClick:j[17]||(j[17]=()=>{le(),k(Ie)("/instance/list")})},{default:a(()=>[...j[62]||(j[62]=[v(" 返回服务端列表 ",-1)])]),_:1}),e(Se,{theme:"default",onClick:j[18]||(j[18]=()=>{le(),k(Ie)(`/instance/console/${M.value}`)})},{default:a(()=>[...j[63]||(j[63]=[v(" 前往控制台 ",-1)])]),_:1})])])):K("",!0)])]),e(Qa,{visible:h.value,"onUpdate:visible":j[19]||(j[19]=ge=>h.value=ge),onConfirm:fe},null,8,["visible"])])}}}),oc=ie(nc,[["__scopeId","data-v-54704971"]]),ic={key:0},rc={key:1,class:"result-success"},uc={class:"result-success-title"},dc=se({__name:"CustomMode",setup(s){const l=Ee(),n=x(!1),d=x(0),i=x(null),u=Xe({name:"",path:null,java:"none",core:"none",coreUrl:"",coreSha256:"",coreFileKey:"",packageFileKey:"",minM:1027,maxM:1027,args:"",ignoreEula:!0}),f={name:[{required:!0,message:"请输入服务器名称",type:"error"}],args:[{required:!0,message:"请输入自定义启动参数",type:"error"}]},r=async({validateResult:_})=>{if(_===!0)try{const y=await Xa(u);d.value=y.serverId,B.success("创建成功"),n.value=!0}catch(y){B.error("创建失败！"+y.message)}else B.warning("请检查表单填写")},c=()=>{n.value=!1,Object.assign(u,{name:"新建服务器",path:null,java:"none",core:"none",packageFileKey:"",coreFileKey:"",coreUrl:"",coreSha256:"",minM:1027,maxM:1027,args:"",ignoreEula:!0})};return(_,y)=>{const M=m("t-input"),$=m("t-form-item"),V=m("t-textarea"),h=m("t-switch"),g=m("t-button"),z=m("t-space"),U=m("t-form"),p=m("t-icon");return o(),C("div",null,[n.value?(o(),C("div",rc,[e(p,{class:"result-success-icon",name:"check-circle"}),t("div",uc,"服务器 ("+I(d.value)+") 已创建成功",1),y[9]||(y[9]=t("div",{class:"result-success-describe"},"你现在可以去服务器列表启动它了",-1)),t("div",null,[e(g,{onClick:y[4]||(y[4]=()=>{c(),k(Ie)("/instance/list")})},{default:a(()=>[...y[7]||(y[7]=[v(" 返回服务端列表 ",-1)])]),_:1}),e(g,{theme:"default",onClick:y[5]||(y[5]=()=>{c(),k(Ie)(`/instance/console/${d.value}`)})},{default:a(()=>[...y[8]||(y[8]=[v(" 前往控制台 ",-1)])]),_:1})])])):(o(),C("div",ic,[e(U,{ref_key:"formRef",ref:i,rules:f,data:u,"label-align":"top",onSubmit:r},{default:a(()=>[e($,{label:"服务器名称",name:"name"},{default:a(()=>[e(M,{modelValue:u.name,"onUpdate:modelValue":y[0]||(y[0]=S=>u.name=S),placeholder:"给你的服务器起一个名字"},null,8,["modelValue"])]),_:1}),e($,{label:"存储路径(可选)",name:"path",help:k(l).userInfo.systemInfo.docker?"您正在使用Docker容器部署，为保数据安全，仅支持使用默认数据路径":"选填，留空将使用默认路径"},{default:a(()=>[e(M,{modelValue:u.path,"onUpdate:modelValue":y[1]||(y[1]=S=>u.path=S),disabled:k(l).userInfo.systemInfo.docker,placeholder:"请填写服务端保存位置"},null,8,["modelValue","disabled"])]),_:1},8,["help"]),e($,{label:"启动指令",name:"args",help:"此模式不会自动帮您配置Java环境，您需要填写完整的启动命令。"},{default:a(()=>[e(V,{modelValue:u.args,"onUpdate:modelValue":y[2]||(y[2]=S=>u.args=S),placeholder:"start.bat...",autosize:{minRows:5,maxRows:25},class:"code-font-textarea"},null,8,["modelValue"])]),_:1}),e($,{label:"忽略EULA提示",name:"args",help:"若您的实例并非MC服务器，可打开此选项"},{default:a(()=>[e(h,{modelValue:u.ignoreEula,"onUpdate:modelValue":y[3]||(y[3]=S=>u.ignoreEula=S),label:["已开启","已关闭"]},null,8,["modelValue"])]),_:1}),e($,{style:{"margin-top":"20px"}},{default:a(()=>[e(z,null,{default:a(()=>[e(g,{theme:"primary",type:"submit"},{default:a(()=>[...y[6]||(y[6]=[v("提交创建",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]))])}}}),cc=ie(dc,[["__scopeId","data-v-8f0c5701"]]),mc={class:"main-layout-container"},pc={class:"steps-aside"},vc={class:"main-content"},fc={key:0,class:"form-step-container"},gc={class:"step-content"},_c={class:"step-content"},hc={class:"select-core-wrapper"},yc={key:1,class:"uploading-state"},bc={class:"core-filename"},wc={key:2,class:"uploading-state"},kc={key:3,class:"selected-core-card"},$c={class:"core-icon"},xc={class:"core-info"},Ac={class:"core-filename"},Cc={class:"core-url"},Sc={class:"step-content"},Ic={key:0},Vc={key:1},Mc={key:0,class:"online-select-area"},Lc={class:"select-core-wrapper"},Uc={key:0,class:"selected-core-card"},Bc={class:"core-icon"},zc={class:"core-info"},Pc={class:"core-filename"},Rc={key:1,class:"online-select-area"},Ec={class:"step-content"},Tc={style:{"margin-top":"6px",display:"flex","flex-direction":"column",gap:"6px"}},Fc={style:{"margin-top":"4px",color:"var(--td-text-color-placeholder)","font-size":"12px"}},Dc={style:{width:"100%"}},Oc={class:"java-option-panel"},jc={key:0,class:"flex-row"},Kc={key:1,class:"flex-row"},Nc={key:2},qc={key:3},Gc={class:"step-content"},Hc={class:"step-content"},Jc={class:"confirm-container"},Wc={class:"confirm-header"},Xc={class:"server-icon-placeholder"},Qc={class:"server-title-info"},Yc={class:"server-name"},Zc={class:"server-path"},em={class:"confirm-item"},tm={class:"value-row"},am=["title"],sm={class:"sub-text"},lm={class:"confirm-item"},nm={class:"value-row"},om=["title"],im={key:0,class:"sub-text"},rm={key:1,class:"sub-text"},um={class:"confirm-item"},dm={class:"value-row"},cm={key:0,class:"main-text"},mm=["title"],pm={key:0,class:"sub-text text-truncate"},vm={class:"confirm-item"},fm={class:"memory-viz"},gm={class:"mem-block"},_m={class:"mem-val"},hm={class:"mem-arrow"},ym={class:"mem-block"},bm={class:"mem-val"},wm={class:"confirm-item"},km={class:"args-box"},$m={key:1,class:"step-content creation-progress"},xm={class:"progress-title"},Am={key:2,class:"result-success"},Cm=se({__name:"PackageMode",setup(s){const l=Ee(),n=x(null),d=sa(),i=x(0),u=x(!1),f=x(!1),r=x(!1),c=x(0),_=x([]),y=x(null),M=x(null),$=x(null),V=x("online"),h=x(!1),g=x([]),z=x(!1),U=x(""),p=x(null),S=x(!1),b=x(0),R=x(""),T=x(""),P=x("online"),G=x([]),N=x([]),E=x(""),w=x(""),A=async(te=!1)=>{try{te&&B.info("正在刷新Java版本列表...");const D=await Ya(l.userInfo.systemInfo.osType.toLowerCase().replace("os",""),l.userInfo.systemInfo.osArchitecture.toLowerCase());D&&Array.isArray(D)&&(G.value=D.map(ne=>({label:`Java ${ne}`,value:ne})),G.value.length>0&&!E.value&&(E.value=G.value[1].value)),N.value=(await Za(te)).map(ne=>({label:`Java ${ne.version}${ne.is64Bit?"":" (32位)"} (${ne.vendor} | ${ne.path})`,value:ne.path})),N.value.length>0&&(w.value=N.value[0].value),te&&B.success("已刷新Java版本列表")}catch(D){B.warning("获取在线Java版本失败: "+D.message)}};Ce(()=>{A()});const L=x({name:"新建整合包服务器",path:"",java:"",core:"",coreUrl:"",coreSha256:"",coreFileKey:"",packageFileKey:"",minM:2048,maxM:6144,args:""}),H=x("GB"),J=x("GB"),X=[{label:"MB",value:"MB"},{label:"GB",value:"GB"}],q=ee({get:()=>H.value==="GB"?L.value.minM/1024:L.value.minM,set:te=>{L.value.minM=H.value==="GB"?Math.round(te*1024):te}}),_e=ee({get:()=>J.value==="GB"?L.value.maxM/1024:L.value.maxM,set:te=>{L.value.maxM=J.value==="GB"?Math.round(te*1024):te}});we([P,E,w],([te,D,ne])=>{te==="env"?L.value.java="java":te==="custom"||te==="local"?L.value.java=ne:te==="online"&&(L.value.java=D?`MSLX://Java/${D}`:""),L.value.java&&n.value?.validate({fields:["java"]})},{immediate:!0});const De=ee(()=>({name:[{required:!0,message:"实例名称不能为空",trigger:"blur"}],packageFileKey:[{required:!0,message:"请上传整合包文件",trigger:"change"}],core:[{validator:te=>{if(g.value.length>0){if(!te)return{result:!1,message:"请选择一个启动Jar",type:"error"}}else{if(V.value==="online"&&!L.value.coreUrl)return{result:!1,message:"请选择服务端核心",type:"error"};if(V.value==="manual"&&!L.value.coreFileKey)return{result:!1,message:"请上传核心文件",type:"error"}}return!0},trigger:"change"}],java:[{required:!0,message:"请配置 Java 环境",trigger:"change"}],minM:[{required:!0,min:1,message:"必须大于0",trigger:"blur"}],maxM:[{required:!0,min:1,message:"必须大于0",trigger:"blur"}]})),fe=[["name","path"],["packageFileKey"],["core","coreUrl","coreFileKey"],["java"],["minM","maxM","args"],[]],Pe=()=>{i.value>0&&(i.value-=1)},Le=async()=>{if(i.value===1){if(!L.value.packageFileKey){B.warning("请先上传服务端整合包(Zip)");return}if(S.value||z.value){B.warning("请等待上传或分析完成");return}}if(i.value===2)if(g.value.length>0){if(!L.value.core){B.warning("请从列表中选择一个启动核心");return}}else{if(V.value==="online"&&(!L.value.coreUrl||!L.value.core)){B.warning("请选择一个服务端核心");return}if(V.value==="manual"&&!L.value.coreFileKey){B.warning("请上传核心文件");return}}const te=await n.value.validate();if(te===!0){i.value<5&&(i.value+=1);return}const D=new Set(fe[i.value]);Object.keys(te).some(me=>D.has(me))?B.warning("请检查当前步骤的输入"):i.value<5&&(i.value+=1)},Ve=()=>{p.value?.click()},Be=te=>{if(te===0)return"0 B";const D=1024,ne=["B","KB","MB","GB"],me=Math.floor(Math.log(te)/Math.log(D));return parseFloat((te/Math.pow(D,me)).toFixed(2))+" "+ne[me]},Oe=async te=>{const D=te.target;if(!D.files||D.files.length===0)return;if(L.value.packageFileKey)try{await Ct(L.value.packageFileKey)}catch(me){console.error(me)}L.value.core="",g.value=[],U.value="";const ne=D.files[0];R.value=ne.name,T.value=Be(ne.size),await ce(ne),D.value=""};let re=null;const ce=async te=>{re&&re.abort(),re=new AbortController,S.value=!0,b.value=0;const ne=te.size>200*1024*1024?50*1024*1024:10*1024*1024,me=Math.ceil(te.size/ne),be=4,he=5,$e=new Map;let Ue=0;const Me=()=>{const Se=Date.now();if(Se-Ue<100)return;Ue=Se;const Ge=Array.from($e.values()).reduce((Te,Y)=>Te+Y,0),Ye=Math.min(Ge/te.size*98,98);b.value=Number(Ye.toFixed(1))};try{const Ge=(await ea()).uploadId;if(!Ge)throw new Error("无法获取上传凭证");const Ye=Array.from({length:me},(Fe,Re)=>Re),Te=async Fe=>{if(re?.signal.aborted)throw new Error("已取消");const Re=Fe*ne,et=Math.min(te.size,Re+ne),ge=te.slice(Re,et);let vt;for(let ft=1;ft<=he;ft++){if(re?.signal.aborted)throw new Error("已取消");try{await ta(Ge,Fe,ge,nt=>{nt&&nt.loaded&&($e.set(Fe,nt.loaded),Me())},re?.signal),$e.set(Fe,ge.size),Me();return}catch(nt){vt=nt,$e.set(Fe,0),Me(),ft<he&&await new Promise(xt=>setTimeout(xt,1e3*ft))}}throw new Error(`分片 ${Fe} 失败: ${vt?.message}`)},Y=async()=>{for(;Ye.length>0&&!re?.signal.aborted;){const Fe=Ye.shift();Fe!==void 0&&await Te(Fe)}},xe=Array(Math.min(be,me)).fill(null).map(()=>Y());if(await Promise.all(xe),re?.signal.aborted)throw new Error("已取消");b.value=99;const qe=(await aa(Ge,me)).uploadId;b.value=100,L.value.packageFileKey=qe,B.success("上传成功，正在分析整合包内容..."),await Ke(qe)}catch(Se){if(Se.message==="已取消")return;re?.abort(),console.error(Se),B.error(`上传失败: ${Se.message||"未知错误"}`),R.value="",b.value=0,L.value.packageFileKey&&(Ct(L.value.packageFileKey).catch(()=>{}),L.value.packageFileKey="")}finally{re?.signal.aborted||(S.value=!1)}},Ke=async te=>{z.value=!0;try{const D=await Fo(te);g.value=D.jars||[],U.value=D.detectedRoot||"",D.count===1&&D.jars.length>0?(L.value.core=D.jars[0],B.success(`自动识别到服务端核心: ${D.jars[0]}`)):D.count>1?B.info(`整合包内检测到 ${D.count} 个服务端核心，请在下一步选择`):B.warning("未检测到整合包内存在服务端核心，请在下一步手动配置核心")}catch(D){B.error("整合包分析失败: "+D.message)}finally{z.value=!1}},le=async()=>{L.value.packageFileKey&&(await Ct(L.value.packageFileKey),L.value.packageFileKey="",R.value="",g.value=[],L.value.core="",B.success("文件已移除"))},F=te=>{L.value.core=te.filename,L.value.coreUrl=te.url,L.value.coreSha256=te.sha256,L.value.coreFileKey="",B.success(`已选择: ${te.core} (${te.version})`)},j=async()=>{if(await n.value.validate()!==!0){B.warning("请检查表单所有内容");return}u.value=!0,_.value=[];const D={...L.value,path:L.value.path||null,coreUrl:L.value.coreUrl||null,coreSha256:L.value.coreSha256||null,coreFileKey:L.value.coreFileKey||null,args:L.value.args||null};g.value.length>0?(D.coreUrl=null,D.coreSha256=null,D.coreFileKey=null):V.value==="manual"?(D.coreUrl=null,D.coreSha256=null):D.coreFileKey=null;try{const me=(await Xa(D)).serverId;if(!me)throw new Error("服务器未返回 ServerId");M.value=me.toString(),f.value=!0,i.value=6,await ae(M.value)}catch(ne){B.error(ne.message||"创建请求失败"),u.value=!1}},ae=async te=>{const{baseUrl:D,token:ne}=l,me=new URL("/api/hubs/creationProgressHub",D||window.location.origin);me.searchParams.append("x-user-token",ne),y.value=new Mt().withUrl(me.toString(),{withCredentials:!1}).configureLogging(Et.Information).build(),y.value.on("StatusUpdate",(be,he,$e)=>{be.toString()===te&&(_.value.push({time:new Date().toLocaleTimeString(),message:he,progress:$e}),bt(()=>{$.value&&($.value.scrollTop=$.value.scrollHeight)}),$e!==null&&$e>=0&&(c.value=$e),$e===100?(B.success("服务器创建成功！"),y.value?.stop(),f.value=!1,r.value=!0,i.value=7,u.value=!1,d.refreshInstanceList()):$e===-1&&(B.error(he||"错误"),y.value?.stop(),f.value=!1,u.value=!1,i.value=0))});try{await y.value.start(),await y.value.invoke("TrackServer",te)}catch(be){console.error("SignalR Error",be)}};Qe(()=>{y.value?.stop()});const pe=()=>{r.value=!1,i.value=0,L.value={name:"新建整合包服务器",path:"",java:"",core:"",coreUrl:"",coreSha256:"",coreFileKey:"",packageFileKey:"",minM:2048,maxM:6144,args:""},g.value=[],R.value="",V.value="online",P.value="online"};return(te,D)=>{const ne=m("t-step-item"),me=m("t-steps"),be=m("t-input"),he=m("t-form-item"),$e=m("t-alert"),Ue=m("t-icon"),Me=m("t-button"),Se=m("t-progress"),Ge=m("t-loading"),Ye=m("t-radio"),Te=m("t-radio-group"),Y=m("t-radio-button"),xe=m("t-tag"),Ne=m("t-space"),qe=m("t-select"),Fe=m("t-input-number"),Re=m("t-col"),et=m("t-row"),ge=m("t-textarea"),vt=m("t-divider"),ft=m("t-form"),nt=m("t-list-item-meta"),xt=m("t-list-item"),xa=m("t-list");return o(),C("div",null,[t("div",mc,[t("div",pc,[e(me,{layout:"vertical",style:{"margin-top":"16px"},current:i.value,status:"process",readonly:""},{default:a(()=>[e(ne,{title:"基本信息",content:"填写实例名称"}),e(ne,{title:"上传整合包",content:"上传服务端 Zip 包"}),e(ne,{title:"核心配置",content:"确认启动的服务端核心"}),e(ne,{title:"Java 环境",content:"配置 Java 运行时"}),e(ne,{title:"资源配置",content:"设置内存参数"}),e(ne,{title:"确认信息",content:"核对并提交"}),e(ne,{title:"创建实例",content:"提交并等待解压"}),e(ne,{title:"完成",content:"查看结果"})]),_:1},8,["current"])]),t("div",vc,[!f.value&&!r.value?(o(),C("div",fc,[e(ft,{ref_key:"formRef",ref:n,data:L.value,rules:De.value,"label-align":"top",class:"step-form",onSubmit:j},{default:a(()=>[Je(t("div",gc,[e(he,{label:"实例名称",name:"name"},{default:a(()=>[e(be,{modelValue:L.value.name,"onUpdate:modelValue":D[0]||(D[0]=Ae=>L.value.name=Ae),placeholder:"为你的服务器起个名字"},null,8,["modelValue"])]),_:1}),e(he,{label:"实例路径",name:"path",help:k(l).userInfo.systemInfo.docker?"您正在使用Docker容器部署，为保数据安全，仅支持使用默认数据路径":"选填，留空将使用默认路径"},{default:a(()=>[e(be,{modelValue:L.value.path,"onUpdate:modelValue":D[1]||(D[1]=Ae=>L.value.path=Ae),disabled:k(l).userInfo.systemInfo.docker,placeholder:"例如: D:\\MyServer"},null,8,["modelValue","disabled"])]),_:1},8,["help"])],512),[[tt,i.value===0]]),Je(t("div",_c,[e($e,{theme:"info",class:"mb-4"},{message:a(()=>[...D[18]||(D[18]=[v(" 请上传包含服务端文件的 ",-1),t("b",null,".zip",-1),v(" 压缩包。上传完成后系统将自动分析包内的服务端核心文件。 ",-1)])]),_:1}),e(he,{label:"上传服务端整合包 (Zip)",name:"packageFileKey"},{default:a(()=>[t("div",hc,[t("input",{ref_key:"uploadInputRef",ref:p,accept:".zip",type:"file",style:{display:"none"},onChange:Oe},null,544),!S.value&&!L.value.packageFileKey?(o(),O(Me,{key:0,variant:"outline",onClick:Ve},{icon:a(()=>[e(Ue,{name:"upload"})]),default:a(()=>[D[19]||(D[19]=v(" 点击选择 Zip 文件并上传 ",-1))]),_:1})):K("",!0),S.value?(o(),C("div",yc,[t("div",bc,"正在上传: "+I(R.value)+" ("+I(T.value)+")",1),e(Se,{theme:"line",percentage:b.value},null,8,["percentage"]),D[20]||(D[20]=t("div",{class:"tip"},"别着急，喝杯咖啡☕️...",-1))])):K("",!0),!S.value&&z.value?(o(),C("div",wc,[e(Ge,{text:"正在分析压缩包结构...",size:"small"})])):K("",!0),L.value.packageFileKey&&!S.value&&!z.value?(o(),C("div",kc,[t("div",$c,[e(Ue,{name:"folder-zip"})]),t("div",xc,[t("div",Ac,I(R.value),1),t("div",Cc,I(g.value.length>0?`发现 ${g.value.length} 个服务端核心文件`:"未发现服务端核心文件")+" "+I(U.value?`| 根目录: /${U.value}`:""),1)]),e(Me,{shape:"circle",variant:"text",theme:"primary",onClick:Ve},{icon:a(()=>[e(Ue,{name:"swap"})]),_:1}),e(Me,{shape:"circle",variant:"text",theme:"danger",onClick:le},{icon:a(()=>[e(Ue,{name:"delete"})]),_:1})])):K("",!0)])]),_:1})],512),[[tt,i.value===1]]),Je(t("div",Sc,[g.value.length>0?(o(),C("div",Ic,[e($e,{theme:"success",class:"mb-4"},{message:a(()=>[...D[21]||(D[21]=[v("我们在压缩包中发现了以下服务端核心文件，请选择哪一个作为",-1),t("b",null,"启动核心",-1),v("。",-1)])]),_:1}),e(he,{label:"选择启动核心",name:"core"},{default:a(()=>[e(Te,{modelValue:L.value.core,"onUpdate:modelValue":D[2]||(D[2]=Ae=>L.value.core=Ae),class:"vertical-radio-group"},{default:a(()=>[(o(!0),C(de,null,ye(g.value,Ae=>(o(),C("div",{key:Ae,class:"jar-option-item"},[e(Ye,{value:Ae},{default:a(()=>[v(I(Ae),1)]),_:2},1032,["value"])]))),128))]),_:1},8,["modelValue"])]),_:1})])):(o(),C("div",Vc,[e($e,{theme:"warning",class:"mb-4"},{message:a(()=>[...D[22]||(D[22]=[v("在上传的包中未发现服务端核心文件。请在此处下载一个服务端核心。",-1)])]),_:1}),e(he,{label:"补充服务端核心"},{default:a(()=>[e(Te,{modelValue:V.value,"onUpdate:modelValue":D[3]||(D[3]=Ae=>V.value=Ae),variant:"default-filled"},{default:a(()=>[e(Y,{value:"online"},{default:a(()=>[...D[23]||(D[23]=[v("在线下载核心",-1)])]),_:1}),e(Y,{disabled:"",value:"manual"},{default:a(()=>[...D[24]||(D[24]=[v("自行上传(不支持)",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),V.value==="online"?(o(),C("div",Mc,[e(he,{label:"选择服务端核心",name:"coreUrl"},{default:a(()=>[t("div",Lc,[e(Me,{variant:"outline",onClick:D[4]||(D[4]=Ae=>h.value=!0)},{icon:a(()=>[e(Ue,{name:"cloud-download"})]),default:a(()=>[D[25]||(D[25]=v(" 打开核心库 ",-1))]),_:1}),L.value.core&&V.value==="online"?(o(),C("div",Uc,[t("div",Bc,[e(Ue,{name:"check-circle-filled"})]),t("div",zc,[t("div",Pc,I(L.value.core),1),D[26]||(D[26]=t("div",{class:"core-url"},"将在创建时自动下载",-1))])])):K("",!0)])]),_:1})])):K("",!0),V.value==="manual"?(o(),C("div",Rc,[D[27]||(D[27]=t("div",{class:"tip-text"},"请在整合包解压后手动放入核心，或在此处不填写等待创建后手动上传。",-1)),e($e,{theme:"error",message:"此模式下建议确保压缩包内包含核心，或者使用在线下载功能。"})])):K("",!0)]))],512),[[tt,i.value===2]]),Je(t("div",Ec,[e($e,{theme:"info",title:"Java 版本选择指南"},{message:a(()=>[t("div",Tc,[e(Ne,{align:"center",size:12},{default:a(()=>[e(xe,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...D[28]||(D[28]=[v("MC 26.1 - 最新版本",-1)])]),_:1}),e(xe,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...D[29]||(D[29]=[v("Java 25",-1)])]),_:1})]),_:1}),e(Ne,{align:"center",size:12},{default:a(()=>[e(xe,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...D[30]||(D[30]=[v("MC 1.20.5 - 1.21.11",-1)])]),_:1}),e(xe,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...D[31]||(D[31]=[v("Java 21",-1)])]),_:1})]),_:1}),e(Ne,{align:"center",size:12},{default:a(()=>[e(xe,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...D[32]||(D[32]=[v("MC 1.18 - 1.20.4",-1)])]),_:1}),e(xe,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...D[33]||(D[33]=[v("Java 17",-1)])]),_:1})]),_:1}),e(Ne,{align:"center",size:12},{default:a(()=>[e(xe,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...D[34]||(D[34]=[v("MC 1.17 / 1.17.1",-1)])]),_:1}),e(xe,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...D[35]||(D[35]=[v("Java 16",-1)])]),_:1})]),_:1}),e(Ne,{align:"center",size:12},{default:a(()=>[e(xe,{theme:"default",variant:"outline",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...D[36]||(D[36]=[v("MC 1.13 - 更低版本",-1)])]),_:1}),e(xe,{theme:"default",variant:"light",shape:"round"},{default:a(()=>[...D[37]||(D[37]=[v("Java 8",-1)])]),_:1})]),_:1}),t("div",Fc,[e(Ue,{name:"info-circle",size:"small",style:{"margin-right":"4px"}}),D[38]||(D[38]=v(" 建议直接使用推荐版本，避免兼容性问题。 ",-1))])])]),_:1}),e(he,{label:"Java 来源",name:"java"},{default:a(()=>[t("div",Dc,[e(Te,{modelValue:P.value,"onUpdate:modelValue":D[5]||(D[5]=Ae=>P.value=Ae),variant:"default-filled"},{default:a(()=>[e(Y,{value:"online"},{default:a(()=>[...D[39]||(D[39]=[v("在线下载",-1)])]),_:1}),e(Y,{value:"local"},{default:a(()=>[...D[40]||(D[40]=[v("本机 Java",-1)])]),_:1}),e(Y,{value:"env"},{default:a(()=>[...D[41]||(D[41]=[v("环境变量",-1)])]),_:1}),e(Y,{value:"custom"},{default:a(()=>[...D[42]||(D[42]=[v("自定义路径",-1)])]),_:1})]),_:1},8,["modelValue"]),t("div",Oc,[P.value==="online"?(o(),C("div",jc,[e(qe,{modelValue:E.value,"onUpdate:modelValue":D[6]||(D[6]=Ae=>E.value=Ae),options:G.value,placeholder:"请选择 Java 版本"},null,8,["modelValue","options"])])):K("",!0),P.value==="local"?(o(),C("div",Kc,[e(qe,{modelValue:w.value,"onUpdate:modelValue":D[7]||(D[7]=Ae=>w.value=Ae),options:N.value,placeholder:"请选择 Java"},null,8,["modelValue","options"]),e(Me,{variant:"text",onClick:D[8]||(D[8]=Ae=>A(!0))},{default:a(()=>[...D[43]||(D[43]=[v("刷新",-1)])]),_:1})])):K("",!0),P.value==="env"?(o(),C("div",Nc,[e(be,{"model-value":"java",readonly:"",disabled:""})])):K("",!0),P.value==="custom"?(o(),C("div",qc,[e(be,{modelValue:w.value,"onUpdate:modelValue":D[9]||(D[9]=Ae=>w.value=Ae),placeholder:"C:\\Path\\To\\java.exe"},null,8,["modelValue"])])):K("",!0)])])]),_:1})],512),[[tt,i.value===3]]),Je(t("div",Gc,[e(et,{gutter:[16,24]},{default:a(()=>[e(Re,{xs:12,span:6},{default:a(()=>[e(he,{label:"最小内存",name:"minM"},{default:a(()=>[e(Ne,{size:8,style:{width:"100%"}},{default:a(()=>[e(Fe,{modelValue:q.value,"onUpdate:modelValue":D[10]||(D[10]=Ae=>q.value=Ae),min:0,"decimal-places":H.value==="GB"?1:0,placeholder:"Xms",theme:"column",style:{width:"100%"}},null,8,["modelValue","decimal-places"]),e(qe,{modelValue:H.value,"onUpdate:modelValue":D[11]||(D[11]=Ae=>H.value=Ae),options:X,clearable:!1,style:{width:"80px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Re,{xs:12,span:6},{default:a(()=>[e(he,{label:"最大内存",name:"maxM"},{default:a(()=>[e(Ne,{size:8,style:{width:"100%"}},{default:a(()=>[e(Fe,{modelValue:_e.value,"onUpdate:modelValue":D[12]||(D[12]=Ae=>_e.value=Ae),min:0,"decimal-places":J.value==="GB"?1:0,placeholder:"Xmx",theme:"column",style:{width:"100%"}},null,8,["modelValue","decimal-places"]),e(qe,{modelValue:J.value,"onUpdate:modelValue":D[13]||(D[13]=Ae=>J.value=Ae),options:X,clearable:!1,style:{width:"80px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(he,{label:"JVM 参数",name:"args",style:{"margin-top":"16px"}},{default:a(()=>[e(ge,{modelValue:L.value.args,"onUpdate:modelValue":D[14]||(D[14]=Ae=>L.value.args=Ae),placeholder:"-XX:+UseG1GC"},null,8,["modelValue"])]),_:1})],512),[[tt,i.value===4]]),Je(t("div",Hc,[t("div",Jc,[t("div",Wc,[t("div",Xc,[e(Ue,{name:"server",size:"32px"})]),t("div",Qc,[t("div",Yc,I(L.value.name),1),t("div",Zc,[e(Ue,{name:"folder-open",size:"small"}),v(" "+I(L.value.path||"默认数据路径 (/DaemonData/Servers)"),1)])])]),e(vt,{dashed:"",style:{margin:"16px 0"}}),e(et,{gutter:[24,24]},{default:a(()=>[e(Re,{span:6},{default:a(()=>[t("div",em,[D[45]||(D[45]=t("div",{class:"label"},"服务端整合包",-1)),t("div",tm,[t("span",{class:"main-text text-truncate",title:R.value},I(R.value),9,am),e(xe,{theme:"primary",variant:"light",size:"small"},{default:a(()=>[...D[44]||(D[44]=[v("ZIP",-1)])]),_:1})]),t("div",sm,"大小: "+I(T.value||"未知"),1)])]),_:1}),e(Re,{span:6},{default:a(()=>[t("div",lm,[D[49]||(D[49]=t("div",{class:"label"},"启动核心 (Jar)",-1)),t("div",nm,[t("span",{class:"main-text text-truncate",title:L.value.core},I(L.value.core),9,om),g.value.length>0?(o(),O(xe,{key:0,theme:"success",variant:"light",size:"small"},{default:a(()=>[...D[46]||(D[46]=[v(" 整合包内核心 ",-1)])]),_:1})):V.value==="online"?(o(),O(xe,{key:1,theme:"primary",variant:"light",size:"small"},{default:a(()=>[...D[47]||(D[47]=[v(" 在线下载 ",-1)])]),_:1})):(o(),O(xe,{key:2,theme:"warning",variant:"light",size:"small"},{default:a(()=>[...D[48]||(D[48]=[v("手动配置",-1)])]),_:1}))]),g.value.length>0?(o(),C("div",im,"已从压缩包中选定启动文件")):V.value==="online"?(o(),C("div",rm," 来源: MSL 镜像源 ("+I(L.value.coreUrl?"已匹配":"未匹配")+") ",1)):K("",!0)])]),_:1}),e(Re,{span:6},{default:a(()=>[t("div",um,[D[53]||(D[53]=t("div",{class:"label"},"Java 运行时",-1)),t("div",dm,[P.value==="online"?(o(),C("span",cm," Java "+I(E.value),1)):(o(),C("span",{key:1,class:"main-text text-truncate",title:L.value.java},I(L.value.java),9,mm)),P.value==="online"?(o(),O(xe,{key:2,theme:"success",variant:"light",size:"small"},{default:a(()=>[...D[50]||(D[50]=[v(" 自动安装 ",-1)])]),_:1})):P.value==="local"?(o(),O(xe,{key:3,theme:"primary",variant:"light",size:"small"},{default:a(()=>[...D[51]||(D[51]=[v(" 本机环境 ",-1)])]),_:1})):(o(),O(xe,{key:4,theme:"default",variant:"light",size:"small"},{default:a(()=>[...D[52]||(D[52]=[v("自定义",-1)])]),_:1}))]),P.value==="online"?(o(),C("div",pm," 将自动从镜像源下载并解压 JDK ")):K("",!0)])]),_:1}),e(Re,{span:6},{default:a(()=>[t("div",vm,[D[56]||(D[56]=t("div",{class:"label"},"内存分配 (JVM)",-1)),t("div",fm,[t("div",gm,[D[54]||(D[54]=t("span",{class:"mem-label"},"初始 (Xms)",-1)),t("span",_m,I(q.value)+" "+I(H.value),1)]),t("div",hm,[e(Ue,{name:"arrow-right"})]),t("div",ym,[D[55]||(D[55]=t("span",{class:"mem-label"},"最大 (Xmx)",-1)),t("span",bm,I(_e.value)+" "+I(J.value),1)])])])]),_:1}),L.value.args?(o(),O(Re,{key:0,span:12},{default:a(()=>[t("div",wm,[D[57]||(D[57]=t("div",{class:"label"},"启动参数",-1)),t("div",km,I(L.value.args),1)])]),_:1})):K("",!0)]),_:1}),e($e,{style:{"margin-top":"24px"},theme:"info"},{message:a(()=>[...D[58]||(D[58]=[v(" 确认无误后点击下方 ",-1),t("b",null,"提交创建",-1),v("，系统自动部署服务端。 ",-1)])]),_:1})])],512),[[tt,i.value===5]]),e(he,{class:"step-actions",style:{"margin-top":"16px"}},{default:a(()=>[i.value>0?(o(),O(Me,{key:0,theme:"default",onClick:Pe},{default:a(()=>[...D[59]||(D[59]=[v("上一步",-1)])]),_:1})):K("",!0),i.value<5?(o(),O(Me,{key:1,type:"button",loading:S.value||z.value,onClick:Le},{default:a(()=>[...D[60]||(D[60]=[v("下一步",-1)])]),_:1},8,["loading"])):K("",!0),i.value===5?(o(),O(Me,{key:2,theme:"primary",type:"submit",loading:u.value},{default:a(()=>[...D[61]||(D[61]=[v("提交创建",-1)])]),_:1},8,["loading"])):K("",!0)]),_:1})]),_:1},8,["data","rules"])])):K("",!0),f.value?(o(),C("div",$m,[t("div",xm,"正在创建整合包实例 ("+I(M.value)+")",1),D[62]||(D[62]=t("p",null,"正在解压文件并配置环境...",-1)),e(Se,{theme:"plump",percentage:c.value,label:`${c.value.toFixed(2)}%`},null,8,["percentage","label"]),t("div",{ref_key:"logContainerRef",ref:$,class:"log-container"},[e(xa,{split:!0},{default:a(()=>[(o(!0),C(de,null,ye(_.value,(Ae,Z)=>(o(),O(xt,{key:Z},{default:a(()=>[e(nt,{description:`[${Ae.time}] ${Ae.message}`},null,8,["description"])]),_:2},1024))),128))]),_:1})],512)])):K("",!0),r.value?(o(),C("div",Am,[e(Ue,{class:"result-success-icon",name:"check-circle"}),D[65]||(D[65]=t("div",{class:"result-success-title"},"整合包服务器已部署成功",-1)),D[66]||(D[66]=t("div",{class:"result-success-describe"},"文件已解压，环境已配置就绪",-1)),t("div",null,[e(Me,{onClick:D[15]||(D[15]=()=>{pe(),k(Ie)("/instance/list")})},{default:a(()=>[...D[63]||(D[63]=[v(" 返回服务端列表 ",-1)])]),_:1}),e(Me,{theme:"default",onClick:D[16]||(D[16]=()=>{pe(),k(Ie)(`/instance/console/${M.value}`)})},{default:a(()=>[...D[64]||(D[64]=[v(" 前往控制台 ",-1)])]),_:1})])])):K("",!0)])]),e(Qa,{visible:h.value,"onUpdate:visible":D[17]||(D[17]=Ae=>h.value=Ae),onConfirm:F},null,8,["visible"])])}}}),Sm=ie(Cm,[["__scopeId","data-v-dc20309d"]]),Im=se({__name:"index",setup(s){const l=x(1);return(n,d)=>{const i=m("t-tab-panel"),u=m("t-tabs"),f=m("t-card");return o(),C("div",null,[e(f,{direction:"vertical"},{default:a(()=>[e(u,{modelValue:l.value,"onUpdate:modelValue":d[0]||(d[0]=r=>l.value=r)},{default:a(()=>[e(i,{value:1,label:"快速模式","destroy-on-hide":!1},{default:a(()=>[e(oc,{style:{margin:"10px"}})]),_:1}),e(i,{value:2,label:"上传整合包模式","destroy-on-hide":!1},{default:a(()=>[e(Sm,{style:{margin:"10px"}})]),_:1}),e(i,{value:3,label:"自定义模式","destroy-on-hide":!1},{default:a(()=>[e(cc,{style:{margin:"10px"}})]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}}),Vm=Object.freeze(Object.defineProperty({__proto__:null,default:Im},Symbol.toStringTag,{value:"Module"})),Mm={class:"backup-page-container"},Lm={class:"page-header"},Um={key:0,class:"loading-wrapper"},Bm={key:1,class:"card-list"},zm={class:"card-header"},Pm={class:"header-left"},Rm={class:"instance-info"},Em={class:"instance-name"},Tm={class:"instance-core"},Fm={class:"header-right"},Dm={class:"path-section"},Om=["onClick"],jm={key:0,class:"backup-table-area"},Km={key:0,class:"table-toolbar"},Nm={class:"selected-count"},qm={class:"file-name-cell"},Gm=["title"],Hm={class:"op-buttons"},Jm={key:1,class:"empty-backups"},Wm=se({__name:"index",setup(s){const l=x(!1),n=x([]),d=x(new Set),i=x({}),u=[{colKey:"row-select",type:"multiple",width:30,fixed:"left"},{colKey:"fileName",title:"文件名",ellipsis:!0},{colKey:"fileSizeStr",title:"大小",width:100},{colKey:"createTime",title:"创建时间",width:180},{colKey:"op",title:"操作",width:140,fixed:"right"}],f=ee(()=>[...n.value].sort((g,z)=>{const U=g.backups&&g.backups.length>0,p=z.backups&&z.backups.length>0;return U&&!p?-1:!U&&p?1:g.id-z.id})),r=async()=>{l.value=!0;try{const h=await rr();n.value=h||[]}catch(h){B.error("获取备份列表失败"),console.error(h)}finally{l.value=!1}},c=h=>{d.value.has(h)?d.value.delete(h):d.value.add(h)},_=(h,g)=>{const z=Fa(h,g);window.open(z,"_blank")},y=async(h,g)=>{const z=at.confirm({header:"确认删除",body:`确定要删除选中的 ${g.length} 个备份文件吗？此操作不可恢复。`,theme:"danger",onConfirm:async()=>{z.hide();const U=B.loading("正在删除中...");try{const p=g.map(S=>Ta(h,S));await Promise.all(p),B.success("删除成功"),i.value[h]&&(i.value[h]=[]),await r()}catch(p){B.error("部分文件删除失败，请重试 "+p.message)}finally{B.close(U)}}})},M=(h,g)=>{y(h,[g])},$=h=>{const g=i.value[h];if(!g||g.length===0){B.warning("请先选择要删除的文件");return}y(h,g)},V=(h,{_row:g},z)=>{i.value={...i.value,[z]:h}};return Ce(()=>{r()}),(h,g)=>{const z=m("t-button"),U=m("t-loading"),p=m("t-tag"),S=m("t-table"),b=m("t-card");return o(),C("div",Mm,[t("div",Lm,[g[1]||(g[1]=t("div",{class:"title-area"},[t("h2",{class:"page-title"},"实例备份管理"),t("p",{class:"page-desc"},"管理所有服务器实例的本地备份文件")],-1)),e(z,{theme:"primary",variant:"text",loading:l.value,onClick:r},{icon:a(()=>[e(k(st))]),default:a(()=>[g[0]||(g[0]=v(" 刷新列表 ",-1))]),_:1},8,["loading"])]),l.value&&n.value.length===0?(o(),C("div",Um,[e(U,{text:"加载数据中...",size:"small"})])):(o(),C("div",Bm,[e(bl,{name:"list-anim"},{default:a(()=>[(o(!0),C(de,null,ye(f.value,R=>(o(),C("div",{key:R.id,class:"instance-card-wrapper"},[e(b,{bordered:!1,class:ke(["instance-card",{"is-empty":!R.backups?.length}])},{default:a(()=>[t("div",zm,[t("div",Pm,[e(p,{theme:"primary",variant:"light",shape:"mark"},{default:a(()=>[v("ID: "+I(R.id),1)]),_:2},1024),t("div",Rm,[t("h3",Em,[e(k(wt),{class:"icon-mr"}),v(" "+I(R.name),1)]),t("span",Tm,[e(k(Vt),{class:"icon-mr"}),v(" "+I(R.core),1)])])]),t("div",Fm,[R.backups?.length?(o(),O(p,{key:0,theme:"success",variant:"outline"},{default:a(()=>[v(I(R.backups.length)+" 个备份 ",1)]),_:2},1024)):(o(),O(p,{key:1,theme:"default",disabled:""},{default:a(()=>[...g[2]||(g[2]=[v("无备份",-1)])]),_:1}))])]),t("div",Dm,[t("div",{class:"path-toggle",onClick:T=>c(R.id)},[e(k(wl)),g[3]||(g[3]=t("span",{class:"label"},"存储路径",-1)),(o(),O(ot(d.value.has(R.id)?k(kl):k($l)),{class:"toggle-icon"}))],8,Om),Je(t("div",{class:"path-content"},I(R.backupPath),513),[[tt,d.value.has(R.id)]])]),R.backups?.length?(o(),C("div",jm,[i.value[R.id]?.length>0?(o(),C("div",Km,[t("span",Nm,"已选 "+I(i.value[R.id].length)+" 项",1),e(z,{theme:"danger",variant:"text",size:"small",onClick:T=>$(R.id)},{default:a(()=>[...g[4]||(g[4]=[v(" 批量删除 ",-1)])]),_:1},8,["onClick"])])):K("",!0),e(S,{"row-key":"fileName",data:R.backups,columns:u,"selected-row-keys":i.value[R.id]||[],size:"small",hover:!0,pagination:R.backups.length>5?{pageSize:5}:null,onSelectChange:(T,P)=>V(T,P,R.id)},{fileName:a(({row:T})=>[t("div",qm,[g[5]||(g[5]=t("span",{class:"zip-icon"},"ZIP",-1)),t("span",{class:"text",title:T.fileName},I(T.fileName),9,Gm)])]),op:a(({row:T})=>[t("div",Hm,[e(z,{theme:"primary",variant:"text",size:"small",onClick:P=>_(R.id,T.fileName)},{icon:a(()=>[e(k(fa))]),default:a(()=>[g[6]||(g[6]=v(" 下载 ",-1))]),_:1},8,["onClick"]),e(z,{theme:"danger",variant:"text",size:"small",onClick:P=>M(R.id,T.fileName)},{icon:a(()=>[e(k($t))]),default:a(()=>[g[7]||(g[7]=v(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:2},1032,["data","columns","selected-row-keys","pagination","onSelectChange"])])):(o(),C("div",Jm,[...g[8]||(g[8]=[t("span",{class:"empty-text"},"当前实例暂无备份文件",-1)])]))]),_:2},1032,["class"])]))),128))]),_:1})]))])}}}),Xm=ie(Wm,[["__scopeId","data-v-02bc58e2"]]),Qm=Object.freeze(Object.defineProperty({__proto__:null,default:Xm},Symbol.toStringTag,{value:"Module"})),Ym={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function Zm(s,l){return o(),C("svg",Ym,[...l[0]||(l[0]=[Tt('<g mask="url(#mask0_17_619)"><path fill="#97A3B7" d="M30 62h88v60H30z"></path><g filter="url(#filter0_f_17_619)"><path fill="#E3E6EB" d="M12 84h80v60H12z"></path></g><g filter="url(#filter1_f_17_619)"><path fill="#E3E6EB" d="M80 54h80v60H80z"></path></g><path fill="#fff" d="M46 105h32v2H46zM46 98h32v2H46zM46 88h16v2H46z"></path></g><path fill="currentcolor" d="M63 20h88v10H63z" opacity=".9"></path><mask id="a" width="88" height="50" x="63" y="30" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="currentcolor" d="M63 30h88v50H63z"></path></mask><g mask="url(#a)"><path fill="currentcolor" d="M63 30h88v50H63z"></path><g filter="url(#filter2_f_17_619)" opacity=".3"><path fill="#97A3B7" d="M30 62h88v60H30z"></path></g></g><path fill="#fff" fill-rule="evenodd" d="m95.686 40.858 10.278 10.277A4 4 0 0 1 107 51c2.213 0 4 1.786 4 4q-.002.538-.134 1.033l10.276 10.28-2.828 2.829-4.598-4.597A17.1 17.1 0 0 1 107 65.909c-7.273 0-13.484-4.524-16-10.91a17.3 17.3 0 0 1 5.696-7.472l-3.838-3.84zM99 55a8.003 8.003 0 0 0 12.063 6.892l-3.029-3.026q-.496.132-1.034.134c-2.213 0-4-1.787-4-4q.002-.538.134-1.034l-3.027-3.027A7.96 7.96 0 0 0 99 54.999m8-10.91c7.273 0 13.484 4.524 16 10.91a17.3 17.3 0 0 1-4.166 6.177l-4.105-4.105a8.003 8.003 0 0 0-9.801-9.8l-2.55-2.551c1.47-.41 3.02-.63 4.622-.63" clip-rule="evenodd"></path><path fill="#fff" d="M68 24h2v2h-2zM74 24h2v2h-2zM80 24h66v2H80z"></path><path fill="#fff" stroke="#000" d="m157 54 24.249 42h-48.498z"></path><path stroke="#000" d="M157 89V71"></path>',8)])])}const gs={render:Zm},ep={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function tp(s,l){return o(),C("svg",ep,[...l[0]||(l[0]=[Tt('<g mask="url(#mask0_16559_24301)"><path fill="#97A3B7" d="M30 62h88v60H30z"></path><g filter="url(#filter0_f_16559_24301)"><path fill="#E3E6EB" d="M12 84h80v60H12z"></path></g><g filter="url(#filter1_f_16559_24301)"><path fill="#E3E6EB" d="M80 54h80v60H80z"></path></g><path stroke="#fff" stroke-width="2" d="m49 93-7 7 7 7M69 107l7-7-7-7M62.365 87.443l-6.73 25.114"></path></g><path fill="currentcolor" d="M63 20h88v10H63z" opacity=".9"></path><mask id="a" width="88" height="50" x="63" y="30" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="currentcolor" d="M63 30h88v50H63z"></path></mask><g mask="url(#a)"><path fill="currentcolor" d="M63 30h88v50H63z"></path><g filter="url(#filter2_f_16559_24301)" opacity=".3"><path fill="#97A3B7" d="M30 62h88v60H30z"></path></g></g><path fill="#fff" fill-rule="evenodd" d="M105.25 41c6.765 0 12.25 5.484 12.25 12.25 0 2.433-.709 4.7-1.932 6.606L121 65.288 117.288 69l-5.432-5.432a12.2 12.2 0 0 1-6.606 1.932C98.484 65.5 93 60.016 93 53.25S98.484 41 105.25 41m0 3.5a8.75 8.75 0 1 0 0 17.5 8.75 8.75 0 0 0 0-17.5" clip-rule="evenodd"></path><path fill="#fff" d="M68 24h2v2h-2zM74 24h2v2h-2zM80 24h66v2H80z"></path><path fill="#fff" fill-rule="evenodd" d="M153 56c-12.15 0-22 9.85-22 22 0 4.604 1.414 8.878 3.832 12.41L127 98.5l12.495-3.132A21.9 21.9 0 0 0 153 100c12.15 0 22-9.85 22-22s-9.85-22-22-22" clip-rule="evenodd"></path><path fill="#000" d="M131 78h.5zm3.832 12.41.359.348.284-.293-.23-.337zM127 98.5l-.359-.348-1.219 1.259 1.7-.426zm12.495-3.132.307-.394-.192-.15-.237.06zM153 100v.5zm22-22h-.5zm-43.5 0c0-11.874 9.626-21.5 21.5-21.5v-1c-12.426 0-22.5 10.074-22.5 22.5zm3.745 12.128A21.4 21.4 0 0 1 131.5 78h-1c0 4.708 1.446 9.08 3.919 12.693zm-.772-.066-7.832 8.09.718.696 7.832-8.09zm-7.351 8.923 12.494-3.132-.243-.97-12.495 3.132zM153 99.5c-4.976 0-9.555-1.69-13.198-4.526l-.615.789A22.4 22.4 0 0 0 153 100.5zM174.5 78c0 11.874-9.626 21.5-21.5 21.5v1c12.426 0 22.5-10.074 22.5-22.5zM153 56.5c11.874 0 21.5 9.626 21.5 21.5h1c0-12.426-10.074-22.5-22.5-22.5z"></path>',8)])])}const ap={render:tp},sp={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function lp(s,l){return o(),C("svg",sp,[...l[0]||(l[0]=[Tt('<g mask="url(#mask0_16559_24251)"><path fill="#97A3B7" d="m68 48 38.105 22v44L68 136l-38.105-22V70z"></path><g filter="url(#a)"><path fill="#E3E6EB" d="M46.391 92h80v60h-80z"></path></g><g filter="url(#b)"><path fill="#E3E6EB" d="M0 23h80v60H0z"></path></g></g><mask id="c" width="78" height="88" x="80" y="9" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="currentcolor" d="m119 9 38.105 22v44L119 97 80.895 75V31z"></path></mask><g mask="url(#c)"><path fill="currentcolor" fill-rule="evenodd" d="M80.895 31v44L119 97l38.105-22V31L119 53z" clip-rule="evenodd"></path><path fill="currentcolor" d="m119-35 38.105 22v44.5L119 53.5l-38.105-22V-13z" opacity=".9"></path><g filter="url(#d)" opacity=".3"><path fill="#97A3B7" d="m68 48 38.105 22v44L68 136l-38.105-22V70z"></path></g></g><path fill="#fff" stroke="#000" d="m143 68.822 4.867 17.053.133.466.469-.118 17.202-4.312-12.335 12.741-.337.348.337.348 12.335 12.741-17.202-4.312-.469-.118-.133.466L143 121.178l-4.867-17.053-.133-.466-.469.118-17.202 4.312 12.335-12.741.337-.348-.337-.348-12.335-12.741 17.202 4.312.469.118.133-.466z"></path><path fill="#fff" fill-rule="evenodd" d="m123.243 35.082 2.828-1.633-2.828-1.633-2.829 1.633zM119 32.632 121.828 31l-7.071-4.082-2.828 1.633zm8.485 3.267c-4.679 2.701-12.291 2.701-16.97 0-4.68-2.702-4.68-7.096 0-9.798s12.291-2.701 16.97 0c4.68 2.702 4.68 7.096 0 9.798m-19.799-11.43c-6.248 3.607-6.248 9.455 0 13.062s16.38 3.607 22.628 0 6.248-9.455 0-13.062-16.38-3.607-22.628 0M41.899 86.286l2.828 1.633v6.532L41.9 92.818zm12.02 6.94 2.829 1.634v6.532l-2.828-1.633zm-9.19 14.289-2.83-1.633.001 3.266 2.828 1.633zl9.192 5.307v3.266l2.828 1.633v-3.266l-2.828-1.633v-3.266l-9.192-5.307z" clip-rule="evenodd"></path><defs><filter id="a" width="180" height="160" x="-3.609" y="42" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_16559_24251" stdDeviation="25"></feGaussianBlur></filter><filter id="b" width="180" height="160" x="-50" y="-27" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_16559_24251" stdDeviation="25"></feGaussianBlur></filter><filter id="d" width="88.21" height="100" x="23.895" y="42" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_16559_24251" stdDeviation="3"></feGaussianBlur></filter></defs>',6)])])}const np={render:lp},op={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function ip(s,l){return o(),C("svg",op,[...l[0]||(l[0]=[Tt('<g mask="url(#mask0_22_990)"><path fill="#97A3B7" fill-rule="evenodd" d="m144.569 105.61-48 27.712-48-27.712V83.712L96.57 56l48 27.713z" clip-rule="evenodd"></path><g filter="url(#filter0_f_22_990)"><path fill="#E3E6EB" d="M-3 33.999h80v60H-3z"></path></g><g filter="url(#filter1_f_22_990)"><path fill="#E3E6EB" d="M97 97.999h80v60H97z"></path></g></g><mask id="a" width="86" height="69" x="53" y="16" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="currentcolor" fill-rule="evenodd" d="m113.357 42.715 16.472-9.51a36 36 0 0 0-3.186-2.043c-5.375-3.104-11.92-5.147-18.885-6.139-4.209-5.562-10.18-8.898-17.324-8.828-6.755.087-15.486 5.746-21.507 14.365q-1.247.622-2.432 1.306c-14.378 8.3-16.94 20.75-7.473 30.065-1.035-5.805-.31-10.865 3.101-16.215-.058.632-.21 4.427-.232 5.067-.67 18.914 15.02 34.058 26.139 33.928 8.45-.1 15.565-5.013 20.319-12.631 6.214-1.231 12.089-3.294 17.094-6.183 13.476-7.78 16.567-19.182 9.104-28.268l-16.599 9.582c1.762 3.654.049 7.823-5.078 10.783-5.126 2.96-12.347 3.948-18.677 2.931-2.843-.469-5.522-1.342-7.74-2.622l-.049-.028zM78.655 53.773c-6.127-3.977-5.683-10.226 1.195-14.197s17.703-4.226 24.591-.69zM93.556 18.17c4.61-.04 8.728 2.405 11.94 6.57-8.447-.918-17.384-.326-25.523 1.765 3.699-5.124 8.471-8.275 13.583-8.335m-2.232 63.447c-5.853.068-10.971-3.926-14.377-10.332 8.845 2.342 18.925 2.775 28.427 1.317-3.756 5.52-8.714 8.951-14.05 9.015" clip-rule="evenodd"></path></mask><g mask="url(#a)"><path fill="currentcolor" fill-rule="evenodd" d="m113.357 42.715 16.472-9.51a36 36 0 0 0-3.186-2.043c-5.375-3.104-11.92-5.147-18.885-6.139-4.209-5.562-10.18-8.898-17.324-8.828-6.755.087-15.486 5.746-21.507 14.365q-1.247.622-2.432 1.306c-14.378 8.3-16.94 20.75-7.473 30.065-1.035-5.805-.31-10.865 3.101-16.215-.058.632-.21 4.427-.232 5.067-.67 18.914 15.02 34.058 26.139 33.928 8.45-.1 15.565-5.013 20.319-12.631 6.214-1.231 12.089-3.294 17.094-6.183 13.476-7.78 16.567-19.182 9.104-28.268l-16.599 9.582c1.762 3.654.049 7.823-5.078 10.783-5.126 2.96-12.347 3.948-18.677 2.931-2.843-.469-5.522-1.342-7.74-2.622l-.049-.028zM78.655 53.773c-6.127-3.977-5.683-10.226 1.195-14.197s17.703-4.226 24.591-.69zM93.556 18.17c4.61-.04 8.728 2.405 11.94 6.57-8.447-.918-17.384-.326-25.523 1.765 3.699-5.124 8.471-8.275 13.583-8.335m-2.232 63.447c-5.853.068-10.971-3.926-14.377-10.332 8.845 2.342 18.925 2.775 28.427 1.317-3.756 5.52-8.714 8.951-14.05 9.015" clip-rule="evenodd"></path><g filter="url(#filter2_f_22_990)" opacity=".3"><path fill="#97A3B7" d="m96.569 56 48 27.712v55.426l-48 27.712-48-27.712V83.712z"></path></g></g><circle cx="155" cy="78" r="22" fill="#fff" stroke="#000" transform="rotate(180 155 78)"></circle><path stroke="#000" d="M155 83V65"></path><path fill="#C4C4C4" stroke="#000" stroke-linejoin="round" stroke-width="2" d="M155 87h.004v.004H155z"></path><path stroke="#fff" stroke-width="2" d="M96.57 112V88M86.57 98l10-10 9.999 10"></path>',7)])])}const rp={render:ip},up={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function dp(s,l){return o(),C("svg",up,[...l[0]||(l[0]=[Tt('<g mask="url(#mask0_21_716)"><path fill="#97A3B7" fill-rule="evenodd" d="M33 46.843 96.321 119l63.322-72.157C142.742 32 120.583 23 96.321 23 72.061 23 49.901 32 33 46.843" clip-rule="evenodd"></path><g filter="url(#filter0_f_21_716)"><path fill="#E3E6EB" d="M95 21h80v60H95z"></path></g><g filter="url(#filter1_f_21_716)"><path fill="#E3E6EB" d="M-7 43h80v60H-7z"></path></g></g><path fill="currentcolor" d="m72.812 63.688-3.157 3.157 6.246 6.247a50.3 50.3 0 0 0-12.713 8.151L96.321 119l11.913-13.575 6.413 6.412 3.157-3.157L80.45 71.326zM129.455 81.243l-15.318 17.455-28.74-28.74a50.4 50.4 0 0 1 10.924-1.19c12.695 0 24.29 4.709 33.134 12.475"></path><path fill="#fff" stroke="#000" d="m152 21.822 4.867 17.053.133.465.469-.117 17.202-4.312-12.335 12.741-.337.348.337.348 12.335 12.741-17.202-4.312-.469-.117-.133.465L152 74.178l-4.867-17.053-.133-.465-.469.117-17.202 4.312 12.335-12.741.337-.348-.337-.348-12.335-12.741 17.202 4.312.469.117.133-.465z"></path><path stroke="#fff" stroke-width="2" d="M101 31 90 42l11 11-8 8"></path>',4)])])}const cp={render:dp},mp={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function pp(s,l){return o(),C("svg",mp,[...l[0]||(l[0]=[Tt('<mask id="a" width="78" height="88" x="80" y="9" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="currentColor" d="m119 9 38.105 22v44L119 97 80.895 75V31z"></path></mask><g mask="url(#a)"><path fill="currentColor" d="m119 9 38.105 22v44L119 97 80.895 75V31z"></path><g filter="url(#b)" opacity=".3"><path fill="#97A3B7" d="m68 48 38.105 22v44L68 136l-38.105-22V70z"></path></g></g><mask id="c" width="78" height="88" x="29" y="48" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="#97A3B7" d="m68 48 38.105 22v44L68 136l-38.105-22V70z"></path></mask><g mask="url(#c)"><path fill="#97A3B7" d="m68 48 38.105 22v44L68 136l-38.105-22V70z"></path><g filter="url(#d)"><path fill="#E3E6EB" d="M46.391 92h80v60h-80z"></path></g><g filter="url(#e)"><path fill="#E3E6EB" d="M0 23h80v60H0z"></path></g></g><path fill="#fff" d="m41.898 86.287 2.829 1.633v6.531l-2.828-1.632zM53.919 93.227l2.828 1.633v6.532l-2.828-1.633zM44.728 107.515l-2.829-1.633v3.266l2.829 1.633zl9.191 5.308v3.265l2.829 1.633v-3.266l-2.828-1.632v-3.266l-9.193-5.308z"></path><path fill="#fff" fill-rule="evenodd" d="M108.348 23.48c-2.16 2.51-1.813 5.903 1.047 8.08 3.265 2.486 8.568 2.447 11.845-.087 3.276-2.534 3.286-6.603.021-9.089-2.86-2.177-7.284-2.417-10.54-.74l5.202 3.96-2.373 1.836z" clip-rule="evenodd"></path><path fill="#fff" fill-rule="evenodd" d="m120.865 33.009 8.965 6.826 2.373-1.836-8.965-6.826q-.481.523-1.089.993-.608.468-1.284.843m-1.203-.916a8.5 8.5 0 0 0 1.305-.828 7.248 7.248 0 0 1 0 0 8.5 8.5 0 0 1-1.305.828" clip-rule="evenodd"></path><path fill="#fff" stroke="#181818" d="m144 70 24.249 42h-48.498z"></path><path stroke="#181818" d="M144 100V82"></path><path stroke="#181818" stroke-linejoin="round" stroke-width="2" d="M144 105h.004v.004H144z"></path><defs><filter id="b" width="88.21" height="100" x="23.895" y="42" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_216_313" stdDeviation="3"></feGaussianBlur></filter><filter id="d" width="180" height="160" x="-3.609" y="42" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_216_313" stdDeviation="25"></feGaussianBlur></filter><filter id="e" width="180" height="160" x="-50" y="-27" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_216_313" stdDeviation="25"></feGaussianBlur></filter></defs>',11)])])}const vp={render:pp},fp={class:"result-container"},gp={class:"result-bg-img"},_p={class:"result-title"},hp={class:"result-tip"},yp=se({__name:"index",props:{bgUrl:String,title:String,tip:String,type:String},setup(s){const l=s,n=ee(()=>{switch(l.type){case"403":return gs;case"404":return ap;case"500":return np;case"ie":return rp;case"wifi":return cp;case"maintenance":return vp;default:return gs}});return(d,i)=>(o(),C("div",fp,[t("div",gp,[(o(),O(ot(n.value)))]),t("div",_p,I(s.title),1),t("div",hp,I(s.tip),1),xl(d.$slots,"default",{},void 0)]))}}),_s=ie(yp,[["__scopeId","data-v-a2dee5ff"]]);async function bp(s,l,n,d="toml"){return await Q.post({url:"/api/frp/add",data:{name:s,config:l,provider:n,format:d}})}async function wp(s){return await Q.post({url:"/api/frp/delete",data:{id:s}})}function kp(){return Q.get({url:"/api/frp/list"})}function hs(s,l){return Q.post({url:"/api/frp/action",data:{action:s,id:l}})}function $p(s){return Q.get({url:"/api/frp/info",params:{id:s}})}function xp(){return Q.get({url:"/api/frp/autostart"})}function Ap(s){return Q.post({url:"/api/frp/autostart",data:{frpIds:s}})}const es=kt("tunnels",()=>{const s=x([]);async function l(){try{s.value=await kp()}catch(n){B.error("获取Frp列表失败:"+n.message)}}return{frpList:s,getTunnels:l}}),Cp={class:"dashboard-wrapper"},Sp={class:"content-container"},Ip={class:"page-header"},Vp=["onClick"],Mp={class:"card-inner"},Lp={class:"header-row"},Up={class:"icon-box"},Bp={class:"title-section"},zp={class:"card-title"},Pp={class:"card-subtitle"},Rp={class:"tags-row"},Ep={class:"hover-action"},Tp={class:"auto-start-content"},Fp={class:"tunnel-label"},Dp={class:"tag"},Op={class:"name"},jp={class:"id"},Kp={key:0,class:"empty-tip"},Np=se({__name:"index",setup(s){const l=es(),n=x(!0),d=x(!1),i=Xe({visible:!1,loading:!1,submitting:!1,selectedIds:[]}),u=async()=>{i.visible=!0,i.loading=!0;try{l.frpList.length===0&&await l.getTunnels();const M=await xp();i.selectedIds=M||[]}catch(M){B.error("获取自启动配置失败 "+M.message)}finally{i.loading=!1}},f=async()=>{i.submitting=!0;try{await Ap(i.selectedIds),B.success("自启动设置已更新"),i.visible=!1}catch(M){B.error("保存失败: "+M.message)}finally{i.submitting=!1}},r=M=>({toml:"primary",ini:"warning",cmd:"danger",json:"success"})[M]||"default";async function c(){try{n.value=!0,d.value=!1,await l.getTunnels()}catch(M){console.error(M),d.value=!0}finally{n.value=!1}}const _=M=>{Ie(`/frp/console/${M.id}`)},y=M=>{const $=at.confirm({header:"确认删除隧道?",body:"删除后该隧道将无法恢复。确定要继续吗？",theme:"danger",onConfirm:async()=>{try{await wp(M),B.success(`隧道 ${M} 删除成功`),await c(),$.hide()}catch(V){B.error(V.message)}},onClose:()=>{$.hide()}})};return Ce(()=>{c()}),(M,$)=>{const V=m("t-button"),h=m("t-space"),g=m("t-loading"),z=m("t-tag"),U=m("t-col"),p=m("t-row"),S=m("t-alert"),b=m("t-checkbox"),R=m("t-checkbox-group"),T=m("t-dialog");return o(),C("div",Cp,[t("div",Sp,[t("div",Ip,[$[7]||($[7]=t("h2",{class:"title"},"隧道列表",-1)),e(h,null,{default:a(()=>[e(V,{theme:"primary",variant:"dashed",onClick:c},{default:a(()=>[...$[4]||($[4]=[v(" 刷新列表 ",-1)])]),_:1}),e(V,{theme:"default",variant:"outline",onClick:u},{default:a(()=>[...$[5]||($[5]=[v(" 设置自启动 ",-1)])]),_:1}),e(V,{theme:"primary",onClick:$[0]||($[0]=P=>k(Ie)("/frp/create"))},{default:a(()=>[...$[6]||($[6]=[v(" 创建隧道 ",-1)])]),_:1})]),_:1})]),n.value?(o(),O(g,{key:0,size:"medium",text:"加载中...",class:"loading-box"})):d.value?(o(),O(_s,{key:1,title:"获取数据失败",tip:"无法连接到服务器，请检查网络或稍后重试",type:"500"},{default:a(()=>[e(V,{onClick:c},{default:a(()=>[...$[8]||($[8]=[v("重试",-1)])]),_:1})]),_:1})):k(l).frpList.length===0?(o(),O(_s,{key:2,title:"暂无隧道",tip:"您还没有创建任何 Frp 隧道，快去创建一个吧",type:"404"},{default:a(()=>[e(V,{onClick:$[1]||($[1]=P=>k(Ie)("/frp/create"))},{default:a(()=>[...$[9]||($[9]=[v("创建隧道",-1)])]),_:1})]),_:1})):(o(),O(p,{key:3,gutter:[20,20]},{default:a(()=>[(o(!0),C(de,null,ye(k(l).frpList,P=>(o(),O(U,{key:P.id,span:24,xs:12,sm:6,md:6,lg:4,xl:4},{default:a(()=>[t("div",{class:"design-card",onClick:G=>_(P)},[t("div",{class:"status-bar",style:rt({background:P.status?"var(--td-success-color)":"var(--td-component-stroke)"})},null,4),t("div",Mp,[t("div",Lp,[t("div",Up,[e(k(wt))]),e(z,{variant:"light",theme:P.status?"success":"warning"},{default:a(()=>[v(I(P.status?"运行中":"未运行"),1)]),_:2},1032,["theme"])]),t("div",Bp,[t("h3",zp,I(P.name),1),t("div",Pp,"ID: "+I(P.id),1)]),t("div",Rp,[e(z,{size:"small",variant:"light",shape:"round"},{icon:a(()=>[e(k(Vt))]),default:a(()=>[v(" "+I(P.service),1)]),_:2},1024),e(z,{size:"small",theme:r(P.configType),variant:"outline",shape:"round"},{default:a(()=>[v(I(P.configType),1)]),_:2},1032,["theme"]),e(V,{shape:"circle",theme:"danger",size:"small",onClick:[G=>y(P.id),Nt(()=>{},["stop"])]},{icon:a(()=>[e(k($t))]),_:1},8,["onClick"])]),t("div",Ep,[e(k(Al))])])],8,Vp)]),_:2},1024))),128))]),_:1}))]),e(T,{visible:i.visible,"onUpdate:visible":$[3]||($[3]=P=>i.visible=P),header:"设置开机自启动隧道",width:"600px","confirm-btn":{content:"保存设置",loading:i.submitting},onConfirm:f},{default:a(()=>[e(g,{loading:i.loading,text:"正在读取配置...",size:"small"},{default:a(()=>[t("div",Tp,[e(S,{theme:"info",message:"勾选的隧道将在守护进程启动时自动运行",style:{"margin-bottom":"16px"}}),e(R,{modelValue:i.selectedIds,"onUpdate:modelValue":$[2]||($[2]=P=>i.selectedIds=P),class:"tunnel-checkbox-group"},{default:a(()=>[e(p,{gutter:[16,16]},{default:a(()=>[(o(!0),C(de,null,ye(k(l).frpList,P=>(o(),O(U,{key:P.id,span:12},{default:a(()=>[e(b,{value:P.id,class:"tunnel-item"},{default:a(()=>[t("div",Fp,[t("span",Dp,[e(z,{theme:"primary"},{default:a(()=>[v(I(P.service),1)]),_:2},1024)]),t("span",Op,I(P.name),1),t("span",jp,"#"+I(P.id),1)])]),_:2},1032,["value"])]),_:2},1024))),128))]),_:1})]),_:1},8,["modelValue"]),k(l).frpList.length===0?(o(),C("div",Kp,"暂无可用隧道")):K("",!0)])]),_:1},8,["loading"])]),_:1},8,["visible","confirm-btn"])])}}}),qp=ie(Np,[["__scopeId","data-v-b798d09c"]]),Gp=Object.freeze(Object.defineProperty({__proto__:null,default:qp},Symbol.toStringTag,{value:"Module"})),Hp=es();async function ka(s,l,n,d="toml"){await bp(s,l,n,d),B.success("添加成功"),await Hp.getTunnels(),Ie("/frp/list")}const Jp={class:"custom-frp-container"},Wp=se({__name:"Custom",setup(s){const l=x(null),n=Xe({name:"",type:"toml",content:""}),d={name:[{required:!0,message:"请输入隧道名称",type:"error"}],content:[{required:!0,message:"配置文件内容不能为空",type:"error"}]},i=async({validateResult:r})=>{r===!0?await ka(n.name,n.content,"Custom",n.type):B.warning("请检查表单填写")},u=()=>{B.info("表单已重置")},f=()=>{const r=n.content.trim();if(!r){B.warning("请先输入 INI 配置内容");return}const c={tls_enable:"transport.tls.enable",token:"auth.token",protocol:"transport.protocol",pool_count:"transport.poolCount",tcp_mux:"transport.tcpMux",login_fail_exit:"loginFailExit",custom_domains:"customDomains",locations:"locations",host_header_rewrite:"hostHeaderRewrite",role:"role",sk:"sk"};try{const _=r.split(/\r?\n/);let y="";const M={},$=[];let V=null;_.forEach(g=>{const z=g.trim();if(!z||z.startsWith("#")||z.startsWith(";"))return;const U=z.match(/^\[(.+)\]$/);if(U){y=U[1],y==="common"?V=null:(V={name:y},$.push(V));return}const p=z.match(/^([^=]+)=(.*)$/);if(p){const S=p[1].trim();let b=p[2].trim(),R=S;c[S]?R=c[S]:(R=R.replace(/_([a-z])/g,(T,P)=>P.toUpperCase()),R=R.replace(/Ip/g,"IP")),b==="true"?b=!0:b==="false"?b=!1:!isNaN(Number(b))&&b!==""?b=Number(b):b=String(b),y==="common"||!y?M[R]=b:V&&(V[R]=b)}});let h="";Object.entries(M).forEach(([g,z])=>{const U=typeof z=="string"?`"${z}"`:z;h+=`${g} = ${U}
`}),$.forEach(g=>{h+=`
[[proxies]]
`,Object.entries(g).forEach(([z,U])=>{const p=typeof U=="string"?`"${U}"`:U;h+=`${z} = ${p}
`})}),n.content=h.trim(),n.type="toml",B.success("已转换为 TOML")}catch(_){console.error(_),B.error("转换失败，请检查输入格式")}};return(r,c)=>{const _=m("t-input"),y=m("t-form-item"),M=m("t-radio-button"),$=m("t-radio-group"),V=m("t-button"),h=m("t-textarea"),g=m("t-space"),z=m("t-form"),U=m("t-card");return o(),C("div",Jp,[e(U,{bordered:!1},{header:a(()=>[...c[3]||(c[3]=[t("span",{style:{"font-weight":"bold","font-size":"16px"}},"自定义 Frp 隧道",-1)])]),default:a(()=>[e(z,{ref_key:"formRef",ref:l,data:n,rules:d,"label-align":"top",onReset:u,onSubmit:i},{default:a(()=>[e(y,{label:"隧道名称",name:"name"},{default:a(()=>[e(_,{modelValue:n.name,"onUpdate:modelValue":c[0]||(c[0]=p=>n.name=p),placeholder:"请输入隧道名称"},null,8,["modelValue"])]),_:1}),e(y,{label:"配置类型",name:"type"},{default:a(()=>[e($,{modelValue:n.type,"onUpdate:modelValue":c[1]||(c[1]=p=>n.type=p),variant:"default-filled"},{default:a(()=>[e(M,{value:"toml"},{default:a(()=>[...c[4]||(c[4]=[v("TOML",-1)])]),_:1}),e(M,{value:"ini"},{default:a(()=>[...c[5]||(c[5]=[v("INI",-1)])]),_:1})]),_:1},8,["modelValue"]),n.type==="ini"?(o(),O(V,{key:0,style:{"margin-left":"8px"},variant:"outline",theme:"primary",size:"small",onClick:f},{default:a(()=>[...c[6]||(c[6]=[v(" 一键转 TOML ",-1)])]),_:1})):K("",!0)]),_:1}),e(y,{label:"隧道配置内容",name:"content"},{default:a(()=>[e(h,{modelValue:n.content,"onUpdate:modelValue":c[2]||(c[2]=p=>n.content=p),placeholder:`serverAddr = "0.0.0.0"
serverPort = 1027

[[proxies]]
name = "nahida_tcp"
...`,autosize:{minRows:10,maxRows:25},class:"code-font-textarea"},null,8,["modelValue"])]),_:1}),e(y,null,{default:a(()=>[e(g,null,{default:a(()=>[e(V,{theme:"primary",type:"submit"},{default:a(()=>[...c[7]||(c[7]=[v("保存配置",-1)])]),_:1}),e(V,{theme:"default",variant:"base",type:"reset"},{default:a(()=>[...c[8]||(c[8]=[v("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})])}}}),Xp=ie(Wp,[["__scopeId","data-v-4ef2421f"]]);function $a(s){const l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let d=0;d<s;d++)n+=l.charAt(Math.floor(Math.random()*l.length));return n}function Zs(s){return new Date(s*1e3).toLocaleString()}function pa(){const s=window.location.hostname;return!!(s==="localhost"||s==="::1"||s==="[::1]"||/^(?:127|10)\.\d+\.\d+\.\d+$|^(?:172\.(?:1[6-9]|2\d|3[0-1]))\.\d+\.\d+$|^(?:192\.168)\.\d+\.\d+$/.test(s)||s.startsWith("fe80:")||s.startsWith("fc")||s.startsWith("fd")||s.endsWith(".local"))}const Qp=(s,l="MSL Login",n=500,d=600)=>{if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return window.open(s,"_blank"),null;const u=window.screenLeft!==void 0?window.screenLeft:window.screenX,f=window.screenTop!==void 0?window.screenTop:window.screenY,r=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,c=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,_=r/window.screen.availWidth,y=(r-n)/2/_+u,M=(c-d)/2/_+f,$=`
    scrollbars=yes,
    width=${n/_},
    height=${d/_},
    top=${M},
    left=${y}
  `,V=window.open(s,l,$);return V&&V.focus(),V},Yp={class:"custom-option-item"},Zp={class:"node-name-text"},ev={class:"node-tag-group"},tv={class:"node-detail-area"},av={class:"detail-tags-row"},sv={class:"remarks-box"},lv=se({__name:"CreateTunnelDialog",props:{visible:{type:Boolean},token:{}},emits:["update:visible","success"],setup(s,{emit:l}){const n=s,d=l,i=x(!1),u=x(!1),f=x([]),r=Xe({nodeId:null,type:"tcp",localIP:"127.0.0.1",localPort:"25565",remotePort:"",name:"",remarks:"无",bindDomain:"",use_kcp:!1,extra_config:""}),c=ee(()=>f.value.find(V=>V.id===r.nodeId)||null),_=ee(()=>{const V=[{label:"免费节点",value:0,children:[]},{label:"高级节点",value:1,children:[]},{label:"超级节点",value:2,children:[]}];return f.value.forEach(h=>{const g=V.find(z=>z.value===h.allow_user_group);g&&g.children.push(h)}),V.filter(h=>h.children.length>0)}),y=()=>{if(c.value){const{min_open_port:V,max_open_port:h}=c.value;r.remotePort=(Math.floor(Math.random()*(h-V+1))+V).toString()}r.name=$a(8)},M=async()=>{i.value=!0;try{const V=await Q.get({url:"/api/frp/nodeList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${n.token}`}});V.code===200&&(f.value=V.data,n.visible&&f.value.length>0&&!r.nodeId&&(r.nodeId=f.value[0].id,y()))}catch(V){B.error("加载节点失败"+V.message)}finally{i.value=!1}};we(()=>n.visible,V=>{V&&(f.value.length>0?(r.nodeId||(r.nodeId=f.value[0].id),y()):M())});const $=async()=>{if(r.nodeId){u.value=!0;try{const V=await Q.post({url:"/api/frp/addTunnel",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${n.token}`},data:{id:r.nodeId,type:r.type,local_ip:r.localIP,local_port:r.localPort,remote_port:r.remotePort,name:r.name,remarks:r.remarks,bind_domain:r.bindDomain,use_kcp:c.value?.kcp_support===1?r.use_kcp:!1,extra_config:r.extra_config||null}});V.code===200?(B.success("创建成功"),d("success"),d("update:visible",!1)):B.error(V.msg)}finally{u.value=!1}}};return Ce(()=>{n.token&&M()}),(V,h)=>{const g=m("t-tag"),z=m("t-option"),U=m("t-option-group"),p=m("t-select"),S=m("t-col"),b=m("t-button"),R=m("t-row"),T=m("t-form-item"),P=m("t-input"),G=m("t-textarea"),N=m("t-form"),E=m("t-loading"),w=m("t-dialog");return o(),O(w,{attach:"body",visible:s.visible,header:"新建隧道",width:"580px","confirm-btn":{content:"提交创建",loading:u.value},onConfirm:$,onClose:h[10]||(h[10]=A=>d("update:visible",!1))},{default:a(()=>[e(E,{loading:i.value},{default:a(()=>[e(N,{data:r,"label-align":"right","label-width":100,class:"dialog-inner-form"},{default:a(()=>[e(T,{label:"选择节点",name:"nodeId"},{default:a(()=>[e(R,{gutter:8,style:{width:"100%"}},{default:a(()=>[e(S,{flex:"auto"},{default:a(()=>[e(p,{modelValue:r.nodeId,"onUpdate:modelValue":h[0]||(h[0]=A=>r.nodeId=A),placeholder:"请选择节点",onChange:y},{default:a(()=>[(o(!0),C(de,null,ye(_.value,A=>(o(),O(U,{key:A.value,label:A.label},{default:a(()=>[(o(!0),C(de,null,ye(A.children,L=>(o(),O(z,{key:L.id,value:L.id,label:L.node},{default:a(()=>[t("div",Yp,[t("span",Zp,I(L.node),1),t("div",ev,[e(g,{size:"small",variant:"outline",theme:"primary"},{default:a(()=>[v(I(L.bandwidth)+"M",1)]),_:2},1024),e(g,{size:"small",theme:L.status===1?"success":"danger"},{default:a(()=>[v(I(L.status===1?"在线":"离线"),1)]),_:2},1032,["theme"])])])]),_:2},1032,["value","label"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(S,{flex:"none"},{default:a(()=>[e(b,{variant:"outline",onClick:h[1]||(h[1]=A=>k(Ie)("https://user.mslmc.net/frp/createTunnel"))},{default:a(()=>[...h[11]||(h[11]=[v(" 前往源站创建 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),c.value?(o(),O(T,{key:0,label:"节点详情"},{default:a(()=>[t("div",tv,[t("div",av,[e(g,{size:"small",variant:"outline",theme:"primary"},{default:a(()=>[v(I(c.value.bandwidth)+"Mbps",1)]),_:1}),e(g,{size:"small",theme:c.value.need_real_name?"success":"warning"},{default:a(()=>[v(I(c.value.need_real_name?"需要实名认证":"无需实名认证"),1)]),_:1},8,["theme"]),e(g,{size:"small",theme:c.value.status===1?"success":"danger"},{default:a(()=>[v(" 节点状态："+I(c.value.status===1?"在线":"离线"),1)]),_:1},8,["theme"])]),t("div",sv,[t("pre",null,I(c.value.remarks||"此节点暂无备注"),1)])])]),_:1})):K("",!0),e(T,{label:"隧道类型"},{default:a(()=>[e(p,{modelValue:r.type,"onUpdate:modelValue":h[2]||(h[2]=A=>r.type=A)},{default:a(()=>[e(z,{label:"TCP",value:"tcp"}),c.value?.udp_support?(o(),O(z,{key:0,label:"UDP",value:"udp"})):K("",!0),c.value?.http_support?(o(),O(z,{key:1,label:"HTTP",value:"http"})):K("",!0),c.value?.http_support?(o(),O(z,{key:2,label:"HTTPS",value:"https"})):K("",!0)]),_:1},8,["modelValue"])]),_:1}),e(R,{gutter:[16,20]},{default:a(()=>[e(S,{xs:12,sm:6},{default:a(()=>[e(T,{label:"隧道名称"},{default:a(()=>[e(P,{modelValue:r.name,"onUpdate:modelValue":h[3]||(h[3]=A=>r.name=A)},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{xs:12,sm:6},{default:a(()=>[e(T,{label:"远程端口"},{default:a(()=>[e(P,{modelValue:r.remotePort,"onUpdate:modelValue":h[4]||(h[4]=A=>r.remotePort=A)},{suffix:a(()=>[e(b,{variant:"text",size:"small",onClick:y},{default:a(()=>[...h[12]||(h[12]=[v("随机",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(S,{xs:12,sm:6},{default:a(()=>[e(T,{label:"本地IP"},{default:a(()=>[e(P,{modelValue:r.localIP,"onUpdate:modelValue":h[5]||(h[5]=A=>r.localIP=A)},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{xs:12,sm:6},{default:a(()=>[e(T,{label:"本地端口"},{default:a(()=>[e(P,{modelValue:r.localPort,"onUpdate:modelValue":h[6]||(h[6]=A=>r.localPort=A)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),r.type.includes("http")?(o(),O(T,{key:1,label:"绑定域名",class:"spacing-item"},{default:a(()=>[e(P,{modelValue:r.bindDomain,"onUpdate:modelValue":h[7]||(h[7]=A=>r.bindDomain=A),placeholder:"输入已解析的域名"},null,8,["modelValue"])]),_:1})):K("",!0),e(T,{label:"备注说明",class:"spacing-item"},{default:a(()=>[e(P,{modelValue:r.remarks,"onUpdate:modelValue":h[8]||(h[8]=A=>r.remarks=A)},null,8,["modelValue"])]),_:1}),e(T,{label:"额外参数",class:"spacing-item"},{default:a(()=>[e(G,{modelValue:r.extra_config,"onUpdate:modelValue":h[9]||(h[9]=A=>r.extra_config=A),autosize:{minRows:2},placeholder:"选填，高级配置参数（不懂清留空！！！）"},null,8,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:1},8,["loading"])]),_:1},8,["visible","confirm-btn"])}}}),nv=ie(lv,[["__scopeId","data-v-a8b2caa6"]]),ov={key:0,class:"manager-container"},iv={class:"toolbar"},rv={class:"record-list"},uv={key:0,class:"empty-state"},dv={class:"card-main"},cv={class:"domain-title"},mv={class:"sub"},pv={class:"root"},vv={class:"info-badges"},fv=["title"],gv={key:0,class:"srv-helper"},_v={class:"card-actions"},hv={key:1,class:"form-container"},yv={class:"form-header"},bv={class:"remark-display"},wv={key:0,class:"prefix-hint"},kv={class:"row-fields"},$v={class:"form-actions"},xv=se({__name:"DomainManagerDialog",props:{visible:{type:Boolean},token:{},tunnels:{}},emits:["update:visible"],setup(s,{emit:l}){const n=s,d=l,i=x("list"),u=x("mc_srv"),f=x(!1),r=x(!1),c=x([]),_=x([]),y=x([]),M=x(null),$=Xe({id:0,domain_id:void 0,name:"",type:"A",record:""}),V=ee(()=>n.tunnels?n.tunnels.filter(w=>w.type&&w.type.toUpperCase()==="TCP"):[]),h=ee(()=>{const w=_.value.find(A=>A.id===$.domain_id);return w?w.remark:""}),g=async()=>{if(n.token){f.value=!0;try{await Promise.all([z(),U(),p()])}catch(w){console.error(w)}finally{f.value=!1}}},z=async()=>{const w=await Q.get({url:"/api/domain/dns/list",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${n.token}`}});w.code===200&&(c.value=w.data||[])},U=async()=>{const w=await Q.get({url:"/api/domain/list",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${n.token}`}});w.code===200&&(_.value=w.data||[])},p=async()=>{try{const w=await Q.get({url:"/api/frp/nodeList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${n.token}`}});w.code===200&&(y.value=w.data||[])}catch(w){console.error("Fetch nodes failed",w)}},S=w=>{const A=n.tunnels.find(L=>L.id===w);if(A){const L=y.value.find(J=>J.id===A.node_id),H=L?L.domain||L.ip:null;H?($.record=`5 5 ${A.remote_port} ${H}`,B.success("已自动生成解析值")):(B.warning(`无法获取节点(ID:${A.node_id})地址，请手动填写`),$.record=`5 5 ${A.remote_port} 请输入节点地址`),$.type="SRV"}};Ce(()=>{n.visible&&n.token&&g()}),we(()=>n.visible,w=>{w&&(i.value="list",g())}),we(_,w=>{w.length>0&&$.domain_id===void 0&&$.id===0&&($.domain_id=w[0].id)});const b=w=>w.type!=="SRV"?"":`${w.name.replace("_minecraft._tcp.","")}.${w.domain}`,R=()=>{i.value="form",u.value="mc_srv",M.value=null,$.id=0,$.name="",$.type="SRV",$.record="",_.value.length>0&&($.domain_id=_.value[0].id)},T=w=>{i.value="form",u.value="custom",$.id=w.id,$.domain_id=Number(w.domain_id),$.name=w.name,$.type=w.type,$.record=w.record},P=()=>{i.value="list"},G=async()=>{const w=$.type.toUpperCase()==="SRV"||u.value==="mc_srv",A=w?/^[a-zA-Z0-9._-]+$/:/^[a-zA-Z0-9]+$/;let L=$.name;if(L.length<1)return B.warning("请输入子域名名称");if(!A.test(L))return B.warning(w?"SRV支持英文、数字、下划线及点":"普通解析仅支持英文数字");u.value==="mc_srv"&&$.id===0&&(L.startsWith("_minecraft._tcp.")||(L="_minecraft._tcp."+L),$.type="SRV"),r.value=!0;const H=$.id!==0?"/api/domain/dns/edit":"/api/domain/dns/add";try{const J=await Q.post({url:H,baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${n.token}`},data:{...$,name:L}});J.code===200?(B.success(J.msg||"操作成功"),await z(),i.value="list"):B.error(J.msg)}catch(J){B.error("请求失败: "+J.message)}finally{r.value=!1}},N=async w=>{const A=at.confirm({header:"确认删除",body:"确定要删除这条解析记录吗？删除后无法恢复。",onConfirm:async()=>{A.hide();try{const L=await Q.post({url:"/api/domain/dns/delete",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${n.token}`},data:{id:w}});L.code===200?(B.success("删除成功"),z()):B.error(L.msg)}catch(L){B.error(L.message)}}})},E=()=>{d("update:visible",!1)};return(w,A)=>{const L=m("t-button"),H=m("t-empty"),J=m("t-tag"),X=m("t-tooltip"),q=m("t-loading"),_e=m("t-tab-panel"),De=m("t-tabs"),fe=m("t-option"),Pe=m("t-select"),Le=m("t-form-item"),Ve=m("t-input"),Be=m("t-form"),Oe=m("t-dialog");return o(),O(Oe,{visible:s.visible,header:i.value==="list"?"MSLFrp免费子域名管理":$.id===0?"创建新解析":"编辑解析",width:"650px",attach:"body",footer:!1,onClose:E},{default:a(()=>[i.value==="list"?(o(),C("div",ov,[t("div",iv,[e(L,{variant:"text",theme:"default",onClick:A[0]||(A[0]=re=>k(Ie)("https://www.mslmc.cn/docs/proxy/server-no-port/"))},{icon:a(()=>[e(k(Ms))]),default:a(()=>[A[7]||(A[7]=v("查看文档 ",-1))]),_:1}),e(L,{theme:"primary",onClick:R},{icon:a(()=>[e(k(Yt))]),default:a(()=>[A[8]||(A[8]=v("新建解析 ",-1))]),_:1})]),e(q,{loading:f.value,text:"加载中..."},{default:a(()=>[t("div",rv,[c.value.length===0?(o(),C("div",uv,[e(H,{title:"暂无解析记录",description:"点击上方按钮创建一个吧"})])):K("",!0),(o(!0),C(de,null,ye(c.value,re=>(o(),C("div",{key:re.id,class:"record-card"},[t("div",dv,[t("div",cv,[t("span",mv,I(re.name),1),t("span",pv,"."+I(re.domain),1)]),t("div",vv,[e(J,{size:"small",theme:re.type==="SRV"?"warning":"primary",variant:"light"},{default:a(()=>[v(I(re.type),1)]),_:2},1032,["theme"]),t("span",{class:"record-value",title:re.record},I(re.record),9,fv)]),re.type==="SRV"?(o(),C("div",gv,[e(k(It)),t("span",null,[A[9]||(A[9]=v("地址: ",-1)),t("strong",null,I(b(re)),1)])])):K("",!0)]),t("div",_v,[e(X,{content:"编辑"},{default:a(()=>[e(L,{shape:"circle",variant:"text",onClick:ce=>T(re)},{icon:a(()=>[e(k(Ls))]),_:1},8,["onClick"])]),_:2},1024),e(X,{content:"删除"},{default:a(()=>[e(L,{shape:"circle",variant:"text",theme:"danger",onClick:ce=>N(re.id)},{icon:a(()=>[e(k($t))]),_:1},8,["onClick"])]),_:2},1024)])]))),128))])]),_:1},8,["loading"])])):(o(),C("div",hv,[t("div",yv,[e(L,{variant:"text",size:"small",onClick:P},{icon:a(()=>[e(k(Us))]),default:a(()=>[A[10]||(A[10]=v(" 返回列表 ",-1))]),_:1})]),$.id===0?(o(),O(De,{key:0,modelValue:u.value,"onUpdate:modelValue":A[1]||(A[1]=re=>u.value=re),class:"mode-tabs"},{default:a(()=>[e(_e,{value:"mc_srv",label:"MC Java版隐藏端口"}),e(_e,{value:"custom",label:"自定义解析"})]),_:1},8,["modelValue"])):K("",!0),e(Be,{"label-align":"top",data:$,class:"dns-form"},{default:a(()=>[e(Le,{label:"选择域名后缀"},{default:a(()=>[e(Pe,{modelValue:$.domain_id,"onUpdate:modelValue":A[2]||(A[2]=re=>$.domain_id=re),disabled:$.id!==0,placeholder:"请选择后缀",filterable:""},{default:a(()=>[(o(!0),C(de,null,ye(_.value,re=>(o(),O(fe,{key:re.id,value:re.id,label:re.domain},{default:a(()=>[v(I(re.domain),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),h.value?(o(),O(Le,{key:0,label:"备注"},{default:a(()=>[t("div",bv,I(h.value),1)]),_:1})):K("",!0),e(Le,{label:"子域名称",help:"起一个你喜欢的前缀即可"},{default:a(()=>[e(Ve,{modelValue:$.name,"onUpdate:modelValue":A[3]||(A[3]=re=>$.name=re),placeholder:"例如: myserver"},{"prefix-icon":a(()=>[u.value==="mc_srv"&&$.id===0?(o(),C("span",wv,"_minecraft._tcp.")):K("",!0)]),_:1},8,["modelValue"])]),_:1}),u.value==="mc_srv"&&$.id===0?(o(),O(Le,{key:1,label:"选择隧道 (自动生成解析值)"},{default:a(()=>[e(Pe,{modelValue:M.value,"onUpdate:modelValue":A[4]||(A[4]=re=>M.value=re),placeholder:"点击选择已有的 TCP 隧道",onChange:S},{default:a(()=>[(o(!0),C(de,null,ye(V.value,re=>(o(),O(fe,{key:re.id,value:re.id,label:`${re.name} (端口: ${re.remote_port})`},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})):K("",!0),t("div",kv,[e(Le,{label:"记录类型",class:"half-width"},{default:a(()=>[e(Pe,{modelValue:$.type,"onUpdate:modelValue":A[5]||(A[5]=re=>$.type=re)},{default:a(()=>[e(fe,{label:"A (IPv4)",value:"A"}),e(fe,{label:"CNAME (别名)",value:"CNAME"}),e(fe,{label:"AAAA (IPv6)",value:"AAAA"}),e(fe,{label:"SRV (服务记录)",value:"SRV"})]),_:1},8,["modelValue"])]),_:1}),e(Le,{label:"解析记录值",class:"half-width"},{default:a(()=>[e(Ve,{modelValue:$.record,"onUpdate:modelValue":A[6]||(A[6]=re=>$.record=re),placeholder:"例: 5 5 25565 node.mslmc.net"},null,8,["modelValue"])]),_:1})]),t("div",$v,[e(L,{theme:"default",variant:"base",onClick:P},{default:a(()=>[...A[11]||(A[11]=[v("取消",-1)])]),_:1}),e(L,{theme:"primary",loading:r.value,onClick:G},{default:a(()=>[v(I($.id===0?"立即创建":"保存修改"),1)]),_:1},8,["loading"])])]),_:1},8,["data"])]))]),_:1},8,["visible","header"])}}}),Av=ie(xv,[["__scopeId","data-v-e04d368f"]]),Cv={class:"page-container"},Sv={key:0,class:"login-container"},Iv={class:"login-card"},Vv={class:"icon-wrapper"},Mv={key:1,class:"dashboard-container"},Lv={class:"stat-item"},Uv={class:"value"},Bv={class:"stat-item"},zv={class:"value"},Pv={class:"stat-item"},Rv={class:"value"},Ev={class:"stat-item"},Tv={class:"value date-text"},Fv={class:"list-header"},Dv={class:"tunnel-list"},Ov=["onClick"],jv={class:"item-icon"},Kv={class:"item-content"},Nv={class:"item-title"},qv={class:"item-subtitle"},Gv={class:"item-status"},Hv={key:0,class:"empty-state"},Jv={key:0,class:"detail-content"},Wv={class:"detail-header"},Xv={class:"remarks"},Qv={class:"detail-grid"},Yv={class:"val"},Zv={class:"detail-grid"},e1={class:"val uppercase"},t1={class:"detail-grid"},a1={class:"val"},s1={class:"detail-grid"},l1={class:"val highlight"},n1={class:"detail-grid"},o1={class:"val"},i1={class:"detail-grid"},r1={class:"val"},u1={class:"action-area"},d1={key:1,class:"empty-detail"},c1=se({__name:"index",setup(s){const l=x(!1),n=x(!1),d=()=>{U()},i=x("tKYvKk48Sq5kGAy12IJQxLEKhXx"),u=x(null),f=x(""),r=x(!1),c=x(null),_=x([]),y=x({}),M=x(null),$=ee(()=>_.value.find(N=>N.id===M.value)||null),V=ee(()=>$.value?y.value[$.value.node_id]||`未知节点 (${$.value.node_id})`:"");Ce(()=>{const N=localStorage.getItem("msl-user-token");N&&(f.value=N,U())}),Qe(()=>{u.value&&!u.value.closed&&u.value.close()});async function h(){B.info("正在跳转至MSL用户中心登录...");try{const N=$a(32),E=await Q.post({url:"/api/oauth/createAppLogin",baseURL:"https://user.mslmc.net",data:{appid:i.value,csrf:N}});E.data.ssid?(u.value=Qp(E.data.url,"登录到您的MSL账户",600,600),setTimeout(()=>g(N,E.data.ssid),1e3)):B.error(E.msg)}catch(N){B.error(N.message)}}async function g(N,E){if(!u.value?.closed){try{const w=await Q.get({url:"/api/oauth/appLogin",baseURL:"https://user.mslmc.net",params:{csrf:N,ssid:E}});if(w.data.token){u.value&&u.value.close(),B.success("登录成功"),f.value=w.data.token,localStorage.setItem("msl-user-token",w.data.token),U();return}}catch(w){B.error("登录失败！"+w.message);return}setTimeout(()=>g(N,E),1e3)}}const z=N=>{if(N===0)return"0 B";const E=1024,w=["B","KB","MB","GB","TB"],A=Math.floor(Math.log(N)/Math.log(E));return parseFloat((N/Math.pow(E,A)).toFixed(2))+" "+w[A]};async function U(){r.value=!0;try{const[N,E]=await Promise.all([Q.get({url:"/api/frp/userInfo",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${f.value}`}}),Q.get({url:"/api/frp/nodeList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${f.value}`}})]);if(N.code===200)c.value=N.data;else{B.warning("登录已过期，请重新登录～"),f.value="",localStorage.removeItem("msl-user-token");return}if(E.code===200){const A={};E.data.forEach(L=>{A[L.id]=L.node}),y.value=A}const w=await Q.get({url:"/api/frp/getTunnelList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${f.value}`}});w.code===200&&(_.value=w.data,_.value.length>0&&(M.value=_.value[0].id))}catch(N){B.error("数据加载失败: "+N.message)}finally{r.value=!1}}const p=x(!1);async function S(){if($.value){p.value=!0;try{const N=await Q.get({url:"/api/frp/getTunnelConfig",baseURL:"https://user.mslmc.net",params:{id:$.value.id},headers:{Authorization:`Bearer ${f.value}`}});N.code===200?await ka($.value.name,N.data,"MSLFrp"):B.error(N.msg)}catch(N){B.error("获取配置失败: "+N.message)}p.value=!1}}const b=()=>{n.value=!0};async function R(){try{await Q.get({url:"/api/user/logout",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${f.value}`}}),f.value="",c.value=null,_.value=[],localStorage.removeItem("msl-user-token"),B.success("已退出登录")}catch(N){B.error("退出失败: "+N.message)}}async function T(){await U(),B.success("数据已更新")}const P=x(!1);async function G(){if($.value){P.value=!0;try{const N=await Q.post({url:"/api/frp/deleteTunnel",baseURL:"https://user.mslmc.net",data:{id:$.value.id},headers:{Authorization:`Bearer ${f.value}`}});N.code===200?(B.success("隧道删除成功"),M.value=null,await U()):B.error(N.msg||"删除失败")}catch(N){B.error("操作失败: "+N.message)}finally{P.value=!1}}}return(N,E)=>{const w=m("t-button"),A=m("t-space"),L=m("t-loading"),H=m("t-tag"),J=m("t-popconfirm"),X=m("t-col"),q=m("t-row"),_e=m("t-card"),De=m("t-divider");return o(),C("div",Cv,[f.value===""?(o(),C("div",Sv,[t("div",Iv,[t("div",Vv,[e(k(zt),{size:"48px",style:{color:"var(--td-brand-color)"}})]),E[8]||(E[8]=t("h2",{class:"title"},"欢迎登录 MSLFrp",-1)),E[9]||(E[9]=t("p",{class:"subtitle"},"登录您的MSL账户以使用 MSLFrp 服务",-1)),e(A,{direction:"vertical",size:"medium",style:{width:"100%"}},{default:a(()=>[e(w,{block:"",theme:"primary",size:"large",onClick:h},{icon:a(()=>[e(k(zt))]),default:a(()=>[E[6]||(E[6]=v(" 跳转用户中心登录 ",-1))]),_:1}),e(w,{theme:"default",variant:"outline",block:"",size:"large",onClick:E[0]||(E[0]=fe=>k(Ie)("https://user.mslmc.net/register"))},{icon:a(()=>[e(k(Cl))]),default:a(()=>[E[7]||(E[7]=v(" 注册 MSL 账户 ",-1))]),_:1})]),_:1})])])):(o(),C("div",Mv,[e(L,{attach:"#app-space",loading:r.value,text:"加载数据中..."},null,8,["loading"]),e(A,{id:"app-space",direction:"vertical",size:"large",style:{width:"100%"}},{default:a(()=>[c.value?(o(),O(_e,{key:0,bordered:!1,title:"MSLFrp 用户信息",class:"info-card"},{actions:a(()=>[e(A,{size:"small"},{default:a(()=>[e(w,{variant:"outline",theme:"success",size:"small",onClick:E[1]||(E[1]=fe=>k(Ie)("https://user.mslmc.net/store/buy"))},{default:a(()=>[...E[10]||(E[10]=[v(" 订阅会员服务 ",-1)])]),_:1}),e(H,{theme:"primary",variant:"light-outline"},{default:a(()=>[v(I(c.value.user_group_name),1)]),_:1}),e(J,{content:"确认退出登录吗？",onConfirm:R},{default:a(()=>[e(w,{variant:"outline",theme:"danger",size:"small"},{default:a(()=>[...E[11]||(E[11]=[v(" 退出登录 ",-1)])]),_:1})]),_:1})]),_:1})]),default:a(()=>[e(q,{gutter:[16,16]},{default:a(()=>[e(X,{xs:6,sm:3},{default:a(()=>[t("div",Lv,[E[12]||(E[12]=t("div",{class:"label"},"用户昵称",-1)),t("div",Uv,[v(I(c.value.name)+" ",1),e(H,{theme:c.value.realNameStatus?"success":"warning",variant:"dark",size:"small",style:{cursor:"pointer"},onClick:E[2]||(E[2]=fe=>k(Ie)("https://user.mslmc.net/user/profile"))},{default:a(()=>[v(I(c.value.realNameStatus?"已实名":"未实名"),1)]),_:1},8,["theme"])])])]),_:1}),e(X,{xs:6,sm:3},{default:a(()=>[t("div",Bv,[E[13]||(E[13]=t("div",{class:"label"},"隧道限额",-1)),t("div",zv,I(c.value.maxTunnelCount)+" 条",1)])]),_:1}),e(X,{xs:6,sm:3},{default:a(()=>[t("div",Pv,[E[14]||(E[14]=t("div",{class:"label"},"速率限制",-1)),t("div",Rv,I(c.value.boundLimit/1024*8)+" Mbps",1)])]),_:1}),e(X,{xs:6,sm:3},{default:a(()=>[t("div",Ev,[E[15]||(E[15]=t("div",{class:"label"},"会员到期时间",-1)),t("div",Tv,I(c.value.outdated===3749682420?"长期有效":k(Zs)(c.value.outdated)),1)])]),_:1})]),_:1})]),_:1})):K("",!0),e(q,{gutter:[16,16]},{default:a(()=>[e(X,{xs:12,md:5,lg:4},{default:a(()=>[e(_e,{bordered:!1,class:"full-height-card"},{title:a(()=>[t("div",Fv,[E[19]||(E[19]=t("span",null,"我的隧道",-1)),e(A,{size:"4px"},{default:a(()=>[e(w,{style:{"margin-left":"3px"},size:"small",variant:"text",loading:r.value,onClick:T},{icon:a(()=>[e(k(st))]),default:a(()=>[E[16]||(E[16]=v(" 刷新 ",-1))]),_:1},8,["loading"]),e(w,{size:"small",variant:"text",onClick:E[3]||(E[3]=fe=>l.value=!0)},{icon:a(()=>[e(k(Vt))]),default:a(()=>[E[17]||(E[17]=v(" 免费子域名 ",-1))]),_:1}),e(w,{size:"small",variant:"text",onClick:b},{icon:a(()=>[e(k(Yt))]),default:a(()=>[E[18]||(E[18]=v(" 新建 ",-1))]),_:1})]),_:1})])]),default:a(()=>[t("div",Dv,[(o(!0),C(de,null,ye(_.value,fe=>(o(),C("div",{key:fe.id,class:ke(["tunnel-item",{active:M.value===fe.id}]),onClick:Pe=>M.value=fe.id},[t("div",jv,[e(k(wt))]),t("div",Kv,[t("div",Nv,I(fe.name),1),t("div",qv,I(y.value[fe.node_id]||`Node ${fe.node_id}`),1)]),t("div",Gv,[fe.status===1?(o(),O(H,{key:0,theme:"success",variant:"light",size:"small"},{default:a(()=>[...E[20]||(E[20]=[v("在线",-1)])]),_:1})):(o(),O(H,{key:1,theme:"default",variant:"light",size:"small"},{default:a(()=>[...E[21]||(E[21]=[v("未启动",-1)])]),_:1}))])],10,Ov))),128)),_.value.length===0?(o(),C("div",Hv,"暂无隧道")):K("",!0)])]),_:1})]),_:1}),e(X,{xs:12,md:7,lg:8},{default:a(()=>[e(_e,{bordered:!1,class:"full-height-card"},{title:a(()=>[...E[22]||(E[22]=[t("span",null,"隧道详情",-1)])]),actions:a(()=>[$.value?(o(),O(J,{key:0,content:"确认删除此隧道吗？",theme:"danger",placement:"bottom-right",onConfirm:G},{default:a(()=>[e(w,{theme:"danger",variant:"text",loading:P.value},{default:a(()=>[...E[23]||(E[23]=[v(" 删除隧道 ",-1)])]),_:1},8,["loading"])]),_:1})):K("",!0)]),default:a(()=>[$.value?(o(),C("div",Jv,[t("div",Wv,[t("h3",null,I($.value.name),1),t("p",Xv,I($.value.remarks||"暂无备注"),1)]),e(De),e(q,{gutter:[24,24]},{default:a(()=>[e(X,{span:6},{default:a(()=>[t("div",Qv,[E[24]||(E[24]=t("span",{class:"label"},"所在节点",-1)),t("span",Yv,I(V.value),1)])]),_:1}),e(X,{span:6},{default:a(()=>[t("div",Zv,[E[25]||(E[25]=t("span",{class:"label"},"协议类型",-1)),t("span",e1,I($.value.type),1)])]),_:1}),e(X,{span:6},{default:a(()=>[t("div",t1,[E[26]||(E[26]=t("span",{class:"label"},"本地地址",-1)),t("span",a1,I($.value.local_ip)+":"+I($.value.local_port),1)])]),_:1}),e(X,{span:6},{default:a(()=>[t("div",s1,[E[27]||(E[27]=t("span",{class:"label"},"远程端口",-1)),t("span",l1,I($.value.remote_port),1)])]),_:1}),e(X,{span:6},{default:a(()=>[t("div",n1,[E[28]||(E[28]=t("span",{class:"label"},"今日流量",-1)),t("span",o1,I(z($.value.today_traffic*1024*1024)),1)])]),_:1}),e(X,{span:6},{default:a(()=>[t("div",i1,[E[29]||(E[29]=t("span",{class:"label"},"总流量",-1)),t("span",r1,I(z($.value.total_traffic*1024*1024)),1)])]),_:1})]),_:1}),e(De),t("div",u1,[e(w,{theme:"primary",size:"large",loading:p.value,block:"",onClick:S},{icon:a(()=>[e(k(Ft))]),default:a(()=>[E[30]||(E[30]=v(" 使用此隧道 ",-1))]),_:1},8,["loading"])])])):(o(),C("div",d1,[e(k(Vt),{size:"48px",style:{color:"var(--td-text-color-disabled)"}}),E[31]||(E[31]=t("p",null,"请在左侧选择一个隧道查看详情",-1))]))]),_:1})]),_:1})]),_:1})]),_:1})])),n.value?(o(),O(nv,{key:2,visible:n.value,"onUpdate:visible":E[4]||(E[4]=fe=>n.value=fe),token:f.value,onSuccess:d},null,8,["visible","token"])):K("",!0),l.value?(o(),O(Av,{key:3,visible:l.value,"onUpdate:visible":E[5]||(E[5]=fe=>l.value=fe),token:f.value,tunnels:_.value},null,8,["visible","token","tunnels"])):K("",!0)])}}}),m1=ie(c1,[["__scopeId","data-v-a5e7f491"]]);async function p1(){return await Q.get({url:"/query/p2p_server",baseURL:"https://api.mslmc.cn/v3"})}const v1={key:0},f1={key:1},g1={key:0},_1={key:1},h1={key:0},y1={key:1},b1=se({__name:"MSLP2P",setup(s){const l=Xe({roomId:"",roomKey:"",bindPort:25565,isHoster:!0}),n={roomId:[{required:!0,message:"请输入房间号",type:"error"}],roomKey:[{required:!0,message:"请输入房间密钥",type:"error"}],bindPort:[{required:!0,message:"请输入绑定端口",type:"error"}]},d=async({validateResult:u})=>{u===!0?await i(l.isHoster,l.roomId,l.roomKey,l.bindPort):B.warning("请检查参数是否全部填写完成！")};async function i(u,f,r,c){try{const _=await p1();let y;u?y=`serverAddr = "${_.ip}"
serverPort = ${_.port}

[[proxies]]
name = "${f}"
type = "xtcp"
secretKey = "${r}"
localIP = "127.0.0.1"
localPort = ${c}`:y=`serverAddr = "${_.ip}"
serverPort = ${_.port}

[[visitors]]
name = "p2p_visitor"
type = "xtcp"
serverName = "${f}"
secretKey = "${r}"
bindAddr = "127.0.0.1"
bindPort = ${c}`,await ka(u?`「联机 - 房主」${f}`:`「联机 - 访客」${f}`,y,"MSL P2P")}catch(_){B.error(`创建联机隧道失败！${_.message}`)}}return(u,f)=>{const r=m("t-radio"),c=m("t-radio-group"),_=m("t-form-item"),y=m("t-input"),M=m("t-button"),$=m("t-form"),V=m("t-card");return o(),C("div",null,[e(V,{bordered:!1},{header:a(()=>[...f[5]||(f[5]=[t("span",{style:{"font-weight":"bold","font-size":"16px"}},"MSL P2P 联机隧道",-1)])]),default:a(()=>[e($,{data:l,rules:n,"label-width":100,"label-align":"top","reset-type":"initial",onSubmit:d},{default:a(()=>[e(_,{label:"请选择联机类型",name:"isHoster"},{default:a(()=>[e(c,{modelValue:l.isHoster,"onUpdate:modelValue":f[0]||(f[0]=h=>l.isHoster=h)},{default:a(()=>[e(r,{value:!0},{default:a(()=>[...f[6]||(f[6]=[v("创建房间 - 房主",-1)])]),_:1}),e(r,{value:!1},{default:a(()=>[...f[7]||(f[7]=[v("加入房间 - 成员",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"房间号",name:"roomId"},{help:a(()=>[l.isHoster?(o(),C("span",v1,"建议填写您的QQ号码。")):(o(),C("span",f1,"请输入房间创建者提供的房间号。"))]),default:a(()=>[e(y,{modelValue:l.roomId,"onUpdate:modelValue":f[1]||(f[1]=h=>l.roomId=h),placeholder:"请输入房间号"},null,8,["modelValue"])]),_:1}),e(_,{label:"房间密钥",name:"roomKey"},{help:a(()=>[l.isHoster?(o(),C("span",g1,"随便写一个你喜欢的密钥。")):(o(),C("span",_1,"请输入房间创建者提供的密钥。"))]),default:a(()=>[e(y,{modelValue:l.roomKey,"onUpdate:modelValue":f[2]||(f[2]=h=>l.roomKey=h),placeholder:"请输入房间密钥"},null,8,["modelValue"]),l.isHoster?(o(),O(M,{key:0,theme:"default",variant:"base",style:{"margin-left":"5px"},onClick:f[3]||(f[3]=h=>{l.roomKey=k($a)(16)})},{default:a(()=>[...f[8]||(f[8]=[v("随机生成",-1)])]),_:1})):K("",!0)]),_:1}),e(_,{label:"绑定端口",name:"bindPort"},{help:a(()=>[l.isHoster?(o(),C("span",h1,"请输入游戏内提示的开放联机端口。")):(o(),C("span",y1,"建议保持默认。"))]),default:a(()=>[e(y,{modelValue:l.bindPort,"onUpdate:modelValue":f[4]||(f[4]=h=>l.bindPort=h),placeholder:"请输入绑定端口"},null,8,["modelValue"])]),_:1}),e(_,{style:{"margin-top":"16px"}},{default:a(()=>[e(M,{theme:"primary",type:"submit"},{default:a(()=>[...f[9]||(f[9]=[v("添加隧道",-1)])]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})])}}}),w1={class:"custom-option-item"},k1={class:"node-name-text"},$1={class:"node-tag-group"},x1={class:"node-detail-area"},A1={class:"remarks-box"},C1=se({__name:"CreateTunnelDialog",props:{visible:{type:Boolean},token:{}},emits:["update:visible","success"],setup(s,{emit:l}){const n=s,d=l,i=x(!1),u=x(!1),f=x([]),r=Xe({nodeId:null,proxyType:"tcp",localIp:"127.0.0.1",localPort:"25565",remotePort:"",proxyName:"",domain:""}),c=ee(()=>f.value.find(V=>V.nodeId===r.nodeId)||null),_=ee(()=>{const V=new Map;return f.value.forEach(h=>{const g=h.region||"unknown";if(!V.has(g)){let z=g;g==="oversea"?z="海外节点":g==="cn"?z="国内节点":z="默认节点",V.set(g,{label:z,value:g,children:[]})}V.get(g).children.push(h)}),Array.from(V.values())}),y=()=>{r.remotePort=(Math.floor(Math.random()*55536)+1e4).toString(),r.proxyName="MSLX_"+$a(6)},M=async()=>{i.value=!0;try{const V=await Q.get({url:"/auth/node/list",baseURL:"https://api.mefrp.com/api",headers:{Authorization:`Bearer ${n.token}`}},{withToken:!1});V&&(f.value=V.filter(h=>!h.isDisabled),n.visible&&f.value.length>0&&!r.nodeId&&(r.nodeId=f.value[0].nodeId,y()))}catch(V){B.error("加载节点失败: "+V.message)}finally{i.value=!1}};we(()=>n.visible,V=>{V&&(f.value.length>0?(r.nodeId||(r.nodeId=f.value[0].nodeId),y()):M())});const $=async()=>{if(!r.nodeId){B.warning("请选择一个节点");return}u.value=!0;try{await Q.post({url:"/auth/proxy/create",baseURL:"https://api.mefrp.com/api",headers:{Authorization:`Bearer ${n.token}`},data:{accessKey:"",headerXFromWhere:"",hostHeaderRewrite:"",proxyProtocolVersion:"",nodeId:r.nodeId,proxyName:r.proxyName,proxyType:r.proxyType,localIp:r.localIp,localPort:parseInt(r.localPort),remotePort:parseInt(r.remotePort),domain:r.domain,useCompression:!1,useEncryption:!1}},{withToken:!1}),B.success(`隧道 ${r.proxyName} 创建成功！`),d("success"),d("update:visible",!1)}catch(V){B.error("创建异常: "+V.message)}finally{u.value=!1}};return Ce(()=>{n.token&&M()}),(V,h)=>{const g=m("t-tag"),z=m("t-option"),U=m("t-option-group"),p=m("t-select"),S=m("t-form-item"),b=m("t-input"),R=m("t-col"),T=m("t-button"),P=m("t-row"),G=m("t-form"),N=m("t-loading"),E=m("t-dialog");return o(),O(E,{attach:"body",visible:s.visible,header:"新建 ME Frp 隧道",width:"580px","confirm-btn":{content:"提交创建",loading:u.value},onConfirm:$,onClose:h[7]||(h[7]=w=>d("update:visible",!1))},{default:a(()=>[e(N,{loading:i.value},{default:a(()=>[e(G,{data:r,"label-align":"right","label-width":100,class:"dialog-inner-form"},{default:a(()=>[e(S,{label:"选择节点",name:"nodeId"},{default:a(()=>[e(p,{modelValue:r.nodeId,"onUpdate:modelValue":h[0]||(h[0]=w=>r.nodeId=w),placeholder:"请选择节点",onChange:y},{default:a(()=>[(o(!0),C(de,null,ye(_.value,w=>(o(),O(U,{key:w.value,label:w.label},{default:a(()=>[(o(!0),C(de,null,ye(w.children,A=>(o(),O(z,{key:A.nodeId,value:A.nodeId,label:A.name},{default:a(()=>[t("div",w1,[t("span",k1,I(A.name),1),t("div",$1,[e(g,{size:"small",variant:"outline",theme:"primary"},{default:a(()=>[v(I(A.bandwidth||"未知带宽"),1)]),_:2},1024),e(g,{size:"small",theme:A.isOnline?"success":"danger"},{default:a(()=>[v(I(A.isOnline?"在线":"离线"),1)]),_:2},1032,["theme"])])])]),_:2},1032,["value","label"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),c.value?(o(),O(S,{key:0,label:"节点详情"},{default:a(()=>[t("div",x1,[t("div",A1,[t("pre",null,I(c.value.description||"此节点暂无备注"),1)])])]),_:1})):K("",!0),e(S,{label:"隧道类型"},{default:a(()=>[e(p,{modelValue:r.proxyType,"onUpdate:modelValue":h[1]||(h[1]=w=>r.proxyType=w)},{default:a(()=>[c.value?.allowType.includes("tcp")?(o(),O(z,{key:0,label:"TCP",value:"tcp"})):K("",!0),c.value?.allowType.includes("udp")?(o(),O(z,{key:1,label:"UDP",value:"udp"})):K("",!0),c.value?.allowType.includes("http")?(o(),O(z,{key:2,label:"HTTP",value:"http"})):K("",!0),c.value?.allowType.includes("https")?(o(),O(z,{key:3,label:"HTTPS",value:"https"})):K("",!0)]),_:1},8,["modelValue"])]),_:1}),e(P,{gutter:[16,20]},{default:a(()=>[e(R,{xs:12,sm:6},{default:a(()=>[e(S,{label:"隧道名称"},{default:a(()=>[e(b,{modelValue:r.proxyName,"onUpdate:modelValue":h[2]||(h[2]=w=>r.proxyName=w)},null,8,["modelValue"])]),_:1})]),_:1}),e(R,{xs:12,sm:6},{default:a(()=>[e(S,{label:"远程端口"},{default:a(()=>[e(b,{modelValue:r.remotePort,"onUpdate:modelValue":h[3]||(h[3]=w=>r.remotePort=w)},{suffix:a(()=>[e(T,{variant:"text",size:"small",onClick:y},{default:a(()=>[...h[8]||(h[8]=[v("随机",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(R,{xs:12,sm:6},{default:a(()=>[e(S,{label:"本地IP"},{default:a(()=>[e(b,{modelValue:r.localIp,"onUpdate:modelValue":h[4]||(h[4]=w=>r.localIp=w)},null,8,["modelValue"])]),_:1})]),_:1}),e(R,{xs:12,sm:6},{default:a(()=>[e(S,{label:"本地端口"},{default:a(()=>[e(b,{modelValue:r.localPort,"onUpdate:modelValue":h[5]||(h[5]=w=>r.localPort=w)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),r.proxyType.includes("http")?(o(),O(S,{key:1,label:"绑定域名",class:"spacing-item"},{default:a(()=>[e(b,{modelValue:r.domain,"onUpdate:modelValue":h[6]||(h[6]=w=>r.domain=w),placeholder:"输入绑定的域名"},null,8,["modelValue"])]),_:1})):K("",!0)]),_:1},8,["data"])]),_:1},8,["loading"])]),_:1},8,["visible","confirm-btn"])}}}),S1=ie(C1,[["__scopeId","data-v-e521e9da"]]),I1={class:"page-container"},V1={key:0,class:"login-container"},M1={class:"login-card"},L1={class:"icon-wrapper"},U1={class:"submit-btn-wrap"},B1={class:"submit-btn-wrap"},z1={class:"register-link"},P1={key:1,class:"dashboard-container"},R1={class:"stat-item"},E1={class:"value"},T1={class:"stat-item"},F1={class:"value"},D1={class:"stat-item"},O1={class:"value"},j1={class:"stat-item"},K1={class:"value"},N1={class:"list-header"},q1={class:"tunnel-list"},G1=["onClick"],H1={class:"item-icon"},J1={class:"item-content"},W1={class:"item-title"},X1={class:"item-subtitle"},Q1={class:"item-status"},Y1={key:0,class:"empty-state"},Z1={key:0,class:"detail-content"},ef={class:"detail-header"},tf={class:"remarks"},af={class:"detail-grid"},sf={class:"val"},lf={class:"detail-grid"},nf={class:"val"},of={class:"detail-grid"},rf={class:"val highlight"},uf={class:"detail-grid"},df={class:"action-area"},cf={key:1,class:"empty-detail"},mf=se({__name:"index",setup(s){const l=x(!1),n=x(""),d=x(!1),i=x(null),u=x([]),f=x({}),r=x(null),c=x("password"),_=x({username:"",password:"",captchaCallback:"",token:""}),y=x(!1),M=()=>{p()},$=ee(()=>u.value.find(w=>w.proxyId===r.value)||null),V=ee(()=>$.value?f.value[$.value.nodeId]||`节点 (${$.value.nodeId})`:"");Ce(()=>{const w=localStorage.getItem("mefrp-user-token");w&&(n.value=w,p())});const h=()=>{const L=(window.screen.width-500)/2,H=(window.screen.height-600)/2;window.open("https://www.mefrp.com/3rdparty/captcha?client=MSLX","MEFrpCaptcha",`width=500,height=600,left=${L},top=${H},resizable=yes,scrollbars=yes,status=no,toolbar=no,menubar=no,location=no`),B.info("请在弹出的独立窗口中完成验证，并将获取到的验证码粘贴到下方")};async function g(){if(!_.value.username||!_.value.password||!_.value.captchaCallback){B.warning("请填写完整的账号、密码和验证码");return}y.value=!0;try{const A=atob(_.value.captchaCallback).split("||");if(A.length!==2)throw new Error("验证码格式错误");const L=await Q.post({url:"/public/login",baseURL:"https://api.mefrp.com/api",data:{username:_.value.username,password:_.value.password,vaptchaToken:A[0],vaptchaServer:A[1]}},{withToken:!1});L&&L.token?(B.success("登录成功"),await z(L.token)):B.error("登录失败：未获取到 Token")}catch(w){B.error("登录异常: "+w.message)}finally{y.value=!1}}async function z(w){const A=w||_.value.token;if(!A){B.warning("请输入Token");return}y.value=!0;try{const L=await Q.get({url:"/auth/user/info",baseURL:"https://api.mefrp.com/api",headers:{Authorization:`Bearer ${A}`}},{withToken:!1});L&&(B.success("Token验证成功"),n.value=A,localStorage.setItem("mefrp-user-token",A),i.value=L,await p())}catch(L){B.error("验证失败: "+L.message)}finally{y.value=!1}}const U=w=>{if(!w||w===0)return"0 B";const A=w*1024,L=1024,H=["B","KB","MB","GB","TB"],J=Math.floor(Math.log(A)/Math.log(L));return parseFloat((A/Math.pow(L,J)).toFixed(2))+" "+H[J]};async function p(){d.value=!0;try{const w=await Q.get({url:"/auth/user/info",baseURL:"https://api.mefrp.com/api",headers:{Authorization:`Bearer ${n.value}`}},{withToken:!1});if(w)i.value=w;else{T();return}const A=await Q.get({url:"/auth/proxy/list",baseURL:"https://api.mefrp.com/api",headers:{Authorization:`Bearer ${n.value}`}},{withToken:!1});if(A){const L={};(A.nodes||[]).forEach(H=>{L[H.nodeId]=H.name}),f.value=L,u.value=A.proxies||[],u.value.length>0&&!r.value&&(r.value=u.value[0].proxyId)}}catch(w){B.error("数据加载失败: "+w.message)}finally{d.value=!1}}const S=x(!1);async function b(){if($.value){S.value=!0;try{const w=await Q.post({url:"/auth/proxy/config",baseURL:"https://api.mefrp.com/api",data:{proxyId:$.value.proxyId,format:"toml"},headers:{Authorization:`Bearer ${n.value}`}},{withToken:!1});w&&w.config?(await ka($.value.proxyName,w.config,"ME Frp"),B.success("配置已成功加载")):B.error("获取配置失败")}catch(w){B.error("获取配置失败: "+w.message)}finally{S.value=!1}}}const R=()=>{l.value=!0};function T(){n.value="",i.value=null,u.value=[],r.value=null,localStorage.removeItem("mefrp-user-token"),B.success("已退出登录")}async function P(){await p(),B.success("数据已更新")}const G=()=>{const L=(window.screen.width-800)/2,H=(window.screen.height-600)/2;window.open(`https://www.mefrp.com/3rdparty/sign?client=MSL&&token=${n.value}`,"MEFrpSign",`width=800,height=600,left=${L},top=${H},resizable=yes,scrollbars=yes`),B.info("请在弹出的窗口中完成签到，完成后点击右上角刷新数据")},N=x(!1);async function E(){if($.value){N.value=!0;try{await Q.post({url:"/auth/proxy/delete",baseURL:"https://api.mefrp.com/api",data:{proxyId:$.value.proxyId},headers:{Authorization:`Bearer ${n.value}`}},{withToken:!1}),B.success("隧道删除成功"),r.value=null,await p()}catch(w){B.error("删除失败: "+w.message)}finally{N.value=!1}}}return(w,A)=>{const L=m("t-tab-panel"),H=m("t-tabs"),J=m("t-input"),X=m("t-form-item"),q=m("t-button"),_e=m("t-form"),De=m("t-loading"),fe=m("t-tag"),Pe=m("t-popconfirm"),Le=m("t-space"),Ve=m("t-col"),Be=m("t-row"),Oe=m("t-card"),re=m("t-divider");return o(),C("div",I1,[n.value===""?(o(),C("div",V1,[t("div",M1,[t("div",L1,[e(k(zt),{size:"56px",style:{color:"var(--td-brand-color)"}})]),A[12]||(A[12]=t("h2",{class:"title"},"登录 ME Frp",-1)),A[13]||(A[13]=t("p",{class:"subtitle"},"选择您的登录方式以接入服务",-1)),e(H,{modelValue:c.value,"onUpdate:modelValue":A[0]||(A[0]=ce=>c.value=ce),class:"custom-tabs"},{default:a(()=>[e(L,{value:"password",label:"账号密码登录"}),e(L,{value:"token",label:"Token 登录"})]),_:1},8,["modelValue"]),c.value==="password"?(o(),O(_e,{key:0,data:_.value,class:"login-form","label-width":"0",onSubmit:g},{default:a(()=>[e(X,{name:"username"},{default:a(()=>[e(J,{modelValue:_.value.username,"onUpdate:modelValue":A[1]||(A[1]=ce=>_.value.username=ce),size:"large",placeholder:"请输入 ME Frp 账号",clearable:""},{"prefix-icon":a(()=>[e(k(zt))]),_:1},8,["modelValue"])]),_:1}),e(X,{name:"password"},{default:a(()=>[e(J,{modelValue:_.value.password,"onUpdate:modelValue":A[2]||(A[2]=ce=>_.value.password=ce),size:"large",type:"password",placeholder:"请输入密码",clearable:""},{"prefix-icon":a(()=>[e(k(Zt))]),_:1},8,["modelValue"])]),_:1}),e(X,{name:"captchaCallback"},{default:a(()=>[e(J,{modelValue:_.value.captchaCallback,"onUpdate:modelValue":A[3]||(A[3]=ce=>_.value.captchaCallback=ce),size:"large",placeholder:"请粘贴获取到的验证码",clearable:""},{"prefix-icon":a(()=>[e(k(Bs))]),suffix:a(()=>[e(q,{variant:"text",size:"small",theme:"primary",onClick:h},{default:a(()=>[...A[8]||(A[8]=[v(" 获取验证码 ",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t("div",U1,[e(q,{block:"",theme:"primary",type:"submit",size:"large",loading:y.value},{default:a(()=>[...A[9]||(A[9]=[v("立即登录",-1)])]),_:1},8,["loading"])])]),_:1},8,["data"])):(o(),O(_e,{key:1,data:_.value,class:"login-form","label-width":"0",onSubmit:A[5]||(A[5]=()=>z())},{default:a(()=>[e(X,{name:"token"},{default:a(()=>[e(J,{modelValue:_.value.token,"onUpdate:modelValue":A[4]||(A[4]=ce=>_.value.token=ce),size:"large",type:"password",placeholder:"请输入 ME Frp 账户 Token",clearable:""},{"prefix-icon":a(()=>[e(k(Sl))]),_:1},8,["modelValue"])]),_:1}),t("div",B1,[e(q,{block:"",theme:"primary",type:"submit",size:"large",loading:y.value},{default:a(()=>[...A[10]||(A[10]=[v("验证 Token",-1)])]),_:1},8,["loading"])])]),_:1},8,["data"])),t("div",z1,[e(q,{variant:"text",size:"small",onClick:A[6]||(A[6]=ce=>k(Ie)("https://www.mefrp.com/register"))},{default:a(()=>[...A[11]||(A[11]=[v("还没有账户？注册 ME Frp",-1)])]),_:1})])])])):(o(),C("div",P1,[e(De,{attach:"#app-space",loading:d.value,text:"加载数据中..."},null,8,["loading"]),e(Le,{id:"app-space",direction:"vertical",size:"large",style:{width:"100%"}},{default:a(()=>[i.value?(o(),O(Oe,{key:0,bordered:!1,title:"ME Frp 用户信息",class:"info-card"},{actions:a(()=>[e(Le,{size:"small"},{default:a(()=>[e(q,{variant:"outline",theme:"primary",size:"small",disabled:i.value.todaySigned,onClick:G},{default:a(()=>[v(I(i.value.todaySigned?"今日已签到":"每日签到"),1)]),_:1},8,["disabled"]),e(fe,{theme:"primary",variant:"light-outline"},{default:a(()=>[v(I(i.value.friendlyGroup),1)]),_:1}),e(Pe,{content:"确认退出登录吗？",onConfirm:T},{default:a(()=>[e(q,{variant:"outline",theme:"danger",size:"small"},{default:a(()=>[...A[14]||(A[14]=[v(" 退出登录 ",-1)])]),_:1})]),_:1})]),_:1})]),default:a(()=>[e(Be,{gutter:[16,16]},{default:a(()=>[e(Ve,{xs:6,sm:3},{default:a(()=>[t("div",R1,[A[16]||(A[16]=t("div",{class:"label"},"用户昵称",-1)),t("div",E1,[v(I(i.value.username)+" ",1),i.value.friendlyGroup!=="未实名"?(o(),O(fe,{key:0,theme:"success",variant:"dark",size:"small"},{default:a(()=>[...A[15]||(A[15]=[v("已实名",-1)])]),_:1})):K("",!0)])])]),_:1}),e(Ve,{xs:6,sm:3},{default:a(()=>[t("div",T1,[A[17]||(A[17]=t("div",{class:"label"},"隧道使用情况",-1)),t("div",F1,I(i.value.usedProxies)+" / "+I(i.value.maxProxies)+" 条",1)])]),_:1}),e(Ve,{xs:6,sm:3},{default:a(()=>[t("div",D1,[A[18]||(A[18]=t("div",{class:"label"},"速率限制",-1)),t("div",O1,I(i.value.outBound?Math.floor(i.value.outBound/128):0)+" Mbps",1)])]),_:1}),e(Ve,{xs:6,sm:3},{default:a(()=>[t("div",j1,[A[19]||(A[19]=t("div",{class:"label"},"剩余流量",-1)),t("div",K1,I(U(i.value.traffic)),1)])]),_:1})]),_:1})]),_:1})):K("",!0),e(Be,{gutter:[16,16]},{default:a(()=>[e(Ve,{xs:12,md:5,lg:4},{default:a(()=>[e(Oe,{bordered:!1,class:"full-height-card"},{title:a(()=>[t("div",N1,[A[22]||(A[22]=t("span",null,"我的隧道",-1)),e(Le,{size:"4px"},{default:a(()=>[e(q,{size:"small",variant:"text",loading:d.value,onClick:P},{icon:a(()=>[e(k(st))]),default:a(()=>[A[20]||(A[20]=v("刷新 ",-1))]),_:1},8,["loading"]),e(q,{size:"small",variant:"text",onClick:R},{icon:a(()=>[e(k(Yt))]),default:a(()=>[A[21]||(A[21]=v("新建 ",-1))]),_:1})]),_:1})])]),default:a(()=>[t("div",q1,[(o(!0),C(de,null,ye(u.value,ce=>(o(),C("div",{key:ce.proxyId,class:ke(["tunnel-item",{active:r.value===ce.proxyId}]),onClick:Ke=>r.value=ce.proxyId},[t("div",H1,[e(k(wt))]),t("div",J1,[t("div",W1,I(ce.proxyName),1),t("div",X1,I(f.value[ce.nodeId]||`Node ${ce.nodeId}`),1)]),t("div",Q1,[ce.isOnline?(o(),O(fe,{key:0,theme:"success",variant:"light",size:"small"},{default:a(()=>[...A[23]||(A[23]=[v("在线",-1)])]),_:1})):(o(),O(fe,{key:1,theme:"default",variant:"light",size:"small"},{default:a(()=>[...A[24]||(A[24]=[v("离线",-1)])]),_:1}))])],10,G1))),128)),u.value.length===0?(o(),C("div",Y1,"暂无隧道")):K("",!0)])]),_:1})]),_:1}),e(Ve,{xs:12,md:7,lg:8},{default:a(()=>[e(Oe,{bordered:!1,class:"full-height-card"},{title:a(()=>[...A[25]||(A[25]=[t("span",null,"隧道详情",-1)])]),actions:a(()=>[$.value?(o(),O(Pe,{key:0,content:"确认删除此隧道吗？",theme:"danger",placement:"bottom-right",onConfirm:E},{default:a(()=>[e(q,{theme:"danger",variant:"text",loading:N.value},{default:a(()=>[...A[26]||(A[26]=[v(" 删除隧道 ",-1)])]),_:1},8,["loading"])]),_:1})):K("",!0)]),default:a(()=>[$.value?(o(),C("div",Z1,[t("div",ef,[t("h3",null,I($.value.proxyName),1),t("p",tf,"隧道 ID: "+I($.value.proxyId),1)]),e(re),e(Be,{gutter:[24,24]},{default:a(()=>[e(Ve,{span:6},{default:a(()=>[t("div",af,[A[27]||(A[27]=t("span",{class:"label"},"所在节点",-1)),t("span",sf,I(V.value),1)])]),_:1}),e(Ve,{span:6},{default:a(()=>[t("div",lf,[A[28]||(A[28]=t("span",{class:"label"},"本地地址",-1)),t("span",nf,I($.value.localIp)+":"+I($.value.localPort),1)])]),_:1}),e(Ve,{span:6},{default:a(()=>[t("div",of,[A[29]||(A[29]=t("span",{class:"label"},"远程端口",-1)),t("span",rf,I($.value.remotePort),1)])]),_:1}),e(Ve,{span:6},{default:a(()=>[t("div",uf,[A[30]||(A[30]=t("span",{class:"label"},"当前状态",-1)),t("span",{class:"val",style:rt({color:$.value.isOnline?"var(--td-success-color)":""})},I($.value.isOnline?"节点在线":"离线"),5)])]),_:1})]),_:1}),e(re),t("div",df,[e(q,{theme:"primary",size:"large",loading:S.value,block:"",onClick:b},{icon:a(()=>[e(k(Ft))]),default:a(()=>[A[31]||(A[31]=v(" 启动此隧道映射 ",-1))]),_:1},8,["loading"])])])):(o(),C("div",cf,[e(k(Vt),{size:"48px",style:{color:"var(--td-text-color-disabled)"}}),A[32]||(A[32]=t("p",null,"请在左侧选择一个隧道查看详情",-1))]))]),_:1})]),_:1})]),_:1})]),_:1})])),l.value?(o(),O(S1,{key:2,visible:l.value,"onUpdate:visible":A[7]||(A[7]=ce=>l.value=ce),token:n.value,onSuccess:M},null,8,["visible","token"])):K("",!0)])}}}),pf=ie(mf,[["__scopeId","data-v-43fd4708"]]),vf=se({__name:"index",setup(s){const l=x(1);return(n,d)=>{const i=m("t-tab-panel"),u=m("t-tabs"),f=m("t-card");return o(),C("div",null,[e(f,{direction:"vertical"},{default:a(()=>[e(u,{modelValue:l.value,"onUpdate:modelValue":d[0]||(d[0]=r=>l.value=r)},{default:a(()=>[e(i,{value:1,label:"MSLFrp","destroy-on-hide":!1},{default:a(()=>[e(m1,{style:{margin:"15px"}})]),_:1}),e(i,{value:2,label:"MSL 联机","destroy-on-hide":!1},{default:a(()=>[e(b1,{style:{margin:"15px"}})]),_:1}),e(i,{value:3,label:"ME Frp","destroy-on-hide":!1},{default:a(()=>[e(pf,{style:{margin:"15px"}})]),_:1}),e(i,{value:888,label:"自定义配置","destroy-on-hide":!1},{default:a(()=>[e(Xp,{style:{margin:"15px"}})]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}}),ff=Object.freeze(Object.defineProperty({__proto__:null,default:vf},Symbol.toStringTag,{value:"Module"})),gf={class:"terminal-header"},_f={class:"tab-title"},hf=se({__name:"ConsoleTerminal",props:{frpId:{}},emits:["update"],setup(s,{expose:l,emit:n}){const d=s,i=n,u=Ee(),f=x(null),r=x(null);let c=null,_=null,y=null,M=null,$=null;const V={dark:{background:"transparent",foreground:"#cccccc",cursor:"transparent",selectionBackground:"#264f78",black:"#000000",red:"#cd3131",green:"#0dbc79",yellow:"#e5e510",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"},light:{background:"transparent",foreground:"#333333",cursor:"transparent",selectionBackground:"#add6ff",black:"#000000",red:"#cd3131",green:"#00bc79",yellow:"#9d9d10",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#aeae11",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"}};ue.enabled=!0;const h=T=>T?(T=T.replace(/^(\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2}(\.\d{3})?)/,P=>ue.gray(P)),T=T.replace(/\[I\]/g,ue.green("[I]")),T=T.replace(/\[W\]/g,ue.yellow("[W]")),T=T.replace(/\[E\]/g,ue.red("[E]")),T=T.replace(/(success)/gi,P=>ue.bold.green(P)),T=T.replace(/(start|starting)/gi,P=>ue.blue(P)),T=T.replace(/(failed|error)/gi,P=>ue.bgRed.white(` ${P} `)),T=T.replace(/(:\d{4,5})/g,P=>ue.cyan(P)),T=T.replace(/(\[[0-9a-f]{8,}\])/g,P=>ue.magenta(P)),T):"",g=()=>{if(!r.value||!f.value)return;if(c){c.clear(),U();return}const T=document.documentElement.getAttribute("theme-mode")==="dark";c=new Ns({cursorBlink:!1,cursorStyle:"bar",fontSize:14,fontFamily:'"Maple Mono", "Maple Mono CN", "Cascadia Code", Consolas, Menlo, "PingFang SC", "Microsoft YaHei", monospace',lineHeight:1.4,theme:T?V.dark:V.light,allowTransparency:!0,disableStdin:!0,convertEol:!0}),_=new qs,c.loadAddon(_),c.open(r.value);const P=()=>{if(r.value&&r.value.clientWidth>0&&r.value.clientHeight>0)try{_?.fit(),c?.scrollToBottom()}catch(G){console.warn(G)}};y=new ResizeObserver(()=>window.requestAnimationFrame(P)),y.observe(f.value),setTimeout(P,100),U()},z=()=>{if(!c)return;const T=document.documentElement.getAttribute("theme-mode")==="dark";c.options.theme=T?V.dark:V.light},U=()=>{c?.writeln("\x1B[1;34m[System]\x1B[0m 正在初始化Frp控制台 ..."),c?.writeln(`\x1B[1;34m[System]\x1B[0m ID: ${d.frpId} | 状态: \x1B[32m已就绪！\x1B[0m`)},p=async()=>{if($)try{await $.stop(),$=null}catch(T){console.error(T)}},S=async()=>{if(await p(),!d.frpId)return;const{baseUrl:T,token:P}=u,G=new URL("/api/hubs/frpLogsHub",T||window.location.origin);P&&G.searchParams.append("x-user-token",P),$=new Mt().withUrl(G.toString(),{withCredentials:!1}).configureLogging(Et.Warning).withAutomaticReconnect([0,2e3,5e3,1e4,3e4]).build(),$.on("ReceiveLog",N=>{c?.writeln(h(N)),N.includes("[MSLX]")&&setTimeout(()=>{i("update")},2e3)}),$.onreconnecting(N=>{c?.writeln("\x1B[1;33m[System] 检测到连接中断，正在尝试重连...\x1B[0m"),console.warn("SignalR Reconnecting:",N)}),$.onreconnected(async()=>{c?.writeln("\x1B[1;32m[System] 网络已恢复，重新连接日志服务...\x1B[0m");try{await $?.invoke("JoinGroup",d.frpId),c?.writeln("\x1B[1;32m[System] 日志服务成功重新连接！\x1B[0m")}catch(N){c?.writeln(`\x1B[1;31m[Error] 重新连接日志服务失败: ${N.message}\x1B[0m`)}}),$.onclose(N=>{N&&(c?.writeln(`\x1B[1;31m[System] 日志服务连接已断开: ${N.message}\x1B[0m`),c?.writeln("\x1B[1;31m[System] 请刷新页面或检查网络连接。\x1B[0m"))});try{await $.start(),c?.writeln("\x1B[1;32m[System] 成功连接到Frpc日志服务\x1B[0m"),await $.invoke("JoinGroup",d.frpId)}catch(N){c?.writeln(`\x1B[1;31m[Error] 连接失败: ${N.message}\x1B[0m`)}};return l({writeln:T=>c?.writeln(T),clear:()=>{c?.clear(),U()}}),we(()=>d.frpId,async T=>{T&&(g(),await S())}),Ce(async()=>{await bt(),g(),M=new MutationObserver(z),M.observe(document.documentElement,{attributes:!0,attributeFilter:["theme-mode"]}),d.frpId&&await S()}),Qe(async()=>{M?.disconnect(),await p(),c?.dispose(),y?.disconnect()}),(T,P)=>(o(),C("div",{ref_key:"terminalWrapper",ref:f,class:"terminal-wrapper"},[t("div",gf,[P[0]||(P[0]=t("div",{class:"dots"},[t("span",{class:"dot red"}),t("span",{class:"dot yellow"}),t("span",{class:"dot green"})],-1)),t("div",_f,"MSLX - Frp 控制台 | "+I(s.frpId),1)]),t("div",{ref_key:"terminalBody",ref:r,class:"terminal-body"},null,512)],512))}}),yf=ie(hf,[["__scopeId","data-v-71df361d"]]),ia=(s,l=!0,n="复制成功")=>new Promise((d,i)=>{navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(s).then(()=>{l&&B.success(n),d()}).catch(()=>{ys(s,l,n,d,i)}):ys(s,l,n,d,i)});function ys(s,l,n,d,i){try{const u=document.createElement("textarea");u.value=s,u.style.top="0",u.style.left="0",u.style.position="fixed",document.body.appendChild(u),u.focus(),u.select();const f=document.execCommand("copy");document.body.removeChild(u),f?(l&&B.success(n),d()):(l&&B.error("复制失败"),i(new Error("execCommand returned false")))}catch(u){l&&B.error("复制出错"),i(u)}}const bf={class:"sidebar-content"},wf={class:"control-header"},kf={class:"control-actions"},$f={class:"action-row"},xf={class:"info-list"},Af={class:"info-item"},Cf={class:"label"},Sf={class:"value"},If={key:0,class:"proxy-header"},Vf={class:"info-item"},Mf={class:"label"},Lf=["onClick"],Uf={class:"info-item"},Bf={class:"label"},zf={class:"value highlight"},Pf={class:"info-item"},Rf={class:"label"},Ef=["onClick"],Tf={key:1,class:"info-item"},Ff={class:"label"},Df=["onClick"],Of={class:"info-item"},jf={class:"label"},Kf={class:"value"},Nf={key:1,class:"info-item empty-state"},qf={class:"value"},Gf=se({__name:"ControlPanel",props:{frpId:{},isRunning:{type:Boolean},loading:{type:Boolean},tunnelInfo:{}},emits:["start","stop","clear-log","edit-config"],setup(s){return(l,n)=>{const d=m("t-tag"),i=m("t-button"),u=m("t-card"),f=m("t-tooltip");return o(),C("div",bf,[e(u,{class:"control-card",bordered:!1},{default:a(()=>[t("div",wf,[t("div",{class:ke(["status-indicator",{running:s.isRunning}])},[n[4]||(n[4]=t("span",{class:"pulse"},null,-1)),v(I(s.isRunning?"Running":"Stopped"),1)],2),e(d,{theme:s.isRunning?"success":"default",variant:"light",shape:"round"},{default:a(()=>[v(I(s.isRunning?"正常运行":"未运行"),1)]),_:1},8,["theme"])]),t("div",kf,[s.isRunning?(o(),O(i,{key:1,theme:"danger",size:"large",block:"",loading:s.loading,onClick:n[1]||(n[1]=r=>l.$emit("stop"))},{icon:a(()=>[e(k(va))]),default:a(()=>[n[6]||(n[6]=v("停止服务 ",-1))]),_:1},8,["loading"])):(o(),O(i,{key:0,theme:"primary",size:"large",block:"",loading:s.loading,onClick:n[0]||(n[0]=r=>l.$emit("start"))},{icon:a(()=>[e(k(Ft))]),default:a(()=>[n[5]||(n[5]=v("启动服务 ",-1))]),_:1},8,["loading"])),t("div",$f,[e(i,{class:"glass-btn",variant:"outline",theme:"warning",onClick:n[2]||(n[2]=r=>l.$emit("clear-log"))},{icon:a(()=>[e(k(st))]),default:a(()=>[n[7]||(n[7]=v("清空日志 ",-1))]),_:1}),e(i,{variant:"outline",theme:"default",onClick:n[3]||(n[3]=r=>l.$emit("edit-config"))},{icon:a(()=>[e(k(Il))]),default:a(()=>[n[8]||(n[8]=v("配置文件 ",-1))]),_:1})])])]),_:1}),e(u,{title:"隧道概览",class:"info-card",bordered:!1},{actions:a(()=>[s.tunnelInfo&&s.tunnelInfo.proxies&&s.tunnelInfo.proxies.length>0&&s.tunnelInfo.proxies.some(r=>r.type==="xtcp")?(o(),O(d,{key:0,variant:"light-outline",theme:"primary"},{default:a(()=>[...n[9]||(n[9]=[v("联机房间 - 房主",-1)])]),_:1})):s.tunnelInfo&&s.tunnelInfo.proxies&&s.tunnelInfo.proxies.length>0&&s.tunnelInfo.proxies.some(r=>r.type==="xtcp - Visitors")?(o(),O(d,{key:1,variant:"light-outline",theme:"primary"},{default:a(()=>[...n[10]||(n[10]=[v("联机房间 - 访客",-1)])]),_:1})):(o(),O(i,{key:2,shape:"circle",variant:"text"},{default:a(()=>[e(k(Pt))]),_:1}))]),default:a(()=>[t("div",xf,[t("div",Af,[t("div",Cf,[e(k(wt)),n[11]||(n[11]=v(" 隧道实例 ID",-1))]),t("div",Sf,"#"+I(s.frpId),1)]),s.tunnelInfo&&s.tunnelInfo.proxies&&s.tunnelInfo.proxies.length>0?(o(!0),C(de,{key:0},ye(s.tunnelInfo.proxies,(r,c)=>(o(),C("div",{key:c,class:"proxy-group"},[s.tunnelInfo.proxies.length>1?(o(),C("div",If,"配置 #"+I(c+1),1)):K("",!0),t("div",Vf,[t("div",Mf,[e(k(Vt)),v(" "+I(r.type.includes("xtcp")?"房间号":"隧道名称"),1)]),e(f,{content:r.proxyName,placement:"top","show-arrow":"","destroy-on-close":""},{default:a(()=>[t("div",{onClick:_=>k(ia)(r.proxyName,!0,`${r.type.includes("xtcp")?"房间号":"隧道名称"}已复制！`),class:"value remote-addr pointer"},I(r.proxyName),9,Lf)]),_:2},1032,["content"])]),t("div",Uf,[t("div",Bf,[e(k(Ms)),n[12]||(n[12]=v(" 协议类型",-1))]),t("div",zf,I(r.type.toUpperCase()),1)]),t("div",Pf,[t("div",Rf,[e(k(It)),v(" "+I(r.type.includes("xtcp")?"房间密钥":"连接地址"),1)]),e(f,{content:r.remoteAddressMain,placement:"top","show-arrow":"","destroy-on-close":""},{default:a(()=>[t("div",{class:"value remote-addr pointer",onClick:_=>k(ia)(r.remoteAddressMain,!0,`${r.type.includes("xtcp")?"房间密钥":"连接地址"}已复制！`)},I(r.remoteAddressMain||"获取中..."),9,Ef)]),_:2},1032,["content"])]),r.remoteAddressBackup&&r.remoteAddressBackup!==r.remoteAddressMain?(o(),C("div",Tf,[t("div",Ff,[e(k(It)),n[13]||(n[13]=v(" 备用地址",-1))]),e(f,{content:r.remoteAddressBackup,placement:"top","show-arrow":"","destroy-on-close":""},{default:a(()=>[t("div",{class:"value remote-addr pointer",onClick:_=>k(ia)(r.remoteAddressBackup,!0,"备用连接地址已复制！")},I(r.remoteAddressBackup),9,Df)]),_:2},1032,["content"])])):K("",!0),t("div",Of,[t("div",jf,[e(k(Pt)),n[14]||(n[14]=v(" 本地地址",-1))]),t("div",Kf,I(r.localAddress),1)])]))),128)):(o(),C("div",Nf,[n[15]||(n[15]=t("div",{class:"label"},"状态",-1)),t("div",qf,I(s.loading?"正在加载配置...":"暂无详细信息"),1)]))])]),_:1})])}}}),Hf=ie(Gf,[["__scopeId","data-v-3a2669c8"]]),Jf={class:"editor-container"},Wf={class:"editor-status-bar"},Xf={class:"mode-tag"},Qf={class:"dialog-footer"},Yf={class:"footer-left"},Zf={class:"footer-right"},eg=se({__name:"FileEditor",props:{visible:Boolean,fileName:String,content:String,loading:Boolean},emits:["update:visible","save"],setup(s,{emit:l}){const n=s,d=l,i=async()=>{if(!u.value)return;const $=n.fileName?.split(".").pop()?.toLowerCase();let V="",h=[];switch($){case"json":V="json",h=[ss,ls];break;case"yml":case"yaml":V="yaml",h=[An];break;case"js":case"ts":V="babel",h=[ss,ls];break;case"css":case"less":case"scss":V="css",h=[xn];break;case"html":case"xml":V="html",h=[$n];break;default:B.warning("该文件类型暂不支持自动格式化");return}try{const g=await kn.format(u.value,{parser:V,plugins:h,tabWidth:2,printWidth:80,semi:!0,singleQuote:!0});u.value=g,B.success("格式化成功")}catch(g){console.error(g),B.error(`格式化失败: 请检查语法错误
${g.message.split(`
`)[0]}`)}},u=x(""),f=x(!1);let r=null;const c=()=>{const $=document.documentElement.getAttribute("theme-mode");f.value=$==="dark"};Ce(()=>{c(),r=new MutationObserver(c),r.observe(document.documentElement,{attributes:!0,attributeFilter:["theme-mode"]})}),Qe(()=>{r?.disconnect()}),we(()=>n.content,$=>{u.value=$||""},{immediate:!0});const _=ee(()=>{const $=[];switch(f.value&&$.push(pn),$.push(vn.phrases.of({Find:"查找内容...",Replace:"替换为...",next:"下一个",previous:"上一个",all:"选中所有","match case":"区分大小写","by word":"全字匹配",regexp:"正则表达式",replace:"替换","replace all":"替换全部",close:"关闭"})),n.fileName?.split(".").pop()?.toLowerCase()){case"json":$.push(wn());break;case"yml":case"yaml":$.push(bn());break;case"js":case"ts":$.push(yn());break;case"css":case"less":case"scss":$.push(hn());break;case"html":case"xml":$.push(_n());break;case"toml":case"ini":case"conf":$.push(fn.define(gn));break}return $}),y=()=>{d("update:visible",!1)},M=()=>{d("save",u.value)};return($,V)=>{const h=m("t-button"),g=m("t-dialog");return o(),O(g,{visible:s.visible,header:`正在编辑: ${s.fileName}`,width:"90%",attach:"body",top:"1vh",class:"editor-dialog",onClose:y},{footer:a(()=>[t("div",Qf,[t("div",Yf,[e(h,{variant:"outline",theme:"default",onClick:i},{default:a(()=>[...V[1]||(V[1]=[v(" 自动格式化 ",-1)])]),_:1})]),t("div",Zf,[e(h,{variant:"outline",onClick:y},{default:a(()=>[...V[2]||(V[2]=[v("取消",-1)])]),_:1}),e(h,{theme:"primary",loading:n.loading,onClick:M},{default:a(()=>[...V[3]||(V[3]=[v(" 保存 ",-1)])]),_:1},8,["loading"])])])]),default:a(()=>[t("div",Jf,[e(k(Vl),{modelValue:u.value,"onUpdate:modelValue":V[0]||(V[0]=z=>u.value=z),placeholder:"文件内容为空...",style:{height:"70vh",fontSize:"14px"},autofocus:!0,"indent-with-tab":!0,"tab-size":2,extensions:_.value},null,8,["modelValue","extensions"])]),t("div",Wf,[t("span",null,"行数: "+I(u.value.split(`
`).length),1),t("span",null,"长度: "+I(u.value.length),1),t("span",Xf,I(f.value?"Dark Mode":"Light Mode"),1)])]),_:1},8,["visible","header"])}}}),el=ie(eg,[["__scopeId","data-v-8c0385d1"]]),tg={class:"console-page"},ag={class:"layout-container"},sg={class:"main-terminal-area"},lg={class:"sidebar-area"},ng=se({__name:"index",setup(s){const l=es(),n=Ze(),d=x(parseInt(n.params.frpId)||0),i=x(!1),u=x(!1),f=x(null),r=x(!1),c=x(""),_=x(""),y=x(!1),M=x(null);async function $(){if(d.value)try{f.value=await $p(d.value),i.value=f.value.isRunning,await l.getTunnels()}catch(S){console.error("获取隧道信息失败",S),M.value?.writeln(`\x1B[1;31m[Error] 获取隧道信息失败: ${S}\x1B[0m`)}}const V=async()=>{u.value=!0;try{M.value?.writeln("\x1B[1;32m[System] 正在发送启动指令...\x1B[0m"),await hs("start",d.value),i.value=!0,B.success("启动指令已发送"),setTimeout($,1500),M.value?.writeln("\x1B[1;35m\x1B[1m[TIPS] 注意：日志可能包含您的在线服务商的Token信息，若需要截图，请将关键信息打码处理！\x1B[0m")}catch(S){M.value?.writeln(`\x1B[1;31m[Error] Frpc启动失败: ${S.message}\x1B[0m`)}finally{u.value=!1}},h=async()=>{u.value=!0;try{M.value?.writeln("\x1B[1;32m[System] 正在发送停止指令...\x1B[0m"),await hs("stop",d.value),i.value=!1,B.warning("停止指令已发送"),setTimeout($,1e3)}catch(S){M.value?.writeln(`\x1B[1;31m[Error] Frpc停止失败: ${S.message}\x1B[0m`)}finally{u.value=!1}},g=()=>{M.value?.clear()},z=()=>{const S=at.confirm({header:"警告",body:`直接编辑配置文件可能会导致服务无法启动或异常。正常情况在线服务商提供的配置文件也不能修改。请确保您了解配置文件的格式和内容。

是否继续？`,theme:"warning",onConfirm:async()=>{S.hide(),await U()}})},U=async()=>{const S=B.loading("正在读取配置文件...");try{let b="toml";const R=l.frpList.find(N=>N.id===d.value);R&&R.configType&&(b=R.configType.toLowerCase());const T=`frpc.${b}`,P=`${d.value}/${T}`,G=await ya(0,P);c.value=T,_.value=G,r.value=!0,B.close(S)}catch(b){B.close(S),B.error("读取配置文件失败: "+b.message),M.value?.writeln(`\x1B[1;31m[Error] 读取配置文件失败: ${b.message}\x1B[0m`)}},p=async S=>{y.value=!0;try{const b=`${d.value}/${c.value}`;await Ja(0,b,S),B.success("配置文件保存成功"),r.value=!1,M.value?.writeln("\x1B[1;32m[System] 配置文件已更新，请重启服务以生效。\x1B[0m")}catch(b){B.error("保存失败"),M.value?.writeln(`\x1B[1;31m[Error] 保存失败: ${b.message}\x1B[0m`)}finally{y.value=!1}};return we(()=>n.params.frpId,async S=>{n.name==="FrpConsole"&&S&&(d.value=parseInt(S),await $())}),Ce(()=>{d.value&&$()}),(S,b)=>(o(),C("div",tg,[t("div",ag,[t("div",sg,[e(yf,{ref_key:"terminalRef",ref:M,"frp-id":d.value,onUpdate:b[0]||(b[0]=R=>$())},null,8,["frp-id"])]),t("div",lg,[e(Hf,{"frp-id":d.value,"is-running":i.value,loading:u.value,"tunnel-info":f.value,onStart:V,onStop:h,onClearLog:g,onEditConfig:z},null,8,["frp-id","is-running","loading","tunnel-info"])])]),e(el,{visible:r.value,"onUpdate:visible":b[1]||(b[1]=R=>r.value=R),"file-name":c.value,content:_.value,loading:y.value,onSave:p},null,8,["visible","file-name","content","loading"])]))}}),og=ie(ng,[["__scopeId","data-v-d01d4c2c"]]),ig=Object.freeze(Object.defineProperty({__proto__:null,default:og},Symbol.toStringTag,{value:"Module"})),la=kt("instanceHub",()=>{const s=Ee(),l=x(null),n=x(!1),d=x(null),i=x(0),u=x(0);let f=Promise.resolve();const r=x({cpu:0,memBytes:0,memPercent:0}),c=new Set,_=new Set,y=new Set,M=new Set,$=new Set,V=new Set,h=N=>{u.value=N},g=N=>(f=f.then(async()=>{if(i.value++,l.value?.state==="Connected"&&d.value===N)return;l.value&&await U(),d.value=N,u.value=0;const{baseUrl:E,token:w}=s,A=new URL("/api/hubs/instanceControlHub",E||window.location.origin);w&&A.searchParams.append("x-user-token",w);const L=new Mt().withUrl(A.toString(),{withCredentials:!1}).configureLogging(Et.Warning).withAutomaticReconnect([0,2e3,5e3,1e4]).build();L.on("ReceiveLog",H=>{c.forEach(J=>J(H))}),L.on("RequireEULA",()=>{_.forEach(H=>H())}),L.on("CommandResult",(H,J)=>{y.forEach(X=>X(H,J))}),L.on("ReceiveStatus",(H,J,X)=>{if(String(H)!==String(N))return;let q=0;if(u.value>0){const _e=u.value*1024*1024;q=X/_e*100,q>100&&(q=100)}r.value={cpu:J,memBytes:X,memPercent:q}}),L.on("PlayerJoined",(H,J)=>{String(H)===String(N)&&M.forEach(X=>X(J))}),L.on("PlayerLeft",(H,J)=>{String(H)===String(N)&&$.forEach(X=>X(J))}),L.on("PlayerListCleared",H=>{String(H)===String(N)&&V.forEach(J=>J())}),L.onreconnecting(()=>c.forEach(H=>H("\x1B[1;31m[System] 连接中断，尝试重连...\x1B[0m"))),L.onreconnected(async()=>{c.forEach(H=>H("\x1B[1;32m[System] 网络恢复，重新加入会话...\x1B[0m"));try{await L.invoke("JoinGroup",N)}catch(H){console.error(H)}});try{await L.start(),await L.invoke("JoinGroup",N),l.value=L,n.value=!0,c.forEach(H=>H("\x1B[1;32m[System] 已连接到实例控制服务\x1B[0m"))}catch(H){n.value=!1,c.forEach(J=>J(`\x1B[1;31m[Error] 连接失败: ${H.message}\x1B[0m`)),d.value=null,l.value=null}}),f),z=()=>(f=f.then(async()=>{i.value>0&&i.value--,i.value===0&&await U()}),f),U=async()=>{if(l.value)try{l.value.state==="Connected"&&d.value&&await l.value.invoke("LeaveGroup",d.value),await l.value.stop()}catch(N){console.warn(N)}l.value=null,n.value=!1,d.value=null,u.value=0,r.value={cpu:0,memBytes:0,memPercent:0}};return{isConnected:n,stats:r,currentServerId:d,connect:g,disconnect:z,setMaxMemory:h,sendCommand:async N=>{if(!l.value||l.value.state!=="Connected"||!d.value)throw new Error("未连接到服务");await l.value.invoke("SendCommand",d.value,N)},onLog:N=>(c.add(N),()=>c.delete(N)),onEula:N=>(_.add(N),()=>c.delete(N)),onCommandResult:N=>(y.add(N),()=>y.delete(N)),onPlayerJoined:N=>(M.add(N),()=>M.delete(N)),onPlayerLeft:N=>($.add(N),()=>$.delete(N)),onPlayerListCleared:N=>(V.add(N),()=>V.delete(N))}}),rg=Dt();ue.enabled=!0;const ug=(s,l=-1)=>s?(l===-1&&(l=rg.settings.webPanelColorizeLogLevel),l===0?s:(s=s.replace(/\n/g,`\r
`),s.includes("Done")&&s.includes("!")&&(s=s.replace(/Done \((.*?)\)!/g,(n,d)=>`${ue.green.bold("Done")} (${ue.blue(d)})!`)),s=s.replace(/\b(Server started|Starting Server)\b/g,n=>ue.green.bold(n)),s=s.replace(/\b(IPv4 supported|IPv6 supported)\b/g,n=>ue.cyan(n)),s.startsWith("[System]")&&(s=s.replace(/^\[System]/,`[${ue.blue.bold("System")}]`)),s.includes("[MSLX]")&&(s=s.replace(/\[MSLX]/g,`[${ue.magenta.bold("MSLX")}]`)),s.includes("[MSLX-Backup]")&&(s=s.replace(/\[MSLX-Backup]/g,`[${ue.magenta.bold("MSLX-Backup")}]`)),s.includes("[MSLX-Daemon]")&&(s=s.replace(/\[MSLX-Daemon]/g,`[${ue.magenta.bold("MSLX-Daemon")}]`)),s.startsWith(">>>")&&(s=s.replace(/^>>>/,ue.red.bold(">>>"))),l===1?(s=s.replace(/^\[[^\]]+\s+(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]/,(d,i)=>{switch(i){case"INFO":return ue.green(d);case"WARN":case"WARNING":return ue.yellow(d);case"ERROR":case"FATAL":return ue.red(d);case"DEBUG":return ue.blue(d);default:return d}}),s=s.replace(/^\[\d{2}:\d{2}:\d{2}\]\s+\[[^/]+\/(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]/,(d,i)=>{switch(i){case"INFO":return ue.green(d);case"WARN":case"WARNING":return ue.yellow(d);case"ERROR":case"FATAL":return ue.red(d);default:return d}}),(d=>{const i=/\u001b\[(0;)?31m/.test(d),u=/\b(ERROR|Exception|Caused by|at)\b/i.test(d);return i||u})(s)||(s=s.replace(new RegExp("(?<=:\\s|^)\\s*([([][a-zA-Z0-9_\\-.\\s]+[)\\]])(?=\\s)","g"),d=>ue.cyan(d))),s):/\u001b\[[\d;]*m/.test(s)?(s=s.replace(/(https?:\/\/[^\s]+)/g,n=>ue.blue.underline(n)),s):(s=s.replace(/^\[(\d{2}:\d{2}:\d{2})\s+(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]:/,(n,d,i)=>{let u=i;switch(i){case"INFO":u=ue.green("INFO");break;case"WARN":case"WARNING":u=ue.yellow.bold("WARN");break;case"ERROR":case"FATAL":u=ue.red.bold(i);break;case"DEBUG":u=ue.blue("DEBUG");break}return`[${ue.gray(d)} ${u}]:`}),/^\[\d{2}:\d{2}:\d{2}\]/.test(s)&&(s=s.replace(/^\[(\d{2}:\d{2}:\d{2})\]/,(n,d)=>`[${ue.gray(d)}]`)),s=s.replace(/\[([^/]+)\/(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]/g,(n,d,i)=>{const u=ue.blue(d);let f=i;switch(i){case"INFO":f=ue.green("INFO");break;case"WARN":f=ue.yellow("WARN");break;case"ERROR":f=ue.red.bold("ERROR");break}return`[${u}/${f}]`}),s=s.replace(new RegExp("(?<=:\\s|^)\\s*\\[([a-zA-Z0-9_\\-.\\s]+)\\](?=\\s)","g"),(n,d)=>d==="System"||d.includes("MSLX")?n:` [${ue.bold.black(d)}]`),s=s.replace(/(https?:\/\/[^\s]+)/g,n=>ue.blue.underline(n)),s=s.replace(new RegExp("\\b\\d+\\.\\d+[\\w.+\\-@]*(?<!ms|s|MB|GB|KB|%)\\b","g"),n=>ue.magenta(n)),s=s.replace(/\b\d+(\.\d+)?\s?(ms|s|%|MB|GB|KB)\b/gi,n=>ue.blue(n)),s=s.replace(new RegExp("(\\u001b\\[[\\d;]*m)|((?<!\\d:\\d)(?<![.\\-+])\\b\\d+\\b(?![.\\-+])(?!\\s*:\\s*\\d))","g"),(n,d,i)=>{if(d)return n;if(i){if(i.length>=4&&i.length<=6)return ue.blue(i);if(i.length<=3)return ue.blue(i)}return n}),s=s.replace(/(\*:\d{1,5})/,n=>ue.blue.bold(n)),s=s.replace(/\b(Loaded|Saved|Starting|Started|Connected)\b/g,n=>ue.green(n)),s=s.replace(/\bDone\b(?!\u001b)/g,ue.green.bold("Done")),s=s.replace(/\b(Failed|Exception|Error|Caused by|Stopping|Closed)\b/g,n=>ue.red.bold(n)),s=s.replace(/\b(Loading|Preparing|Generating|Saving|Using|Running)\b/g,n=>ue.magenta(n)),s=s.replace(/\b(Minecraft|Paper|Velocity|Java)\b/gi,n=>ue.bold.black(n)),s=s.replace(/'minecraft:[a-z_]+'/g,n=>ue.magenta(n)),s))):"",dg={class:"terminal-header"},cg={class:"tab-title"},mg={class:"terminal-footer"},pg=se({__name:"ServerTerminal",props:{serverId:{}},emits:["update"],setup(s,{expose:l,emit:n}){const d=s,i=n,u=la(),f=x(null),r=x(null);let c=null,_=null,y=null,M=null,$=null,V=null,h="";const g=x(""),z={dark:{background:"transparent",foreground:"#cccccc",cursor:"#cccccc",selectionBackground:"#264f78",black:"#000000",red:"#cd3131",green:"#0dbc79",yellow:"#e5e510",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"},light:{background:"transparent",foreground:"#333333",cursor:"#333333",selectionBackground:"#add6ff",black:"#000000",red:"#cd3131",green:"#00bc79",yellow:"#9d9d10",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f3d61a",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"}};ue.enabled=!0;const U=A=>ug(A),p=()=>{if(!r.value||!f.value)return;if(c){c.clear(),P();return}const A=document.documentElement.getAttribute("theme-mode")==="dark";c=new Ns({cursorBlink:!1,cursorStyle:"bar",fontSize:14,fontFamily:'"Maple Mono", "Maple Mono CN", "Cascadia Code", Consolas, Menlo, "PingFang SC", "Microsoft YaHei", monospace',lineHeight:1.4,theme:A?z.dark:z.light,allowTransparency:!0,convertEol:!0}),_=new qs,c.loadAddon(_),c.open(r.value),c.onData(H=>S(H));const L=()=>{if(r.value&&r.value.clientWidth>0&&r.value.clientHeight>0)try{_?.fit()}catch(H){console.warn(H)}};y=new ResizeObserver(()=>window.requestAnimationFrame(L)),y.observe(f.value),setTimeout(L,100),P()},S=async A=>{!c||!d.serverId||(A==="\r"?(c.write(`\r
`),h.trim()&&await R(h),h=""):A===""?h.length>0&&(h=h.slice(0,-1),c.write("\b \b")):A>=" "&&(h+=A,c.write(A)))},b=async()=>{if(!g.value)return;const A=g.value;c?.writeln(A),await R(A),g.value=""},R=async A=>{try{await u.sendCommand(A)}catch(L){c?.writeln(`\x1B[1;31m[Error] ${L.message}\x1B[0m`)}},T=()=>{if(!c)return;const A=document.documentElement.getAttribute("theme-mode")==="dark";c.options.theme=A?z.dark:z.light},P=()=>{c?.writeln("\x1B[1;34m[System]\x1B[0m 正在连接服务器控制台 ..."),c?.writeln(`\x1B[1;34m[System]\x1B[0m 实例 ID: ${d.serverId}`),c?.writeln("")},G=async()=>{d.serverId&&($&&$(),$=u.onLog(A=>{c&&c.writeln(U(A)),A.startsWith("[MSLX]")&&i("update")}),V&&V(),V=u.onCommandResult((A,L)=>{A||c?.writeln(`\x1B[1;31m[System] 指令执行反馈: ${L}\x1B[0m`)}),await u.connect(d.serverId))},N=async()=>{$&&$(),V&&V(),await u.disconnect()};return l({writeln:A=>c?.writeln(A),clear:()=>{c?.clear(),P()}}),we(()=>d.serverId,async(A,L)=>{A!==L&&(await N(),p(),await G())}),Ce(async()=>{await bt(),p(),M=new MutationObserver(T),M.observe(document.documentElement,{attributes:!0,attributeFilter:["theme-mode"]}),await G()}),Qe(async()=>{M?.disconnect(),y?.disconnect(),c?.dispose(),await N()}),(A,L)=>(o(),C("div",{ref_key:"terminalWrapper",ref:f,class:"terminal-wrapper"},[t("div",dg,[L[1]||(L[1]=t("div",{class:"dots"},[t("span",{class:"dot red"}),t("span",{class:"dot yellow"}),t("span",{class:"dot green"})],-1)),t("div",cg,"MSLX 服务端控制台 | #"+I(s.serverId),1)]),t("div",{ref_key:"terminalBody",ref:r,class:"terminal-body"},null,512),t("div",mg,[Je(t("input",{"onUpdate:modelValue":L[0]||(L[0]=H=>g.value=H),class:"cmd-input",placeholder:"发送控制台指令...",onKeyup:Ml(b,["enter"])},null,544),[[Vs,g.value]]),t("button",{class:"send-btn",onClick:b},"发送")])],512))}}),vg=ie(pg,[["__scopeId","data-v-127ea751"]]),fg={class:"settings-container"},gg={class:"setting-item"},_g={class:"setting-control"},hg={class:"setting-item"},yg={class:"setting-info"},bg={class:"desc"},wg={class:"setting-control"},kg={class:"setting-item"},$g={class:"setting-control"},xg={key:0,style:{"margin-top":"8px"}},Ag={class:"setting-item"},Cg={class:"setting-info"},Sg={class:"title"},Ig={class:"desc"},Vg={class:"setting-control"},Mg={class:"setting-item"},Lg={class:"setting-control"},Ug={key:0,class:"core-tools-panel"},Bg={key:0,class:"upload-progress"},zg={class:"setting-item"},Pg={class:"setting-control flex-row"},Rg={class:"memory-input-group"},Eg={class:"memory-input-group"},Tg={class:"setting-item"},Fg={class:"setting-control flex-row"},Dg={class:"setting-info-desc-only"},Og={style:{"font-size":"12px",color:"var(--td-text-color-placeholder)",cursor:"help"}},jg={class:"setting-item"},Kg={class:"setting-control"},Ng={key:0,style:{"margin-top":"8px"}},qg={key:2,class:"setting-group-title"},Gg={key:3,class:"setting-item"},Hg={class:"setting-control"},Jg={key:0,style:{"margin-top":"8px"}},Wg={class:"setting-item"},Xg={class:"setting-control"},Qg={class:"setting-item"},Yg={class:"setting-control"},Zg={class:"setting-item"},e_={class:"setting-control"},t_={key:4,class:"setting-item"},a_={class:"setting-control"},s_={class:"setting-item"},l_={class:"setting-control"},n_={class:"setting-item"},o_={class:"setting-control"},i_={class:"setting-item"},r_={class:"setting-control"},u_={key:5,class:"setting-item"},d_={class:"setting-control"},c_={class:"setting-item"},m_={class:"setting-control flex-row"},p_={class:"setting-item"},v_={class:"setting-control flex-row"},f_={class:"form-actions"},g_={class:"progress-body"},__={id:"update-log-box",class:"log-box"},h_={class:"time"},y_={key:0,class:"dialog-actions"},b_=se({__name:"GeneralSettings",setup(s){const l=Ze(),n=Ee(),d=ee(()=>{const le=l.params.serverId;return le?parseInt(le):NaN}),i=x(null),u=x(!1),f=x(!1),r=x(!1),c=[{label:"UTF-8",value:"utf-8"},{label:"GBK",value:"gbk"}],_=x({id:d.value,name:"",base:"",java:"",core:"",minM:1024,maxM:4096,args:"",yggdrasilApiAddr:"",backupMaxCount:20,backupDelay:10,backupPath:"MSLX://Backup/Instance",autoRestart:!1,forceAutoRestart:!0,ignoreEula:!1,runOnStartup:!1,inputEncoding:"utf-8",outputEncoding:"utf-8",fileEncoding:"utf-8",coreUrl:"",coreSha256:"",coreFileKey:""}),y=x("MB"),M=x("MB"),$=[{label:"MB",value:"MB"},{label:"GB",value:"GB"}],V=ee({get:()=>{if(y.value==="GB"){const le=_.value.minM/1024;return Math.round(le*100)/100}return _.value.minM},set:le=>{_.value.minM=y.value==="GB"?Math.round(le*1024):le}}),h=ee({get:()=>{if(M.value==="GB"){const le=_.value.maxM/1024;return Math.round(le*100)/100}return _.value.maxM},set:le=>{_.value.maxM=M.value==="GB"?Math.round(le*1024):le}}),g=x("custom"),z=x([]),U=x([]),p=x(""),S=x(""),b=async(le=!1)=>{try{le&&B.info("正在扫描 Java 环境...");const F=await Ya(n.userInfo.systemInfo.osType.toLowerCase().replace("os",""),n.userInfo.systemInfo.osArchitecture.toLowerCase());F&&Array.isArray(F)&&(z.value=F.map(ae=>({label:`Java ${ae} (在线)`,value:ae})));const j=await Za(le);U.value=j.map(ae=>({label:`Java ${ae.version} (${ae.path})`,value:ae.path})),le&&B.success("刷新成功")}catch(F){console.error(F)}};we([g,p,S],([le,F,j])=>{le==="none"?_.value.java="none":le==="env"?_.value.java="java":le==="custom"||le==="local"?_.value.java=j:le==="online"&&(_.value.java=F?`MSLX://Java/${F}`:"")});const R=x("MSLX://Backup/Instance"),T=x("");we([R,T],([le,F])=>{le==="custom"?_.value.backupPath=F:_.value.backupPath=le});const P=x(""),G=x(""),N=[{label:"官方/离线模式 (无)",value:"none"},{label:"MSL 统一身份验证 (MSL Skin)",value:"https://skin.mslmc.net/api/yggdrasil"},{label:"LittleSkin",value:"https://littleskin.cn/api/yggdrasil"},{label:"自定义服务器",value:"custom"}];we([P,G],([le,F])=>{le==="none"?_.value.yggdrasilApiAddr="":le==="custom"?_.value.yggdrasilApiAddr=F:_.value.yggdrasilApiAddr=le});const E=x(!1),w=x(!1),A=x(null),L=x(!1),H=x(0),J=x(""),X=le=>{_.value.core=le.filename,_.value.coreUrl=le.url,_.value.coreSha256=le.sha256,_.value.coreFileKey="",E.value=!1,B.success(`已选择核心: ${le.filename}，保存后将自动下载`)},q=()=>A.value?.click(),_e=async le=>{const F=le.target;if(!F.files?.length)return;const j=F.files[0];if(_.value.coreFileKey)try{await Ct(_.value.coreFileKey)}catch{console.error("删除上传失败")}J.value=j.name,L.value=!0,H.value=0;try{const pe=(await ea()).uploadId,te=5*1024*1024,D=Math.ceil(j.size/te);for(let me=0;me<D;me++){const be=j.slice(me*te,Math.min(j.size,(me+1)*te));await ta(pe,me,be),H.value=Math.floor((me+1)/D*100)}const ne=await aa(pe,D);_.value.coreFileKey=ne.uploadId,_.value.core=j.name,_.value.coreUrl="",B.success("文件上传就绪，保存后生效"),E.value=!1}catch(ae){B.error(`上传失败: ${ae.message}`)}finally{L.value=!1,F.value=""}},De=()=>{r.value||zs.warning({title:"风险操作",content:"修改实例路径会导致面板无法找到原有文件。请确保您已手动移动了文件，或您明确知道自己在做什么。",duration:5e3}),r.value=!r.value},fe=x(!1),Pe=x(0),Le=x([]),Ve=x(null),Be=ee(()=>g.value==="none"?{name:[{required:!0,message:"服务器名称不能为空",trigger:"blur"}],base:[{required:!0,message:"基础路径不能为空",trigger:"blur"}],args:[{required:!0,message:"自定义模式必须填写启动命令",trigger:"blur"}]}:{name:[{required:!0,message:"服务器名称不能为空",trigger:"blur"}],base:[{required:!0,message:"基础路径不能为空",trigger:"blur"}],java:[{required:!0,message:"Java 环境不能为空",trigger:"change"}],core:[{required:!0,message:"核心文件名不能为空",trigger:"change"}],minM:[{required:!0,message:"必填",trigger:"blur"}],maxM:[{required:!0,message:"必填",trigger:"blur"}]}),Oe=async()=>{if(d.value){u.value=!0;try{await b(),_.value.id=d.value;const le=await nr(d.value);if(_.value={..._.value,...le,coreUrl:"",coreFileKey:"",coreSha256:""},y.value=le.minM>0&&le.minM%1024===0?"GB":"MB",M.value=le.maxM>0&&le.maxM%1024===0?"GB":"MB",r.value=!1,le.java==="none")g.value="none";else if(le.java==="java")g.value="env";else if(le.java.startsWith("MSLX://Java/"))g.value="online",p.value=le.java.replace("MSLX://Java/","");else{const ae=U.value.find(pe=>pe.value===le.java);g.value=ae?"local":"custom",S.value=le.java}const F=le.backupPath;F==="MSLX://Backup/Instance"||F==="MSLX://Backup/Data"?R.value=F:(R.value="custom",T.value=F);const j=le.yggdrasilApiAddr;j?j==="https://skin.mslmc.net/api/yggdrasil"?P.value="https://skin.mslmc.net/api/yggdrasil":j==="https://littleskin.cn/api/yggdrasil"?P.value="https://littleskin.cn/api/yggdrasil":(P.value="custom",G.value=j):P.value="none"}catch(le){B.error("获取配置失败: "+le.message)}finally{u.value=!1}}};we(()=>l.params.serverId,le=>{l.name==="InstanceConsole"&&le&&Oe()}),Ce(Oe);const re=async()=>{if(await i.value?.validate()===!0&&!(g.value!=="none"&&(_.value.coreUrl||_.value.coreFileKey)&&!await new Promise(ae=>{const pe=at.confirm({header:"确认变更核心文件?",body:"检测到您上传或选择了新的核心文件，这将覆盖服务器现有的部署。",theme:"warning",onConfirm:()=>{pe.hide(),ae(!0)},onClose:()=>{pe.hide(),ae(!1)}})}))){g.value==="none"&&(_.value.core="none",_.value.minM=1027,_.value.maxM=1102,_.value.java="none",_.value.coreUrl="",_.value.coreFileKey="",_.value.coreSha256=""),f.value=!0;try{const F=await or(_.value);F.data?.needListen??F.needListen?ce():(B.success("配置已保存"),f.value=!1,Oe())}catch(F){B.error(F.message||"保存失败"),f.value=!1}}},ce=async()=>{fe.value=!0,Pe.value=0,Le.value=[];const{baseUrl:le,token:F}=n,j=new URL("/api/hubs/updateProgressHub",le||window.location.origin);j.searchParams.append("x-user-token",F),Ve.value=new Mt().withUrl(j.toString(),{withCredentials:!1}).configureLogging(Et.None).build(),Ve.value.on("UpdateStatus",(ae,pe,te)=>{Le.value.push({time:new Date().toLocaleTimeString(),msg:te?`[错误] ${ae}`:ae}),bt(()=>{const D=document.getElementById("update-log-box");D&&(D.scrollTop=D.scrollHeight)}),pe>=0&&(Pe.value=Number(pe.toFixed(1))),pe===100&&(B.success("更新完成"),Ke(!0))});try{await Ve.value.start(),await Ve.value.invoke("JoinGroup",d.value.toString())}catch{Le.value.push({time:"-",msg:"连接失败"})}},Ke=(le=!1)=>{Ve.value?.stop(),setTimeout(()=>{fe.value=!1,f.value=!1,le&&Oe()},1e3)};return Qe(()=>{Ve.value?.stop()}),(le,F)=>{const j=m("t-input"),ae=m("t-button"),pe=m("t-tooltip"),te=m("t-select"),D=m("t-textarea"),ne=m("t-alert"),me=m("t-icon"),be=m("t-col"),he=m("t-row"),$e=m("t-progress"),Ue=m("t-space"),Me=m("t-input-number"),Se=m("t-switch"),Ge=m("t-form"),Ye=m("t-loading"),Te=m("t-dialog");return o(),C("div",fg,[e(Ye,{loading:u.value,"show-overlay":""},{default:a(()=>[e(Ge,{ref_key:"formRef",ref:i,data:_.value,rules:Be.value,"label-width":"0",onSubmit:re},{default:a(()=>[F[61]||(F[61]=t("div",{class:"setting-group-title"},"基础设置",-1)),t("div",gg,[F[34]||(F[34]=t("div",{class:"setting-info"},[t("div",{class:"title"},"服务器名称"),t("div",{class:"desc"},"在面板列表中显示的别名，支持中文")],-1)),t("div",_g,[e(j,{modelValue:_.value.name,"onUpdate:modelValue":F[0]||(F[0]=Y=>_.value.name=Y),placeholder:"请输入名称"},null,8,["modelValue"])])]),t("div",hg,[t("div",yg,[F[35]||(F[35]=t("div",{class:"title"},"实例路径",-1)),t("div",bg,[t("span",{class:ke({"text-warning":r.value})},I(r.value?"警告：修改路径可能导致无法找到原文件":"服务器文件的物理存储路径，非必要请勿修改"),3)])]),t("div",wg,[e(j,{modelValue:_.value.base,"onUpdate:modelValue":F[1]||(F[1]=Y=>_.value.base=Y),disabled:!r.value},{suffix:a(()=>[e(pe,{content:r.value?"点击锁定":"点击解锁编辑 (慎重)"},{default:a(()=>[e(ae,{variant:"text",shape:"square",onClick:De},{icon:a(()=>[r.value?(o(),O(k(Ll),{key:0,style:{color:"var(--td-warning-color)"}})):(o(),O(k(Zt),{key:1}))]),_:1})]),_:1},8,["content"])]),_:1},8,["modelValue","disabled"])])]),F[62]||(F[62]=t("div",{class:"setting-group-title"},"运行模式",-1)),t("div",kg,[F[36]||(F[36]=t("div",{class:"setting-info"},[t("div",{class:"title"},"启动方式"),t("div",{class:"desc"},"选择使用 Java 启动 Minecraft，或使用自定义命令启动其他程序 (如 Bedrock, Python 等)")],-1)),t("div",$g,[e(te,{modelValue:g.value,"onUpdate:modelValue":F[2]||(F[2]=Y=>g.value=Y),options:[{label:"MSLX 在线下载 (Java)",value:"online"},{label:"使用本地版本 (Java)",value:"local"},{label:"自定义路径 (Java)",value:"custom"},{label:"环境变量 (Java)",value:"env"},{label:"自定义命令 (无Java)",value:"none"}]},null,8,["modelValue"]),g.value!=="none"?(o(),C("div",xg,[g.value==="online"?(o(),O(te,{key:0,modelValue:p.value,"onUpdate:modelValue":F[3]||(F[3]=Y=>p.value=Y),options:z.value,placeholder:"请选择版本",filterable:""},null,8,["modelValue","options"])):K("",!0),g.value==="local"?(o(),O(te,{key:1,modelValue:S.value,"onUpdate:modelValue":F[4]||(F[4]=Y=>S.value=Y),options:U.value,placeholder:"选择已识别的 Java"},null,8,["modelValue","options"])):K("",!0),g.value==="custom"?(o(),O(j,{key:2,modelValue:S.value,"onUpdate:modelValue":F[5]||(F[5]=Y=>S.value=Y),placeholder:"输入 java 可执行文件完整路径"},null,8,["modelValue"])):K("",!0)])):K("",!0)])]),t("div",Ag,[t("div",Cg,[t("div",Sg,I(g.value==="none"?"启动命令 (Command)":"启动参数 (JVM Args)"),1),t("div",Ig,I(g.value==="none"?"完全自定义的启动命令。程序将直接执行此段内容，不依赖 Java 环境。":"传递给 Java 的启动参数，如 GC 策略 (例如 -XX:+UseG1GC)"),1)]),t("div",Vg,[e(D,{modelValue:_.value.args,"onUpdate:modelValue":F[6]||(F[6]=Y=>_.value.args=Y),autosize:{minRows:2,maxRows:4},placeholder:g.value==="none"?"例如: ./bedrock_server_x64":"无特殊需求请留空"},null,8,["modelValue","placeholder"])])]),g.value!=="none"?(o(),C(de,{key:0},[F[40]||(F[40]=t("div",{class:"setting-group-title"},"核心管理",-1)),t("div",Mg,[F[39]||(F[39]=t("div",{class:"setting-info"},[t("div",{class:"title"},"服务端核心文件"),t("div",{class:"desc"},[v(" 指定启动的 Jar 文件名。如果文件已存在于目录中，直接输入文件名即可。 "),t("br"),v("需要更新核心？点击下方“文件工具” ")])],-1)),t("div",Lg,[e(j,{modelValue:_.value.core,"onUpdate:modelValue":F[8]||(F[8]=Y=>_.value.core=Y),placeholder:"例如 server.jar"},{suffix:a(()=>[e(ae,{variant:"text",theme:"primary",size:"small",onClick:F[7]||(F[7]=Y=>E.value=!E.value)},{default:a(()=>[v(I(E.value?"收起工具":"文件工具"),1)]),_:1})]),_:1},8,["modelValue"]),E.value?(o(),C("div",Ug,[e(Ue,{direction:"vertical",style:{width:"100%"}},{default:a(()=>[e(ne,{theme:"info",message:"在此处操作会自动下载/上传文件，并填入上方的文件名。"}),e(he,{gutter:12},{default:a(()=>[e(be,{span:6},{default:a(()=>[e(ae,{block:"",variant:"outline",onClick:F[9]||(F[9]=Y=>w.value=!0)},{icon:a(()=>[e(me,{name:"cloud-download"})]),default:a(()=>[F[37]||(F[37]=v(" 从版本库下载 ",-1))]),_:1})]),_:1}),e(be,{span:6},{default:a(()=>[e(ae,{block:"",variant:"outline",loading:L.value,onClick:q},{icon:a(()=>[e(me,{name:"upload"})]),default:a(()=>[F[38]||(F[38]=v(" 上传本地文件 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1}),t("input",{ref_key:"uploadInputRef",ref:A,type:"file",accept:".jar",hidden:"",onChange:_e},null,544),L.value?(o(),C("div",Bg,[t("span",null,"正在上传: "+I(J.value),1),e($e,{theme:"line",percentage:H.value},null,8,["percentage"])])):K("",!0)]),_:1})])):K("",!0)])])],64)):K("",!0),g.value!=="none"?(o(),C(de,{key:1},[F[43]||(F[43]=t("div",{class:"setting-group-title"},"资源限制",-1)),t("div",zg,[F[42]||(F[42]=t("div",{class:"setting-info"},[t("div",{class:"title"},"内存分配"),t("div",{class:"desc"},"设置 Java 堆内存大小 (Xms / Xmx)")],-1)),t("div",Pg,[t("div",Rg,[e(Me,{modelValue:V.value,"onUpdate:modelValue":F[10]||(F[10]=Y=>V.value=Y),min:0,"decimal-places":y.value==="GB"?1:0,placeholder:"Xms",theme:"normal",class:"input-left"},null,8,["modelValue","decimal-places"]),e(te,{modelValue:y.value,"onUpdate:modelValue":F[11]||(F[11]=Y=>y.value=Y),options:$,clearable:!1,class:"select-right"},null,8,["modelValue"])]),F[41]||(F[41]=t("span",{class:"separator"},"-",-1)),t("div",Eg,[e(Me,{modelValue:h.value,"onUpdate:modelValue":F[12]||(F[12]=Y=>h.value=Y),min:0,"decimal-places":M.value==="GB"?1:0,placeholder:"Xmx",theme:"normal",class:"input-left"},null,8,["modelValue","decimal-places"]),e(te,{modelValue:M.value,"onUpdate:modelValue":F[13]||(F[13]=Y=>M.value=Y),options:$,clearable:!1,class:"select-right"},null,8,["modelValue"])])])])],64)):K("",!0),F[63]||(F[63]=t("div",{class:"setting-group-title"},"备份设置",-1)),t("div",Tg,[F[46]||(F[46]=t("div",{class:"setting-info"},[t("div",{class:"title"},"备份策略"),t("div",{class:"desc"},"设置自动备份保留的最大数量，以及触发备份的延迟时间")],-1)),t("div",Fg,[e(Me,{modelValue:_.value.backupMaxCount,"onUpdate:modelValue":F[14]||(F[14]=Y=>_.value.backupMaxCount=Y),min:1,max:100,placeholder:"保留份数",theme:"column",style:{width:"140px"},suffix:"份"},null,8,["modelValue"]),F[44]||(F[44]=t("span",{class:"separator"},"/",-1)),e(Me,{modelValue:_.value.backupDelay,"onUpdate:modelValue":F[15]||(F[15]=Y=>_.value.backupDelay=Y),min:0,placeholder:"延迟时间",theme:"column",style:{width:"140px"},suffix:"秒"},null,8,["modelValue"])]),t("div",Dg,[e(pe,{content:"MSLX 向服务器发送 save-all 指令后，会等待指定的秒数，确保数据完全写入硬盘后再开始打包备份。"},{default:a(()=>[t("span",Og,[e(me,{name:"help-circle"}),F[45]||(F[45]=v(" 什么是延迟时间？ ",-1))])]),_:1})])]),t("div",jg,[F[47]||(F[47]=t("div",{class:"setting-info"},[t("div",{class:"title"},"备份存放路径"),t("div",{class:"desc"},"选择备份文件存储的位置。推荐存储在实例文件夹外部以免误删。")],-1)),t("div",Kg,[e(te,{modelValue:R.value,"onUpdate:modelValue":F[16]||(F[16]=Y=>R.value=Y),options:[{label:"实例文件夹内 (Instance)",value:"MSLX://Backup/Instance"},{label:"全局数据目录 (Data)",value:"MSLX://Backup/Data"},{label:"自定义绝对路径",value:"custom"}]},null,8,["modelValue"]),R.value==="custom"?(o(),C("div",Ng,[e(j,{modelValue:T.value,"onUpdate:modelValue":F[17]||(F[17]=Y=>T.value=Y),placeholder:"输入备份存放的绝对路径"},null,8,["modelValue"])])):K("",!0)])]),g.value!=="none"?(o(),C("div",qg,"外置登录")):K("",!0),g.value!=="none"?(o(),C("div",Gg,[F[48]||(F[48]=t("div",{class:"setting-info"},[t("div",{class:"title"},"Yggdrasil API"),t("div",{class:"desc"},"选择认证服务器。留空则表示使用官方正版登录 (或离线模式)。")],-1)),t("div",Hg,[e(te,{modelValue:P.value,"onUpdate:modelValue":F[18]||(F[18]=Y=>P.value=Y),options:N},null,8,["modelValue"]),P.value==="custom"?(o(),C("div",Jg,[e(j,{modelValue:G.value,"onUpdate:modelValue":F[19]||(F[19]=Y=>G.value=Y),placeholder:"输入 Authlib-Injector API 地址"},null,8,["modelValue"])])):K("",!0)])])):K("",!0),F[64]||(F[64]=t("div",{class:"setting-group-title"},"高级设置",-1)),t("div",Wg,[F[49]||(F[49]=t("div",{class:"setting-info"},[t("div",{class:"title"},"停止服务器指令"),t("div",{class:"desc"},"设置正常停止时所发送的指令，默认为stop"),t("div",{class:"desc"},"设置为^c为发送Ctrl C (在部分环境可能无法发送成功)")],-1)),t("div",Xg,[e(j,{modelValue:_.value.stopCommand,"onUpdate:modelValue":F[20]||(F[20]=Y=>_.value.stopCommand=Y),placeholder:"请输入停止指令"},null,8,["modelValue"])])]),t("div",Qg,[F[50]||(F[50]=t("div",{class:"setting-info"},[t("div",{class:"title"},"日志原彩显示"),t("div",{class:"desc"},"开启此选项后，将注入相关环境变量，以让MC终端日志输出原有的色彩样式"),t("div",{class:"desc"},"此功能可以和日志染色功能搭配使用")],-1)),t("div",Yg,[e(Se,{modelValue:_.value.allowOriginASCIIColors,"onUpdate:modelValue":F[21]||(F[21]=Y=>_.value.allowOriginASCIIColors=Y),label:["已开启","已关闭"]},null,8,["modelValue"])])]),t("div",Zg,[F[51]||(F[51]=t("div",{class:"setting-info"},[t("div",{class:"title"},"自动重启"),t("div",{class:"desc"},"当服务器崩溃或意外停止时尝试自动重启"),t("div",{class:"desc"},"熔断机制: 若5分钟内尝试重启次数达到 5 次，则停止尝试重启")],-1)),t("div",e_,[e(Se,{modelValue:_.value.autoRestart,"onUpdate:modelValue":F[22]||(F[22]=Y=>_.value.autoRestart=Y),label:["已开启","已关闭"]},null,8,["modelValue"])])]),_.value.autoRestart?(o(),C("div",t_,[F[52]||(F[52]=t("div",{class:"setting-info"},[t("div",{class:"title"},"强制自动重启"),t("div",{class:"desc"},"开启此功能后，就算服务器是正常退出的也会强制重启(正常退出 => 退出代码 0)"),t("div",{class:"desc"},"不影响手动在面板关闭服务器")],-1)),t("div",a_,[e(Se,{modelValue:_.value.forceAutoRestart,"onUpdate:modelValue":F[23]||(F[23]=Y=>_.value.forceAutoRestart=Y),label:["已开启","已关闭"]},null,8,["modelValue"])])])):K("",!0),t("div",s_,[F[53]||(F[53]=t("div",{class:"setting-info"},[t("div",{class:"title"},"关服强制结束时间"),t("div",{class:"desc"},"设置在发出Stop指令或关服请求后，等待多久后强制结束进程"),t("div",{class:"desc"},"可设置10 - 120 s")],-1)),t("div",l_,[e(Me,{modelValue:_.value.forceExitDelay,"onUpdate:modelValue":F[24]||(F[24]=Y=>_.value.forceExitDelay=Y)},null,8,["modelValue"])])]),t("div",n_,[F[54]||(F[54]=t("div",{class:"setting-info"},[t("div",{class:"title"},"忽略EULA提示"),t("div",{class:"desc"},"若您的实例并非MC服务器，可打开此选项")],-1)),t("div",o_,[e(Se,{modelValue:_.value.ignoreEula,"onUpdate:modelValue":F[25]||(F[25]=Y=>_.value.ignoreEula=Y),label:["已开启","已关闭"]},null,8,["modelValue"])])]),t("div",i_,[F[55]||(F[55]=t("div",{class:"setting-info"},[t("div",{class:"title"},"随守护进程启动"),t("div",{class:"desc"},"当物理机开机/面板启动时，自动启动此实例")],-1)),t("div",r_,[e(Se,{modelValue:_.value.runOnStartup,"onUpdate:modelValue":F[26]||(F[26]=Y=>_.value.runOnStartup=Y),label:["已开启","已关闭"]},null,8,["modelValue"])])]),g.value!=="none"?(o(),C("div",u_,[F[56]||(F[56]=t("div",{class:"setting-info"},[t("div",{class:"title"},"强制Java使用UTF8"),t("div",{class:"desc"},"此功能可以解决部分游戏内中文乱码的问题（特别是Windows系统上）"),t("div",{class:"desc"},[v("开启此功能后请务必将下面的"),t("b",null,"文件编码"),v("设置设置为"),t("b",null,"UTF-8")])],-1)),t("div",d_,[e(Se,{modelValue:_.value.forceJvmUTF8,"onUpdate:modelValue":F[27]||(F[27]=Y=>_.value.forceJvmUTF8=Y),label:["已开启","已关闭"]},null,8,["modelValue"])])])):K("",!0),t("div",c_,[F[57]||(F[57]=t("div",{class:"setting-info"},[t("div",{class:"title"},"控制台编码"),t("div",{class:"desc"},"设置输入输出流的字符集，乱码时请尝试切换")],-1)),t("div",m_,[e(te,{modelValue:_.value.inputEncoding,"onUpdate:modelValue":F[28]||(F[28]=Y=>_.value.inputEncoding=Y),options:c,label:"输入",style:{width:"140px"}},null,8,["modelValue"]),e(te,{modelValue:_.value.outputEncoding,"onUpdate:modelValue":F[29]||(F[29]=Y=>_.value.outputEncoding=Y),options:c,label:"输出",style:{width:"140px"}},null,8,["modelValue"])])]),t("div",p_,[F[58]||(F[58]=t("div",{class:"setting-info"},[t("div",{class:"title"},"文件编码"),t("div",{class:"desc"},"设置文件编辑和保存时的编码格式，乱码时请尝试切换。(一般Windows是GBK，其他是UTF-8。)")],-1)),t("div",v_,[e(te,{modelValue:_.value.fileEncoding,"onUpdate:modelValue":F[30]||(F[30]=Y=>_.value.fileEncoding=Y),options:c,style:{width:"140px"}},null,8,["modelValue"])])]),t("div",f_,[e(ae,{theme:"primary",type:"submit",size:"large",loading:f.value},{default:a(()=>[...F[59]||(F[59]=[v("保存设置",-1)])]),_:1},8,["loading"]),e(ae,{theme:"default",variant:"base",size:"large",onClick:Oe},{default:a(()=>[...F[60]||(F[60]=[v("重置更改",-1)])]),_:1})])]),_:1},8,["data","rules"])]),_:1},8,["loading"]),e(Qa,{visible:w.value,"onUpdate:visible":F[31]||(F[31]=Y=>w.value=Y),onConfirm:X},null,8,["visible"]),e(Te,{visible:fe.value,"onUpdate:visible":F[33]||(F[33]=Y=>fe.value=Y),header:"正在应用更新",footer:!1,"close-on-overlay-click":!1,"close-btn":!1,width:"600px"},{default:a(()=>[t("div",g_,[e($e,{theme:"plump",percentage:Pe.value,label:`${Pe.value}%`},null,8,["percentage","label"]),t("div",__,[(o(!0),C(de,null,ye(Le.value,(Y,xe)=>(o(),C("div",{key:xe,class:"log-line"},[t("span",h_,I(Y.time),1),v(" "+I(Y.msg),1)]))),128))]),Pe.value===100?(o(),C("div",y_,[e(ae,{theme:"primary",onClick:F[32]||(F[32]=Y=>fe.value=!1)},{default:a(()=>[...F[65]||(F[65]=[v("关闭并刷新",-1)])]),_:1})])):K("",!0)])]),_:1},8,["visible"])])}}}),w_=ie(b_,[["__scopeId","data-v-1383a479"]]),k_={class:"uploader-container"},$_={key:0,class:"drop-text"},x_={key:1,class:"drop-text"},A_={class:"drop-actions"},C_={key:0,class:"queue-actions"},S_={class:"queue-info"},I_={key:0},V_={class:"btn-group"},M_={key:1,class:"file-list"},L_={class:"file-icon-wrapper"},U_={class:"file-content"},B_={class:"file-header"},z_=["title"],P_={class:"meta"},R_={key:0,class:"error"},E_={key:1},T_={class:"size"},F_=["title"],D_={class:"progress-wrapper"},O_={class:"file-action"},j_=se({__name:"FileUploader",props:{visible:{type:Boolean},instanceId:{},currentPath:{},allowFolder:{type:Boolean,default:!0}},emits:["update:visible","success"],setup(s,{emit:l}){const n=s,d=l,i=x([]),u=x(!1),f=x(!1),r=x(!1),c=x(),_=x(),y=w=>{const A=w.split(".").pop()?.toLowerCase();return["png","jpg","jpeg","gif","ico","webp"].includes(A||"")?{icon:Rs,color:"var(--td-success-color)"}:["jar","zip","rar","7z","tar","gz"].includes(A||"")?{icon:Ia,color:"#722ed1"}:["js","ts","py","java","c","cpp","cs","json","yml","yaml","xml","html","css","properties","conf","sh","bat"].includes(A||"")?{icon:Pt,color:"var(--td-warning-color)"}:["log","txt","md","lock"].includes(A||"")?{icon:Va,color:"var(--td-gray-color-6)"}:["db","db-wal","dat"].includes(A||"")?{icon:Bl,color:"var(--td-gray-color-8)"}:{icon:Gt,color:"var(--td-brand-color)"}},M=w=>w.split("/").pop()||w,$=w=>{const A=w.lastIndexOf("/");return A!==-1?w.substring(0,A):""},V=ee(()=>{if(i.value.length===0)return 0;const w=i.value.reduce((A,L)=>A+L.progress,0);return Math.floor(w/i.value.length)}),h=ee(()=>i.value.some(w=>w.status==="pending"||w.status==="error")),g=()=>c.value?.click(),z=()=>_.value?.click(),U=w=>{const A=w.target;if(A.files&&A.files.length>0){const H=Array.from(A.files).map(J=>({file:J,path:J.webkitRelativePath||J.name}));R(H)}A.value=""},p=async w=>{r.value=!1;const A=w.dataTransfer?.items;if(!A)return;const L=[],H=Array.from(A).map(J=>J.webkitGetAsEntry()).filter(J=>J!==null);for(const J of H)J&&await S(J,L);R(L)},S=async(w,A)=>{if(w.isFile){const L=await new Promise((J,X)=>w.file(J,X)),H=w.fullPath.startsWith("/")?w.fullPath.slice(1):w.fullPath;A.push({file:L,path:H})}else if(w.isDirectory)if(n.allowFolder){const L=w.createReader(),H=await b(L);for(const J of H)await S(J,A)}else B.error("此处不支持上传文件夹")},b=async w=>{let A=[];const L=async()=>{const H=await new Promise((J,X)=>w.readEntries(J,X));H.length>0&&(A=A.concat(H),await L())};return await L(),A},R=w=>{w.forEach(({file:A,path:L})=>{i.value.some(H=>H.path===L&&H.file.size===A.size&&H.status!=="error")||i.value.push({id:Math.random().toString(36).substring(2),file:A,path:L,status:"pending",progress:0,speed:""})})},T=async()=>{if(u.value)return;u.value=!0,f.value=!1;const w=3,A=i.value.filter(L=>L.status==="pending"||L.status==="error");for(let L=0;L<A.length&&!(f.value&&i.value.length===0);L+=w){const J=A.slice(L,L+w).filter(X=>i.value.some(q=>q.id===X.id));J.length>0&&await Promise.all(J.map(X=>P(X)))}u.value=!1,!f.value&&i.value.length>0&&i.value.every(L=>L.status==="success")&&(B.success("上传完成"),d("success"))},P=async w=>{w.status="uploading",w.progress=0,w.abortController=new AbortController;const A=Date.now();let L=0;try{const J=(await ea()).uploadId,q=w.file.size>200*1024*1024?50*1024*1024:10*1024*1024,_e=Math.ceil(w.file.size/q),De=4,fe=5,Pe=Array.from({length:_e},(ce,Ke)=>Ke),Le=new Map,Ve=()=>{const ce=Date.now();if(ce-L<100)return;L=ce;const Ke=Array.from(Le.values()).reduce((j,ae)=>j+ae,0),le=Math.min(Ke/w.file.size*95,95);w.progress=Number(le.toFixed(1));const F=(ce-A)/1e3;if(F>0){const j=Ke/1024/1024/F;w.speed=j.toFixed(1)+" MB/s"}},Be=async ce=>{if(w.abortController?.signal.aborted)throw new Error("已取消");const Ke=ce*q,le=Math.min(w.file.size,Ke+q),F=w.file.slice(Ke,le);let j;for(let ae=1;ae<=fe;ae++){if(w.abortController?.signal.aborted)throw new Error("已取消");try{await ta(J,ce,F,pe=>{pe&&pe.loaded&&(Le.set(ce,pe.loaded),Ve())},w.abortController?.signal),Le.set(ce,F.size),Ve();return}catch(pe){j=pe,ae<fe&&(Le.set(ce,0),Ve(),await new Promise(te=>setTimeout(te,1e3*ae)))}}throw j||new Error(`分片 ${ce} 失败`)},Oe=async()=>{for(;Pe.length>0&&!w.abortController?.signal.aborted;){const ce=Pe.shift();if(ce===void 0)break;await Be(ce)}},re=Array(Math.min(De,_e)).fill(null).map(()=>Oe());if(await Promise.all(re),w.abortController.signal.aborted)throw new Error("已取消");w.status="merging",w.speed="合并中...",w.progress=98,await aa(J,_e),await No(n.instanceId,J,w.path,n.currentPath),w.status="success",w.progress=100,w.speed="完成"}catch(H){H.message==="已取消"||w.abortController?.signal.aborted?(w.status="pending",w.speed="已取消",w.progress=0):(w.status="error",w.errorMsg=H.message||"失败")}},G=w=>{i.value[w].abortController?.abort(),i.value.splice(w,1)},N=()=>{i.value=i.value.filter(w=>w.status!=="success")},E=()=>d("update:visible",!1);return Qe(()=>i.value.forEach(w=>w.abortController?.abort())),(w,A)=>{const L=m("t-button"),H=m("t-progress"),J=m("t-dialog");return o(),O(J,{visible:s.visible,header:"批量上传文件",width:"650px",footer:!1,onClose:E},{default:a(()=>[t("input",{ref_key:"fileInputRef",ref:c,type:"file",multiple:"",style:{display:"none"},onChange:U},null,544),t("input",{ref_key:"folderInputRef",ref:_,type:"file",webkitdirectory:"",style:{display:"none"},onChange:U},null,544),t("div",k_,[t("div",{class:ke(["drop-zone",{active:r.value}]),onDragover:A[0]||(A[0]=Nt(X=>r.value=!0,["prevent"])),onDragleave:A[1]||(A[1]=Nt(X=>r.value=!1,["prevent"])),onDrop:Nt(p,["prevent"])},[e(k(Ps),{size:"40px",style:{color:"var(--td-brand-color)"}}),n.allowFolder?(o(),C("p",$_,"拖入文件或文件夹")):K("",!0),n.allowFolder?K("",!0):(o(),C("p",x_,"拖入文件")),t("div",A_,[e(L,{variant:"outline",size:"small",onClick:g},{icon:a(()=>[e(k(Gt))]),default:a(()=>[A[2]||(A[2]=v(" 选择文件",-1))]),_:1}),n.allowFolder?(o(),O(L,{key:0,variant:"outline",size:"small",onClick:z},{icon:a(()=>[e(k(Rt))]),default:a(()=>[A[3]||(A[3]=v(" 选择文件夹",-1))]),_:1})):K("",!0)])],34),i.value.length>0?(o(),C("div",C_,[t("span",S_,[v(" 队列: "+I(i.value.length)+" 个 | ",1),u.value?(o(),C("span",I_,"总进度 "+I(V.value)+"%",1)):K("",!0)]),t("div",V_,[e(L,{theme:"primary",size:"small",disabled:!h.value||u.value,onClick:T},{icon:a(()=>[e(k(Ft))]),default:a(()=>[v(" "+I(u.value?"上传中...":"开始上传"),1)]),_:1},8,["disabled"]),e(L,{variant:"text",size:"small",onClick:N},{icon:a(()=>[e(k(Ul))]),default:a(()=>[A[4]||(A[4]=v(" 清空已完成",-1))]),_:1})])])):K("",!0),i.value.length>0?(o(),C("div",M_,[(o(!0),C(de,null,ye(i.value,(X,q)=>(o(),C("div",{key:X.id,class:"file-item"},[t("div",L_,[(o(),O(ot(y(M(X.path)).icon),{style:rt({color:y(M(X.path)).color})},null,8,["style"]))]),t("div",U_,[t("div",B_,[t("div",{class:"name",title:M(X.path)},I(M(X.path)),9,z_),t("div",P_,[X.status==="error"?(o(),C("span",R_,I(X.errorMsg),1)):(o(),C("span",E_,I(X.speed),1)),t("span",T_,I((X.file.size/1024/1024).toFixed(2))+" MB",1)])]),$(X.path)?(o(),C("div",{key:0,class:"file-path",title:$(X.path)},[e(k(Rt),{size:"10px"}),v(" "+I($(X.path))+"/ ",1)],8,F_)):K("",!0),t("div",D_,[e(H,{percentage:X.progress,status:X.status==="error"?"error":X.status==="success"?"success":"active",size:"small",label:!1},null,8,["percentage","status"])])]),t("div",O_,[X.status!=="success"?(o(),O(L,{key:0,shape:"circle",variant:"text",size:"small",onClick:_e=>G(q)},{default:a(()=>[e(k(_a))]),_:1},8,["onClick"])):(o(),O(k(ga),{key:1,style:{color:"var(--td-success-color)","font-size":"18px"}}))])]))),128))])):K("",!0)])]),_:1},8,["visible"])}}}),tl=ie(j_,[["__scopeId","data-v-890b3931"]]),K_={class:"pm-container"},N_={class:"header-section"},q_={class:"mode-switcher"},G_={key:0,class:"error-alert-bar"},H_={class:"toolbar"},J_={class:"left-actions"},W_={key:0,class:"bulk-actions"},X_={class:"selected-count"},Q_={class:"right-search"},Y_={class:"table-wrapper"},Z_={style:{display:"flex","align-items":"center",gap:"8px"}},eh={class:"empty-state"},th={class:"tips-footer"},ah=se({__name:"ModsPluginsManager",setup(s){const l=Ze(),n=parseInt(l.params.serverId),d=x("mods"),i=x(!1),u=x([]),f=x(""),r=x([]),c=x(""),_=ee(()=>{if(!f.value)return u.value;const S=f.value.toLowerCase();return u.value.filter(b=>b.name.toLowerCase().includes(S))}),y=ee(()=>[{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{title:"文件名",colKey:"name",sorter:(S,b)=>S.name.localeCompare(b.name),ellipsis:!0},{title:"状态",colKey:"status",width:100},{title:"操作",colKey:"op",width:180,fixed:"right",align:"right"}]),M=async(S=!1)=>{i.value=!0,r.value=[],c.value="";try{const b=await Ra(n,d.value,S),R=(b.clientJarFiles||[]).map(G=>({name:G,status:"enabled",isClient:!0})),T=(b.jarFiles||[]).map(G=>({name:G,status:"enabled"})),P=(b.disableJarFiles||[]).map(G=>({name:G,status:"disabled"}));u.value=[...R,...T,...P],S&&R.length>0?(r.value=R.map(G=>G.name),B.success(`检测到 ${R.length} 个客户端模组`)):S&&B.info("未检测到仅客户端模组")}catch(b){const R=b.message||"获取列表失败";c.value=R,u.value=[]}finally{i.value=!1}},$=async(S,b)=>{if(b.length===0)return;const R={enable:"启用",disable:"禁用",delete:"删除"},T=async()=>{try{i.value=!0;const P=await Qo(n,d.value,S,b),{successCount:G,failCount:N}=P||{};N>0?B.warning(`操作完成：成功 ${G} 个，失败 ${N} 个`):B.success(`成功${R[S]} ${G} 个文件`),await M()}catch(P){B.error(P.message||"操作失败"),i.value=!1}};if(S==="delete"){const P=at.confirm({header:`确认删除 ${b.length} 个文件?`,body:"此操作不可逆，文件将被永久删除。",theme:"danger",onConfirm:()=>{P.hide(),T()}})}else await T()},V=S=>{d.value=S,M()},h=S=>{const b=S.status==="enabled"?"disable":"enable";$(b,[S.name])},g=S=>{const b=r.value;$(S,b)},z=x(!1),U=()=>{z.value=!0},p=()=>{z.value=!1,M()};return Ce(()=>{M()}),we(()=>l.params.serverId,S=>{S&&location.reload()}),(S,b)=>{const R=m("t-radio-button"),T=m("t-radio-group"),P=m("t-alert"),G=m("t-button"),N=m("t-input"),E=m("t-tag"),w=m("t-switch"),A=m("t-popconfirm"),L=m("t-space"),H=m("t-table");return o(),C("div",K_,[t("div",N_,[b[13]||(b[13]=t("div",{class:"setting-group-title"}," 资源管理 ",-1)),t("div",q_,[e(T,{modelValue:d.value,"onUpdate:modelValue":b[0]||(b[0]=J=>d.value=J),variant:"default-filled",onChange:V},{default:a(()=>[e(R,{value:"mods"},{icon:a(()=>[e(k(Ma))]),default:a(()=>[b[11]||(b[11]=v(" 模组 (Mods) ",-1))]),_:1}),e(R,{value:"plugins"},{icon:a(()=>[e(k(Ht))]),default:a(()=>[b[12]||(b[12]=v(" 插件 (Plugins) ",-1))]),_:1})]),_:1},8,["modelValue"])])]),c.value?(o(),C("div",G_,[e(P,{theme:"error",message:c.value,closeable:"",onClose:b[2]||(b[2]=J=>c.value="")},{operation:a(()=>[t("span",{style:{cursor:"pointer","margin-left":"8px"},onClick:b[1]||(b[1]=J=>M(!1))},"重试")]),_:1},8,["message"])])):K("",!0),t("div",H_,[t("div",J_,[e(G,{theme:"primary",disabled:c.value!=="",onClick:U},{icon:a(()=>[e(k(La))]),default:a(()=>[b[14]||(b[14]=v(" 上传文件 ",-1))]),_:1},8,["disabled"]),d.value==="mods"?(o(),O(G,{key:0,disabled:c.value!=="",variant:"outline",loading:i.value,onClick:b[3]||(b[3]=J=>M(!0))},{icon:a(()=>[e(k(ua))]),default:a(()=>[b[15]||(b[15]=v(" 检测客户端模组 ",-1))]),_:1},8,["disabled","loading"])):K("",!0),e(G,{variant:"outline",loading:i.value,onClick:b[4]||(b[4]=J=>M(!1))},{icon:a(()=>[e(k(st))]),_:1},8,["loading"]),e(Qt,{name:"fade"},{default:a(()=>[r.value.length>0?(o(),C("div",W_,[b[19]||(b[19]=t("div",{class:"divider"},null,-1)),t("span",X_,"已选 "+I(r.value.length)+" 项",1),e(G,{size:"small",variant:"text",theme:"success",onClick:b[5]||(b[5]=J=>g("enable"))},{default:a(()=>[...b[16]||(b[16]=[v("启用",-1)])]),_:1}),e(G,{size:"small",variant:"text",theme:"warning",onClick:b[6]||(b[6]=J=>g("disable"))},{default:a(()=>[...b[17]||(b[17]=[v("禁用",-1)])]),_:1}),e(G,{size:"small",variant:"text",theme:"danger",onClick:b[7]||(b[7]=J=>g("delete"))},{default:a(()=>[...b[18]||(b[18]=[v("删除",-1)])]),_:1})])):K("",!0)]),_:1})]),t("div",Q_,[e(N,{modelValue:f.value,"onUpdate:modelValue":b[8]||(b[8]=J=>f.value=J),placeholder:"搜索文件名...",clearable:""},{"prefix-icon":a(()=>[e(k(ua))]),_:1},8,["modelValue"])])]),t("div",Y_,[e(H,{"selected-row-keys":r.value,"onUpdate:selectedRowKeys":b[9]||(b[9]=J=>r.value=J),pagination:{defaultPageSize:20,total:_.value.length,showJumper:!0,defaultCurrent:1},data:_.value,columns:y.value,"row-key":"name",loading:i.value,hover:"",stripe:"",class:"custom-table"},{name:a(({row:J})=>[t("div",Z_,[t("span",null,I(J.name),1),J.isClient?(o(),O(E,{key:0,theme:"warning",variant:"light",size:"small"},{default:a(()=>[...b[20]||(b[20]=[v(" 客户端 ",-1)])]),_:1})):K("",!0)])]),status:a(({row:J})=>[J.status==="enabled"?(o(),O(E,{key:0,theme:"success",variant:"light"},{icon:a(()=>[e(k(St))]),default:a(()=>[b[21]||(b[21]=v(" 已启用 ",-1))]),_:1})):(o(),O(E,{key:1,theme:"default",variant:"light",style:{color:"var(--td-text-color-placeholder)"}},{icon:a(()=>[e(k(_a))]),default:a(()=>[b[22]||(b[22]=v(" 已禁用 ",-1))]),_:1}))]),op:a(({row:J})=>[e(L,{size:"small"},{default:a(()=>[e(w,{"model-value":J.status==="enabled",loading:i.value,size:"medium",onChange:X=>h(J)},{label:a(X=>[v(I(X.value?"开":"关"),1)]),_:1},8,["model-value","loading","onChange"]),e(A,{content:"确定要删除此文件吗？",theme:"danger",onConfirm:X=>$("delete",[J.name])},{default:a(()=>[e(G,{variant:"text",theme:"danger",shape:"square"},{default:a(()=>[e(k($t))]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)]),empty:a(()=>[t("div",eh,[d.value==="mods"?(o(),O(k(Ma),{key:0,size:"48px",style:{color:"var(--td-gray-color-4)"}})):(o(),O(k(Ht),{key:1,size:"48px",style:{color:"var(--td-gray-color-4)"}})),t("p",null,I(`暂无${d.value==="mods"?"模组":"插件"}文件`),1)])]),_:1},8,["selected-row-keys","pagination","data","columns","loading"])]),t("div",th,[t("p",null,"提示："+I(d.value==="mods"?"模组":"插件")+"文件存放于服务器根目录的 /"+I(d.value)+" 文件夹下。",1),b[23]||(b[23]=t("p",null,"禁用文件后，会在文件名后添加 .disabled 后缀，服务器将忽略该文件。",-1))]),e(tl,{visible:z.value,"onUpdate:visible":b[10]||(b[10]=J=>z.value=J),"instance-id":k(n),"current-path":d.value,"allow-folder":!1,onSuccess:p},null,8,["visible","instance-id","current-path"])])}}}),sh=ie(ah,[["__scopeId","data-v-c8641ed4"]]),bs=[{key:"motd",label:"服务器标语",desc:"显示在多人游戏列表中的服务器介绍信息，支持颜色代码，不支持中文。",type:"string"},{key:"server-port",label:"服务器端口",desc:"默认为 25565。如果要在一台机器运行多个服务器，必须修改此端口。",type:"number"},{key:"max-players",label:"最大玩家数",desc:"服务器同时允许在线的最大玩家数量。",type:"number"},{key:"online-mode",label:"正版验证",desc:"开启后将验证玩家的正版账号。如果使用离线/皮肤站，请关闭此项。",type:"boolean"},{key:"white-list",label:"启用白名单",desc:"开启后只有在白名单内的玩家才能进入服务器。",type:"boolean"},{key:"enforce-whitelist",label:"强制白名单",desc:"开启后，当玩家不在白名单时，即使已在线也会被踢出（通常用于维护时重新加载白名单）。",type:"boolean"},{key:"level-name",label:"存档文件夹名称",desc:"服务器读取的世界存档文件夹名称（默认为 world）。",type:"string"},{key:"gamemode",label:"默认游戏模式",desc:"新玩家进入服务器时的默认模式。",type:"select",options:[{label:"生存 (Survival)",value:"survival"},{label:"创造 (Creative)",value:"creative"},{label:"冒险 (Adventure)",value:"adventure"},{label:"旁观 (Spectator)",value:"spectator"}]},{key:"force-gamemode",label:"强制游戏模式",desc:"开启后，玩家每次加入服务器都会被重置为默认游戏模式。",type:"boolean"},{key:"difficulty",label:"难度",desc:"世界的游戏难度设置。",type:"select",options:[{label:"和平 (Peaceful)",value:"peaceful"},{label:"简单 (Easy)",value:"easy"},{label:"普通 (Normal)",value:"normal"},{label:"困难 (Hard)",value:"hard"}]},{key:"hardcore",label:"极限模式",desc:"开启后，玩家死亡将被封禁。",type:"boolean"},{key:"allow-flight",label:"允许飞行",desc:"允许生存模式下的玩家飞行（防止被服务端反作弊踢出）。",type:"boolean"},{key:"spawn-protection",label:"出生点保护半径",desc:"出生点周围多少格内禁止非 OP 破坏。设为 0 可禁用。",type:"number"},{key:"player-idle-timeout",label:"挂机踢出时间",desc:"玩家闲置多少分钟后被自动踢出。0 为不限制。",type:"number"},{key:"level-seed",label:"世界种子",desc:"生成世界使用的种子，留空则随机生成。",type:"string"},{key:"level-type",label:"世界类型",desc:"例如 minecraft:normal, minecraft:flat, minecraft:amplified。",type:"string"},{key:"generate-structures",label:"生成结构",desc:"是否生成村庄、地牢等结构。",type:"boolean"},{key:"generator-settings",label:"生成器设置",desc:"用于自定义超平坦或特定生成器的 JSON 参数。",type:"string"},{key:"max-world-size",label:"世界边界半径",desc:"设置世界边界（World Border）的最大半径。",type:"number"},{key:"simulation-distance",label:"模拟距离",desc:"服务器实际运算实体/作物生长的区块半径（3-32）。",type:"number"},{key:"view-distance",label:"视距",desc:"客户端可以看见的区块半径。数值过大显著增加内存和带宽消耗。",type:"number"},{key:"entity-broadcast-range-percentage",label:"实体广播范围百分比",desc:"控制客户端能看到实体的距离系数（100表示默认）。",type:"number"},{key:"max-tick-time",label:"最大刻耗时 (Watchdog)",desc:"一刻的最长处理毫秒数。超过此数值服务器将强制关闭以防卡死。设为 -1 可禁用。",type:"number"},{key:"network-compression-threshold",label:"网络压缩阈值",desc:"数据包超过此字节数时进行压缩。设为 -1 禁用压缩。推荐保持默认 256。",type:"number"},{key:"rate-limit",label:"数据包限制",desc:"如果玩家发送数据包过快，将被踢出。0 为禁用。",type:"number"},{key:"use-native-transport",label:"使用原生传输优化",desc:"Linux 环境下是否启用 Epoll 优化网络性能。",type:"boolean"},{key:"prevent-proxy-connections",label:"防止代理连接",desc:"是否尝试阻止通过 VPN 或代理的连接（ISP/AS 号判断）。",type:"boolean"},{key:"sync-chunk-writes",label:"同步区块写入",desc:"开启后区块写入完成后才继续逻辑，数据更安全但可能掉帧；关闭可能提升性能。",type:"boolean"},{key:"region-file-compression",label:"区块文件压缩格式",desc:"用于保存区块的压缩算法。",type:"select",options:[{label:"Deflate (默认)",value:"deflate"},{label:"LZ4 (更快)",value:"lz4"},{label:"不压缩 (None)",value:"none"}]},{key:"max-chained-neighbor-updates",label:"最大连锁更新数",desc:"限制红石/方块连锁更新的数量以防止崩服。",type:"number"},{key:"log-ips",label:"控制台记录 IP",desc:"是否在控制台日志中显示玩家连接的 IP 地址。",type:"boolean"},{key:"hide-online-players",label:"隐藏在线玩家列表",desc:"开启后，服务器列表中将不显示具体的玩家名单。",type:"boolean"},{key:"enable-status",label:"启用状态查询",desc:"是否允许外部（如服务器列表网站）查询服务器状态。",type:"boolean"},{key:"accepts-transfers",label:"接受服务器传送",desc:"是否允许玩家从其他服务器无缝传送到此服务器。",type:"boolean"},{key:"pause-when-empty-seconds",label:"空载暂停时间",desc:"服务器内无玩家多少秒后暂停游戏循环（省资源）。-1 为不暂停。",type:"number"},{key:"op-permission-level",label:"OP 权限等级",desc:"设置 OP 的默认权限级别。",type:"select",options:[{label:"1 - 无视出生点保护",value:1},{label:"2 - 使用单机指令 (gamemode等)",value:2},{label:"3 - 多人管理 (kick/ban/op)",value:3},{label:"4 - 系统管理 (stop/save)",value:4}]},{key:"function-permission-level",label:"函数权限等级",desc:"数据包(Datapack)中函数的默认执行权限等级。",type:"number"},{key:"enforce-secure-profile",label:"强制安全配置 (签名)",desc:"强制玩家拥有官方签名的公钥（聊天报告相关）。离线服建议关闭。",type:"boolean"},{key:"enable-code-of-conduct",label:"启用行为准则提示",desc:"是否向玩家展示行为准则链接（遥测相关）。",type:"boolean"},{key:"bug-report-link",label:"Bug 反馈链接",desc:"自定义玩家遇到错误时显示的反馈网址。",type:"string"},{key:"resource-pack",label:"资源包下载地址",desc:"玩家进入服务器时提示下载的资源包直链 URL。",type:"string"},{key:"require-resource-pack",label:"强制资源包",desc:"开启后，拒绝下载资源包的玩家将被踢出。",type:"boolean"},{key:"resource-pack-sha1",label:"资源包 SHA1",desc:"资源包文件的 SHA-1 校验码，用于验证完整性和缓存。",type:"string"},{key:"resource-pack-prompt",label:"资源包提示语",desc:"下载资源包时向玩家显示的自定义消息（Json 格式）。",type:"string"},{key:"initial-enabled-packs",label:"初始启用数据包",desc:"世界生成时默认启用的数据包列表（逗号分隔）。",type:"string"},{key:"initial-disabled-packs",label:"初始禁用数据包",desc:"世界生成时默认禁用的数据包列表。",type:"string"},{key:"enable-rcon",label:"启用 RCON",desc:"开启远程控制台协议，允许外部工具发送指令。",type:"boolean"},{key:"rcon.port",label:"RCON 端口",desc:"RCON 监听端口（默认为 25575）。",type:"number"},{key:"rcon.password",label:"RCON 密码",desc:"连接 RCON 必须的密码。请设置复杂的密码。",type:"string"},{key:"broadcast-rcon-to-ops",label:"向 OP 广播 RCON",desc:"当 RCON 执行指令时，是否通知在线的 OP。",type:"boolean"},{key:"enable-query",label:"启用 Query",desc:"开启 GameSpy4 协议，用于获取服务器详细信息。",type:"boolean"},{key:"query.port",label:"Query 端口",desc:"Query 协议监听端口（默认为 25565）。",type:"number"},{key:"broadcast-console-to-ops",label:"向 OP 广播控制台",desc:"控制台执行的指令输出是否发给在线 OP。",type:"boolean"},{key:"enable-jmx-monitoring",label:"启用 JMX 监控",desc:"开启 Java JMX 性能监控（通常用于开发调试）。",type:"boolean"},{key:"management-server-enabled",label:"启用管理后台",desc:"是否启用 Minecraft 官方定义的管理服务器接口。",type:"boolean"},{key:"management-server-port",label:"管理后台端口",desc:"管理接口监听的端口。",type:"number"},{key:"management-server-host",label:"管理后台主机",desc:"管理接口绑定的主机名/IP。",type:"string"},{key:"management-server-allowed-origins",label:"管理后台允许源",desc:"允许访问管理接口的 Origin 列表。",type:"string"},{key:"server-ip",label:"服务器绑定 IP",desc:"指定服务器绑定的本地网卡 IP。留空表示监听所有网卡（0.0.0.0）。",type:"string"},{key:"debug",label:"调试模式",desc:"开启后控制台将输出更多调试信息。",type:"boolean"},{key:"text-filtering-config",label:"文本过滤配置",desc:"用于文本过滤服务的 API 配置。",type:"string"},{key:"status-heartbeat-interval",label:"状态心跳间隔",desc:"服务器向客户端发送状态心跳的间隔（0 为默认）。",type:"number"}],lh={class:"settings-container"},nh={class:"page-header"},oh={class:"config-list"},ih={key:0,class:"empty-tip"},rh={class:"setting-info"},uh={class:"title"},dh={class:"key-name-row"},ch={key:0,class:"key-name"},mh={key:0,class:"desc"},ph={class:"setting-control"},vh={class:"form-actions"},fh=se({__name:"ServerProperties",setup(s){const l=Ze(),n=x(0),d=x(!1),i=x(!1),u=x({}),f=x(""),r=g=>{const z={};return g.split(`
`).forEach(p=>{const S=p.trim();if(!S||S.startsWith("#"))return;const b=S.indexOf("=");if(b!==-1){const R=S.substring(0,b).trim(),T=S.substring(b+1).trim();z[R]=T}}),z},c=g=>{let z=`#Minecraft server properties
#${new Date().toString()}
`;const U=bs.map(S=>S.key),p=Object.keys(g);return U.forEach(S=>{Object.prototype.hasOwnProperty.call(g,S)&&(z+=`${S}=${g[S]}
`)}),p.forEach(S=>{U.includes(S)||(z+=`${S}=${g[S]}
`)}),z},_=async()=>{if(n.value){d.value=!0;try{const g=await ya(n.value,"server.properties");g&&(f.value=g,u.value=r(g))}catch(g){B.error(`读取配置文件失败: ${g.message}`)}finally{d.value=!1}}},y=async()=>{i.value=!0;try{const g=c(u.value);await Ja(n.value,"server.properties",g),B.success("配置文件已保存"),_()}catch(g){B.error(`保存失败: ${g.message}`)}finally{i.value=!1}},M=ee(()=>{const g=[],z=u.value,U=new Set(Object.keys(z));return bs.forEach(p=>{U.has(p.key)&&(g.push(p),U.delete(p.key))}),U.forEach(p=>{g.push({key:p,label:p,desc:"未收录的配置项",type:$(z[p]),isUnknown:!0})}),g}),$=g=>g==="true"||g==="false"?"boolean":!isNaN(Number(g))&&g!==""?"number":"string",V=(g,z)=>{const U=u.value[g];return U===void 0?z==="boolean"?!1:"":z==="boolean"?U==="true":z==="number"?Number(U):U},h=(g,z,U)=>{u.value[g]=String(z)};return we(()=>l.params.serverId,g=>{l.name==="InstanceConsole"&&g&&(n.value=parseInt(g),_())},{immediate:!0}),(g,z)=>{const U=m("t-button"),p=m("t-space"),S=m("t-switch"),b=m("t-select"),R=m("t-input-number"),T=m("t-input"),P=m("t-loading");return o(),C("div",lh,[t("div",nh,[z[1]||(z[1]=t("div",{class:"section-title"},"Server.properties 配置编辑器",-1)),e(p,null,{default:a(()=>[e(U,{variant:"text",shape:"square",loading:d.value,onClick:_},{icon:a(()=>[e(k(st))]),_:1},8,["loading"]),e(U,{theme:"primary",loading:i.value,onClick:y},{icon:a(()=>[e(k(Es))]),default:a(()=>[z[0]||(z[0]=v(" 保存配置 ",-1))]),_:1},8,["loading"])]),_:1})]),e(P,{loading:d.value,text:"正在读取配置文件..."},{default:a(()=>[t("div",oh,[!d.value&&M.value.length===0?(o(),C("div",ih," 无法找到配置项或文件为空 ")):K("",!0),(o(!0),C(de,null,ye(M.value,G=>(o(),C("div",{key:G.key,class:ke(["setting-item",{"unknown-item":G.isUnknown}])},[t("div",rh,[t("div",uh,I(G.label),1),t("div",dh,[G.isUnknown?K("",!0):(o(),C("span",ch,I(G.key),1))]),G.isUnknown?K("",!0):(o(),C("div",mh,I(G.desc||"暂无描述"),1))]),t("div",ph,[G.type==="boolean"?(o(),O(S,{key:0,"model-value":V(G.key,"boolean"),"onUpdate:modelValue":N=>h(G.key,N,"boolean")},null,8,["model-value","onUpdate:modelValue"])):G.type==="select"?(o(),O(b,{key:1,"model-value":V(G.key,"string"),options:G.options,placeholder:"请选择","onUpdate:modelValue":N=>h(G.key,N,"string")},null,8,["model-value","options","onUpdate:modelValue"])):G.type==="number"?(o(),O(R,{key:2,"model-value":V(G.key,"number"),theme:"column",style:{width:"100%"},"onUpdate:modelValue":N=>h(G.key,N,"number")},null,8,["model-value","onUpdate:modelValue"])):(o(),O(T,{key:3,"model-value":V(G.key,"string"),placeholder:"未设置","onUpdate:modelValue":N=>h(G.key,N,"string")},null,8,["model-value","onUpdate:modelValue"]))])],2))),128))])]),_:1},8,["loading"]),t("div",vh,[e(U,{theme:"primary",size:"large",loading:i.value,onClick:y},{default:a(()=>[...z[2]||(z[2]=[v("保存设置",-1)])]),_:1},8,["loading"]),e(U,{theme:"default",variant:"base",size:"large",onClick:_},{default:a(()=>[...z[3]||(z[3]=[v("重置更改",-1)])]),_:1})])])}}}),gh=ie(fh,[["__scopeId","data-v-6dfcc71c"]]);async function _h(s){return await Q.get({url:`/api/instance/tasks/list/${s}`})}async function hh(s,l,n,d,i,u){return await Q.post({url:"/api/instance/tasks/create",data:{instanceId:s,name:l,cron:n,payload:d,type:i,enable:u}})}async function yh(s,l,n,d,i,u,f){return await Q.post({url:"/api/instance/tasks/update",data:{instanceId:s,id:l,name:n,cron:d,payload:i,type:u,enable:f}})}async function bh(s){return await Q.post({url:`/api/instance/tasks/delete/${s}`})}const wh={class:"cron-gen-container"},kh={class:"mode-switch"},$h={key:0,class:"mode-content novice-panel"},xh={class:"novice-input-group"},Ah={key:1,class:"mode-content pro-panel"},Ch={class:"tab-scroll-area"},Sh={key:0,class:"specific-box"},Ih={class:"result-area"},Vh={class:"cron-display"},Mh={class:"code-box"},Lh={class:"next-runs"},Uh={class:"runs-title"},Bh={key:0,class:"error-msg"},zh={key:1,class:"runs-list"},Ph={class:"index"},Rh=se({__name:"CronGenerator",props:{visible:{type:Boolean,default:!1},initialValue:{type:String,default:""}},emits:["update:visible","confirm"],setup(s,{emit:l}){const n=s,d=l,i=x("novice"),u=x(10),f=x("minute"),r=[{label:"秒",value:"second"},{label:"分钟",value:"minute"},{label:"小时",value:"hour"},{label:"天",value:"day"}],c=x("second"),_=[{label:"秒",value:"second",min:0,max:59},{label:"分",value:"minute",min:0,max:59},{label:"时",value:"hour",min:0,max:23},{label:"日",value:"day",min:1,max:31},{label:"月",value:"month",min:1,max:12},{label:"周",value:"week",min:1,max:7}],y=x({second:{type:"every",start:0,step:1,specifics:[]},minute:{type:"every",start:0,step:1,specifics:[]},hour:{type:"every",start:0,step:1,specifics:[]},day:{type:"every",start:1,step:1,specifics:[]},month:{type:"every",start:1,step:1,specifics:[]},week:{type:"any",start:1,step:1,specifics:[]}}),M=[{label:"周日",value:1},{label:"周一",value:2},{label:"周二",value:3},{label:"周三",value:4},{label:"周四",value:5},{label:"周五",value:6},{label:"周六",value:7}],$=ee(()=>{const b=(w,A="*")=>{const L=y.value[w];return w==="week"&&L.type==="any"||w==="week"&&y.value.day.type!=="every"||w==="day"&&y.value.week.type!=="any"?"?":L.type==="every"?"*":L.type==="interval"?`${L.start}/${L.step}`:L.type==="specific"?L.specifics.length===0?w==="day"||w==="month"?"1":"0":L.specifics.sort((H,J)=>H-J).join(","):A},R=b("second"),T=b("minute"),P=b("hour"),G=b("day"),N=b("month"),E=b("week","?");return`${R} ${T} ${P} ${G} ${N} ${E}`}),V=ee(()=>{const b=u.value;switch(f.value){case"second":return`*/${b} * * * * *`;case"minute":return`0 */${b} * * * *`;case"hour":return`0 0 */${b} * * ?`;case"day":return`0 0 0 */${b} * ?`;default:return"* * * * * *"}}),h=ee(()=>i.value==="novice"?V.value:$.value),g=x([]),z=x(""),U=()=>{try{const b=mn.CronExpressionParser.parse(h.value,{currentDate:new Date});g.value=b.take(5).map(R=>new Date(R.toString()).toLocaleString()),z.value=""}catch{z.value="无法解析当前 Cron 表达式，请检查规则是否冲突",g.value=[]}};we(h,()=>{U()},{immediate:!0}),we(()=>n.visible,b=>{b&&n.initialValue&&(i.value="pro",U())});const p=()=>{if(z.value){B.warning("当前表达式无效，无法保存");return}d("confirm",h.value),d("update:visible",!1)},S=b=>{const R=_.find(P=>P.value===b);if(!R)return[];const T=[];for(let P=R.min;P<=R.max;P++)T.push({label:P.toString(),value:P});return T};return(b,R)=>{const T=m("t-radio-button"),P=m("t-radio-group"),G=m("t-input-number"),N=m("t-select"),E=m("t-alert"),w=m("t-radio"),A=m("t-checkbox-group"),L=m("t-tab-panel"),H=m("t-tabs"),J=m("t-tag"),X=m("t-dialog");return o(),O(X,{visible:s.visible,header:"Cron 表达式生成器",width:"700px",top:"5vh",onClose:R[4]||(R[4]=q=>d("update:visible",!1)),onConfirm:p},{default:a(()=>[t("div",wh,[t("div",kh,[e(P,{modelValue:i.value,"onUpdate:modelValue":R[0]||(R[0]=q=>i.value=q),variant:"default-filled"},{default:a(()=>[e(T,{value:"novice"},{default:a(()=>[...R[5]||(R[5]=[v("🚀 新手模式",-1)])]),_:1}),e(T,{value:"pro"},{default:a(()=>[...R[6]||(R[6]=[v("🛠️ 专业模式",-1)])]),_:1})]),_:1},8,["modelValue"])]),i.value==="novice"?(o(),C("div",$h,[t("div",xh,[R[7]||(R[7]=t("span",null,"每隔",-1)),e(G,{modelValue:u.value,"onUpdate:modelValue":R[1]||(R[1]=q=>u.value=q),min:1,theme:"column",style:{width:"100px"}},null,8,["modelValue"]),e(N,{modelValue:f.value,"onUpdate:modelValue":R[2]||(R[2]=q=>f.value=q),options:r,style:{width:"100px"}},null,8,["modelValue"]),R[8]||(R[8]=t("span",null,"执行一次",-1))]),e(E,{theme:"info",style:{"margin-top":"16px"}},{message:a(()=>[...R[9]||(R[9]=[v(" 此模式适用于简单的周期性任务。如果需要“每周五上午10点”等复杂规则，请切换到",-1),t("b",null,"专业模式",-1),v("。 ",-1)])]),_:1})])):(o(),C("div",Ah,[e(H,{modelValue:c.value,"onUpdate:modelValue":R[3]||(R[3]=q=>c.value=q)},{default:a(()=>[(o(),C(de,null,ye(_,q=>e(L,{key:q.value,value:q.value,label:q.label},{default:a(()=>[t("div",Ch,[e(P,{modelValue:y.value[q.value].type,"onUpdate:modelValue":_e=>y.value[q.value].type=_e,direction:"vertical"},{default:a(()=>[e(w,{value:"every"},{default:a(()=>[v(I(q.value==="week"?"不指定 (?)":`每${q.label} (*)`),1)]),_:2},1024),q.value!=="week"?(o(),O(w,{key:0,value:"interval"},{default:a(()=>[R[10]||(R[10]=v(" 周期: 从 ",-1)),e(G,{modelValue:y.value[q.value].start,"onUpdate:modelValue":_e=>y.value[q.value].start=_e,min:q.min,max:q.max,size:"small",theme:"column",style:{width:"60px"}},null,8,["modelValue","onUpdate:modelValue","min","max"]),v(" "+I(q.label)+"开始，每 ",1),e(G,{modelValue:y.value[q.value].step,"onUpdate:modelValue":_e=>y.value[q.value].step=_e,min:1,max:q.max,size:"small",theme:"column",style:{width:"60px"}},null,8,["modelValue","onUpdate:modelValue","max"]),v(" "+I(q.label)+"执行一次 ",1)]),_:2},1024)):K("",!0),q.value!=="week"?(o(),O(w,{key:1,value:"specific"},{default:a(()=>[v("指定: 选择具体的"+I(q.label),1)]),_:2},1024)):K("",!0),q.value==="week"?(o(),O(w,{key:2,value:"specific"},{default:a(()=>[...R[11]||(R[11]=[v("指定周几",-1)])]),_:1})):K("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),y.value[q.value].type==="specific"?(o(),C("div",Sh,[e(A,{modelValue:y.value[q.value].specifics,"onUpdate:modelValue":_e=>y.value[q.value].specifics=_e,options:q.value==="week"?M:S(q.value),class:"grid-checkbox"},null,8,["modelValue","onUpdate:modelValue","options"])])):K("",!0)])]),_:2},1032,["value","label"])),64))]),_:1},8,["modelValue"])])),t("div",Ih,[t("div",Vh,[R[14]||(R[14]=t("span",{class:"label"},"当前表达式:",-1)),t("div",Mh,[v(I(h.value)+" ",1),z.value?(o(),O(J,{key:1,theme:"danger",variant:"light",size:"small"},{default:a(()=>[e(k(As)),R[13]||(R[13]=v(" 无效",-1))]),_:1})):(o(),O(J,{key:0,theme:"success",variant:"light",size:"small"},{default:a(()=>[e(k(St)),R[12]||(R[12]=v(" 有效",-1))]),_:1}))])]),t("div",Lh,[t("div",Uh,[e(k(pt)),R[15]||(R[15]=v(" 最近 5 次运行时间预测:",-1))]),z.value?(o(),C("div",Bh,I(z.value),1)):(o(),C("ul",zh,[(o(!0),C(de,null,ye(g.value,(q,_e)=>(o(),C("li",{key:_e},[t("span",Ph,"#"+I(_e+1),1),v(" "+I(q),1)]))),128))]))])])])]),_:1},8,["visible"])}}}),Eh=ie(Rh,[["__scopeId","data-v-b81cfe41"]]),jt="https://mslx.mslmc.cn",Wt={cron:`${jt}/docs/server-config/crons`,style:`${jt}/docs/style/webpanel/`,style_log_colorizer:`${jt}/docs/style/webpanel/#%E7%BB%88%E7%AB%AF%E6%97%A5%E5%BF%97%E6%9F%93%E8%89%B2%E7%AD%89%E7%BA%A7%E9%85%8D%E7%BD%AE`,remote_access:`${jt}/docs/config/remote-access/`,msl_oauth:`${jt}/docs/config/msl-oauth`},Th={class:"page-container"},Fh={class:"page-header"},Dh={key:0,class:"create-container"},Oh={class:"container-header"},jh={class:"title"},Kh={class:"setting-item"},Nh={class:"setting-control"},qh={class:"setting-item"},Gh={class:"setting-control"},Hh={class:"setting-item"},Jh={class:"setting-control"},Wh={key:0,class:"setting-item"},Xh={class:"setting-info"},Qh={class:"title"},Yh={class:"desc"},Zh={class:"setting-control"},ey={class:"setting-item"},ty={class:"setting-control"},ay={class:"form-actions"},sy={class:"task-list"},ly={key:0,class:"empty-state"},ny={class:"card-left"},oy={class:"task-header-row"},iy={class:"task-name"},ry={class:"task-meta-row"},uy={class:"cron-display"},dy=["title"],cy={class:"card-right"},my=se({__name:"CronTasks",setup(s){const l=Ze(),n=ee(()=>parseInt(l.params.serverId)),d=x([]),i=x(!1),u=x(!1),f=x(null),r=x(!1),c=x(null),_=x(!1),y=x({id:"",name:"",cron:"",type:"command",payload:"",enable:!0}),M=[{label:"发送命令 (Command)",value:"command"},{label:"备份存档 (Backup)",value:"backup"},{label:"开启服务器 (Start)",value:"start"},{label:"停止服务器 (Stop)",value:"stop"},{label:"重启服务器 (Restart)",value:"restart"}],$={name:[{required:!0,message:"必填",trigger:"blur"}],cron:[{required:!0,message:"必填",trigger:"blur"}],type:[{required:!0,message:"必选",trigger:"change"}],payload:[{validator:T=>y.value.type==="command"&&!T?{result:!1,message:"命令内容不能为空",type:"error"}:!0,trigger:"blur"}]},V=async()=>{if(n.value){i.value=!0;try{const T=await _h(n.value);d.value=T||[]}catch(T){B.error(T.message||"获取列表失败")}finally{i.value=!1}}},h=()=>{u.value||(y.value={id:"",name:"",cron:"",type:"command",payload:"",enable:!0},f.value=null,u.value=!0)},g=T=>{y.value={id:T.id,name:T.name,cron:T.cron,type:T.type.toLowerCase(),payload:T.payload,enable:T.enable},f.value=T.id,u.value=!0,window.scrollTo({top:0,behavior:"smooth"})},z=()=>{u.value=!1,f.value=null},U=async()=>{if(await c.value?.validate()===!0){r.value=!0;try{f.value?(await yh(n.value,y.value.id,y.value.name,y.value.cron,y.value.payload,y.value.type,y.value.enable),B.success("更新成功")):(await hh(n.value,y.value.name,y.value.cron,y.value.payload,y.value.type,y.value.enable),B.success("创建成功")),z(),V()}catch(P){B.error(P.message||"操作失败")}finally{r.value=!1}}},p=T=>{const P=at.confirm({header:"确认删除?",body:`确定删除任务 "${T.name}" 吗？`,theme:"danger",onConfirm:async()=>{try{await bh(T.id),B.success("已删除"),V(),P.hide()}catch(G){B.error(G.message)}},onClose:()=>P.hide()})},S=T=>{y.value.cron=T},b=T=>{const P=T.toLowerCase();return P==="start"?Ft:P==="stop"?va:P==="restart"?st:Pt},R=T=>{const P=T.toLowerCase();return P==="start"?"success":P==="stop"?"danger":P==="restart"?"warning":"primary"};return we(()=>n.value,V),Ce(V),(T,P)=>{const G=m("t-button"),N=m("t-space"),E=m("t-input"),w=m("t-select"),A=m("t-textarea"),L=m("t-switch"),H=m("t-form"),J=m("t-tag"),X=m("t-loading");return o(),C("div",Th,[t("div",Fh,[P[10]||(P[10]=t("div",{class:"section-title"},"定时计划任务",-1)),e(N,null,{default:a(()=>[u.value?K("",!0):(o(),O(G,{key:0,theme:"default",onClick:P[0]||(P[0]=q=>k(Ie)(k(Wt).cron))},{icon:a(()=>[e(k(da))]),default:a(()=>[P[8]||(P[8]=v(" 使用文档 ",-1))]),_:1})),u.value?K("",!0):(o(),O(G,{key:1,theme:"primary",onClick:h},{icon:a(()=>[e(k(Yt))]),default:a(()=>[P[9]||(P[9]=v(" 创建新任务 ",-1))]),_:1}))]),_:1})]),e(Qt,{name:"slide-fade"},{default:a(()=>[u.value?(o(),C("div",Dh,[t("div",Oh,[t("span",jh,I(f.value?"编辑任务":"创建新任务"),1),e(G,{size:"small",variant:"text",onClick:z},{default:a(()=>[e(k(Oa))]),_:1})]),e(H,{ref_key:"formRef",ref:c,data:y.value,rules:$,"label-width":"0"},{default:a(()=>[t("div",Kh,[P[11]||(P[11]=t("div",{class:"setting-info"},[t("div",{class:"title"},"任务名称"),t("div",{class:"desc"},"给这个计划任务起个容易识别的名字，例如“每日自动重启”")],-1)),t("div",Nh,[e(E,{modelValue:y.value.name,"onUpdate:modelValue":P[1]||(P[1]=q=>y.value.name=q),placeholder:"请输入任务名称"},null,8,["modelValue"])])]),t("div",qh,[P[13]||(P[13]=t("div",{class:"setting-info"},[t("div",{class:"title"},"触发规则 (Cron)"),t("div",{class:"desc"},"使用 Cron 表达式定义执行时间。支持秒级精度 (秒 分 时 日 月 周)")],-1)),t("div",Gh,[e(E,{modelValue:y.value.cron,"onUpdate:modelValue":P[2]||(P[2]=q=>y.value.cron=q),placeholder:"例如: 0 0 12 * * ?"},null,8,["modelValue"]),e(G,{variant:"outline",theme:"default",onClick:P[3]||(P[3]=q=>_.value=!0)},{default:a(()=>[...P[12]||(P[12]=[v(" 表达式生成器 ",-1)])]),_:1})])]),t("div",Hh,[P[14]||(P[14]=t("div",{class:"setting-info"},[t("div",{class:"title"},"执行操作"),t("div",{class:"desc"},"选择触发时要执行的动作类型")],-1)),t("div",Jh,[e(w,{modelValue:y.value.type,"onUpdate:modelValue":P[4]||(P[4]=q=>y.value.type=q),options:M},null,8,["modelValue"])])]),y.value.type==="command"||y.value.type==="restart"?(o(),C("div",Wh,[t("div",Xh,[t("div",Qh,I(y.value.type==="restart"?"重启提示语":"控制台命令"),1),t("div",Yh,I(y.value.type==="restart"?"重启前发送给全服玩家的倒计时提示消息":"不需要加 /，直接输入命令内容"),1)]),t("div",Zh,[e(A,{modelValue:y.value.payload,"onUpdate:modelValue":P[5]||(P[5]=q=>y.value.payload=q),autosize:{minRows:2,maxRows:5},placeholder:"请输入内容..."},null,8,["modelValue"])])])):K("",!0),t("div",ey,[P[15]||(P[15]=t("div",{class:"setting-info"},[t("div",{class:"title"},"启用状态"),t("div",{class:"desc"},"暂时禁用此任务而不删除它")],-1)),t("div",ty,[e(L,{modelValue:y.value.enable,"onUpdate:modelValue":P[6]||(P[6]=q=>y.value.enable=q)},null,8,["modelValue"])])]),t("div",ay,[e(G,{theme:"primary",loading:r.value,onClick:U},{icon:a(()=>[e(k(Es))]),default:a(()=>[v(" "+I(f.value?"保存修改":"立即创建"),1)]),_:1},8,["loading"]),e(G,{theme:"default",variant:"base",onClick:z},{default:a(()=>[...P[16]||(P[16]=[v("取消",-1)])]),_:1})])]),_:1},8,["data"])])):K("",!0)]),_:1}),e(X,{loading:i.value,"show-overlay":""},{default:a(()=>[t("div",sy,[d.value.length===0&&!i.value?(o(),C("div",ly,"暂无任务，请点击上方创建")):K("",!0),(o(!0),C(de,null,ye(d.value,q=>(o(),C("div",{key:q.id,class:"task-card"},[t("div",ny,[t("div",oy,[e(J,{size:"small",theme:q.enable?"success":"warning",variant:"light",class:"status-tag"},{default:a(()=>[v(I(q.enable?"运行中":"已暂停"),1)]),_:2},1032,["theme"]),t("span",iy,I(q.name),1)]),t("div",ry,[e(J,{size:"small",variant:"outline",theme:R(q.type),style:{"margin-right":"8px"}},{icon:a(()=>[(o(),O(ot(b(q.type))))]),default:a(()=>[v(" "+I(q.type.toUpperCase()),1)]),_:2},1032,["theme"]),t("span",uy,[e(k(pt)),v(" "+I(q.cron),1)])]),q.payload?(o(),C("div",{key:0,class:"task-payload",title:q.payload},I(q.payload),9,dy)):K("",!0)]),t("div",cy,[e(G,{variant:"text",theme:"primary",onClick:_e=>g(q)},{icon:a(()=>[e(k(Ls))]),default:a(()=>[P[17]||(P[17]=v(" 编辑 ",-1))]),_:1},8,["onClick"]),e(G,{variant:"text",theme:"danger",onClick:_e=>p(q)},{icon:a(()=>[e(k($t))]),default:a(()=>[P[18]||(P[18]=v(" 删除 ",-1))]),_:1},8,["onClick"])])]))),128))])]),_:1},8,["loading"]),e(Eh,{visible:_.value,"onUpdate:visible":P[7]||(P[7]=q=>_.value=q),"initial-value":y.value.cron,onConfirm:S},null,8,["visible","initial-value"])])}}}),py=ie(my,[["__scopeId","data-v-98dd2a72"]]),vy={class:"settings-container"},fy={class:"setting-item"},gy={class:"setting-info"},_y={class:"desc"},hy={class:"setting-control"},yy={key:0,class:"bulk-action-bar"},by={class:"selected-text"},wy={class:"backup-table-wrapper"},ky={class:"file-name-cell"},$y={class:"time-cell"},xy=se({__name:"BackupManager",setup(s){const l=Ze(),n=ee(()=>{const h=l.params.serverId;return h?parseInt(h):NaN}),d=x(!1),i=x([]),u=x([]),f=[{colKey:"row-select",type:"multiple",width:20,fixed:"left"},{colKey:"fileName",title:"文件名",ellipsis:!0,width:200},{colKey:"fileSizeStr",title:"文件大小",width:120},{colKey:"createTime",title:"备份时间",width:180},{colKey:"op",title:"操作",fixed:"right",width:140}],r=h=>new Promise(g=>setTimeout(g,h)),c=async()=>{if(n.value){d.value=!0,u.value=[];try{const h=await ir(n.value);i.value=h.data||h}catch(h){B.error("获取备份列表失败: "+h.message)}finally{d.value=!1}}},_=h=>{u.value=h},y=h=>{const g=at.confirm({header:"确认删除备份?",body:`您确定要永久删除文件 "${h.fileName}" 吗？此操作不可恢复。`,theme:"danger",onConfirm:async()=>{g.hide();try{await Ta(n.value,h.fileName),B.success("删除成功"),await c()}catch(z){B.error(z.message||"删除失败")}},onClose:()=>{g.hide()}})},M=h=>{try{const g=Fa(n.value,h.fileName);window.open(g,"_blank")}catch(g){B.error("下载失败！"+g.message)}},$=()=>{const h=u.value.length;h!==0&&(B.info(`开始下载 ${h} 个文件，请注意允许浏览器弹窗...`),u.value.forEach((g,z)=>{setTimeout(()=>{const U=Fa(n.value,g);window.open(U,"_blank")},z*1e3)}))},V=()=>{const h=u.value.length;if(h===0)return;const g=at.confirm({header:"确认批量删除?",body:`您选中了 ${h} 个备份文件。删除后无法恢复，确定要继续吗？`,theme:"danger",onConfirm:async()=>{g.hide(),d.value=!0;let z=0,U=0,p=null;try{for(const[S,b]of u.value.entries()){p&&B.close(p),p=B.loading(`正在删除 ${b} (${S+1}/${h})...`,0);try{await Ta(n.value,b),z++}catch(R){U++,console.error(`删除 ${b} 失败`,R)}S<h-1&&await r(800)}}finally{p&&B.close(p),d.value=!1,U===0?B.success(`批量删除完成，共删除 ${z} 个文件`):B.warning(`批量操作完成：成功 ${z} 个，失败 ${U} 个`),await c()}},onClose:()=>{g.hide()}})};return we(()=>l.params.serverId,h=>{h&&c()}),Ce(()=>{c()}),(h,g)=>{const z=m("t-button"),U=m("t-tooltip"),p=m("t-space"),S=m("t-table");return o(),C("div",vy,[g[10]||(g[10]=t("div",{class:"setting-group-title"},"备份管理",-1)),t("div",fy,[t("div",gy,[g[4]||(g[4]=t("div",{class:"title"},"存档快照",-1)),t("div",_y,[g[0]||(g[0]=v(" 查看和管理服务器的自动或手动备份。建议定期下载重要备份到本地保存。 ",-1)),g[1]||(g[1]=t("br",null,null,-1)),g[2]||(g[2]=v(" 当前共有 ",-1)),t("b",null,I(i.value.length),1),g[3]||(g[3]=v(" 个备份文件。最大保存备份文件的数量需要在实例设置中配置。 ",-1))])]),t("div",hy,[e(Qt,{name:"fade",mode:"out-in"},{default:a(()=>[u.value.length>0?(o(),C("div",yy,[g[7]||(g[7]=t("div",{class:"bar-separator"},null,-1)),t("span",by,"已选 "+I(u.value.length)+" 项",1),e(z,{variant:"text",theme:"primary",onClick:$},{default:a(()=>[...g[5]||(g[5]=[v(" 下载 ",-1)])]),_:1}),e(z,{variant:"text",theme:"danger",onClick:V},{default:a(()=>[...g[6]||(g[6]=[v(" 删除 ",-1)])]),_:1})])):(o(),O(z,{key:1,theme:"primary",variant:"outline",onClick:c},{icon:a(()=>[e(k(st))]),default:a(()=>[g[8]||(g[8]=v(" 刷新列表 ",-1))]),_:1}))]),_:1})])]),t("div",wy,[e(S,{"row-key":"fileName",data:i.value,columns:f,loading:d.value,"selected-row-keys":u.value,stripe:"",hover:"",class:"custom-table",onSelectChange:_},{fileName:a(({row:b})=>[t("div",ky,[e(k(Gt),{style:{"margin-right":"6px",color:"var(--td-brand-color)"}}),t("span",null,I(b.fileName),1)])]),createTime:a(({row:b})=>[t("div",$y,[e(k(pt),{style:{"margin-right":"6px",color:"var(--td-text-color-placeholder)"}}),v(" "+I(b.createTime),1)])]),op:a(({row:b})=>[e(p,null,{default:a(()=>[e(U,{content:"下载备份"},{default:a(()=>[e(z,{variant:"text",shape:"square",theme:"primary",onClick:R=>M(b)},{default:a(()=>[e(k(fa))]),_:1},8,["onClick"])]),_:2},1024),e(U,{content:"删除备份"},{default:a(()=>[e(z,{variant:"text",shape:"square",theme:"danger",onClick:R=>y(b)},{default:a(()=>[e(k($t))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),empty:a(()=>[...g[9]||(g[9]=[t("div",{class:"empty-state"},"暂无备份记录",-1)])]),_:1},8,["data","loading","selected-row-keys"])])])}}}),Ay=ie(xy,[["__scopeId","data-v-e5d92c81"]]),Cy={class:"layout-container"},Sy={class:"sidebar"},Iy=["onClick"],Vy={class:"nav-text"},My={class:"main-content"},Ly={key:0,class:"panel-wrapper"},Uy={key:1,class:"panel-wrapper"},By={key:2,class:"panel-wrapper"},zy={key:3,class:"panel-wrapper"},Py={key:4,class:"panel-wrapper"},Ry=se({__name:"InstanceSettings",setup(s,{expose:l}){const n=x(!1),d=x(0),i=[{label:"实例设置",icon:ha},{label:"插件/模组",icon:zl},{label:"服务器属性",icon:Pl},{label:"定时任务",icon:pt},{label:"备份管理",icon:Rl}];return l({open:()=>{n.value=!0}}),(f,r)=>{const c=m("t-dialog");return o(),O(c,{visible:n.value,"onUpdate:visible":r[0]||(r[0]=_=>n.value=_),header:"实例配置",width:"90%",top:"3vh",attach:"body",footer:!1,class:"settings-dialog"},{default:a(()=>[t("div",Cy,[t("div",Sy,[(o(),C(de,null,ye(i,(_,y)=>t("div",{key:y,class:ke(["nav-item",{active:d.value===y}]),onClick:M=>d.value=y},[(o(),O(ot(_.icon),{class:"nav-icon"})),t("span",Vy,I(_.label),1)],10,Iy)),64))]),t("div",My,[d.value===0?(o(),C("div",Ly,[e(w_)])):K("",!0),d.value===1?(o(),C("div",Uy,[e(sh)])):K("",!0),d.value===2?(o(),C("div",By,[e(gh,{"instance-id":21})])):K("",!0),d.value===3?(o(),C("div",zy,[e(py)])):K("",!0),d.value===4?(o(),C("div",Py,[e(Ay)])):K("",!0)])])]),_:1},8,["visible"])}}}),Ey=ie(Ry,[["__scopeId","data-v-5ce426cf"]]),Ty={class:"monitor-container"},Fy={class:"status-header"},Dy={class:"status-text"},Oy={class:"monitor-content"},jy={class:"monitor-block"},Ky={class:"info-item"},Ny={class:"label"},qy={class:"value"},Gy={class:"monitor-block"},Hy={class:"info-item"},Jy={class:"label"},Wy={class:"value"},Xy={key:0,class:"sub-val"},na=20,Qy=se({__name:"InstanceMonitor",props:{serverId:{},maxMemory:{},isRunning:{type:Boolean}},setup(s){const l=s,n=la(),d=x(null),i=x(null);let u=null,f=null;const r=x(new Array(na).fill(0)),c=x(new Array(na).fill(0)),_=ee(()=>l.maxMemory>0),y=(z,U,p=100)=>({grid:{top:4,right:0,bottom:4,left:0},xAxis:{type:"category",show:!1,boundaryGap:!1},yAxis:{type:"value",min:0,max:p===null?void 0:p,show:!1},series:[{type:"line",data:U,smooth:!0,showSymbol:!1,lineStyle:{width:2,color:z},areaStyle:{color:new Gs(0,0,0,1,[{offset:0,color:z.replace(")",", 0.2)").replace("rgb","rgba")},{offset:1,color:"transparent"}])}}]}),M=()=>{const z=getComputedStyle(document.documentElement),U=z.getPropertyValue("--td-brand-color").trim()||"#0052d9",p=z.getPropertyValue("--td-warning-color").trim()||"#e37318";if(d.value&&(u=ca(d.value),u.setOption(y(U,r.value,100))),i.value){f=ca(i.value);const S=_.value?100:null;f.setOption(y(p,c.value,S))}window.addEventListener("resize",$)},$=()=>{u?.resize(),f?.resize()},V=ee(()=>{const z=n.stats.memBytes/1024/1024;return z>1024?`${(z/1024).toFixed(2)} GB`:`${z.toFixed(0)} MB`}),h=async()=>{l.isRunning&&l.serverId&&(n.setMaxMemory(l.maxMemory),await n.connect(l.serverId))},g=async()=>{await n.disconnect()};return we(()=>l.maxMemory,z=>{if(n.setMaxMemory(z),f){const U=z>0?100:null;f.setOption({yAxis:{max:U===null?void 0:U}})}},{immediate:!0}),we(()=>n.stats,z=>{if(!(!l.isRunning||n.currentServerId!==l.serverId)){if(r.value.push(z.cpu),r.value.length>na&&r.value.shift(),_.value)c.value.push(z.memPercent);else{const U=z.memBytes/1024/1024;c.value.push(U)}c.value.length>na&&c.value.shift(),u?.setOption({series:[{data:r.value}]}),f?.setOption({series:[{data:c.value}]})}},{deep:!0}),we(()=>l.isRunning,async z=>{z?bt(()=>{$(),h()}):(r.value.fill(0),c.value.fill(0),u?.setOption({series:[{data:r.value}]}),f?.setOption({series:[{data:c.value}]}),await g())}),we(()=>l.serverId,async(z,U)=>{z!==U&&(await g(),l.isRunning&&await h())}),Ce(async()=>{await bt(),M(),l.isRunning&&await h()}),Qe(async()=>{window.removeEventListener("resize",$),await g(),u?.dispose(),f?.dispose()}),(z,U)=>(o(),C("div",Ty,[t("div",Fy,[t("span",Dy,[k(n).isConnected?(o(),O(k(ts),{key:0,style:{color:"var(--td-success-color)"}})):(o(),O(k(ts),{key:1,style:{color:"var(--td-text-color-disabled)"}})),v(" "+I(k(n).isConnected?"连接正常":"正在连接数据流..."),1)]),t("div",{class:ke(["monitor-dot",{active:k(n).isConnected&&s.isRunning}])},null,2)]),t("div",Oy,[t("div",jy,[t("div",Ky,[t("div",Ny,[e(k(Ua)),U[0]||(U[0]=v(" CPU 使用率",-1))]),t("div",qy,I(k(n).stats.cpu.toFixed(1))+" %",1)]),t("div",{ref_key:"cpuChartRef",ref:d,class:"chart-wrapper"},null,512)]),U[2]||(U[2]=t("div",{class:"divider"},null,-1)),t("div",Gy,[t("div",Hy,[t("div",Jy,[e(k(El)),U[1]||(U[1]=v(" 内存使用",-1))]),t("div",Wy,[v(I(V.value)+" ",1),_.value?(o(),C("span",Xy," ("+I(k(n).stats.memPercent.toFixed(1))+"%) ",1)):K("",!0)])]),t("div",{ref_key:"memChartRef",ref:i,class:"chart-wrapper"},null,512)])])]))}}),Yy=ie(Qy,[["__scopeId","data-v-ddbf668d"]]);async function Zy(s){return await Q.get({url:"/api/tools/ai/usage",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${s}`}})}async function eb(s){return await Q.get({url:"/api/tools/ai/models",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${s}`}})}async function tb(s,l,n,d,i,u){return l===""&&(l=null),n===""&&(n=null),await Q.post({url:"/api/tools/ai/analysis",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${s}`},data:{mods:l,plugins:n,core:d,logs:i,model:u,usemd:!0},timeout:300*1e3})}const ab={class:"analysis-container"},sb={class:"panel-left"},lb={class:"form-group"},nb={class:"model-option-item"},ob={class:"form-group"},ib={class:"form-group"},rb={class:"env-tabs"},ub={class:"form-group flex-grow"},db={class:"action-bar"},cb={class:"panel-right"},mb={class:"panel-header"},pb={class:"stats-tags"},vb={class:"report-content"},fb=se({__name:"LogAnalysis",props:{visible:{type:Boolean},serverId:{}},emits:["update:visible","submit"],setup(s,{emit:l}){const n=Ze(),d=s,i=l,u=Xe({coreVersion:"",envType:"mods",modsList:"",pluginsList:"",logContent:"",result:"> ✨ 等待日志分析开始······",selectedModel:"Qwen/Qwen3-14B"}),f=x([]),r=Xe({max:0,today:0,extra:0,lastTime:0}),c=x(!1),_=x(!1),y=x(!1);async function M(){const U=await Zy(localStorage.getItem("msl-user-token"));if(U.code===200)r.max=U.data.max_per_day,r.extra=U.data.extra_tokens,r.lastTime=U.data.last_use_time,r.today=U.data.today_usage;else{B.error("MSL账号未登录或已失效，请重新登录！"),Ie("/frp/create");return}}async function $(){try{_.value=!0,await M();try{const p=await eb(localStorage.getItem("msl-user-token")||"");p.code===200&&(f.value=p.data,!u.selectedModel&&f.value.length>0&&(u.selectedModel=f.value[0].name))}catch(p){B.error("获取模型列表失败"+p.message)}const U=await Qs(d.serverId);u.coreVersion=U.core;try{const p=await Ra(d.serverId,"mods",!1);u.modsList=(p.jarFiles||[]).join(`
`),u.envType="mods"}catch{u.modsList=""}try{const p=await Ra(d.serverId,"plugins",!1);u.pluginsList=(p.jarFiles||[]).join(`
`),u.modsList==""&&(u.envType="plugins")}catch{u.pluginsList=""}try{u.logContent=await ya(d.serverId,"logs/latest.log")}catch{}}catch(U){B.error(U.message)}_.value=!1}we(()=>d.visible,U=>{n.name==="InstanceConsole"&&(c.value=U,U&&$())});const V=()=>{i("update:visible",!1)};async function h(){if(u.logContent){if(!u.selectedModel){B.warning("请先选择分析模型");return}y.value=!0,u.result="> ⌛️ 分析日志中··· 请稍等";try{const U=await tb(localStorage.getItem("msl-user-token"),u.modsList,u.pluginsList,u.coreVersion,u.logContent,u.selectedModel);u.result=U.data.content}catch(U){u.result=`> ❌ 分析出现错误: ${U.message}`}y.value=!1,await M()}}const g=Ss(),z=x(g.value?"dark":"light");return we(g,()=>{z.value=g.value?"dark":"light"}),(U,p)=>{const S=m("t-tag"),b=m("t-option"),R=m("t-select"),T=m("t-input"),P=m("t-radio-button"),G=m("t-radio-group"),N=m("t-textarea"),E=m("t-button"),w=m("t-loading"),A=m("t-dialog");return o(),O(A,{visible:c.value,"onUpdate:visible":p[6]||(p[6]=L=>c.value=L),width:"90%",top:"3vh",footer:!1,"close-on-overlay-click":!1,class:"log-analysis-dialog",onClose:V},{header:a(()=>[...p[7]||(p[7]=[t("div",{class:"dialog-title"},[t("span",{style:{display:"flex","align-items":"center",gap:"8px"}}," AI 错误日志分析 ")],-1)])]),default:a(()=>[e(w,{loading:_.value},{default:a(()=>[t("div",ab,[t("div",sb,[t("div",lb,[p[8]||(p[8]=t("div",{class:"label"},"选择分析模型",-1)),e(R,{modelValue:u.selectedModel,"onUpdate:modelValue":p[0]||(p[0]=L=>u.selectedModel=L),placeholder:"请选择AI模型",filterable:""},{default:a(()=>[(o(!0),C(de,null,ye(f.value,L=>(o(),O(b,{key:L.name,value:L.name,label:L.name},{default:a(()=>[t("div",nb,[t("span",null,I(L.name),1),e(S,{size:"small",variant:"light",theme:"default"},{default:a(()=>[v(" 倍率: "+I(L.rate)+"x ",1)]),_:2},1024)])]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),t("div",ob,[p[9]||(p[9]=t("div",{class:"label"},"服务端核心/版本",-1)),e(T,{modelValue:u.coreVersion,"onUpdate:modelValue":p[1]||(p[1]=L=>u.coreVersion=L),readonly:"",placeholder:"例如: Arclight 1.21.1"},{"prefix-icon":a(()=>[e(k(Ht))]),_:1},8,["modelValue"])]),t("div",ib,[p[12]||(p[12]=t("div",{class:"label"},"环境列表",-1)),t("div",rb,[e(G,{modelValue:u.envType,"onUpdate:modelValue":p[2]||(p[2]=L=>u.envType=L),variant:"default-filled",class:"custom-radio-group"},{default:a(()=>[e(P,{value:"mods"},{default:a(()=>[e(k(Ht),{class:"mr-1"}),p[10]||(p[10]=v(" 模组 (Mods) ",-1))]),_:1}),e(P,{value:"plugins"},{default:a(()=>[e(k(Ma),{class:"mr-1"}),p[11]||(p[11]=v(" 插件 (Plugins) ",-1))]),_:1})]),_:1},8,["modelValue"])]),Je(e(N,{modelValue:u.modsList,"onUpdate:modelValue":p[3]||(p[3]=L=>u.modsList=L),readonly:"",autosize:{minRows:4,maxRows:6},placeholder:"暂无模组数据...",class:"mt-2 readonly-textarea"},null,8,["modelValue"]),[[tt,u.envType==="mods"]]),Je(e(N,{modelValue:u.pluginsList,"onUpdate:modelValue":p[4]||(p[4]=L=>u.pluginsList=L),readonly:"",autosize:{minRows:4,maxRows:6},placeholder:"暂无插件数据...",class:"mt-2 readonly-textarea"},null,8,["modelValue"]),[[tt,u.envType==="plugins"]])]),t("div",ub,[p[13]||(p[13]=t("div",{class:"label"},"错误日志内容",-1)),e(N,{modelValue:u.logContent,"onUpdate:modelValue":p[5]||(p[5]=L=>u.logContent=L),placeholder:"没找到有效日志，您可以手动粘贴日志......",class:"log-textarea"},null,8,["modelValue"])]),t("div",db,[e(E,{loading:y.value,block:"",theme:"primary",size:"large",onClick:h},{icon:a(()=>[e(k(Tl))]),default:a(()=>[p[14]||(p[14]=v(" 开始 AI 诊断 ",-1))]),_:1},8,["loading"])])]),t("div",cb,[t("div",mb,[p[15]||(p[15]=t("span",{class:"title"},"AI 分析报告",-1)),t("div",pb,[e(S,{theme:"default",variant:"light",size:"small"},{icon:a(()=>[e(k(Fl))]),default:a(()=>[v(" 今日: "+I(r.today)+" / "+I(r.max),1)]),_:1}),e(S,{theme:"primary",variant:"light",size:"small"},{icon:a(()=>[e(k(Gt))]),default:a(()=>[v(" 额外: "+I(r.extra),1)]),_:1}),e(S,{theme:"warning",variant:"light",size:"small"},{icon:a(()=>[e(k(pt))]),default:a(()=>[v(" 上次: "+I(k(Zs)(r.lastTime)),1)]),_:1})])]),t("div",vb,[e(k(Is),{"editor-id":"report-preview","model-value":u.result,theme:z.value,class:"md-preview-wrapper"},null,8,["model-value","theme"])])])])]),_:1},8,["loading"])]),_:1},8,["visible"])}}}),gb=ie(fb,[["__scopeId","data-v-00523830"]]),_b="/assets/jpg/mslx-aowu.BKxkpLYR.jpg",hb={class:"construction-container"},yb={class:"content-wrapper"},bb={class:"description"},wb={class:"progress-decoration"},kb={class:"action-area"},$b={width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",style:{"margin-right":"4px"}},xb=se({__name:"HurryUpppppppp",setup(s){const l=x(0),n=x(!1),d=["开发者收到了你的怨念！(╯°□°）╯︵ ┻━┻","正在疯狂敲击键盘中... 🔥","生产队的驴都不敢这么歇！🐴","别催了别催了，头发已经掉光了！👴","再催就把 Bug 变成 Feature！🐛","服务器正在冒烟... 💥","正在与 Bug 进行殊死搏斗！⚔️","不要急，我在试图理解我昨晚写的代码... 🤔","进度条：99%... (卡住了) 🚫","键盘冒火星子了！灭火器准备！🧯","新建文件夹 (2) - 最终版 - 绝对不改版.zip 📁","404 Developer Not Found 🤖","已读不回 (假的，正在改) 📱","正在向虚空终端请求算力... 🧠","画饼中，请稍后... 🥞","再催我就去提瓦特大陆摸鱼了！🎣","纳西妲说她想吃枣椰蜜糖，没空写代码！🍬","正在虚空终端检索：《如何 1 秒写完代码》... 🧠","知识与你分享，但 Bug 不行！📖","再催？再催就把你关进净善宫陪我一起加班！🏰","陷入了改 Bug 的花神诞祭轮回... 第168次尝试... 🔄","别急，代码还在梦境里生长呢 💤","所有的代码，皆是智慧的结晶（大概）✨","我要去上个厕所，把写不完的焦虑通通冲走！🚽","兰那罗说这行代码它不想修，它想去唱歌 🎶","或许... 我们可以用罐装知识把功能直接灌进去？🤔","这虽然是痛痛，但也是成长的过程... (指修Bug) 🩹"],i=ee(()=>l.value===0?"这里正在进行一项神秘的大工程...":l.value<5?"工期正在加急！":l.value<10?"好痛！别点啦！":"呜呜呜，错啦，这就去写代码！😭"),u=()=>{l.value++,n.value=!0,setTimeout(()=>{n.value=!1},500);let f=d[Math.floor(Math.random()*d.length)];l.value>20?(f="键盘已经被敲烂了！求放过！🆘",B.error(f)):B.success(f)};return(f,r)=>{const c=m("t-progress"),_=m("t-button");return o(),C("div",hb,[t("div",yb,[t("div",{class:ke(["image-box",{"shake-anim":n.value}])},[...r[0]||(r[0]=[t("img",{src:_b,alt:"施工中",class:"mascot-img"},null,-1),t("div",{class:"halo"},null,-1)])],2),r[2]||(r[2]=t("h1",{class:"main-title"},"嗷呜！Ｏ(≧口≦)Ｏ",-1)),t("p",bb,I(i.value),1),t("div",wb,[e(c,{theme:"plump",percentage:30+l.value%70,label:!1,status:"active"},null,8,["percentage"])]),t("div",kb,[e(_,{theme:"primary",size:"large",shape:"round",variant:"base",class:"urge-btn",onClick:u},{icon:a(()=>[(o(),C("svg",$b,[...r[1]||(r[1]=[t("path",{d:"M8.5 1L2 9h5v6l6.5-8h-5V1z"},null,-1)])]))]),default:a(()=>[v(" 催更 ("+I(l.value)+") ",1)]),_:1})])])])}}}),ra=ie(xb,[["__scopeId","data-v-d8b4c962"]]),Ab={class:"panel-content"},Cb={class:"toolbar"},Sb={class:"custom-item-layout"},Ib={class:"player-info"},Vb={class:"name"},Mb={class:"player-actions"},Lb={key:1,class:"empty-state"},Ub={class:"panel-content empty-state"},Bb={class:"panel-content empty-state"},zb={class:"panel-content empty-state"},Pb=se({__name:"PlayerManagerDialog",props:{visible:{type:Boolean},serverId:{},isRunning:{type:Boolean}},emits:["update:visible"],setup(s,{emit:l}){const n=Ze(),d=s,i=l,u=la(),f=x("online"),r=x([]),c=x(!1);we(()=>d.visible,async $=>{n.name==="InstanceConsole"&&$&&d.isRunning&&await _()});const _=async()=>{if(d.isRunning){c.value=!0;try{r.value=await Ys(d.serverId)}catch($){B.error(`获取列表失败: ${$.message}`)}finally{c.value=!1}}},y=async($,V)=>{if(!d.isRunning){B.warning("实例未运行");return}try{await u.sendCommand($),B.success(V)}catch(h){B.error(`执行失败: ${h.message}`)}},M=()=>{i("update:visible",!1)};return($,V)=>{const h=m("t-button"),g=m("t-avatar"),z=m("t-space"),U=m("t-list-item"),p=m("t-list"),S=m("t-tab-panel"),b=m("t-tabs"),R=m("t-dialog");return o(),O(R,{attach:"body",visible:s.visible,header:"玩家管理",width:"min(800px, 95vw)",placement:"center",footer:!1,onClose:M},{default:a(()=>[e(b,{modelValue:f.value,"onUpdate:modelValue":V[0]||(V[0]=T=>f.value=T),theme:"card"},{default:a(()=>[e(S,{value:"online",label:"在线玩家"},{label:a(()=>[e(k(Ts),{style:{"margin-right":"4px"}}),V[1]||(V[1]=v(" 在线玩家",-1))]),default:a(()=>[t("div",Ab,[t("div",Cb,[e(h,{theme:"primary",variant:"outline",disabled:!s.isRunning,loading:c.value,onClick:_},{default:a(()=>[...V[2]||(V[2]=[v("刷新列表",-1)])]),_:1},8,["disabled","loading"])]),r.value.length>0?(o(),O(p,{key:0,split:!0,class:"player-list"},{default:a(()=>[(o(!0),C(de,null,ye(r.value,T=>(o(),O(U,{key:T,class:"custom-list-item"},{default:a(()=>[t("div",Sb,[t("div",Ib,[e(g,{shape:"round",image:`https://minotar.net/helm/${T}/32.png`},null,8,["image"]),t("span",Vb,I(T),1)]),t("div",Mb,[e(z,{class:"action-space","break-line":""},{default:a(()=>[e(h,{size:"small",variant:"text",theme:"primary",onClick:P=>y(`op ${T}`,`已提升 ${T} 为管理员`)},{default:a(()=>[...V[3]||(V[3]=[v("设为 OP",-1)])]),_:1},8,["onClick"]),e(h,{size:"small",variant:"text",theme:"warning",onClick:P=>y(`deop ${T}`,`已撤销 ${T} 的管理员`)},{default:a(()=>[...V[4]||(V[4]=[v("撤销 OP",-1)])]),_:1},8,["onClick"]),e(h,{size:"small",variant:"text",theme:"danger",onClick:P=>y(`kick ${T} 被管理员踢出`,`已踢出 ${T}`)},{default:a(()=>[...V[5]||(V[5]=[v("踢出",-1)])]),_:1},8,["onClick"]),e(h,{size:"small",variant:"text",theme:"danger",onClick:P=>y(`ban ${T} 已被服务器管理员封禁`,`已封禁 ${T}`)},{default:a(()=>[...V[6]||(V[6]=[v("封禁",-1)])]),_:1},8,["onClick"])]),_:2},1024)])])]),_:2},1024))),128))]),_:1})):(o(),C("div",Lb,[e(k(Dl),{size:"48px",style:{color:"var(--td-text-color-placeholder)","margin-bottom":"12px"}}),t("p",null,I(s.isRunning?"当前没有玩家在线":"服务器未运行"),1)]))])]),_:1}),e(S,{value:"ops",label:"管理员 (OP)"},{label:a(()=>[e(k(Bs),{style:{"margin-right":"4px"}}),V[7]||(V[7]=v(" 管理员",-1))]),default:a(()=>[t("div",Ub,[e(ra)])]),_:1}),e(S,{value:"banned",label:"黑名单"},{label:a(()=>[e(k(_a),{style:{"margin-right":"4px"}}),V[8]||(V[8]=v(" 黑名单",-1))]),default:a(()=>[t("div",Bb,[e(ra)])]),_:1}),e(S,{value:"whitelist",label:"白名单"},{label:a(()=>[e(k(Fs),{style:{"margin-right":"4px"}}),V[9]||(V[9]=v(" 白名单",-1))]),default:a(()=>[t("div",zb,[e(ra)])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["visible"])}}}),Rb=ie(Pb,[["__scopeId","data-v-8486db12"]]),Eb={class:"header-row"},Tb={class:"title"},Fb={key:0,class:"count"},Db={class:"content-area"},Ob=["src"],jb={key:1,class:"empty-text"},Kb={key:1,class:"empty-text"},Nb=se({__name:"PlayerListCard",props:{serverId:{},status:{}},setup(s){const l=s,n=la(),d=x([]),i=x(!1);let u=null,f=null,r=null;const c=[{content:"设为管理员",value:"op"},{content:"取消管理员",value:"deop"},{content:"踢出服务器",value:"kick",theme:"warning"},{content:"封禁玩家",value:"ban",theme:"error"},{content:"加入白名单",value:"whitelist add"}],_=async()=>{if(l.status!==2){d.value=[];return}try{d.value=await Ys(l.serverId)}catch(V){console.error("拉取在线玩家失败:",V)}},y=()=>{u=n.onPlayerJoined?.(V=>{d.value.includes(V)||d.value.push(V)}),f=n.onPlayerLeft?.(V=>{d.value=d.value.filter(h=>h!==V)}),r=n.onPlayerListCleared?.(()=>{d.value=[]})},M=()=>{u?.(),f?.(),r?.()};we(()=>l.status,V=>{V===2?_():d.value=[]}),we(()=>l.serverId,()=>{_()}),Ce(()=>{_(),y()}),Qe(()=>{M()});const $=async(V,h)=>{const g=V.value,U=`${g} ${h}${g==="kick"||g==="ban"?g==="kick"?" 您被控制台踢出了服务器":"您被控制台封禁了":""}`;try{switch(await n.sendCommand(U),g){case"kick":B.success(`已将 ${h} 踢出服务器`);break;case"ban":B.success(`已将 ${h} 封禁`);break;case"op":B.success(`已将 ${h} 设置为服务器管理员`);break;case"deop":B.success(`已取消 ${h} 为服务器管理员`);break;case"whitelist add":B.success(`已将 ${h} 添加到白名单`);break;default:B.success(`针对 ${h} 的指令已发送`);break}}catch(p){B.error(`执行失败: ${p.message}`)}};return(V,h)=>{const g=m("t-button"),z=m("t-tag"),U=m("t-dropdown"),p=m("t-space"),S=m("t-card");return o(),O(S,{bordered:!1,class:"player-list-card"},{default:a(()=>[t("div",Eb,[t("div",Tb,[e(k(Fs)),h[2]||(h[2]=v(" 在线玩家 ",-1)),s.status===2?(o(),C("span",Fb,"("+I(d.value.length)+")",1)):K("",!0)]),e(g,{size:"small",variant:"text",theme:"primary",onClick:h[0]||(h[0]=b=>i.value=!0),disabled:s.status===0},{icon:a(()=>[e(k(ha))]),default:a(()=>[h[3]||(h[3]=v("管理 ",-1))]),_:1},8,["disabled"])]),t("div",Db,[s.status===2?(o(),C(de,{key:0},[d.value.length>0?(o(),O(p,{key:0,"break-line":"",size:"small"},{default:a(()=>[(o(!0),C(de,null,ye(d.value,b=>(o(),O(U,{key:b,options:c,trigger:"click",placement:"bottom-left",onClick:R=>$(R,b)},{default:a(()=>[e(z,{class:"player-tag",variant:"light",hoverable:""},{icon:a(()=>[t("img",{src:`https://minotar.net/helm/${b}/16.png`,class:"player-avatar"},null,8,Ob)]),default:a(()=>[v(" "+I(b),1)]),_:2},1024)]),_:2},1032,["options","onClick"]))),128))]),_:1})):(o(),C("div",jb,"当前无人在线"))],64)):(o(),C("div",Kb,"服务器未运行"))]),e(Rb,{visible:i.value,"onUpdate:visible":h[1]||(h[1]=b=>i.value=b),"server-id":s.serverId,"is-running":s.status===2},null,8,["visible","server-id","is-running"])]),_:1})}}}),qb=ie(Nb,[["__scopeId","data-v-f34c42eb"]]),Gb={class:"sidebar-content"},Hb={class:"control-header"},Jb={class:"control-actions"},Wb={key:0,class:"running-action-group"},Xb={class:"action-row"},Qb={class:"card-content-area"},Yb={key:0,class:"info-list"},Zb={class:"info-item"},e0={class:"label"},t0={class:"value"},a0={class:"info-item"},s0={class:"label"},l0={class:"value"},n0={class:"info-item"},o0={class:"label"},i0={class:"value"},r0={class:"info-item"},u0={class:"label"},d0={class:"value"},c0={class:"info-item"},m0={class:"label"},p0={class:"value"},v0={class:"info-item"},f0={class:"label"},g0={class:"value"},_0={class:"info-item"},h0={class:"label"},y0={class:"value"},b0={key:1,class:"info-item"},w0={class:"label"},k0={class:"info-item"},$0={class:"label"},x0={class:"value"},A0={key:1,class:"monitor-view"},C0={key:1,class:"monitor-placeholder"},S0=se({__name:"ServerControlPanel",props:{serverId:{},status:{},loading:{type:Boolean},serverInfo:{}},emits:["start","stop","clear-log","refresh-info","backup","force-exit","restart"],setup(s,{emit:l}){const n=s,d=l,i=ee(()=>{switch(n.status){case 1:return{text:"Starting",label:"启动中",theme:"primary",pulse:!0};case 2:return{text:"Running",label:"运行中",theme:"success",pulse:!0};case 3:return{text:"Stopping",label:"停止中",theme:"warning",pulse:!0};case 4:return{text:"Restarting",label:"重启中",theme:"primary",pulse:!0};default:return{text:"Stopped",label:"已停止",theme:"default",pulse:!1}}}),u=x(!1),f=x(null),r=x("info"),c=()=>{f.value?.open()},_=()=>{d("refresh-info")},y=x(0);let M=null;const $=h=>{if(!h)return 0;const g=h.match(/^(?:(\d+)\.)?(\d{1,2}):(\d{2}):(\d{2})(?:\.\d+)?$/);return g?parseInt(g[1]||"0",10)*86400+parseInt(g[2])*3600+parseInt(g[3])*60+parseInt(g[4]):0},V=ee(()=>{if(y.value<=0)return"00:00:00";const h=Math.floor(y.value/86400),g=new Date(y.value*1e3).toISOString().substr(11,8);return h>0?`${h}天 ${g}`:g});return we(()=>n.serverInfo?.uptime,h=>h&&(y.value=$(h)),{immediate:!0}),we(()=>n.status,h=>{h===2?M||(M=window.setInterval(()=>y.value++,1e3)):M&&(clearInterval(M),M=null)},{immediate:!0}),Qe(()=>{M&&clearInterval(M)}),(h,g)=>{const z=m("t-tag"),U=m("t-button"),p=m("t-popconfirm"),S=m("t-dropdown-item"),b=m("t-dropdown-menu"),R=m("t-dropdown"),T=m("t-card"),P=m("t-radio-button"),G=m("t-radio-group");return o(),C("div",Gb,[e(T,{bordered:!1,class:"control-card"},{default:a(()=>[t("div",Hb,[t("div",{class:ke(["status-indicator",i.value.theme])},[g[10]||(g[10]=t("span",{class:"pulse"},null,-1)),v(I(i.value.text),1)],2),e(z,{theme:i.value.theme,variant:"light",shape:"round"},{default:a(()=>[v(I(i.value.label),1)]),_:1},8,["theme"])]),t("div",Jb,[s.status===0?(o(),O(U,{key:0,theme:"primary",size:"large",block:"",loading:s.loading,onClick:g[0]||(g[0]=N=>{h.$emit("clear-log"),h.$emit("start")})},{icon:a(()=>[e(k(Ft))]),default:a(()=>[g[11]||(g[11]=v("启动实例 ",-1))]),_:1},8,["loading"])):(o(),C(de,{key:1},[s.status===2&&!s.loading?(o(),C("div",Wb,[e(p,{content:"确定要停止该实例吗？",onConfirm:g[1]||(g[1]=N=>h.$emit("stop"))},{default:a(()=>[e(U,{class:"stop-btn",theme:"danger",size:"large"},{icon:a(()=>[e(k(va))]),default:a(()=>[g[12]||(g[12]=v(" 停止 ",-1))]),_:1})]),_:1}),e(p,{content:"确定要重启该实例吗？",onConfirm:g[2]||(g[2]=N=>h.$emit("restart"))},{default:a(()=>[e(U,{theme:"warning",size:"large",shape:"square"},{icon:a(()=>[e(k(st))]),_:1})]),_:1})])):K("",!0),s.status===3||s.status===4||s.loading?(o(),O(p,{key:1,content:"确定要强制结束吗？可能会导致数据丢失！",onConfirm:g[3]||(g[3]=N=>h.$emit("force-exit"))},{default:a(()=>[e(U,{class:"force-kill-btn glass-btn",theme:s.loading?"primary":"danger",variant:"outline",block:"",loading:s.loading},{icon:a(()=>[s.loading?K("",!0):(o(),O(k(_a),{key:0}))]),default:a(()=>[v(" "+I(s.loading?"正在处理...":"强制结束"),1)]),_:1},8,["theme","loading"])]),_:1})):K("",!0)],64)),t("div",Xb,[e(U,{class:"glass-btn",variant:"outline",block:"",onClick:g[4]||(g[4]=N=>k(Ie)(`/instance/files/${s.serverId}`))},{icon:a(()=>[e(k(Rt))]),default:a(()=>[g[13]||(g[13]=v("文件管理 ",-1))]),_:1}),e(U,{class:"glass-btn",variant:"outline",block:"",onClick:c},{icon:a(()=>[e(k(ha))]),default:a(()=>[g[14]||(g[14]=v("实例设置 ",-1))]),_:1})]),e(R,{trigger:"click","min-column-width":120,placement:"bottom"},{default:a(()=>[e(U,{theme:"primary",class:"glass-btn",variant:"outline",block:""},{icon:a(()=>[e(k(Ds))]),default:a(()=>[g[15]||(g[15]=v("更多功能 ",-1))]),_:1}),e(b,null,{default:a(()=>[e(S,{onClick:g[5]||(g[5]=N=>h.$emit("clear-log"))},{"prefix-icon":a(()=>[e(k(st))]),default:a(()=>[g[16]||(g[16]=v(" 清空日志 ",-1))]),_:1}),e(S,{disabled:s.status!==2||s.loading,onClick:g[6]||(g[6]=N=>h.$emit("backup"))},{"prefix-icon":a(()=>[e(k(Vt))]),default:a(()=>[g[17]||(g[17]=v(" 立即备份 ",-1))]),_:1},8,["disabled"]),e(S,{onClick:g[7]||(g[7]=N=>u.value=!0)},{"prefix-icon":a(()=>[e(k(Ol))]),default:a(()=>[g[18]||(g[18]=v(" 日志分析 ",-1))]),_:1})]),_:1})]),_:1})])]),_:1}),e(T,{bordered:!1,title:"实例概览",class:"info-card"},{actions:a(()=>[e(G,{modelValue:r.value,"onUpdate:modelValue":g[8]||(g[8]=N=>r.value=N),variant:"default-filled",size:"small"},{default:a(()=>[e(P,{value:"info"},{default:a(()=>[e(k(Hl)),g[19]||(g[19]=v(" 详情",-1))]),_:1}),e(P,{value:"monitor"},{default:a(()=>[e(k(Jl)),g[20]||(g[20]=v(" 监控",-1))]),_:1})]),_:1},8,["modelValue"])]),default:a(()=>[t("div",Qb,[r.value==="info"?(o(),C("div",Yb,[t("div",Zb,[t("div",e0,[e(k(jl)),g[21]||(g[21]=v(" 实例名称",-1))]),t("div",t0,I(s.serverInfo?.name),1)]),s.serverInfo?.java!=="none"?(o(),C(de,{key:0},[t("div",a0,[t("div",s0,[e(k(Ua)),g[22]||(g[22]=v(" 内存限制",-1))]),t("div",l0,I(s.serverInfo?.maxM)+" MB",1)]),g[28]||(g[28]=t("div",{class:"proxy-group"},null,-1)),t("div",n0,[t("div",o0,[e(k(Kl)),g[23]||(g[23]=v(" 运行端口",-1))]),t("div",i0,I(s.serverInfo?.mcConfig?.serverPort),1)]),t("div",r0,[t("div",u0,[e(k(Nl)),g[24]||(g[24]=v(" 游戏难度",-1))]),t("div",d0,[e(z,{theme:"primary"},{default:a(()=>[v(I(s.serverInfo?.mcConfig?.difficulty),1)]),_:1})])]),t("div",c0,[t("div",m0,[e(k(ql)),g[25]||(g[25]=v(" 游戏模式",-1))]),t("div",p0,[e(z,null,{default:a(()=>[v(I(s.serverInfo?.mcConfig?.gamemode),1)]),_:1})])]),t("div",v0,[t("div",f0,[e(k(Rt)),g[26]||(g[26]=v(" 游戏地图",-1))]),t("div",g0,I(s.serverInfo?.mcConfig?.levelName),1)]),t("div",_0,[t("div",h0,[e(k(Gl)),g[27]||(g[27]=v(" 正版验证",-1))]),t("div",y0,[e(z,{theme:s.serverInfo?.mcConfig?.onlineMode==="true"?"success":"warning"},{default:a(()=>[v(I(s.serverInfo?.mcConfig?.onlineMode==="true"?"开启":"关闭"),1)]),_:1},8,["theme"])])])],64)):(o(),C("div",b0,[t("div",w0,[e(k(Ua)),g[29]||(g[29]=v(" 模式",-1))]),g[30]||(g[30]=t("div",{class:"value"},"自定义模式",-1))])),g[32]||(g[32]=t("div",{class:"proxy-group"},null,-1)),t("div",k0,[t("div",$0,[e(k(pt)),g[31]||(g[31]=v(" 运行时长",-1))]),t("div",x0,I(s.status===2?V.value:"--:--:--"),1)])])):r.value==="monitor"?(o(),C("div",A0,[s.serverInfo&&s.status!==0?(o(),O(Yy,{key:0,"server-id":s.serverId,"is-running":s.status===2,"max-memory":s.serverInfo.java==="none"?0:s.serverInfo.maxM||4096},null,8,["server-id","is-running","max-memory"])):(o(),C("div",C0,"实例未运行"))])):K("",!0)])]),_:1}),e(qb,{"server-id":s.serverId,status:s.status},null,8,["server-id","status"]),e(Ey,{ref_key:"settingsRef",ref:f,"server-id":s.serverId,onSuccess:_},null,8,["server-id"]),e(gb,{visible:u.value,"onUpdate:visible":g[9]||(g[9]=N=>u.value=N),"server-id":s.serverId},null,8,["visible","server-id"])])}}}),I0=ie(S0,[["__scopeId","data-v-0b095d37"]]),V0={class:"console-page"},M0={class:"layout-container"},L0={class:"main-terminal-area"},U0={class:"sidebar-area"},B0={style:{"line-height":"1.6"}},z0={style:{"margin-bottom":"12px"}},P0=se({__name:"index",setup(s){const l=Ze(),n=sa(),d=la(),i=x(parseInt(l.params.serverId)||0),u=x(0),f=x(!1),r=x(null),c=x(null);async function _(){if(i.value)try{f.value=!0;const S=await Qs(i.value);await n.refreshInstanceList(),u.value=S.status,r.value=S,f.value=!1}catch(S){c.value?.writeln(`\x1B[1;31m[Error] 获取实例信息失败: ${S.message}\x1B[0m`),f.value=!1}}const y=async()=>{f.value=!0;try{c.value?.writeln("\x1B[1;32m[System] 正在发送启动指令...\x1B[0m"),await Lt(i.value,"start"),B.success("实例启动指令已发送"),f.value=!1}catch(S){c.value?.writeln(`\x1B[1;31m[Error] 启动失败: ${S.message}\x1B[0m`),f.value=!1,u.value=0}},M=async()=>{f.value=!0,u.value=3;try{c.value?.writeln("\x1B[1;32m[System] 正在发送停止指令...\x1B[0m"),await Lt(i.value,"stop"),B.warning("实例停止指令已发送"),f.value=!1,n.refreshInstanceList()}catch(S){c.value?.writeln(`\x1B[1;31m[Error] 停止失败: ${S.message}\x1B[0m`),f.value=!1}},$=async()=>{f.value=!0,u.value=3;try{c.value?.writeln("\x1B[1;32m[System] 正在发送强制退出指令...\x1B[0m"),await Lt(i.value,"forceExit"),B.warning("强制退出指令已发送"),f.value=!1}catch(S){c.value?.writeln(`\x1B[1;31m[Error] 强制退出失败: ${S.message}\x1B[0m`),f.value=!1}},V=async()=>{f.value=!0,u.value=4;try{c.value?.writeln("\x1B[1;32m[System] 正在发送重启指令...\x1B[0m"),await Lt(i.value,"restart"),B.warning("重启执行成功"),f.value=!1,u.value=2}catch(S){c.value?.writeln(`\x1B[1;31m[Error] 重启失败: ${S.message}\x1B[0m`),f.value=!1}},h=async()=>{try{c.value?.writeln("\x1B[1;32m[System] 正在发送备份任务...\x1B[0m"),await Lt(i.value,"backup"),B.success("备份任务启动中···"),f.value=!1}catch(S){c.value?.writeln(`\x1B[1;31m[Error] 备份任务启动失败: ${S.message}\x1B[0m`)}},g=()=>{c.value?.clear()},z=x(!1),U=async()=>{i.value&&(d.onEula(()=>{z.value=!0}),await d.connect(i.value))},p=async S=>{try{z.value=!1,await Lt(i.value,`agreeEula?${S}`),B.success(S?"已发送同意请求":"已发送请求")}catch(b){B.error(b.message||"发送失败")}};return we(()=>l.params.serverId,async S=>{l.name==="InstanceConsole"&&S&&(i.value=parseInt(S),await _())}),Ce(async()=>{i.value&&(await _(),await U())}),(S,b)=>{const R=m("t-link"),T=m("t-dialog");return o(),C("div",V0,[t("div",M0,[t("div",L0,[e(vg,{ref_key:"terminalRef",ref:c,"server-id":i.value,onUpdate:b[0]||(b[0]=P=>_())},null,8,["server-id"])]),t("div",U0,[e(I0,{"server-id":i.value,status:u.value,loading:f.value,"server-info":r.value,onStart:y,onStop:M,onBackup:h,onClearLog:g,onForceExit:$,onRestart:V},null,8,["server-id","status","loading","server-info"])])]),e(T,{visible:z.value,"onUpdate:visible":b[1]||(b[1]=P=>z.value=P),header:"是否同意EULA","confirm-btn":{content:"同意",theme:"primary"},"cancel-btn":{content:"不同意",theme:"default"},onConfirm:b[2]||(b[2]=P=>p(!0)),onCancel:b[3]||(b[3]=P=>p(!1))},{default:a(()=>[t("div",B0,[t("p",z0,[b[5]||(b[5]=v(" 开启Minecraft服务器需要您同意 ",-1)),b[6]||(b[6]=t("strong",null,"EULA",-1)),b[7]||(b[7]=v(" ！",-1)),e(R,{theme:"primary",underline:""},{default:a(()=>[...b[4]||(b[4]=[v(" (https://aka.ms/minecrafteula)",-1)])]),_:1})]),b[8]||(b[8]=t("p",{style:{"margin-bottom":"12px"}},[t("strong",{style:{color:"#e34d59"}},"请您务必认真仔细阅读！")],-1)),b[9]||(b[9]=t("p",{style:{"margin-bottom":"12px"}},[t("strong",null,"注意："),v("不论您选择是或否，服务器都会在您操作后继续运行。")],-1)),b[10]||(b[10]=t("p",{style:{"margin-bottom":"12px",color:"#f59a23"}},[v(" ⚠️ 如果您"),t("strong",null,"未同意 EULA"),v("，服务器可能会在运行时自动关闭！ ")],-1)),b[11]||(b[11]=t("p",{style:{"margin-top":"16px"}},[v("💡 提示：如要在每次启动实例时忽略此提示，请在"),t("strong",null,"设置"),v("里进行配置。")],-1))])]),_:1},8,["visible"])])}}}),R0=ie(P0,[["__scopeId","data-v-e85241cf"]]),E0=Object.freeze(Object.defineProperty({__proto__:null,default:R0},Symbol.toStringTag,{value:"Module"})),T0={class:"image-wrapper"},F0=["src","alt"],D0={key:1,class:"loading-placeholder"},O0=se({__name:"ImagePreview",props:{visible:{type:Boolean},fileName:{},imageBlobUrl:{}},emits:["update:visible"],setup(s,{emit:l}){const n=l,d=()=>{n("update:visible",!1)};return(i,u)=>{const f=m("t-dialog");return o(),O(f,{visible:s.visible,header:s.fileName,footer:!1,width:"auto",top:"10vh",class:"image-preview-dialog",onClose:d},{default:a(()=>[t("div",T0,[s.imageBlobUrl?(o(),C("img",{key:0,src:s.imageBlobUrl,alt:s.fileName},null,8,F0)):(o(),C("div",D0,"加载中..."))])]),_:1},8,["visible","header"])}}}),j0=ie(O0,[["__scopeId","data-v-9d5acf17"]]),K0={key:0,class:"compress-form"},N0={class:"file-list-preview"},q0={class:"actions"},G0={key:1,class:"progress-view"},H0={class:"status-icon"},J0={class:"status-text"},W0=se({__name:"FileCompressor",props:{visible:{type:Boolean},instanceId:{},currentPath:{},files:{}},emits:["update:visible","success"],setup(s,{emit:l}){const n=s,d=l,i=x(""),u=x("idle"),f=x(0),r=x("");let c=null;we(()=>n.visible,V=>{V?(u.value="idle",f.value=0,r.value="",n.files.length>0&&(i.value=`${n.files[0]}_packed.zip`)):_()});const _=()=>{c&&(clearInterval(c),c=null)},y=async()=>{if(!i.value.trim()){B.warning("请输入压缩包名称");return}let V=i.value;V.endsWith(".zip")||(V+=".zip"),u.value="processing",f.value=0,r.value="正在提交任务...";try{const g=(await Go(n.instanceId,n.files,V,n.currentPath)).taskId;if(g)M(g);else throw new Error("未获取到任务ID")}catch(h){u.value="error",r.value=h.message||"提交失败"}},M=V=>{c=window.setInterval(async()=>{try{const h=await Ho(V);f.value=h.progress,r.value=h.message,h.status==="success"?(_(),u.value="success",f.value=100,setTimeout(()=>{d("success"),d("update:visible",!1)},1e3)):h.status==="error"&&(_(),u.value="error")}catch(h){console.error(h)}},1e3)},$=()=>{u.value==="processing"&&B.warning("后台任务仍在进行中，关闭窗口不会取消任务"),_(),d("update:visible",!1)};return Qe(()=>_()),(V,h)=>{const g=m("t-input"),z=m("t-button"),U=m("t-loading"),p=m("t-progress"),S=m("t-dialog");return o(),O(S,{visible:s.visible,header:u.value==="idle"?"创建压缩包":"正在压缩",footer:!1,"close-on-overlay-click":!1,width:"480px",onClose:$},{default:a(()=>[u.value==="idle"?(o(),C("div",K0,[t("div",N0,[h[1]||(h[1]=v(" 即将压缩 ",-1)),t("span",null,I(s.files.length),1),h[2]||(h[2]=v(" 个文件/文件夹 ",-1))]),e(g,{modelValue:i.value,"onUpdate:modelValue":h[0]||(h[0]=b=>i.value=b),placeholder:"请输入文件名",suffix:".zip",autofocus:"",onEnter:y},null,8,["modelValue"]),t("div",q0,[e(z,{theme:"default",variant:"text",onClick:$},{default:a(()=>[...h[3]||(h[3]=[v("取消",-1)])]),_:1}),e(z,{theme:"primary",onClick:y},{default:a(()=>[...h[4]||(h[4]=[v("开始压缩",-1)])]),_:1})])])):(o(),C("div",G0,[t("div",H0,[u.value==="processing"?(o(),O(U,{key:0})):u.value==="success"?(o(),O(k(ga),{key:1,style:{color:"var(--td-success-color)","font-size":"40px"}})):u.value==="error"?(o(),O(k(Os),{key:2,style:{color:"var(--td-error-color)","font-size":"40px"}})):K("",!0)]),t("div",J0,I(r.value),1),e(p,{theme:"plump",percentage:f.value,status:u.value==="error"?"error":u.value==="success"?"success":"active"},null,8,["percentage","status"])]))]),_:1},8,["visible","header"])}}}),X0=ie(W0,[["__scopeId","data-v-da286579"]]),Q0={class:"decompress-container"},Y0={class:"file-info"},Z0={class:"value"},e2={key:0,class:"form-item"},t2={key:1,class:"switch-row"},a2={key:2,class:"progress-area"},s2={class:"status-header"},l2={class:"status-text"},n2={class:"status-percent"},o2={key:3,class:"actions"},i2=se({__name:"FileDecompress",props:{visible:{type:Boolean},instanceId:{},currentPath:{},fileName:{}},emits:["update:visible","success"],setup(s,{emit:l}){const n=s,d=l,i=ee({get:()=>n.visible,set:p=>d("update:visible",p)}),u=x("auto"),f=x(!0),r=x(!1),c=x(0),_=x(""),y=x("");let M=null;const $=[{label:"自动检测 (推荐)",value:"auto"},{label:"UTF-8 (Linux/Mac通用)",value:"utf-8"},{label:"GBK (Windows传统)",value:"gbk"}],V=()=>{u.value="auto",f.value=!0,r.value=!1,c.value=0,_.value="",y.value="",M&&(clearInterval(M),M=null)};we(()=>n.visible,p=>{p&&V()});const h=()=>{M&&(clearInterval(M),M=null)},g=async()=>{if(!r.value)try{r.value=!0,_.value="正在提交任务...";const p=await Jo(n.instanceId,n.fileName,n.currentPath,u.value,f.value);if(p&&p.taskId)y.value=p.taskId,M=window.setInterval(z,1e3);else throw new Error("未能获取任务ID")}catch(p){B.error(p.message||"提交失败"),r.value=!1}},z=async()=>{if(y.value)try{const p=await Wo(y.value);c.value=p.progress||0,_.value=p.message,p.status==="success"?(h(),B.success("解压成功"),c.value=100,setTimeout(()=>{i.value=!1,d("success")},800)):p.status==="error"&&(h(),r.value=!1,B.error(p.message||"解压出错"))}catch(p){console.error("轮询失败",p)}},U=()=>{r.value&&c.value<100&&B.warning("解压正在后台进行中"),h(),i.value=!1};return(p,S)=>{const b=m("t-select"),R=m("t-switch"),T=m("t-progress"),P=m("t-button"),G=m("t-dialog");return o(),O(G,{visible:i.value,"onUpdate:visible":S[2]||(S[2]=N=>i.value=N),header:"解压文件",footer:!1,"close-on-overlay-click":!r.value,"on-close":U,width:"480px"},{default:a(()=>[t("div",Q0,[t("div",Y0,[S[3]||(S[3]=t("span",{class:"label"},"目标文件：",-1)),t("span",Z0,I(s.fileName),1)]),r.value?K("",!0):(o(),C("div",e2,[S[4]||(S[4]=t("span",{class:"label"},"文件名编码",-1)),e(b,{modelValue:u.value,"onUpdate:modelValue":S[0]||(S[0]=N=>u.value=N),options:$},null,8,["modelValue"])])),r.value?K("",!0):(o(),C("div",t2,[S[5]||(S[5]=t("div",{class:"switch-info"},[t("span",{class:"switch-label"},"创建同名文件夹"),t("span",{class:"switch-tip"},"推荐开启，防止文件散乱在当前目录")],-1)),e(R,{modelValue:f.value,"onUpdate:modelValue":S[1]||(S[1]=N=>f.value=N)},null,8,["modelValue"])])),r.value?(o(),C("div",a2,[t("div",s2,[t("span",l2,I(_.value),1),t("span",n2,I(c.value)+"%",1)]),e(T,{theme:"line",percentage:c.value,label:!1,status:c.value===100?"success":"active"},null,8,["percentage","status"])])):K("",!0),r.value?K("",!0):(o(),C("div",o2,[e(P,{variant:"outline",onClick:U},{default:a(()=>[...S[6]||(S[6]=[v("取消",-1)])]),_:1}),e(P,{theme:"primary",onClick:g},{default:a(()=>[...S[7]||(S[7]=[v("开始解压",-1)])]),_:1})]))])]),_:1},8,["visible","close-on-overlay-click"])}}}),r2=ie(i2,[["__scopeId","data-v-9c603684"]]),u2={class:"permission-form"},d2={class:"presets"},c2={class:"preset-list"},m2={key:0,class:"preset-desc"},p2={key:1,class:"preset-desc"},v2={key:2,class:"preset-desc"},f2=se({__name:"FilePermission",props:{visible:{type:Boolean},instanceId:{},currentPath:{},targets:{}},emits:["update:visible","success"],setup(s,{emit:l}){const n=s,d=l,i=x({mode:"755"}),u=x(!1),f=[{label:"755 (推荐: 所有者读写执/他人读执)",value:"755"},{label:"777 (全开: 所有权限)",value:"777"},{label:"644 (普通文件: 读写/读)",value:"644"}],r=ee(()=>n.targets.length===1?`修改权限 - ${n.targets[0].name}`:`批量修改权限 (${n.targets.length} 项)`);we(()=>n.visible,M=>{M&&n.targets.length>0&&(n.targets.length===1&&n.targets[0].mode&&n.targets[0].mode!=="Unknown"?i.value.mode=n.targets[0].mode:i.value.mode="755")});const c=()=>{d("update:visible",!1),u.value=!1},_=async()=>{if(!i.value.mode||!/^[0-7]{3}$/.test(i.value.mode)){B.warning("请输入正确的3位八进制权限码 (如 755)");return}u.value=!0;let M=0,$=0;try{for(const V of n.targets)try{await Xo(y,V.fullPath,i.value.mode),M++}catch(h){$++,console.error(h)}$===0?B.success("权限修改成功"):B.warning(`完成: 成功 ${M} 个, 失败 ${$} 个`),d("success"),c()}catch(V){B.error(V.message||"请求失败")}finally{u.value=!1}},y=n.instanceId;return(M,$)=>{const V=m("t-input"),h=m("t-form-item"),g=m("t-tag"),z=m("t-dialog");return o(),O(z,{visible:s.visible,header:r.value,"confirm-btn":{content:"保存修改",loading:u.value},"on-close":c,"on-confirm":_,width:"480px"},{default:a(()=>[t("div",u2,[e(h,{label:"权限代码","required-mark":""},{default:a(()=>[e(V,{modelValue:i.value.mode,"onUpdate:modelValue":$[0]||($[0]=U=>i.value.mode=U),placeholder:"例如: 755",tips:"请输入3位八进制数字 (Linux Chmod)"},null,8,["modelValue"])]),_:1}),t("div",d2,[$[1]||($[1]=t("div",{class:"preset-label"},"快捷设置：",-1)),t("div",c2,[(o(),C(de,null,ye(f,U=>e(g,{key:U.value,variant:"light-outline",theme:"primary",class:"preset-tag",style:{cursor:"pointer"},onClick:p=>i.value.mode=U.value},{default:a(()=>[v(I(U.value),1)]),_:2},1032,["onClick"])),64))]),i.value.mode==="755"?(o(),C("div",m2,"适合可执行程序、脚本或文件夹")):K("",!0),i.value.mode==="644"?(o(),C("div",p2,"适合普通配置文件、日志等")):K("",!0),i.value.mode==="777"?(o(),C("div",v2,"允许任何人写入 (不安全)")):K("",!0)])])]),_:1},8,["visible","header","confirm-btn"])}}}),g2=ie(f2,[["__scopeId","data-v-6dc7353c"]]),_2={class:"file-manager-wrapper"},h2={class:"toolbar"},y2={class:"breadcrumb-area"},b2={class:"actions-area"},w2={key:0},k2={key:0},$2={key:0},x2={class:"table-wrapper"},A2=["onClick"],C2={class:"name-text"},S2={class:"op-actions"},I2={key:0,class:"selection-bar"},V2={key:0,class:"selection-info"},M2={key:1,class:"selection-info"},L2={class:"selection-actions"},U2={key:0},B2={key:0},z2={key:0},P2={key:0},R2={key:0},E2={key:0},T2={key:1,class:"selection-bar clipboard-bar"},F2={class:"selection-info"},D2={key:0},O2={key:1},j2={class:"selection-actions"},K2=se({__name:"index",setup(s){const l=Ze(),n=Xt(),d=ee(()=>Number(l.params.serverFilesId)),i=Ee(),u=x(!1),f=x([]),r=x(""),c=x([]),_=x(window.innerWidth),y=ee(()=>_.value<768),M=x(!1),$=x(!1),V=x(!1),h=x(!1),g=x(!1),z=x(!1),U=x(!1),p=x(!1),S=x(!1),b=x(""),R=x(""),T=x(""),P=x(!1),G=x(""),N=x(""),E=x(""),w=x(""),A=x(null),L=x([]),H=x(""),J=x([]),X=()=>{_.value=window.innerWidth},q=Z=>{const W=Z.split(".").pop()?.toLowerCase();return["png","jpg","jpeg","gif","ico","webp","bmp","svg"].includes(W||"")},_e=Z=>{const W=Z.split(".").pop()?.toLowerCase();return["zip","jar"].includes(W||"")},De=Z=>{if(Z.type==="folder"){const ve=Z.name.toLowerCase();return ve==="config"||ve==="settings"?{icon:ha,color:"var(--td-warning-color)"}:ve.startsWith("world")||ve==="level"?{icon:Zl,color:"var(--td-success-color)"}:["plugins","mods","libraries"].includes(ve)?{icon:Ht,color:"var(--td-brand-color)"}:["logs","crash-reports","cache","temp"].includes(ve)?{icon:Rt,color:"var(--td-gray-color-6)"}:{icon:Rt,color:"var(--td-brand-color)"}}const W=Z.name.split(".").pop()?.toLowerCase();return["png","jpg","jpeg","gif","ico","webp"].includes(W||"")?{icon:Rs,color:"var(--td-success-color)"}:["jar","zip","rar","7z","tar","gz"].includes(W||"")?{icon:Ia,color:"#722ed1"}:["yml","yaml","json","properties","toml","xml","conf","sh","bat","cmd"].includes(W||"")?{icon:Pt,color:"var(--td-warning-color)"}:["log","txt","md","lock"].includes(W||"")?{icon:Va,color:"var(--td-gray-color-6)"}:{icon:Gt,color:"var(--td-text-color-secondary)"}},fe=ee(()=>f.value.some(Z=>Z.permission&&Z.permission!=="")),Pe=ee(()=>{const Z={colKey:"row-select",type:"multiple",width:y.value?34:40},W={colKey:"name",title:"文件名",ellipsis:!0,width:"auto"},ve={colKey:"operation",title:"操作",width:y.value?50:80,align:"center",fixed:y.value?"right":void 0};return y.value?[Z,W,ve]:[Z,W,{colKey:"size",title:"大小",width:100,align:"right"},...fe.value?[{colKey:"permission",title:"权限",width:80,align:"center"}]:[],{colKey:"lastModified",title:"修改时间",width:180,align:"center"},ve]}),Le=ee(()=>{const Z=r.value.split("/").filter(je=>je),W=[{name:"根目录",path:""}];let ve="";return Z.forEach(je=>{ve=ve?`${ve}/${je}`:je,W.push({name:je,path:ve})}),W}),Ve=ee(()=>c.value.length>0),Be=Z=>{if(Z===0)return"-";const W=["B","KB","MB","GB","TB"];let ve=0;for(;Z>=1024&&ve<W.length-1;)Z/=1024,ve++;return`${Z.toFixed(1)} ${W[ve]}`},Oe=Z=>Z?new Date(Z).toLocaleString():"-",re=async()=>{u.value=!0,c.value=[];try{const Z=await Do(d.value,r.value);f.value=Z||[]}catch(Z){console.error(Z)}finally{u.value=!1}},ce=async Z=>{N.value&&(window.URL.revokeObjectURL(N.value),N.value="");const W=r.value?`${r.value}/${Z}`:Z,ve=B.loading("正在加载图片...");try{const je=await qo(d.value,W);if(!(je instanceof Blob))throw new Error("无效数据");N.value=window.URL.createObjectURL(je),G.value=Z,$.value=!0,B.close(ve)}catch{B.close(ve),B.error("加载失败")}},Ke=async(Z,W=!1)=>{if(W){R.value=Z,T.value="",M.value=!0;return}if(q(Z)){ce(Z);return}const ve=r.value?`${r.value}/${Z}`:Z,je=B.loading("正在读取文件...");try{const lt=await ya(d.value,ve);R.value=Z,T.value=lt,M.value=!0,B.close(je)}catch(lt){B.close(je),B.error("读取失败: "+lt.message)}},le=()=>{E.value="",V.value=!0},F=()=>{if(!E.value.trim()){B.warning("请输入文件名");return}V.value=!1,Ke(E.value,!0)},j=async Z=>{P.value=!0;try{const W=r.value?`${r.value}/${R.value}`:R.value;await Ja(d.value,W,Z),B.success("保存成功"),M.value=!1,he()}catch{B.error("保存失败")}finally{P.value=!1}},ae=()=>{b.value="",S.value=!0},pe=async()=>{if(!b.value.trim()){B.warning("请输入文件夹名称");return}try{await Oo(d.value,r.value,b.value),B.success("文件夹创建成功"),S.value=!1,he()}catch(Z){B.error(`创建失败: ${Z.message||"未知错误"}`)}},te=Z=>{A.value={name:Z.name,fullPath:r.value?`${r.value}/${Z.name}`:Z.name},w.value=Z.name,h.value=!0},D=async()=>{if(!w.value||!A.value)return;const Z=r.value?`${r.value}/${w.value}`:w.value;try{await jo(d.value,A.value.fullPath,Z),B.success("重命名成功"),h.value=!1,he()}catch{B.error("重命名失败")}},ne=Z=>{let W=[];if(Z?W=[Z.name]:W=[...c.value],W.length===0)return;const ve=at.confirm({header:"确认删除",body:`确定要永久删除这 ${W.length} 项吗？`,theme:"danger",onConfirm:async()=>{try{const je=W.map(lt=>r.value?`${r.value}/${lt}`:lt);await Ko(d.value,je),B.success("删除成功"),c.value=[],he(),ve.hide()}catch{B.error("删除失败")}}})},me=Z=>{if(Z.type==="folder"){const W=r.value===""?"":"/";r.value=`${r.value}${W}${Z.name}`}else q(Z.name)?ce(Z.name):Ke(Z.name)},be=Z=>{r.value=Z},he=()=>re(),$e=async Z=>{let W=[];if(Z?W=[Z.name]:W=[...c.value],W.length===0)return;const{baseUrl:ve,token:je}=i,lt=ve.endsWith("/")?ve.slice(0,-1):ve;for(const gt of W){if(f.value.find(ut=>ut.name===gt)?.type==="folder"){B.warning(`暂不支持下载文件夹: ${gt} 请压缩后再下载！`);continue}const He=r.value?`${r.value}/${gt}`:gt;try{const ut=new URL(`${lt||window.location.origin}/api/files/instance/${d.value}/download`);ut.searchParams.append("path",He),ut.searchParams.append("x-user-token",je);const _t=document.createElement("a");_t.href=ut.toString(),_t.style.display="none",_t.download=gt,document.body.appendChild(_t),_t.click(),document.body.removeChild(_t)}catch(ut){console.error(ut),B.error(`创建下载链接失败: ${gt}`)}}Z||(c.value=[])},Ue=()=>{c.value.length!==0&&(L.value=[...c.value],z.value=!0)},Me=()=>{c.value=[],he()},Se=Z=>{H.value=Z.name,U.value=!0},Ge=()=>{he()},Ye=Z=>{if(J.value=[],Z)J.value.push({name:Z.name,fullPath:r.value?`${r.value}/${Z.name}`:Z.name,mode:Z.permission||"755"});else{if(c.value.length===0)return;c.value.forEach(W=>{const ve=f.value.find(je=>je.name===W);ve&&J.value.push({name:ve.name,fullPath:r.value?`${r.value}/${ve.name}`:ve.name,mode:ve.permission||"755"})})}p.value=!0},Te=()=>{c.value=[],he()},Y=()=>he(),xe=x([]),Ne=x("copy"),qe=x(""),Fe=ee(()=>xe.value.length>0),Re=ee(()=>r.value===qe.value),et=()=>{if(c.value.length===0)return;const Z=c.value.map(W=>r.value?`${r.value}/${W}`:W);xe.value=Z,Ne.value="copy",qe.value=r.value,c.value=[],B.info(`已复制 ${Z.length} 项，请前往目标目录粘贴`)},ge=()=>{if(c.value.length===0)return;const Z=c.value.map(W=>r.value?`${r.value}/${W}`:W);xe.value=Z,Ne.value="move",qe.value=r.value,c.value=[],B.info(`已剪切 ${Z.length} 项，请前往目标目录粘贴`)},vt=()=>{xe.value=[],qe.value="",B.info("已取消操作")},ft=async()=>{if(xe.value.length===0)return;const Z=B.loading("正在粘贴中...");try{Ne.value==="copy"?await Yo(d.value,xe.value,r.value):await Zo(d.value,xe.value,r.value),B.success("粘贴成功"),xe.value=[],he()}catch(W){B.error(`粘贴失败: ${W.message||"未知错误"}`)}finally{B.close(Z)}},nt=x(""),xt=x("name"),xa=[{label:"名称 (A-Z)",value:"name"},{label:"时间 (最新)",value:"time"},{label:"大小 (从大到小)",value:"size"}],Ae=ee(()=>{let Z=[...f.value];if(nt.value){const W=nt.value.toLowerCase();Z=Z.filter(ve=>ve.name.toLowerCase().includes(W))}return Z.sort((W,ve)=>{if(W.type==="folder"&&ve.type!=="folder")return-1;if(W.type!=="folder"&&ve.type==="folder")return 1;switch(xt.value){case"name":return W.name.localeCompare(ve.name,"zh-CN",{numeric:!0});case"time":return new Date(ve.lastModified).getTime()-new Date(W.lastModified).getTime();case"size":return ve.size-W.size;default:return 0}}),Z});return we(r,Z=>{n.replace({query:{...l.query,path:Z||void 0}}),re()}),we(d,()=>{l.name==="InstanceFiles"&&(r.value="",c.value=[],re())}),Ce(()=>{const Z=l.query.path;window.addEventListener("resize",X),Z?r.value=Z:re()}),Qe(()=>{window.removeEventListener("resize",X)}),(Z,W)=>{const ve=m("t-breadcrumb-item"),je=m("t-breadcrumb"),lt=m("t-input"),gt=m("t-select"),He=m("t-button"),ut=m("t-dropdown"),_t=m("t-tag"),sl=m("t-table"),ll=m("t-card"),Aa=m("t-dialog");return o(),C("div",_2,[e(ll,{bordered:!1,class:"file-manager-card"},{default:a(()=>[t("div",h2,[t("div",y2,[e(je,{"max-item-width":y.value?"80px":"150px"},{default:a(()=>[(o(!0),C(de,null,ye(Le.value,(oe,Ot)=>(o(),O(ve,{key:Ot,class:"crumb-item",onClick:I3=>be(oe.path)},xs({default:a(()=>[v(" "+I(oe.name),1)]),_:2},[Ot===0?{name:"icon",fn:a(()=>[e(k(Wl))]),key:"0"}:void 0]),1032,["onClick"]))),128))]),_:1},8,["max-item-width"])]),t("div",b2,[e(lt,{modelValue:nt.value,"onUpdate:modelValue":W[0]||(W[0]=oe=>nt.value=oe),placeholder:"搜索文件...",style:rt({width:y.value?"120px":"200px"})},{"prefix-icon":a(()=>[e(k(ua))]),_:1},8,["modelValue","style"]),e(gt,{modelValue:xt.value,"onUpdate:modelValue":W[1]||(W[1]=oe=>xt.value=oe),options:xa,style:rt({width:y.value?"110px":"140px"}),placeholder:"排序"},{prefixIcon:a(()=>[e(k(Xl))]),_:1},8,["modelValue","style"]),e(He,{variant:"outline",size:"medium",onClick:W[2]||(W[2]=oe=>k(Ie)(`/instance/console/${d.value}`))},{icon:a(()=>[e(k(Us))]),default:a(()=>[y.value?K("",!0):(o(),C("span",w2,"控制台"))]),_:1}),e(ut,{options:[{content:"新建文件",value:"file",onClick:le},{content:"新建文件夹",value:"folder",onClick:ae}]},{default:a(()=>[e(He,{variant:"outline",size:"medium"},{icon:a(()=>[e(k(Ql))]),default:a(()=>[y.value?K("",!0):(o(),C("span",k2,"新建"))]),_:1})]),_:1},8,["options"]),e(He,{theme:"primary",size:"medium",onClick:W[3]||(W[3]=oe=>g.value=!0)},{icon:a(()=>[e(k(Ps))]),default:a(()=>[y.value?K("",!0):(o(),C("span",$2,"上传"))]),_:1}),e(He,{variant:"outline",size:"medium",onClick:he},{icon:a(()=>[e(k(st))]),_:1})])]),t("div",x2,[e(sl,{"selected-row-keys":c.value,"onUpdate:selectedRowKeys":W[4]||(W[4]=oe=>c.value=oe),data:Ae.value,columns:Pe.value,"row-key":"name",loading:u.value,hover:!0,size:"medium",class:"file-table"},{name:a(({row:oe})=>[t("div",{class:"file-name-cell",onClick:Nt(Ot=>me(oe),["stop"])},[(o(),O(ot(De(oe).icon),{class:"file-icon",style:rt({color:De(oe).color})},null,8,["style"])),t("span",C2,I(oe.name),1)],8,A2)]),size:a(({row:oe})=>[v(I(Be(oe.size)),1)]),permission:a(({row:oe})=>[oe.permission?(o(),O(_t,{key:0,variant:"light",size:"small"},{default:a(()=>[v(I(oe.permission),1)]),_:2},1024)):K("",!0)]),lastModified:a(({row:oe})=>[v(I(Oe(oe.lastModified)),1)]),operation:a(({row:oe})=>[t("div",S2,[e(ut,{placement:y.value?"bottom-right":"bottom",options:[{content:"解压",value:"decompress",onClick:()=>Se(oe),show:_e(oe.name)&&oe.type!=="folder"},{content:q(oe.name)?"预览":"编辑",value:"edit",onClick:()=>q(oe.name)?ce(oe.name):Ke(oe.name),disabled:oe.type==="folder"||_e(oe.name)},{content:"权限",value:"permission",onClick:()=>Ye(oe),show:fe.value},{content:"下载",value:"download",onClick:()=>$e(oe)},{content:"重命名",value:"rename",onClick:()=>te(oe)},{content:"删除",value:"delete",theme:"error",onClick:()=>ne(oe)}].filter(Ot=>Ot.show!==!1)},{default:a(()=>[e(He,{variant:"text",shape:"square",size:"medium"},{default:a(()=>[e(k(Ds))]),_:1})]),_:1},8,["placement","options"])])]),empty:a(()=>[...W[24]||(W[24]=[t("div",{class:"empty-state"},"暂无文件",-1)])]),_:1},8,["selected-row-keys","data","columns","loading"])])]),_:1}),e(Qt,{name:"slide-up"},{default:a(()=>[Ve.value?(o(),C("div",I2,[y.value?(o(),C("div",M2,[t("span",null,I(c.value.length),1)])):(o(),C("div",V2,[W[25]||(W[25]=v(" 已选 ",-1)),t("span",null,I(c.value.length),1),W[26]||(W[26]=v(" 项 ",-1))])),t("div",L2,[e(He,{size:"small",variant:"text",theme:"primary",onClick:W[5]||(W[5]=oe=>et())},{icon:a(()=>[e(k(js))]),default:a(()=>[y.value?K("",!0):(o(),C("span",U2,"复制"))]),_:1}),e(He,{size:"small",variant:"text",theme:"primary",onClick:W[6]||(W[6]=oe=>ge())},{icon:a(()=>[e(k(Yl))]),default:a(()=>[y.value?K("",!0):(o(),C("span",B2,"剪切"))]),_:1}),e(He,{size:"small",variant:"text",theme:"primary",onClick:W[7]||(W[7]=oe=>Ue())},{icon:a(()=>[e(k(Ia))]),default:a(()=>[y.value?K("",!0):(o(),C("span",z2,"压缩"))]),_:1}),e(He,{size:"small",variant:"text",theme:"primary",onClick:W[8]||(W[8]=oe=>$e())},{icon:a(()=>[e(k(fa))]),default:a(()=>[y.value?K("",!0):(o(),C("span",P2,"下载"))]),_:1}),fe.value?(o(),O(He,{key:0,size:"small",variant:"text",theme:"primary",onClick:W[9]||(W[9]=oe=>Ye())},{icon:a(()=>[e(k(Zt))]),default:a(()=>[y.value?K("",!0):(o(),C("span",R2,"权限"))]),_:1})):K("",!0),e(He,{size:"small",variant:"text",theme:"danger",onClick:W[10]||(W[10]=oe=>ne())},{icon:a(()=>[e(k($t))]),default:a(()=>[y.value?K("",!0):(o(),C("span",E2,"删除"))]),_:1}),e(He,{size:"small",variant:"text",onClick:W[11]||(W[11]=oe=>c.value=[])},{default:a(()=>[...W[27]||(W[27]=[v("取消",-1)])]),_:1})])])):Fe.value?(o(),C("div",T2,[t("div",F2,[Ne.value==="copy"?(o(),C("span",D2,"准备复制")):(o(),C("span",O2,"准备移动")),t("span",null,I(xe.value.length),1),W[28]||(W[28]=v(" 项 ",-1))]),t("div",j2,[e(He,{theme:"primary",disabled:Re.value,onClick:ft},{icon:a(()=>[e(k(Va))]),default:a(()=>[W[29]||(W[29]=v(" 粘贴在此处 ",-1))]),_:1},8,["disabled"]),e(He,{variant:"text",theme:"default",onClick:vt},{icon:a(()=>[e(k(Oa))]),default:a(()=>[W[30]||(W[30]=v(" 取消 ",-1))]),_:1})])])):K("",!0)]),_:1}),e(el,{visible:M.value,"onUpdate:visible":W[12]||(W[12]=oe=>M.value=oe),"file-name":R.value,content:T.value,loading:P.value,onSave:j},null,8,["visible","file-name","content","loading"]),e(Aa,{visible:V.value,"onUpdate:visible":W[14]||(W[14]=oe=>V.value=oe),header:"新建文件","on-confirm":F},{default:a(()=>[e(lt,{modelValue:E.value,"onUpdate:modelValue":W[13]||(W[13]=oe=>E.value=oe),placeholder:"输入文件名",autofocus:!0,onEnter:F},null,8,["modelValue"])]),_:1},8,["visible"]),e(Aa,{visible:h.value,"onUpdate:visible":W[16]||(W[16]=oe=>h.value=oe),header:"重命名","on-confirm":D},{default:a(()=>[e(lt,{modelValue:w.value,"onUpdate:modelValue":W[15]||(W[15]=oe=>w.value=oe),placeholder:"输入新名称",autofocus:!0,onEnter:D},null,8,["modelValue"])]),_:1},8,["visible"]),e(tl,{visible:g.value,"onUpdate:visible":W[17]||(W[17]=oe=>g.value=oe),"instance-id":d.value,"current-path":r.value,onSuccess:Y},null,8,["visible","instance-id","current-path"]),e(j0,{visible:$.value,"onUpdate:visible":W[18]||(W[18]=oe=>$.value=oe),"file-name":G.value,"image-blob-url":N.value},null,8,["visible","file-name","image-blob-url"]),e(X0,{visible:z.value,"onUpdate:visible":W[19]||(W[19]=oe=>z.value=oe),"instance-id":d.value,"current-path":r.value,files:L.value,onSuccess:Me},null,8,["visible","instance-id","current-path","files"]),e(r2,{visible:U.value,"onUpdate:visible":W[20]||(W[20]=oe=>U.value=oe),"instance-id":d.value,"current-path":r.value,"file-name":H.value,onSuccess:Ge},null,8,["visible","instance-id","current-path","file-name"]),e(g2,{visible:p.value,"onUpdate:visible":W[21]||(W[21]=oe=>p.value=oe),"instance-id":d.value,"current-path":r.value,targets:J.value,onSuccess:Te},null,8,["visible","instance-id","current-path","targets"]),e(Aa,{visible:S.value,"onUpdate:visible":W[23]||(W[23]=oe=>S.value=oe),header:"新建文件夹","on-confirm":pe},{default:a(()=>[e(lt,{modelValue:b.value,"onUpdate:modelValue":W[22]||(W[22]=oe=>b.value=oe),placeholder:"输入文件夹名称",autofocus:!0,onEnter:pe},null,8,["modelValue"])]),_:1},8,["visible"])])}}}),N2=ie(K2,[["__scopeId","data-v-9f616c19"]]),q2=Object.freeze(Object.defineProperty({__proto__:null,default:N2},Symbol.toStringTag,{value:"Module"})),G2=se({name:"FrameBlank"});function H2(s,l,n,d,i,u){return o(),C("div")}const J2=ie(G2,[["render",H2]]),W2=Object.freeze(Object.defineProperty({__proto__:null,default:J2},Symbol.toStringTag,{value:"Module"}));function ws(){return Q.get({url:"/api/user/me"})}function ks(s){return Q.post({url:"/api/user/me/update",data:s})}function X2(){return Q.get({url:"/api/admin/user/list"})}function Q2(s){return Q.post({url:"/api/admin/user/create",data:s})}function Y2(s,l){return Q.post({url:`/api/admin/user/update/${s}`,data:l})}function Z2(s){return Q.post({url:`/api/admin/user/delete/${s}`})}const ew={class:"user-manage"},tw={class:"toolbar"},aw={class:"left-action"},sw={class:"right-search"},lw={class:"user-info-cell"},nw={class:"text-info"},ow={class:"nickname"},iw={class:"username"},rw={key:0,class:"time-text"},uw={key:1,class:"time-placeholder"},dw={class:"op-buttons"},cw=se({__name:"index",setup(s){const l=x(!1),n=x([]),d=x(""),i=Ee(),u=x(!1),f=x("create"),r=x(!1),c=Xe({id:"",username:"",name:"",password:"",role:"admin",resetApiKey:!1}),_={username:[{required:!0,message:"请输入用户名",type:"error"}],role:[{required:!0,message:"请选择角色",type:"error"}],password:[{validator:U=>f.value==="create"&&!U?{result:!1,message:"创建用户时密码必填",type:"error"}:!0}]},y=ee(()=>[{colKey:"info",title:"用户信息",width:200,fixed:"left",cell:"info-slot"},{colKey:"role",title:"角色",width:100,cell:"role-slot"},{colKey:"lastLogin",title:"最后登录",width:180,cell:"time-slot",className:"hidden-xs"},{colKey:"op",title:"操作",width:140,fixed:"right",cell:"op-slot"}]),M=ee(()=>{if(!d.value)return n.value;const U=d.value.toLowerCase();return n.value.filter(p=>p.username.toLowerCase().includes(U)||p.name&&p.name.toLowerCase().includes(U))}),$=async()=>{l.value=!0;try{const U=await X2();n.value=U}catch(U){B.error(U.message||"获取用户列表失败")}finally{l.value=!1}},V=()=>{f.value="create",c.id="",c.username="",c.name="",c.password="",c.role="admin",c.resetApiKey=!1,u.value=!0},h=U=>{f.value="edit",c.id=U.id,c.username=U.username,c.name=U.name,c.password="",c.role=U.role,c.resetApiKey=!1,u.value=!0},g=async({validateResult:U})=>{if(U===!0){r.value=!0;try{f.value==="create"?(await Q2({username:c.username,password:c.password,name:c.name,role:c.role}),B.success("用户创建成功")):(await Y2(c.id,{name:c.name,password:c.password||void 0,role:c.role,resetApiKey:c.resetApiKey}),B.success("用户更新成功")),u.value=!1,$()}catch(p){B.error(p.message||"操作失败")}finally{r.value=!1}}},z=U=>{const p=at.confirm({header:"删除警告",body:`确定要删除用户 "${U.username}" 吗？此操作不可恢复。`,theme:"danger",onConfirm:async()=>{try{p.hide(),await Z2(U.id),B.success("删除成功"),$()}catch(S){B.error(S.message||"删除失败")}}})};return Ce(()=>{$()}),(U,p)=>{const S=m("t-button"),b=m("t-input"),R=m("t-avatar"),T=m("t-tag"),P=m("t-divider"),G=m("t-table"),N=m("t-card"),E=m("t-form-item"),w=m("t-radio-button"),A=m("t-radio-group"),L=m("t-checkbox"),H=m("t-form"),J=m("t-dialog");return o(),C("div",ew,[e(N,{bordered:!1,class:"main-card"},{default:a(()=>[t("div",tw,[t("div",aw,[e(S,{theme:"primary",onClick:V},{icon:a(()=>[e(k(Yt))]),default:a(()=>[p[7]||(p[7]=v(" 新增用户 ",-1))]),_:1})]),t("div",sw,[e(b,{modelValue:d.value,"onUpdate:modelValue":p[0]||(p[0]=X=>d.value=X),placeholder:"搜索用户名或昵称",clearable:""},{"prefix-icon":a(()=>[e(k(ua))]),_:1},8,["modelValue"]),e(S,{variant:"text",shape:"square",onClick:$},{icon:a(()=>[e(k(st))]),_:1})])]),e(G,{"row-key":"id",data:M.value,columns:y.value,loading:l.value,hover:!0,pagination:{defaultPageSize:20,total:M.value.length,showJumper:!0},class:"user-table","table-layout":"auto"},{"info-slot":a(({row:X})=>[t("div",lw,[e(R,{image:X.avatar,size:"40px",shape:"circle","hide-on-load-failed":!1},{default:a(()=>[v(I(X.name?X.name[0].toUpperCase():"U"),1)]),_:2},1032,["image"]),t("div",nw,[t("div",ow,I(X.name||"未设置昵称"),1),t("div",iw,"@"+I(X.username),1)])])]),"role-slot":a(({row:X})=>[X.role==="admin"?(o(),O(T,{key:0,theme:"success",variant:"light",size:"small",shape:"round"},{default:a(()=>[...p[8]||(p[8]=[v("管理员",-1)])]),_:1})):(o(),O(T,{key:1,theme:"primary",variant:"light",size:"small",shape:"round"},{default:a(()=>[...p[9]||(p[9]=[v("普通用户",-1)])]),_:1}))]),"time-slot":a(({row:X})=>[X.lastLoginTime?(o(),C("span",rw,I(new Date(X.lastLoginTime).toLocaleString()),1)):(o(),C("span",uw,"从未登录"))]),"op-slot":a(({row:X})=>[t("div",dw,[e(S,{variant:"text",theme:"primary",size:"small",onClick:q=>h(X)},{default:a(()=>[...p[10]||(p[10]=[v(" 编辑 ",-1)])]),_:1},8,["onClick"]),e(P,{layout:"vertical"}),e(S,{variant:"text",theme:"danger",size:"small",disabled:X.id===k(i).userInfo.id||X.username==="admin",onClick:q=>z(X)},{default:a(()=>[...p[11]||(p[11]=[v(" 删除 ",-1)])]),_:1},8,["disabled","onClick"])])]),_:1},8,["data","columns","loading","pagination"])]),_:1}),e(J,{visible:u.value,"onUpdate:visible":p[6]||(p[6]=X=>u.value=X),header:f.value==="create"?"新增用户":"编辑用户","confirm-btn":{content:"提交",loading:r.value},"on-confirm":()=>U.$refs.formRef.submit(),width:"480px"},{default:a(()=>[e(H,{ref:"formRef",data:c,rules:_,"label-align":"top",onSubmit:g},{default:a(()=>[e(E,{label:"用户名",name:"username"},{default:a(()=>[e(b,{modelValue:c.username,"onUpdate:modelValue":p[1]||(p[1]=X=>c.username=X),placeholder:"登录账号",disabled:f.value==="edit"},null,8,["modelValue","disabled"])]),_:1}),e(E,{label:"昵称",name:"name"},{default:a(()=>[e(b,{modelValue:c.name,"onUpdate:modelValue":p[2]||(p[2]=X=>c.name=X),placeholder:"显示名称"},null,8,["modelValue"])]),_:1}),e(E,{label:"角色",name:"role"},{default:a(()=>[e(A,{modelValue:c.role,"onUpdate:modelValue":p[3]||(p[3]=X=>c.role=X),variant:"default-filled"},{default:a(()=>[e(w,{value:"user",disabled:""},{default:a(()=>[...p[12]||(p[12]=[v("普通用户",-1)])]),_:1}),e(w,{value:"admin"},{default:a(()=>[...p[13]||(p[13]=[v("管理员",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(E,{label:"密码",name:"password",help:f.value==="edit"?"留空则不修改密码":""},{default:a(()=>[e(b,{modelValue:c.password,"onUpdate:modelValue":p[4]||(p[4]=X=>c.password=X),type:"password",placeholder:"设置密码",autocomplete:"new-password"},null,8,["modelValue"])]),_:1},8,["help"]),f.value==="edit"?(o(),O(E,{key:0,label:"API 密钥"},{default:a(()=>[e(L,{modelValue:c.resetApiKey,"onUpdate:modelValue":p[5]||(p[5]=X=>c.resetApiKey=X)},{default:a(()=>[...p[14]||(p[14]=[v("重置该用户的 API Key",-1)])]),_:1},8,["modelValue"])]),_:1})):K("",!0)]),_:1},8,["data"])]),_:1},8,["visible","header","confirm-btn","on-confirm"])])}}}),mw=ie(cw,[["__scopeId","data-v-d4b06059"]]),pw=Object.freeze(Object.defineProperty({__proto__:null,default:mw},Symbol.toStringTag,{value:"Module"})),vw={class:"profile-header"},fw={class:"avatar-col"},gw={class:"info-col"},_w={class:"main-row"},hw={class:"nickname"},yw={class:"sub-row"},bw={class:"username"},ww={key:0,class:"last-login"},kw={key:0,class:"bound-status"},$w={key:1},xw=se({__name:"UserProfileCard",setup(s,{expose:l}){const n=Ee(),d=x(!1),i=x(!1),u=x(!1),f=x(""),r=x(""),c=x("qq"),_=Xe({id:"",username:"",name:"",avatar:"",role:"",apiKey:"",lastLoginTime:"",openMSLID:""}),y=Xe({changePassword:!1,newPassword:"",confirmPassword:""}),M=async()=>{d.value=!0;try{const S=await ws();Object.assign(_,S),f.value=S.username;const b=S.avatar&&S.avatar.match(/nk=(\d+)/);b&&b[1]?(c.value="qq",r.value=b[1]):c.value="custom"}catch(S){B.error(S.message||"用户加载失败")}finally{d.value=!1}};we(r,S=>{c.value==="qq"&&S&&(_.avatar=`https://q.qlogo.cn/g?b=qq&nk=${S}&s=640`)});const $=S=>{S==="qq"&&r.value&&(_.avatar=`https://q.qlogo.cn/g?b=qq&nk=${r.value}&s=640`)},V=()=>{_.apiKey&&navigator.clipboard.writeText(_.apiKey).then(()=>{B.success("API Key 已复制")})},h=()=>{const S=at.confirm({header:"重置 API 密钥",theme:"warning",body:"重置后，所有使用旧 Key 的外部工具将立即失效，确定要继续吗？",onConfirm:async()=>{try{S.hide(),await ks({resetApiKey:!0}),B.success("API Key 重置成功");const b=await ws();_.apiKey=b.apiKey}catch(b){B.error(b.message||"重置失败")}}})},g=async()=>{if(y.changePassword){if(!y.newPassword){B.warning("请输入新密码");return}if(y.newPassword!==y.confirmPassword){B.error("两次输入的密码不一致");return}}const S=_.username!==f.value,b=y.changePassword&&!!y.newPassword;i.value=!0;try{const R={username:_.username,name:_.name,avatar:_.avatar,password:b?y.newPassword:void 0,resetApiKey:!1};await ks(R),y.changePassword=!1,y.newPassword="",y.confirmPassword="",f.value=_.username,B.success("个人信息保存成功"),S||b?at.alert({header:"重新登录",body:"账号或密码已变更，请重新登录以生效。",confirmBtn:"去登录",onConfirm:async()=>{await n.logout(),window.location.reload()}}):await n.getUserInfo()}catch(R){B.error(R.message)}finally{i.value=!1}};l({initData:M});const z=x(!1),U=async()=>{z.value=!0;try{const S=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);localStorage.setItem("oauth_state",S);const b=`${window.location.origin}/oauth/callback?mode=bind`,R=await Q.get({url:"/api/auth/oauth/url",params:{state:S,callback:b}});R&&R.url?window.location.href=R.url:(B.error(R.message||"获取绑定地址失败"),z.value=!1)}catch(S){B.error(S.message||"请求失败"),z.value=!1}},p=()=>{const S=at.confirm({header:"解除绑定",theme:"warning",body:"确定要解除与 MSL 账户的绑定吗？解绑后您将无法使用 MSL 账户快捷登录。",onConfirm:async()=>{try{S.hide(),await Q.post({url:"/api/auth/oauth/unbind"}),B.success("解绑成功"),await M()}catch(b){B.error(b.message||"解绑失败")}}})};return(S,b)=>{const R=m("t-avatar"),T=m("t-tag"),P=m("t-divider"),G=m("t-radio-button"),N=m("t-radio-group"),E=m("t-input"),w=m("t-space"),A=m("t-form-item"),L=m("t-button"),H=m("t-switch"),J=m("t-form"),X=m("t-card");return o(),O(X,{bordered:!1,loading:d.value,class:"settings-card"},{default:a(()=>[t("div",vw,[t("div",fw,[e(R,{image:_.avatar,size:"80px",shape:"circle",class:"user-avatar-shadow"},{default:a(()=>[v(I(_.name?_.name.slice(0,1).toUpperCase():"U"),1)]),_:1},8,["image"])]),t("div",gw,[t("div",_w,[t("span",hw,I(_.name||"未设置昵称"),1),_.role==="admin"?(o(),O(T,{key:0,theme:"success",variant:"light",size:"small",shape:"round"},{default:a(()=>[...b[8]||(b[8]=[v("管理员",-1)])]),_:1})):(o(),O(T,{key:1,theme:"primary",variant:"light",size:"small",shape:"round"},{default:a(()=>[...b[9]||(b[9]=[v("普通用户",-1)])]),_:1}))]),t("div",yw,[t("span",bw,"@"+I(_.username),1),_.lastLoginTime?(o(),C("span",ww,[e(k(pt)),v(" "+I(new Date(_.lastLoginTime).toLocaleString()),1)])):K("",!0)])])]),e(P),e(J,{ref:"userForm",data:_,"label-width":100,"label-align":"left",onSubmit:g},{default:a(()=>[e(A,{label:"头像设置"},{default:a(()=>[e(w,{direction:"vertical",style:{width:"100%"}},{default:a(()=>[e(N,{modelValue:c.value,"onUpdate:modelValue":b[0]||(b[0]=q=>c.value=q),variant:"default-filled",onChange:$},{default:a(()=>[e(G,{value:"qq"},{default:a(()=>[e(k(en)),b[10]||(b[10]=v(" QQ头像",-1))]),_:1}),e(G,{value:"custom"},{default:a(()=>[e(k(It)),b[11]||(b[11]=v(" 链接",-1))]),_:1})]),_:1},8,["modelValue"]),c.value==="qq"?(o(),O(E,{key:0,modelValue:r.value,"onUpdate:modelValue":b[1]||(b[1]=q=>r.value=q),placeholder:"输入QQ号自动获取",type:"number"},{"prefix-icon":a(()=>[e(k(Ts))]),_:1},8,["modelValue"])):(o(),O(E,{key:1,modelValue:_.avatar,"onUpdate:modelValue":b[2]||(b[2]=q=>_.avatar=q),placeholder:"输入图片 URL 链接"},{"prefix-icon":a(()=>[e(k(tn))]),_:1},8,["modelValue"]))]),_:1})]),_:1}),e(A,{label:"用户昵称",name:"name"},{default:a(()=>[e(E,{modelValue:_.name,"onUpdate:modelValue":b[3]||(b[3]=q=>_.name=q),placeholder:"显示的名称"},null,8,["modelValue"])]),_:1}),e(A,{label:"登录账号",name:"username"},{default:a(()=>[e(E,{modelValue:_.username,"onUpdate:modelValue":b[4]||(b[4]=q=>_.username=q),placeholder:"登录唯一标识"},null,8,["modelValue"])]),_:1}),e(A,{label:"API Key",help:"用于MSLX桌面版/第三方工具连接的凭证，请妥善保管"},{default:a(()=>[e(E,{value:_.apiKey,type:u.value?"text":"password",readonly:"",placeholder:"点击重置生成 Key"},{suffix:a(()=>[e(L,{variant:"text",size:"small",onClick:V},{icon:a(()=>[e(k(js))]),_:1}),e(L,{variant:"text",theme:"danger",size:"small",onClick:h},{icon:a(()=>[e(k(st))]),_:1})]),_:1},8,["value","type"])]),_:1}),k(pa)()?K("",!0):(o(),O(P,{key:0,dashed:""})),k(pa)()?K("",!0):(o(),O(A,{key:1,label:"MSL 账户绑定",help:"绑定后可使用 MSL 账户直接登录本控制台"},{default:a(()=>[_.openMSLID&&_.openMSLID!=="0"?(o(),C("div",kw,[e(T,{theme:"success",variant:"light",size:"medium"},{icon:a(()=>[e(k(St))]),default:a(()=>[v(" 已绑定 (MSL UID: "+I(_.openMSLID)+") ",1)]),_:1}),e(L,{theme:"danger",variant:"text",size:"small",style:{"margin-left":"12px"},onClick:p},{default:a(()=>[...b[12]||(b[12]=[v(" 解除绑定 ",-1)])]),_:1})])):(o(),C("div",$w,[e(L,{theme:"primary",variant:"outline",loading:z.value,onClick:U},{icon:a(()=>[e(k(It))]),default:a(()=>[b[13]||(b[13]=v(" 绑定 MSL 账户 ",-1))]),_:1},8,["loading"])]))]),_:1})),e(P,{dashed:""}),e(A,{label:"修改密码"},{default:a(()=>[e(H,{modelValue:y.changePassword,"onUpdate:modelValue":b[5]||(b[5]=q=>y.changePassword=q)},null,8,["modelValue"])]),_:1}),y.changePassword?(o(),C(de,{key:2},[e(A,{label:"新密码","required-mark":""},{default:a(()=>[e(E,{modelValue:y.newPassword,"onUpdate:modelValue":b[6]||(b[6]=q=>y.newPassword=q),type:"password",placeholder:"请输入新密码"},{"prefix-icon":a(()=>[e(k(Zt))]),_:1},8,["modelValue"])]),_:1}),e(A,{label:"确认密码","required-mark":""},{default:a(()=>[e(E,{modelValue:y.confirmPassword,"onUpdate:modelValue":b[7]||(b[7]=q=>y.confirmPassword=q),type:"password",placeholder:"请再次输入新密码"},{"prefix-icon":a(()=>[e(k(St))]),_:1},8,["modelValue"])]),_:1})],64)):K("",!0),e(A,null,{default:a(()=>[e(L,{theme:"primary",type:"submit",loading:i.value,block:"",class:"action-btn"},{default:a(()=>[...b[14]||(b[14]=[v(" 保存个人资料 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["data"])]),_:1},8,["loading"])}}}),Aw=ie(xw,[["__scopeId","data-v-66f1e979"]]),Cw={key:1},Sw={class:"status-label"},Iw=se({__name:"SystemSettingsCard",emits:["refresh"],setup(s,{expose:l,emit:n}){const d=Wa(),i=x(!1),u=x(!1),f=Xe({fireWallBanLocalAddr:!1,openWebConsoleOnLaunch:!0,neoForgeInstallerMirrors:"MSL Mirrors",listenHost:"localhost",listenPort:1027,oAuthMSLClientID:"",oAuthMSLClientSecret:""}),r=[{label:"官方源 (较慢)",value:"Official"},{label:"MSL镜像源 (推荐)",value:"MSL Mirrors"},{label:"MSL镜像源 - 备用",value:"MSL Mirrors Backup"}],c=n,_=async()=>{i.value=!0;try{const V=await Po();Object.assign(f,V)}catch(V){B.error(V.message||"系统设置加载失败")}finally{i.value=!1}},y=async()=>{u.value=!0;try{await Ro(f),B.success("系统设置保存成功")}catch(V){B.error(V.message)}finally{u.value=!1}},M=()=>{_(),c("refresh")};l({initData:_});const $=x("");return Ce(()=>{$.value=`${window.location.origin}/oauth/callback`}),(V,h)=>{const g=m("t-button"),z=m("t-form-item"),U=m("t-switch"),p=m("t-select"),S=m("t-divider"),b=m("t-input"),R=m("t-icon"),T=m("t-space"),P=m("t-col"),G=m("t-row"),N=m("t-form"),E=m("t-card");return o(),O(E,{bordered:!1,title:"系统偏好设置",loading:i.value,class:"settings-card"},{actions:a(()=>[e(g,{theme:"primary",variant:"text",size:"small",onClick:M},{default:a(()=>[...h[11]||(h[11]=[v("刷新数据",-1)])]),_:1})]),default:a(()=>[e(N,{ref:"sysForm",data:f,"label-width":120,"label-align":"left",onSubmit:y},{default:a(()=>[h[18]||(h[18]=t("div",{class:"group-title"},"守护进程",-1)),e(z,{label:"软件更新",style:{"margin-top":"6px"}},{default:a(()=>[e(g,{theme:"default",loading:k(d).loading,onClick:h[0]||(h[0]=w=>k(d).checkAppUpdate(!0))},{icon:a(()=>[e(k(Cs))]),default:a(()=>[h[12]||(h[12]=v(" 检查更新 ",-1))]),_:1},8,["loading"])]),_:1}),e(z,{label:"自动打开控制台",help:"MSLX 守护进程启动成功后，是否自动登录网页端控制台。"},{default:a(()=>[e(U,{modelValue:f.openWebConsoleOnLaunch,"onUpdate:modelValue":h[1]||(h[1]=w=>f.openWebConsoleOnLaunch=w)},null,8,["modelValue"])]),_:1}),e(z,{label:"安装镜像源",help:"选择在自动安装 NeoForge / Forge 时所使用的镜像源。",style:{"margin-top":"6px"}},{default:a(()=>[e(p,{modelValue:f.neoForgeInstallerMirrors,"onUpdate:modelValue":h[2]||(h[2]=w=>f.neoForgeInstallerMirrors=w),options:r},null,8,["modelValue"])]),_:1}),k(pa)()?K("",!0):(o(),O(S,{key:0,dashed:""})),k(pa)()?K("",!0):(o(),C("div",Cw,[h[14]||(h[14]=t("div",{class:"group-title"},"MSL OAuth 2.0",-1)),e(z,{label:"Client ID",style:{"margin-top":"6px"}},{default:a(()=>[e(b,{modelValue:f.oAuthMSLClientID,"onUpdate:modelValue":h[3]||(h[3]=w=>f.oAuthMSLClientID=w),placeholder:"请输入 Client ID"},{"prefix-icon":a(()=>[e(k(wt))]),_:1},8,["modelValue"])]),_:1}),e(z,{label:"Client Secret",help:"配置MSL OAuth 2.0后即可使用您的MSL账号一键登录您的MSLX控制台。",style:{"margin-top":"16px"}},{default:a(()=>[e(b,{modelValue:f.oAuthMSLClientSecret,"onUpdate:modelValue":h[4]||(h[4]=w=>f.oAuthMSLClientSecret=w),type:"password",placeholder:"请输入 Client Secret"},{"prefix-icon":a(()=>[e(k(as))]),_:1},8,["modelValue"])]),_:1}),e(z,{label:"回调地址",help:"请将此地址复制并填入 MSL用户中心 OAuth应用配置的 [回调地址] 中",style:{"margin-top":"16px"}},{default:a(()=>[e(b,{value:$.value,readonly:"",placeholder:"正在获取当前域名..."},{"prefix-icon":a(()=>[e(k(It))]),suffix:a(()=>[e(g,{variant:"text",shape:"square",onClick:h[5]||(h[5]=w=>k(ia)($.value,!0,"回调地址复制成功"))},{default:a(()=>[e(R,{name:"file-copy"})]),_:1})]),_:1},8,["value"])]),_:1}),e(z,{style:{"margin-top":"6px"},label:"配置教程"},{default:a(()=>[e(T,{align:"center"},{default:a(()=>[e(g,{theme:"default",onClick:h[6]||(h[6]=w=>k(Ie)(k(Wt).msl_oauth))},{icon:a(()=>[e(k(da))]),default:a(()=>[h[13]||(h[13]=v(" 配置MSL账号快捷登录教程",-1))]),_:1})]),_:1})]),_:1})])),e(S,{dashed:""}),h[19]||(h[19]=t("div",{class:"group-title"},"网络与安全",-1)),e(z,{label:"禁止本地访问",help:"开启后将禁止本地回环地址访问，增强安全性。"},{default:a(()=>[e(T,{align:"center"},{default:a(()=>[e(U,{modelValue:f.fireWallBanLocalAddr,"onUpdate:modelValue":h[7]||(h[7]=w=>f.fireWallBanLocalAddr=w)},null,8,["modelValue"]),t("span",Sw,I(f.fireWallBanLocalAddr?"已开启":"已关闭"),1)]),_:1})]),_:1}),e(z,{label:"监听地址设置",help:"设置MSLX守护进程的监听地址。(需要重启守护进程生效,若不明白这是干什么的请一定不要修改！)",style:{"margin-top":"6px"}},{default:a(()=>[e(G,{gutter:16,style:{width:"100%"}},{default:a(()=>[e(P,{span:6},{default:a(()=>[e(b,{modelValue:f.listenHost,"onUpdate:modelValue":h[8]||(h[8]=w=>f.listenHost=w),placeholder:"localhost"},{"prefix-icon":a(()=>[e(k(wt))]),_:1},8,["modelValue"])]),_:1}),e(P,{span:4,style:{display:"flex","align-items":"center"}},{default:a(()=>[h[15]||(h[15]=t("span",{style:{"margin-right":"8px",color:"var(--td-text-color-secondary)"}},":",-1)),e(b,{modelValue:f.listenPort,"onUpdate:modelValue":h[9]||(h[9]=w=>f.listenPort=w),placeholder:"1027",style:{width:"120px"}},{"prefix-icon":a(()=>[e(k(as))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(z,{style:{"margin-top":"6px"},label:"远程访问"},{default:a(()=>[e(T,{align:"center"},{default:a(()=>[e(g,{theme:"default",onClick:h[10]||(h[10]=w=>k(Ie)(k(Wt).remote_access))},{icon:a(()=>[e(k(da))]),default:a(()=>[h[16]||(h[16]=v(" 配置远程访问说明",-1))]),_:1})]),_:1})]),_:1}),e(z,null,{default:a(()=>[e(g,{theme:"primary",type:"submit",loading:u.value,block:"",class:"action-btn"},{default:a(()=>[...h[17]||(h[17]=[v(" 保存系统设置 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["data"])]),_:1},8,["loading"])}}}),Vw=ie(Iw,[["__scopeId","data-v-65f913a9"]]),Mw=se({__name:"WebPanelStyleCard",setup(s){const l=Dt(),n=async(d,i)=>{const u=d[0]?.raw||d.raw;if(!u)return;const f=await l.uploadImage(u);f&&(l.settings[i]=f)};return(d,i)=>{const u=m("t-button"),f=m("t-upload"),r=m("t-input"),c=m("t-form-item"),_=m("t-divider"),y=m("t-slider"),M=m("t-col"),$=m("t-row"),V=m("t-option"),h=m("t-select"),g=m("t-space"),z=m("t-form"),U=m("t-card");return o(),O(U,{bordered:!1,title:"面板自定义样式",description:"背景图相关的样式需要在面板左上角的样式面板中启用背景美化才会生效哦！",loading:k(l).loading,class:"settings-card"},{actions:a(()=>[e(u,{theme:"default",onClick:i[0]||(i[0]=p=>k(Ie)(k(Wt).style))},{icon:a(()=>[e(k(da))]),default:a(()=>[i[13]||(i[13]=v(" 设置文档",-1))]),_:1})]),default:a(()=>[e(z,{data:k(l).settings,"label-width":120,"label-align":"left",onSubmit:k(l).saveSettings},{default:a(()=>[i[16]||(i[16]=t("div",{class:"group-title"},"背景图片设置",-1)),e(c,{label:"浅色背景",help:"留空则使用默认的背景图哦～"},{default:a(()=>[e(r,{modelValue:k(l).settings.webPanelStyleLightBackground,"onUpdate:modelValue":i[2]||(i[2]=p=>k(l).settings.webPanelStyleLightBackground=p),placeholder:"输入完整URL地址或者在右边上传图片"},{suffix:a(()=>[e(f,{theme:"custom",action:"","auto-upload":!1,"show-file-list":!1,accept:"image/png, image/jpeg, image/webp",onChange:i[1]||(i[1]=p=>n(p,"webPanelStyleLightBackground"))},{default:a(()=>[e(u,{variant:"text",shape:"square"},{default:a(()=>[e(k(La))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"深色背景"},{default:a(()=>[e(r,{modelValue:k(l).settings.webPanelStyleDarkBackground,"onUpdate:modelValue":i[4]||(i[4]=p=>k(l).settings.webPanelStyleDarkBackground=p),placeholder:"输入完整URL地址或者在右边上传图片"},{suffix:a(()=>[e(f,{theme:"custom","auto-upload":!1,"show-file-list":!1,accept:"image/png, image/jpeg, image/webp",onChange:i[3]||(i[3]=p=>n(p,"webPanelStyleDarkBackground"))},{default:a(()=>[e(u,{variant:"text",shape:"square"},{default:a(()=>[e(k(La))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(_,{dashed:""}),i[17]||(i[17]=t("div",{class:"group-title"},"透明度调整 (0.1 - 1.0)",-1)),e($,{gutter:[32,16]},{default:a(()=>[e(M,{xs:24,sm:12,md:6},{default:a(()=>[e(c,{label:"浅色背景透明度"},{default:a(()=>[e(y,{modelValue:k(l).settings.webPanelStyleLightBackgroundOpacity,"onUpdate:modelValue":i[5]||(i[5]=p=>k(l).settings.webPanelStyleLightBackgroundOpacity=p),min:.1,max:1,step:.01,"tooltip-props":{theme:"light"}},null,8,["modelValue"])]),_:1})]),_:1}),e(M,{xs:24,sm:12,md:6},{default:a(()=>[e(c,{label:"浅色组件透明度"},{default:a(()=>[e(y,{modelValue:k(l).settings.webPanelStyleLightComponentsOpacity,"onUpdate:modelValue":i[6]||(i[6]=p=>k(l).settings.webPanelStyleLightComponentsOpacity=p),min:.1,max:1,step:.01,"tooltip-props":{theme:"light"}},null,8,["modelValue"])]),_:1})]),_:1}),e(M,{xs:24,sm:12,md:6},{default:a(()=>[e(c,{label:"深色背景透明度"},{default:a(()=>[e(y,{modelValue:k(l).settings.webPanelStyleDarkBackgroundOpacity,"onUpdate:modelValue":i[7]||(i[7]=p=>k(l).settings.webPanelStyleDarkBackgroundOpacity=p),min:.1,max:1,step:.01},null,8,["modelValue"])]),_:1})]),_:1}),e(M,{xs:24,sm:12,md:6},{default:a(()=>[e(c,{label:"深色组件透明度"},{default:a(()=>[e(y,{modelValue:k(l).settings.webPanelStyleDarkComponentsOpacity,"onUpdate:modelValue":i[8]||(i[8]=p=>k(l).settings.webPanelStyleDarkComponentsOpacity=p),min:.1,max:1,step:.01},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(_,{dashed:""}),i[18]||(i[18]=t("div",{class:"group-title"},"终端设置(毛玻璃强度/染色设置)",-1)),e($,{gutter:[32,16]},{default:a(()=>[e(M,{xs:24,sm:12,md:6},{default:a(()=>[e(c,{label:"浅色模式模糊度"},{default:a(()=>[e(y,{modelValue:k(l).settings.webpPanelTerminalBlurLight,"onUpdate:modelValue":i[9]||(i[9]=p=>k(l).settings.webpPanelTerminalBlurLight=p),min:0,max:50,step:1,"input-number-props":{theme:"column",style:"width: 65px"}},{label:a(({value:p})=>[v(I(p)+"px ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(M,{xs:24,sm:12,md:6},{default:a(()=>[e(c,{label:"深色模式模糊度"},{default:a(()=>[e(y,{modelValue:k(l).settings.webpPanelTerminalBlurDark,"onUpdate:modelValue":i[10]||(i[10]=p=>k(l).settings.webpPanelTerminalBlurDark=p),min:0,max:50,step:1,"input-number-props":{theme:"column",style:"width: 65px"}},{label:a(({value:p})=>[v(I(p)+"px ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(M,{xs:24,sm:12,md:6},{default:a(()=>[e(g,null,{default:a(()=>[e(c,{label:"日志染色等级"},{default:a(()=>[e(h,{modelValue:k(l).settings.webPanelColorizeLogLevel,"onUpdate:modelValue":i[11]||(i[11]=p=>k(l).settings.webPanelColorizeLogLevel=p)},{default:a(()=>[e(V,{label:"不染色",value:0}),e(V,{label:"简约染色",value:1}),e(V,{label:"增强染色",value:2})]),_:1},8,["modelValue"])]),_:1}),e(u,{theme:"default",onClick:i[12]||(i[12]=p=>k(Ie)(k(Wt).style_log_colorizer))},{icon:a(()=>[e(k(an))]),default:a(()=>[i[14]||(i[14]=v(" 有什么区别？",-1))]),_:1})]),_:1})]),_:1})]),_:1}),e(c,{style:{"margin-top":"24px"}},{default:a(()=>[e(u,{theme:"primary",type:"submit",loading:k(l).submitLoading,block:"",class:"action-btn"},{default:a(()=>[...i[15]||(i[15]=[v(" 应用样式设置 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["data","onSubmit"])]),_:1},8,["loading"])}}}),Lw=ie(Mw,[["__scopeId","data-v-e0f02fd5"]]),Uw={class:"settings-page"},Bw=se({__name:"index",setup(s){const l=Dt(),n=x(),d=x(),i=async()=>{const u=[];n.value&&u.push(n.value.initData()),d.value&&u.push(d.value.initData()),u.push(l.fetchSettings()),await Promise.all(u)};return Ce(()=>{i()}),(u,f)=>{const r=m("t-space");return o(),C("div",Uw,[e(r,{direction:"vertical",size:"large",style:{width:"100%"}},{default:a(()=>[e(Aw,{ref_key:"userCardRef",ref:n},null,512),e(Vw,{ref_key:"sysCardRef",ref:d,onRefresh:i},null,512),e(Lw)]),_:1})])}}}),zw=ie(Bw,[["__scopeId","data-v-5abf49f6"]]),Pw=Object.freeze(Object.defineProperty({__proto__:null,default:zw},Symbol.toStringTag,{value:"Module"}));async function Rw(){return await Q.get({url:"/build.json",baseURL:"/",params:{t:Date.now()}})}async function Ew(){return await Q.get({url:"/query/changelogs?software=MSLX",baseURL:"https://api.mslmc.cn/v3"})}const Tw={class:"about-page"},Fw={class:"intro-header"},Dw={class:"logo-area"},Ow={class:"dev-card"},jw={class:"dev-info"},Kw={class:"dev-name"},Nw={class:"dev-role"},qw=["title"],Gw={class:"dev-card"},Hw={class:"dev-info"},Jw={class:"dev-name"},Ww={class:"dev-role",style:{background:"var(--td-success-color-1)",color:"var(--td-success-color-7)"}},Xw=["title"],Qw={key:0,class:"history-timeline"},Yw={class:"timeline-content"},Zw={style:{display:"flex","align-items":"center",gap:"8px","margin-bottom":"8px"}},ek={class:"commit-time",style:{"margin-bottom":"0"}},tk={class:"msg",style:{"white-space":"pre-wrap","margin-bottom":"0"}},ak={key:1,style:{"text-align":"center",color:"var(--td-text-color-placeholder)",padding:"20px"}},sk={key:0,class:"build-summary"},lk={class:"info-block"},nk={class:"value version"},ok={class:"info-block"},ik={class:"value time"},rk={class:"info-block"},uk=["title"],dk={class:"sub-value"},ck={class:"info-block"},mk={class:"value framework"},pk={key:1,class:"details-collapse"},vk={class:"panel-header"},fk={class:"history-timeline"},gk={class:"timeline-content"},_k={class:"commit-time"},hk={class:"msg"},yk={class:"meta"},bk={class:"hash"},wk={class:"panel-header"},kk={class:"deps-grid"},$k={class:"dep-item"},xk=["title"],Ak=se({__name:"index",setup(s){const l=[{name:"xiaoyu",role:"Core Developer",avatar:"https://q.qlogo.cn/headimg_dl?dst_uin=1791123970&spec=640&img_type=jpg",desc:"核心开发者"},{name:"Weheal",role:"Core Developer",avatar:"https://q.qlogo.cn/headimg_dl?dst_uin=2035582067&spec=640&img_type=jpg",desc:"核心开发者"}],n=[{name:"GuHanDuRen",role:"Alpha Tester",avatar:"https://q.qlogo.cn/headimg_dl?dst_uin=2778318425&spec=640&img_type=jpg",desc:"最早期内部功能测试"},{name:"邱息",role:"Beta Tester",avatar:"https://q.qlogo.cn/headimg_dl?dst_uin=3687624214&spec=640&img_type=jpg",desc:"提供了宝贵的建议"},{name:"Nebula琳",role:"Beta Tester",avatar:"https://q.qlogo.cn/headimg_dl?dst_uin=3770298358&spec=640&img_type=jpg",desc:"提供了宝贵的建议"},{name:"MSLX Beta 群友们",role:"Members",avatar:"https://p.qlogo.cn/gh/839645854/839645854/0",desc:"感谢各位内测群的群友们！"}],d=x(!0),i=x(null),u=x(!0),f=x([]),r=async()=>{try{d.value=!0,i.value=await Rw()}catch(y){console.error(y),B.warning("无法加载构建信息")}finally{d.value=!1}},c=async()=>{try{u.value=!0;const y=await Ew();y&&(f.value=y)}catch(y){console.error("获取更新日志失败:",y)}finally{u.value=!1}},_=ee(()=>i.value?.dependencies?Object.entries(i.value.dependencies).map(([y,M])=>({name:y,version:M})):[]);return Ce(()=>{r(),c()}),(y,M)=>{const $=m("t-card"),V=m("t-avatar"),h=m("t-col"),g=m("t-row"),z=m("t-tag"),U=m("t-timeline-item"),p=m("t-timeline"),S=m("t-divider"),b=m("t-collapse-panel"),R=m("t-collapse"),T=m("t-space");return o(),C("div",Tw,[e(T,{direction:"vertical",size:"large",style:{width:"100%"}},{default:a(()=>[e($,{bordered:!1,class:"intro-card"},{default:a(()=>[t("div",Fw,[t("div",Dw,[e(k(wt),{class:"logo-icon"}),M[0]||(M[0]=t("h1",{class:"project-title"},"关于 MSLX",-1))])]),M[1]||(M[1]=t("div",{class:"intro-text"},[t("p",null,[t("strong",null,"MSLX"),v(" 是由 "),t("strong",null,"MSL 原班团队 MSLTeam"),v(" 倾力打造的全新一代开服工具。 基于 "),t("strong",null,".NET Core 10.0"),v(" 环境。 ")]),t("p",null,[v(" 它传承了 MSL 经典的 UI 设计语言，旨在让操作零门槛——无论是老用户还是新伙伴，都能即刻上手，极速部署您的 MC 服务器。 MSLX 不仅 "),t("strong",null,"完美支持跨平台"),v(" (Windows / macOS / Linux) 运行，相比前代，更引入了强大的 "),t("strong",null,"远程访问"),v(" 功能，让管理更自由。 ")])],-1))]),_:1}),e($,{bordered:!1,title:"开发团队"},{default:a(()=>[M[2]||(M[2]=t("p",{class:"about-desc"},"感谢以下开发者对本项目的杰出贡献：",-1)),e(g,{gutter:[16,16]},{default:a(()=>[(o(),C(de,null,ye(l,P=>e(h,{key:P.name,span:3,xs:12,sm:6},{default:a(()=>[t("div",Ow,[e(V,{image:P.avatar,size:"56px",shape:"circle",class:"dev-avatar"},null,8,["image"]),t("div",jw,[t("div",Kw,I(P.name),1),t("div",Nw,I(P.role),1),t("div",{class:"dev-desc",title:P.desc},I(P.desc),9,qw)])])]),_:2},1024)),64))]),_:1})]),_:1}),e($,{bordered:!1,title:"催更？"},{default:a(()=>[e(ra)]),_:1}),e($,{bordered:!1,title:"鸣谢"},{default:a(()=>[M[3]||(M[3]=t("p",{class:"about-desc"},"特别感谢参与内测并提供反馈的伙伴们：",-1)),e(g,{gutter:[16,16]},{default:a(()=>[(o(),C(de,null,ye(n,P=>e(h,{key:P.name,span:3,xs:12,sm:4,md:4,lg:3},{default:a(()=>[t("div",Gw,[e(V,{image:P.avatar,size:"56px",shape:"circle",class:"dev-avatar"},null,8,["image"]),t("div",Hw,[t("div",Jw,I(P.name),1),t("div",Ww,I(P.role),1),t("div",{class:"dev-desc",title:P.desc},I(P.desc),9,Xw)])])]),_:2},1024)),64))]),_:1})]),_:1}),e($,{bordered:!1,title:"更新日志",loading:u.value},{default:a(()=>[f.value.length>0?(o(),C("div",Qw,[e(p,null,{default:a(()=>[(o(!0),C(de,null,ye(f.value,(P,G)=>(o(),O(U,{key:G,"dot-color":"primary"},{default:a(()=>[t("div",Yw,[t("div",Zw,[e(z,{size:"small",variant:"light",theme:"primary"},{default:a(()=>[v(I(P.version),1)]),_:2},1024),t("div",ek,[e(k(pt),{style:{"margin-right":"4px","font-size":"12px"}}),v(" "+I(P.time),1)])]),t("div",tk,I(P.changes),1)])]),_:2},1024))),128))]),_:1})])):u.value?K("",!0):(o(),C("div",ak," 暂无更新日志 "))]),_:1},8,["loading"]),e($,{bordered:!1,title:"构建信息",loading:d.value},{actions:a(()=>[i.value?(o(),O(z,{key:0,theme:"success",variant:"light"},{icon:a(()=>[e(k(St))]),default:a(()=>[M[4]||(M[4]=v(" 构建成功 ",-1))]),_:1})):K("",!0)]),default:a(()=>[i.value?(o(),C("div",sk,[e(g,{gutter:[16,16],style:{"align-items":"stretch"}},{default:a(()=>[e(h,{span:3,xs:12,sm:6},{default:a(()=>[t("div",lk,[M[5]||(M[5]=t("div",{class:"label"},"当前版本",-1)),t("div",nk,I(i.value.version),1)])]),_:1}),e(h,{span:3,xs:12,sm:6},{default:a(()=>[t("div",ok,[M[6]||(M[6]=t("div",{class:"label"},"构建时间",-1)),t("div",ik,[e(k(pt)),v(" "+I(i.value.buildTime),1)])])]),_:1}),e(h,{span:3,xs:12,sm:6},{default:a(()=>[t("div",rk,[M[7]||(M[7]=t("div",{class:"label"},"最新提交",-1)),t("div",{class:"value commit",title:i.value.commitMsg},[e(k(sn)),v(" "+I(i.value.commitId.substring(0,7)),1)],8,uk),t("div",dk,"by "+I(i.value.commitAuthor),1)])]),_:1}),e(h,{span:3,xs:12,sm:6},{default:a(()=>[t("div",ck,[M[10]||(M[10]=t("div",{class:"label"},"核心框架",-1)),t("div",mk,[M[8]||(M[8]=t("span",{class:"dotnet"},".NET 10.0",-1)),e(S,{layout:"vertical"}),M[9]||(M[9]=t("span",{class:"vue"},"Vue 3.x",-1))])])]),_:1})]),_:1})])):K("",!0),i.value?(o(),C("div",pk,[e(R,{borderless:!0},{default:a(()=>[e(b,{value:"history"},{header:a(()=>[t("div",vk,[e(k(ln)),M[11]||(M[11]=v(" 提交日志 (Commit History)",-1))])]),default:a(()=>[t("div",fk,[e(p,null,{default:a(()=>[(o(!0),C(de,null,ye(i.value.history,P=>(o(),O(U,{key:P.commitId,"dot-color":"primary"},{default:a(()=>[t("div",gk,[t("div",_k,I(P.commitTime),1),t("div",hk,I(P.commitMsg),1),t("div",yk,[e(z,{size:"small",style:{padding:"0"}},{default:a(()=>[e(k(zt)),v(" "+I(P.commitAuthor),1)]),_:2},1024),t("span",bk,"#"+I(P.commitId.substring(0,7)),1)])])]),_:2},1024))),128))]),_:1})])]),_:1}),e(b,{value:"dependencies"},{header:a(()=>[t("div",wk,[e(k(Pt)),M[12]||(M[12]=v(" 核心依赖 (Dependencies)",-1))])]),default:a(()=>[t("div",kk,[e(g,{gutter:[12,12]},{default:a(()=>[(o(!0),C(de,null,ye(_.value,P=>(o(),O(h,{key:P.name,span:3,xs:12,sm:6,md:4},{default:a(()=>[t("div",$k,[t("span",{class:"dep-name",title:P.name},I(P.name),9,xk),e(z,{size:"small",variant:"light-outline"},{default:a(()=>[v(I(P.version),1)]),_:2},1024)])]),_:2},1024))),128))]),_:1})])]),_:1})]),_:1})])):K("",!0)]),_:1},8,["loading"])]),_:1})])}}}),Ck=ie(Ak,[["__scopeId","data-v-92efe470"]]),Sk=Object.freeze(Object.defineProperty({__proto__:null,default:Ck},Symbol.toStringTag,{value:"Module"})),Ik={key:0,class:"loading-wrapper"},Vk={key:1,class:"input-group"},Mk={class:"check-container"},Lk={class:"btn-wrapper"},Uk={key:0,class:"msl-login-wrapper"},Bk={class:"reset-guide"},zk={class:"guide-item"},Pk={class:"guide-title"},Rk={class:"guide-item"},Ek={class:"guide-title"},Tk="remembered_url",$s="remembered_username",Fk=se({__name:"Login",setup(s){const l=Ee(),n=Wa(),d=Xt(),i=Ze(),u=x(!1),f=x(!1),r=x(!1),c=x(!1),_=x(!0),y=x(!1),M=Xe({url:localStorage.getItem(Tk)||"",username:localStorage.getItem($s)||"",password:"",checked:!!localStorage.getItem($s)}),$=x(),V=ee(()=>{const U={username:[{required:!0,message:"请输入用户名",type:"error"}],password:[{required:!0,message:"请输入密码",type:"error"}]};return c.value||(U.url=[{required:!0,message:"请输入服务器地址",type:"error"}]),U}),h=async()=>{_.value=!0,await l.checkConnection("")?(c.value=!0,M.url=""):c.value=!1;try{(await Q.get({url:"/api/auth/oauth/status"})).allowOAuth&&(f.value=!0),_.value=!1}catch{_.value=!1}},g=async({validateResult:U})=>{if(U===!0){u.value=!0;try{await l.login({url:c.value?"":M.url,username:M.username,password:M.password,checked:M.checked}),B.success("登录成功");const p=i.query.redirect,S=p?decodeURIComponent(p):"/dashboard/base";d.push(S),zs.success({content:`欢迎回来！${l.userInfo.name}`,title:"MSLX 控制台"}),n.checkAppUpdate(!1)}catch(p){B.error(p.message||"登录失败，请检查账号密码")}finally{u.value=!1}}},z=async()=>{try{u.value=!0;const U=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);localStorage.setItem("oauth_state",U);const p=`${window.location.origin}/oauth/callback?mode=login`,S=await Q.get({url:"/api/auth/oauth/url",params:{state:U,callback:p}});if(S&&S.url)window.location.href=S.url;else throw new Error(S.message||"获取授权地址失败")}catch(U){B.error(U.message||"无法连接到认证服务器"),u.value=!1}};return Ce(()=>{h()}),(U,p)=>{const S=m("t-loading"),b=m("t-icon"),R=m("t-input"),T=m("t-form-item"),P=m("t-checkbox"),G=m("t-link"),N=m("t-button"),E=m("t-form"),w=m("t-divider"),A=m("t-alert"),L=m("t-dialog");return o(),C("div",null,[e(E,{ref_key:"form",ref:$,class:"login-form",data:M,rules:V.value,"label-width":"0",onSubmit:g},{default:a(()=>[_.value?(o(),C("div",Ik,[e(S,{text:"正在连接服务...",size:"small"})])):(o(),C("div",Vk,[c.value?K("",!0):(o(),O(T,{key:0,name:"url"},{default:a(()=>[e(R,{modelValue:M.url,"onUpdate:modelValue":p[0]||(p[0]=H=>M.url=H),size:"large",placeholder:"服务器地址 (如 localhost:1027)",class:"glass-input"},{"prefix-icon":a(()=>[e(b,{name:"server"})]),_:1},8,["modelValue"])]),_:1})),e(T,{name:"username"},{default:a(()=>[e(R,{modelValue:M.username,"onUpdate:modelValue":p[1]||(p[1]=H=>M.username=H),size:"large",placeholder:"请输入用户名",class:"glass-input"},{"prefix-icon":a(()=>[e(b,{name:"user"})]),_:1},8,["modelValue"])]),_:1}),e(T,{name:"password"},{default:a(()=>[e(R,{modelValue:M.password,"onUpdate:modelValue":p[3]||(p[3]=H=>M.password=H),size:"large",type:r.value?"text":"password",placeholder:"请输入密码",class:"glass-input"},{"prefix-icon":a(()=>[e(b,{name:"lock-on"})]),"suffix-icon":a(()=>[e(b,{name:r.value?"browse":"browse-off",style:{cursor:"pointer"},onClick:p[2]||(p[2]=H=>r.value=!r.value)},null,8,["name"])]),_:1},8,["modelValue","type"])]),_:1})])),t("div",Mk,[e(P,{modelValue:M.checked,"onUpdate:modelValue":p[4]||(p[4]=H=>M.checked=H)},{default:a(()=>[...p[7]||(p[7]=[v("记住用户名",-1)])]),_:1},8,["modelValue"]),e(G,{theme:"primary",hover:"color",onClick:p[5]||(p[5]=H=>y.value=!0)},{default:a(()=>[...p[8]||(p[8]=[v(" 忘记密码？ ",-1)])]),_:1})]),e(T,{class:"btn-container"},{default:a(()=>[t("div",Lk,[e(N,{block:"",size:"large",type:"submit",class:"login-btn",loading:u.value},{default:a(()=>[...p[9]||(p[9]=[v(" 登 录 ",-1)])]),_:1},8,["loading"]),f.value?(o(),C("div",Uk,[t("a",{class:"msl-link-btn",onClick:z},[e(b,{name:"user-transmit"}),p[10]||(p[10]=t("span",null,"使用 MSL 账户登录",-1))])])):K("",!0)])]),_:1})]),_:1},8,["data","rules"]),e(L,{visible:y.value,"onUpdate:visible":p[6]||(p[6]=H=>y.value=H),header:"找回或重置密码",footer:!1,width:"480px",attach:"body"},{default:a(()=>[t("div",Bk,[t("div",zk,[t("div",Pk,[e(b,{name:"user-talk"}),p[11]||(p[11]=v(" 方式一：联系管理员",-1))]),p[12]||(p[12]=t("p",{class:"guide-desc"},"如果系统中存在其他管理员账号，请联系对应人员协助您在后台重置密码。",-1))]),e(w,{dashed:"",style:{margin:"16px 0"}}),t("div",Rk,[t("div",Ek,[e(b,{name:"refresh"}),p[13]||(p[13]=v(" 方式二：初始化默认账户",-1))]),p[15]||(p[15]=t("p",{class:"guide-desc"},"若无法联系其他管理员，请在服务器端删除以下配置文件：",-1)),p[16]||(p[16]=t("div",{class:"code-block"},"DaemonData/Configs/UserList.json",-1)),t("p",null,[e(A,{style:{"margin-top":"10px"}},{default:a(()=>[...p[14]||(p[14]=[v("操作提示：删除该文件后，请",-1),t("strong",null,"重启守护进程",-1),v("。系统将自动重新创建包含默认账号密码的初始文件。",-1)])]),_:1})])])])]),_:1},8,["visible"])])}}}),Dk=ie(Fk,[["__scopeId","data-v-b95f4e77"]]),Ok={class:"login-header"},jk={class:"logo"},Kk={class:"operations-container"},Nk=se({__name:"Header",setup(s){const l=it(),n=()=>{l.updateConfig({showSettingPanel:!0})},d=()=>{window.open("https://github.com/MSLTeam/MSLX")},i=()=>{window.open("https://mslx.mslmc.cn")};return(u,f)=>{const r=m("t-icon"),c=m("t-button");return o(),C("header",Ok,[t("span",jk,[t("img",{src:qa,class:ke(`${k(ze)}-side-nav-logo-img`),alt:"logo"},null,2),f[0]||(f[0]=t("span",null," MSLX 管理中心 ",-1))]),t("div",Kk,[e(c,{theme:"default",shape:"square",variant:"text",onClick:d},{default:a(()=>[e(r,{name:"logo-github",class:"icon"})]),_:1}),e(c,{theme:"default",shape:"square",variant:"text",onClick:i},{default:a(()=>[e(r,{name:"help-circle",class:"icon"})]),_:1}),e(c,{theme:"default",shape:"square",variant:"text",onClick:n},{default:a(()=>[e(r,{name:"setting",class:"icon"})]),_:1})])])}}}),al=ie(Nk,[["__scopeId","data-v-a538553e"]]),qk={class:"login-content"},Gk={class:"login-container"},Hk={class:"copyright"},Jk={class:"welcome-content"},Wk={class:"account-card"},Xk={class:"info-row"},Qk={class:"label"},Yk={class:"info-row"},Zk={class:"label"},e3={name:"LoginIndex"},t3=se({...e3,setup(s){const l=Dt(),n=Ee(),d=(r,c)=>r?r.startsWith("http")?r:`${n.baseUrl||window.location.origin}/api/static/images/${r}`:c,i=ee(()=>{const r=l.settings;return{"--custom-bg-light":`url('${d(r.webPanelStyleLightBackground,Ga)}')`,"--custom-bg-dark":`url('${d(r.webPanelStyleDarkBackground,Ha)}')`}}),u=x(!1),f=()=>{u.value=!1;const r=new URL(window.location.href);r.searchParams.delete("initialize"),window.history.replaceState({},"",r)};return Ce(()=>{l.fetchSettings(),new URLSearchParams(window.location.search).get("initialize")==="true"&&(u.value=!0)}),(r,c)=>{const _=m("t-alert"),y=m("t-button"),M=m("t-dialog");return o(),C("div",{class:"login-wrapper",style:rt(i.value)},[e(al,{class:"login-header-fixed"}),t("div",qk,[t("div",Gk,[c[1]||(c[1]=t("div",{class:"title-container"},[t("h1",{class:"title"},"连接到 MSLX"),t("p",{class:"sub-title"},"网页管理中心")],-1)),e(Dk),t("footer",Hk,"Copyright @ 2021-"+I(new Date().getFullYear())+" MSLTeam",1)])]),e(Na,{class:"tdesign-setting-outside"}),e(M,{visible:u.value,"onUpdate:visible":c[0]||(c[0]=$=>u.value=$),footer:!1,"close-btn":!0,width:"480px",attach:"body",class:"welcome-dialog","on-close":f},{header:a(()=>[...c[2]||(c[2]=[t("div",{class:"dialog-header-row"},[t("span",{class:"emoji-icon"},"🎉"),t("span",{class:"header-text"},"欢迎使用 MSLX 开服器")],-1)])]),default:a(()=>[t("div",Jk,[e(_,{theme:"success",class:"security-alert"},{message:a(()=>[...c[3]||(c[3]=[v(" 您似乎是第一次使用？请查阅以下信息，然后开始享受您的MC开服之旅吧～ ",-1)])]),_:1}),t("div",Wk,[t("div",Xk,[t("span",Qk,[e(k(zt)),c[4]||(c[4]=v(" 默认账户:",-1))]),c[5]||(c[5]=t("span",{class:"value highlight"},"mslx",-1))]),t("div",Yk,[t("span",Zk,[e(k(Zt)),c[6]||(c[6]=v(" 默认密码:",-1))]),c[7]||(c[7]=t("span",{class:"value mono"},"请在MSLX守护进程端控制台查看",-1))])]),e(_,{theme:"warning",class:"security-alert"},{message:a(()=>[...c[8]||(c[8]=[v(" 安全提醒：请登录后",-1),t("b",null,[t("u",null,"立即修改默认的账户名和密码")],-1),v("，保障您的服务安全。 ",-1)])]),_:1}),e(y,{block:"",theme:"primary",size:"large",variant:"base",onClick:f},{icon:a(()=>[e(k(St))]),default:a(()=>[c[9]||(c[9]=v(" 我已知晓，立即登录 ",-1))]),_:1})])]),_:1},8,["visible"])],4)}}}),a3=ie(t3,[["__scopeId","data-v-786dd78b"]]),s3=Object.freeze(Object.defineProperty({__proto__:null,default:a3},Symbol.toStringTag,{value:"Module"})),l3={class:"login-panel"},n3={class:"login-container"},o3={class:"callback-content"},i3={key:0,class:"status-box"},r3={class:"loading-icon-wrapper"},u3={class:"tip-text"},d3={key:1,class:"status-box success"},c3={class:"desc"},m3={class:"sub-desc"},p3={class:"btn-group"},v3={key:2,class:"status-box error"},f3={class:"error-msg-box"},g3={class:"btn-group"},_3={class:"copyright"},h3=se({__name:"index",setup(s){const l=Ze(),n=Xt(),d=Ee(),i=Dt(),u=(U,p)=>U?U.startsWith("http")?U:`${d.baseUrl||window.location.origin}/api/static/images/${U}`:p,f=ee(()=>{const U=i.settings;return{"--custom-bg-light":`url('${u(U.webPanelStyleLightBackground,Ga)}')`,"--custom-bg-dark":`url('${u(U.webPanelStyleDarkBackground,Ha)}')`}}),r=x("loading"),c=x("正在验证身份..."),_=x(""),y=x(""),M=x(3),$=async()=>{const{code:U,state:p,mode:S}=l.query;if(!U||!p){r.value="error",_.value="无效的回调参数，缺少 Code 或 State。";return}const b=localStorage.getItem("oauth_state");if(localStorage.removeItem("oauth_state"),p!==b){r.value="error",_.value="安全校验失败 (State Mismatch)，请求可能被篡改。";return}try{if(S==="login")await V(U);else if(S==="bind")await h(U);else throw new Error("未知的操作模式")}catch(R){r.value="error",_.value=R.message||"处理请求时发生未知错误"}},V=async U=>{c.value="正在登录 MSLX...";try{const p=await Q.post({url:"/api/auth/oauth/login",data:{code:U}});await d.loginByOAuth(p),r.value="success",y.value=`欢迎回来，${d.userInfo.name||p.data.userInfo?.name}`,g("/dashboard/base")}catch(p){r.value="error",_.value=p.message}},h=async U=>{c.value="正在绑定 MSL 账号...";try{await Q.post({url:"/api/auth/oauth/bind",data:{code:U}}),r.value="success",y.value="账号绑定成功！",await d.getUserInfo(),g("/settings")}catch(p){B.error(p.message)}},g=U=>{const p=setInterval(()=>{M.value--,M.value<=0&&(clearInterval(p),Ie(U))},1e3)},z=()=>{Ie("/login")};return Ce(()=>{i.fetchSettings(),$()}),(U,p)=>{const S=m("t-loading"),b=m("t-button");return o(),C("div",{class:"login-wrapper",style:rt(f.value)},[e(al,{class:"login-header-fixed"}),t("div",l3,[t("div",n3,[p[5]||(p[5]=t("div",{class:"title-container"},[t("h1",{style:{"margin-bottom":"10px"},class:"title"},"MSL 统一身份认证")],-1)),t("div",o3,[r.value==="loading"?(o(),C("div",i3,[t("div",r3,[e(S,{size:"large"})]),t("p",u3,I(c.value),1)])):r.value==="success"?(o(),C("div",d3,[e(k(ga),{class:"icon-success"}),p[2]||(p[2]=t("h2",{class:"status-title"},"操作成功",-1)),t("p",c3,I(y.value),1),t("p",m3,I(M.value)+" 秒后自动跳转...",1),t("div",p3,[e(b,{block:"",size:"large",class:"login-btn",onClick:p[0]||(p[0]=R=>k(n).push("/dashboard/base"))},{default:a(()=>[...p[1]||(p[1]=[v(" 立即进入 ",-1)])]),_:1})])])):(o(),C("div",v3,[e(k(Os),{class:"icon-error"}),p[4]||(p[4]=t("h2",{class:"status-title"},"操作失败",-1)),t("div",f3,I(_.value),1),t("div",g3,[e(b,{block:"",size:"large",class:"login-btn",onClick:z},{default:a(()=>[...p[3]||(p[3]=[v(" 返回登录页 ",-1)])]),_:1})])]))]),t("footer",_3,"Copyright @ 2021-"+I(new Date().getFullYear())+" MSLTeam",1)])]),e(Na,{class:"tdesign-setting-outside"})],4)}}}),y3=ie(h3,[["__scopeId","data-v-4a099a27"]]),b3=Object.freeze(Object.defineProperty({__proto__:null,default:y3},Symbol.toStringTag,{value:"Module"})),w3={class:"result-content"},k3={class:"result-container"},$3={class:"action-box"},x3={class:"copyright"},A3=se({__name:"index",setup(s){const l=it(),n=ee(()=>l.displayMode);return(d,i)=>{const u=m("t-button");return o(),C("div",{class:ke(["result-wrapper",n.value])},[t("div",w3,[t("div",k3,[i[2]||(i[2]=t("div",{class:"result-info"},[t("h1",{class:"code"},"404"),t("h2",{class:"title"},"掉出了这个世界......"),t("p",{class:"desc"},[v("越过基岩的边界，只剩无尽的黑夜，"),t("br"),v("请点击重生，寻回原本的世界。")])],-1)),t("div",$3,[e(u,{theme:"primary",size:"large",block:"",class:"home-btn",onClick:i[0]||(i[0]=f=>k(Ie)("/"))},{default:a(()=>[...i[1]||(i[1]=[v(" 返回主页 ",-1)])]),_:1})]),t("footer",x3,"Copyright @ 2021-"+I(new Date().getFullYear())+" MSLTeam",1)])])],2)}}}),C3=ie(A3,[["__scopeId","data-v-86bbfa54"]]),S3=Object.freeze(Object.defineProperty({__proto__:null,default:C3},Symbol.toStringTag,{value:"Module"}));
