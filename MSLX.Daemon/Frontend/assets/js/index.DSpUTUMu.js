import{u as T,a as z}from"./vue-router.CTuarHf7.js";import{u as N,_ as x,a as P,b as X,p as D,T as H}from"./index.B9-4uGtK.js";import{M as V,N as F}from"./tdesign-vue-next.B9R1AJJu.js";import{D as S,F as g,W as G,K as Y,R as K,b0 as n,b1 as C,aY as p,b2 as s,aX as h,a$ as a,G as e,b6 as W,ao as L,aZ as Z,ap as j,b5 as A}from"./index.BbdIPky0.js";import"./pinia.DE9DXmFR.js";import"./pinia-plugin-persistedstate.n2tMOXAx.js";import"./tvision-color.BU_YHHaJ.js";import"./chroma-js.Cmk4elvR.js";import"./bezier-easing.jp9ayU57.js";import"./lodash.B5_zCkFd.js";import"./axios.R-lXtGyY.js";import"./qs.pfv2Cuas.js";import"./side-channel.B7VpeXu7.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.CD-SYzlK.js";import"./cron-parser.BqMfRICj.js";import"./luxon.BVaPVz1w.js";import"./side-channel-list.CQN2BsdT.js";import"./side-channel-map.mJjiYxsE.js";import"./get-intrinsic.DZF4l_-S.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.GRuZvLsk.js";import"./dunder-proto.BfGlLUzx.js";import"./call-bind-apply-helpers.DPbVMkjK.js";import"./function-bind.CHqF18-c.js";import"./hasown.B1sN64jK.js";import"./call-bound.DTRAK3sj.js";import"./side-channel-weakmap.C4d6frlU.js";import"./nprogress.CMq2Rk2a.js";import"./core-js-pure.DghWRT_o.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./lodash-es.ClUTdtmA.js";import"./tdesign-icons-vue-next.B3wvPiG1.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";const J={key:0,class:"loading-wrapper"},O={key:1,class:"input-group"},Q={class:"check-container"},ee="remembered_url",M="remembered_username",te=S({__name:"Login",setup(y){const c=N(),u=T(),b=z(),d=g(!1),_=g(!1),r=g(!1),l=g(!0),o=G({url:localStorage.getItem(ee)||"",username:localStorage.getItem(M)||"",password:"",checked:!!localStorage.getItem(M)}),$=g(),R=Y(()=>{const m={username:[{required:!0,message:"请输入用户名",type:"error"}],password:[{required:!0,message:"请输入密码",type:"error"}]};return r.value||(m.url=[{required:!0,message:"请输入服务器地址",type:"error"}]),m}),I=async()=>{l.value=!0,await c.checkConnection("")?(r.value=!0,o.url=""):r.value=!1,l.value=!1},U=async({validateResult:m})=>{if(m===!0){d.value=!0;try{await c.login({url:r.value?"":o.url,username:o.username,password:o.password,checked:o.checked}),V.success("登录成功");const t=b.query.redirect,w=t?decodeURIComponent(t):"/dashboard/base";u.push(w),F.success({content:`欢迎回来！${c.userInfo.name}`,title:"MSLX 控制台"})}catch(t){V.error(t.message||"登录失败，请检查账号密码")}finally{d.value=!1}}};return K(()=>{I()}),(m,t)=>{const w=n("t-loading"),f=n("t-icon"),k=n("t-input"),v=n("t-form-item"),E=n("t-checkbox"),q=n("t-button"),B=n("t-form");return p(),C(B,{ref_key:"form",ref:$,class:"login-form",data:o,rules:R.value,"label-width":"0",onSubmit:U},{default:s(()=>[l.value?(p(),h("div",J,[e(w,{text:"正在连接服务...",size:"small"})])):(p(),h("div",O,[r.value?W("",!0):(p(),C(v,{key:0,name:"url"},{default:s(()=>[e(k,{modelValue:o.url,"onUpdate:modelValue":t[0]||(t[0]=i=>o.url=i),size:"large",placeholder:"服务器地址 (如 localhost:1027)",class:"glass-input"},{"prefix-icon":s(()=>[e(f,{name:"server"})]),_:1},8,["modelValue"])]),_:1})),e(v,{name:"username"},{default:s(()=>[e(k,{modelValue:o.username,"onUpdate:modelValue":t[1]||(t[1]=i=>o.username=i),size:"large",placeholder:"请输入用户名",class:"glass-input"},{"prefix-icon":s(()=>[e(f,{name:"user"})]),_:1},8,["modelValue"])]),_:1}),e(v,{name:"password"},{default:s(()=>[e(k,{modelValue:o.password,"onUpdate:modelValue":t[3]||(t[3]=i=>o.password=i),size:"large",type:_.value?"text":"password",placeholder:"请输入密码",class:"glass-input"},{"prefix-icon":s(()=>[e(f,{name:"lock-on"})]),"suffix-icon":s(()=>[e(f,{name:_.value?"browse":"browse-off",style:{cursor:"pointer"},onClick:t[2]||(t[2]=i=>_.value=!_.value)},null,8,["name"])]),_:1},8,["modelValue","type"])]),_:1})])),a("div",Q,[e(E,{modelValue:o.checked,"onUpdate:modelValue":t[4]||(t[4]=i=>o.checked=i)},{default:s(()=>[...t[5]||(t[5]=[L("记住用户名",-1)])]),_:1},8,["modelValue"])]),e(v,{class:"btn-container"},{default:s(()=>[e(q,{block:"",size:"large",type:"submit",class:"login-btn",loading:d.value},{default:s(()=>[...t[6]||(t[6]=[L(" 登 录 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["data","rules"])}}}),oe=x(te,[["__scopeId","data-v-351eec5a"]]),se={class:"login-header"},ae={class:"logo"},ne={class:"operations-container"},re=S({__name:"Header",setup(y){const c=P(),u=()=>{c.updateConfig({showSettingPanel:!0})},b=()=>{window.open("https://github.com/MSLTeam/MSLX")},d=()=>{window.open("https://www.mslmc.cn")};return(_,r)=>{const l=n("t-icon"),o=n("t-button");return p(),h("header",se,[a("span",ae,[a("img",{src:X,class:Z(`${j(D)}-side-nav-logo-img`),alt:"logo"},null,2),r[0]||(r[0]=a("span",null," MSLX 管理中心 ",-1))]),a("div",ne,[e(o,{theme:"default",shape:"square",variant:"text",onClick:b},{default:s(()=>[e(l,{name:"logo-github",class:"icon"})]),_:1}),e(o,{theme:"default",shape:"square",variant:"text",onClick:d},{default:s(()=>[e(l,{name:"help-circle",class:"icon"})]),_:1}),e(o,{theme:"default",shape:"square",variant:"text",onClick:u},{default:s(()=>[e(l,{name:"setting",class:"icon"})]),_:1})])])}}}),ie=x(re,[["__scopeId","data-v-e76b0337"]]),le={class:"login-wrapper"},ce={class:"login-content"},ue={class:"login-container"},me={class:"copyright"},pe={name:"LoginIndex"},de=S({...pe,setup(y){return(c,u)=>(p(),h("div",le,[e(ie,{class:"login-header-fixed"}),a("div",ce,[a("div",ue,[u[0]||(u[0]=a("div",{class:"title-container"},[a("h1",{class:"title"},"连接到 MSLX"),a("p",{class:"sub-title"},"网页管理中心")],-1)),e(oe),a("footer",me,"Copyright @ 2021-"+A(new Date().getFullYear())+" MSLTeam",1)])]),e(H,{class:"tdesign-setting-outside"})]))}}),tt=x(de,[["__scopeId","data-v-e8cb8759"]]);export{tt as default};
