import{u as J,_ as I,F as Z,G as ee,H as X}from"./index.DUo0lIWi.js";import{a as z,b as $}from"./user.DEMuBEeM.js";import{z as te,aK as ae,aa as oe,aL as le,B as se,f as ne,U as re,ad as ie,ag as de,a3 as me,aM as ue,a1 as Q}from"./tdesign-icons-vue-next.B3wvPiG1.js";import{M as P,D as j}from"./tdesign-vue-next.B9R1AJJu.js";import{D as A,F as S,W as N,P as pe,b0 as l,b1 as L,aY as x,b2 as t,a$ as y,G as e,ao as v,b5 as q,aX as T,b6 as H,ap as s,O as ce,R as fe}from"./index.BbdIPky0.js";import"./pinia.DE9DXmFR.js";import"./pinia-plugin-persistedstate.n2tMOXAx.js";import"./vue-router.CTuarHf7.js";import"./tvision-color.BU_YHHaJ.js";import"./chroma-js.Cmk4elvR.js";import"./bezier-easing.jp9ayU57.js";import"./lodash.B5_zCkFd.js";import"./axios.R-lXtGyY.js";import"./qs.CnepGyXr.js";import"./side-channel.Bf-JVZLg.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.CD-SYzlK.js";import"./cron-parser.BqMfRICj.js";import"./luxon.BVaPVz1w.js";import"./side-channel-list.CQN2BsdT.js";import"./side-channel-map.BJ69Knz3.js";import"./get-intrinsic.CAdfHqt8.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.Cbri-GHQ.js";import"./dunder-proto.q7lw_6_J.js";import"./call-bind-apply-helpers.BxcZtPLH.js";import"./function-bind.BbkWVFrm.js";import"./hasown.ckq0ukzO.js";import"./call-bound.BO70H6sD.js";import"./side-channel-weakmap.BkoVKe_V.js";import"./nprogress.CMq2Rk2a.js";import"./core-js-pure.DghWRT_o.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./lodash-es.ClUTdtmA.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";const _e={class:"profile-header"},ge={class:"avatar-col"},be={class:"info-col"},ye={class:"main-row"},we={class:"nickname"},ve={class:"sub-row"},Ve={class:"username"},he={key:0,class:"last-login"},Pe=A({__name:"UserProfileCard",setup(F,{expose:d}){const V=J(),_=S(!1),a=S(!1),i=S(!1),w=S(""),f=S(""),p=S("qq"),n=N({id:"",username:"",name:"",avatar:"",role:"",apiKey:"",lastLoginTime:""}),m=N({changePassword:!1,newPassword:"",confirmPassword:""}),g=async()=>{_.value=!0;try{const c=await z();Object.assign(n,c),w.value=c.username;const o=c.avatar&&c.avatar.match(/nk=(\d+)/);o&&o[1]?(p.value="qq",f.value=o[1]):p.value="custom"}catch(c){P.error(c.message||"用户加载失败")}finally{_.value=!1}};pe(f,c=>{p.value==="qq"&&c&&(n.avatar=`https://q.qlogo.cn/g?b=qq&nk=${c}&s=640`)});const u=c=>{c==="qq"&&f.value&&(n.avatar=`https://q.qlogo.cn/g?b=qq&nk=${f.value}&s=640`)},B=()=>{n.apiKey&&navigator.clipboard.writeText(n.apiKey).then(()=>{P.success("API Key 已复制")})},D=()=>{const c=j.confirm({header:"重置 API 密钥",theme:"warning",body:"重置后，所有使用旧 Key 的外部工具将立即失效，确定要继续吗？",onConfirm:async()=>{try{c.hide(),await $({resetApiKey:!0}),P.success("API Key 重置成功");const o=await z();n.apiKey=o.apiKey}catch(o){P.error(o.message||"重置失败")}}})},r=async()=>{if(m.changePassword){if(!m.newPassword){P.warning("请输入新密码");return}if(m.newPassword!==m.confirmPassword){P.error("两次输入的密码不一致");return}}const c=n.username!==w.value,o=m.changePassword&&!!m.newPassword;a.value=!0;try{const U={username:n.username,name:n.name,avatar:n.avatar,password:o?m.newPassword:void 0,resetApiKey:!1};await $(U),m.changePassword=!1,m.newPassword="",m.confirmPassword="",w.value=n.username,P.success("个人信息保存成功"),c||o?j.alert({header:"重新登录",body:"账号或密码已变更，请重新登录以生效。",confirmBtn:"去登录",onConfirm:async()=>{await V.logout(),window.location.reload()}}):await V.getUserInfo()}catch(U){P.error(U.message)}finally{a.value=!1}};return d({initData:g}),(c,o)=>{const U=l("t-avatar"),M=l("t-tag"),K=l("t-divider"),O=l("t-radio-button"),R=l("t-radio-group"),k=l("t-input"),h=l("t-space"),C=l("t-form-item"),W=l("t-button"),G=l("t-switch"),E=l("t-form"),Y=l("t-card");return x(),L(Y,{bordered:!1,loading:_.value,class:"settings-card"},{default:t(()=>[y("div",_e,[y("div",ge,[e(U,{image:n.avatar,size:"80px",shape:"circle",class:"user-avatar-shadow"},{default:t(()=>[v(q(n.name?n.name.slice(0,1).toUpperCase():"U"),1)]),_:1},8,["image"])]),y("div",be,[y("div",ye,[y("span",we,q(n.name||"未设置昵称"),1),n.role==="admin"?(x(),L(M,{key:0,theme:"success",variant:"light",size:"small",shape:"round"},{default:t(()=>[...o[8]||(o[8]=[v("管理员",-1)])]),_:1})):(x(),L(M,{key:1,theme:"primary",variant:"light",size:"small",shape:"round"},{default:t(()=>[...o[9]||(o[9]=[v("普通用户",-1)])]),_:1}))]),y("div",ve,[y("span",Ve,"@"+q(n.username),1),n.lastLoginTime?(x(),T("span",he,[e(s(te)),v(" "+q(new Date(n.lastLoginTime).toLocaleString()),1)])):H("",!0)])])]),e(K),e(E,{ref:"userForm",data:n,"label-width":100,"label-align":"left",onSubmit:r},{default:t(()=>[e(C,{label:"头像设置"},{default:t(()=>[e(h,{direction:"vertical",style:{width:"100%"}},{default:t(()=>[e(R,{modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=b=>p.value=b),variant:"default-filled",onChange:u},{default:t(()=>[e(O,{value:"qq"},{default:t(()=>[e(s(ae)),o[10]||(o[10]=v(" QQ头像",-1))]),_:1}),e(O,{value:"custom"},{default:t(()=>[e(s(oe)),o[11]||(o[11]=v(" 链接",-1))]),_:1})]),_:1},8,["modelValue"]),p.value==="qq"?(x(),L(k,{key:0,modelValue:f.value,"onUpdate:modelValue":o[1]||(o[1]=b=>f.value=b),placeholder:"输入QQ号自动获取",type:"number"},{"prefix-icon":t(()=>[e(s(le))]),_:1},8,["modelValue"])):(x(),L(k,{key:1,modelValue:n.avatar,"onUpdate:modelValue":o[2]||(o[2]=b=>n.avatar=b),placeholder:"输入图片 URL 链接"},{"prefix-icon":t(()=>[e(s(se))]),_:1},8,["modelValue"]))]),_:1})]),_:1}),e(C,{label:"用户昵称",name:"name"},{default:t(()=>[e(k,{modelValue:n.name,"onUpdate:modelValue":o[3]||(o[3]=b=>n.name=b),placeholder:"显示的名称"},null,8,["modelValue"])]),_:1}),e(C,{label:"登录账号",name:"username"},{default:t(()=>[e(k,{modelValue:n.username,"onUpdate:modelValue":o[4]||(o[4]=b=>n.username=b),placeholder:"登录唯一标识"},null,8,["modelValue"])]),_:1}),e(C,{label:"API Key",help:"用于第三方工具连接的凭证，请妥善保管"},{default:t(()=>[e(k,{value:n.apiKey,type:i.value?"text":"password",readonly:"",placeholder:"点击重置生成 Key"},{suffix:t(()=>[e(W,{variant:"text",size:"small",onClick:B},{icon:t(()=>[e(s(ne))]),_:1}),e(W,{variant:"text",theme:"danger",size:"small",onClick:D},{icon:t(()=>[e(s(re))]),_:1})]),_:1},8,["value","type"])]),_:1}),e(K,{dashed:""}),e(C,{label:"修改密码"},{default:t(()=>[e(G,{modelValue:m.changePassword,"onUpdate:modelValue":o[5]||(o[5]=b=>m.changePassword=b)},null,8,["modelValue"])]),_:1}),m.changePassword?(x(),T(ce,{key:0},[e(C,{label:"新密码","required-mark":""},{default:t(()=>[e(k,{modelValue:m.newPassword,"onUpdate:modelValue":o[6]||(o[6]=b=>m.newPassword=b),type:"password",placeholder:"请输入新密码"},{"prefix-icon":t(()=>[e(s(ie))]),_:1},8,["modelValue"])]),_:1}),e(C,{label:"确认密码","required-mark":""},{default:t(()=>[e(k,{modelValue:m.confirmPassword,"onUpdate:modelValue":o[7]||(o[7]=b=>m.confirmPassword=b),type:"password",placeholder:"请再次输入新密码"},{"prefix-icon":t(()=>[e(s(de))]),_:1},8,["modelValue"])]),_:1})],64)):H("",!0),e(C,null,{default:t(()=>[e(W,{theme:"primary",type:"submit",loading:a.value,block:"",class:"action-btn"},{default:t(()=>[...o[12]||(o[12]=[v(" 保存个人资料 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["data"])]),_:1},8,["loading"])}}}),xe=I(Pe,[["__scopeId","data-v-5a4f930e"]]),Se={class:"status-label"},ke=A({__name:"SystemSettingsCard",emits:["refresh"],setup(F,{expose:d,emit:V}){const _=S(!1),a=S(!1),i=N({fireWallBanLocalAddr:!1,openWebConsoleOnLaunch:!0,neoForgeInstallerMirrors:"MSL Mirrors",listenHost:"localhost",listenPort:1027}),w=[{label:"官方源 (较慢)",value:"Official"},{label:"MSL镜像源 (推荐)",value:"MSL Mirrors"},{label:"MSL镜像源 - 备用",value:"MSL Mirrors Backup"}],f=V,p=async()=>{_.value=!0;try{const g=await Z();Object.assign(i,g)}catch(g){P.error(g.message||"系统设置加载失败")}finally{_.value=!1}},n=async()=>{a.value=!0;try{await ee(i),P.success("系统设置保存成功")}catch(g){P.error(g.message)}finally{a.value=!1}},m=()=>{p(),f("refresh")};return d({initData:p}),(g,u)=>{const B=l("t-button"),D=l("t-switch"),r=l("t-form-item"),c=l("t-select"),o=l("t-divider"),U=l("t-space"),M=l("t-input"),K=l("t-col"),O=l("t-row"),R=l("t-form"),k=l("t-card");return x(),L(k,{bordered:!1,title:"系统偏好设置",loading:_.value,class:"settings-card"},{actions:t(()=>[e(B,{theme:"primary",variant:"text",size:"small",onClick:m},{default:t(()=>[...u[5]||(u[5]=[v("刷新数据",-1)])]),_:1})]),default:t(()=>[e(R,{ref:"sysForm",data:i,"label-width":120,"label-align":"left",onSubmit:n},{default:t(()=>[u[8]||(u[8]=y("div",{class:"group-title"},"守护进程",-1)),e(r,{label:"自动打开控制台",help:"MSLX 守护进程启动成功后，是否自动登录网页端控制台。"},{default:t(()=>[e(D,{modelValue:i.openWebConsoleOnLaunch,"onUpdate:modelValue":u[0]||(u[0]=h=>i.openWebConsoleOnLaunch=h)},null,8,["modelValue"])]),_:1}),e(r,{label:"安装镜像源",help:"选择在自动安装 NeoForge / Forge 时所使用的镜像源。",style:{"margin-top":"6px"}},{default:t(()=>[e(c,{modelValue:i.neoForgeInstallerMirrors,"onUpdate:modelValue":u[1]||(u[1]=h=>i.neoForgeInstallerMirrors=h),options:w},null,8,["modelValue"])]),_:1}),e(o,{dashed:""}),u[9]||(u[9]=y("div",{class:"group-title"},"网络与安全",-1)),e(r,{label:"禁止本地访问",help:"开启后将禁止本地回环地址访问，增强安全性。"},{default:t(()=>[e(U,{align:"center"},{default:t(()=>[e(D,{modelValue:i.fireWallBanLocalAddr,"onUpdate:modelValue":u[2]||(u[2]=h=>i.fireWallBanLocalAddr=h)},null,8,["modelValue"]),y("span",Se,q(i.fireWallBanLocalAddr?"已开启":"已关闭"),1)]),_:1})]),_:1}),e(r,{label:"监听地址设置",help:"设置MSLX守护进程的监听地址。(需要重启守护进程生效,若不明白这是干什么的请一定不要修改！)",style:{"margin-top":"6px"}},{default:t(()=>[e(O,{gutter:16,style:{width:"100%"}},{default:t(()=>[e(K,{span:6},{default:t(()=>[e(M,{modelValue:i.listenHost,"onUpdate:modelValue":u[3]||(u[3]=h=>i.listenHost=h),placeholder:"localhost"},{"prefix-icon":t(()=>[e(s(me))]),_:1},8,["modelValue"])]),_:1}),e(K,{span:4,style:{display:"flex","align-items":"center"}},{default:t(()=>[u[6]||(u[6]=y("span",{style:{"margin-right":"8px",color:"var(--td-text-color-secondary)"}},":",-1)),e(M,{modelValue:i.listenPort,"onUpdate:modelValue":u[4]||(u[4]=h=>i.listenPort=h),placeholder:"1027",style:{width:"120px"}},{"prefix-icon":t(()=>[e(s(ue))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(r,null,{default:t(()=>[e(B,{theme:"primary",type:"submit",loading:a.value,block:"",class:"action-btn"},{default:t(()=>[...u[7]||(u[7]=[v(" 保存系统设置 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["data"])]),_:1},8,["loading"])}}}),Ce=I(ke,[["__scopeId","data-v-2ba6686a"]]),Ue=A({__name:"WebPanelStyleCard",setup(F){const d=X(),V=async(_,a)=>{var f;const i=((f=_[0])==null?void 0:f.raw)||_.raw;if(!i)return;const w=await d.uploadImage(i);w&&(d.settings[a]=w)};return(_,a)=>{const i=l("t-button"),w=l("t-upload"),f=l("t-input"),p=l("t-form-item"),n=l("t-divider"),m=l("t-slider"),g=l("t-col"),u=l("t-row"),B=l("t-form"),D=l("t-card");return x(),L(D,{bordered:!1,title:"面板自定义样式",description:"这里设置的样式需要在面板左上角的样式面板中启用背景美化才会生效哦！",loading:s(d).loading,class:"settings-card"},{default:t(()=>[e(B,{data:s(d).settings,"label-width":120,"label-align":"left",onSubmit:s(d).saveSettings},{default:t(()=>[a[11]||(a[11]=y("div",{class:"group-title"},"背景图片设置",-1)),e(p,{label:"浅色背景",help:"留空则使用默认的背景图哦～"},{default:t(()=>[e(f,{modelValue:s(d).settings.webPanelStyleLightBackground,"onUpdate:modelValue":a[1]||(a[1]=r=>s(d).settings.webPanelStyleLightBackground=r),placeholder:"输入完整URL地址或者在右边上传图片"},{suffix:t(()=>[e(w,{theme:"custom",action:"","auto-upload":!1,"show-file-list":!1,accept:"image/png, image/jpeg, image/webp",onChange:a[0]||(a[0]=r=>V(r,"webPanelStyleLightBackground"))},{default:t(()=>[e(i,{variant:"text",shape:"square"},{default:t(()=>[e(s(Q))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"深色背景"},{default:t(()=>[e(f,{modelValue:s(d).settings.webPanelStyleNightBackground,"onUpdate:modelValue":a[3]||(a[3]=r=>s(d).settings.webPanelStyleNightBackground=r),placeholder:"输入完整URL地址或者在右边上传图片"},{suffix:t(()=>[e(w,{theme:"custom","auto-upload":!1,"show-file-list":!1,accept:"image/png, image/jpeg, image/webp",onChange:a[2]||(a[2]=r=>V(r,"webPanelStyleNightBackground"))},{default:t(()=>[e(i,{variant:"text",shape:"square"},{default:t(()=>[e(s(Q))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(n,{dashed:""}),a[12]||(a[12]=y("div",{class:"group-title"},"透明度调整 (0.1 - 1.0)",-1)),e(u,{gutter:[32,16]},{default:t(()=>[e(g,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{label:"浅色背景透明度"},{default:t(()=>[e(m,{modelValue:s(d).settings.webPanelStyleLightBackgroundOpacity,"onUpdate:modelValue":a[4]||(a[4]=r=>s(d).settings.webPanelStyleLightBackgroundOpacity=r),min:.1,max:1,step:.01,"tooltip-props":{theme:"light"}},null,8,["modelValue"])]),_:1})]),_:1}),e(g,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{label:"浅色组件透明度"},{default:t(()=>[e(m,{modelValue:s(d).settings.webPanelStyleLightComponentsOpacity,"onUpdate:modelValue":a[5]||(a[5]=r=>s(d).settings.webPanelStyleLightComponentsOpacity=r),min:.1,max:1,step:.01,"tooltip-props":{theme:"light"}},null,8,["modelValue"])]),_:1})]),_:1}),e(g,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{label:"深色背景透明度"},{default:t(()=>[e(m,{modelValue:s(d).settings.webPanelStyleDarkBackgroundOpacity,"onUpdate:modelValue":a[6]||(a[6]=r=>s(d).settings.webPanelStyleDarkBackgroundOpacity=r),min:.1,max:1,step:.01},null,8,["modelValue"])]),_:1})]),_:1}),e(g,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{label:"深色组件透明度"},{default:t(()=>[e(m,{modelValue:s(d).settings.webPanelStyleDarkComponentsOpacity,"onUpdate:modelValue":a[7]||(a[7]=r=>s(d).settings.webPanelStyleDarkComponentsOpacity=r),min:.1,max:1,step:.01},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(n,{dashed:""}),a[13]||(a[13]=y("div",{class:"group-title"},"终端毛玻璃强度 (Blur)",-1)),e(u,{gutter:[32,16]},{default:t(()=>[e(g,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{label:"浅色模式模糊度"},{default:t(()=>[e(m,{modelValue:s(d).settings.webpPanelTerminalBlurLight,"onUpdate:modelValue":a[8]||(a[8]=r=>s(d).settings.webpPanelTerminalBlurLight=r),min:0,max:50,step:1,"input-number-props":{theme:"column",style:"width: 65px"}},{label:t(({value:r})=>[v(q(r)+"px ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(g,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{label:"深色模式模糊度"},{default:t(()=>[e(m,{modelValue:s(d).settings.webpPanelTerminalBlurDark,"onUpdate:modelValue":a[9]||(a[9]=r=>s(d).settings.webpPanelTerminalBlurDark=r),min:0,max:50,step:1,"input-number-props":{theme:"column",style:"width: 65px"}},{label:t(({value:r})=>[v(q(r)+"px ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(p,{style:{"margin-top":"24px"}},{default:t(()=>[e(i,{theme:"primary",type:"submit",loading:s(d).submitLoading,block:"",class:"action-btn"},{default:t(()=>[...a[10]||(a[10]=[v(" 应用样式设置 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["data","onSubmit"])]),_:1},8,["loading"])}}}),Le=I(Ue,[["__scopeId","data-v-4700348d"]]),qe={class:"settings-page"},Be=A({__name:"index",setup(F){const d=X(),V=S(),_=S(),a=async()=>{const i=[];V.value&&i.push(V.value.initData()),_.value&&i.push(_.value.initData()),i.push(d.fetchSettings()),await Promise.all(i)};return fe(()=>{a()}),(i,w)=>{const f=l("t-space");return x(),T("div",qe,[e(f,{direction:"vertical",size:"large",style:{width:"100%"}},{default:t(()=>[e(xe,{ref_key:"userCardRef",ref:V},null,512),e(Ce,{ref_key:"sysCardRef",ref:_,onRefresh:a},null,512),e(Le)]),_:1})])}}}),vt=I(Be,[["__scopeId","data-v-51250a07"]]);export{vt as default};
