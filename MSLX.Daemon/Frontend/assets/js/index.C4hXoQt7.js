import{u as re,b as ie}from"./frp.CRIaGsNe.js";import{c as Z,_ as ee,r as A}from"./index.C0RiS9Sp.js";import{M as w}from"./tdesign-vue-next.Csn1Y9JM.js";import{l as q,aZ as r,aU as u,aV as x,j as e,a$ as t,G as b,aY as l,r as L,k as te,w as de,o as ne,a_ as C,F as J,b0 as X,b2 as h,J as M,b3 as H,c as Q,f as ue,aW as me}from"./index.DuVfB4dr.js";import{g as ae,f as pe}from"./tools.CQnzORaS.js";import{a7 as se,ac as ce,aa as _e,U as fe,g as ve,ad as ge,ab as be}from"./tdesign-icons-vue-next.BalHEYKK.js";import"./pinia.K9HejpEf.js";import"./pinia-plugin-persistedstate_2eabddac918ad8d0cf74e67f4601f4c8.n2tMOXAx.js";import"./vue-router.BSuyFzNa.js";import"./tvision-color.Cy78gTfV.js";import"./chroma-js.DO2ptVd8.js";import"./core-js-pure.DbDavgKW.js";import"./bezier-easing.D5A5epFU.js";import"./lodash.CpoxsuHF.js";import"./axios.B9ygI19o.js";import"./qs.CsZETzAf.js";import"./side-channel.gyxQHTce.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.CWmL7r7A.js";import"./side-channel-list.DZ_HK50j.js";import"./side-channel-map.Ujj6CYbr.js";import"./get-intrinsic.DZF4l_-S.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.GRuZvLsk.js";import"./dunder-proto.BfGlLUzx.js";import"./call-bind-apply-helpers.DPbVMkjK.js";import"./function-bind.CHqF18-c.js";import"./hasown.B1sN64jK.js";import"./call-bound.DTRAK3sj.js";import"./side-channel-weakmap.D0YmY7JX.js";import"./nprogress.COlaCQ7y.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./lodash-es.sbUBen0f.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";const ye=re();async function oe(R,d,g,$="toml"){await ie(R,d,g,$),w.success("添加成功"),await ye.getTunnels(),Z("/frp/list")}const he={class:"custom-frp-container"},we=q({__name:"Custom",setup(R){const d=L(null),g=te({name:"",type:"toml",content:""}),$={name:[{required:!0,message:"请输入隧道名称",type:"error"}],content:[{required:!0,message:"配置文件内容不能为空",type:"error"}]},k=async({validateResult:n})=>{n===!0?await oe(g.name,g.content,"Custom",g.type):w.warning("请检查表单填写")},_=()=>{w.info("表单已重置")};return(n,a)=>{const p=r("t-input"),f=r("t-form-item"),y=r("t-radio-button"),v=r("t-radio-group"),F=r("t-textarea"),c=r("t-button"),s=r("t-space"),S=r("t-form"),I=r("t-card");return u(),x("div",he,[e(I,{bordered:!1},{header:t(()=>[...a[3]||(a[3]=[l("span",{style:{"font-weight":"bold","font-size":"16px"}},"自定义 Frp 隧道",-1)])]),default:t(()=>[e(S,{ref_key:"formRef",ref:d,data:g,rules:$,"label-align":"top",onReset:_,onSubmit:k},{default:t(()=>[e(f,{label:"隧道名称",name:"name"},{default:t(()=>[e(p,{modelValue:g.name,"onUpdate:modelValue":a[0]||(a[0]=B=>g.name=B),placeholder:"请输入隧道名称"},null,8,["modelValue"])]),_:1}),e(f,{label:"配置类型",name:"type"},{default:t(()=>[e(v,{modelValue:g.type,"onUpdate:modelValue":a[1]||(a[1]=B=>g.type=B),variant:"default-filled"},{default:t(()=>[e(y,{value:"toml"},{default:t(()=>[...a[4]||(a[4]=[b("TOML",-1)])]),_:1}),e(y,{value:"ini"},{default:t(()=>[...a[5]||(a[5]=[b("INI",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"隧道配置内容",name:"content"},{default:t(()=>[e(F,{modelValue:g.content,"onUpdate:modelValue":a[2]||(a[2]=B=>g.content=B),placeholder:`[common]
server_addr = 0.0.0.0
server_port = 7000`,autosize:{minRows:10,maxRows:25},class:"code-font-textarea"},null,8,["modelValue"])]),_:1}),e(f,null,{default:t(()=>[e(s,null,{default:t(()=>[e(c,{theme:"primary",type:"submit"},{default:t(()=>[...a[6]||(a[6]=[b("保存配置",-1)])]),_:1}),e(c,{theme:"default",variant:"base",type:"reset"},{default:t(()=>[...a[7]||(a[7]=[b("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})])}}}),ke=ee(we,[["__scopeId","data-v-1e7af47c"]]),xe=(R,d="MSL Login",g=500,$=600)=>{if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return window.open(R,"_blank"),null;const _=window.screenLeft!==void 0?window.screenLeft:window.screenX,n=window.screenTop!==void 0?window.screenTop:window.screenY,a=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,p=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,f=a/window.screen.availWidth,y=(a-g)/2/f+_,v=(p-$)/2/f+n,F=`
    scrollbars=yes,
    width=${g/f},
    height=${$/f},
    top=${v},
    left=${y}
  `,c=window.open(R,d,F);return c&&c.focus(),c},Ve={class:"custom-option-item"},$e={class:"node-name-text"},Pe={class:"node-tag-group"},Le={class:"node-detail-area"},Ie={class:"detail-tags-row"},Ue={class:"remarks-box"},ze=q({__name:"CreateTunnelDialog",props:{visible:{type:Boolean},token:{}},emits:["update:visible","success"],setup(R,{emit:d}){const g=R,$=d,k=L(!1),_=L(!1),n=L([]),a=te({nodeId:null,type:"tcp",localIP:"127.0.0.1",localPort:"25565",remotePort:"",name:"",remarks:"无",bindDomain:"",use_kcp:!1,extra_config:""}),p=Q(()=>n.value.find(c=>c.id===a.nodeId)||null),f=Q(()=>{const c=[{label:"免费节点",value:0,children:[]},{label:"高级节点",value:1,children:[]},{label:"超级节点",value:2,children:[]}];return n.value.forEach(s=>{const S=c.find(I=>I.value===s.allow_user_group);S&&S.children.push(s)}),c.filter(s=>s.children.length>0)}),y=()=>{if(p.value){const{min_open_port:c,max_open_port:s}=p.value;a.remotePort=(Math.floor(Math.random()*(s-c+1))+c).toString()}a.name=ae(8)},v=async()=>{k.value=!0;try{const c=await A.get({url:"/api/frp/nodeList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${g.token}`}});c.code===200&&(n.value=c.data,g.visible&&n.value.length>0&&!a.nodeId&&(a.nodeId=n.value[0].id,y()))}catch(c){w.error("加载节点失败"+c.message)}finally{k.value=!1}};de(()=>g.visible,c=>{c&&(n.value.length>0?(a.nodeId||(a.nodeId=n.value[0].id),y()):v())});const F=async()=>{var c;if(a.nodeId){_.value=!0;try{const s=await A.post({url:"/api/frp/addTunnel",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${g.token}`},data:{id:a.nodeId,type:a.type,local_ip:a.localIP,local_port:a.localPort,remote_port:a.remotePort,name:a.name,remarks:a.remarks,bind_domain:a.bindDomain,use_kcp:((c=p.value)==null?void 0:c.kcp_support)===1?a.use_kcp:!1,extra_config:a.extra_config||null}});s.code===200?(w.success("创建成功"),$("success"),$("update:visible",!1)):w.error(s.msg)}finally{_.value=!1}}};return ne(()=>{g.token&&v()}),(c,s)=>{const S=r("t-tag"),I=r("t-option"),B=r("t-option-group"),W=r("t-select"),K=r("t-col"),G=r("t-button"),O=r("t-row"),U=r("t-form-item"),N=r("t-input"),i=r("t-textarea"),o=r("t-form"),P=r("t-loading"),V=r("t-dialog");return u(),C(V,{attach:"body",visible:R.visible,header:"新建隧道",width:"580px","confirm-btn":{content:"提交创建",loading:_.value},onConfirm:F,onClose:s[10]||(s[10]=m=>$("update:visible",!1))},{default:t(()=>[e(P,{loading:k.value},{default:t(()=>[e(o,{data:a,"label-align":"right","label-width":100,class:"dialog-inner-form"},{default:t(()=>[e(U,{label:"选择节点",name:"nodeId"},{default:t(()=>[e(O,{gutter:8,style:{width:"100%"}},{default:t(()=>[e(K,{flex:"auto"},{default:t(()=>[e(W,{modelValue:a.nodeId,"onUpdate:modelValue":s[0]||(s[0]=m=>a.nodeId=m),placeholder:"请选择节点",onChange:y},{default:t(()=>[(u(!0),x(J,null,X(f.value,m=>(u(),C(B,{key:m.value,label:m.label},{default:t(()=>[(u(!0),x(J,null,X(m.children,z=>(u(),C(I,{key:z.id,value:z.id,label:z.node},{default:t(()=>[l("div",Ve,[l("span",$e,h(z.node),1),l("div",Pe,[e(S,{size:"small",variant:"outline",theme:"primary"},{default:t(()=>[b(h(z.bandwidth)+"M",1)]),_:2},1024),e(S,{size:"small",theme:z.status===1?"success":"danger"},{default:t(()=>[b(h(z.status===1?"在线":"离线"),1)]),_:2},1032,["theme"])])])]),_:2},1032,["value","label"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(K,{flex:"none"},{default:t(()=>[e(G,{variant:"outline",onClick:s[1]||(s[1]=m=>M(Z)("https://user.mslmc.net/frp/createTunnel"))},{default:t(()=>[...s[11]||(s[11]=[b(" 前往源站创建 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),p.value?(u(),C(U,{key:0,label:"节点详情"},{default:t(()=>[l("div",Le,[l("div",Ie,[e(S,{size:"small",variant:"outline",theme:"primary"},{default:t(()=>[b(h(p.value.bandwidth)+"Mbps",1)]),_:1}),e(S,{size:"small",theme:p.value.need_real_name?"success":"warning"},{default:t(()=>[b(h(p.value.need_real_name?"需要实名认证":"无需实名认证"),1)]),_:1},8,["theme"]),e(S,{size:"small",theme:p.value.status===1?"success":"danger"},{default:t(()=>[b(" 节点状态："+h(p.value.status===1?"在线":"离线"),1)]),_:1},8,["theme"])]),l("div",Ue,[l("pre",null,h(p.value.remarks||"此节点暂无备注"),1)])])]),_:1})):H("",!0),e(U,{label:"隧道类型"},{default:t(()=>[e(W,{modelValue:a.type,"onUpdate:modelValue":s[2]||(s[2]=m=>a.type=m)},{default:t(()=>{var m,z,E;return[e(I,{label:"TCP",value:"tcp"}),(m=p.value)!=null&&m.udp_support?(u(),C(I,{key:0,label:"UDP",value:"udp"})):H("",!0),(z=p.value)!=null&&z.http_support?(u(),C(I,{key:1,label:"HTTP",value:"http"})):H("",!0),(E=p.value)!=null&&E.http_support?(u(),C(I,{key:2,label:"HTTPS",value:"https"})):H("",!0)]}),_:1},8,["modelValue"])]),_:1}),e(O,{gutter:[16,20]},{default:t(()=>[e(K,{span:6},{default:t(()=>[e(U,{label:"隧道名称"},{default:t(()=>[e(N,{modelValue:a.name,"onUpdate:modelValue":s[3]||(s[3]=m=>a.name=m)},null,8,["modelValue"])]),_:1})]),_:1}),e(K,{span:6},{default:t(()=>[e(U,{label:"远程端口"},{default:t(()=>[e(N,{modelValue:a.remotePort,"onUpdate:modelValue":s[4]||(s[4]=m=>a.remotePort=m)},{suffix:t(()=>[e(G,{variant:"text",size:"small",onClick:y},{default:t(()=>[...s[12]||(s[12]=[b("随机",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(K,{span:6},{default:t(()=>[e(U,{label:"本地IP"},{default:t(()=>[e(N,{modelValue:a.localIP,"onUpdate:modelValue":s[5]||(s[5]=m=>a.localIP=m)},null,8,["modelValue"])]),_:1})]),_:1}),e(K,{span:6},{default:t(()=>[e(U,{label:"本地端口"},{default:t(()=>[e(N,{modelValue:a.localPort,"onUpdate:modelValue":s[6]||(s[6]=m=>a.localPort=m)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a.type.includes("http")?(u(),C(U,{key:1,label:"绑定域名",class:"spacing-item"},{default:t(()=>[e(N,{modelValue:a.bindDomain,"onUpdate:modelValue":s[7]||(s[7]=m=>a.bindDomain=m),placeholder:"输入已解析的域名"},null,8,["modelValue"])]),_:1})):H("",!0),e(U,{label:"备注说明",class:"spacing-item"},{default:t(()=>[e(N,{modelValue:a.remarks,"onUpdate:modelValue":s[8]||(s[8]=m=>a.remarks=m)},null,8,["modelValue"])]),_:1}),e(U,{label:"额外参数",class:"spacing-item"},{default:t(()=>[e(i,{modelValue:a.extra_config,"onUpdate:modelValue":s[9]||(s[9]=m=>a.extra_config=m),autosize:{minRows:2},placeholder:"选填，高级配置参数（不懂清留空！！！）"},null,8,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:1},8,["loading"])]),_:1},8,["visible","confirm-btn"])}}}),Ce=ee(ze,[["__scopeId","data-v-8f82e481"]]),Se={class:"page-container"},Te={key:0,class:"login-container"},Me={class:"login-card"},Re={class:"icon-wrapper"},Be={key:1,class:"dashboard-container"},Ae={class:"stat-item"},De={class:"value"},He={class:"stat-item"},Fe={class:"value"},Ke={class:"stat-item"},Ne={class:"value"},Ee={class:"stat-item"},qe={class:"value date-text"},We={class:"list-header"},Ge={class:"tunnel-list"},Oe=["onClick"],Qe={class:"item-icon"},Ye={class:"item-content"},je={class:"item-title"},Je={class:"item-subtitle"},Xe={class:"item-status"},Ze={key:0,class:"empty-state"},et={key:0,class:"detail-content"},tt={class:"detail-header"},at={class:"remarks"},ot={class:"detail-grid"},lt={class:"val"},st={class:"detail-grid"},nt={class:"val uppercase"},rt={class:"detail-grid"},it={class:"val"},dt={class:"detail-grid"},ut={class:"val highlight"},mt={class:"detail-grid"},pt={class:"val"},ct={class:"detail-grid"},_t={class:"val"},ft={class:"action-area"},vt={key:1,class:"empty-detail"},gt=q({__name:"index",setup(R){const d=L(!1),g=()=>{I()},$=L("tKYvKk48Sq5kGAy12IJQxLEKhXx"),k=L(null),_=L(""),n=L(!1),a=L(null),p=L([]),f=L({}),y=L(null),v=Q(()=>p.value.find(i=>i.id===y.value)||null),F=Q(()=>v.value?f.value[v.value.node_id]||`未知节点 (${v.value.node_id})`:"");ne(()=>{const i=localStorage.getItem("msl-user-token");i&&(_.value=i,I())}),ue(()=>{k.value&&!k.value.closed&&k.value.close()});async function c(){w.info("正在跳转至MSL用户中心登录...");try{const i=ae(32),o=await A.post({url:"/api/oauth/createAppLogin",baseURL:"https://user.mslmc.net",data:{appid:$.value,csrf:i}});o.data.ssid?(k.value=xe(o.data.url,"登录到您的MSL账户",600,600),setTimeout(()=>s(i,o.data.ssid),1e3)):w.error(o.msg)}catch(i){w.error(i.message)}}async function s(i,o){var P;if(!((P=k.value)!=null&&P.closed)){try{const V=await A.get({url:"/api/oauth/appLogin",baseURL:"https://user.mslmc.net",params:{csrf:i,ssid:o}});if(V.data.token){k.value&&k.value.close(),w.success("登录成功"),_.value=V.data.token,localStorage.setItem("msl-user-token",V.data.token),I();return}}catch(V){w.error("登录失败！"+V.message);return}setTimeout(()=>s(i,o),1e3)}}const S=i=>{if(i===0)return"0 B";const o=1024,P=["B","KB","MB","GB","TB"],V=Math.floor(Math.log(i)/Math.log(o));return parseFloat((i/Math.pow(o,V)).toFixed(2))+" "+P[V]};async function I(){n.value=!0;try{const[i,o]=await Promise.all([A.get({url:"/api/frp/userInfo",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${_.value}`}}),A.get({url:"/api/frp/nodeList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${_.value}`}})]);if(i.code===200)a.value=i.data;else{w.warning("登录已过期，请重新登录～"),_.value="",localStorage.removeItem("msl-user-token");return}if(o.code===200){const V={};o.data.forEach(m=>{V[m.id]=m.node}),f.value=V}const P=await A.get({url:"/api/frp/getTunnelList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${_.value}`}});P.code===200&&(p.value=P.data,p.value.length>0&&(y.value=p.value[0].id))}catch(i){w.error("数据加载失败: "+i.message)}finally{n.value=!1}}const B=L(!1);async function W(){if(v.value){B.value=!0;try{const i=await A.get({url:"/api/frp/getTunnelConfig",baseURL:"https://user.mslmc.net",params:{id:v.value.id},headers:{Authorization:`Bearer ${_.value}`}});i.code===200?await oe(v.value.name,i.data,"MSLFrp"):w.error(i.msg)}catch(i){w.error("获取配置失败: "+i.message)}B.value=!1}}const K=()=>{d.value=!0};async function G(){try{await A.get({url:"/api/user/logout",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${_.value}`}}),_.value="",a.value=null,p.value=[],localStorage.removeItem("msl-user-token"),w.success("已退出登录")}catch(i){w.error("退出失败: "+i.message)}}async function O(){await I(),w.success("数据已更新")}const U=L(!1);async function N(){if(v.value){U.value=!0;try{const i=await A.post({url:"/api/frp/deleteTunnel",baseURL:"https://user.mslmc.net",data:{id:v.value.id},headers:{Authorization:`Bearer ${_.value}`}});i.code===200?(w.success("隧道删除成功"),y.value=null,await I()):w.error(i.msg||"删除失败")}catch(i){w.error("操作失败: "+i.message)}finally{U.value=!1}}}return(i,o)=>{const P=r("t-button"),V=r("t-space"),m=r("t-loading"),z=r("t-tag"),E=r("t-popconfirm"),T=r("t-col"),Y=r("t-row"),j=r("t-card"),le=r("t-divider");return u(),x("div",Se,[_.value===""?(u(),x("div",Te,[l("div",Me,[l("div",Re,[e(M(se),{size:"48px",style:{color:"var(--td-brand-color)"}})]),o[4]||(o[4]=l("h2",{class:"title"},"欢迎登录 MSLFrp",-1)),o[5]||(o[5]=l("p",{class:"subtitle"},"登录您的MSL账户以使用 MSLFrp 服务",-1)),e(V,{direction:"vertical",size:"medium",style:{width:"100%"}},{default:t(()=>[e(P,{block:"",theme:"primary",size:"large",onClick:c},{icon:t(()=>[e(M(se))]),default:t(()=>[o[2]||(o[2]=b(" 跳转用户中心登录 ",-1))]),_:1}),e(P,{theme:"default",variant:"outline",block:"",size:"large",onClick:o[0]||(o[0]=D=>M(Z)("https://user.mslmc.net/register"))},{icon:t(()=>[e(M(ce))]),default:t(()=>[o[3]||(o[3]=b(" 注册 MSL 账户 ",-1))]),_:1})]),_:1})])])):(u(),x("div",Be,[e(m,{attach:"#app-space",loading:n.value,text:"加载数据中..."},null,8,["loading"]),e(V,{id:"app-space",direction:"vertical",size:"large",style:{width:"100%"}},{default:t(()=>[a.value?(u(),C(j,{key:0,bordered:!1,title:"MSLFrp 用户信息",class:"info-card"},{actions:t(()=>[e(V,{size:"small"},{default:t(()=>[e(z,{theme:"primary",variant:"light"},{default:t(()=>[b(h(a.value.user_group_name),1)]),_:1}),e(E,{content:"确认退出登录吗？",onConfirm:G},{default:t(()=>[e(P,{variant:"text",theme:"danger",size:"small"},{default:t(()=>[...o[6]||(o[6]=[b(" 退出登录 ",-1)])]),_:1})]),_:1})]),_:1})]),default:t(()=>[e(Y,{gutter:[16,16]},{default:t(()=>[e(T,{xs:6,sm:3},{default:t(()=>[l("div",Ae,[o[7]||(o[7]=l("div",{class:"label"},"用户昵称",-1)),l("div",De,h(a.value.name),1)])]),_:1}),e(T,{xs:6,sm:3},{default:t(()=>[l("div",He,[o[8]||(o[8]=l("div",{class:"label"},"隧道限额",-1)),l("div",Fe,h(a.value.maxTunnelCount)+" 条",1)])]),_:1}),e(T,{xs:6,sm:3},{default:t(()=>[l("div",Ke,[o[9]||(o[9]=l("div",{class:"label"},"速率限制",-1)),l("div",Ne,h(a.value.boundLimit/1024*8)+" Mbps",1)])]),_:1}),e(T,{xs:6,sm:3},{default:t(()=>[l("div",Ee,[o[10]||(o[10]=l("div",{class:"label"},"到期时间",-1)),l("div",qe,h(M(pe)(a.value.outdated)),1)])]),_:1})]),_:1})]),_:1})):H("",!0),e(Y,{gutter:[16,16]},{default:t(()=>[e(T,{xs:12,md:5,lg:4},{default:t(()=>[e(j,{bordered:!1,class:"full-height-card"},{title:t(()=>[l("div",We,[o[13]||(o[13]=l("span",null,"我的隧道",-1)),e(V,{size:"4px"},{default:t(()=>[e(P,{style:{"margin-left":"3px"},size:"small",variant:"text",loading:n.value,onClick:O},{icon:t(()=>[e(M(fe))]),default:t(()=>[o[11]||(o[11]=b(" 刷新 ",-1))]),_:1},8,["loading"]),e(P,{size:"small",variant:"text",onClick:K},{icon:t(()=>[e(M(ve))]),default:t(()=>[o[12]||(o[12]=b(" 新建 ",-1))]),_:1})]),_:1})])]),default:t(()=>[l("div",Ge,[(u(!0),x(J,null,X(p.value,D=>(u(),x("div",{key:D.id,class:me(["tunnel-item",{active:y.value===D.id}]),onClick:Lt=>y.value=D.id},[l("div",Qe,[e(M(_e))]),l("div",Ye,[l("div",je,h(D.name),1),l("div",Je,h(f.value[D.node_id]||`Node ${D.node_id}`),1)]),l("div",Xe,[D.status===1?(u(),C(z,{key:0,theme:"success",variant:"light",size:"small"},{default:t(()=>[...o[14]||(o[14]=[b("在线",-1)])]),_:1})):(u(),C(z,{key:1,theme:"default",variant:"light",size:"small"},{default:t(()=>[...o[15]||(o[15]=[b("未启动",-1)])]),_:1}))])],10,Oe))),128)),p.value.length===0?(u(),x("div",Ze,"暂无隧道")):H("",!0)])]),_:1})]),_:1}),e(T,{xs:12,md:7,lg:8},{default:t(()=>[e(j,{bordered:!1,class:"full-height-card"},{title:t(()=>[...o[16]||(o[16]=[l("span",null,"隧道详情",-1)])]),actions:t(()=>[v.value?(u(),C(E,{key:0,content:"确认删除此隧道吗？",theme:"danger",placement:"bottom-right",onConfirm:N},{default:t(()=>[e(P,{theme:"danger",variant:"text",loading:U.value},{default:t(()=>[...o[17]||(o[17]=[b(" 删除隧道 ",-1)])]),_:1},8,["loading"])]),_:1})):H("",!0)]),default:t(()=>[v.value?(u(),x("div",et,[l("div",tt,[l("h3",null,h(v.value.name),1),l("p",at,h(v.value.remarks||"暂无备注"),1)]),e(le),e(Y,{gutter:[24,24]},{default:t(()=>[e(T,{span:6},{default:t(()=>[l("div",ot,[o[18]||(o[18]=l("span",{class:"label"},"所在节点",-1)),l("span",lt,h(F.value),1)])]),_:1}),e(T,{span:6},{default:t(()=>[l("div",st,[o[19]||(o[19]=l("span",{class:"label"},"协议类型",-1)),l("span",nt,h(v.value.type),1)])]),_:1}),e(T,{span:6},{default:t(()=>[l("div",rt,[o[20]||(o[20]=l("span",{class:"label"},"本地地址",-1)),l("span",it,h(v.value.local_ip)+":"+h(v.value.local_port),1)])]),_:1}),e(T,{span:6},{default:t(()=>[l("div",dt,[o[21]||(o[21]=l("span",{class:"label"},"远程端口",-1)),l("span",ut,h(v.value.remote_port),1)])]),_:1}),e(T,{span:6},{default:t(()=>[l("div",mt,[o[22]||(o[22]=l("span",{class:"label"},"今日流量",-1)),l("span",pt,h(S(v.value.today_traffic*1024*1024)),1)])]),_:1}),e(T,{span:6},{default:t(()=>[l("div",ct,[o[23]||(o[23]=l("span",{class:"label"},"总流量",-1)),l("span",_t,h(S(v.value.total_traffic*1024*1024)),1)])]),_:1})]),_:1}),e(le),l("div",ft,[e(P,{theme:"primary",size:"large",loading:B.value,block:"",onClick:W},{icon:t(()=>[e(M(ge))]),default:t(()=>[o[24]||(o[24]=b(" 使用此隧道 ",-1))]),_:1},8,["loading"])])])):(u(),x("div",vt,[e(M(be),{size:"48px",style:{color:"var(--td-text-color-disabled)"}}),o[25]||(o[25]=l("p",null,"请在左侧选择一个隧道查看详情",-1))]))]),_:1})]),_:1})]),_:1})]),_:1})])),d.value?(u(),C(Ce,{key:2,visible:d.value,"onUpdate:visible":o[1]||(o[1]=D=>d.value=D),token:_.value,onSuccess:g},null,8,["visible","token"])):H("",!0)])}}}),bt=ee(gt,[["__scopeId","data-v-30b389b4"]]);async function yt(){return await A.get({url:"/query/p2p_server",baseURL:"https://api.mslmc.cn/v3"})}const ht={key:0},wt={key:1},kt={key:0},xt={key:1},Vt={key:0},$t={key:1},Pt=q({__name:"MSLP2P",setup(R){const d=te({roomId:"",roomKey:"",bindPort:25565,isHoster:!0}),g={roomId:[{required:!0,message:"请输入房间号",type:"error"}],roomKey:[{required:!0,message:"请输入房间密钥",type:"error"}],bindPort:[{required:!0,message:"请输入绑定端口",type:"error"}]},$=async({validateResult:_})=>{_===!0?await k(d.isHoster,d.roomId,d.roomKey,d.bindPort):w.warning("请检查参数是否全部填写完成！")};async function k(_,n,a,p){try{const f=await yt();let y;_?y=`serverAddr = "${f.ip}"
serverPort = ${f.port}

[[proxies]]
name = "${n}"
type = "xtcp"
secretKey = "${a}"
localIP = "127.0.0.1"
localPort = ${p}`:y=`serverAddr = "${f.ip}"
serverPort = ${f.port}

[[visitors]]
name = "p2p_visitor"
type = "xtcp"
serverName = "${n}"
secretKey = "${a}"
bindAddr = "127.0.0.1"
bindPort = ${p}`,await oe(_?`「联机 - 房主」${n}`:`「联机 - 访客」${n}`,y,"MSL P2P")}catch(f){w.error(`创建联机隧道失败！${f.message}`)}}return(_,n)=>{const a=r("t-radio"),p=r("t-radio-group"),f=r("t-form-item"),y=r("t-input"),v=r("t-button"),F=r("t-form"),c=r("t-card");return u(),x("div",null,[e(c,{bordered:!1},{header:t(()=>[...n[5]||(n[5]=[l("span",{style:{"font-weight":"bold","font-size":"16px"}},"MSL P2P 联机隧道",-1)])]),default:t(()=>[e(F,{data:d,rules:g,"label-width":100,"label-align":"top","reset-type":"initial",onSubmit:$},{default:t(()=>[e(f,{label:"请选择联机类型",name:"isHoster"},{default:t(()=>[e(p,{modelValue:d.isHoster,"onUpdate:modelValue":n[0]||(n[0]=s=>d.isHoster=s)},{default:t(()=>[e(a,{value:!0},{default:t(()=>[...n[6]||(n[6]=[b("创建房间 - 房主",-1)])]),_:1}),e(a,{value:!1},{default:t(()=>[...n[7]||(n[7]=[b("加入房间 - 成员",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"房间号",name:"roomId"},{help:t(()=>[d.isHoster?(u(),x("span",ht,"建议填写您的QQ号码。")):(u(),x("span",wt,"请输入房间创建者提供的房间号。"))]),default:t(()=>[e(y,{modelValue:d.roomId,"onUpdate:modelValue":n[1]||(n[1]=s=>d.roomId=s),placeholder:"请输入房间号"},null,8,["modelValue"])]),_:1}),e(f,{label:"房间密钥",name:"roomKey"},{help:t(()=>[d.isHoster?(u(),x("span",kt,"随便写一个你喜欢的密钥。")):(u(),x("span",xt,"请输入房间创建者提供的密钥。"))]),default:t(()=>[e(y,{modelValue:d.roomKey,"onUpdate:modelValue":n[2]||(n[2]=s=>d.roomKey=s),placeholder:"请输入房间密钥"},null,8,["modelValue"]),d.isHoster?(u(),C(v,{key:0,theme:"default",variant:"base",style:{"margin-left":"5px"},onClick:n[3]||(n[3]=s=>{d.roomKey=M(ae)(16)})},{default:t(()=>[...n[8]||(n[8]=[b("随机生成",-1)])]),_:1})):H("",!0)]),_:1}),e(f,{label:"绑定端口",name:"bindPort"},{help:t(()=>[d.isHoster?(u(),x("span",Vt,"请输入游戏内提示的开放联机端口。")):(u(),x("span",$t,"建议保持默认。"))]),default:t(()=>[e(y,{modelValue:d.bindPort,"onUpdate:modelValue":n[4]||(n[4]=s=>d.bindPort=s),placeholder:"请输入绑定端口"},null,8,["modelValue"])]),_:1}),e(f,{style:{"margin-top":"16px"}},{default:t(()=>[e(v,{theme:"primary",type:"submit"},{default:t(()=>[...n[9]||(n[9]=[b("添加隧道",-1)])]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})])}}}),fa=q({__name:"index",setup(R){const d=L(1);return(g,$)=>{const k=r("t-tab-panel"),_=r("t-tabs"),n=r("t-card");return u(),x("div",null,[e(n,{direction:"vertical"},{default:t(()=>[e(_,{modelValue:d.value,"onUpdate:modelValue":$[0]||($[0]=a=>d.value=a)},{default:t(()=>[e(k,{value:1,label:"MSLFrp","destroy-on-hide":!1},{default:t(()=>[e(bt,{style:{margin:"15px"}})]),_:1}),e(k,{value:2,label:"MSL 联机","destroy-on-hide":!1},{default:t(()=>[e(Pt,{style:{margin:"15px"}})]),_:1}),e(k,{value:3,label:"自定义Frp","destroy-on-hide":!1},{default:t(()=>[e(ke,{style:{margin:"15px"}})]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}});export{fa as default};
