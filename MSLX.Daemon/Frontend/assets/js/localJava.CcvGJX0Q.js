import{r as k,_ as W}from"./index.DKJwv0BD.js";import{M as _}from"./tdesign-vue-next.Csn1Y9JM.js";import{l as Y,w as Z,aZ as g,aU as o,a_ as F,a$ as h,aY as a,aV as r,F as S,b0 as $,aW as z,j as d,b2 as p,b3 as C,G as R,c as A,r as u}from"./index.DuVfB4dr.js";async function H(){return await k.get({url:"/query/server_classify",baseURL:"https://api.mslmc.cn/v3"})}async function O(i){return await k.get({url:`/query/available_versions/${i}`,baseURL:"https://api.mslmc.cn/v3"})}async function Q(i,m){return await k.get({url:`/download/server/${i}/${m}`,baseURL:"https://api.mslmc.cn/v3"})}const X={class:"core-selector-layout"},ee={class:"sidebar"},se={key:1,class:"category-list"},te=["onClick"],ae={class:"cat-icon"},oe={class:"cat-info"},ne={class:"cat-name"},re={class:"cat-desc"},ie={key:0,class:"cat-count"},le={class:"main-panel"},ce={class:"panel-section"},de={class:"section-header"},ue={class:"core-grid"},ve=["onClick"],ye={key:0,class:"empty-text"},_e={key:0,class:"panel-section"},ge={class:"section-header"},pe={class:"section-title"},me={class:"version-grid"},fe=["onClick"],he={key:0,class:"empty-text"},Ce=Y({__name:"ServerCoreSelector",props:{visible:{type:Boolean}},emits:["update:visible","confirm"],setup(i,{emit:m}){const K=i,B=m,x=A({get:()=>K.visible,set:e=>B("update:visible",e)}),b=u(!1),w=u(!1),l=u({}),L=u("plugins"),n=u(""),v=u([]),f=u(""),U=[{key:"plugins",name:"插件服务端",desc:"支持 Bukkit/Spigot/Paper 插件",icon:"app",dataKey:"pluginsCore"},{key:"forge_hybrid",name:"NeoForge 系混合服务端",desc:"同时支持 Neoforge/Forge模组 和 插件",icon:"layers",dataKey:"pluginsAndModsCore_Forge"},{key:"fabric_hybrid",name:"Fabric 混合服务端",desc:"同时支持 Fabric模组 和 插件",icon:"cpu",dataKey:"pluginsAndModsCore_Fabric"},{key:"vanilla",name:"原版服务端",desc:"Mojang 官方原版核心",icon:"tea",dataKey:"vanillaCore"},{key:"mod_forge",name:"NeoForge 模组服务端",desc:"纯 NeoForge/Forge 模组支持",icon:"tools",dataKey:"modsCore_Forge"},{key:"proxy",name:"代理服务端",desc:"BungeeCord / Velocity 等",icon:"share",dataKey:"proxyCore"}],j=A(()=>{const e=U.find(s=>s.key===L.value);return!e||!l.value?[]:l.value[e.dataKey]||[]}),M=A(()=>f.value?j.value.filter(e=>e.toLowerCase().includes(f.value.toLowerCase())):j.value),D=async()=>{b.value=!0;try{const e=await H();Array.isArray(e)&&e.length>0?l.value=e[0]:e&&!Array.isArray(e)&&(l.value=e)}catch(e){_.error("获取服务端分类失败"),console.error(e)}finally{b.value=!1}},I=e=>{L.value=e,n.value="",v.value=[],f.value=""},N=e=>{n.value!==e&&(n.value=e,q(e))},q=async e=>{w.value=!0,v.value=[];try{const s=await O(e);Array.isArray(s)&&s.length>0?v.value=s[0].versionList||[]:s&&!Array.isArray(s)&&(v.value=s.versionList||[])}catch(s){_.error(`获取 ${e} 版本列表失败`),console.error(s)}finally{w.value=!1}},G=async e=>{const s=_.loading("正在获取核心版本信息...",0);try{const c=await Q(n.value,e),y={core:n.value,version:e,url:c.url,sha256:c.sha256||"",filename:`${n.value}-${e}.jar`};_.close(s),B("confirm",y),x.value=!1}catch(c){_.close(s),_.error("获取核心的版本信息失败"),console.error(c)}};return Z(()=>K.visible,e=>{e&&!l.value.pluginsCore&&D()}),(e,s)=>{const c=g("t-loading"),y=g("t-icon"),J=g("t-input"),P=g("t-divider"),T=g("t-button"),E=g("t-dialog");return o(),F(E,{visible:x.value,"onUpdate:visible":s[2]||(s[2]=t=>x.value=t),header:"选择服务端核心",width:"85%",top:"5vh",attach:"body",footer:!1,"destroy-on-close":"",class:"core-selector-dialog"},{default:h(()=>[a("div",X,[a("div",ee,[s[3]||(s[3]=a("div",{class:"sidebar-title"},"服务端分类",-1)),s[4]||(s[4]=a("div",{class:"sidebar-desc"},"选择您需要的服务端类型",-1)),b.value?(o(),F(c,{key:0,loading:b.value,size:"small",text:"加载分类中..."},null,8,["loading"])):(o(),r("div",se,[(o(),r(S,null,$(U,t=>{var V;return a("div",{key:t.key,class:z(["category-item",{active:L.value===t.key}]),onClick:ke=>I(t.key)},[a("div",ae,[d(y,{name:t.icon},null,8,["name"])]),a("div",oe,[a("div",ne,p(t.name),1),a("div",re,p(t.desc),1),l.value[t.dataKey]?(o(),r("div",ie,p(((V=l.value[t.dataKey])==null?void 0:V.length)||0)+" 个核心 ",1)):C("",!0)])],10,te)}),64))]))]),a("div",le,[a("div",ce,[a("div",de,[s[5]||(s[5]=a("div",{class:"section-title"},"选择服务端核心",-1)),d(J,{modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=t=>f.value=t),placeholder:"搜索核心...",class:"search-input"},{"suffix-icon":h(()=>[d(y,{name:"search"})]),_:1},8,["modelValue"])]),a("div",ue,[(o(!0),r(S,null,$(M.value,t=>(o(),r("div",{key:t,class:z(["core-card",{active:n.value===t}]),onClick:V=>N(t)},[R(p(t)+" ",1),n.value===t?(o(),F(y,{key:0,name:"check",class:"check-icon"})):C("",!0)],10,ve))),128)),M.value.length===0?(o(),r("div",ye,"该分类下暂无核心")):C("",!0)])]),n.value?(o(),r("div",_e,[d(P),a("div",ge,[a("div",pe,p(n.value)+" 版本列表",1),d(T,{size:"small",variant:"text",onClick:s[1]||(s[1]=t=>q(n.value))},{icon:h(()=>[d(y,{name:"refresh"})]),default:h(()=>[s[6]||(s[6]=R("刷新 ",-1))]),_:1})]),d(c,{loading:w.value,size:"small",text:"获取版本中...",class:"loading-wrapper"},{default:h(()=>[a("div",me,[(o(!0),r(S,null,$(v.value,t=>(o(),r("div",{key:t,class:"version-item",onClick:V=>G(t)},p(t),9,fe))),128)),v.value.length===0&&!w.value?(o(),r("div",he," 未找到该核心的版本信息 ")):C("",!0)])]),_:1},8,["loading"])])):C("",!0)])])]),_:1},8,["visible"])}}}),xe=W(Ce,[["__scopeId","data-v-d0b97c53"]]);async function Le(i,m){return await k.get({url:"/query/jdk",baseURL:"https://api.mslmc.cn/v3",params:{os:i,arch:m}})}async function Fe(i=!1){return await k.get({url:"/api/java/list",params:{refresh:i},timeout:60*1e3})}export{xe as S,Fe as a,Le as g};
