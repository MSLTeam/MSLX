import{u as Z,b as j}from"./frp.bIgeS1kg.js";import{c as q,_ as Q,r as U}from"./index.Do1noIT9.js";import{M as v}from"./tdesign-vue-next.ClIZ97Cx.js";import{D as F,F as M,W as X,b0 as d,aX as _,aY as m,G as e,b2 as t,ao as g,a$ as s,K as O,R as J,aa as ee,ap as S,b1 as R,b6 as E,b5 as f,O as te,b3 as oe,aZ as se}from"./index.CWeK9ocq.js";import{f as ae,g as Y}from"./tools.CQnzORaS.js";import{a7 as G,ac as ne,aa as le,g as re,ad as ie,ab as de}from"./tdesign-icons-vue-next.o89AUH_k.js";import"./pinia.CwCJD8HV.js";import"./pinia-plugin-persistedstate_561243483b11dd07f5acf9e797fda690.n2tMOXAx.js";import"./vue-router.f8VyOqpO.js";import"./tvision-color.COTpcftn.js";import"./chroma-js.RLxBGt-u.js";import"./bezier-easing.qwUZoLR4.js";import"./lodash.C2dUGbaG.js";import"./axios.R-lXtGyY.js";import"./qs.XiX0Mm1J.js";import"./side-channel.D5_e29f9.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.C4p7aaXq.js";import"./cron-parser.BHsRiybt.js";import"./luxon.BVaPVz1w.js";import"./side-channel-list.Mptt8X3N.js";import"./side-channel-map.Ce19al5R.js";import"./get-intrinsic.DR3xEH2x.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.DDnjtmUu.js";import"./dunder-proto.BNaYEbSf.js";import"./call-bind-apply-helpers.WnuMKP1p.js";import"./function-bind.CHqF18-c.js";import"./hasown.B1sN64jK.js";import"./call-bound.Dbz9IhIv.js";import"./side-channel-weakmap.BlDgri06.js";import"./nprogress.BFWi6Yo1.js";import"./core-js-pure.DN77qAGa.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./lodash-es.ClUTdtmA.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";const ue=Z();async function W(V,r,u,p="toml"){await j(V,r,u,p),v.success("添加成功"),await ue.getTunnels(),q("/frp/list")}const me={class:"custom-frp-container"},pe=F({__name:"Custom",setup(V){const r=M(null),u=X({name:"",type:"toml",content:""}),p={name:[{required:!0,message:"请输入隧道名称",type:"error"}],content:[{required:!0,message:"配置文件内容不能为空",type:"error"}]},k=async({validateResult:a})=>{a===!0?await W(u.name,u.content,"Custom",u.type):v.warning("请检查表单填写")},c=()=>{v.info("表单已重置")};return(a,l)=>{const h=d("t-input"),n=d("t-form-item"),b=d("t-radio-button"),P=d("t-radio-group"),T=d("t-textarea"),$=d("t-button"),w=d("t-space"),B=d("t-form"),A=d("t-card");return m(),_("div",me,[e(A,{bordered:!1},{header:t(()=>[...l[3]||(l[3]=[s("span",{style:{"font-weight":"bold","font-size":"16px"}},"自定义 Frp 隧道",-1)])]),default:t(()=>[e(B,{ref_key:"formRef",ref:r,data:u,rules:p,"label-align":"top",onReset:c,onSubmit:k},{default:t(()=>[e(n,{label:"隧道名称",name:"name"},{default:t(()=>[e(h,{modelValue:u.name,"onUpdate:modelValue":l[0]||(l[0]=z=>u.name=z),placeholder:"请输入隧道名称"},null,8,["modelValue"])]),_:1}),e(n,{label:"配置类型",name:"type"},{default:t(()=>[e(P,{modelValue:u.type,"onUpdate:modelValue":l[1]||(l[1]=z=>u.type=z),variant:"default-filled"},{default:t(()=>[e(b,{value:"toml"},{default:t(()=>[...l[4]||(l[4]=[g("TOML",-1)])]),_:1}),e(b,{value:"ini"},{default:t(()=>[...l[5]||(l[5]=[g("INI",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(n,{label:"隧道配置内容",name:"content"},{default:t(()=>[e(T,{modelValue:u.content,"onUpdate:modelValue":l[2]||(l[2]=z=>u.content=z),placeholder:`[common]
server_addr = 0.0.0.0
server_port = 7000`,autosize:{minRows:10,maxRows:25},class:"code-font-textarea"},null,8,["modelValue"])]),_:1}),e(n,null,{default:t(()=>[e(w,null,{default:t(()=>[e($,{theme:"primary",type:"submit"},{default:t(()=>[...l[6]||(l[6]=[g("保存配置",-1)])]),_:1}),e($,{theme:"default",variant:"base",type:"reset"},{default:t(()=>[...l[7]||(l[7]=[g("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})])}}}),ce=Q(pe,[["__scopeId","data-v-1e7af47c"]]),_e=(V,r="MSL Login",u=500,p=600)=>{if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return window.open(V,"_blank"),null;const c=window.screenLeft!==void 0?window.screenLeft:window.screenX,a=window.screenTop!==void 0?window.screenTop:window.screenY,l=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,h=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,n=l/window.screen.availWidth,b=(l-u)/2/n+c,P=(h-p)/2/n+a,T=`
    scrollbars=yes,
    width=${u/n},
    height=${p/n},
    top=${P},
    left=${b}
  `,$=window.open(V,r,T);return $&&$.focus(),$},fe={class:"page-container"},ve={key:0,class:"login-container"},ge={class:"login-card"},be={class:"icon-wrapper"},ye={key:1,class:"dashboard-container"},he={class:"stat-item"},we={class:"value"},ke={class:"stat-item"},Le={class:"value"},xe={class:"stat-item"},$e={class:"value"},Me={class:"stat-item"},Se={class:"value date-text"},Ve={class:"list-header"},Pe={class:"tunnel-list"},Te=["onClick"],Ce={class:"item-icon"},ze={class:"item-content"},Ue={class:"item-title"},Be={class:"item-subtitle"},Ie={class:"item-status"},Re={key:0,class:"empty-state"},Fe={key:0,class:"detail-content"},Ae={class:"detail-header"},Ke={class:"remarks"},He={class:"detail-grid"},Ne={class:"val"},qe={class:"detail-grid"},Ee={class:"val uppercase"},We={class:"detail-grid"},De={class:"val"},Oe={class:"detail-grid"},Ge={class:"val highlight"},Qe={class:"detail-grid"},Xe={class:"val"},Ye={class:"detail-grid"},Ze={class:"val"},je={class:"action-area"},Je={key:1,class:"empty-detail"},et=F({__name:"MSLFrp",setup(V){const r=M("tKYvKk48Sq5kGAy12IJQxLEKhXx"),u=M(null),p=M(""),k=M(!1),c=M(null),a=M([]),l=M({}),h=M(null),n=O(()=>a.value.find(i=>i.id===h.value)||null),b=O(()=>n.value?l.value[n.value.node_id]||`未知节点 (${n.value.node_id})`:"");J(()=>{const i=localStorage.getItem("msl-user-token");i&&(p.value=i,w())}),ee(()=>{u.value&&!u.value.closed&&u.value.close()});async function P(){v.info("正在跳转至MSL用户中心登录...");try{const i=Y(32),o=await U.post({url:"/api/oauth/createAppLogin",baseURL:"https://user.mslmc.net",data:{appid:r.value,csrf:i}});o.data.ssid?(u.value=_e(o.data.url,"登录到您的MSL账户",600,600),setTimeout(()=>T(i,o.data.ssid),1e3)):v.error(o.msg)}catch(i){v.error(i.message)}}async function T(i,o){var L;if(!((L=u.value)!=null&&L.closed)){try{const y=await U.get({url:"/api/oauth/appLogin",baseURL:"https://user.mslmc.net",params:{csrf:i,ssid:o}});if(y.data.token){u.value&&u.value.close(),v.success("登录成功"),p.value=y.data.token,localStorage.setItem("msl-user-token",y.data.token),w();return}}catch(y){v.error("登录失败！"+y.message);return}setTimeout(()=>T(i,o),1e3)}}const $=i=>{if(i===0)return"0 B";const o=1024,L=["B","KB","MB","GB","TB"],y=Math.floor(Math.log(i)/Math.log(o));return parseFloat((i/Math.pow(o,y)).toFixed(2))+" "+L[y]};async function w(){k.value=!0;try{const[i,o]=await Promise.all([U.get({url:"/api/frp/userInfo",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${p.value}`}}),U.get({url:"/api/frp/nodeList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${p.value}`}})]);if(i.code===200)c.value=i.data;else{v.warning("登录已过期，请重新登录～"),p.value="",localStorage.removeItem("msl-user-token");return}if(o.code===200){const y={};o.data.forEach(I=>{y[I.id]=I.node}),l.value=y}const L=await U.get({url:"/api/frp/getTunnelList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${p.value}`}});L.code===200&&(a.value=L.data,a.value.length>0&&(h.value=a.value[0].id))}catch(i){v.error("数据加载失败: "+i.message)}finally{k.value=!1}}const B=M(!1);async function A(){if(n.value){B.value=!0;try{const i=await U.get({url:"/api/frp/getTunnelConfig",baseURL:"https://user.mslmc.net",params:{id:n.value.id},headers:{Authorization:`Bearer ${p.value}`}});i.code===200?await W(n.value.name,i.data,"MSLFrp"):v.error(i.msg)}catch(i){v.error("获取配置失败: "+i.message)}B.value=!1}}const z=()=>{v.info("请前往 MSL用户中心 创建新隧道"),q("https://user.mslmc.net/frp/createTunnel")};return(i,o)=>{const L=d("t-button"),y=d("t-space"),I=d("t-loading"),K=d("t-tag"),x=d("t-col"),H=d("t-row"),N=d("t-card"),D=d("t-divider");return m(),_("div",fe,[p.value===""?(m(),_("div",ve,[s("div",ge,[s("div",be,[e(S(G),{size:"48px",style:{color:"var(--td-brand-color)"}})]),o[3]||(o[3]=s("h2",{class:"title"},"欢迎登录 MSLFrp",-1)),o[4]||(o[4]=s("p",{class:"subtitle"},"登录您的MSL账户以使用 MSLFrp 服务",-1)),e(y,{direction:"vertical",size:"medium",style:{width:"100%"}},{default:t(()=>[e(L,{block:"",theme:"primary",size:"large",onClick:P},{icon:t(()=>[e(S(G))]),default:t(()=>[o[1]||(o[1]=g(" 跳转用户中心登录 ",-1))]),_:1}),e(L,{theme:"default",variant:"outline",block:"",size:"large",onClick:o[0]||(o[0]=C=>S(q)("https://user.mslmc.net/register"))},{icon:t(()=>[e(S(ne))]),default:t(()=>[o[2]||(o[2]=g(" 注册 MSL 账户 ",-1))]),_:1})]),_:1})])])):(m(),_("div",ye,[e(I,{attach:"#app-space",loading:k.value,text:"加载数据中..."},null,8,["loading"]),e(y,{id:"app-space",direction:"vertical",size:"large",style:{width:"100%"}},{default:t(()=>[c.value?(m(),R(N,{key:0,bordered:!1,title:"MSLFrp 用户信息",class:"info-card"},{actions:t(()=>[e(K,{theme:"primary",variant:"light"},{default:t(()=>[g(f(c.value.user_group_name),1)]),_:1})]),default:t(()=>[e(H,{gutter:[16,16]},{default:t(()=>[e(x,{xs:6,sm:3},{default:t(()=>[s("div",he,[o[5]||(o[5]=s("div",{class:"label"},"用户昵称",-1)),s("div",we,f(c.value.name),1)])]),_:1}),e(x,{xs:6,sm:3},{default:t(()=>[s("div",ke,[o[6]||(o[6]=s("div",{class:"label"},"隧道限额",-1)),s("div",Le,f(c.value.maxTunnelCount)+" 条",1)])]),_:1}),e(x,{xs:6,sm:3},{default:t(()=>[s("div",xe,[o[7]||(o[7]=s("div",{class:"label"},"速率限制",-1)),s("div",$e,f(c.value.boundLimit/1024*8)+" Mbps",1)])]),_:1}),e(x,{xs:6,sm:3},{default:t(()=>[s("div",Me,[o[8]||(o[8]=s("div",{class:"label"},"到期时间",-1)),s("div",Se,f(S(ae)(c.value.outdated)),1)])]),_:1})]),_:1})]),_:1})):E("",!0),e(H,{gutter:[16,16]},{default:t(()=>[e(x,{xs:12,md:5,lg:4},{default:t(()=>[e(N,{bordered:!1,class:"full-height-card"},{title:t(()=>[s("div",Ve,[o[10]||(o[10]=s("span",null,"我的隧道",-1)),e(L,{size:"small",variant:"text",onClick:z},{icon:t(()=>[e(S(re))]),default:t(()=>[o[9]||(o[9]=g(" 新建 ",-1))]),_:1})])]),default:t(()=>[s("div",Pe,[(m(!0),_(te,null,oe(a.value,C=>(m(),_("div",{key:C.id,class:se(["tunnel-item",{active:h.value===C.id}]),onClick:ut=>h.value=C.id},[s("div",Ce,[e(S(le))]),s("div",ze,[s("div",Ue,f(C.name),1),s("div",Be,f(l.value[C.node_id]||`Node ${C.node_id}`),1)]),s("div",Ie,[C.status===1?(m(),R(K,{key:0,theme:"success",variant:"light",size:"small"},{default:t(()=>[...o[11]||(o[11]=[g("在线",-1)])]),_:1})):(m(),R(K,{key:1,theme:"default",variant:"light",size:"small"},{default:t(()=>[...o[12]||(o[12]=[g("未启动",-1)])]),_:1}))])],10,Te))),128)),a.value.length===0?(m(),_("div",Re,"暂无隧道")):E("",!0)])]),_:1})]),_:1}),e(x,{xs:12,md:7,lg:8},{default:t(()=>[e(N,{bordered:!1,class:"full-height-card"},{title:t(()=>[...o[13]||(o[13]=[s("span",null,"隧道详情",-1)])]),default:t(()=>[n.value?(m(),_("div",Fe,[s("div",Ae,[s("h3",null,f(n.value.name),1),s("p",Ke,f(n.value.remarks||"暂无备注"),1)]),e(D),e(H,{gutter:[24,24]},{default:t(()=>[e(x,{span:6},{default:t(()=>[s("div",He,[o[14]||(o[14]=s("span",{class:"label"},"所在节点",-1)),s("span",Ne,f(b.value),1)])]),_:1}),e(x,{span:6},{default:t(()=>[s("div",qe,[o[15]||(o[15]=s("span",{class:"label"},"协议类型",-1)),s("span",Ee,f(n.value.type),1)])]),_:1}),e(x,{span:6},{default:t(()=>[s("div",We,[o[16]||(o[16]=s("span",{class:"label"},"本地地址",-1)),s("span",De,f(n.value.local_ip)+":"+f(n.value.local_port),1)])]),_:1}),e(x,{span:6},{default:t(()=>[s("div",Oe,[o[17]||(o[17]=s("span",{class:"label"},"远程端口",-1)),s("span",Ge,f(n.value.remote_port),1)])]),_:1}),e(x,{span:6},{default:t(()=>[s("div",Qe,[o[18]||(o[18]=s("span",{class:"label"},"今日流量",-1)),s("span",Xe,f($(n.value.today_traffic*1024*1024)),1)])]),_:1}),e(x,{span:6},{default:t(()=>[s("div",Ye,[o[19]||(o[19]=s("span",{class:"label"},"总流量",-1)),s("span",Ze,f($(n.value.total_traffic*1024*1024)),1)])]),_:1})]),_:1}),e(D),s("div",je,[e(L,{theme:"primary",size:"large",loading:B.value,block:"",onClick:A},{icon:t(()=>[e(S(ie))]),default:t(()=>[o[20]||(o[20]=g(" 使用此隧道 ",-1))]),_:1},8,["loading"])])])):(m(),_("div",Je,[e(S(de),{size:"48px",style:{color:"var(--td-text-color-disabled)"}}),o[21]||(o[21]=s("p",null,"请在左侧选择一个隧道查看详情",-1))]))]),_:1})]),_:1})]),_:1})]),_:1})]))])}}}),tt=Q(et,[["__scopeId","data-v-38261147"]]);async function ot(){return await U.get({url:"/query/p2p_server",baseURL:"https://api.mslmc.cn/v3"})}const st={key:0},at={key:1},nt={key:0},lt={key:1},rt={key:0},it={key:1},dt=F({__name:"MSLP2P",setup(V){const r=X({roomId:"",roomKey:"",bindPort:25565,isHoster:!0}),u={roomId:[{required:!0,message:"请输入房间号",type:"error"}],roomKey:[{required:!0,message:"请输入房间密钥",type:"error"}],bindPort:[{required:!0,message:"请输入绑定端口",type:"error"}]},p=async({validateResult:c})=>{c===!0?await k(r.isHoster,r.roomId,r.roomKey,r.bindPort):v.warning("请检查参数是否全部填写完成！")};async function k(c,a,l,h){try{const n=await ot();let b;c?b=`serverAddr = "${n.ip}"
serverPort = ${n.port}

[[proxies]]
name = "${a}"
type = "xtcp"
secretKey = "${l}"
localIP = "127.0.0.1"
localPort = ${h}`:b=`serverAddr = "${n.ip}"
serverPort = ${n.port}

[[visitors]]
name = "p2p_visitor"
type = "xtcp"
serverName = "${a}"
secretKey = "${l}"
bindAddr = "127.0.0.1"
bindPort = ${h}`,await W(c?`「联机 - 房主」${a}`:`「联机 - 访客」${a}`,b,"MSL P2P")}catch(n){v.error(`创建联机隧道失败！${n.message}`)}}return(c,a)=>{const l=d("t-radio"),h=d("t-radio-group"),n=d("t-form-item"),b=d("t-input"),P=d("t-button"),T=d("t-form"),$=d("t-card");return m(),_("div",null,[e($,{bordered:!1},{header:t(()=>[...a[5]||(a[5]=[s("span",{style:{"font-weight":"bold","font-size":"16px"}},"MSL P2P 联机隧道",-1)])]),default:t(()=>[e(T,{data:r,rules:u,"label-width":100,"label-align":"top","reset-type":"initial",onSubmit:p},{default:t(()=>[e(n,{label:"请选择联机类型",name:"isHoster"},{default:t(()=>[e(h,{modelValue:r.isHoster,"onUpdate:modelValue":a[0]||(a[0]=w=>r.isHoster=w)},{default:t(()=>[e(l,{value:!0},{default:t(()=>[...a[6]||(a[6]=[g("创建房间 - 房主",-1)])]),_:1}),e(l,{value:!1},{default:t(()=>[...a[7]||(a[7]=[g("加入房间 - 成员",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(n,{label:"房间号",name:"roomId"},{help:t(()=>[r.isHoster?(m(),_("span",st,"建议填写您的QQ号码。")):(m(),_("span",at,"请输入房间创建者提供的房间号。"))]),default:t(()=>[e(b,{modelValue:r.roomId,"onUpdate:modelValue":a[1]||(a[1]=w=>r.roomId=w),placeholder:"请输入房间号"},null,8,["modelValue"])]),_:1}),e(n,{label:"房间密钥",name:"roomKey"},{help:t(()=>[r.isHoster?(m(),_("span",nt,"随便写一个你喜欢的密钥。")):(m(),_("span",lt,"请输入房间创建者提供的密钥。"))]),default:t(()=>[e(b,{modelValue:r.roomKey,"onUpdate:modelValue":a[2]||(a[2]=w=>r.roomKey=w),placeholder:"请输入房间密钥"},null,8,["modelValue"]),r.isHoster?(m(),R(P,{key:0,theme:"default",variant:"base",style:{"margin-left":"5px"},onClick:a[3]||(a[3]=w=>{r.roomKey=S(Y)(16)})},{default:t(()=>[...a[8]||(a[8]=[g("随机生成",-1)])]),_:1})):E("",!0)]),_:1}),e(n,{label:"绑定端口",name:"bindPort"},{help:t(()=>[r.isHoster?(m(),_("span",rt,"请输入游戏内提示的开放联机端口。")):(m(),_("span",it,"建议保持默认。"))]),default:t(()=>[e(b,{modelValue:r.bindPort,"onUpdate:modelValue":a[4]||(a[4]=w=>r.bindPort=w),placeholder:"请输入绑定端口"},null,8,["modelValue"])]),_:1}),e(n,{style:{"margin-top":"16px"}},{default:t(()=>[e(P,{theme:"primary",type:"submit"},{default:t(()=>[...a[9]||(a[9]=[g("添加隧道",-1)])]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})])}}}),eo=F({__name:"index",setup(V){const r=M(1);return(u,p)=>{const k=d("t-tab-panel"),c=d("t-tabs"),a=d("t-card");return m(),_("div",null,[e(a,{direction:"vertical"},{default:t(()=>[e(c,{modelValue:r.value,"onUpdate:modelValue":p[0]||(p[0]=l=>r.value=l)},{default:t(()=>[e(k,{value:1,label:"MSLFrp","destroy-on-hide":!1},{default:t(()=>[e(tt,{style:{margin:"15px"}})]),_:1}),e(k,{value:2,label:"MSL 联机","destroy-on-hide":!1},{default:t(()=>[e(dt,{style:{margin:"15px"}})]),_:1}),e(k,{value:3,label:"自定义Frp","destroy-on-hide":!1},{default:t(()=>[e(ce,{style:{margin:"15px"}})]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}});export{eo as default};
