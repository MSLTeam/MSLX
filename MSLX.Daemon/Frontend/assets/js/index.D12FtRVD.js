import{a as he}from"./vue-router.CTuarHf7.js";import{F as _,bb as Ne,be as ze,D as ne,P as Q,R as ve,V as Ce,aa as Ve,aX as I,a$ as e,b5 as A,ak as dt,bd as ct,bk as vt,bi as mt,bj as pt,aY as p,K as te,G as t,b0 as U,b2 as s,b6 as F,aZ as we,b1 as j,ap as R,O as se,ao as m,b3 as ce,am as Ge,b4 as Je}from"./index.BbdIPky0.js";import{c as J}from"./ansi-colors.gpWjHU8Z.js";import{d as ft}from"./pinia.DE9DXmFR.js";import{u as Xe,_ as oe,f as gt,i as yt,g as bt,h as _t,k as kt,s as ht,l as wt,m as $t,r as Se,c as je}from"./index.DCaoGYGa.js";import{g as xt,b as Ct,u as Vt,c as St,d as de}from"./instance.DeaJh84e.js";import{S as Ut,g as Mt,a as Rt}from"./localJava.B0XC03Bn.js";import{M as X,N as Bt,D as Be}from"./tdesign-vue-next.DWJvSscW.js";import{ae as It,a3 as Lt,af as Ee,ag as Pe,a1 as Et,y as Ae,U as ke,_ as We,a4 as qe,ah as Ke,ai as He,aj as Pt,z as Ue,ak as At,g as Ot,c as Dt,al as Ft,a9 as Ye,aa as Ze,ad as Tt,M as Qe,am as Nt,an as zt,ao as Oe,ap as Re,aq as Gt,ar as De,a7 as Jt,as as Xt,at as jt,au as Wt,av as qt,aw as Kt,ax as Ht,ay as Yt}from"./tdesign-icons-vue-next.Q06Erwsy.js";import{F as Zt}from"./FileUploader.Cle6k-Gk.js";import{d as Qt}from"./cron-parser.BqMfRICj.js";import{D as ea}from"./docs.CxArFray.js";import{i as Fe}from"./echarts.J8iroDPP.js";import{V as ta}from"./zrender.B_NAtvFA.js";import"./core-js-pure.DghWRT_o.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./pinia-plugin-persistedstate_561243483b11dd07f5acf9e797fda690.n2tMOXAx.js";import"./tvision-color.BU_YHHaJ.js";import"./chroma-js.Cmk4elvR.js";import"./bezier-easing.jp9ayU57.js";import"./lodash.B5_zCkFd.js";import"./axios.R-lXtGyY.js";import"./qs.pfv2Cuas.js";import"./side-channel.B7VpeXu7.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.CD-SYzlK.js";import"./side-channel-list.CQN2BsdT.js";import"./side-channel-map.mJjiYxsE.js";import"./get-intrinsic.DZF4l_-S.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.GRuZvLsk.js";import"./dunder-proto.BfGlLUzx.js";import"./call-bind-apply-helpers.DPbVMkjK.js";import"./function-bind.CHqF18-c.js";import"./hasown.B1sN64jK.js";import"./call-bound.DTRAK3sj.js";import"./side-channel-weakmap.C4d6frlU.js";import"./nprogress.CMq2Rk2a.js";import"./lodash-es.ClUTdtmA.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";import"./luxon.BVaPVz1w.js";import"./tslib.BDyQ-Jie.js";const Ie=ft("instanceHub",()=>{const o=Xe(),g=_(null),x=_(!1),f=_(null),$=_(0),h=_(0);let k=Promise.resolve();const L=_({cpu:0,memBytes:0,memPercent:0}),u=new Set,i=new Set,b=new Set,z=n=>{h.value=n},E=n=>(k=k.then(async()=>{var w;if($.value++,((w=g.value)==null?void 0:w.state)==="Connected"&&f.value===n)return;g.value&&await T(),f.value=n,h.value=0;const{baseUrl:l,token:v}=o,M=new URL("/api/hubs/instanceControlHub",l||window.location.origin);v&&M.searchParams.append("x-user-token",v);const r=new Ne().withUrl(M.toString(),{withCredentials:!1}).configureLogging(ze.Warning).withAutomaticReconnect([0,2e3,5e3,1e4]).build();r.on("ReceiveLog",O=>{u.forEach(W=>W(O))}),r.on("RequireEULA",()=>{i.forEach(O=>O())}),r.on("CommandResult",(O,W)=>{b.forEach(q=>q(O,W))}),r.on("ReceiveStatus",(O,W,q)=>{if(String(O)!==String(n))return;let P=0;if(h.value>0){const D=h.value*1024*1024;P=q/D*100,P>100&&(P=100)}L.value={cpu:W,memBytes:q,memPercent:P}}),r.onreconnecting(()=>u.forEach(O=>O("\x1B[1;31m[System] 连接中断，尝试重连...\x1B[0m"))),r.onreconnected(async()=>{u.forEach(O=>O("\x1B[1;32m[System] 网络恢复，重新加入会话...\x1B[0m"));try{await r.invoke("JoinGroup",n)}catch(O){console.error(O)}});try{await r.start(),await r.invoke("JoinGroup",n),g.value=r,x.value=!0,u.forEach(O=>O("\x1B[1;32m[System] 已连接到实例控制服务\x1B[0m"))}catch(O){x.value=!1,u.forEach(W=>W(`\x1B[1;31m[Error] 连接失败: ${O.message}\x1B[0m`)),f.value=null,g.value=null}}),k),d=()=>(k=k.then(async()=>{$.value>0&&$.value--,$.value===0&&await T()}),k),T=async()=>{if(g.value)try{g.value.state==="Connected"&&f.value&&await g.value.invoke("LeaveGroup",f.value),await g.value.stop()}catch(n){console.warn(n)}g.value=null,x.value=!1,f.value=null,h.value=0,L.value={cpu:0,memBytes:0,memPercent:0}};return{isConnected:x,stats:L,currentServerId:f,connect:E,disconnect:d,setMaxMemory:z,sendCommand:async n=>{if(!g.value||g.value.state!=="Connected"||!f.value)throw new Error("未连接到服务");await g.value.invoke("SendCommand",f.value,n)},onLog:n=>(u.add(n),()=>u.delete(n)),onEula:n=>(i.add(n),()=>u.delete(n)),onCommandResult:n=>(b.add(n),()=>b.delete(n))}});J.enabled=!0;const aa=o=>o?(o.includes("Done")&&o.includes("!")&&(o=o.replace(/Done \((.*?)\)!/g,(g,x)=>`${J.green.bold("Done")} (${J.blue(x)})!`)),o.startsWith("[System]")&&(o=o.replace(/^\[System\]/,`[${J.blue.bold("System")}]`)),o.includes("[MSLX]")&&(o=o.replace(/\[MSLX\]/g,`[${J.magenta.bold("MSLX")}]`)),o.includes("[MSLX-Backup]")&&(o=o.replace(/\[MSLX-Backup\]/g,`[${J.magenta.bold("MSLX-Backup")}]`)),o.includes("[MSLX-Daemon]")&&(o=o.replace(/\[MSLX-Daemon\]/g,`[${J.magenta.bold("MSLX-Daemon")}]`)),o.startsWith(">>>")&&(o=o.replace(/^>>>/,J.red.bold(">>>"))),o=o.replace(/^\[(\d{2}:\d{2}:\d{2})\s+(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]:/,(g,x,f)=>{let $=f;switch(f){case"INFO":$=J.green("INFO");break;case"WARN":case"WARNING":$=J.magenta.bold("WARN");break;case"ERROR":case"FATAL":$=J.red.bold(f);break;case"DEBUG":$=J.blue("DEBUG");break}return`[${J.gray(x)} ${$}]:`}),/^\[\d{2}:\d{2}:\d{2}\]/.test(o)&&(o=o.replace(/^\[(\d{2}:\d{2}:\d{2})\]/,(g,x)=>`[${J.gray(x)}]`)),o=o.replace(/\[([^/]+)\/(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]/g,(g,x,f)=>{const $=J.blue(x);let h=f;switch(f){case"INFO":h=J.green("INFO");break;case"WARN":h=J.magenta("WARN");break;case"ERROR":h=J.red.bold("ERROR");break}return`[${$}/${h}]`}),o=o.replace(new RegExp("(?<=:\\s|^)\\s*\\[([a-zA-Z0-9_\\-.\\s]+)\\](?=\\s)","g"),(g,x)=>x==="System"||x.includes("MSLX")?g:` [${J.bold.black(x)}]`),o=o.replace(/(https?:\/\/[^\s]+)/g,g=>J.blue.underline(g)),o=o.replace(/\b\d+\.\d+(\.\d+)?(-[a-zA-Z0-9]+)?\b/g,g=>J.magenta(g)),o=o.replace(/\b\d+(\.\d+)?\s?(ms|s|%|MB|GB|KB)\b/gi,g=>J.blue(g)),o=o.replace(new RegExp("(\\u001b\\[[\\d;]*m)|((?<!\\d:\\d)\\b\\d+\\b(?!\\s*:\\s*\\d))","g"),(g,x,f)=>{if(x)return g;if(f){if(f.length>=4&&f.length<=6)return J.blue(f);if(f.length<=3)return J.blue(f)}return g}),o=o.replace(/(\*:\d{1,5})/,g=>J.blue.bold(g)),o=o.replace(/\b(Loaded|Saved|Starting|Started|Connected)\b/g,g=>J.green(g)),o=o.replace(/\bDone\b(?!\u001b)/g,J.green.bold("Done")),o=o.replace(/\b(Failed|Exception|Error|Caused by|Stopping|Closed)\b/g,g=>J.red.bold(g)),o=o.replace(/\b(Loading|Preparing|Generating|Saving|Using|Running)\b/g,g=>J.magenta(g)),o=o.replace(/\b(Minecraft|Paper|Velocity|Java)\b/gi,g=>J.bold.black(g)),o=o.replace(/'minecraft:[a-z_]+'/g,g=>J.magenta(g)),o=o.replace(/\n/g,`\r
`),o):"",la={class:"terminal-header"},sa={class:"tab-title"},na={class:"terminal-footer"},oa=ne({__name:"ServerTerminal",props:{serverId:{}},emits:["update"],setup(o,{expose:g,emit:x}){const f=o,$=x,h=Ie(),k=_(null),L=_(null);let u=null,i=null,b=null,z=null,E=null,d=null,T="";const c=_(""),y={dark:{background:"transparent",foreground:"#cccccc",cursor:"#cccccc",selectionBackground:"#264f78",black:"#000000",red:"#cd3131",green:"#0dbc79",yellow:"#e5e510",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"},light:{background:"transparent",foreground:"#333333",cursor:"#333333",selectionBackground:"#add6ff",black:"#000000",red:"#cd3131",green:"#00bc79",yellow:"#9d9d10",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"}};J.enabled=!0;const B=P=>aa(P),N=()=>{if(!L.value||!k.value)return;if(u){u.clear(),r();return}const P=document.documentElement.getAttribute("theme-mode")==="dark";u=new mt.Terminal({cursorBlink:!0,cursorStyle:"block",fontSize:13,fontFamily:'Menlo, Monaco, "Courier New", monospace',lineHeight:1.4,theme:P?y.dark:y.light,disableStdin:!1,convertEol:!0,allowTransparency:!0}),i=new pt.FitAddon,u.loadAddon(i),u.open(L.value),u.onData(Z=>n(Z));const D=()=>{if(L.value&&L.value.clientWidth>0&&L.value.clientHeight>0)try{i==null||i.fit()}catch(Z){console.warn(Z)}};b=new ResizeObserver(()=>window.requestAnimationFrame(D)),b.observe(k.value),setTimeout(D,100),r()},n=async P=>{!u||!f.serverId||(P==="\r"?(u.write(`\r
`),T.trim()&&await v(T),T=""):P===""?T.length>0&&(T=T.slice(0,-1),u.write("\b \b")):P>=" "&&(T+=P,u.write(P)))},l=async()=>{if(!c.value)return;const P=c.value;u==null||u.writeln(P),await v(P),c.value=""},v=async P=>{try{await h.sendCommand(P)}catch(D){u==null||u.writeln(`\x1B[1;31m[Error] ${D.message}\x1B[0m`)}},M=()=>{if(!u)return;const P=document.documentElement.getAttribute("theme-mode")==="dark";u.options.theme=P?y.dark:y.light},r=()=>{u==null||u.writeln("\x1B[1;34m[System]\x1B[0m 正在连接服务器控制台 ..."),u==null||u.writeln(`\x1B[1;34m[System]\x1B[0m 实例 ID: ${f.serverId}`),u==null||u.writeln("")},w=async()=>{f.serverId&&(E&&E(),E=h.onLog(P=>{u&&u.writeln(B(P)),P.startsWith("[MSLX]")&&$("update")}),d&&d(),d=h.onCommandResult((P,D)=>{P||u==null||u.writeln(`\x1B[1;31m[System] 指令执行反馈: ${D}\x1B[0m`)}),await h.connect(f.serverId))},O=async()=>{E&&E(),d&&d(),await h.disconnect()};return g({writeln:P=>u==null?void 0:u.writeln(P),clear:()=>{u==null||u.clear(),r()}}),Q(()=>f.serverId,async(P,D)=>{P!==D&&(await O(),N(),await w())}),ve(async()=>{await Ce(),N(),z=new MutationObserver(M),z.observe(document.documentElement,{attributes:!0,attributeFilter:["theme-mode"]}),await w()}),Ve(async()=>{z==null||z.disconnect(),b==null||b.disconnect(),u==null||u.dispose(),await O()}),(P,D)=>(p(),I("div",{ref_key:"terminalWrapper",ref:k,class:"terminal-wrapper"},[e("div",la,[D[1]||(D[1]=e("div",{class:"dots"},[e("span",{class:"dot red"}),e("span",{class:"dot yellow"}),e("span",{class:"dot green"})],-1)),e("div",sa,"MSLX 服务端控制台 | #"+A(o.serverId),1)]),e("div",{ref_key:"terminalBody",ref:L,class:"terminal-body"},null,512),e("div",na,[dt(e("input",{"onUpdate:modelValue":D[0]||(D[0]=Z=>c.value=Z),class:"cmd-input",placeholder:"发送控制台指令...",onKeyup:vt(l,["enter"])},null,544),[[ct,c.value]]),e("button",{class:"send-btn",onClick:l},"发送")])],512))}}),ia=oe(oa,[["__scopeId","data-v-343fefce"]]),ra={class:"settings-container"},ua={class:"setting-item"},da={class:"setting-control"},ca={class:"setting-item"},va={class:"setting-info"},ma={class:"desc"},pa={class:"setting-control"},fa={class:"setting-item"},ga={class:"setting-control"},ya={key:0,style:{"margin-top":"8px"}},ba={class:"setting-item"},_a={class:"setting-info"},ka={class:"title"},ha={class:"desc"},wa={class:"setting-control"},$a={class:"setting-item"},xa={class:"setting-control"},Ca={key:0,class:"core-tools-panel"},Va={key:0,class:"upload-progress"},Sa={class:"setting-item"},Ua={class:"setting-control flex-row"},Ma={class:"memory-input-group"},Ra={class:"memory-input-group"},Ba={class:"setting-item"},Ia={class:"setting-control flex-row"},La={class:"setting-info-desc-only"},Ea={style:{"font-size":"12px",color:"var(--td-text-color-placeholder)",cursor:"help"}},Pa={class:"setting-item"},Aa={class:"setting-control"},Oa={key:0,style:{"margin-top":"8px"}},Da={key:2,class:"setting-group-title"},Fa={key:3,class:"setting-item"},Ta={class:"setting-control"},Na={key:0,style:{"margin-top":"8px"}},za={class:"setting-item"},Ga={class:"setting-control"},Ja={key:4,class:"setting-item"},Xa={class:"setting-control"},ja={class:"setting-item"},Wa={class:"setting-control"},qa={class:"setting-item"},Ka={class:"setting-control"},Ha={class:"setting-item"},Ya={class:"setting-control"},Za={key:5,class:"setting-item"},Qa={class:"setting-control"},el={class:"setting-item"},tl={class:"setting-control flex-row"},al={class:"setting-item"},ll={class:"setting-control flex-row"},sl={class:"form-actions"},nl={class:"progress-body"},ol={id:"update-log-box",class:"log-box"},il={class:"time"},rl={key:0,class:"dialog-actions"},ul=ne({__name:"GeneralSettings",setup(o){const g=he(),x=Xe(),f=te(()=>{const V=g.params.serverId;return V?parseInt(V):NaN}),$=_(null),h=_(!1),k=_(!1),L=_(!1),u=[{label:"UTF-8",value:"utf-8"},{label:"GBK",value:"gbk"}],i=_({id:f.value,name:"",base:"",java:"",core:"",minM:1024,maxM:4096,args:"",yggdrasilApiAddr:"",backupMaxCount:20,backupDelay:10,backupPath:"MSLX://Backup/Instance",autoRestart:!1,forceAutoRestart:!0,ignoreEula:!1,runOnStartup:!1,inputEncoding:"utf-8",outputEncoding:"utf-8",fileEncoding:"utf-8",coreUrl:"",coreSha256:"",coreFileKey:""}),b=_("MB"),z=_("MB"),E=[{label:"MB",value:"MB"},{label:"GB",value:"GB"}],d=te({get:()=>{if(b.value==="GB"){const V=i.value.minM/1024;return Math.round(V*100)/100}return i.value.minM},set:V=>{i.value.minM=b.value==="GB"?Math.round(V*1024):V}}),T=te({get:()=>{if(z.value==="GB"){const V=i.value.maxM/1024;return Math.round(V*100)/100}return i.value.maxM},set:V=>{i.value.maxM=z.value==="GB"?Math.round(V*1024):V}}),c=_("custom"),y=_([]),B=_([]),N=_(""),n=_(""),l=async(V=!1)=>{try{V&&X.info("正在扫描 Java 环境...");const a=await Mt(x.userInfo.systemInfo.osType.toLowerCase().replace("os",""),x.userInfo.systemInfo.osArchitecture.toLowerCase());a&&Array.isArray(a)&&(y.value=a.map(K=>({label:`Java ${K} (在线)`,value:K})));const H=await Rt(V);B.value=H.map(K=>({label:`Java ${K.version} (${K.path})`,value:K.path})),V&&X.success("刷新成功")}catch(a){console.error(a)}};Q([c,N,n],([V,a,H])=>{V==="none"?i.value.java="none":V==="env"?i.value.java="java":V==="custom"||V==="local"?i.value.java=H:V==="online"&&(i.value.java=a?`MSLX://Java/${a}`:"")});const v=_("MSLX://Backup/Instance"),M=_("");Q([v,M],([V,a])=>{V==="custom"?i.value.backupPath=a:i.value.backupPath=V});const r=_(""),w=_(""),O=[{label:"官方/离线模式 (无)",value:"none"},{label:"MSL 统一身份验证 (MSL Skin)",value:"https://skin.mslmc.net/api/yggdrasil"},{label:"LittleSkin",value:"https://littleskin.cn/api/yggdrasil"},{label:"自定义服务器",value:"custom"}];Q([r,w],([V,a])=>{V==="none"?i.value.yggdrasilApiAddr="":V==="custom"?i.value.yggdrasilApiAddr=a:i.value.yggdrasilApiAddr=V});const W=_(!1),q=_(!1),P=_(null),D=_(!1),Z=_(0),G=_(""),ie=V=>{i.value.core=V.filename,i.value.coreUrl=V.url,i.value.coreSha256=V.sha256,i.value.coreFileKey="",W.value=!1,X.success(`已选择核心: ${V.filename}，保存后将自动下载`)},C=()=>{var V;return(V=P.value)==null?void 0:V.click()},ee=async V=>{var K;const a=V.target;if(!((K=a.files)!=null&&K.length))return;const H=a.files[0];if(i.value.coreFileKey)try{await gt(i.value.coreFileKey)}catch{console.error("删除上传失败")}G.value=H.name,D.value=!0,Z.value=0;try{const Y=(await yt()).uploadId,le=5*1024*1024,ge=Math.ceil(H.size/le);for(let re=0;re<ge;re++){const Me=H.slice(re*le,Math.min(H.size,(re+1)*le));await bt(Y,re,Me),Z.value=Math.floor((re+1)/ge*100)}const ye=await _t(Y,ge);i.value.coreFileKey=ye.uploadId,i.value.core=H.name,i.value.coreUrl="",X.success("文件上传就绪，保存后生效"),W.value=!1}catch(ae){X.error(`上传失败: ${ae.message}`)}finally{D.value=!1,a.value=""}},et=()=>{L.value||Bt.warning({title:"风险操作",content:"修改实例路径会导致面板无法找到原有文件。请确保您已手动移动了文件，或您明确知道自己在做什么。",duration:5e3}),L.value=!L.value},me=_(!1),pe=_(0),$e=_([]),ue=_(null),tt=te(()=>c.value==="none"?{name:[{required:!0,message:"服务器名称不能为空",trigger:"blur"}],base:[{required:!0,message:"基础路径不能为空",trigger:"blur"}],args:[{required:!0,message:"自定义模式必须填写启动命令",trigger:"blur"}]}:{name:[{required:!0,message:"服务器名称不能为空",trigger:"blur"}],base:[{required:!0,message:"基础路径不能为空",trigger:"blur"}],java:[{required:!0,message:"Java 环境不能为空",trigger:"change"}],core:[{required:!0,message:"核心文件名不能为空",trigger:"change"}],minM:[{required:!0,message:"必填",trigger:"blur"}],maxM:[{required:!0,message:"必填",trigger:"blur"}]}),fe=async()=>{if(f.value){h.value=!0;try{await l(),i.value.id=f.value;const V=await xt(f.value);if(i.value={...i.value,...V,coreUrl:"",coreFileKey:"",coreSha256:""},b.value=V.minM>0&&V.minM%1024===0?"GB":"MB",z.value=V.maxM>0&&V.maxM%1024===0?"GB":"MB",L.value=!1,V.java==="none")c.value="none";else if(V.java==="java")c.value="env";else if(V.java.startsWith("MSLX://Java/"))c.value="online",N.value=V.java.replace("MSLX://Java/","");else{const K=B.value.find(ae=>ae.value===V.java);c.value=K?"local":"custom",n.value=V.java}const a=V.backupPath;a==="MSLX://Backup/Instance"||a==="MSLX://Backup/Data"?v.value=a:(v.value="custom",M.value=a);const H=V.yggdrasilApiAddr;H?H==="https://skin.mslmc.net/api/yggdrasil"?r.value="https://skin.mslmc.net/api/yggdrasil":H==="https://littleskin.cn/api/yggdrasil"?r.value="https://littleskin.cn/api/yggdrasil":(r.value="custom",w.value=H):r.value="none"}catch(V){X.error("获取配置失败: "+V.message)}finally{h.value=!1}}};Q(()=>g.params.serverId,V=>{g.name==="InstanceConsole"&&V&&fe()}),ve(fe);const at=async()=>{var a,H;if(await((a=$.value)==null?void 0:a.validate())===!0&&!(c.value!=="none"&&(i.value.coreUrl||i.value.coreFileKey)&&!await new Promise(Y=>{const le=Be.confirm({header:"确认变更核心文件?",body:"检测到您上传或选择了新的核心文件，这将覆盖服务器现有的部署。",theme:"warning",onConfirm:()=>{le.hide(),Y(!0)},onClose:()=>{le.hide(),Y(!1)}})}))){c.value==="none"&&(i.value.core="none",i.value.minM=1027,i.value.maxM=1102,i.value.java="none",i.value.coreUrl="",i.value.coreFileKey="",i.value.coreSha256=""),k.value=!0;try{const K=await Ct(i.value);((H=K.data)==null?void 0:H.needListen)??K.needListen?lt():(X.success("配置已保存"),k.value=!1,fe())}catch(K){X.error(K.message||"保存失败"),k.value=!1}}},lt=async()=>{me.value=!0,pe.value=0,$e.value=[];const{baseUrl:V,token:a}=x,H=new URL("/api/hubs/updateProgressHub",V||window.location.origin);H.searchParams.append("x-user-token",a),ue.value=new Ne().withUrl(H.toString(),{withCredentials:!1}).configureLogging(ze.None).build(),ue.value.on("UpdateStatus",(K,ae,Y)=>{$e.value.push({time:new Date().toLocaleTimeString(),msg:Y?`[错误] ${K}`:K}),Ce(()=>{const le=document.getElementById("update-log-box");le&&(le.scrollTop=le.scrollHeight)}),ae>=0&&(pe.value=Number(ae.toFixed(1))),ae===100&&(X.success("更新完成"),st(!0))});try{await ue.value.start(),await ue.value.invoke("JoinGroup",f.value.toString())}catch{$e.value.push({time:"-",msg:"连接失败"})}},st=(V=!1)=>{var a;(a=ue.value)==null||a.stop(),setTimeout(()=>{me.value=!1,k.value=!1,V&&fe()},1e3)};return Ve(()=>{var V;(V=ue.value)==null||V.stop()}),(V,a)=>{const H=U("t-input"),K=U("t-button"),ae=U("t-tooltip"),Y=U("t-select"),le=U("t-textarea"),ge=U("t-alert"),ye=U("t-icon"),re=U("t-col"),Me=U("t-row"),Le=U("t-progress"),nt=U("t-space"),be=U("t-input-number"),_e=U("t-switch"),ot=U("t-form"),it=U("t-loading"),rt=U("t-dialog");return p(),I("div",ra,[t(it,{loading:h.value,"show-overlay":""},{default:s(()=>[t(ot,{ref_key:"formRef",ref:$,data:i.value,rules:tt.value,"label-width":"0",onSubmit:at},{default:s(()=>[a[57]||(a[57]=e("div",{class:"setting-group-title"},"基础设置",-1)),e("div",ua,[a[32]||(a[32]=e("div",{class:"setting-info"},[e("div",{class:"title"},"服务器名称"),e("div",{class:"desc"},"在面板列表中显示的别名，支持中文")],-1)),e("div",da,[t(H,{modelValue:i.value.name,"onUpdate:modelValue":a[0]||(a[0]=S=>i.value.name=S),placeholder:"请输入名称"},null,8,["modelValue"])])]),e("div",ca,[e("div",va,[a[33]||(a[33]=e("div",{class:"title"},"实例路径",-1)),e("div",ma,[e("span",{class:we({"text-warning":L.value})},A(L.value?"警告：修改路径可能导致无法找到原文件":"服务器文件的物理存储路径，非必要请勿修改"),3)])]),e("div",pa,[t(H,{modelValue:i.value.base,"onUpdate:modelValue":a[1]||(a[1]=S=>i.value.base=S),disabled:!L.value},{suffix:s(()=>[t(ae,{content:L.value?"点击锁定":"点击解锁编辑 (慎重)"},{default:s(()=>[t(K,{variant:"text",shape:"square",onClick:et},{icon:s(()=>[L.value?(p(),j(R(It),{key:0,style:{color:"var(--td-warning-color)"}})):(p(),j(R(Lt),{key:1}))]),_:1})]),_:1},8,["content"])]),_:1},8,["modelValue","disabled"])])]),a[58]||(a[58]=e("div",{class:"setting-group-title"},"运行模式",-1)),e("div",fa,[a[34]||(a[34]=e("div",{class:"setting-info"},[e("div",{class:"title"},"启动方式"),e("div",{class:"desc"},"选择使用 Java 启动 Minecraft，或使用自定义命令启动其他程序 (如 Bedrock, Python 等)")],-1)),e("div",ga,[t(Y,{modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=S=>c.value=S),options:[{label:"MSLX 在线下载 (Java)",value:"online"},{label:"使用本地版本 (Java)",value:"local"},{label:"自定义路径 (Java)",value:"custom"},{label:"环境变量 (Java)",value:"env"},{label:"自定义命令 (无Java)",value:"none"}]},null,8,["modelValue"]),c.value!=="none"?(p(),I("div",ya,[c.value==="online"?(p(),j(Y,{key:0,modelValue:N.value,"onUpdate:modelValue":a[3]||(a[3]=S=>N.value=S),options:y.value,placeholder:"请选择版本",filterable:""},null,8,["modelValue","options"])):F("",!0),c.value==="local"?(p(),j(Y,{key:1,modelValue:n.value,"onUpdate:modelValue":a[4]||(a[4]=S=>n.value=S),options:B.value,placeholder:"选择已识别的 Java"},null,8,["modelValue","options"])):F("",!0),c.value==="custom"?(p(),j(H,{key:2,modelValue:n.value,"onUpdate:modelValue":a[5]||(a[5]=S=>n.value=S),placeholder:"输入 java 可执行文件完整路径"},null,8,["modelValue"])):F("",!0)])):F("",!0)])]),e("div",ba,[e("div",_a,[e("div",ka,A(c.value==="none"?"启动命令 (Command)":"启动参数 (JVM Args)"),1),e("div",ha,A(c.value==="none"?"完全自定义的启动命令。程序将直接执行此段内容，不依赖 Java 环境。":"传递给 Java 的启动参数，如 GC 策略 (例如 -XX:+UseG1GC)"),1)]),e("div",wa,[t(le,{modelValue:i.value.args,"onUpdate:modelValue":a[6]||(a[6]=S=>i.value.args=S),autosize:{minRows:2,maxRows:4},placeholder:c.value==="none"?"例如: ./bedrock_server_x64":"无特殊需求请留空"},null,8,["modelValue","placeholder"])])]),c.value!=="none"?(p(),I(se,{key:0},[a[38]||(a[38]=e("div",{class:"setting-group-title"},"核心管理",-1)),e("div",$a,[a[37]||(a[37]=e("div",{class:"setting-info"},[e("div",{class:"title"},"服务端核心文件"),e("div",{class:"desc"},[m(" 指定启动的 Jar 文件名。如果文件已存在于目录中，直接输入文件名即可。 "),e("br"),m("需要更新核心？点击下方“文件工具” ")])],-1)),e("div",xa,[t(H,{modelValue:i.value.core,"onUpdate:modelValue":a[8]||(a[8]=S=>i.value.core=S),placeholder:"例如 server.jar"},{suffix:s(()=>[t(K,{variant:"text",theme:"primary",size:"small",onClick:a[7]||(a[7]=S=>W.value=!W.value)},{default:s(()=>[m(A(W.value?"收起工具":"文件工具"),1)]),_:1})]),_:1},8,["modelValue"]),W.value?(p(),I("div",Ca,[t(nt,{direction:"vertical",style:{width:"100%"}},{default:s(()=>[t(ge,{theme:"info",message:"在此处操作会自动下载/上传文件，并填入上方的文件名。"}),t(Me,{gutter:12},{default:s(()=>[t(re,{span:6},{default:s(()=>[t(K,{block:"",variant:"outline",onClick:a[9]||(a[9]=S=>q.value=!0)},{icon:s(()=>[t(ye,{name:"cloud-download"})]),default:s(()=>[a[35]||(a[35]=m(" 从版本库下载 ",-1))]),_:1})]),_:1}),t(re,{span:6},{default:s(()=>[t(K,{block:"",variant:"outline",loading:D.value,onClick:C},{icon:s(()=>[t(ye,{name:"upload"})]),default:s(()=>[a[36]||(a[36]=m(" 上传本地文件 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1}),e("input",{ref_key:"uploadInputRef",ref:P,type:"file",accept:".jar",hidden:"",onChange:ee},null,544),D.value?(p(),I("div",Va,[e("span",null,"正在上传: "+A(G.value),1),t(Le,{theme:"line",percentage:Z.value},null,8,["percentage"])])):F("",!0)]),_:1})])):F("",!0)])])],64)):F("",!0),c.value!=="none"?(p(),I(se,{key:1},[a[41]||(a[41]=e("div",{class:"setting-group-title"},"资源限制",-1)),e("div",Sa,[a[40]||(a[40]=e("div",{class:"setting-info"},[e("div",{class:"title"},"内存分配"),e("div",{class:"desc"},"设置 Java 堆内存大小 (Xms / Xmx)")],-1)),e("div",Ua,[e("div",Ma,[t(be,{modelValue:d.value,"onUpdate:modelValue":a[10]||(a[10]=S=>d.value=S),min:0,"decimal-places":b.value==="GB"?1:0,placeholder:"Xms",theme:"normal",class:"input-left"},null,8,["modelValue","decimal-places"]),t(Y,{modelValue:b.value,"onUpdate:modelValue":a[11]||(a[11]=S=>b.value=S),options:E,clearable:!1,class:"select-right"},null,8,["modelValue"])]),a[39]||(a[39]=e("span",{class:"separator"},"-",-1)),e("div",Ra,[t(be,{modelValue:T.value,"onUpdate:modelValue":a[12]||(a[12]=S=>T.value=S),min:0,"decimal-places":z.value==="GB"?1:0,placeholder:"Xmx",theme:"normal",class:"input-left"},null,8,["modelValue","decimal-places"]),t(Y,{modelValue:z.value,"onUpdate:modelValue":a[13]||(a[13]=S=>z.value=S),options:E,clearable:!1,class:"select-right"},null,8,["modelValue"])])])])],64)):F("",!0),a[59]||(a[59]=e("div",{class:"setting-group-title"},"备份设置",-1)),e("div",Ba,[a[44]||(a[44]=e("div",{class:"setting-info"},[e("div",{class:"title"},"备份策略"),e("div",{class:"desc"},"设置自动备份保留的最大数量，以及触发备份的延迟时间")],-1)),e("div",Ia,[t(be,{modelValue:i.value.backupMaxCount,"onUpdate:modelValue":a[14]||(a[14]=S=>i.value.backupMaxCount=S),min:1,max:100,placeholder:"保留份数",theme:"column",style:{width:"140px"},suffix:"份"},null,8,["modelValue"]),a[42]||(a[42]=e("span",{class:"separator"},"/",-1)),t(be,{modelValue:i.value.backupDelay,"onUpdate:modelValue":a[15]||(a[15]=S=>i.value.backupDelay=S),min:0,placeholder:"延迟时间",theme:"column",style:{width:"140px"},suffix:"秒"},null,8,["modelValue"])]),e("div",La,[t(ae,{content:"MSLX 向服务器发送 save-all 指令后，会等待指定的秒数，确保数据完全写入硬盘后再开始打包备份。"},{default:s(()=>[e("span",Ea,[t(ye,{name:"help-circle"}),a[43]||(a[43]=m(" 什么是延迟时间？ ",-1))])]),_:1})])]),e("div",Pa,[a[45]||(a[45]=e("div",{class:"setting-info"},[e("div",{class:"title"},"备份存放路径"),e("div",{class:"desc"},"选择备份文件存储的位置。推荐存储在实例文件夹外部以免误删。")],-1)),e("div",Aa,[t(Y,{modelValue:v.value,"onUpdate:modelValue":a[16]||(a[16]=S=>v.value=S),options:[{label:"实例文件夹内 (Instance)",value:"MSLX://Backup/Instance"},{label:"全局数据目录 (Data)",value:"MSLX://Backup/Data"},{label:"自定义绝对路径",value:"custom"}]},null,8,["modelValue"]),v.value==="custom"?(p(),I("div",Oa,[t(H,{modelValue:M.value,"onUpdate:modelValue":a[17]||(a[17]=S=>M.value=S),placeholder:"输入备份存放的绝对路径"},null,8,["modelValue"])])):F("",!0)])]),c.value!=="none"?(p(),I("div",Da,"外置登录")):F("",!0),c.value!=="none"?(p(),I("div",Fa,[a[46]||(a[46]=e("div",{class:"setting-info"},[e("div",{class:"title"},"Yggdrasil API"),e("div",{class:"desc"},"选择认证服务器。留空则表示使用官方正版登录 (或离线模式)。")],-1)),e("div",Ta,[t(Y,{modelValue:r.value,"onUpdate:modelValue":a[18]||(a[18]=S=>r.value=S),options:O},null,8,["modelValue"]),r.value==="custom"?(p(),I("div",Na,[t(H,{modelValue:w.value,"onUpdate:modelValue":a[19]||(a[19]=S=>w.value=S),placeholder:"输入 Authlib-Injector API 地址"},null,8,["modelValue"])])):F("",!0)])])):F("",!0),a[60]||(a[60]=e("div",{class:"setting-group-title"},"高级设置",-1)),e("div",za,[a[47]||(a[47]=e("div",{class:"setting-info"},[e("div",{class:"title"},"自动重启"),e("div",{class:"desc"},"当服务器崩溃或意外停止时尝试自动重启"),e("div",{class:"desc"},"熔断机制: 若5分钟内尝试重启次数达到 5 次，则停止尝试重启")],-1)),e("div",Ga,[t(_e,{modelValue:i.value.autoRestart,"onUpdate:modelValue":a[20]||(a[20]=S=>i.value.autoRestart=S),label:["已开启","已关闭"]},null,8,["modelValue"])])]),i.value.autoRestart?(p(),I("div",Ja,[a[48]||(a[48]=e("div",{class:"setting-info"},[e("div",{class:"title"},"强制自动重启"),e("div",{class:"desc"},"开启此功能后，就算服务器是正常退出的也会强制重启(正常退出 => 退出代码 0)"),e("div",{class:"desc"},"不影响手动在面板关闭服务器")],-1)),e("div",Xa,[t(_e,{modelValue:i.value.forceAutoRestart,"onUpdate:modelValue":a[21]||(a[21]=S=>i.value.forceAutoRestart=S),label:["已开启","已关闭"]},null,8,["modelValue"])])])):F("",!0),e("div",ja,[a[49]||(a[49]=e("div",{class:"setting-info"},[e("div",{class:"title"},"关服强制结束时间"),e("div",{class:"desc"},"设置在发出Stop指令或关服请求后，等待多久后强制结束进程"),e("div",{class:"desc"},"可设置10 - 120 s")],-1)),e("div",Wa,[t(be,{modelValue:i.value.forceExitDelay,"onUpdate:modelValue":a[22]||(a[22]=S=>i.value.forceExitDelay=S)},null,8,["modelValue"])])]),e("div",qa,[a[50]||(a[50]=e("div",{class:"setting-info"},[e("div",{class:"title"},"忽略EULA提示"),e("div",{class:"desc"},"若您的实例并非MC服务器，可打开此选项")],-1)),e("div",Ka,[t(_e,{modelValue:i.value.ignoreEula,"onUpdate:modelValue":a[23]||(a[23]=S=>i.value.ignoreEula=S),label:["已开启","已关闭"]},null,8,["modelValue"])])]),e("div",Ha,[a[51]||(a[51]=e("div",{class:"setting-info"},[e("div",{class:"title"},"随守护进程启动"),e("div",{class:"desc"},"当物理机开机/面板启动时，自动启动此实例")],-1)),e("div",Ya,[t(_e,{modelValue:i.value.runOnStartup,"onUpdate:modelValue":a[24]||(a[24]=S=>i.value.runOnStartup=S),label:["已开启","已关闭"]},null,8,["modelValue"])])]),c.value!=="none"?(p(),I("div",Za,[a[52]||(a[52]=e("div",{class:"setting-info"},[e("div",{class:"title"},"强制Java使用UTF8"),e("div",{class:"desc"},"此功能可以解决部分游戏内中文乱码的问题（特别是Windows系统上）"),e("div",{class:"desc"},[m("开启此功能后请务必将下面的"),e("b",null,"文件编码"),m("设置设置为"),e("b",null,"UTF-8")])],-1)),e("div",Qa,[t(_e,{modelValue:i.value.forceJvmUTF8,"onUpdate:modelValue":a[25]||(a[25]=S=>i.value.forceJvmUTF8=S),label:["已开启","已关闭"]},null,8,["modelValue"])])])):F("",!0),e("div",el,[a[53]||(a[53]=e("div",{class:"setting-info"},[e("div",{class:"title"},"控制台编码"),e("div",{class:"desc"},"设置输入输出流的字符集，乱码时请尝试切换")],-1)),e("div",tl,[t(Y,{modelValue:i.value.inputEncoding,"onUpdate:modelValue":a[26]||(a[26]=S=>i.value.inputEncoding=S),options:u,label:"输入",style:{width:"140px"}},null,8,["modelValue"]),t(Y,{modelValue:i.value.outputEncoding,"onUpdate:modelValue":a[27]||(a[27]=S=>i.value.outputEncoding=S),options:u,label:"输出",style:{width:"140px"}},null,8,["modelValue"])])]),e("div",al,[a[54]||(a[54]=e("div",{class:"setting-info"},[e("div",{class:"title"},"文件编码"),e("div",{class:"desc"},"设置文件编辑和保存时的编码格式，乱码时请尝试切换。(一般Windows是GBK，其他是UTF-8。)")],-1)),e("div",ll,[t(Y,{modelValue:i.value.fileEncoding,"onUpdate:modelValue":a[28]||(a[28]=S=>i.value.fileEncoding=S),options:u,style:{width:"140px"}},null,8,["modelValue"])])]),e("div",sl,[t(K,{theme:"primary",type:"submit",size:"large",loading:k.value},{default:s(()=>[...a[55]||(a[55]=[m("保存设置",-1)])]),_:1},8,["loading"]),t(K,{theme:"default",variant:"base",size:"large",onClick:fe},{default:s(()=>[...a[56]||(a[56]=[m("重置更改",-1)])]),_:1})])]),_:1},8,["data","rules"])]),_:1},8,["loading"]),t(Ut,{visible:q.value,"onUpdate:visible":a[29]||(a[29]=S=>q.value=S),onConfirm:ie},null,8,["visible"]),t(rt,{visible:me.value,"onUpdate:visible":a[31]||(a[31]=S=>me.value=S),header:"正在应用更新",footer:!1,"close-on-overlay-click":!1,"close-btn":!1,width:"600px"},{default:s(()=>[e("div",nl,[t(Le,{theme:"plump",percentage:pe.value,label:`${pe.value}%`},null,8,["percentage","label"]),e("div",ol,[(p(!0),I(se,null,ce($e.value,(S,ut)=>(p(),I("div",{key:ut,class:"log-line"},[e("span",il,A(S.time),1),m(" "+A(S.msg),1)]))),128))]),pe.value===100?(p(),I("div",rl,[t(K,{theme:"primary",onClick:a[30]||(a[30]=S=>me.value=!1)},{default:s(()=>[...a[61]||(a[61]=[m("关闭并刷新",-1)])]),_:1})])):F("",!0)])]),_:1},8,["visible"])])}}}),dl=oe(ul,[["__scopeId","data-v-700c134f"]]),cl={class:"pm-container"},vl={class:"header-section"},ml={class:"mode-switcher"},pl={key:0,class:"error-alert-bar"},fl={class:"toolbar"},gl={class:"left-actions"},yl={key:0,class:"bulk-actions"},bl={class:"selected-count"},_l={class:"right-search"},kl={class:"table-wrapper"},hl={style:{display:"flex","align-items":"center",gap:"8px"}},wl={class:"empty-state"},$l={class:"tips-footer"},xl=ne({__name:"ModsPluginsManager",setup(o){const g=he(),x=parseInt(g.params.serverId),f=_("mods"),$=_(!1),h=_([]),k=_(""),L=_([]),u=_(""),i=te(()=>{if(!k.value)return h.value;const n=k.value.toLowerCase();return h.value.filter(l=>l.name.toLowerCase().includes(n))}),b=te(()=>[{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{title:"文件名",colKey:"name",sorter:(n,l)=>n.name.localeCompare(l.name),ellipsis:!0},{title:"状态",colKey:"status",width:100},{title:"操作",colKey:"op",width:180,fixed:"right",align:"right"}]),z=async(n=!1)=>{$.value=!0,L.value=[],u.value="";try{const l=await kt(x,f.value,n),v=(l.clientJarFiles||[]).map(w=>({name:w,status:"enabled",isClient:!0})),M=(l.jarFiles||[]).map(w=>({name:w,status:"enabled"})),r=(l.disableJarFiles||[]).map(w=>({name:w,status:"disabled"}));h.value=[...v,...M,...r],n&&v.length>0?(L.value=v.map(w=>w.name),X.success(`检测到 ${v.length} 个客户端模组`)):n&&X.info("未检测到仅客户端模组")}catch(l){const v=l.message||"获取列表失败";u.value=v,h.value=[]}finally{$.value=!1}},E=async(n,l)=>{if(l.length===0)return;const v={enable:"启用",disable:"禁用",delete:"删除"},M=async()=>{try{$.value=!0;const r=await ht(x,f.value,n,l),{successCount:w,failCount:O}=r||{};O>0?X.warning(`操作完成：成功 ${w} 个，失败 ${O} 个`):X.success(`成功${v[n]} ${w} 个文件`),await z()}catch(r){X.error(r.message||"操作失败"),$.value=!1}};if(n==="delete"){const r=Be.confirm({header:`确认删除 ${l.length} 个文件?`,body:"此操作不可逆，文件将被永久删除。",theme:"danger",onConfirm:()=>{r.hide(),M()}})}else await M()},d=n=>{f.value=n,z()},T=n=>{const l=n.status==="enabled"?"disable":"enable";E(l,[n.name])},c=n=>{const l=L.value;E(n,l)},y=_(!1),B=()=>{y.value=!0},N=()=>{y.value=!1,z()};return ve(()=>{z()}),Q(()=>g.params.serverId,n=>{n&&location.reload()}),(n,l)=>{const v=U("t-radio-button"),M=U("t-radio-group"),r=U("t-alert"),w=U("t-button"),O=U("t-input"),W=U("t-tag"),q=U("t-switch"),P=U("t-popconfirm"),D=U("t-space"),Z=U("t-table");return p(),I("div",cl,[e("div",vl,[l[13]||(l[13]=e("div",{class:"setting-group-title"}," 资源管理 ",-1)),e("div",ml,[t(M,{modelValue:f.value,"onUpdate:modelValue":l[0]||(l[0]=G=>f.value=G),variant:"default-filled",onChange:d},{default:s(()=>[t(v,{value:"mods"},{icon:s(()=>[t(R(Ee))]),default:s(()=>[l[11]||(l[11]=m(" 模组 (Mods) ",-1))]),_:1}),t(v,{value:"plugins"},{icon:s(()=>[t(R(Pe))]),default:s(()=>[l[12]||(l[12]=m(" 插件 (Plugins) ",-1))]),_:1})]),_:1},8,["modelValue"])])]),u.value?(p(),I("div",pl,[t(r,{theme:"error",message:u.value,closeable:"",onClose:l[2]||(l[2]=G=>u.value="")},{operation:s(()=>[e("span",{style:{cursor:"pointer","margin-left":"8px"},onClick:l[1]||(l[1]=G=>z(!1))},"重试")]),_:1},8,["message"])])):F("",!0),e("div",fl,[e("div",gl,[t(w,{theme:"primary",disabled:u.value!=="",onClick:B},{icon:s(()=>[t(R(Et))]),default:s(()=>[l[14]||(l[14]=m(" 上传文件 ",-1))]),_:1},8,["disabled"]),f.value==="mods"?(p(),j(w,{key:0,disabled:u.value!=="",variant:"outline",loading:$.value,onClick:l[3]||(l[3]=G=>z(!0))},{icon:s(()=>[t(R(Ae))]),default:s(()=>[l[15]||(l[15]=m(" 检测客户端模组 ",-1))]),_:1},8,["disabled","loading"])):F("",!0),t(w,{variant:"outline",loading:$.value,onClick:l[4]||(l[4]=G=>z(!1))},{icon:s(()=>[t(R(ke))]),_:1},8,["loading"]),t(Ge,{name:"fade"},{default:s(()=>[L.value.length>0?(p(),I("div",yl,[l[19]||(l[19]=e("div",{class:"divider"},null,-1)),e("span",bl,"已选 "+A(L.value.length)+" 项",1),t(w,{size:"small",variant:"text",theme:"success",onClick:l[5]||(l[5]=G=>c("enable"))},{default:s(()=>[...l[16]||(l[16]=[m("启用",-1)])]),_:1}),t(w,{size:"small",variant:"text",theme:"warning",onClick:l[6]||(l[6]=G=>c("disable"))},{default:s(()=>[...l[17]||(l[17]=[m("禁用",-1)])]),_:1}),t(w,{size:"small",variant:"text",theme:"danger",onClick:l[7]||(l[7]=G=>c("delete"))},{default:s(()=>[...l[18]||(l[18]=[m("删除",-1)])]),_:1})])):F("",!0)]),_:1})]),e("div",_l,[t(O,{modelValue:k.value,"onUpdate:modelValue":l[8]||(l[8]=G=>k.value=G),placeholder:"搜索文件名...",clearable:""},{"prefix-icon":s(()=>[t(R(Ae))]),_:1},8,["modelValue"])])]),e("div",kl,[t(Z,{"selected-row-keys":L.value,"onUpdate:selectedRowKeys":l[9]||(l[9]=G=>L.value=G),pagination:{defaultPageSize:20,total:i.value.length,showJumper:!0,defaultCurrent:1},data:i.value,columns:b.value,"row-key":"name",loading:$.value,hover:"",stripe:"",class:"custom-table"},{name:s(({row:G})=>[e("div",hl,[e("span",null,A(G.name),1),G.isClient?(p(),j(W,{key:0,theme:"warning",variant:"light",size:"small"},{default:s(()=>[...l[20]||(l[20]=[m(" 客户端 ",-1)])]),_:1})):F("",!0)])]),status:s(({row:G})=>[G.status==="enabled"?(p(),j(W,{key:0,theme:"success",variant:"light"},{icon:s(()=>[t(R(qe))]),default:s(()=>[l[21]||(l[21]=m(" 已启用 ",-1))]),_:1})):(p(),j(W,{key:1,theme:"default",variant:"light",style:{color:"var(--td-text-color-placeholder)"}},{icon:s(()=>[t(R(Ke))]),default:s(()=>[l[22]||(l[22]=m(" 已禁用 ",-1))]),_:1}))]),op:s(({row:G})=>[t(D,{size:"small"},{default:s(()=>[t(q,{"model-value":G.status==="enabled",loading:$.value,size:"medium",onChange:ie=>T(G)},{label:s(ie=>[m(A(ie.value?"开":"关"),1)]),_:1},8,["model-value","loading","onChange"]),t(P,{content:"确定要删除此文件吗？",theme:"danger",onConfirm:ie=>E("delete",[G.name])},{default:s(()=>[t(w,{variant:"text",theme:"danger",shape:"square"},{default:s(()=>[t(R(We))]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)]),empty:s(()=>[e("div",wl,[f.value==="mods"?(p(),j(R(Ee),{key:0,size:"48px",style:{color:"var(--td-gray-color-4)"}})):(p(),j(R(Pe),{key:1,size:"48px",style:{color:"var(--td-gray-color-4)"}})),e("p",null,A(`暂无${f.value==="mods"?"模组":"插件"}文件`),1)])]),_:1},8,["selected-row-keys","pagination","data","columns","loading"])]),e("div",$l,[e("p",null,"提示："+A(f.value==="mods"?"模组":"插件")+"文件存放于服务器根目录的 /"+A(f.value)+" 文件夹下。",1),l[23]||(l[23]=e("p",null,"禁用文件后，会在文件名后添加 .disabled 后缀，服务器将忽略该文件。",-1))]),t(Zt,{visible:y.value,"onUpdate:visible":l[10]||(l[10]=G=>y.value=G),"instance-id":R(x),"current-path":f.value,"allow-folder":!1,onSuccess:N},null,8,["visible","instance-id","current-path"])])}}}),Cl=oe(xl,[["__scopeId","data-v-c8641ed4"]]),Te=[{key:"motd",label:"服务器标语",desc:"显示在多人游戏列表中的服务器介绍信息，支持颜色代码，不支持中文。",type:"string"},{key:"server-port",label:"服务器端口",desc:"默认为 25565。如果要在一台机器运行多个服务器，必须修改此端口。",type:"number"},{key:"max-players",label:"最大玩家数",desc:"服务器同时允许在线的最大玩家数量。",type:"number"},{key:"online-mode",label:"正版验证",desc:"开启后将验证玩家的正版账号。如果使用离线/皮肤站，请关闭此项。",type:"boolean"},{key:"white-list",label:"启用白名单",desc:"开启后只有在白名单内的玩家才能进入服务器。",type:"boolean"},{key:"enforce-whitelist",label:"强制白名单",desc:"开启后，当玩家不在白名单时，即使已在线也会被踢出（通常用于维护时重新加载白名单）。",type:"boolean"},{key:"level-name",label:"存档文件夹名称",desc:"服务器读取的世界存档文件夹名称（默认为 world）。",type:"string"},{key:"gamemode",label:"默认游戏模式",desc:"新玩家进入服务器时的默认模式。",type:"select",options:[{label:"生存 (Survival)",value:"survival"},{label:"创造 (Creative)",value:"creative"},{label:"冒险 (Adventure)",value:"adventure"},{label:"旁观 (Spectator)",value:"spectator"}]},{key:"force-gamemode",label:"强制游戏模式",desc:"开启后，玩家每次加入服务器都会被重置为默认游戏模式。",type:"boolean"},{key:"difficulty",label:"难度",desc:"世界的游戏难度设置。",type:"select",options:[{label:"和平 (Peaceful)",value:"peaceful"},{label:"简单 (Easy)",value:"easy"},{label:"普通 (Normal)",value:"normal"},{label:"困难 (Hard)",value:"hard"}]},{key:"hardcore",label:"极限模式",desc:"开启后，玩家死亡将被封禁。",type:"boolean"},{key:"allow-flight",label:"允许飞行",desc:"允许生存模式下的玩家飞行（防止被服务端反作弊踢出）。",type:"boolean"},{key:"spawn-protection",label:"出生点保护半径",desc:"出生点周围多少格内禁止非 OP 破坏。设为 0 可禁用。",type:"number"},{key:"player-idle-timeout",label:"挂机踢出时间",desc:"玩家闲置多少分钟后被自动踢出。0 为不限制。",type:"number"},{key:"level-seed",label:"世界种子",desc:"生成世界使用的种子，留空则随机生成。",type:"string"},{key:"level-type",label:"世界类型",desc:"例如 minecraft:normal, minecraft:flat, minecraft:amplified。",type:"string"},{key:"generate-structures",label:"生成结构",desc:"是否生成村庄、地牢等结构。",type:"boolean"},{key:"generator-settings",label:"生成器设置",desc:"用于自定义超平坦或特定生成器的 JSON 参数。",type:"string"},{key:"max-world-size",label:"世界边界半径",desc:"设置世界边界（World Border）的最大半径。",type:"number"},{key:"simulation-distance",label:"模拟距离",desc:"服务器实际运算实体/作物生长的区块半径（3-32）。",type:"number"},{key:"view-distance",label:"视距",desc:"客户端可以看见的区块半径。数值过大显著增加内存和带宽消耗。",type:"number"},{key:"entity-broadcast-range-percentage",label:"实体广播范围百分比",desc:"控制客户端能看到实体的距离系数（100表示默认）。",type:"number"},{key:"max-tick-time",label:"最大刻耗时 (Watchdog)",desc:"一刻的最长处理毫秒数。超过此数值服务器将强制关闭以防卡死。设为 -1 可禁用。",type:"number"},{key:"network-compression-threshold",label:"网络压缩阈值",desc:"数据包超过此字节数时进行压缩。设为 -1 禁用压缩。推荐保持默认 256。",type:"number"},{key:"rate-limit",label:"数据包限制",desc:"如果玩家发送数据包过快，将被踢出。0 为禁用。",type:"number"},{key:"use-native-transport",label:"使用原生传输优化",desc:"Linux 环境下是否启用 Epoll 优化网络性能。",type:"boolean"},{key:"prevent-proxy-connections",label:"防止代理连接",desc:"是否尝试阻止通过 VPN 或代理的连接（ISP/AS 号判断）。",type:"boolean"},{key:"sync-chunk-writes",label:"同步区块写入",desc:"开启后区块写入完成后才继续逻辑，数据更安全但可能掉帧；关闭可能提升性能。",type:"boolean"},{key:"region-file-compression",label:"区块文件压缩格式",desc:"用于保存区块的压缩算法。",type:"select",options:[{label:"Deflate (默认)",value:"deflate"},{label:"LZ4 (更快)",value:"lz4"},{label:"不压缩 (None)",value:"none"}]},{key:"max-chained-neighbor-updates",label:"最大连锁更新数",desc:"限制红石/方块连锁更新的数量以防止崩服。",type:"number"},{key:"log-ips",label:"控制台记录 IP",desc:"是否在控制台日志中显示玩家连接的 IP 地址。",type:"boolean"},{key:"hide-online-players",label:"隐藏在线玩家列表",desc:"开启后，服务器列表中将不显示具体的玩家名单。",type:"boolean"},{key:"enable-status",label:"启用状态查询",desc:"是否允许外部（如服务器列表网站）查询服务器状态。",type:"boolean"},{key:"accepts-transfers",label:"接受服务器传送",desc:"是否允许玩家从其他服务器无缝传送到此服务器。",type:"boolean"},{key:"pause-when-empty-seconds",label:"空载暂停时间",desc:"服务器内无玩家多少秒后暂停游戏循环（省资源）。-1 为不暂停。",type:"number"},{key:"op-permission-level",label:"OP 权限等级",desc:"设置 OP 的默认权限级别。",type:"select",options:[{label:"1 - 无视出生点保护",value:1},{label:"2 - 使用单机指令 (gamemode等)",value:2},{label:"3 - 多人管理 (kick/ban/op)",value:3},{label:"4 - 系统管理 (stop/save)",value:4}]},{key:"function-permission-level",label:"函数权限等级",desc:"数据包(Datapack)中函数的默认执行权限等级。",type:"number"},{key:"enforce-secure-profile",label:"强制安全配置 (签名)",desc:"强制玩家拥有官方签名的公钥（聊天报告相关）。离线服建议关闭。",type:"boolean"},{key:"enable-code-of-conduct",label:"启用行为准则提示",desc:"是否向玩家展示行为准则链接（遥测相关）。",type:"boolean"},{key:"bug-report-link",label:"Bug 反馈链接",desc:"自定义玩家遇到错误时显示的反馈网址。",type:"string"},{key:"resource-pack",label:"资源包下载地址",desc:"玩家进入服务器时提示下载的资源包直链 URL。",type:"string"},{key:"require-resource-pack",label:"强制资源包",desc:"开启后，拒绝下载资源包的玩家将被踢出。",type:"boolean"},{key:"resource-pack-sha1",label:"资源包 SHA1",desc:"资源包文件的 SHA-1 校验码，用于验证完整性和缓存。",type:"string"},{key:"resource-pack-prompt",label:"资源包提示语",desc:"下载资源包时向玩家显示的自定义消息（Json 格式）。",type:"string"},{key:"initial-enabled-packs",label:"初始启用数据包",desc:"世界生成时默认启用的数据包列表（逗号分隔）。",type:"string"},{key:"initial-disabled-packs",label:"初始禁用数据包",desc:"世界生成时默认禁用的数据包列表。",type:"string"},{key:"enable-rcon",label:"启用 RCON",desc:"开启远程控制台协议，允许外部工具发送指令。",type:"boolean"},{key:"rcon.port",label:"RCON 端口",desc:"RCON 监听端口（默认为 25575）。",type:"number"},{key:"rcon.password",label:"RCON 密码",desc:"连接 RCON 必须的密码。请设置复杂的密码。",type:"string"},{key:"broadcast-rcon-to-ops",label:"向 OP 广播 RCON",desc:"当 RCON 执行指令时，是否通知在线的 OP。",type:"boolean"},{key:"enable-query",label:"启用 Query",desc:"开启 GameSpy4 协议，用于获取服务器详细信息。",type:"boolean"},{key:"query.port",label:"Query 端口",desc:"Query 协议监听端口（默认为 25565）。",type:"number"},{key:"broadcast-console-to-ops",label:"向 OP 广播控制台",desc:"控制台执行的指令输出是否发给在线 OP。",type:"boolean"},{key:"enable-jmx-monitoring",label:"启用 JMX 监控",desc:"开启 Java JMX 性能监控（通常用于开发调试）。",type:"boolean"},{key:"management-server-enabled",label:"启用管理后台",desc:"是否启用 Minecraft 官方定义的管理服务器接口。",type:"boolean"},{key:"management-server-port",label:"管理后台端口",desc:"管理接口监听的端口。",type:"number"},{key:"management-server-host",label:"管理后台主机",desc:"管理接口绑定的主机名/IP。",type:"string"},{key:"management-server-allowed-origins",label:"管理后台允许源",desc:"允许访问管理接口的 Origin 列表。",type:"string"},{key:"server-ip",label:"服务器绑定 IP",desc:"指定服务器绑定的本地网卡 IP。留空表示监听所有网卡（0.0.0.0）。",type:"string"},{key:"debug",label:"调试模式",desc:"开启后控制台将输出更多调试信息。",type:"boolean"},{key:"text-filtering-config",label:"文本过滤配置",desc:"用于文本过滤服务的 API 配置。",type:"string"},{key:"status-heartbeat-interval",label:"状态心跳间隔",desc:"服务器向客户端发送状态心跳的间隔（0 为默认）。",type:"number"}],Vl={class:"settings-container"},Sl={class:"page-header"},Ul={class:"config-list"},Ml={key:0,class:"empty-tip"},Rl={class:"setting-info"},Bl={class:"title"},Il={class:"key-name-row"},Ll={key:0,class:"key-name"},El={key:0,class:"desc"},Pl={class:"setting-control"},Al={class:"form-actions"},Ol=ne({__name:"ServerProperties",setup(o){const g=he(),x=_(0),f=_(!1),$=_(!1),h=_({}),k=_(""),L=c=>{const y={};return c.split(`
`).forEach(N=>{const n=N.trim();if(!n||n.startsWith("#"))return;const l=n.indexOf("=");if(l!==-1){const v=n.substring(0,l).trim(),M=n.substring(l+1).trim();y[v]=M}}),y},u=c=>{let y=`#Minecraft server properties
#${new Date().toString()}
`;const B=Te.map(n=>n.key),N=Object.keys(c);return B.forEach(n=>{Object.prototype.hasOwnProperty.call(c,n)&&(y+=`${n}=${c[n]}
`)}),N.forEach(n=>{B.includes(n)||(y+=`${n}=${c[n]}
`)}),y},i=async()=>{if(x.value){f.value=!0;try{const c=await wt(x.value,"server.properties");c&&(k.value=c,h.value=L(c))}catch(c){X.error(`读取配置文件失败: ${c.message}`)}finally{f.value=!1}}},b=async()=>{$.value=!0;try{const c=u(h.value);await $t(x.value,"server.properties",c),X.success("配置文件已保存"),i()}catch(c){X.error(`保存失败: ${c.message}`)}finally{$.value=!1}},z=te(()=>{const c=[],y=h.value,B=new Set(Object.keys(y));return Te.forEach(N=>{B.has(N.key)&&(c.push(N),B.delete(N.key))}),B.forEach(N=>{c.push({key:N,label:N,desc:"未收录的配置项",type:E(y[N]),isUnknown:!0})}),c}),E=c=>c==="true"||c==="false"?"boolean":!isNaN(Number(c))&&c!==""?"number":"string",d=(c,y)=>{const B=h.value[c];return B===void 0?y==="boolean"?!1:"":y==="boolean"?B==="true":y==="number"?Number(B):B},T=(c,y,B)=>{h.value[c]=String(y)};return Q(()=>g.params.serverId,c=>{g.name==="InstanceConsole"&&c&&(x.value=parseInt(c),i())},{immediate:!0}),(c,y)=>{const B=U("t-button"),N=U("t-space"),n=U("t-switch"),l=U("t-select"),v=U("t-input-number"),M=U("t-input"),r=U("t-loading");return p(),I("div",Vl,[e("div",Sl,[y[1]||(y[1]=e("div",{class:"section-title"},"Server.properties 配置编辑器",-1)),t(N,null,{default:s(()=>[t(B,{variant:"text",shape:"square",loading:f.value,onClick:i},{icon:s(()=>[t(R(ke))]),_:1},8,["loading"]),t(B,{theme:"primary",loading:$.value,onClick:b},{icon:s(()=>[t(R(He))]),default:s(()=>[y[0]||(y[0]=m(" 保存配置 ",-1))]),_:1},8,["loading"])]),_:1})]),t(r,{loading:f.value,text:"正在读取配置文件..."},{default:s(()=>[e("div",Ul,[!f.value&&z.value.length===0?(p(),I("div",Ml," 无法找到配置项或文件为空 ")):F("",!0),(p(!0),I(se,null,ce(z.value,w=>(p(),I("div",{key:w.key,class:we(["setting-item",{"unknown-item":w.isUnknown}])},[e("div",Rl,[e("div",Bl,A(w.label),1),e("div",Il,[w.isUnknown?F("",!0):(p(),I("span",Ll,A(w.key),1))]),w.isUnknown?F("",!0):(p(),I("div",El,A(w.desc||"暂无描述"),1))]),e("div",Pl,[w.type==="boolean"?(p(),j(n,{key:0,"model-value":d(w.key,"boolean"),"onUpdate:modelValue":O=>T(w.key,O,"boolean")},null,8,["model-value","onUpdate:modelValue"])):w.type==="select"?(p(),j(l,{key:1,"model-value":d(w.key,"string"),options:w.options,placeholder:"请选择","onUpdate:modelValue":O=>T(w.key,O,"string")},null,8,["model-value","options","onUpdate:modelValue"])):w.type==="number"?(p(),j(v,{key:2,"model-value":d(w.key,"number"),theme:"column",style:{width:"100%"},"onUpdate:modelValue":O=>T(w.key,O,"number")},null,8,["model-value","onUpdate:modelValue"])):(p(),j(M,{key:3,"model-value":d(w.key,"string"),placeholder:"未设置","onUpdate:modelValue":O=>T(w.key,O,"string")},null,8,["model-value","onUpdate:modelValue"]))])],2))),128))])]),_:1},8,["loading"]),e("div",Al,[t(B,{theme:"primary",size:"large",loading:$.value,onClick:b},{default:s(()=>[...y[2]||(y[2]=[m("保存设置",-1)])]),_:1},8,["loading"]),t(B,{theme:"default",variant:"base",size:"large",onClick:i},{default:s(()=>[...y[3]||(y[3]=[m("重置更改",-1)])]),_:1})])])}}}),Dl=oe(Ol,[["__scopeId","data-v-6dfcc71c"]]);async function Fl(o){return await Se.get({url:`/api/instance/tasks/list/${o}`})}async function Tl(o,g,x,f,$,h){return await Se.post({url:"/api/instance/tasks/create",data:{instanceId:o,name:g,cron:x,payload:f,type:$,enable:h}})}async function Nl(o,g,x,f,$,h,k){return await Se.post({url:"/api/instance/tasks/update",data:{instanceId:o,id:g,name:x,cron:f,payload:$,type:h,enable:k}})}async function zl(o){return await Se.post({url:`/api/instance/tasks/delete/${o}`})}const Gl={class:"cron-gen-container"},Jl={class:"mode-switch"},Xl={key:0,class:"mode-content novice-panel"},jl={class:"novice-input-group"},Wl={key:1,class:"mode-content pro-panel"},ql={class:"tab-scroll-area"},Kl={key:0,class:"specific-box"},Hl={class:"result-area"},Yl={class:"cron-display"},Zl={class:"code-box"},Ql={class:"next-runs"},es={class:"runs-title"},ts={key:0,class:"error-msg"},as={key:1,class:"runs-list"},ls={class:"index"},ss=ne({__name:"CronGenerator",props:{visible:{type:Boolean,default:!1},initialValue:{type:String,default:""}},emits:["update:visible","confirm"],setup(o,{emit:g}){const x=o,f=g,$=_("novice"),h=_(10),k=_("minute"),L=[{label:"秒",value:"second"},{label:"分钟",value:"minute"},{label:"小时",value:"hour"},{label:"天",value:"day"}],u=_("second"),i=[{label:"秒",value:"second",min:0,max:59},{label:"分",value:"minute",min:0,max:59},{label:"时",value:"hour",min:0,max:23},{label:"日",value:"day",min:1,max:31},{label:"月",value:"month",min:1,max:12},{label:"周",value:"week",min:1,max:7}],b=_({second:{type:"every",start:0,step:1,specifics:[]},minute:{type:"every",start:0,step:1,specifics:[]},hour:{type:"every",start:0,step:1,specifics:[]},day:{type:"every",start:1,step:1,specifics:[]},month:{type:"every",start:1,step:1,specifics:[]},week:{type:"any",start:1,step:1,specifics:[]}}),z=[{label:"周日",value:1},{label:"周一",value:2},{label:"周二",value:3},{label:"周三",value:4},{label:"周四",value:5},{label:"周五",value:6},{label:"周六",value:7}],E=te(()=>{const l=(q,P="*")=>{const D=b.value[q];return q==="week"&&D.type==="any"||q==="week"&&b.value.day.type!=="every"||q==="day"&&b.value.week.type!=="any"?"?":D.type==="every"?"*":D.type==="interval"?`${D.start}/${D.step}`:D.type==="specific"?D.specifics.length===0?q==="day"||q==="month"?"1":"0":D.specifics.sort((Z,G)=>Z-G).join(","):P},v=l("second"),M=l("minute"),r=l("hour"),w=l("day"),O=l("month"),W=l("week","?");return`${v} ${M} ${r} ${w} ${O} ${W}`}),d=te(()=>{const l=h.value;switch(k.value){case"second":return`*/${l} * * * * *`;case"minute":return`0 */${l} * * * *`;case"hour":return`0 0 */${l} * * ?`;case"day":return`0 0 0 */${l} * ?`;default:return"* * * * * *"}}),T=te(()=>$.value==="novice"?d.value:E.value),c=_([]),y=_(""),B=()=>{try{const l=Qt.CronExpressionParser.parse(T.value,{currentDate:new Date});c.value=l.take(5).map(v=>new Date(v.toString()).toLocaleString()),y.value=""}catch{y.value="无法解析当前 Cron 表达式，请检查规则是否冲突",c.value=[]}};Q(T,()=>{B()},{immediate:!0}),Q(()=>x.visible,l=>{l&&x.initialValue&&($.value="pro",B())});const N=()=>{if(y.value){X.warning("当前表达式无效，无法保存");return}f("confirm",T.value),f("update:visible",!1)},n=l=>{const v=i.find(r=>r.value===l);if(!v)return[];const M=[];for(let r=v.min;r<=v.max;r++)M.push({label:r.toString(),value:r});return M};return(l,v)=>{const M=U("t-radio-button"),r=U("t-radio-group"),w=U("t-input-number"),O=U("t-select"),W=U("t-alert"),q=U("t-radio"),P=U("t-checkbox-group"),D=U("t-tab-panel"),Z=U("t-tabs"),G=U("t-tag"),ie=U("t-dialog");return p(),j(ie,{visible:o.visible,header:"Cron 表达式生成器",width:"700px",top:"5vh",onClose:v[4]||(v[4]=C=>f("update:visible",!1)),onConfirm:N},{default:s(()=>[e("div",Gl,[e("div",Jl,[t(r,{modelValue:$.value,"onUpdate:modelValue":v[0]||(v[0]=C=>$.value=C),variant:"default-filled"},{default:s(()=>[t(M,{value:"novice"},{default:s(()=>[...v[5]||(v[5]=[m("🚀 新手模式",-1)])]),_:1}),t(M,{value:"pro"},{default:s(()=>[...v[6]||(v[6]=[m("🛠️ 专业模式",-1)])]),_:1})]),_:1},8,["modelValue"])]),$.value==="novice"?(p(),I("div",Xl,[e("div",jl,[v[7]||(v[7]=e("span",null,"每隔",-1)),t(w,{modelValue:h.value,"onUpdate:modelValue":v[1]||(v[1]=C=>h.value=C),min:1,theme:"column",style:{width:"100px"}},null,8,["modelValue"]),t(O,{modelValue:k.value,"onUpdate:modelValue":v[2]||(v[2]=C=>k.value=C),options:L,style:{width:"100px"}},null,8,["modelValue"]),v[8]||(v[8]=e("span",null,"执行一次",-1))]),t(W,{theme:"info",style:{"margin-top":"16px"}},{message:s(()=>[...v[9]||(v[9]=[m(" 此模式适用于简单的周期性任务。如果需要“每周五上午10点”等复杂规则，请切换到",-1),e("b",null,"专业模式",-1),m("。 ",-1)])]),_:1})])):(p(),I("div",Wl,[t(Z,{modelValue:u.value,"onUpdate:modelValue":v[3]||(v[3]=C=>u.value=C)},{default:s(()=>[(p(),I(se,null,ce(i,C=>t(D,{key:C.value,value:C.value,label:C.label},{default:s(()=>[e("div",ql,[t(r,{modelValue:b.value[C.value].type,"onUpdate:modelValue":ee=>b.value[C.value].type=ee,direction:"vertical"},{default:s(()=>[t(q,{value:"every"},{default:s(()=>[m(A(C.value==="week"?"不指定 (?)":`每${C.label} (*)`),1)]),_:2},1024),C.value!=="week"?(p(),j(q,{key:0,value:"interval"},{default:s(()=>[v[10]||(v[10]=m(" 周期: 从 ",-1)),t(w,{modelValue:b.value[C.value].start,"onUpdate:modelValue":ee=>b.value[C.value].start=ee,min:C.min,max:C.max,size:"small",theme:"column",style:{width:"60px"}},null,8,["modelValue","onUpdate:modelValue","min","max"]),m(" "+A(C.label)+"开始，每 ",1),t(w,{modelValue:b.value[C.value].step,"onUpdate:modelValue":ee=>b.value[C.value].step=ee,min:1,max:C.max,size:"small",theme:"column",style:{width:"60px"}},null,8,["modelValue","onUpdate:modelValue","max"]),m(" "+A(C.label)+"执行一次 ",1)]),_:2},1024)):F("",!0),C.value!=="week"?(p(),j(q,{key:1,value:"specific"},{default:s(()=>[m("指定: 选择具体的"+A(C.label),1)]),_:2},1024)):F("",!0),C.value==="week"?(p(),j(q,{key:2,value:"specific"},{default:s(()=>[...v[11]||(v[11]=[m("指定周几",-1)])]),_:1})):F("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),b.value[C.value].type==="specific"?(p(),I("div",Kl,[t(P,{modelValue:b.value[C.value].specifics,"onUpdate:modelValue":ee=>b.value[C.value].specifics=ee,options:C.value==="week"?z:n(C.value),class:"grid-checkbox"},null,8,["modelValue","onUpdate:modelValue","options"])])):F("",!0)])]),_:2},1032,["value","label"])),64))]),_:1},8,["modelValue"])])),e("div",Hl,[e("div",Yl,[v[14]||(v[14]=e("span",{class:"label"},"当前表达式:",-1)),e("div",Zl,[m(A(T.value)+" ",1),y.value?(p(),j(G,{key:1,theme:"danger",variant:"light",size:"small"},{default:s(()=>[t(R(Pt)),v[13]||(v[13]=m(" 无效",-1))]),_:1})):(p(),j(G,{key:0,theme:"success",variant:"light",size:"small"},{default:s(()=>[t(R(qe)),v[12]||(v[12]=m(" 有效",-1))]),_:1}))])]),e("div",Ql,[e("div",es,[t(R(Ue)),v[15]||(v[15]=m(" 最近 5 次运行时间预测:",-1))]),y.value?(p(),I("div",ts,A(y.value),1)):(p(),I("ul",as,[(p(!0),I(se,null,ce(c.value,(C,ee)=>(p(),I("li",{key:ee},[e("span",ls,"#"+A(ee+1),1),m(" "+A(C),1)]))),128))]))])])])]),_:1},8,["visible"])}}}),ns=oe(ss,[["__scopeId","data-v-b81cfe41"]]),os={class:"page-container"},is={class:"page-header"},rs={key:0,class:"create-container"},us={class:"container-header"},ds={class:"title"},cs={class:"setting-item"},vs={class:"setting-control"},ms={class:"setting-item"},ps={class:"setting-control"},fs={class:"setting-item"},gs={class:"setting-control"},ys={key:0,class:"setting-item"},bs={class:"setting-info"},_s={class:"title"},ks={class:"desc"},hs={class:"setting-control"},ws={class:"setting-item"},$s={class:"setting-control"},xs={class:"form-actions"},Cs={class:"task-list"},Vs={key:0,class:"empty-state"},Ss={class:"card-left"},Us={class:"task-header-row"},Ms={class:"task-name"},Rs={class:"task-meta-row"},Bs={class:"cron-display"},Is=["title"],Ls={class:"card-right"},Es=ne({__name:"CronTasks",setup(o){const g=he(),x=te(()=>parseInt(g.params.serverId)),f=_([]),$=_(!1),h=_(!1),k=_(null),L=_(!1),u=_(null),i=_(!1),b=_({id:"",name:"",cron:"",type:"command",payload:"",enable:!0}),z=[{label:"发送命令 (Command)",value:"command"},{label:"备份存档 (Backup)",value:"backup"},{label:"开启服务器 (Start)",value:"start"},{label:"停止服务器 (Stop)",value:"stop"},{label:"重启服务器 (Restart)",value:"restart"}],E={name:[{required:!0,message:"必填",trigger:"blur"}],cron:[{required:!0,message:"必填",trigger:"blur"}],type:[{required:!0,message:"必选",trigger:"change"}],payload:[{validator:M=>b.value.type==="command"&&!M?{result:!1,message:"命令内容不能为空",type:"error"}:!0,trigger:"blur"}]},d=async()=>{if(x.value){$.value=!0;try{const M=await Fl(x.value);f.value=M||[]}catch(M){X.error(M.message||"获取列表失败")}finally{$.value=!1}}},T=()=>{h.value||(b.value={id:"",name:"",cron:"",type:"command",payload:"",enable:!0},k.value=null,h.value=!0)},c=M=>{b.value={id:M.id,name:M.name,cron:M.cron,type:M.type.toLowerCase(),payload:M.payload,enable:M.enable},k.value=M.id,h.value=!0,window.scrollTo({top:0,behavior:"smooth"})},y=()=>{h.value=!1,k.value=null},B=async()=>{var r;if(await((r=u.value)==null?void 0:r.validate())===!0){L.value=!0;try{k.value?(await Nl(x.value,b.value.id,b.value.name,b.value.cron,b.value.payload,b.value.type,b.value.enable),X.success("更新成功")):(await Tl(x.value,b.value.name,b.value.cron,b.value.payload,b.value.type,b.value.enable),X.success("创建成功")),y(),d()}catch(w){X.error(w.message||"操作失败")}finally{L.value=!1}}},N=M=>{const r=Be.confirm({header:"确认删除?",body:`确定删除任务 "${M.name}" 吗？`,theme:"danger",onConfirm:async()=>{try{await zl(M.id),X.success("已删除"),d(),r.hide()}catch(w){X.error(w.message)}},onClose:()=>r.hide()})},n=M=>{b.value.cron=M},l=M=>{const r=M.toLowerCase();return r==="start"?Ye:r==="stop"?Ze:r==="restart"?ke:Tt},v=M=>{const r=M.toLowerCase();return r==="start"?"success":r==="stop"?"danger":r==="restart"?"warning":"primary"};return Q(()=>x.value,d),ve(d),(M,r)=>{const w=U("t-button"),O=U("t-space"),W=U("t-input"),q=U("t-select"),P=U("t-textarea"),D=U("t-switch"),Z=U("t-form"),G=U("t-tag"),ie=U("t-loading");return p(),I("div",os,[e("div",is,[r[10]||(r[10]=e("div",{class:"section-title"},"定时计划任务",-1)),t(O,null,{default:s(()=>[h.value?F("",!0):(p(),j(w,{key:0,theme:"default",onClick:r[0]||(r[0]=C=>R(je)(R(ea).cron))},{icon:s(()=>[t(R(At))]),default:s(()=>[r[8]||(r[8]=m(" 使用文档 ",-1))]),_:1})),h.value?F("",!0):(p(),j(w,{key:1,theme:"primary",onClick:T},{icon:s(()=>[t(R(Ot))]),default:s(()=>[r[9]||(r[9]=m(" 创建新任务 ",-1))]),_:1}))]),_:1})]),t(Ge,{name:"slide-fade"},{default:s(()=>[h.value?(p(),I("div",rs,[e("div",us,[e("span",ds,A(k.value?"编辑任务":"创建新任务"),1),t(w,{size:"small",variant:"text",onClick:y},{default:s(()=>[t(R(Dt))]),_:1})]),t(Z,{ref_key:"formRef",ref:u,data:b.value,rules:E,"label-width":"0"},{default:s(()=>[e("div",cs,[r[11]||(r[11]=e("div",{class:"setting-info"},[e("div",{class:"title"},"任务名称"),e("div",{class:"desc"},"给这个计划任务起个容易识别的名字，例如“每日自动重启”")],-1)),e("div",vs,[t(W,{modelValue:b.value.name,"onUpdate:modelValue":r[1]||(r[1]=C=>b.value.name=C),placeholder:"请输入任务名称"},null,8,["modelValue"])])]),e("div",ms,[r[13]||(r[13]=e("div",{class:"setting-info"},[e("div",{class:"title"},"触发规则 (Cron)"),e("div",{class:"desc"},"使用 Cron 表达式定义执行时间。支持秒级精度 (秒 分 时 日 月 周)")],-1)),e("div",ps,[t(W,{modelValue:b.value.cron,"onUpdate:modelValue":r[2]||(r[2]=C=>b.value.cron=C),placeholder:"例如: 0 0 12 * * ?"},null,8,["modelValue"]),t(w,{variant:"outline",theme:"default",onClick:r[3]||(r[3]=C=>i.value=!0)},{default:s(()=>[...r[12]||(r[12]=[m(" 表达式生成器 ",-1)])]),_:1})])]),e("div",fs,[r[14]||(r[14]=e("div",{class:"setting-info"},[e("div",{class:"title"},"执行操作"),e("div",{class:"desc"},"选择触发时要执行的动作类型")],-1)),e("div",gs,[t(q,{modelValue:b.value.type,"onUpdate:modelValue":r[4]||(r[4]=C=>b.value.type=C),options:z},null,8,["modelValue"])])]),b.value.type==="command"||b.value.type==="restart"?(p(),I("div",ys,[e("div",bs,[e("div",_s,A(b.value.type==="restart"?"重启提示语":"控制台命令"),1),e("div",ks,A(b.value.type==="restart"?"重启前发送给全服玩家的倒计时提示消息":"不需要加 /，直接输入命令内容"),1)]),e("div",hs,[t(P,{modelValue:b.value.payload,"onUpdate:modelValue":r[5]||(r[5]=C=>b.value.payload=C),autosize:{minRows:2,maxRows:5},placeholder:"请输入内容..."},null,8,["modelValue"])])])):F("",!0),e("div",ws,[r[15]||(r[15]=e("div",{class:"setting-info"},[e("div",{class:"title"},"启用状态"),e("div",{class:"desc"},"暂时禁用此任务而不删除它")],-1)),e("div",$s,[t(D,{modelValue:b.value.enable,"onUpdate:modelValue":r[6]||(r[6]=C=>b.value.enable=C)},null,8,["modelValue"])])]),e("div",xs,[t(w,{theme:"primary",loading:L.value,onClick:B},{icon:s(()=>[t(R(He))]),default:s(()=>[m(" "+A(k.value?"保存修改":"立即创建"),1)]),_:1},8,["loading"]),t(w,{theme:"default",variant:"base",onClick:y},{default:s(()=>[...r[16]||(r[16]=[m("取消",-1)])]),_:1})])]),_:1},8,["data"])])):F("",!0)]),_:1}),t(ie,{loading:$.value,"show-overlay":""},{default:s(()=>[e("div",Cs,[f.value.length===0&&!$.value?(p(),I("div",Vs,"暂无任务，请点击上方创建")):F("",!0),(p(!0),I(se,null,ce(f.value,C=>(p(),I("div",{key:C.id,class:"task-card"},[e("div",Ss,[e("div",Us,[t(G,{size:"small",theme:C.enable?"success":"warning",variant:"light",class:"status-tag"},{default:s(()=>[m(A(C.enable?"运行中":"已暂停"),1)]),_:2},1032,["theme"]),e("span",Ms,A(C.name),1)]),e("div",Rs,[t(G,{size:"small",variant:"outline",theme:v(C.type),style:{"margin-right":"8px"}},{icon:s(()=>[(p(),j(Je(l(C.type))))]),default:s(()=>[m(" "+A(C.type.toUpperCase()),1)]),_:2},1032,["theme"]),e("span",Bs,[t(R(Ue)),m(" "+A(C.cron),1)])]),C.payload?(p(),I("div",{key:0,class:"task-payload",title:C.payload},A(C.payload),9,Is)):F("",!0)]),e("div",Ls,[t(w,{variant:"text",theme:"primary",onClick:ee=>c(C)},{icon:s(()=>[t(R(Ft))]),default:s(()=>[r[17]||(r[17]=m(" 编辑 ",-1))]),_:1},8,["onClick"]),t(w,{variant:"text",theme:"danger",onClick:ee=>N(C)},{icon:s(()=>[t(R(We))]),default:s(()=>[r[18]||(r[18]=m(" 删除 ",-1))]),_:1},8,["onClick"])])]))),128))])]),_:1},8,["loading"]),t(ns,{visible:i.value,"onUpdate:visible":r[7]||(r[7]=C=>i.value=C),"initial-value":b.value.cron,onConfirm:n},null,8,["visible","initial-value"])])}}}),Ps=oe(Es,[["__scopeId","data-v-98dd2a72"]]),As={class:"layout-container"},Os={class:"sidebar"},Ds=["onClick"],Fs={class:"nav-text"},Ts={class:"main-content"},Ns={key:0,class:"panel-wrapper"},zs={key:1,class:"panel-wrapper"},Gs={key:2,class:"panel-wrapper"},Js={key:3,class:"panel-wrapper"},Xs=ne({__name:"InstanceSettings",setup(o,{expose:g}){const x=_(!1),f=_(0),$=[{label:"实例设置",icon:Qe},{label:"插件/模组",icon:Nt},{label:"服务器属性",icon:zt},{label:"定时任务",icon:Ue}];return g({open:()=>{x.value=!0}}),(k,L)=>{const u=U("t-dialog");return p(),j(u,{visible:x.value,"onUpdate:visible":L[0]||(L[0]=i=>x.value=i),header:"实例配置",width:"90%",top:"3vh",attach:"body",footer:!1,class:"settings-dialog"},{default:s(()=>[e("div",As,[e("div",Os,[(p(),I(se,null,ce($,(i,b)=>e("div",{key:b,class:we(["nav-item",{active:f.value===b}]),onClick:z=>f.value=b},[(p(),j(Je(i.icon),{class:"nav-icon"})),e("span",Fs,A(i.label),1)],10,Ds)),64))]),e("div",Ts,[f.value===0?(p(),I("div",Ns,[t(dl)])):F("",!0),f.value===1?(p(),I("div",zs,[t(Cl)])):F("",!0),f.value===2?(p(),I("div",Gs,[t(Dl,{"instance-id":21})])):F("",!0),f.value===3?(p(),I("div",Js,[t(Ps)])):F("",!0)])])]),_:1},8,["visible"])}}}),js=oe(Xs,[["__scopeId","data-v-5ed0e6e3"]]),Ws={class:"monitor-container"},qs={class:"status-header"},Ks={class:"status-text"},Hs={class:"monitor-content"},Ys={class:"monitor-block"},Zs={class:"info-item"},Qs={class:"label"},en={class:"value"},tn={class:"monitor-block"},an={class:"info-item"},ln={class:"label"},sn={class:"value"},nn={key:0,class:"sub-val"},xe=20,on=ne({__name:"InstanceMonitor",props:{serverId:{},maxMemory:{},isRunning:{type:Boolean}},setup(o){const g=o,x=Ie(),f=_(null),$=_(null);let h=null,k=null;const L=_(new Array(xe).fill(0)),u=_(new Array(xe).fill(0)),i=te(()=>g.maxMemory>0),b=(y,B,N=100)=>({grid:{top:4,right:0,bottom:4,left:0},xAxis:{type:"category",show:!1,boundaryGap:!1},yAxis:{type:"value",min:0,max:N===null?void 0:N,show:!1},series:[{type:"line",data:B,smooth:!0,showSymbol:!1,lineStyle:{width:2,color:y},areaStyle:{color:new ta(0,0,0,1,[{offset:0,color:y.replace(")",", 0.2)").replace("rgb","rgba")},{offset:1,color:"transparent"}])}}]}),z=()=>{const y=getComputedStyle(document.documentElement),B=y.getPropertyValue("--td-brand-color").trim()||"#0052d9",N=y.getPropertyValue("--td-warning-color").trim()||"#e37318";if(f.value&&(h=Fe(f.value),h.setOption(b(B,L.value,100))),$.value){k=Fe($.value);const n=i.value?100:null;k.setOption(b(N,u.value,n))}window.addEventListener("resize",E)},E=()=>{h==null||h.resize(),k==null||k.resize()},d=te(()=>{const y=x.stats.memBytes/1024/1024;return y>1024?`${(y/1024).toFixed(2)} GB`:`${y.toFixed(0)} MB`}),T=async()=>{g.isRunning&&g.serverId&&(x.setMaxMemory(g.maxMemory),await x.connect(g.serverId))},c=async()=>{await x.disconnect()};return Q(()=>g.maxMemory,y=>{if(x.setMaxMemory(y),k){const B=y>0?100:null;k.setOption({yAxis:{max:B===null?void 0:B}})}},{immediate:!0}),Q(()=>x.stats,y=>{if(!(!g.isRunning||x.currentServerId!==g.serverId)){if(L.value.push(y.cpu),L.value.length>xe&&L.value.shift(),i.value)u.value.push(y.memPercent);else{const B=y.memBytes/1024/1024;u.value.push(B)}u.value.length>xe&&u.value.shift(),h==null||h.setOption({series:[{data:L.value}]}),k==null||k.setOption({series:[{data:u.value}]})}},{deep:!0}),Q(()=>g.isRunning,async y=>{y?Ce(()=>{E(),T()}):(L.value.fill(0),u.value.fill(0),h==null||h.setOption({series:[{data:L.value}]}),k==null||k.setOption({series:[{data:u.value}]}),await c())}),Q(()=>g.serverId,async(y,B)=>{y!==B&&(await c(),g.isRunning&&await T())}),ve(async()=>{await Ce(),z(),g.isRunning&&await T()}),Ve(async()=>{window.removeEventListener("resize",E),await c(),h==null||h.dispose(),k==null||k.dispose()}),(y,B)=>(p(),I("div",Ws,[e("div",qs,[e("span",Ks,[R(x).isConnected?(p(),j(R(Oe),{key:0,style:{color:"var(--td-success-color)"}})):(p(),j(R(Oe),{key:1,style:{color:"var(--td-text-color-disabled)"}})),m(" "+A(R(x).isConnected?"连接正常":"正在连接数据流..."),1)]),e("div",{class:we(["monitor-dot",{active:R(x).isConnected&&o.isRunning}])},null,2)]),e("div",Hs,[e("div",Ys,[e("div",Zs,[e("div",Qs,[t(R(Re)),B[0]||(B[0]=m(" CPU 使用率",-1))]),e("div",en,A(R(x).stats.cpu.toFixed(1))+" %",1)]),e("div",{ref_key:"cpuChartRef",ref:f,class:"chart-wrapper"},null,512)]),B[2]||(B[2]=e("div",{class:"divider"},null,-1)),e("div",tn,[e("div",an,[e("div",ln,[t(R(Gt)),B[1]||(B[1]=m(" 内存使用",-1))]),e("div",sn,[m(A(d.value)+" ",1),i.value?(p(),I("span",nn," ("+A(R(x).stats.memPercent.toFixed(1))+"%) ",1)):F("",!0)])]),e("div",{ref_key:"memChartRef",ref:$,class:"chart-wrapper"},null,512)])])]))}}),rn=oe(on,[["__scopeId","data-v-ddbf668d"]]),un={class:"sidebar-content"},dn={class:"control-header"},cn={class:"control-actions"},vn={class:"running-action-group"},mn={class:"action-row"},pn={class:"action-row"},fn={class:"card-content-area"},gn={key:0,class:"info-list"},yn={class:"info-item"},bn={class:"label"},_n={class:"value"},kn={class:"info-item"},hn={class:"label"},wn={class:"value"},$n={class:"info-item"},xn={class:"label"},Cn={class:"value"},Vn={class:"info-item"},Sn={class:"label"},Un={class:"value"},Mn={class:"info-item"},Rn={class:"label"},Bn={class:"value"},In={class:"info-item"},Ln={class:"label"},En={class:"value"},Pn={class:"info-item"},An={class:"label"},On={class:"value"},Dn={key:1,class:"info-item"},Fn={class:"label"},Tn={class:"info-item"},Nn={class:"label"},zn={class:"value"},Gn={key:1,class:"monitor-view"},Jn={key:1,class:"monitor-placeholder"},Xn=ne({__name:"ServerControlPanel",props:{serverId:{},isRunning:{type:Boolean},loading:{type:Boolean},serverInfo:{}},emits:["start","stop","clear-log","refresh-info","backup","force-exit","restart"],setup(o,{emit:g}){const x=o,f=g,$=_(null),h=_("info"),k=()=>{var E;(E=$.value)==null||E.open()},L=()=>{f("refresh-info")},u=_(0);let i=null;const b=E=>{if(!E)return 0;const d=E.match(/^(?:(\d+)\.)?(\d{1,2}):(\d{2}):(\d{2})(?:\.\d+)?$/);return d?parseInt(d[1]||"0",10)*86400+parseInt(d[2])*3600+parseInt(d[3])*60+parseInt(d[4]):0},z=te(()=>{if(u.value<=0)return"00:00:00";const E=Math.floor(u.value/86400),d=new Date(u.value*1e3).toISOString().substr(11,8);return E>0?`${E}天 ${d}`:d});return Q(()=>{var E;return(E=x.serverInfo)==null?void 0:E.uptime},E=>E&&(u.value=b(E)),{immediate:!0}),Q(()=>x.isRunning,E=>{E?i||(i=window.setInterval(()=>u.value++,1e3)):i&&(clearInterval(i),i=null)},{immediate:!0}),Ve(()=>{i&&clearInterval(i)}),(E,d)=>{const T=U("t-tag"),c=U("t-button"),y=U("t-card"),B=U("t-radio-button"),N=U("t-radio-group");return p(),I("div",un,[t(y,{bordered:!1,class:"control-card"},{default:s(()=>[e("div",dn,[e("div",{class:we(["status-indicator",{running:o.isRunning}])},[d[8]||(d[8]=e("span",{class:"pulse"},null,-1)),m(A(o.isRunning?"Running":"Stopped"),1)],2),t(T,{theme:o.isRunning?"success":"default",variant:"light",shape:"round"},{default:s(()=>[m(A(o.isRunning?"运行中":"已停止"),1)]),_:1},8,["theme"])]),e("div",cn,[o.isRunning?(p(),I(se,{key:1},[e("div",vn,[t(c,{class:"stop-btn",theme:"danger",size:"large",loading:o.loading,variant:o.loading?"outline":"base",onClick:d[1]||(d[1]=n=>!o.loading&&E.$emit("stop"))},{icon:s(()=>[t(R(Ze))]),default:s(()=>[m(" "+A(o.loading?"停止中...":"停止"),1)]),_:1},8,["loading","variant"]),t(c,{theme:"warning",size:"large",shape:"square",disabled:o.loading,onClick:d[2]||(d[2]=n=>E.$emit("restart"))},{icon:s(()=>[t(R(ke))]),_:1},8,["disabled"])]),o.loading?(p(),j(c,{key:0,class:"force-kill-btn",theme:"danger",variant:"dashed",block:"",onClick:d[3]||(d[3]=n=>E.$emit("force-exit"))},{icon:s(()=>[t(R(Ke))]),default:s(()=>[d[10]||(d[10]=m(" 强制结束 ",-1))]),_:1})):F("",!0)],64)):(p(),j(c,{key:0,theme:"primary",size:"large",block:"",loading:o.loading,onClick:d[0]||(d[0]=n=>{E.$emit("clear-log"),E.$emit("start")})},{icon:s(()=>[t(R(Ye))]),default:s(()=>[d[9]||(d[9]=m("启动实例 ",-1))]),_:1},8,["loading"])),e("div",mn,[t(c,{class:"glass-btn",variant:"outline",block:"",onClick:d[4]||(d[4]=n=>R(je)(`/instance/files/${o.serverId}`))},{icon:s(()=>[t(R(De))]),default:s(()=>[d[11]||(d[11]=m("文件 ",-1))]),_:1}),t(c,{class:"glass-btn",variant:"outline",block:"",disabled:!o.isRunning,loading:o.loading,onClick:d[5]||(d[5]=n=>E.$emit("backup"))},{icon:s(()=>[t(R(Jt))]),default:s(()=>[d[12]||(d[12]=m("备份 ",-1))]),_:1},8,["disabled","loading"])]),e("div",pn,[t(c,{class:"glass-btn",variant:"outline",theme:"warning",block:"",onClick:d[6]||(d[6]=n=>E.$emit("clear-log"))},{icon:s(()=>[t(R(ke))]),default:s(()=>[d[13]||(d[13]=m("清空 ",-1))]),_:1}),t(c,{class:"glass-btn",variant:"outline",theme:"primary",block:"",onClick:k},{icon:s(()=>[t(R(Qe))]),default:s(()=>[d[14]||(d[14]=m("设置 ",-1))]),_:1})])])]),_:1}),t(y,{bordered:!1,title:"实例概览",class:"info-card"},{actions:s(()=>[t(N,{modelValue:h.value,"onUpdate:modelValue":d[7]||(d[7]=n=>h.value=n),variant:"default-filled",size:"small"},{default:s(()=>[t(B,{value:"info"},{default:s(()=>[t(R(Ht)),d[15]||(d[15]=m(" 详情",-1))]),_:1}),t(B,{value:"monitor",disabled:!o.isRunning},{default:s(()=>[t(R(Yt)),d[16]||(d[16]=m(" 监控",-1))]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),default:s(()=>{var n,l,v,M,r,w,O,W,q;return[e("div",fn,[h.value==="info"?(p(),I("div",gn,[e("div",yn,[e("div",bn,[t(R(Xt)),d[17]||(d[17]=m(" 实例名称",-1))]),e("div",_n,A((n=o.serverInfo)==null?void 0:n.name),1)]),((l=o.serverInfo)==null?void 0:l.java)!=="none"?(p(),I(se,{key:0},[e("div",kn,[e("div",hn,[t(R(Re)),d[18]||(d[18]=m(" 内存限制",-1))]),e("div",wn,A((v=o.serverInfo)==null?void 0:v.maxM)+" MB",1)]),d[24]||(d[24]=e("div",{class:"proxy-group"},null,-1)),e("div",$n,[e("div",xn,[t(R(jt)),d[19]||(d[19]=m(" 运行端口",-1))]),e("div",Cn,A((r=(M=o.serverInfo)==null?void 0:M.mcConfig)==null?void 0:r.serverPort),1)]),e("div",Vn,[e("div",Sn,[t(R(Wt)),d[20]||(d[20]=m(" 游戏难度",-1))]),e("div",Un,[t(T,{theme:"primary"},{default:s(()=>{var P,D;return[m(A((D=(P=o.serverInfo)==null?void 0:P.mcConfig)==null?void 0:D.difficulty),1)]}),_:1})])]),e("div",Mn,[e("div",Rn,[t(R(qt)),d[21]||(d[21]=m(" 游戏模式",-1))]),e("div",Bn,[t(T,null,{default:s(()=>{var P,D;return[m(A((D=(P=o.serverInfo)==null?void 0:P.mcConfig)==null?void 0:D.gamemode),1)]}),_:1})])]),e("div",In,[e("div",Ln,[t(R(De)),d[22]||(d[22]=m(" 游戏地图",-1))]),e("div",En,A((O=(w=o.serverInfo)==null?void 0:w.mcConfig)==null?void 0:O.levelName),1)]),e("div",Pn,[e("div",An,[t(R(Kt)),d[23]||(d[23]=m(" 正版验证",-1))]),e("div",On,[t(T,{theme:((q=(W=o.serverInfo)==null?void 0:W.mcConfig)==null?void 0:q.onlineMode)==="true"?"success":"warning"},{default:s(()=>{var P,D;return[m(A(((D=(P=o.serverInfo)==null?void 0:P.mcConfig)==null?void 0:D.onlineMode)==="true"?"开启":"关闭"),1)]}),_:1},8,["theme"])])])],64)):(p(),I("div",Dn,[e("div",Fn,[t(R(Re)),d[25]||(d[25]=m(" 模式",-1))]),d[26]||(d[26]=e("div",{class:"value"},"自定义模式",-1))])),d[28]||(d[28]=e("div",{class:"proxy-group"},null,-1)),e("div",Tn,[e("div",Nn,[t(R(Ue)),d[27]||(d[27]=m(" 运行时长",-1))]),e("div",zn,A(o.isRunning?z.value:"--:--:--"),1)])])):h.value==="monitor"?(p(),I("div",Gn,[o.serverInfo&&o.isRunning?(p(),j(rn,{key:0,"server-id":o.serverId,"is-running":o.isRunning,"max-memory":o.serverInfo.java==="none"?0:o.serverInfo.maxM||4096},null,8,["server-id","is-running","max-memory"])):(p(),I("div",Jn,"实例未运行"))])):F("",!0)])]}),_:1}),t(js,{ref_key:"settingsRef",ref:$,"server-id":o.serverId,onSuccess:L},null,8,["server-id"])])}}}),jn=oe(Xn,[["__scopeId","data-v-0d936d2a"]]),Wn={class:"console-page"},qn={class:"layout-container"},Kn={class:"main-terminal-area"},Hn={class:"sidebar-area"},Yn={style:{"line-height":"1.6"}},Zn={style:{"margin-bottom":"12px"}},Qn=ne({__name:"index",setup(o){const g=he(),x=Vt(),f=Ie(),$=_(parseInt(g.params.serverId)||0),h=_(!1),k=_(!1),L=_(null),u=_(null);async function i(){var n;if($.value)try{k.value=!0;const l=await St($.value);await x.refreshInstanceList(),h.value=l.status,L.value=l,k.value=!1}catch(l){(n=u.value)==null||n.writeln(`\x1B[1;31m[Error] 获取实例信息失败: ${l.message}\x1B[0m`),k.value=!1}}const b=async()=>{var n,l;k.value=!0;try{(n=u.value)==null||n.writeln("\x1B[1;32m[System] 正在发送启动指令...\x1B[0m"),await de($.value,"start"),X.success("实例启动指令已发送"),k.value=!1}catch(v){(l=u.value)==null||l.writeln(`\x1B[1;31m[Error] 启动失败: ${v.message}\x1B[0m`),k.value=!1}},z=async()=>{var n,l;k.value=!0;try{(n=u.value)==null||n.writeln("\x1B[1;32m[System] 正在发送停止指令...\x1B[0m"),await de($.value,"stop"),X.warning("实例停止指令已发送"),k.value=!1}catch(v){(l=u.value)==null||l.writeln(`\x1B[1;31m[Error] 停止失败: ${v.message}\x1B[0m`),k.value=!1}},E=async()=>{var n,l;k.value=!0;try{(n=u.value)==null||n.writeln("\x1B[1;32m[System] 正在发送强制退出指令...\x1B[0m"),await de($.value,"forceExit"),X.warning("强制退出指令已发送"),k.value=!1}catch(v){(l=u.value)==null||l.writeln(`\x1B[1;31m[Error] 强制退出失败: ${v.message}\x1B[0m`),k.value=!1}},d=async()=>{var n,l;k.value=!0;try{(n=u.value)==null||n.writeln("\x1B[1;32m[System] 正在发送重启指令...\x1B[0m"),await de($.value,"restart"),X.warning("重启执行成功"),k.value=!1}catch(v){(l=u.value)==null||l.writeln(`\x1B[1;31m[Error] 重启失败: ${v.message}\x1B[0m`),k.value=!1}},T=async()=>{var n,l;try{(n=u.value)==null||n.writeln("\x1B[1;32m[System] 正在发送备份任务...\x1B[0m"),await de($.value,"backup"),X.success("备份任务启动中···"),k.value=!1}catch(v){(l=u.value)==null||l.writeln(`\x1B[1;31m[Error] 备份任务启动失败: ${v.message}\x1B[0m`)}},c=()=>{var n;(n=u.value)==null||n.clear()},y=_(!1),B=async()=>{$.value&&(f.onEula(()=>{y.value=!0}),await f.connect($.value))},N=async n=>{try{y.value=!1,await de($.value,`agreeEula?${n}`),X.success(n?"已发送同意请求":"已发送请求")}catch(l){X.error(l.message||"发送失败")}};return Q(()=>g.params.serverId,async n=>{g.name==="InstanceConsole"&&n&&($.value=parseInt(n),await i())}),ve(async()=>{$.value&&(await i(),await B())}),(n,l)=>{const v=U("t-link"),M=U("t-dialog");return p(),I("div",Wn,[e("div",qn,[e("div",Kn,[t(ia,{ref_key:"terminalRef",ref:u,"server-id":$.value,onUpdate:l[0]||(l[0]=r=>i())},null,8,["server-id"])]),e("div",Hn,[t(jn,{"server-id":$.value,"is-running":h.value,loading:k.value,"server-info":L.value,onStart:b,onStop:z,onBackup:T,onClearLog:c,onForceExit:E,onRestart:d},null,8,["server-id","is-running","loading","server-info"])])]),t(M,{visible:y.value,"onUpdate:visible":l[1]||(l[1]=r=>y.value=r),header:"是否同意EULA","confirm-btn":{content:"同意",theme:"primary"},"cancel-btn":{content:"不同意",theme:"default"},onConfirm:l[2]||(l[2]=r=>N(!0)),onCancel:l[3]||(l[3]=r=>N(!1))},{default:s(()=>[e("div",Yn,[e("p",Zn,[l[5]||(l[5]=m(" 开启Minecraft服务器需要您同意 ",-1)),l[6]||(l[6]=e("strong",null,"EULA",-1)),l[7]||(l[7]=m(" ！",-1)),t(v,{theme:"primary",underline:""},{default:s(()=>[...l[4]||(l[4]=[m(" (https://aka.ms/minecrafteula)",-1)])]),_:1})]),l[8]||(l[8]=e("p",{style:{"margin-bottom":"12px"}},[e("strong",{style:{color:"#e34d59"}},"请您务必认真仔细阅读！")],-1)),l[9]||(l[9]=e("p",{style:{"margin-bottom":"12px"}},[e("strong",null,"注意："),m("不论您选择是或否，服务器都会在您操作后继续运行。")],-1)),l[10]||(l[10]=e("p",{style:{"margin-bottom":"12px",color:"#f59a23"}},[m(" ⚠️ 如果您"),e("strong",null,"未同意 EULA"),m("，服务器可能会在运行时自动关闭！ ")],-1)),l[11]||(l[11]=e("p",{style:{"margin-top":"16px"}},[m("💡 提示：如要在每次启动实例时忽略此提示，请在"),e("strong",null,"设置"),m("里进行配置。")],-1))])]),_:1},8,["visible"])])}}}),Ho=oe(Qn,[["__scopeId","data-v-022267fb"]]);export{Ho as default};
