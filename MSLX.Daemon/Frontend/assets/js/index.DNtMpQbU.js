import{a as be}from"./vue-router.CTuarHf7.js";import{F as y,bb as Ne,be as De,D as ne,P as ee,R as ce,V as we,aa as $e,aX as B,a$ as e,b5 as P,ak as it,bd as rt,bk as ut,bi as dt,bj as ct,aY as p,K as te,G as t,b0 as R,b2 as o,b6 as z,aZ as ye,b1 as W,ap as I,O as re,ao as _,b3 as de,am as Fe,b4 as ze}from"./index.BbdIPky0.js";import{c as J}from"./ansi-colors.gpWjHU8Z.js";import{d as vt}from"./pinia.DE9DXmFR.js";import{u as Ge,_ as oe,r as xe,c as mt}from"./index.mEJ9vWkt.js";import{g as pt,b as ft,u as gt,c as bt,d as Re}from"./instance.qKL1KPib.js";import{S as yt,g as _t,a as kt}from"./localJava.BbpR3JDn.js";import{d as ht,i as wt,u as $t,f as xt,g as Ct,s as St,a as Vt,b as Mt}from"./files.DL6cF1hP.js";import{M as Y,N as Rt,D as Ie}from"./tdesign-vue-next.EnwhK9x8.js";import{ac as Ut,ad as It,ae as Le,af as Pe,a1 as Bt,U as Ce,y as Lt,_ as Je,ag as je,ah as Pt,ai as Xe,aj as Et,z as Se,g as At,c as Ot,ak as Tt,a7 as We,a8 as Ke,ab as Nt,M as qe,al as Dt,am as Ft,an as Ee,ao as Ue,ap as zt,aq as Ae,a4 as Gt,ar as Jt,as as jt,at as Xt,au as Wt,av as Kt,aw as qt,ax as Ht}from"./tdesign-icons-vue-next.DieAbZNO.js";import{F as Yt}from"./FileUploader.PP8wxkhk.js";import{d as Zt}from"./cron-parser.BqMfRICj.js";import{i as Oe}from"./echarts.J8iroDPP.js";import{V as Qt}from"./zrender.B_NAtvFA.js";import"./core-js-pure.DghWRT_o.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./pinia-plugin-persistedstate.n2tMOXAx.js";import"./tvision-color.BU_YHHaJ.js";import"./chroma-js.Cmk4elvR.js";import"./bezier-easing.jp9ayU57.js";import"./lodash.BpjWTYO-.js";import"./axios.R-lXtGyY.js";import"./qs.CnepGyXr.js";import"./side-channel.Bf-JVZLg.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.CD-SYzlK.js";import"./side-channel-list.CQN2BsdT.js";import"./side-channel-map.BJ69Knz3.js";import"./get-intrinsic.CAdfHqt8.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.Cbri-GHQ.js";import"./dunder-proto.q7lw_6_J.js";import"./call-bind-apply-helpers.BxcZtPLH.js";import"./function-bind.BbkWVFrm.js";import"./hasown.ckq0ukzO.js";import"./call-bound.BO70H6sD.js";import"./side-channel-weakmap.BkoVKe_V.js";import"./nprogress.CMq2Rk2a.js";import"./lodash-es.ClUTdtmA.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";import"./luxon.BVaPVz1w.js";import"./tslib.BDyQ-Jie.js";const He=vt("instanceHub",()=>{const l=Ge(),v=y(null),k=y(!1),d=y(null),S=y(0),f=y(0);let C=Promise.resolve();const V=y({cpu:0,memBytes:0,memPercent:0}),u=new Set,n=new Set,b=g=>{f.value=g},D=g=>(C=C.then(async()=>{var M;if(S.value++,((M=v.value)==null?void 0:M.state)==="Connected"&&d.value===g)return;v.value&&await L(),d.value=g,f.value=0;const{baseUrl:E,token:x}=l,r=new URL("/api/hubs/instanceControlHub",E||window.location.origin);x&&r.searchParams.append("x-user-token",x);const c=new Ne().withUrl(r.toString(),{withCredentials:!1}).configureLogging(De.Warning).withAutomaticReconnect([0,2e3,5e3,1e4]).build();c.on("ReceiveLog",i=>{u.forEach(w=>w(i))}),c.on("CommandResult",(i,w)=>{n.forEach(G=>G(i,w))}),c.on("ReceiveStatus",(i,w,G)=>{if(String(i)!==String(g))return;let Z=0;if(f.value>0){const H=f.value*1024*1024;Z=G/H*100,Z>100&&(Z=100)}V.value={cpu:w,memBytes:G,memPercent:Z}}),c.onreconnecting(()=>u.forEach(i=>i("\x1B[1;31m[System] 连接中断，尝试重连...\x1B[0m"))),c.onreconnected(async()=>{u.forEach(i=>i("\x1B[1;32m[System] 网络恢复，重新加入会话...\x1B[0m"));try{await c.invoke("JoinGroup",g)}catch(i){console.error(i)}});try{await c.start(),await c.invoke("JoinGroup",g),v.value=c,k.value=!0,u.forEach(i=>i("\x1B[1;32m[System] 已连接到实例控制服务\x1B[0m"))}catch(i){k.value=!1,u.forEach(w=>w(`\x1B[1;31m[Error] 连接失败: ${i.message}\x1B[0m`)),d.value=null,v.value=null}}),C),j=()=>(C=C.then(async()=>{S.value>0&&S.value--,S.value===0&&await L()}),C),L=async()=>{if(v.value)try{v.value.state==="Connected"&&d.value&&await v.value.invoke("LeaveGroup",d.value),await v.value.stop()}catch(g){console.warn(g)}v.value=null,k.value=!1,d.value=null,f.value=0,V.value={cpu:0,memBytes:0,memPercent:0}};return{isConnected:k,stats:V,currentServerId:d,connect:D,disconnect:j,setMaxMemory:b,sendCommand:async g=>{if(!v.value||v.value.state!=="Connected"||!d.value)throw new Error("未连接到服务");await v.value.invoke("SendCommand",d.value,g)},onLog:g=>(u.add(g),()=>u.delete(g)),onCommandResult:g=>(n.add(g),()=>n.delete(g))}});J.enabled=!0;const ea=l=>l?(l.includes("Done")&&l.includes("!")&&(l=l.replace(/Done \((.*?)\)!/g,(v,k)=>`${J.green.bold("Done")} (${J.blue(k)})!`)),l.startsWith("[System]")&&(l=l.replace(/^\[System\]/,`[${J.blue.bold("System")}]`)),l.includes("[MSLX]")&&(l=l.replace(/\[MSLX\]/g,`[${J.magenta.bold("MSLX")}]`)),l.includes("[MSLX-Backup]")&&(l=l.replace(/\[MSLX-Backup\]/g,`[${J.magenta.bold("MSLX-Backup")}]`)),l.startsWith(">>>")&&(l=l.replace(/^>>>/,J.red.bold(">>>"))),l=l.replace(/^\[(\d{2}:\d{2}:\d{2})\s+(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]:/,(v,k,d)=>{let S=d;switch(d){case"INFO":S=J.green("INFO");break;case"WARN":case"WARNING":S=J.magenta.bold("WARN");break;case"ERROR":case"FATAL":S=J.red.bold(d);break;case"DEBUG":S=J.blue("DEBUG");break}return`[${J.gray(k)} ${S}]:`}),/^\[\d{2}:\d{2}:\d{2}\]/.test(l)&&(l=l.replace(/^\[(\d{2}:\d{2}:\d{2})\]/,(v,k)=>`[${J.gray(k)}]`)),l=l.replace(/\[([^/]+)\/(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]/g,(v,k,d)=>{const S=J.blue(k);let f=d;switch(d){case"INFO":f=J.green("INFO");break;case"WARN":f=J.magenta("WARN");break;case"ERROR":f=J.red.bold("ERROR");break}return`[${S}/${f}]`}),l=l.replace(new RegExp("(?<=:\\s|^)\\s*\\[([a-zA-Z0-9_\\-.\\s]+)\\](?=\\s)","g"),(v,k)=>k==="System"||k.includes("MSLX")?v:` [${J.bold.black(k)}]`),l=l.replace(/(https?:\/\/[^\s]+)/g,v=>J.blue.underline(v)),l=l.replace(/\b\d+\.\d+(\.\d+)?(-[a-zA-Z0-9]+)?\b/g,v=>J.magenta(v)),l=l.replace(/\b\d+(\.\d+)?\s?(ms|s|%|MB|GB|KB)\b/gi,v=>J.blue(v)),l=l.replace(new RegExp("(\\u001b\\[[\\d;]*m)|((?<!\\d:\\d)\\b\\d+\\b(?!\\s*:\\s*\\d))","g"),(v,k,d)=>{if(k)return v;if(d){if(d.length>=4&&d.length<=6)return J.blue(d);if(d.length<=3)return J.blue(d)}return v}),l=l.replace(/(\*:\d{1,5})/,v=>J.blue.bold(v)),l=l.replace(/\b(Loaded|Saved|Starting|Started|Connected)\b/g,v=>J.green(v)),l=l.replace(/\bDone\b(?!\u001b)/g,J.green.bold("Done")),l=l.replace(/\b(Failed|Exception|Error|Caused by|Stopping|Closed)\b/g,v=>J.red.bold(v)),l=l.replace(/\b(Loading|Preparing|Generating|Saving|Using|Running)\b/g,v=>J.magenta(v)),l=l.replace(/\b(Minecraft|Paper|Velocity|Java)\b/gi,v=>J.bold.black(v)),l=l.replace(/'minecraft:[a-z_]+'/g,v=>J.magenta(v)),l=l.replace(/\n/g,`\r
`),l):"",ta={class:"terminal-header"},aa={class:"tab-title"},sa={class:"terminal-footer"},la=ne({__name:"ServerTerminal",props:{serverId:{}},emits:["update"],setup(l,{expose:v,emit:k}){const d=l,S=k,f=He(),C=y(null),V=y(null);let u=null,n=null,b=null,D=null,j=null,L=null,h="";const a=y(""),m={dark:{background:"#181818",foreground:"#cccccc",cursor:"#cccccc",selectionBackground:"#264f78",black:"#000000",red:"#cd3131",green:"#0dbc79",yellow:"#e5e510",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"},light:{background:"#ffffff",foreground:"#333333",cursor:"#333333",selectionBackground:"#add6ff",black:"#000000",red:"#cd3131",green:"#00bc79",yellow:"#9d9d10",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"}};J.enabled=!0;const g=A=>ea(A),E=()=>{if(!V.value||!C.value)return;if(u){u.clear(),i();return}const A=document.documentElement.getAttribute("theme-mode")==="dark";u=new dt.Terminal({cursorBlink:!0,cursorStyle:"block",fontSize:13,fontFamily:'Menlo, Monaco, "Courier New", monospace',lineHeight:1.4,theme:A?m.dark:m.light,disableStdin:!1,convertEol:!0}),n=new ct.FitAddon,u.loadAddon(n),u.open(V.value),u.onData(K=>x(K));const T=()=>{if(V.value&&V.value.clientWidth>0&&V.value.clientHeight>0)try{n==null||n.fit()}catch(K){console.warn(K)}};b=new ResizeObserver(()=>window.requestAnimationFrame(T)),b.observe(C.value),setTimeout(T,100),i()},x=async A=>{!u||!d.serverId||(A==="\r"?(u.write(`\r
`),h.trim()&&await c(h),h=""):A===""?h.length>0&&(h=h.slice(0,-1),u.write("\b \b")):A>=" "&&(h+=A,u.write(A)))},r=async()=>{if(!a.value)return;const A=a.value;u==null||u.writeln(A),await c(A),a.value=""},c=async A=>{try{await f.sendCommand(A)}catch(T){u==null||u.writeln(`\x1B[1;31m[Error] ${T.message}\x1B[0m`)}},M=()=>{if(!u)return;const A=document.documentElement.getAttribute("theme-mode")==="dark";u.options.theme=A?m.dark:m.light},i=()=>{u==null||u.writeln("\x1B[1;34m[System]\x1B[0m 正在连接服务器控制台 ..."),u==null||u.writeln(`\x1B[1;34m[System]\x1B[0m 实例 ID: ${d.serverId}`),u==null||u.writeln("")},w=async()=>{d.serverId&&(j&&j(),j=f.onLog(A=>{u&&u.writeln(g(A)),A.startsWith("[MSLX]")&&S("update")}),L&&L(),L=f.onCommandResult((A,T)=>{A||u==null||u.writeln(`\x1B[1;31m[System] 指令执行反馈: ${T}\x1B[0m`)}),await f.connect(d.serverId))},G=async()=>{j&&j(),L&&L(),await f.disconnect()};return v({writeln:A=>u==null?void 0:u.writeln(A),clear:()=>{u==null||u.clear(),i()}}),ee(()=>d.serverId,async(A,T)=>{A!==T&&(await G(),E(),await w())}),ce(async()=>{await we(),E(),D=new MutationObserver(M),D.observe(document.documentElement,{attributes:!0,attributeFilter:["theme-mode"]}),await w()}),$e(async()=>{D==null||D.disconnect(),b==null||b.disconnect(),u==null||u.dispose(),await G()}),(A,T)=>(p(),B("div",{ref_key:"terminalWrapper",ref:C,class:"terminal-wrapper"},[e("div",ta,[T[1]||(T[1]=e("div",{class:"dots"},[e("span",{class:"dot red"}),e("span",{class:"dot yellow"}),e("span",{class:"dot green"})],-1)),e("div",aa,"MSLX 服务端控制台 | #"+P(l.serverId),1)]),e("div",{ref_key:"terminalBody",ref:V,class:"terminal-body"},null,512),e("div",sa,[it(e("input",{"onUpdate:modelValue":T[0]||(T[0]=K=>a.value=K),class:"cmd-input",placeholder:"发送控制台指令...",onKeyup:ut(r,["enter"])},null,544),[[rt,a.value]]),e("button",{class:"send-btn",onClick:r},"发送")])],512))}}),na=oe(la,[["__scopeId","data-v-b532051e"]]),oa={class:"settings-container"},ia={class:"setting-item"},ra={class:"setting-control"},ua={class:"setting-item"},da={class:"setting-info"},ca={class:"desc"},va={class:"setting-control"},ma={class:"setting-item"},pa={class:"setting-control"},fa={key:0,style:{"margin-top":"8px"}},ga={class:"setting-item"},ba={class:"setting-info"},ya={class:"title"},_a={class:"desc"},ka={class:"setting-control"},ha={class:"setting-item"},wa={class:"setting-control"},$a={key:0,class:"core-tools-panel"},xa={key:0,class:"upload-progress"},Ca={class:"setting-item"},Sa={class:"setting-control flex-row"},Va={class:"memory-input-group"},Ma={class:"memory-input-group"},Ra={class:"setting-item"},Ua={class:"setting-control flex-row"},Ia={class:"setting-info-desc-only"},Ba={style:{"font-size":"12px",color:"var(--td-text-color-placeholder)",cursor:"help"}},La={class:"setting-item"},Pa={class:"setting-control"},Ea={key:0,style:{"margin-top":"8px"}},Aa={key:2,class:"setting-group-title"},Oa={key:3,class:"setting-item"},Ta={class:"setting-control"},Na={key:0,style:{"margin-top":"8px"}},Da={class:"setting-item"},Fa={class:"setting-control"},za={key:4,class:"setting-item"},Ga={class:"setting-control"},Ja={class:"setting-item"},ja={class:"setting-control"},Xa={class:"setting-item"},Wa={class:"setting-control flex-row"},Ka={class:"setting-item"},qa={class:"setting-control flex-row"},Ha={class:"form-actions"},Ya={class:"progress-body"},Za={id:"update-log-box",class:"log-box"},Qa={class:"time"},es={key:0,class:"dialog-actions"},ts=ne({__name:"GeneralSettings",setup(l){const v=be(),k=Ge(),d=te(()=>{const $=v.params.serverId;return $?parseInt($):NaN}),S=y(null),f=y(!1),C=y(!1),V=y(!1),u=[{label:"UTF-8",value:"utf-8"},{label:"GBK",value:"gbk"}],n=y({id:d.value,name:"",base:"",java:"",core:"",minM:1024,maxM:4096,args:"",yggdrasilApiAddr:"",backupMaxCount:20,backupDelay:10,backupPath:"MSLX://Backup/Instance",autoRestart:!1,forceAutoRestart:!0,runOnStartup:!1,inputEncoding:"utf-8",outputEncoding:"utf-8",fileEncoding:"utf-8",coreUrl:"",coreSha256:"",coreFileKey:""}),b=y("MB"),D=y("MB"),j=[{label:"MB",value:"MB"},{label:"GB",value:"GB"}],L=te({get:()=>{if(b.value==="GB"){const $=n.value.minM/1024;return Math.round($*100)/100}return n.value.minM},set:$=>{n.value.minM=b.value==="GB"?Math.round($*1024):$}}),h=te({get:()=>{if(D.value==="GB"){const $=n.value.maxM/1024;return Math.round($*100)/100}return n.value.maxM},set:$=>{n.value.maxM=D.value==="GB"?Math.round($*1024):$}}),a=y("custom"),m=y([]),g=y([]),E=y(""),x=y(""),r=async($=!1)=>{try{$&&Y.info("正在扫描 Java 环境...");const s=await _t(k.userInfo.systemInfo.osType.toLowerCase().replace("os",""),k.userInfo.systemInfo.osArchitecture.toLowerCase());s&&Array.isArray(s)&&(m.value=s.map(X=>({label:`Java ${X} (在线)`,value:X})));const q=await kt($);g.value=q.map(X=>({label:`Java ${X.version} (${X.path})`,value:X.path})),$&&Y.success("刷新成功")}catch(s){console.error(s)}};ee([a,E,x],([$,s,q])=>{$==="none"?n.value.java="none":$==="env"?n.value.java="java":$==="custom"||$==="local"?n.value.java=q:$==="online"&&(n.value.java=s?`MSLX://Java/${s}`:"")});const c=y("MSLX://Backup/Instance"),M=y("");ee([c,M],([$,s])=>{$==="custom"?n.value.backupPath=s:n.value.backupPath=$});const i=y(""),w=y(""),G=[{label:"官方/离线模式 (无)",value:"none"},{label:"MSL 统一身份验证 (MSL Skin)",value:"https://skin.mslmc.net/api/yggdrasil"},{label:"LittleSkin",value:"https://littleskin.cn/api/yggdrasil"},{label:"自定义服务器",value:"custom"}];ee([i,w],([$,s])=>{$==="none"?n.value.yggdrasilApiAddr="":$==="custom"?n.value.yggdrasilApiAddr=s:n.value.yggdrasilApiAddr=$});const Z=y(!1),H=y(!1),A=y(null),T=y(!1),K=y(0),N=y(""),F=$=>{n.value.core=$.filename,n.value.coreUrl=$.url,n.value.coreSha256=$.sha256,n.value.coreFileKey="",Z.value=!1,Y.success(`已选择核心: ${$.filename}，保存后将自动下载`)},O=()=>{var $;return($=A.value)==null?void 0:$.click()},se=async $=>{var X;const s=$.target;if(!((X=s.files)!=null&&X.length))return;const q=s.files[0];if(n.value.coreFileKey)try{await ht(n.value.coreFileKey)}catch{console.error("删除上传失败")}N.value=q.name,T.value=!0,K.value=0;try{const Q=(await wt()).uploadId,le=5*1024*1024,fe=Math.ceil(q.size/le);for(let ie=0;ie<fe;ie++){const Ve=q.slice(ie*le,Math.min(q.size,(ie+1)*le));await $t(Q,ie,Ve),K.value=Math.floor((ie+1)/fe*100)}const ge=await xt(Q,fe);n.value.coreFileKey=ge.uploadId,n.value.core=q.name,n.value.coreUrl="",Y.success("文件上传就绪，保存后生效"),Z.value=!1}catch(ae){Y.error(`上传失败: ${ae.message}`)}finally{T.value=!1,s.value=""}},Ye=()=>{V.value||Rt.warning({title:"风险操作",content:"修改实例路径会导致面板无法找到原有文件。请确保您已手动移动了文件，或您明确知道自己在做什么。",duration:5e3}),V.value=!V.value},ve=y(!1),me=y(0),_e=y([]),ue=y(null),Ze=te(()=>a.value==="none"?{name:[{required:!0,message:"服务器名称不能为空",trigger:"blur"}],base:[{required:!0,message:"基础路径不能为空",trigger:"blur"}],args:[{required:!0,message:"自定义模式必须填写启动命令",trigger:"blur"}]}:{name:[{required:!0,message:"服务器名称不能为空",trigger:"blur"}],base:[{required:!0,message:"基础路径不能为空",trigger:"blur"}],java:[{required:!0,message:"Java 环境不能为空",trigger:"change"}],core:[{required:!0,message:"核心文件名不能为空",trigger:"change"}],minM:[{required:!0,message:"必填",trigger:"blur"}],maxM:[{required:!0,message:"必填",trigger:"blur"}]}),pe=async()=>{if(d.value){f.value=!0;try{await r(),n.value.id=d.value;const $=await pt(d.value);if(n.value={...n.value,...$,coreUrl:"",coreFileKey:"",coreSha256:""},b.value=$.minM>0&&$.minM%1024===0?"GB":"MB",D.value=$.maxM>0&&$.maxM%1024===0?"GB":"MB",V.value=!1,$.java==="none")a.value="none";else if($.java==="java")a.value="env";else if($.java.startsWith("MSLX://Java/"))a.value="online",E.value=$.java.replace("MSLX://Java/","");else{const X=g.value.find(ae=>ae.value===$.java);a.value=X?"local":"custom",x.value=$.java}const s=$.backupPath;s==="MSLX://Backup/Instance"||s==="MSLX://Backup/Data"?c.value=s:(c.value="custom",M.value=s);const q=$.yggdrasilApiAddr;q?q==="https://skin.mslmc.net/api/yggdrasil"?i.value="https://skin.mslmc.net/api/yggdrasil":q==="https://littleskin.cn/api/yggdrasil"?i.value="https://littleskin.cn/api/yggdrasil":(i.value="custom",w.value=q):i.value="none"}catch($){Y.error("获取配置失败: "+$.message)}finally{f.value=!1}}};ee(()=>v.params.serverId,$=>{v.name==="InstanceConsole"&&$&&pe()}),ce(pe);const Qe=async()=>{var s,q;if(await((s=S.value)==null?void 0:s.validate())===!0&&!(a.value!=="none"&&(n.value.coreUrl||n.value.coreFileKey)&&!await new Promise(Q=>{const le=Ie.confirm({header:"确认变更核心文件?",body:"检测到您上传或选择了新的核心文件，这将覆盖服务器现有的部署。",theme:"warning",onConfirm:()=>{le.hide(),Q(!0)},onClose:()=>{le.hide(),Q(!1)}})}))){a.value==="none"&&(n.value.core="none",n.value.minM=1027,n.value.maxM=1102,n.value.java="none",n.value.coreUrl="",n.value.coreFileKey="",n.value.coreSha256=""),C.value=!0;try{const X=await ft(n.value);((q=X.data)==null?void 0:q.needListen)??X.needListen?et():(Y.success("配置已保存"),C.value=!1,pe())}catch(X){Y.error(X.message||"保存失败"),C.value=!1}}},et=async()=>{ve.value=!0,me.value=0,_e.value=[];const{baseUrl:$,token:s}=k,q=new URL("/api/hubs/updateProgressHub",$||window.location.origin);q.searchParams.append("x-user-token",s),ue.value=new Ne().withUrl(q.toString(),{withCredentials:!1}).configureLogging(De.None).build(),ue.value.on("UpdateStatus",(X,ae,Q)=>{_e.value.push({time:new Date().toLocaleTimeString(),msg:Q?`[错误] ${X}`:X}),we(()=>{const le=document.getElementById("update-log-box");le&&(le.scrollTop=le.scrollHeight)}),ae>=0&&(me.value=Number(ae.toFixed(1))),ae===100&&(Y.success("更新完成"),tt(!0))});try{await ue.value.start(),await ue.value.invoke("JoinGroup",d.value.toString())}catch{_e.value.push({time:"-",msg:"连接失败"})}},tt=($=!1)=>{var s;(s=ue.value)==null||s.stop(),setTimeout(()=>{ve.value=!1,C.value=!1,$&&pe()},1e3)};return $e(()=>{var $;($=ue.value)==null||$.stop()}),($,s)=>{const q=R("t-input"),X=R("t-button"),ae=R("t-tooltip"),Q=R("t-select"),le=R("t-textarea"),fe=R("t-alert"),ge=R("t-icon"),ie=R("t-col"),Ve=R("t-row"),Be=R("t-progress"),at=R("t-space"),ke=R("t-input-number"),Me=R("t-switch"),st=R("t-form"),lt=R("t-loading"),nt=R("t-dialog");return p(),B("div",oa,[t(lt,{loading:f.value,"show-overlay":""},{default:o(()=>[t(st,{ref_key:"formRef",ref:S,data:n.value,rules:Ze.value,"label-width":"0",onSubmit:Qe},{default:o(()=>[s[51]||(s[51]=e("div",{class:"setting-group-title"},"基础设置",-1)),e("div",ia,[s[29]||(s[29]=e("div",{class:"setting-info"},[e("div",{class:"title"},"服务器名称"),e("div",{class:"desc"},"在面板列表中显示的别名，支持中文")],-1)),e("div",ra,[t(q,{modelValue:n.value.name,"onUpdate:modelValue":s[0]||(s[0]=U=>n.value.name=U),placeholder:"请输入名称"},null,8,["modelValue"])])]),e("div",ua,[e("div",da,[s[30]||(s[30]=e("div",{class:"title"},"实例路径",-1)),e("div",ca,[e("span",{class:ye({"text-warning":V.value})},P(V.value?"警告：修改路径可能导致无法找到原文件":"服务器文件的物理存储路径，非必要请勿修改"),3)])]),e("div",va,[t(q,{modelValue:n.value.base,"onUpdate:modelValue":s[1]||(s[1]=U=>n.value.base=U),disabled:!V.value},{suffix:o(()=>[t(ae,{content:V.value?"点击锁定":"点击解锁编辑 (慎重)"},{default:o(()=>[t(X,{variant:"text",shape:"square",onClick:Ye},{icon:o(()=>[V.value?(p(),W(I(Ut),{key:0,style:{color:"var(--td-warning-color)"}})):(p(),W(I(It),{key:1}))]),_:1})]),_:1},8,["content"])]),_:1},8,["modelValue","disabled"])])]),s[52]||(s[52]=e("div",{class:"setting-group-title"},"运行模式",-1)),e("div",ma,[s[31]||(s[31]=e("div",{class:"setting-info"},[e("div",{class:"title"},"启动方式"),e("div",{class:"desc"},"选择使用 Java 启动 Minecraft，或使用自定义命令启动其他程序 (如 Bedrock, Python 等)")],-1)),e("div",pa,[t(Q,{modelValue:a.value,"onUpdate:modelValue":s[2]||(s[2]=U=>a.value=U),options:[{label:"MSLX 在线下载 (Java)",value:"online"},{label:"使用本地版本 (Java)",value:"local"},{label:"自定义路径 (Java)",value:"custom"},{label:"环境变量 (Java)",value:"env"},{label:"自定义命令 (无Java)",value:"none"}]},null,8,["modelValue"]),a.value!=="none"?(p(),B("div",fa,[a.value==="online"?(p(),W(Q,{key:0,modelValue:E.value,"onUpdate:modelValue":s[3]||(s[3]=U=>E.value=U),options:m.value,placeholder:"请选择版本",filterable:""},null,8,["modelValue","options"])):z("",!0),a.value==="local"?(p(),W(Q,{key:1,modelValue:x.value,"onUpdate:modelValue":s[4]||(s[4]=U=>x.value=U),options:g.value,placeholder:"选择已识别的 Java"},null,8,["modelValue","options"])):z("",!0),a.value==="custom"?(p(),W(q,{key:2,modelValue:x.value,"onUpdate:modelValue":s[5]||(s[5]=U=>x.value=U),placeholder:"输入 java 可执行文件完整路径"},null,8,["modelValue"])):z("",!0)])):z("",!0)])]),e("div",ga,[e("div",ba,[e("div",ya,P(a.value==="none"?"启动命令 (Command)":"启动参数 (JVM Args)"),1),e("div",_a,P(a.value==="none"?"完全自定义的启动命令。程序将直接执行此段内容，不依赖 Java 环境。":"传递给 Java 的启动参数，如 GC 策略 (例如 -XX:+UseG1GC)"),1)]),e("div",ka,[t(le,{modelValue:n.value.args,"onUpdate:modelValue":s[6]||(s[6]=U=>n.value.args=U),autosize:{minRows:2,maxRows:4},placeholder:a.value==="none"?"例如: ./bedrock_server_x64":"无特殊需求请留空"},null,8,["modelValue","placeholder"])])]),a.value!=="none"?(p(),B(re,{key:0},[s[35]||(s[35]=e("div",{class:"setting-group-title"},"核心管理",-1)),e("div",ha,[s[34]||(s[34]=e("div",{class:"setting-info"},[e("div",{class:"title"},"服务端核心文件"),e("div",{class:"desc"},[_(" 指定启动的 Jar 文件名。如果文件已存在于目录中，直接输入文件名即可。 "),e("br"),_("需要更新核心？点击下方“文件工具” ")])],-1)),e("div",wa,[t(q,{modelValue:n.value.core,"onUpdate:modelValue":s[8]||(s[8]=U=>n.value.core=U),placeholder:"例如 server.jar"},{suffix:o(()=>[t(X,{variant:"text",theme:"primary",size:"small",onClick:s[7]||(s[7]=U=>Z.value=!Z.value)},{default:o(()=>[_(P(Z.value?"收起工具":"文件工具"),1)]),_:1})]),_:1},8,["modelValue"]),Z.value?(p(),B("div",$a,[t(at,{direction:"vertical",style:{width:"100%"}},{default:o(()=>[t(fe,{theme:"info",message:"在此处操作会自动下载/上传文件，并填入上方的文件名。"}),t(Ve,{gutter:12},{default:o(()=>[t(ie,{span:6},{default:o(()=>[t(X,{block:"",variant:"outline",onClick:s[9]||(s[9]=U=>H.value=!0)},{icon:o(()=>[t(ge,{name:"cloud-download"})]),default:o(()=>[s[32]||(s[32]=_(" 从版本库下载 ",-1))]),_:1})]),_:1}),t(ie,{span:6},{default:o(()=>[t(X,{block:"",variant:"outline",loading:T.value,onClick:O},{icon:o(()=>[t(ge,{name:"upload"})]),default:o(()=>[s[33]||(s[33]=_(" 上传本地文件 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1}),e("input",{ref_key:"uploadInputRef",ref:A,type:"file",accept:".jar",hidden:"",onChange:se},null,544),T.value?(p(),B("div",xa,[e("span",null,"正在上传: "+P(N.value),1),t(Be,{theme:"line",percentage:K.value},null,8,["percentage"])])):z("",!0)]),_:1})])):z("",!0)])])],64)):z("",!0),a.value!=="none"?(p(),B(re,{key:1},[s[38]||(s[38]=e("div",{class:"setting-group-title"},"资源限制",-1)),e("div",Ca,[s[37]||(s[37]=e("div",{class:"setting-info"},[e("div",{class:"title"},"内存分配"),e("div",{class:"desc"},"设置 Java 堆内存大小 (Xms / Xmx)")],-1)),e("div",Sa,[e("div",Va,[t(ke,{modelValue:L.value,"onUpdate:modelValue":s[10]||(s[10]=U=>L.value=U),min:0,"decimal-places":b.value==="GB"?1:0,placeholder:"Xms",theme:"normal",class:"input-left"},null,8,["modelValue","decimal-places"]),t(Q,{modelValue:b.value,"onUpdate:modelValue":s[11]||(s[11]=U=>b.value=U),options:j,clearable:!1,class:"select-right"},null,8,["modelValue"])]),s[36]||(s[36]=e("span",{class:"separator"},"-",-1)),e("div",Ma,[t(ke,{modelValue:h.value,"onUpdate:modelValue":s[12]||(s[12]=U=>h.value=U),min:0,"decimal-places":D.value==="GB"?1:0,placeholder:"Xmx",theme:"normal",class:"input-left"},null,8,["modelValue","decimal-places"]),t(Q,{modelValue:D.value,"onUpdate:modelValue":s[13]||(s[13]=U=>D.value=U),options:j,clearable:!1,class:"select-right"},null,8,["modelValue"])])])])],64)):z("",!0),s[53]||(s[53]=e("div",{class:"setting-group-title"},"备份设置",-1)),e("div",Ra,[s[41]||(s[41]=e("div",{class:"setting-info"},[e("div",{class:"title"},"备份策略"),e("div",{class:"desc"},"设置自动备份保留的最大数量，以及触发备份的延迟时间")],-1)),e("div",Ua,[t(ke,{modelValue:n.value.backupMaxCount,"onUpdate:modelValue":s[14]||(s[14]=U=>n.value.backupMaxCount=U),min:1,max:100,placeholder:"保留份数",theme:"column",style:{width:"140px"},suffix:"份"},null,8,["modelValue"]),s[39]||(s[39]=e("span",{class:"separator"},"/",-1)),t(ke,{modelValue:n.value.backupDelay,"onUpdate:modelValue":s[15]||(s[15]=U=>n.value.backupDelay=U),min:0,placeholder:"延迟时间",theme:"column",style:{width:"140px"},suffix:"秒"},null,8,["modelValue"])]),e("div",Ia,[t(ae,{content:"MSLX 向服务器发送 save-all 指令后，会等待指定的秒数，确保数据完全写入硬盘后再开始打包备份。"},{default:o(()=>[e("span",Ba,[t(ge,{name:"help-circle"}),s[40]||(s[40]=_(" 什么是延迟时间？ ",-1))])]),_:1})])]),e("div",La,[s[42]||(s[42]=e("div",{class:"setting-info"},[e("div",{class:"title"},"备份存放路径"),e("div",{class:"desc"},"选择备份文件存储的位置。推荐存储在实例文件夹外部以免误删。")],-1)),e("div",Pa,[t(Q,{modelValue:c.value,"onUpdate:modelValue":s[16]||(s[16]=U=>c.value=U),options:[{label:"实例文件夹内 (Instance)",value:"MSLX://Backup/Instance"},{label:"全局数据目录 (Data)",value:"MSLX://Backup/Data"},{label:"自定义绝对路径",value:"custom"}]},null,8,["modelValue"]),c.value==="custom"?(p(),B("div",Ea,[t(q,{modelValue:M.value,"onUpdate:modelValue":s[17]||(s[17]=U=>M.value=U),placeholder:"输入备份存放的绝对路径"},null,8,["modelValue"])])):z("",!0)])]),a.value!=="none"?(p(),B("div",Aa,"外置登录")):z("",!0),a.value!=="none"?(p(),B("div",Oa,[s[43]||(s[43]=e("div",{class:"setting-info"},[e("div",{class:"title"},"Yggdrasil API"),e("div",{class:"desc"}," 选择认证服务器。留空则表示使用官方正版登录 (或离线模式)。 ")],-1)),e("div",Ta,[t(Q,{modelValue:i.value,"onUpdate:modelValue":s[18]||(s[18]=U=>i.value=U),options:G},null,8,["modelValue"]),i.value==="custom"?(p(),B("div",Na,[t(q,{modelValue:w.value,"onUpdate:modelValue":s[19]||(s[19]=U=>w.value=U),placeholder:"输入 Authlib-Injector API 地址"},null,8,["modelValue"])])):z("",!0)])])):z("",!0),s[54]||(s[54]=e("div",{class:"setting-group-title"},"高级设置",-1)),e("div",Da,[s[44]||(s[44]=e("div",{class:"setting-info"},[e("div",{class:"title"},"自动重启"),e("div",{class:"desc"},"当服务器崩溃或意外停止时尝试自动重启"),e("div",{class:"desc"},"熔断机制: 若5分钟内尝试重启次数达到 5 次，则停止尝试重启")],-1)),e("div",Fa,[t(Me,{modelValue:n.value.autoRestart,"onUpdate:modelValue":s[20]||(s[20]=U=>n.value.autoRestart=U),label:["已开启","已关闭"]},null,8,["modelValue"])])]),n.value.autoRestart?(p(),B("div",za,[s[45]||(s[45]=e("div",{class:"setting-info"},[e("div",{class:"title"},"强制自动重启"),e("div",{class:"desc"},"开启此功能后，就算服务器是正常退出的也会强制重启(正常退出 => 退出代码 0)"),e("div",{class:"desc"},"不影响手动在面板关闭服务器")],-1)),e("div",Ga,[t(Me,{modelValue:n.value.forceAutoRestart,"onUpdate:modelValue":s[21]||(s[21]=U=>n.value.forceAutoRestart=U),label:["已开启","已关闭"]},null,8,["modelValue"])])])):z("",!0),e("div",Ja,[s[46]||(s[46]=e("div",{class:"setting-info"},[e("div",{class:"title"},"随守护进程启动"),e("div",{class:"desc"},"当物理机开机/面板启动时，自动启动此实例")],-1)),e("div",ja,[t(Me,{modelValue:n.value.runOnStartup,"onUpdate:modelValue":s[22]||(s[22]=U=>n.value.runOnStartup=U),label:["已开启","已关闭"]},null,8,["modelValue"])])]),e("div",Xa,[s[47]||(s[47]=e("div",{class:"setting-info"},[e("div",{class:"title"},"控制台编码"),e("div",{class:"desc"},"设置输入输出流的字符集，乱码时请尝试切换")],-1)),e("div",Wa,[t(Q,{modelValue:n.value.inputEncoding,"onUpdate:modelValue":s[23]||(s[23]=U=>n.value.inputEncoding=U),options:u,label:"输入",style:{width:"140px"}},null,8,["modelValue"]),t(Q,{modelValue:n.value.outputEncoding,"onUpdate:modelValue":s[24]||(s[24]=U=>n.value.outputEncoding=U),options:u,label:"输出",style:{width:"140px"}},null,8,["modelValue"])])]),e("div",Ka,[s[48]||(s[48]=e("div",{class:"setting-info"},[e("div",{class:"title"},"文件编码"),e("div",{class:"desc"},"设置文件编辑和保存时的编码格式，乱码时请尝试切换。(一般Windows是GBK，其他是UTF-8。)")],-1)),e("div",qa,[t(Q,{modelValue:n.value.fileEncoding,"onUpdate:modelValue":s[25]||(s[25]=U=>n.value.fileEncoding=U),options:u,style:{width:"140px"}},null,8,["modelValue"])])]),e("div",Ha,[t(X,{theme:"primary",type:"submit",size:"large",loading:C.value},{default:o(()=>[...s[49]||(s[49]=[_("保存设置",-1)])]),_:1},8,["loading"]),t(X,{theme:"default",variant:"base",size:"large",onClick:pe},{default:o(()=>[...s[50]||(s[50]=[_("重置更改",-1)])]),_:1})])]),_:1},8,["data","rules"])]),_:1},8,["loading"]),t(yt,{visible:H.value,"onUpdate:visible":s[26]||(s[26]=U=>H.value=U),onConfirm:F},null,8,["visible"]),t(nt,{visible:ve.value,"onUpdate:visible":s[28]||(s[28]=U=>ve.value=U),header:"正在应用更新",footer:!1,"close-on-overlay-click":!1,"close-btn":!1,width:"600px"},{default:o(()=>[e("div",Ya,[t(Be,{theme:"plump",percentage:me.value,label:`${me.value}%`},null,8,["percentage","label"]),e("div",Za,[(p(!0),B(re,null,de(_e.value,(U,ot)=>(p(),B("div",{key:ot,class:"log-line"},[e("span",Qa,P(U.time),1),_(" "+P(U.msg),1)]))),128))]),me.value===100?(p(),B("div",es,[t(X,{theme:"primary",onClick:s[27]||(s[27]=U=>ve.value=!1)},{default:o(()=>[...s[55]||(s[55]=[_("关闭并刷新",-1)])]),_:1})])):z("",!0)])]),_:1},8,["visible"])])}}}),as=oe(ts,[["__scopeId","data-v-4fd91de3"]]),ss={class:"pm-container"},ls={class:"header-section"},ns={class:"mode-switcher"},os={key:0,class:"error-alert-bar"},is={class:"toolbar"},rs={class:"left-actions"},us={key:0,class:"bulk-actions"},ds={class:"selected-count"},cs={class:"right-search"},vs={class:"table-wrapper"},ms={class:"empty-state"},ps={class:"tips-footer"},fs=ne({__name:"ModsPluginsManager",setup(l){const v=be(),k=parseInt(v.params.serverId),d=y("mods"),S=y(!1),f=y([]),C=y(""),V=y([]),u=y(""),n=te(()=>[{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{title:"文件名",colKey:"name",sorter:(x,r)=>x.name.localeCompare(r.name),ellipsis:!0},{title:"状态",colKey:"status",width:100},{title:"操作",colKey:"op",width:180,fixed:"right",align:"right"}]),b=te(()=>{if(!C.value)return f.value;const x=C.value.toLowerCase();return f.value.filter(r=>r.name.toLowerCase().includes(x))}),D=async()=>{S.value=!0,V.value=[],u.value="";try{const x=await Ct(k,d.value),r=(x.jarFiles||[]).map(M=>({name:M,status:"enabled"})),c=(x.disableJarFiles||[]).map(M=>({name:M,status:"disabled"}));f.value=[...r,...c]}catch(x){const r=x.message||"获取列表失败";u.value=r,f.value=[]}finally{S.value=!1}},j=async(x,r)=>{if(r.length===0)return;const c={enable:"启用",disable:"禁用",delete:"删除"},M=async()=>{try{S.value=!0;const i=await St(k,d.value,x,r),{successCount:w,failCount:G}=i||{};G>0?Y.warning(`操作完成：成功 ${w} 个，失败 ${G} 个`):Y.success(`成功${c[x]} ${w} 个文件`),await D()}catch(i){Y.error(i.message||"操作失败"),S.value=!1}};if(x==="delete"){const i=Ie.confirm({header:`确认删除 ${r.length} 个文件?`,body:"此操作不可逆，文件将被永久删除。",theme:"danger",onConfirm:()=>{i.hide(),M()}})}else await M()},L=x=>{d.value=x,D()},h=x=>{const r=x.status==="enabled"?"disable":"enable";j(r,[x.name])},a=x=>{const r=V.value;j(x,r)},m=y(!1),g=()=>{m.value=!0},E=()=>{m.value=!1,D()};return ce(()=>{D()}),ee(()=>v.params.serverId,x=>{x&&location.reload()}),(x,r)=>{const c=R("t-radio-button"),M=R("t-radio-group"),i=R("t-alert"),w=R("t-button"),G=R("t-input"),Z=R("t-tag"),H=R("t-switch"),A=R("t-popconfirm"),T=R("t-space"),K=R("t-table");return p(),B("div",ss,[e("div",ls,[r[10]||(r[10]=e("div",{class:"setting-group-title"}," 资源管理 ",-1)),e("div",ns,[t(M,{modelValue:d.value,"onUpdate:modelValue":r[0]||(r[0]=N=>d.value=N),variant:"default-filled",onChange:L},{default:o(()=>[t(c,{value:"mods"},{icon:o(()=>[t(I(Le))]),default:o(()=>[r[8]||(r[8]=_(" 模组 (Mods) ",-1))]),_:1}),t(c,{value:"plugins"},{icon:o(()=>[t(I(Pe))]),default:o(()=>[r[9]||(r[9]=_(" 插件 (Plugins) ",-1))]),_:1})]),_:1},8,["modelValue"])])]),u.value?(p(),B("div",os,[t(i,{theme:"error",message:u.value,closeable:"",onClose:r[1]||(r[1]=N=>u.value="")},{operation:o(()=>[e("span",{style:{cursor:"pointer","margin-left":"8px"},onClick:D},"重试")]),_:1},8,["message"])])):z("",!0),e("div",is,[e("div",rs,[t(w,{theme:"primary",disabled:u.value!=="",onClick:g},{icon:o(()=>[t(I(Bt))]),default:o(()=>[r[11]||(r[11]=_(" 上传文件 ",-1))]),_:1},8,["disabled"]),t(w,{variant:"outline",loading:S.value,onClick:D},{icon:o(()=>[t(I(Ce))]),_:1},8,["loading"]),t(Fe,{name:"fade"},{default:o(()=>[V.value.length>0?(p(),B("div",us,[r[15]||(r[15]=e("div",{class:"divider"},null,-1)),e("span",ds,"已选 "+P(V.value.length)+" 项",1),t(w,{size:"small",variant:"text",theme:"success",onClick:r[2]||(r[2]=N=>a("enable"))},{default:o(()=>[...r[12]||(r[12]=[_("启用",-1)])]),_:1}),t(w,{size:"small",variant:"text",theme:"warning",onClick:r[3]||(r[3]=N=>a("disable"))},{default:o(()=>[...r[13]||(r[13]=[_("禁用",-1)])]),_:1}),t(w,{size:"small",variant:"text",theme:"danger",onClick:r[4]||(r[4]=N=>a("delete"))},{default:o(()=>[...r[14]||(r[14]=[_("删除",-1)])]),_:1})])):z("",!0)]),_:1})]),e("div",cs,[t(G,{modelValue:C.value,"onUpdate:modelValue":r[5]||(r[5]=N=>C.value=N),placeholder:"搜索文件名...",clearable:""},{"prefix-icon":o(()=>[t(I(Lt))]),_:1},8,["modelValue"])])]),e("div",vs,[t(K,{"selected-row-keys":V.value,"onUpdate:selectedRowKeys":r[6]||(r[6]=N=>V.value=N),data:b.value,columns:n.value,"row-key":"name",loading:S.value,pagination:{defaultPageSize:20,total:b.value.length,showJumper:!0},hover:"",stripe:"",class:"custom-table"},{status:o(({row:N})=>[N.status==="enabled"?(p(),W(Z,{key:0,theme:"success",variant:"light"},{icon:o(()=>[t(I(je))]),default:o(()=>[r[16]||(r[16]=_(" 已启用 ",-1))]),_:1})):(p(),W(Z,{key:1,theme:"default",variant:"light",style:{color:"var(--td-text-color-placeholder)"}},{icon:o(()=>[t(I(Pt))]),default:o(()=>[r[17]||(r[17]=_(" 已禁用 ",-1))]),_:1}))]),op:o(({row:N})=>[t(T,{size:"small"},{default:o(()=>[t(H,{"model-value":N.status==="enabled",loading:S.value,size:"medium",onChange:F=>h(N)},{label:o(F=>[_(P(F.value?"开":"关"),1)]),_:1},8,["model-value","loading","onChange"]),t(A,{content:"确定要删除此文件吗？",theme:"danger",onConfirm:F=>j("delete",[N.name])},{default:o(()=>[t(w,{variant:"text",theme:"danger",shape:"square"},{default:o(()=>[t(I(Je))]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)]),empty:o(()=>[e("div",ms,[d.value==="mods"?(p(),W(I(Le),{key:0,size:"48px",style:{color:"var(--td-gray-color-4)"}})):(p(),W(I(Pe),{key:1,size:"48px",style:{color:"var(--td-gray-color-4)"}})),e("p",null,P(`暂无${d.value==="mods"?"模组":"插件"}文件`),1)])]),_:1},8,["selected-row-keys","data","columns","loading","pagination"])]),e("div",ps,[e("p",null,"提示："+P(d.value==="mods"?"模组":"插件")+"文件存放于服务器根目录的 /"+P(d.value)+" 文件夹下。",1),r[18]||(r[18]=e("p",null,"禁用文件后，会在文件名后添加 .disabled 后缀，服务器将忽略该文件。",-1))]),t(Yt,{visible:m.value,"onUpdate:visible":r[7]||(r[7]=N=>m.value=N),"instance-id":I(k),"current-path":d.value,"allow-folder":!1,onSuccess:E},null,8,["visible","instance-id","current-path"])])}}}),gs=oe(fs,[["__scopeId","data-v-4e5df3f3"]]),Te=[{key:"motd",label:"服务器标语",desc:"显示在多人游戏列表中的服务器介绍信息，支持颜色代码，不支持中文。",type:"string"},{key:"server-port",label:"服务器端口",desc:"默认为 25565。如果要在一台机器运行多个服务器，必须修改此端口。",type:"number"},{key:"max-players",label:"最大玩家数",desc:"服务器同时允许在线的最大玩家数量。",type:"number"},{key:"online-mode",label:"正版验证",desc:"开启后将验证玩家的正版账号。如果使用离线/皮肤站，请关闭此项。",type:"boolean"},{key:"white-list",label:"启用白名单",desc:"开启后只有在白名单内的玩家才能进入服务器。",type:"boolean"},{key:"enforce-whitelist",label:"强制白名单",desc:"开启后，当玩家不在白名单时，即使已在线也会被踢出（通常用于维护时重新加载白名单）。",type:"boolean"},{key:"level-name",label:"存档文件夹名称",desc:"服务器读取的世界存档文件夹名称（默认为 world）。",type:"string"},{key:"gamemode",label:"默认游戏模式",desc:"新玩家进入服务器时的默认模式。",type:"select",options:[{label:"生存 (Survival)",value:"survival"},{label:"创造 (Creative)",value:"creative"},{label:"冒险 (Adventure)",value:"adventure"},{label:"旁观 (Spectator)",value:"spectator"}]},{key:"force-gamemode",label:"强制游戏模式",desc:"开启后，玩家每次加入服务器都会被重置为默认游戏模式。",type:"boolean"},{key:"difficulty",label:"难度",desc:"世界的游戏难度设置。",type:"select",options:[{label:"和平 (Peaceful)",value:"peaceful"},{label:"简单 (Easy)",value:"easy"},{label:"普通 (Normal)",value:"normal"},{label:"困难 (Hard)",value:"hard"}]},{key:"hardcore",label:"极限模式",desc:"开启后，玩家死亡将被封禁。",type:"boolean"},{key:"allow-flight",label:"允许飞行",desc:"允许生存模式下的玩家飞行（防止被服务端反作弊踢出）。",type:"boolean"},{key:"spawn-protection",label:"出生点保护半径",desc:"出生点周围多少格内禁止非 OP 破坏。设为 0 可禁用。",type:"number"},{key:"player-idle-timeout",label:"挂机踢出时间",desc:"玩家闲置多少分钟后被自动踢出。0 为不限制。",type:"number"},{key:"level-seed",label:"世界种子",desc:"生成世界使用的种子，留空则随机生成。",type:"string"},{key:"level-type",label:"世界类型",desc:"例如 minecraft:normal, minecraft:flat, minecraft:amplified。",type:"string"},{key:"generate-structures",label:"生成结构",desc:"是否生成村庄、地牢等结构。",type:"boolean"},{key:"generator-settings",label:"生成器设置",desc:"用于自定义超平坦或特定生成器的 JSON 参数。",type:"string"},{key:"max-world-size",label:"世界边界半径",desc:"设置世界边界（World Border）的最大半径。",type:"number"},{key:"simulation-distance",label:"模拟距离",desc:"服务器实际运算实体/作物生长的区块半径（3-32）。",type:"number"},{key:"view-distance",label:"视距",desc:"客户端可以看见的区块半径。数值过大显著增加内存和带宽消耗。",type:"number"},{key:"entity-broadcast-range-percentage",label:"实体广播范围百分比",desc:"控制客户端能看到实体的距离系数（100表示默认）。",type:"number"},{key:"max-tick-time",label:"最大刻耗时 (Watchdog)",desc:"一刻的最长处理毫秒数。超过此数值服务器将强制关闭以防卡死。设为 -1 可禁用。",type:"number"},{key:"network-compression-threshold",label:"网络压缩阈值",desc:"数据包超过此字节数时进行压缩。设为 -1 禁用压缩。推荐保持默认 256。",type:"number"},{key:"rate-limit",label:"数据包限制",desc:"如果玩家发送数据包过快，将被踢出。0 为禁用。",type:"number"},{key:"use-native-transport",label:"使用原生传输优化",desc:"Linux 环境下是否启用 Epoll 优化网络性能。",type:"boolean"},{key:"prevent-proxy-connections",label:"防止代理连接",desc:"是否尝试阻止通过 VPN 或代理的连接（ISP/AS 号判断）。",type:"boolean"},{key:"sync-chunk-writes",label:"同步区块写入",desc:"开启后区块写入完成后才继续逻辑，数据更安全但可能掉帧；关闭可能提升性能。",type:"boolean"},{key:"region-file-compression",label:"区块文件压缩格式",desc:"用于保存区块的压缩算法。",type:"select",options:[{label:"Deflate (默认)",value:"deflate"},{label:"LZ4 (更快)",value:"lz4"},{label:"不压缩 (None)",value:"none"}]},{key:"max-chained-neighbor-updates",label:"最大连锁更新数",desc:"限制红石/方块连锁更新的数量以防止崩服。",type:"number"},{key:"log-ips",label:"控制台记录 IP",desc:"是否在控制台日志中显示玩家连接的 IP 地址。",type:"boolean"},{key:"hide-online-players",label:"隐藏在线玩家列表",desc:"开启后，服务器列表中将不显示具体的玩家名单。",type:"boolean"},{key:"enable-status",label:"启用状态查询",desc:"是否允许外部（如服务器列表网站）查询服务器状态。",type:"boolean"},{key:"accepts-transfers",label:"接受服务器传送",desc:"是否允许玩家从其他服务器无缝传送到此服务器。",type:"boolean"},{key:"pause-when-empty-seconds",label:"空载暂停时间",desc:"服务器内无玩家多少秒后暂停游戏循环（省资源）。-1 为不暂停。",type:"number"},{key:"op-permission-level",label:"OP 权限等级",desc:"设置 OP 的默认权限级别。",type:"select",options:[{label:"1 - 无视出生点保护",value:1},{label:"2 - 使用单机指令 (gamemode等)",value:2},{label:"3 - 多人管理 (kick/ban/op)",value:3},{label:"4 - 系统管理 (stop/save)",value:4}]},{key:"function-permission-level",label:"函数权限等级",desc:"数据包(Datapack)中函数的默认执行权限等级。",type:"number"},{key:"enforce-secure-profile",label:"强制安全配置 (签名)",desc:"强制玩家拥有官方签名的公钥（聊天报告相关）。离线服建议关闭。",type:"boolean"},{key:"enable-code-of-conduct",label:"启用行为准则提示",desc:"是否向玩家展示行为准则链接（遥测相关）。",type:"boolean"},{key:"bug-report-link",label:"Bug 反馈链接",desc:"自定义玩家遇到错误时显示的反馈网址。",type:"string"},{key:"resource-pack",label:"资源包下载地址",desc:"玩家进入服务器时提示下载的资源包直链 URL。",type:"string"},{key:"require-resource-pack",label:"强制资源包",desc:"开启后，拒绝下载资源包的玩家将被踢出。",type:"boolean"},{key:"resource-pack-sha1",label:"资源包 SHA1",desc:"资源包文件的 SHA-1 校验码，用于验证完整性和缓存。",type:"string"},{key:"resource-pack-prompt",label:"资源包提示语",desc:"下载资源包时向玩家显示的自定义消息（Json 格式）。",type:"string"},{key:"initial-enabled-packs",label:"初始启用数据包",desc:"世界生成时默认启用的数据包列表（逗号分隔）。",type:"string"},{key:"initial-disabled-packs",label:"初始禁用数据包",desc:"世界生成时默认禁用的数据包列表。",type:"string"},{key:"enable-rcon",label:"启用 RCON",desc:"开启远程控制台协议，允许外部工具发送指令。",type:"boolean"},{key:"rcon.port",label:"RCON 端口",desc:"RCON 监听端口（默认为 25575）。",type:"number"},{key:"rcon.password",label:"RCON 密码",desc:"连接 RCON 必须的密码。请设置复杂的密码。",type:"string"},{key:"broadcast-rcon-to-ops",label:"向 OP 广播 RCON",desc:"当 RCON 执行指令时，是否通知在线的 OP。",type:"boolean"},{key:"enable-query",label:"启用 Query",desc:"开启 GameSpy4 协议，用于获取服务器详细信息。",type:"boolean"},{key:"query.port",label:"Query 端口",desc:"Query 协议监听端口（默认为 25565）。",type:"number"},{key:"broadcast-console-to-ops",label:"向 OP 广播控制台",desc:"控制台执行的指令输出是否发给在线 OP。",type:"boolean"},{key:"enable-jmx-monitoring",label:"启用 JMX 监控",desc:"开启 Java JMX 性能监控（通常用于开发调试）。",type:"boolean"},{key:"management-server-enabled",label:"启用管理后台",desc:"是否启用 Minecraft 官方定义的管理服务器接口。",type:"boolean"},{key:"management-server-port",label:"管理后台端口",desc:"管理接口监听的端口。",type:"number"},{key:"management-server-host",label:"管理后台主机",desc:"管理接口绑定的主机名/IP。",type:"string"},{key:"management-server-allowed-origins",label:"管理后台允许源",desc:"允许访问管理接口的 Origin 列表。",type:"string"},{key:"server-ip",label:"服务器绑定 IP",desc:"指定服务器绑定的本地网卡 IP。留空表示监听所有网卡（0.0.0.0）。",type:"string"},{key:"debug",label:"调试模式",desc:"开启后控制台将输出更多调试信息。",type:"boolean"},{key:"text-filtering-config",label:"文本过滤配置",desc:"用于文本过滤服务的 API 配置。",type:"string"},{key:"status-heartbeat-interval",label:"状态心跳间隔",desc:"服务器向客户端发送状态心跳的间隔（0 为默认）。",type:"number"}],bs={class:"settings-container"},ys={class:"page-header"},_s={class:"config-list"},ks={key:0,class:"empty-tip"},hs={class:"setting-info"},ws={class:"title"},$s={class:"key-name-row"},xs={key:0,class:"key-name"},Cs={key:0,class:"desc"},Ss={class:"setting-control"},Vs={class:"form-actions"},Ms=ne({__name:"ServerProperties",setup(l){const v=be(),k=y(0),d=y(!1),S=y(!1),f=y({}),C=y(""),V=a=>{const m={};return a.split(`
`).forEach(E=>{const x=E.trim();if(!x||x.startsWith("#"))return;const r=x.indexOf("=");if(r!==-1){const c=x.substring(0,r).trim(),M=x.substring(r+1).trim();m[c]=M}}),m},u=a=>{let m=`#Minecraft server properties
#${new Date().toString()}
`;const g=Te.map(x=>x.key),E=Object.keys(a);return g.forEach(x=>{Object.prototype.hasOwnProperty.call(a,x)&&(m+=`${x}=${a[x]}
`)}),E.forEach(x=>{g.includes(x)||(m+=`${x}=${a[x]}
`)}),m},n=async()=>{if(k.value){d.value=!0;try{const a=await Vt(k.value,"server.properties");a&&(C.value=a,f.value=V(a))}catch(a){Y.error(`读取配置文件失败: ${a.message}`)}finally{d.value=!1}}},b=async()=>{S.value=!0;try{const a=u(f.value);await Mt(k.value,"server.properties",a),Y.success("配置文件已保存"),n()}catch(a){Y.error(`保存失败: ${a.message}`)}finally{S.value=!1}},D=te(()=>{const a=[],m=f.value,g=new Set(Object.keys(m));return Te.forEach(E=>{g.has(E.key)&&(a.push(E),g.delete(E.key))}),g.forEach(E=>{a.push({key:E,label:E,desc:"未收录的配置项",type:j(m[E]),isUnknown:!0})}),a}),j=a=>a==="true"||a==="false"?"boolean":!isNaN(Number(a))&&a!==""?"number":"string",L=(a,m)=>{const g=f.value[a];return g===void 0?m==="boolean"?!1:"":m==="boolean"?g==="true":m==="number"?Number(g):g},h=(a,m,g)=>{f.value[a]=String(m)};return ee(()=>v.params.serverId,a=>{v.name==="InstanceConsole"&&a&&(k.value=parseInt(a),n())},{immediate:!0}),(a,m)=>{const g=R("t-button"),E=R("t-space"),x=R("t-switch"),r=R("t-select"),c=R("t-input-number"),M=R("t-input"),i=R("t-loading");return p(),B("div",bs,[e("div",ys,[m[1]||(m[1]=e("div",{class:"section-title"},"Server.properties 配置编辑器",-1)),t(E,null,{default:o(()=>[t(g,{variant:"text",shape:"square",loading:d.value,onClick:n},{icon:o(()=>[t(I(Ce))]),_:1},8,["loading"]),t(g,{theme:"primary",loading:S.value,onClick:b},{icon:o(()=>[t(I(Xe))]),default:o(()=>[m[0]||(m[0]=_(" 保存配置 ",-1))]),_:1},8,["loading"])]),_:1})]),t(i,{loading:d.value,text:"正在读取配置文件..."},{default:o(()=>[e("div",_s,[!d.value&&D.value.length===0?(p(),B("div",ks," 无法找到配置项或文件为空 ")):z("",!0),(p(!0),B(re,null,de(D.value,w=>(p(),B("div",{key:w.key,class:ye(["setting-item",{"unknown-item":w.isUnknown}])},[e("div",hs,[e("div",ws,P(w.label),1),e("div",$s,[w.isUnknown?z("",!0):(p(),B("span",xs,P(w.key),1))]),w.isUnknown?z("",!0):(p(),B("div",Cs,P(w.desc||"暂无描述"),1))]),e("div",Ss,[w.type==="boolean"?(p(),W(x,{key:0,"model-value":L(w.key,"boolean"),"onUpdate:modelValue":G=>h(w.key,G,"boolean")},null,8,["model-value","onUpdate:modelValue"])):w.type==="select"?(p(),W(r,{key:1,"model-value":L(w.key,"string"),options:w.options,placeholder:"请选择","onUpdate:modelValue":G=>h(w.key,G,"string")},null,8,["model-value","options","onUpdate:modelValue"])):w.type==="number"?(p(),W(c,{key:2,"model-value":L(w.key,"number"),theme:"column",style:{width:"100%"},"onUpdate:modelValue":G=>h(w.key,G,"number")},null,8,["model-value","onUpdate:modelValue"])):(p(),W(M,{key:3,"model-value":L(w.key,"string"),placeholder:"未设置","onUpdate:modelValue":G=>h(w.key,G,"string")},null,8,["model-value","onUpdate:modelValue"]))])],2))),128))])]),_:1},8,["loading"]),e("div",Vs,[t(g,{theme:"primary",size:"large",loading:S.value,onClick:b},{default:o(()=>[...m[2]||(m[2]=[_("保存设置",-1)])]),_:1},8,["loading"]),t(g,{theme:"default",variant:"base",size:"large",onClick:n},{default:o(()=>[...m[3]||(m[3]=[_("重置更改",-1)])]),_:1})])])}}}),Rs=oe(Ms,[["__scopeId","data-v-57d6b000"]]);async function Us(l){return await xe.get({url:`/api/instance/tasks/list/${l}`})}async function Is(l,v,k,d,S,f){return await xe.post({url:"/api/instance/tasks/create",data:{instanceId:l,name:v,cron:k,payload:d,type:S,enable:f}})}async function Bs(l,v,k,d,S,f,C){return await xe.post({url:"/api/instance/tasks/update",data:{instanceId:l,id:v,name:k,cron:d,payload:S,type:f,enable:C}})}async function Ls(l){return await xe.post({url:`/api/instance/tasks/delete${l}`})}const Ps={class:"cron-gen-container"},Es={class:"mode-switch"},As={key:0,class:"mode-content novice-panel"},Os={class:"novice-input-group"},Ts={key:1,class:"mode-content pro-panel"},Ns={class:"tab-scroll-area"},Ds={key:0,class:"specific-box"},Fs={class:"result-area"},zs={class:"cron-display"},Gs={class:"code-box"},Js={class:"next-runs"},js={class:"runs-title"},Xs={key:0,class:"error-msg"},Ws={key:1,class:"runs-list"},Ks={class:"index"},qs=ne({__name:"CronGenerator",props:{visible:{type:Boolean,default:!1},initialValue:{type:String,default:""}},emits:["update:visible","confirm"],setup(l,{emit:v}){const k=l,d=v,S=y("novice"),f=y(10),C=y("minute"),V=[{label:"秒",value:"second"},{label:"分钟",value:"minute"},{label:"小时",value:"hour"},{label:"天",value:"day"}],u=y("second"),n=[{label:"秒",value:"second",min:0,max:59},{label:"分",value:"minute",min:0,max:59},{label:"时",value:"hour",min:0,max:23},{label:"日",value:"day",min:1,max:31},{label:"月",value:"month",min:1,max:12},{label:"周",value:"week",min:1,max:7}],b=y({second:{type:"every",start:0,step:1,specifics:[]},minute:{type:"every",start:0,step:1,specifics:[]},hour:{type:"every",start:0,step:1,specifics:[]},day:{type:"every",start:1,step:1,specifics:[]},month:{type:"every",start:1,step:1,specifics:[]},week:{type:"any",start:1,step:1,specifics:[]}}),D=[{label:"周日",value:1},{label:"周一",value:2},{label:"周二",value:3},{label:"周三",value:4},{label:"周四",value:5},{label:"周五",value:6},{label:"周六",value:7}],j=te(()=>{const r=(H,A="*")=>{const T=b.value[H];return H==="week"&&T.type==="any"||H==="week"&&b.value.day.type!=="every"||H==="day"&&b.value.week.type!=="any"?"?":T.type==="every"?"*":T.type==="interval"?`${T.start}/${T.step}`:T.type==="specific"?T.specifics.length===0?H==="day"||H==="month"?"1":"0":T.specifics.sort((K,N)=>K-N).join(","):A},c=r("second"),M=r("minute"),i=r("hour"),w=r("day"),G=r("month"),Z=r("week","?");return`${c} ${M} ${i} ${w} ${G} ${Z}`}),L=te(()=>{const r=f.value;switch(C.value){case"second":return`*/${r} * * * * *`;case"minute":return`0 */${r} * * * *`;case"hour":return`0 0 */${r} * * ?`;case"day":return`0 0 0 */${r} * ?`;default:return"* * * * * *"}}),h=te(()=>S.value==="novice"?L.value:j.value),a=y([]),m=y(""),g=()=>{try{const r=Zt.CronExpressionParser.parse(h.value,{currentDate:new Date});a.value=r.take(5).map(c=>new Date(c.toString()).toLocaleString()),m.value=""}catch{m.value="无法解析当前 Cron 表达式，请检查规则是否冲突",a.value=[]}};ee(h,()=>{g()},{immediate:!0}),ee(()=>k.visible,r=>{r&&k.initialValue&&(S.value="pro",g())});const E=()=>{if(m.value){Y.warning("当前表达式无效，无法保存");return}d("confirm",h.value),d("update:visible",!1)},x=r=>{const c=n.find(i=>i.value===r);if(!c)return[];const M=[];for(let i=c.min;i<=c.max;i++)M.push({label:i.toString(),value:i});return M};return(r,c)=>{const M=R("t-radio-button"),i=R("t-radio-group"),w=R("t-input-number"),G=R("t-select"),Z=R("t-alert"),H=R("t-radio"),A=R("t-checkbox-group"),T=R("t-tab-panel"),K=R("t-tabs"),N=R("t-tag"),F=R("t-dialog");return p(),W(F,{visible:l.visible,header:"Cron 表达式生成器",width:"700px",top:"5vh",onClose:c[4]||(c[4]=O=>d("update:visible",!1)),onConfirm:E},{default:o(()=>[e("div",Ps,[e("div",Es,[t(i,{modelValue:S.value,"onUpdate:modelValue":c[0]||(c[0]=O=>S.value=O),variant:"default-filled"},{default:o(()=>[t(M,{value:"novice"},{default:o(()=>[...c[5]||(c[5]=[_("🚀 新手模式",-1)])]),_:1}),t(M,{value:"pro"},{default:o(()=>[...c[6]||(c[6]=[_("🛠️ 专业模式",-1)])]),_:1})]),_:1},8,["modelValue"])]),S.value==="novice"?(p(),B("div",As,[e("div",Os,[c[7]||(c[7]=e("span",null,"每隔",-1)),t(w,{modelValue:f.value,"onUpdate:modelValue":c[1]||(c[1]=O=>f.value=O),min:1,theme:"column",style:{width:"100px"}},null,8,["modelValue"]),t(G,{modelValue:C.value,"onUpdate:modelValue":c[2]||(c[2]=O=>C.value=O),options:V,style:{width:"100px"}},null,8,["modelValue"]),c[8]||(c[8]=e("span",null,"执行一次",-1))]),t(Z,{theme:"info",style:{"margin-top":"16px"}},{message:o(()=>[...c[9]||(c[9]=[_(" 此模式适用于简单的周期性任务。如果需要“每周五上午10点”等复杂规则，请切换到",-1),e("b",null,"专业模式",-1),_("。 ",-1)])]),_:1})])):(p(),B("div",Ts,[t(K,{modelValue:u.value,"onUpdate:modelValue":c[3]||(c[3]=O=>u.value=O)},{default:o(()=>[(p(),B(re,null,de(n,O=>t(T,{key:O.value,value:O.value,label:O.label},{default:o(()=>[e("div",Ns,[t(i,{modelValue:b.value[O.value].type,"onUpdate:modelValue":se=>b.value[O.value].type=se,direction:"vertical"},{default:o(()=>[t(H,{value:"every"},{default:o(()=>[_(P(O.value==="week"?"不指定 (?)":`每${O.label} (*)`),1)]),_:2},1024),O.value!=="week"?(p(),W(H,{key:0,value:"interval"},{default:o(()=>[c[10]||(c[10]=_(" 周期: 从 ",-1)),t(w,{modelValue:b.value[O.value].start,"onUpdate:modelValue":se=>b.value[O.value].start=se,min:O.min,max:O.max,size:"small",theme:"column",style:{width:"60px"}},null,8,["modelValue","onUpdate:modelValue","min","max"]),_(" "+P(O.label)+"开始，每 ",1),t(w,{modelValue:b.value[O.value].step,"onUpdate:modelValue":se=>b.value[O.value].step=se,min:1,max:O.max,size:"small",theme:"column",style:{width:"60px"}},null,8,["modelValue","onUpdate:modelValue","max"]),_(" "+P(O.label)+"执行一次 ",1)]),_:2},1024)):z("",!0),O.value!=="week"?(p(),W(H,{key:1,value:"specific"},{default:o(()=>[_("指定: 选择具体的"+P(O.label),1)]),_:2},1024)):z("",!0),O.value==="week"?(p(),W(H,{key:2,value:"specific"},{default:o(()=>[...c[11]||(c[11]=[_("指定周几",-1)])]),_:1})):z("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),b.value[O.value].type==="specific"?(p(),B("div",Ds,[t(A,{modelValue:b.value[O.value].specifics,"onUpdate:modelValue":se=>b.value[O.value].specifics=se,options:O.value==="week"?D:x(O.value),class:"grid-checkbox"},null,8,["modelValue","onUpdate:modelValue","options"])])):z("",!0)])]),_:2},1032,["value","label"])),64))]),_:1},8,["modelValue"])])),e("div",Fs,[e("div",zs,[c[14]||(c[14]=e("span",{class:"label"},"当前表达式:",-1)),e("div",Gs,[_(P(h.value)+" ",1),m.value?(p(),W(N,{key:1,theme:"danger",variant:"light",size:"small"},{default:o(()=>[t(I(Et)),c[13]||(c[13]=_(" 无效",-1))]),_:1})):(p(),W(N,{key:0,theme:"success",variant:"light",size:"small"},{default:o(()=>[t(I(je)),c[12]||(c[12]=_(" 有效",-1))]),_:1}))])]),e("div",Js,[e("div",js,[t(I(Se)),c[15]||(c[15]=_(" 最近 5 次运行时间预测:",-1))]),m.value?(p(),B("div",Xs,P(m.value),1)):(p(),B("ul",Ws,[(p(!0),B(re,null,de(a.value,(O,se)=>(p(),B("li",{key:se},[e("span",Ks,"#"+P(se+1),1),_(" "+P(O),1)]))),128))]))])])])]),_:1},8,["visible"])}}}),Hs=oe(qs,[["__scopeId","data-v-135dd699"]]),Ys={class:"page-container"},Zs={class:"page-header"},Qs={key:0,class:"create-container"},el={class:"container-header"},tl={class:"title"},al={class:"setting-item"},sl={class:"setting-control"},ll={class:"setting-item"},nl={class:"setting-control"},ol={class:"setting-item"},il={class:"setting-control"},rl={key:0,class:"setting-item"},ul={class:"setting-info"},dl={class:"title"},cl={class:"desc"},vl={class:"setting-control"},ml={class:"setting-item"},pl={class:"setting-control"},fl={class:"form-actions"},gl={class:"task-list"},bl={key:0,class:"empty-state"},yl={class:"card-left"},_l={class:"task-header-row"},kl={class:"task-name"},hl={class:"task-meta-row"},wl={class:"cron-display"},$l=["title"],xl={class:"card-right"},Cl=ne({__name:"CronTasks",setup(l){const v=be(),k=te(()=>parseInt(v.params.serverId)),d=y([]),S=y(!1),f=y(!1),C=y(null),V=y(!1),u=y(null),n=y(!1),b=y({id:"",name:"",cron:"",type:"command",payload:"",enable:!0}),D=[{label:"发送命令 (Command)",value:"command"},{label:"备份存档 (Backup)",value:"backup"},{label:"开启服务器 (Start)",value:"start"},{label:"停止服务器 (Stop)",value:"stop"},{label:"重启服务器 (Restart)",value:"restart"}],j={name:[{required:!0,message:"必填",trigger:"blur"}],cron:[{required:!0,message:"必填",trigger:"blur"}],type:[{required:!0,message:"必选",trigger:"change"}],payload:[{validator:M=>b.value.type==="command"&&!M?{result:!1,message:"命令内容不能为空",type:"error"}:!0,trigger:"blur"}]},L=async()=>{if(k.value){S.value=!0;try{const M=await Us(k.value);d.value=M||[]}catch(M){Y.error(M.message||"获取列表失败")}finally{S.value=!1}}},h=()=>{f.value||(b.value={id:"",name:"",cron:"",type:"command",payload:"",enable:!0},C.value=null,f.value=!0)},a=M=>{b.value={id:M.id,name:M.name,cron:M.cron,type:M.type.toLowerCase(),payload:M.payload,enable:M.enable},C.value=M.id,f.value=!0,window.scrollTo({top:0,behavior:"smooth"})},m=()=>{f.value=!1,C.value=null},g=async()=>{var i;if(await((i=u.value)==null?void 0:i.validate())===!0){V.value=!0;try{C.value?(await Bs(k.value,b.value.id,b.value.name,b.value.cron,b.value.payload,b.value.type,b.value.enable),Y.success("更新成功")):(await Is(k.value,b.value.name,b.value.cron,b.value.payload,b.value.type,b.value.enable),Y.success("创建成功")),m(),L()}catch(w){Y.error(w.message||"操作失败")}finally{V.value=!1}}},E=M=>{const i=Ie.confirm({header:"确认删除?",body:`确定删除任务 "${M.name}" 吗？`,theme:"danger",onConfirm:async()=>{try{await Ls(M.id),Y.success("已删除"),L(),i.hide()}catch(w){Y.error(w.message)}},onClose:()=>i.hide()})},x=M=>{b.value.cron=M},r=M=>{const i=M.toLowerCase();return i==="start"?We:i==="stop"?Ke:i==="restart"?Ce:Nt},c=M=>{const i=M.toLowerCase();return i==="start"?"success":i==="stop"?"danger":i==="restart"?"warning":"primary"};return ee(()=>k.value,L),ce(L),(M,i)=>{const w=R("t-button"),G=R("t-input"),Z=R("t-select"),H=R("t-textarea"),A=R("t-switch"),T=R("t-form"),K=R("t-tag"),N=R("t-loading");return p(),B("div",Ys,[e("div",Zs,[i[8]||(i[8]=e("div",{class:"section-title"},"定时计划任务",-1)),f.value?z("",!0):(p(),W(w,{key:0,theme:"primary",onClick:h},{icon:o(()=>[t(I(At))]),default:o(()=>[i[7]||(i[7]=_(" 创建新任务 ",-1))]),_:1}))]),t(Fe,{name:"slide-fade"},{default:o(()=>[f.value?(p(),B("div",Qs,[e("div",el,[e("span",tl,P(C.value?"编辑任务":"创建新任务"),1),t(w,{size:"small",variant:"text",onClick:m},{default:o(()=>[t(I(Ot))]),_:1})]),t(T,{ref_key:"formRef",ref:u,data:b.value,rules:j,"label-width":"0"},{default:o(()=>[e("div",al,[i[9]||(i[9]=e("div",{class:"setting-info"},[e("div",{class:"title"},"任务名称"),e("div",{class:"desc"},"给这个计划任务起个容易识别的名字，例如“每日自动重启”")],-1)),e("div",sl,[t(G,{modelValue:b.value.name,"onUpdate:modelValue":i[0]||(i[0]=F=>b.value.name=F),placeholder:"请输入任务名称"},null,8,["modelValue"])])]),e("div",ll,[i[11]||(i[11]=e("div",{class:"setting-info"},[e("div",{class:"title"},"触发规则 (Cron)"),e("div",{class:"desc"},"使用 Cron 表达式定义执行时间。支持秒级精度 (秒 分 时 日 月 周)")],-1)),e("div",nl,[t(G,{modelValue:b.value.cron,"onUpdate:modelValue":i[1]||(i[1]=F=>b.value.cron=F),placeholder:"例如: 0 0 12 * * ?"},null,8,["modelValue"]),t(w,{variant:"outline",theme:"default",onClick:i[2]||(i[2]=F=>n.value=!0)},{default:o(()=>[...i[10]||(i[10]=[_(" 表达式生成器 ",-1)])]),_:1})])]),e("div",ol,[i[12]||(i[12]=e("div",{class:"setting-info"},[e("div",{class:"title"},"执行操作"),e("div",{class:"desc"},"选择触发时要执行的动作类型")],-1)),e("div",il,[t(Z,{modelValue:b.value.type,"onUpdate:modelValue":i[3]||(i[3]=F=>b.value.type=F),options:D},null,8,["modelValue"])])]),b.value.type==="command"||b.value.type==="restart"?(p(),B("div",rl,[e("div",ul,[e("div",dl,P(b.value.type==="restart"?"重启提示语":"控制台命令"),1),e("div",cl,P(b.value.type==="restart"?"重启前发送给全服玩家的倒计时提示消息":"不需要加 /，直接输入命令内容"),1)]),e("div",vl,[t(H,{modelValue:b.value.payload,"onUpdate:modelValue":i[4]||(i[4]=F=>b.value.payload=F),autosize:{minRows:2,maxRows:5},placeholder:"请输入内容..."},null,8,["modelValue"])])])):z("",!0),e("div",ml,[i[13]||(i[13]=e("div",{class:"setting-info"},[e("div",{class:"title"},"启用状态"),e("div",{class:"desc"},"暂时禁用此任务而不删除它")],-1)),e("div",pl,[t(A,{modelValue:b.value.enable,"onUpdate:modelValue":i[5]||(i[5]=F=>b.value.enable=F)},null,8,["modelValue"])])]),e("div",fl,[t(w,{theme:"primary",loading:V.value,onClick:g},{icon:o(()=>[t(I(Xe))]),default:o(()=>[_(" "+P(C.value?"保存修改":"立即创建"),1)]),_:1},8,["loading"]),t(w,{theme:"default",variant:"base",onClick:m},{default:o(()=>[...i[14]||(i[14]=[_("取消",-1)])]),_:1})])]),_:1},8,["data"])])):z("",!0)]),_:1}),t(N,{loading:S.value,"show-overlay":""},{default:o(()=>[e("div",gl,[d.value.length===0&&!S.value?(p(),B("div",bl," 暂无任务，请点击上方创建 ")):z("",!0),(p(!0),B(re,null,de(d.value,F=>(p(),B("div",{key:F.id,class:"task-card"},[e("div",yl,[e("div",_l,[t(K,{size:"small",theme:F.enable?"success":"warning",variant:"light",class:"status-tag"},{default:o(()=>[_(P(F.enable?"运行中":"已暂停"),1)]),_:2},1032,["theme"]),e("span",kl,P(F.name),1)]),e("div",hl,[t(K,{size:"small",variant:"outline",theme:c(F.type),style:{"margin-right":"8px"}},{icon:o(()=>[(p(),W(ze(r(F.type))))]),default:o(()=>[_(" "+P(F.type.toUpperCase()),1)]),_:2},1032,["theme"]),e("span",wl,[t(I(Se)),_(" "+P(F.cron),1)])]),F.payload?(p(),B("div",{key:0,class:"task-payload",title:F.payload},P(F.payload),9,$l)):z("",!0)]),e("div",xl,[t(w,{variant:"text",theme:"primary",onClick:O=>a(F)},{icon:o(()=>[t(I(Tt))]),default:o(()=>[i[15]||(i[15]=_(" 编辑 ",-1))]),_:1},8,["onClick"]),t(w,{variant:"text",theme:"danger",onClick:O=>E(F)},{icon:o(()=>[t(I(Je))]),default:o(()=>[i[16]||(i[16]=_(" 删除 ",-1))]),_:1},8,["onClick"])])]))),128))])]),_:1},8,["loading"]),t(Hs,{visible:n.value,"onUpdate:visible":i[6]||(i[6]=F=>n.value=F),"initial-value":b.value.cron,onConfirm:x},null,8,["visible","initial-value"])])}}}),Sl=oe(Cl,[["__scopeId","data-v-5d27847b"]]),Vl={class:"layout-container"},Ml={class:"sidebar"},Rl=["onClick"],Ul={class:"nav-text"},Il={class:"main-content"},Bl={key:0,class:"panel-wrapper"},Ll={key:1,class:"panel-wrapper"},Pl={key:2,class:"panel-wrapper"},El={key:3,class:"panel-wrapper"},Al=ne({__name:"InstanceSettings",setup(l,{expose:v}){const k=y(!1),d=y(0),S=[{label:"实例设置",icon:qe},{label:"插件/模组",icon:Dt},{label:"服务器属性",icon:Ft},{label:"定时任务",icon:Se}];return v({open:()=>{k.value=!0}}),(C,V)=>{const u=R("t-dialog");return p(),W(u,{visible:k.value,"onUpdate:visible":V[0]||(V[0]=n=>k.value=n),header:"实例配置",width:"90%",top:"3vh",attach:"body",footer:!1,"destroy-on-close":"",class:"settings-dialog"},{default:o(()=>[e("div",Vl,[e("div",Ml,[(p(),B(re,null,de(S,(n,b)=>e("div",{key:b,class:ye(["nav-item",{active:d.value===b}]),onClick:D=>d.value=b},[(p(),W(ze(n.icon),{class:"nav-icon"})),e("span",Ul,P(n.label),1)],10,Rl)),64))]),e("div",Il,[d.value===0?(p(),B("div",Bl,[t(as)])):z("",!0),d.value===1?(p(),B("div",Ll,[t(gs)])):z("",!0),d.value===2?(p(),B("div",Pl,[t(Rs,{"instance-id":21})])):z("",!0),d.value===3?(p(),B("div",El,[t(Sl)])):z("",!0)])])]),_:1},8,["visible"])}}}),Ol=oe(Al,[["__scopeId","data-v-5ef5512d"]]),Tl={class:"monitor-container"},Nl={class:"status-header"},Dl={class:"status-text"},Fl={class:"monitor-content"},zl={class:"monitor-block"},Gl={class:"info-item"},Jl={class:"label"},jl={class:"value"},Xl={class:"monitor-block"},Wl={class:"info-item"},Kl={class:"label"},ql={class:"value"},Hl={key:0,class:"sub-val"},he=20,Yl=ne({__name:"InstanceMonitor",props:{serverId:{},maxMemory:{},isRunning:{type:Boolean}},setup(l){const v=l,k=He(),d=y(null),S=y(null);let f=null,C=null;const V=y(new Array(he).fill(0)),u=y(new Array(he).fill(0)),n=te(()=>v.maxMemory>0),b=(m,g,E=100)=>({grid:{top:4,right:0,bottom:4,left:0},xAxis:{type:"category",show:!1,boundaryGap:!1},yAxis:{type:"value",min:0,max:E===null?void 0:E,show:!1},series:[{type:"line",data:g,smooth:!0,showSymbol:!1,lineStyle:{width:2,color:m},areaStyle:{color:new Qt(0,0,0,1,[{offset:0,color:m.replace(")",", 0.2)").replace("rgb","rgba")},{offset:1,color:"transparent"}])}}]}),D=()=>{const m=getComputedStyle(document.documentElement),g=m.getPropertyValue("--td-brand-color").trim()||"#0052d9",E=m.getPropertyValue("--td-warning-color").trim()||"#e37318";if(d.value&&(f=Oe(d.value),f.setOption(b(g,V.value,100))),S.value){C=Oe(S.value);const x=n.value?100:null;C.setOption(b(E,u.value,x))}window.addEventListener("resize",j)},j=()=>{f==null||f.resize(),C==null||C.resize()},L=te(()=>{const m=k.stats.memBytes/1024/1024;return m>1024?`${(m/1024).toFixed(2)} GB`:`${m.toFixed(0)} MB`}),h=async()=>{v.isRunning&&v.serverId&&(k.setMaxMemory(v.maxMemory),await k.connect(v.serverId))},a=async()=>{await k.disconnect()};return ee(()=>v.maxMemory,m=>{if(k.setMaxMemory(m),C){const g=m>0?100:null;C.setOption({yAxis:{max:g===null?void 0:g}})}},{immediate:!0}),ee(()=>k.stats,m=>{if(!(!v.isRunning||k.currentServerId!==v.serverId)){if(V.value.push(m.cpu),V.value.length>he&&V.value.shift(),n.value)u.value.push(m.memPercent);else{const g=m.memBytes/1024/1024;u.value.push(g)}u.value.length>he&&u.value.shift(),f==null||f.setOption({series:[{data:V.value}]}),C==null||C.setOption({series:[{data:u.value}]})}},{deep:!0}),ee(()=>v.isRunning,async m=>{m?we(()=>{j(),h()}):(V.value.fill(0),u.value.fill(0),f==null||f.setOption({series:[{data:V.value}]}),C==null||C.setOption({series:[{data:u.value}]}),await a())}),ee(()=>v.serverId,async(m,g)=>{m!==g&&(await a(),v.isRunning&&await h())}),ce(async()=>{await we(),D(),v.isRunning&&await h()}),$e(async()=>{window.removeEventListener("resize",j),await a(),f==null||f.dispose(),C==null||C.dispose()}),(m,g)=>(p(),B("div",Tl,[e("div",Nl,[e("span",Dl,[I(k).isConnected?(p(),W(I(Ee),{key:0,style:{color:"var(--td-success-color)"}})):(p(),W(I(Ee),{key:1,style:{color:"var(--td-text-color-disabled)"}})),_(" "+P(I(k).isConnected?"连接正常":"正在连接数据流..."),1)]),e("div",{class:ye(["monitor-dot",{active:I(k).isConnected&&l.isRunning}])},null,2)]),e("div",Fl,[e("div",zl,[e("div",Gl,[e("div",Jl,[t(I(Ue)),g[0]||(g[0]=_(" CPU 使用率",-1))]),e("div",jl,P(I(k).stats.cpu.toFixed(1))+" %",1)]),e("div",{ref_key:"cpuChartRef",ref:d,class:"chart-wrapper"},null,512)]),g[2]||(g[2]=e("div",{class:"divider"},null,-1)),e("div",Xl,[e("div",Wl,[e("div",Kl,[t(I(zt)),g[1]||(g[1]=_(" 内存使用",-1))]),e("div",ql,[_(P(L.value)+" ",1),n.value?(p(),B("span",Hl," ("+P(I(k).stats.memPercent.toFixed(1))+"%) ",1)):z("",!0)])]),e("div",{ref_key:"memChartRef",ref:S,class:"chart-wrapper"},null,512)])])]))}}),Zl=oe(Yl,[["__scopeId","data-v-128d3837"]]),Ql={class:"sidebar-content"},en={class:"control-header"},tn={class:"control-actions"},an={class:"action-row"},sn={class:"action-row"},ln={class:"info-tabs-container"},nn={class:"tab-content-wrapper"},on={class:"info-list"},rn={class:"info-item"},un={class:"label"},dn={class:"value"},cn={class:"info-item"},vn={class:"label"},mn={class:"value"},pn={class:"info-item"},fn={class:"label"},gn={class:"value"},bn={class:"info-item"},yn={class:"label"},_n={class:"value"},kn={class:"info-item"},hn={class:"label"},wn={class:"value"},$n={class:"info-item"},xn={class:"label"},Cn={class:"value"},Sn={class:"info-item"},Vn={class:"label"},Mn={class:"value"},Rn={key:1,class:"info-item"},Un={class:"label"},In={class:"info-item"},Bn={class:"label"},Ln={class:"value"},Pn={class:"tab-content-wrapper"},En={key:1,class:"monitor-placeholder"},An=ne({__name:"ServerControlPanel",props:{serverId:{},isRunning:{type:Boolean},loading:{type:Boolean},serverInfo:{}},emits:["start","stop","clear-log","refresh-info","backup"],setup(l,{emit:v}){const k=l,d=v,S=y(null),f=y("info"),C=()=>{S.value&&S.value.open()},V=()=>{d("refresh-info")},u=y(0);let n=null;const b=h=>{if(!h)return 0;const a=h.match(/^(?:(\d+)\.)?(\d{1,2}):(\d{2}):(\d{2})(?:\.\d+)?$/);return a?parseInt(a[1]||"0",10)*86400+parseInt(a[2])*3600+parseInt(a[3])*60+parseInt(a[4]):0},D=te(()=>{if(u.value<=0)return"00:00:00";const h=Math.floor(u.value/86400),a=Math.floor(u.value%86400/3600),m=Math.floor(u.value%3600/60),g=Math.floor(u.value%60),E=r=>r.toString().padStart(2,"0"),x=`${E(a)}:${E(m)}:${E(g)}`;return h>0?`${h}天 ${x}`:x}),j=()=>{n&&clearInterval(n),n=window.setInterval(()=>u.value++,1e3)},L=()=>{n&&(clearInterval(n),n=null)};return ee(()=>{var h;return(h=k.serverInfo)==null?void 0:h.uptime},h=>h&&(u.value=b(h)),{immediate:!0}),ee(()=>k.isRunning,h=>{h?n||j():L()},{immediate:!0}),$e(()=>L()),(h,a)=>{const m=R("t-tag"),g=R("t-button"),E=R("t-card"),x=R("t-tab-panel"),r=R("t-tabs");return p(),B("div",Ql,[t(E,{class:"control-card",bordered:!1},{default:o(()=>[e("div",en,[e("div",{class:ye(["status-indicator",{running:l.isRunning}])},[a[6]||(a[6]=e("span",{class:"pulse"},null,-1)),_(P(l.isRunning?"Running":"Stopped"),1)],2),t(m,{theme:l.isRunning?"success":"default",variant:"light",shape:"round"},{default:o(()=>[_(P(l.isRunning?"运行中":"已停止"),1)]),_:1},8,["theme"])]),e("div",tn,[l.isRunning?(p(),W(g,{key:1,theme:"danger",size:"large",block:"",loading:l.loading,onClick:a[1]||(a[1]=c=>h.$emit("stop"))},{icon:o(()=>[t(I(Ke))]),default:o(()=>[a[8]||(a[8]=_("停止实例 ",-1))]),_:1},8,["loading"])):(p(),W(g,{key:0,theme:"primary",size:"large",block:"",loading:l.loading,onClick:a[0]||(a[0]=c=>{h.$emit("clear-log"),h.$emit("start")})},{icon:o(()=>[t(I(We))]),default:o(()=>[a[7]||(a[7]=_("启动实例 ",-1))]),_:1},8,["loading"])),e("div",an,[t(g,{variant:"outline",block:"",onClick:a[2]||(a[2]=c=>I(mt)(`/instance/files/${l.serverId}`))},{icon:o(()=>[t(I(Ae))]),default:o(()=>[a[9]||(a[9]=_("文件管理 ",-1))]),_:1}),t(g,{variant:"outline",block:"",disabled:!l.isRunning,loading:l.loading,onClick:a[3]||(a[3]=c=>h.$emit("backup"))},{icon:o(()=>[t(I(Gt))]),default:o(()=>[a[10]||(a[10]=_("备份存档 ",-1))]),_:1},8,["disabled","loading"])]),e("div",sn,[t(g,{variant:"outline",theme:"warning",block:"",onClick:a[4]||(a[4]=c=>h.$emit("clear-log"))},{icon:o(()=>[t(I(Ce))]),default:o(()=>[a[11]||(a[11]=_("清空 ",-1))]),_:1}),t(g,{variant:"outline",theme:"primary",block:"",onClick:C},{icon:o(()=>[t(I(qe))]),default:o(()=>[a[12]||(a[12]=_("设置 ",-1))]),_:1})])])]),_:1}),e("div",ln,[t(r,{modelValue:f.value,"onUpdate:modelValue":a[5]||(a[5]=c=>f.value=c),theme:"card"},{default:o(()=>[t(x,{value:"info"},{label:o(()=>[t(I(qt),{style:{"margin-right":"4px"}}),a[13]||(a[13]=_(" 详情 ",-1))]),default:o(()=>{var c,M,i,w,G,Z,H,A,T;return[e("div",nn,[e("div",on,[e("div",rn,[e("div",un,[t(I(Jt)),a[14]||(a[14]=_(" 实例名称",-1))]),e("div",dn,P(((c=l.serverInfo)==null?void 0:c.name)||"Minecraft Server"),1)]),((M=l.serverInfo)==null?void 0:M.java)!=="none"?(p(),B(re,{key:0},[e("div",cn,[e("div",vn,[t(I(Ue)),a[15]||(a[15]=_(" 内存限制",-1))]),e("div",mn,P(((i=l.serverInfo)==null?void 0:i.maxM)||"?")+" MB",1)]),a[21]||(a[21]=e("div",{class:"proxy-group"},null,-1)),e("div",pn,[e("div",fn,[t(I(jt)),a[16]||(a[16]=_(" 运行端口",-1))]),e("div",gn,P(((G=(w=l.serverInfo)==null?void 0:w.mcConfig)==null?void 0:G.serverPort)||"?"),1)]),e("div",bn,[e("div",yn,[t(I(Xt)),a[17]||(a[17]=_(" 游戏难度",-1))]),e("div",_n,[t(m,{theme:"primary"},{default:o(()=>{var K,N;return[_(P(((N=(K=l.serverInfo)==null?void 0:K.mcConfig)==null?void 0:N.difficulty)||"?"),1)]}),_:1})])]),e("div",kn,[e("div",hn,[t(I(Wt)),a[18]||(a[18]=_(" 游戏模式",-1))]),e("div",wn,[t(m,null,{default:o(()=>{var K,N;return[_(P(((N=(K=l.serverInfo)==null?void 0:K.mcConfig)==null?void 0:N.gamemode)||"?"),1)]}),_:1})])]),e("div",$n,[e("div",xn,[t(I(Ae)),a[19]||(a[19]=_(" 游戏地图",-1))]),e("div",Cn,P(((H=(Z=l.serverInfo)==null?void 0:Z.mcConfig)==null?void 0:H.levelName)||"?"),1)]),e("div",Sn,[e("div",Vn,[t(I(Kt)),a[20]||(a[20]=_(" 正版验证",-1))]),e("div",Mn,[t(m,{theme:((T=(A=l.serverInfo)==null?void 0:A.mcConfig)==null?void 0:T.onlineMode)==="true"?"success":"warning"},{default:o(()=>{var K,N;return[_(P(((N=(K=l.serverInfo)==null?void 0:K.mcConfig)==null?void 0:N.onlineMode)==="true"?"已开启":"已关闭"),1)]}),_:1},8,["theme"])])])],64)):(p(),B("div",Rn,[e("div",Un,[t(I(Ue)),a[22]||(a[22]=_(" 模式",-1))]),a[23]||(a[23]=e("div",{class:"value"},"自定义模式",-1))])),a[25]||(a[25]=e("div",{class:"proxy-group"},null,-1)),e("div",In,[e("div",Bn,[t(I(Se)),a[24]||(a[24]=_(" 运行时长",-1))]),e("div",Ln,P(l.isRunning?D.value:"--:--:--"),1)])])])]}),_:1}),t(x,{value:"monitor",disabled:!l.isRunning},{label:o(()=>[t(I(Ht),{style:{"margin-right":"4px"}}),a[26]||(a[26]=_(" 监控 ",-1))]),default:o(()=>[e("div",Pn,[l.serverInfo&&l.isRunning?(p(),W(Zl,{key:0,"server-id":l.serverId,"is-running":l.isRunning,"max-memory":l.serverInfo.java==="none"?0:l.serverInfo.maxM||4096},null,8,["server-id","is-running","max-memory"])):(p(),B("div",En," 实例未运行，暂无监控数据 "))])]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),t(Ol,{ref_key:"settingsRef",ref:S,"server-id":l.serverId,onSuccess:V},null,8,["server-id"])])}}}),On=oe(An,[["__scopeId","data-v-28f587e4"]]),Tn={class:"console-page"},Nn={class:"layout-container"},Dn={class:"main-terminal-area"},Fn={class:"sidebar-area"},zn=ne({__name:"index",setup(l){const v=be(),k=gt(),d=y(parseInt(v.params.serverId)||0),S=y(!1),f=y(!1),C=y(null),V=y(null);async function u(){var L;if(d.value)try{f.value=!0;const h=await bt(d.value);await k.refreshInstanceList(),S.value=h.status,C.value=h,f.value=!1}catch(h){(L=V.value)==null||L.writeln(`\x1B[1;31m[Error] 获取实例信息失败: ${h.message}\x1B[0m`),f.value=!1}}const n=async()=>{var L,h;f.value=!0;try{(L=V.value)==null||L.writeln("\x1B[1;32m[System] 正在发送启动指令...\x1B[0m"),await Re(d.value,"start"),Y.success("实例启动指令已发送"),f.value=!1}catch(a){(h=V.value)==null||h.writeln(`\x1B[1;31m[Error] 启动失败: ${a.message}\x1B[0m`),f.value=!1}},b=async()=>{var L,h;f.value=!0;try{(L=V.value)==null||L.writeln("\x1B[1;32m[System] 正在发送停止指令...\x1B[0m"),await Re(d.value,"stop"),Y.warning("实例停止指令已发送"),f.value=!1}catch(a){(h=V.value)==null||h.writeln(`\x1B[1;31m[Error] 停止失败: ${a.message}\x1B[0m`),f.value=!1}},D=async()=>{var L,h;try{(L=V.value)==null||L.writeln("\x1B[1;32m[System] 正在发送备份任务...\x1B[0m"),await Re(d.value,"backup"),Y.success("备份任务启动中···"),f.value=!1}catch(a){(h=V.value)==null||h.writeln(`\x1B[1;31m[Error] 备份任务启动失败: ${a.message}\x1B[0m`)}},j=()=>{var L;(L=V.value)==null||L.clear()};return ee(()=>v.params.serverId,async L=>{v.name==="InstanceConsole"&&L&&(d.value=parseInt(L),await u())}),ce(()=>{d.value&&u()}),(L,h)=>(p(),B("div",Tn,[e("div",Nn,[e("div",Dn,[t(na,{ref_key:"terminalRef",ref:V,"server-id":d.value,onUpdate:h[0]||(h[0]=a=>u())},null,8,["server-id"])]),e("div",Fn,[t(On,{"server-id":d.value,"is-running":S.value,loading:f.value,"server-info":C.value,onStart:n,onStop:b,onBackup:D,onClearLog:j},null,8,["server-id","is-running","loading","server-info"])])])]))}}),No=oe(zn,[["__scopeId","data-v-532c09cd"]]);export{No as default};
