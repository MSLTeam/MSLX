import{u as te,_ as K,c as X,F as ae,G as oe,H as G}from"./index.C9-SJ-Lz.js";import{a as z,b as N}from"./user.ChVJfKT3.js";import{z as le,aL as se,ac as ne,aM as re,B as ie,f as de,U as me,a3 as ue,a4 as pe,a6 as ce,aN as fe,ak as E,a1 as Q}from"./tdesign-icons-vue-next.Q06Erwsy.js";import{M as h,D as j}from"./tdesign-vue-next.DWJvSscW.js";import{D as A,F as k,W as $,P as _e,b0 as s,b1 as q,aY as x,b2 as t,a$ as y,G as e,ao as w,b5 as B,aX as T,b6 as H,ap as l,O as ge,R as be}from"./index.BbdIPky0.js";import{D as Y}from"./docs.CxArFray.js";import"./pinia.DE9DXmFR.js";import"./pinia-plugin-persistedstate.n2tMOXAx.js";import"./vue-router.CTuarHf7.js";import"./tvision-color.BU_YHHaJ.js";import"./chroma-js.Cmk4elvR.js";import"./bezier-easing.jp9ayU57.js";import"./lodash.B5_zCkFd.js";import"./axios.R-lXtGyY.js";import"./qs.CnepGyXr.js";import"./side-channel.Bf-JVZLg.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.CD-SYzlK.js";import"./cron-parser.BqMfRICj.js";import"./luxon.BVaPVz1w.js";import"./side-channel-list.CQN2BsdT.js";import"./side-channel-map.BJ69Knz3.js";import"./get-intrinsic.CAdfHqt8.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.Cbri-GHQ.js";import"./dunder-proto.q7lw_6_J.js";import"./call-bind-apply-helpers.BxcZtPLH.js";import"./function-bind.BbkWVFrm.js";import"./hasown.ckq0ukzO.js";import"./call-bound.BO70H6sD.js";import"./side-channel-weakmap.BkoVKe_V.js";import"./nprogress.CMq2Rk2a.js";import"./core-js-pure.DghWRT_o.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./lodash-es.ClUTdtmA.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";const ye={class:"profile-header"},we={class:"avatar-col"},ve={class:"info-col"},Ve={class:"main-row"},Pe={class:"nickname"},he={class:"sub-row"},xe={class:"username"},ke={key:0,class:"last-login"},Se=A({__name:"UserProfileCard",setup(F,{expose:m}){const P=te(),_=k(!1),a=k(!1),i=k(!1),v=k(""),f=k(""),p=k("qq"),r=$({id:"",username:"",name:"",avatar:"",role:"",apiKey:"",lastLoginTime:""}),u=$({changePassword:!1,newPassword:"",confirmPassword:""}),g=async()=>{_.value=!0;try{const c=await z();Object.assign(r,c),v.value=c.username;const o=c.avatar&&c.avatar.match(/nk=(\d+)/);o&&o[1]?(p.value="qq",f.value=o[1]):p.value="custom"}catch(c){h.error(c.message||"用户加载失败")}finally{_.value=!1}};_e(f,c=>{p.value==="qq"&&c&&(r.avatar=`https://q.qlogo.cn/g?b=qq&nk=${c}&s=640`)});const d=c=>{c==="qq"&&f.value&&(r.avatar=`https://q.qlogo.cn/g?b=qq&nk=${f.value}&s=640`)},L=()=>{r.apiKey&&navigator.clipboard.writeText(r.apiKey).then(()=>{h.success("API Key 已复制")})},D=()=>{const c=j.confirm({header:"重置 API 密钥",theme:"warning",body:"重置后，所有使用旧 Key 的外部工具将立即失效，确定要继续吗？",onConfirm:async()=>{try{c.hide(),await N({resetApiKey:!0}),h.success("API Key 重置成功");const o=await z();r.apiKey=o.apiKey}catch(o){h.error(o.message||"重置失败")}}})},n=async()=>{if(u.changePassword){if(!u.newPassword){h.warning("请输入新密码");return}if(u.newPassword!==u.confirmPassword){h.error("两次输入的密码不一致");return}}const c=r.username!==v.value,o=u.changePassword&&!!u.newPassword;a.value=!0;try{const C={username:r.username,name:r.name,avatar:r.avatar,password:o?u.newPassword:void 0,resetApiKey:!1};await N(C),u.changePassword=!1,u.newPassword="",u.confirmPassword="",v.value=r.username,h.success("个人信息保存成功"),c||o?j.alert({header:"重新登录",body:"账号或密码已变更，请重新登录以生效。",confirmBtn:"去登录",onConfirm:async()=>{await P.logout(),window.location.reload()}}):await P.getUserInfo()}catch(C){h.error(C.message)}finally{a.value=!1}};return m({initData:g}),(c,o)=>{const C=s("t-avatar"),M=s("t-tag"),O=s("t-divider"),I=s("t-radio-button"),R=s("t-radio-group"),S=s("t-input"),V=s("t-space"),U=s("t-form-item"),W=s("t-button"),J=s("t-switch"),Z=s("t-form"),ee=s("t-card");return x(),q(ee,{bordered:!1,loading:_.value,class:"settings-card"},{default:t(()=>[y("div",ye,[y("div",we,[e(C,{image:r.avatar,size:"80px",shape:"circle",class:"user-avatar-shadow"},{default:t(()=>[w(B(r.name?r.name.slice(0,1).toUpperCase():"U"),1)]),_:1},8,["image"])]),y("div",ve,[y("div",Ve,[y("span",Pe,B(r.name||"未设置昵称"),1),r.role==="admin"?(x(),q(M,{key:0,theme:"success",variant:"light",size:"small",shape:"round"},{default:t(()=>[...o[8]||(o[8]=[w("管理员",-1)])]),_:1})):(x(),q(M,{key:1,theme:"primary",variant:"light",size:"small",shape:"round"},{default:t(()=>[...o[9]||(o[9]=[w("普通用户",-1)])]),_:1}))]),y("div",he,[y("span",xe,"@"+B(r.username),1),r.lastLoginTime?(x(),T("span",ke,[e(l(le)),w(" "+B(new Date(r.lastLoginTime).toLocaleString()),1)])):H("",!0)])])]),e(O),e(Z,{ref:"userForm",data:r,"label-width":100,"label-align":"left",onSubmit:n},{default:t(()=>[e(U,{label:"头像设置"},{default:t(()=>[e(V,{direction:"vertical",style:{width:"100%"}},{default:t(()=>[e(R,{modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=b=>p.value=b),variant:"default-filled",onChange:d},{default:t(()=>[e(I,{value:"qq"},{default:t(()=>[e(l(se)),o[10]||(o[10]=w(" QQ头像",-1))]),_:1}),e(I,{value:"custom"},{default:t(()=>[e(l(ne)),o[11]||(o[11]=w(" 链接",-1))]),_:1})]),_:1},8,["modelValue"]),p.value==="qq"?(x(),q(S,{key:0,modelValue:f.value,"onUpdate:modelValue":o[1]||(o[1]=b=>f.value=b),placeholder:"输入QQ号自动获取",type:"number"},{"prefix-icon":t(()=>[e(l(re))]),_:1},8,["modelValue"])):(x(),q(S,{key:1,modelValue:r.avatar,"onUpdate:modelValue":o[2]||(o[2]=b=>r.avatar=b),placeholder:"输入图片 URL 链接"},{"prefix-icon":t(()=>[e(l(ie))]),_:1},8,["modelValue"]))]),_:1})]),_:1}),e(U,{label:"用户昵称",name:"name"},{default:t(()=>[e(S,{modelValue:r.name,"onUpdate:modelValue":o[3]||(o[3]=b=>r.name=b),placeholder:"显示的名称"},null,8,["modelValue"])]),_:1}),e(U,{label:"登录账号",name:"username"},{default:t(()=>[e(S,{modelValue:r.username,"onUpdate:modelValue":o[4]||(o[4]=b=>r.username=b),placeholder:"登录唯一标识"},null,8,["modelValue"])]),_:1}),e(U,{label:"API Key",help:"用于第三方工具连接的凭证，请妥善保管"},{default:t(()=>[e(S,{value:r.apiKey,type:i.value?"text":"password",readonly:"",placeholder:"点击重置生成 Key"},{suffix:t(()=>[e(W,{variant:"text",size:"small",onClick:L},{icon:t(()=>[e(l(de))]),_:1}),e(W,{variant:"text",theme:"danger",size:"small",onClick:D},{icon:t(()=>[e(l(me))]),_:1})]),_:1},8,["value","type"])]),_:1}),e(O,{dashed:""}),e(U,{label:"修改密码"},{default:t(()=>[e(J,{modelValue:u.changePassword,"onUpdate:modelValue":o[5]||(o[5]=b=>u.changePassword=b)},null,8,["modelValue"])]),_:1}),u.changePassword?(x(),T(ge,{key:0},[e(U,{label:"新密码","required-mark":""},{default:t(()=>[e(S,{modelValue:u.newPassword,"onUpdate:modelValue":o[6]||(o[6]=b=>u.newPassword=b),type:"password",placeholder:"请输入新密码"},{"prefix-icon":t(()=>[e(l(ue))]),_:1},8,["modelValue"])]),_:1}),e(U,{label:"确认密码","required-mark":""},{default:t(()=>[e(S,{modelValue:u.confirmPassword,"onUpdate:modelValue":o[7]||(o[7]=b=>u.confirmPassword=b),type:"password",placeholder:"请再次输入新密码"},{"prefix-icon":t(()=>[e(l(pe))]),_:1},8,["modelValue"])]),_:1})],64)):H("",!0),e(U,null,{default:t(()=>[e(W,{theme:"primary",type:"submit",loading:a.value,block:"",class:"action-btn"},{default:t(()=>[...o[12]||(o[12]=[w(" 保存个人资料 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["data"])]),_:1},8,["loading"])}}}),Ce=K(Se,[["__scopeId","data-v-5a4f930e"]]),Ue={class:"status-label"},Le=A({__name:"SystemSettingsCard",emits:["refresh"],setup(F,{expose:m,emit:P}){const _=k(!1),a=k(!1),i=$({fireWallBanLocalAddr:!1,openWebConsoleOnLaunch:!0,neoForgeInstallerMirrors:"MSL Mirrors",listenHost:"localhost",listenPort:1027}),v=[{label:"官方源 (较慢)",value:"Official"},{label:"MSL镜像源 (推荐)",value:"MSL Mirrors"},{label:"MSL镜像源 - 备用",value:"MSL Mirrors Backup"}],f=P,p=async()=>{_.value=!0;try{const g=await ae();Object.assign(i,g)}catch(g){h.error(g.message||"系统设置加载失败")}finally{_.value=!1}},r=async()=>{a.value=!0;try{await oe(i),h.success("系统设置保存成功")}catch(g){h.error(g.message)}finally{a.value=!1}},u=()=>{p(),f("refresh")};return m({initData:p}),(g,d)=>{const L=s("t-button"),D=s("t-switch"),n=s("t-form-item"),c=s("t-select"),o=s("t-divider"),C=s("t-space"),M=s("t-input"),O=s("t-col"),I=s("t-row"),R=s("t-form"),S=s("t-card");return x(),q(S,{bordered:!1,title:"系统偏好设置",loading:_.value,class:"settings-card"},{actions:t(()=>[e(L,{theme:"primary",variant:"text",size:"small",onClick:u},{default:t(()=>[...d[6]||(d[6]=[w("刷新数据",-1)])]),_:1})]),default:t(()=>[e(R,{ref:"sysForm",data:i,"label-width":120,"label-align":"left",onSubmit:r},{default:t(()=>[d[10]||(d[10]=y("div",{class:"group-title"},"守护进程",-1)),e(n,{label:"自动打开控制台",help:"MSLX 守护进程启动成功后，是否自动登录网页端控制台。"},{default:t(()=>[e(D,{modelValue:i.openWebConsoleOnLaunch,"onUpdate:modelValue":d[0]||(d[0]=V=>i.openWebConsoleOnLaunch=V)},null,8,["modelValue"])]),_:1}),e(n,{label:"安装镜像源",help:"选择在自动安装 NeoForge / Forge 时所使用的镜像源。",style:{"margin-top":"6px"}},{default:t(()=>[e(c,{modelValue:i.neoForgeInstallerMirrors,"onUpdate:modelValue":d[1]||(d[1]=V=>i.neoForgeInstallerMirrors=V),options:v},null,8,["modelValue"])]),_:1}),e(o,{dashed:""}),d[11]||(d[11]=y("div",{class:"group-title"},"网络与安全",-1)),e(n,{label:"禁止本地访问",help:"开启后将禁止本地回环地址访问，增强安全性。"},{default:t(()=>[e(C,{align:"center"},{default:t(()=>[e(D,{modelValue:i.fireWallBanLocalAddr,"onUpdate:modelValue":d[2]||(d[2]=V=>i.fireWallBanLocalAddr=V)},null,8,["modelValue"]),y("span",Ue,B(i.fireWallBanLocalAddr?"已开启":"已关闭"),1)]),_:1})]),_:1}),e(n,{label:"监听地址设置",help:"设置MSLX守护进程的监听地址。(需要重启守护进程生效,若不明白这是干什么的请一定不要修改！)",style:{"margin-top":"6px"}},{default:t(()=>[e(I,{gutter:16,style:{width:"100%"}},{default:t(()=>[e(O,{span:6},{default:t(()=>[e(M,{modelValue:i.listenHost,"onUpdate:modelValue":d[3]||(d[3]=V=>i.listenHost=V),placeholder:"localhost"},{"prefix-icon":t(()=>[e(l(ce))]),_:1},8,["modelValue"])]),_:1}),e(O,{span:4,style:{display:"flex","align-items":"center"}},{default:t(()=>[d[7]||(d[7]=y("span",{style:{"margin-right":"8px",color:"var(--td-text-color-secondary)"}},":",-1)),e(M,{modelValue:i.listenPort,"onUpdate:modelValue":d[4]||(d[4]=V=>i.listenPort=V),placeholder:"1027",style:{width:"120px"}},{"prefix-icon":t(()=>[e(l(fe))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(n,{style:{"margin-top":"6px"},label:"远程访问"},{default:t(()=>[e(C,{align:"center"},{default:t(()=>[e(L,{theme:"default",onClick:d[5]||(d[5]=V=>l(X)(l(Y).remote_access))},{icon:t(()=>[e(l(E))]),default:t(()=>[d[8]||(d[8]=w(" 配置远程访问说明",-1))]),_:1})]),_:1})]),_:1}),e(n,null,{default:t(()=>[e(L,{theme:"primary",type:"submit",loading:a.value,block:"",class:"action-btn"},{default:t(()=>[...d[9]||(d[9]=[w(" 保存系统设置 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["data"])]),_:1},8,["loading"])}}}),qe=K(Le,[["__scopeId","data-v-b879ab6d"]]),Be=A({__name:"WebPanelStyleCard",setup(F){const m=G(),P=async(_,a)=>{var f;const i=((f=_[0])==null?void 0:f.raw)||_.raw;if(!i)return;const v=await m.uploadImage(i);v&&(m.settings[a]=v)};return(_,a)=>{const i=s("t-button"),v=s("t-upload"),f=s("t-input"),p=s("t-form-item"),r=s("t-divider"),u=s("t-slider"),g=s("t-col"),d=s("t-row"),L=s("t-form"),D=s("t-card");return x(),q(D,{bordered:!1,title:"面板自定义样式",description:"这里设置的样式需要在面板左上角的样式面板中启用背景美化才会生效哦！",loading:l(m).loading,class:"settings-card"},{actions:t(()=>[e(i,{theme:"default",onClick:a[0]||(a[0]=n=>l(X)(l(Y).style))},{icon:t(()=>[e(l(E))]),default:t(()=>[a[11]||(a[11]=w(" 设置文档",-1))]),_:1})]),default:t(()=>[e(L,{data:l(m).settings,"label-width":120,"label-align":"left",onSubmit:l(m).saveSettings},{default:t(()=>[a[13]||(a[13]=y("div",{class:"group-title"},"背景图片设置",-1)),e(p,{label:"浅色背景",help:"留空则使用默认的背景图哦～"},{default:t(()=>[e(f,{modelValue:l(m).settings.webPanelStyleLightBackground,"onUpdate:modelValue":a[2]||(a[2]=n=>l(m).settings.webPanelStyleLightBackground=n),placeholder:"输入完整URL地址或者在右边上传图片"},{suffix:t(()=>[e(v,{theme:"custom",action:"","auto-upload":!1,"show-file-list":!1,accept:"image/png, image/jpeg, image/webp",onChange:a[1]||(a[1]=n=>P(n,"webPanelStyleLightBackground"))},{default:t(()=>[e(i,{variant:"text",shape:"square"},{default:t(()=>[e(l(Q))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"深色背景"},{default:t(()=>[e(f,{modelValue:l(m).settings.webPanelStyleDarkBackground,"onUpdate:modelValue":a[4]||(a[4]=n=>l(m).settings.webPanelStyleDarkBackground=n),placeholder:"输入完整URL地址或者在右边上传图片"},{suffix:t(()=>[e(v,{theme:"custom","auto-upload":!1,"show-file-list":!1,accept:"image/png, image/jpeg, image/webp",onChange:a[3]||(a[3]=n=>P(n,"webPanelStyleDarkBackground"))},{default:t(()=>[e(i,{variant:"text",shape:"square"},{default:t(()=>[e(l(Q))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(r,{dashed:""}),a[14]||(a[14]=y("div",{class:"group-title"},"透明度调整 (0.1 - 1.0)",-1)),e(d,{gutter:[32,16]},{default:t(()=>[e(g,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{label:"浅色背景透明度"},{default:t(()=>[e(u,{modelValue:l(m).settings.webPanelStyleLightBackgroundOpacity,"onUpdate:modelValue":a[5]||(a[5]=n=>l(m).settings.webPanelStyleLightBackgroundOpacity=n),min:.1,max:1,step:.01,"tooltip-props":{theme:"light"}},null,8,["modelValue"])]),_:1})]),_:1}),e(g,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{label:"浅色组件透明度"},{default:t(()=>[e(u,{modelValue:l(m).settings.webPanelStyleLightComponentsOpacity,"onUpdate:modelValue":a[6]||(a[6]=n=>l(m).settings.webPanelStyleLightComponentsOpacity=n),min:.1,max:1,step:.01,"tooltip-props":{theme:"light"}},null,8,["modelValue"])]),_:1})]),_:1}),e(g,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{label:"深色背景透明度"},{default:t(()=>[e(u,{modelValue:l(m).settings.webPanelStyleDarkBackgroundOpacity,"onUpdate:modelValue":a[7]||(a[7]=n=>l(m).settings.webPanelStyleDarkBackgroundOpacity=n),min:.1,max:1,step:.01},null,8,["modelValue"])]),_:1})]),_:1}),e(g,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{label:"深色组件透明度"},{default:t(()=>[e(u,{modelValue:l(m).settings.webPanelStyleDarkComponentsOpacity,"onUpdate:modelValue":a[8]||(a[8]=n=>l(m).settings.webPanelStyleDarkComponentsOpacity=n),min:.1,max:1,step:.01},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(r,{dashed:""}),a[15]||(a[15]=y("div",{class:"group-title"},"终端毛玻璃强度 (Blur)",-1)),e(d,{gutter:[32,16]},{default:t(()=>[e(g,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{label:"浅色模式模糊度"},{default:t(()=>[e(u,{modelValue:l(m).settings.webpPanelTerminalBlurLight,"onUpdate:modelValue":a[9]||(a[9]=n=>l(m).settings.webpPanelTerminalBlurLight=n),min:0,max:50,step:1,"input-number-props":{theme:"column",style:"width: 65px"}},{label:t(({value:n})=>[w(B(n)+"px ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(g,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{label:"深色模式模糊度"},{default:t(()=>[e(u,{modelValue:l(m).settings.webpPanelTerminalBlurDark,"onUpdate:modelValue":a[10]||(a[10]=n=>l(m).settings.webpPanelTerminalBlurDark=n),min:0,max:50,step:1,"input-number-props":{theme:"column",style:"width: 65px"}},{label:t(({value:n})=>[w(B(n)+"px ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(p,{style:{"margin-top":"24px"}},{default:t(()=>[e(i,{theme:"primary",type:"submit",loading:l(m).submitLoading,block:"",class:"action-btn"},{default:t(()=>[...a[12]||(a[12]=[w(" 应用样式设置 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["data","onSubmit"])]),_:1},8,["loading"])}}}),De=K(Be,[["__scopeId","data-v-919cc6d2"]]),Me={class:"settings-page"},Oe=A({__name:"index",setup(F){const m=G(),P=k(),_=k(),a=async()=>{const i=[];P.value&&i.push(P.value.initData()),_.value&&i.push(_.value.initData()),i.push(m.fetchSettings()),await Promise.all(i)};return be(()=>{a()}),(i,v)=>{const f=s("t-space");return x(),T("div",Me,[e(f,{direction:"vertical",size:"large",style:{width:"100%"}},{default:t(()=>[e(Ce,{ref_key:"userCardRef",ref:P},null,512),e(qe,{ref_key:"sysCardRef",ref:_,onRefresh:a},null,512),e(De)]),_:1})])}}}),xt=K(Oe,[["__scopeId","data-v-51250a07"]]);export{xt as default};
