import{d as ne,o as r,b as C,n as ye,e as te,f as dt,h as t,r as $,i as xe,j as en,w as tn,k as p,l as K,m as a,p as e,F as pe,q as we,s as lt,t as M,u as O,v as Jt,x as $s,y as b,z as f,A as Ra,T as Wt,K as an,B as et,C as aa,D as bt,M as L,E as ke,G as sn,H as nn,I as ln,J as on,L as Qe,N as za,O as xt,P as da,Q as As,R as xs,S as ca,U as Ct,V as It,W as Et,X as rn,Y as un,Z as ut,_ as Ea,$ as ba,a0 as dn,a1 as yt,a2 as Xe,a3 as Cs,a4 as cn,a5 as Ss,a6 as mn,a7 as wt,a8 as pn,a9 as at,aa as vn,ab as ma,ac as fn,ad as Ye,ae as nt,af as Is,ag as gn,ah as St,ai as Bt,aj as _n,ak as hn,al as yn,am as Ze,an as Pt,ao as bn,ap as jt,aq as wn,ar as Vs,as as pa,at as Ms,au as Us,av as na,aw as kn,ax as Xt,ay as $n,az as Rt,aA as An,aB as xn,aC as Cn,aD as va,aE as Ls,aF as Bs,aG as Nt,aH as zt,aI as Sn,aJ as Pa,aK as Rs,aL as ka,aM as $a,aN as In,aO as Aa,aP as qt,aQ as xa,aR as la,aS as zs,aT as pt,aU as oa,aV as Fa,aW as Vn,aX as Mn,aY as Un,aZ as es,a_ as Ca,a$ as Ln,b0 as Bn,b1 as Rn,b2 as Es,b3 as zn,b4 as En,b5 as Pn,b6 as Fn,b7 as Tn,b8 as Dn,b9 as On,ba as jn,bb as Ps,bc as Kn,bd as Nn,be as qn,bf as Fs,bg as Gn,bh as Hn,bi as Jn,bj as Wn,bk as Xn,bl as ts,bm as Qn,bn as Yn,bo as Zn}from"./mslx-core.kgNWZO5a.js";import{a3 as Sa,a4 as Ts,a5 as el,a6 as ht,a7 as tl,a8 as al,a9 as $t,aa as sl,ab as nl,ac as ll,ad as Kt,ae as ue,af as Ds,ag as Os,ah as ol}from"./mslx-libs.xTA8FKBh.js";import{i as ra,L as js}from"./mslx-charts.Dyi6RsKH.js";import{o as rl,a as il,d as ul,t as dl,h as cl,e as ml,j as pl,y as vl,f as fl}from"./mslx-editor.DJaQWGRP.js";import{H as gl,w as _l,_ as hl,K as as,T as ss,C as yl}from"./mslx-formatter.B-70lPdB.js";const bl="modulepreload",wl=function(s){return"/"+s},ns={},He=function(n,l,d){let o=Promise.resolve();if(l&&l.length>0){let c=function(_){return Promise.all(_.map(h=>Promise.resolve(h).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};document.getElementsByTagName("link");const v=document.querySelector("meta[property=csp-nonce]"),u=v?.nonce||v?.getAttribute("nonce");o=c(l.map(_=>{if(_=wl(_),_ in ns)return;ns[_]=!0;const h=_.endsWith(".css"),S=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${_}"]${S}`))return;const A=document.createElement("link");if(A.rel=h?"stylesheet":bl,h||(A.as="script"),A.crossOrigin="",A.href=_,u&&A.setAttribute("nonce",u),document.head.appendChild(A),h)return new Promise((z,w)=>{A.addEventListener("load",z),A.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${_}`)))})}))}function i(v){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=v,window.dispatchEvent(u),!u.defaultPrevented)throw v}return o.then(v=>{for(const u of v||[])u.status==="rejected"&&i(u.reason);return n().catch(i)})},kl=["src"],$l=ne({__name:"index",props:{url:String,type:{type:String,default:"layout"}},setup(s){const n=s,l=te(()=>{const{type:d}=n;return["thumbnail-container",{"thumbnail-circle":d==="circle","thumbnail-layout":d==="layout"}]});return(d,o)=>(r(),C("img",{class:ye(l.value),src:s.url},null,10,kl))}}),re=(s,n)=>{const l=s.__vccOpts||s;for(const[d,o]of n)l[d]=o;return l},Al=re($l,[["__scopeId","data-v-bc3a7420"]]),xl={DEFAULT:{"--td-brand-color":"#0052d9","--td-brand-color-1":"#f2f3ff","--td-brand-color-2":"#d9e1ff","--td-brand-color-3":"#b5c7ff","--td-brand-color-4":"#8eabff","--td-brand-color-5":"#618dff","--td-brand-color-6":"#366ef4","--td-brand-color-7":"#0052d9","--td-brand-color-8":"#003cab","--td-brand-color-9":"#002a7c","--td-brand-color-10":"#001a57"},CYAN:{"--td-brand-color":"#0594FA","--td-brand-color-1":"#d7eefe","--td-brand-color-2":"#aeddfd","--td-brand-color-3":"#84cafd","--td-brand-color-4":"#58b8fc","--td-brand-color-5":"#29a4fb","--td-brand-color-6":"#0594FA","--td-brand-color-7":"#29a4fb","--td-brand-color-8":"#0594FA","--td-brand-color-9":"#0378df","--td-brand-color-10":"#01409b"},GREEN:{"--td-brand-color":"#00A870","--td-brand-color-1":"#8dffd9","--td-brand-color-2":"#00f2a2","--td-brand-color-3":"#00dc92","--td-brand-color-4":"#00c583","--td-brand-color-5":"#00A870","--td-brand-color-6":"#009a5d","--td-brand-color-7":"#00c583","--td-brand-color-8":"#00A870","--td-brand-color-9":"#009a5d","--td-brand-color-10":"#004a14"},ORANGE:{"--td-brand-color":"#ED7B2F","--td-brand-color-1":"#fce5d7","--td-brand-color-2":"#f8cdaf","--td-brand-color-3":"#f4b285","--td-brand-color-4":"#f19659","--td-brand-color-5":"#ED7B2F","--td-brand-color-6":"#e75510","--td-brand-color-7":"#f19659","--td-brand-color-8":"#ED7B2F","--td-brand-color-9":"#e75510","--td-brand-color-10":"#7f0a02"},RED:{"--td-brand-color":"#E34D59","--td-brand-color-1":"#fbe5e7","--td-brand-color-2":"#f7ccd0","--td-brand-color-3":"#f3b2b8","--td-brand-color-4":"#ef989f","--td-brand-color-5":"#ea7b84","--td-brand-color-6":"#E34D59","--td-brand-color-7":"#ea7b84","--td-brand-color-8":"#E34D59","--td-brand-color-9":"#e42c3a","--td-brand-color-10":"#8d0309"},PINK:{"--td-brand-color":"#ED49B4","--td-brand-color-1":"#fce5f4","--td-brand-color-2":"#facae9","--td-brand-color-3":"#f7aede","--td-brand-color-4":"#f491d2","--td-brand-color-5":"#f172c5","--td-brand-color-6":"#ED49B4","--td-brand-color-7":"#f172c5","--td-brand-color-8":"#ED49B4","--td-brand-color-9":"#e80f9d","--td-brand-color-10":"#8f025e"},PURPLE:{"--td-brand-color":"#834EC2","--td-brand-color-1":"#eee6f7","--td-brand-color-2":"#ddceee","--td-brand-color-3":"#ccb6e6","--td-brand-color-4":"#bb9edc","--td-brand-color-5":"#ab87d5","--td-brand-color-6":"#9a6fce","--td-brand-color-7":"#9a6fce","--td-brand-color-8":"#834EC2","--td-brand-color-9":"#783ac3","--td-brand-color-10":"#4c1397"},YELLOW:{"--td-brand-color":"#EBB105","--td-brand-color-1":"#fde9ab","--td-brand-color-2":"#fbd152","--td-brand-color-3":"#EBB105","--td-brand-color-4":"#dda204","--td-brand-color-5":"#ca8d03","--td-brand-color-6":"#b67803","--td-brand-color-7":"#fbd152","--td-brand-color-8":"#EBB105","--td-brand-color-9":"#dda204","--td-brand-color-10":"#603100"}},Ks={textColor:"rgba(0, 0, 0, 0.9)",placeholderColor:"rgba(0, 0, 0, 0.35)",borderColor:"#dcdcdc",containerColor:"#fff"},Cl={textColor:"rgba(255, 255, 255, 0.9)",placeholderColor:"rgba(255, 255, 255, 0.35)",borderColor:"#5e5e5e",containerColor:"#242424"};function Sl(s){return s.replace(/([A-Z])/g,"_$1").toUpperCase()}function Il(s,n){const l=/^#[A-F\d]{6}$/i.test(s)?s:Sl(s);return n[l||"DEFAULT"]}function Vl(s,n,l){const d=l==="dark";let o=n.indexOf(s);return d&&(n.reverse().map(v=>{const[u,c,_]=Sa.colorTransform(v,"hex","hsl");return Sa.colorTransform([u,Number(c)-4,_],"hsl","hex")}),o=5,n[0]=`${n[o]}20`),{"--td-brand-color":n[o],"--td-brand-color-1":n[0],"--td-brand-color-2":n[1],"--td-brand-color-3":n[2],"--td-brand-color-4":n[3],"--td-brand-color-5":n[4],"--td-brand-color-6":n[5],"--td-brand-color-7":o>0?n[o-1]:s,"--td-brand-color-8":n[o],"--td-brand-color-9":o>8?s:n[o+1],"--td-brand-color-10":n[9]}}function Ml(s,n,l){const o=l==="dark"?`:root[theme-color='${s}'][theme-mode='dark']`:`:root[theme-color='${s}']`,i=document.createElement("style");i.type="text/css",i.innerText=`${o}{
    --td-brand-color: ${n["--td-brand-color"]};
    --td-brand-color-1: ${n["--td-brand-color-1"]};
    --td-brand-color-2: ${n["--td-brand-color-2"]};
    --td-brand-color-3: ${n["--td-brand-color-3"]};
    --td-brand-color-4: ${n["--td-brand-color-4"]};
    --td-brand-color-5: ${n["--td-brand-color-5"]};
    --td-brand-color-6: ${n["--td-brand-color-6"]};
    --td-brand-color-7: ${n["--td-brand-color-7"]};
    --td-brand-color-8: ${n["--td-brand-color-8"]};
    --td-brand-color-9: ${n["--td-brand-color-9"]};
    --td-brand-color-10: ${n["--td-brand-color-10"]};
  }`,document.head.appendChild(i)}const Ul="conic-gradient(from 90deg at 50% 50%, #FF0000 -19.41deg, #FF0000 18.76deg, #FF8A00 59.32deg, #FFE600 99.87deg, #14FF00 141.65deg, #00A3FF 177.72deg, #0500FF 220.23deg, #AD00FF 260.13deg, #FF00C7 300.69deg, #FF0000 340.59deg, #FF0000 378.76deg)",Ll=ne({__name:"index",props:{value:{type:String}},setup(s){const n=ot(),l=s,d=te(()=>{const{value:o}=l,{colorList:i}=n;return{background:o!=="dynamic"?Il(o,i)["--td-brand-color"]:Ul}});return(o,i)=>(r(),C("div",{style:dt(d.value),class:"color-container"},null,4))}}),ls=re(Ll,[["__scopeId","data-v-e8478b14"]]),Ta={showFooter:!0,isSidebarCompact:!1,showBreadcrumb:!1,mode:"auto",layout:"side",splitMenu:!1,isFooterAside:!1,isSidebarFixed:!0,isHeaderFixed:!0,showHeader:!0,backgroundTheme:"blueGrey",brandTheme:"default",enableCustomTheme:!1},Bl={xmlns:"http://www.w3.org/2000/svg",width:"88",height:"48",fill:"none"};function Rl(s,n){return r(),C("svg",Bl,[...n[0]||(n[0]=[t("path",{fill:"#13161B",d:"M0 0h88v48H0z"},null,-1),t("path",{fill:"#949EAA","fill-rule":"evenodd",d:"M52.533 26.87q-.748.129-1.533.13a9 9 0 0 1-8.533-11.87A9 9 0 0 0 44 33a9 9 0 0 0 8.533-6.13","clip-rule":"evenodd"},null,-1)])])}const zl={render:Rl},El={xmlns:"http://www.w3.org/2000/svg",width:"88",height:"48",fill:"none"};function Pl(s,n){return r(),C("svg",El,[...n[0]||(n[0]=[t("path",{fill:"var(--td-component-border)",d:"M0 0h88v48H0z"},null,-1),t("path",{fill:"var(--td-text-color-primary)","fill-rule":"evenodd",d:"M44 20.583a3.417 3.417 0 1 0 0 6.833 3.417 3.417 0 0 0 0-6.833M39.083 24a4.917 4.917 0 1 1 9.834 0 4.917 4.917 0 0 1-9.834 0M43.25 17.333v-2.5h1.5v2.5zM48.184 18.755l1.767-1.767 1.06 1.06-1.767 1.768zM50.667 23.25h2.5v1.5h-2.5zM49.244 28.184l1.768 1.767-1.06 1.06-1.768-1.767zM44.75 30.666v2.5h-1.5v-2.5zM39.816 29.244l-1.767 1.768-1.061-1.061 1.767-1.768zM37.333 24.75h-2.5v-1.5h2.5zM38.756 19.816l-1.768-1.768 1.06-1.06 1.768 1.767z","clip-rule":"evenodd"},null,-1)])])}const Fl={render:Pl},Tl={xmlns:"http://www.w3.org/2000/svg",width:"88",height:"48",fill:"none"};function Dl(s,n){return r(),C("svg",Tl,[...n[0]||(n[0]=[t("path",{fill:"var(--td-component-border)",d:"M0 0h88v48H0z"},null,-1),t("path",{fill:"var(--td-text-color-primary)",d:"M42.863 14.052v2.708h1.625v-2.708z"},null,-1),t("path",{fill:"var(--td-text-color-primary)","fill-rule":"evenodd",d:"M38.349 23.982a5.326 5.326 0 1 1 10.653 0 5.326 5.326 0 0 1-10.653 0m5.326-3.701a3.701 3.701 0 1 0 0 7.403 3.701 3.701 0 0 0 0-7.403M52.208 26.781h-2.621l-2.06 6.699 1.552.478.511-1.661h2.614l.511 1.66 1.554-.477zm-.503 3.89-.697-2.265h-.221l-.697 2.266z","clip-rule":"evenodd"},null,-1),t("path",{fill:"var(--td-text-color-primary)",d:"m48.208 18.3 1.915-1.914 1.149 1.15-1.915 1.914zM53.606 23.17h-2.709v1.625h2.709zM44.488 31.205v2.708h-1.625v-2.708zM37.228 31.579l1.915-1.915-1.15-1.15-1.914 1.916zM36.453 24.795h-2.708V23.17h2.708zM36.079 17.535l1.915 1.915 1.149-1.15-1.915-1.914z"},null,-1)])])}const Ol={render:Dl},jl={class:"setting-container"},Kl={style:{textAlign:"center",marginTop:"8px"}},Nl={class:"setting-item-row"},ql={class:"setting-layout-drawer"},Gl=ne({__name:"setting",setup(s){const n=ot(),l=$(window.innerWidth),d=te(()=>l.value<480),o=te(()=>d.value?"85%":"408px"),i=()=>{l.value=window.innerWidth},v=["side","top"],u=["default","cyan","green","yellow","orange","red","pink","purple","dynamic"],c=[{type:"auto",text:"跟随系统"},{type:"light",text:"明亮"},{type:"dark",text:"暗黑"}],h=$({...(()=>{const m={...Ta};for(const x in m)Object.prototype.hasOwnProperty.call(m,x)&&(m[x]=n[x]);return m})()});d.value&&h.value.layout==="side"&&(h.value.layout="top");const S=$(!1),A=te({get(){return n.showSettingPanel},set(m){n.updateConfig({showSettingPanel:m})}}),z=m=>{const x=Sa.getPaletteByGradation({colors:[m],step:10})[0],{mode:y}=n,E=Vl(m,x,y);n.addColor({[m]:E}),n.updateConfig({...h.value,brandTheme:m}),Ml(m,E,y)};xe(()=>{const m=document.querySelector(".dynamic-color-btn");m&&m.addEventListener("click",()=>{S.value=!0}),window.addEventListener("resize",i)}),en(()=>{window.removeEventListener("resize",i)});const w=(m,x)=>{!m&&x.trigger==="document"&&(S.value=m)},g=m=>m==="light"?Fl:m==="dark"?zl:Ol,U=()=>{n.updateConfig({showSettingPanel:!1})},I=m=>`https://tdesign.gtimg.com/tdesign-pro/setting/${m}.png`;return tn(()=>{n.updateConfig(h.value)}),(m,x)=>{const y=p("t-radio-button"),E=p("t-radio-group"),T=p("t-switch"),V=p("t-color-picker-panel"),N=p("t-popup"),q=p("t-form"),P=p("t-drawer");return r(),K(P,{visible:A.value,"onUpdate:visible":x[4]||(x[4]=k=>A.value=k),size:o.value,footer:!1,header:"面板样式","close-btn":!0,class:"setting-drawer-container",onCloseBtnClick:U},{default:a(()=>[t("div",jl,[e(q,{ref:"form",data:h.value,"label-align":"left"},{default:a(()=>[x[6]||(x[6]=t("div",{class:"setting-group-title"},"主题模式",-1)),e(E,{modelValue:h.value.mode,"onUpdate:modelValue":x[0]||(x[0]=k=>h.value.mode=k)},{default:a(()=>[(r(),C(pe,null,we(c,(k,B)=>t("div",{key:B,class:"setting-layout-drawer"},[t("div",null,[(r(),K(y,{key:B,value:k.type},{default:a(()=>[(r(),K(lt(g(k.type))))]),_:2},1032,["value"])),t("p",Kl,M(k.text),1)])])),64))]),_:1},8,["modelValue"]),x[7]||(x[7]=t("div",{class:"setting-group-title"},"个性化",-1)),t("div",Nl,[x[5]||(x[5]=t("span",{class:"setting-item-label"},"开启背景美化",-1)),e(T,{modelValue:h.value.enableCustomTheme,"onUpdate:modelValue":x[1]||(x[1]=k=>h.value.enableCustomTheme=k)},null,8,["modelValue"])]),x[8]||(x[8]=t("div",{class:"setting-group-title"},"主题色",-1)),e(E,{modelValue:h.value.brandTheme,"onUpdate:modelValue":x[2]||(x[2]=k=>h.value.brandTheme=k)},{default:a(()=>[(r(!0),C(pe,null,we(u.slice(0,u.length-1),(k,B)=>(r(),C("div",{key:B,class:"setting-layout-drawer"},[(r(),K(y,{key:B,value:k,class:"setting-layout-color-group"},{default:a(()=>[e(ls,{value:k},null,8,["value"])]),_:2},1032,["value"]))]))),128)),t("div",ql,[e(N,{"destroy-on-close":"","expand-animation":"",placement:"bottom-right",trigger:"click",visible:S.value,"overlay-style":{padding:0},onVisibleChange:w},{content:a(()=>[e(V,{"on-change":z,"color-modes":["monochrome"],format:"HEX","swatch-colors":[]})]),default:a(()=>[e(y,{value:u[u.length-1],class:"setting-layout-color-group dynamic-color-btn"},{default:a(()=>[e(ls,{value:u[u.length-1]},null,8,["value"])]),_:1},8,["value"])]),_:1},8,["visible"])])]),_:1},8,["modelValue"]),x[9]||(x[9]=t("div",{class:"setting-group-title"},"导航布局",-1)),e(E,{modelValue:h.value.layout,"onUpdate:modelValue":x[3]||(x[3]=k=>h.value.layout=k)},{default:a(()=>[(r(),C(pe,null,we(v,(k,B)=>t("div",{key:B,class:"setting-layout-drawer"},[(r(),K(y,{key:B,value:k},{default:a(()=>[e(Al,{src:I(k)},null,8,["src"])]),_:2},1032,["value"]))])),64))]),_:1},8,["modelValue"])]),_:1},8,["data"])])]),_:1},8,["visible","size"])}}}),Da=re(Gl,[["__scopeId","data-v-9f31e17e"]]),Me="mslx-webpanel",Ut="mslx-web-token",Lt="mslx-base-url",Hl={class:"menu-text"},Jl={class:"menu-text"},Wl=ne({name:"MenuContent",__name:"MenuContent",props:{navData:{type:Array,default:()=>[]},isHorizontal:{type:Boolean,default:!1},maxItemCount:{type:Number,default:3}},setup(s){const n=s,l=te(()=>ia()),d=te(()=>{const{navData:A}=n;return v(A)}),o=te(()=>n.isHorizontal?d.value.slice(0,n.maxItemCount):d.value),i=te(()=>n.isHorizontal?d.value.slice(n.maxItemCount):[]),v=(A,z)=>A?(A.sort((w,g)=>(w.meta?.orderNo||0)-(g.meta?.orderNo||0)),A.map(w=>{const g=z&&!w.path.includes(z)?`${z}/${w.path}`:w.path;return{path:g,title:w.meta?.title,icon:w.meta?.icon||"",children:v(w.children,g),meta:w.meta,redirect:w.redirect}}).filter(w=>w.meta&&w.meta.hidden!==!0)):[],u=A=>{const{frameSrc:z,frameBlank:w}=A.meta;return z&&w?z.match(/(http|https):\/\/([\w.]+\/?)\S*/):null},c=A=>l.value.startsWith(A.path)?l.value:A.meta?.single?A.redirect:A.path,_=A=>A.icon&&typeof A.icon=="string",h=A=>Ts(A.icon)&&typeof A.icon.render=="function"?{can:!0,render:A.icon.render}:{can:!1,render:null},S=A=>{window.open(A)};return(A,z)=>{const w=p("t-icon"),g=p("t-menu-item"),U=p("menu-content",!0),I=p("t-submenu");return r(),C("div",{id:"menu-wrapper",class:ye(["modern-menu-wrapper",{"is-horizontal":s.isHorizontal}])},[(r(!0),C(pe,null,we(o.value,m=>(r(),C(pe,{key:m.path},[!m.children||!m.children.length||m.meta?.single?(r(),C(pe,{key:0},[u(m)?(r(),K(g,{key:0,name:m.path,value:c(m),class:"modern-menu-item",onClick:x=>S(u(m)[0])},{icon:a(()=>[_(m)?(r(),K(w,{key:0,name:m.icon},null,8,["name"])):h(m).can?(r(),K(lt(h(m).render),{key:1,class:"t-icon"})):O("",!0)]),default:a(()=>[t("span",Hl,M(m.title),1)]),_:2},1032,["name","value","onClick"])):(r(),K(g,{key:1,name:m.path,value:c(m),to:m.path,class:"modern-menu-item"},{icon:a(()=>[_(m)?(r(),K(w,{key:0,name:m.icon},null,8,["name"])):h(m).can?(r(),K(lt(h(m).render),{key:1,class:"t-icon"})):O("",!0)]),default:a(()=>[t("span",Jl,M(m.title),1)]),_:2},1032,["name","value","to"]))],64)):(r(),K(I,{key:1,name:m.path,value:m.path,title:m.title,class:"modern-submenu"},{icon:a(()=>[_(m)?(r(),K(w,{key:0,name:m.icon},null,8,["name"])):h(m).can?(r(),K(lt(h(m).render),{key:1,class:"t-icon"})):O("",!0)]),default:a(()=>[m.children?(r(),K(U,{key:0,"nav-data":m.children,"is-horizontal":!1},null,8,["nav-data"])):O("",!0)]),_:2},1032,["name","value","title"]))],64))),128)),s.isHorizontal&&i.value.length>0?(r(),K(I,{key:0,name:"more-menu",title:"更多",class:"modern-submenu"},{icon:a(()=>[e(w,{name:"ellipsis"})]),default:a(()=>[e(U,{"nav-data":i.value,"is-horizontal":!1},null,8,["nav-data"])]),_:1})):O("",!0)],2)}}}),Ia=re(Wl,[["__scopeId","data-v-3b61b27d"]]),Oa="/assets/png/mslx-logo.BqgIBdpC.png",Xl=["src"],Ql={key:1,class:"header-operate-left show-on-mobile"},Yl={class:"operations-container"},Zl={class:"header-user-account",style:{"margin-left":"6px"}},eo=ne({__name:"Header",props:{theme:{type:String,default:"light"},layout:{type:String,default:"top"},showLogo:{type:Boolean,default:!0},menu:{type:Array,default:()=>[]},isFixed:{type:Boolean,default:!1},isCompact:{type:Boolean,default:!1},maxLevel:{type:Number,default:3}},setup(s){const n=Re(),l=s,d=Jt(),o=ot(),i=()=>{o.updateConfig({showSettingPanel:!0})},v=te(()=>ia()),u=te(()=>[`${Me}-header-layout`]),c=te(()=>{const{isFixed:g,layout:U,isCompact:I}=l;return[{[`${Me}-header-menu`]:!g,[`${Me}-header-menu-fixed`]:g,[`${Me}-header-menu-fixed-side`]:U==="side"&&g,[`${Me}-header-menu-fixed-side-compact`]:U==="side"&&g&&I}]}),_=()=>{o.updateConfig({isSidebarCompact:!o.isSidebarCompact})},h=g=>{d.push(g)},S=g=>{g&&d.push(g)},A=()=>{d.push({path:"/login",query:{redirect:encodeURIComponent(d.currentRoute.value.fullPath)}})},z=()=>{window.open("https://github.com/MSLTeam/MSLX")},w=()=>{window.open("https://mslx.mslmc.cn")};return(g,U)=>{const I=p("t-icon"),m=p("t-button"),x=p("t-menu"),y=p("t-popup"),E=p("t-tooltip"),T=p("t-dropdown-item"),V=p("t-dropdown-menu"),N=p("t-avatar"),q=p("t-dropdown"),P=p("t-head-menu");return r(),C("div",{class:ye(u.value)},[e(P,{class:ye(c.value),theme:s.theme,"expand-type":"popup",value:v.value},$s({logo:a(()=>[s.showLogo?(r(),C("span",{key:0,class:ye(`${b(Me)}-side-nav-logo-wrapper`),onClick:U[0]||(U[0]=k=>h("/dashboard/base"))},[t("img",{style:{width:"32px"},src:b(Oa),class:ye(`${b(Me)}-side-nav-logo-img`),alt:"logo"},null,10,Xl),t("span",{style:{"margin-left":"8px","font-size":"18px","font-weight":"bold","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap"},class:ye(`${b(Me)}-side-nav-logo-text hide-on-mobile`)}," MSLX 管理中心 ",2)],2)):O("",!0),s.layout=="side"?(r(),C("div",Ql,[e(m,{theme:"default",shape:"square",variant:"text",onClick:_},{default:a(()=>[e(I,{class:"collapsed-icon",name:"view-list"})]),_:1})])):O("",!0)]),operations:a(()=>[t("div",Yl,[e(E,{placement:"bottom",content:"代码仓库",class:"hide-on-mobile"},{default:a(()=>[e(m,{theme:"default",shape:"square",variant:"text",onClick:z},{default:a(()=>[e(I,{name:"logo-github"})]),_:1})]),_:1}),e(E,{placement:"bottom",content:"帮助文档",class:"hide-on-mobile"},{default:a(()=>[e(m,{theme:"default",shape:"square",variant:"text",onClick:w},{default:a(()=>[e(I,{name:"help-circle"})]),_:1})]),_:1}),e(q,{"min-column-width":135,trigger:"click"},{dropdown:a(()=>[e(V,null,{default:a(()=>[e(T,{class:"operations-dropdown-container-item",onClick:U[1]||(U[1]=k=>h("/settings"))},{default:a(()=>[e(I,{name:"user-circle"}),U[2]||(U[2]=f("个人中心 ",-1))]),_:1}),e(T,{class:"operations-dropdown-container-item",onClick:A},{default:a(()=>[e(I,{name:"poweroff"}),U[3]||(U[3]=f("退出登录 ",-1))]),_:1})]),_:1})]),default:a(()=>[e(m,{class:"header-user-btn",theme:"default",variant:"text"},{icon:a(()=>[e(N,{image:b(n).userInfo.avatar},null,8,["image"])]),suffix:a(()=>[e(I,{name:"chevron-down"})]),default:a(()=>[t("div",Zl,M(b(n).userInfo.name),1)]),_:1})]),_:1}),e(q,{"min-column-width":135,trigger:"click",class:"show-on-mobile"},{dropdown:a(()=>[e(V,null,{default:a(()=>[e(T,{class:"operations-dropdown-container-item",onClick:z},{default:a(()=>[e(I,{name:"logo-github"}),U[4]||(U[4]=f("代码仓库 ",-1))]),_:1}),e(T,{class:"operations-dropdown-container-item",onClick:w},{default:a(()=>[e(I,{name:"help-circle"}),U[5]||(U[5]=f("帮助文档 ",-1))]),_:1}),e(T,{class:"operations-dropdown-container-item",onClick:i},{default:a(()=>[e(I,{name:"setting"}),U[6]||(U[6]=f("系统设置 ",-1))]),_:1})]),_:1})]),default:a(()=>[e(m,{theme:"default",shape:"square",variant:"text"},{default:a(()=>[e(I,{name:"more"})]),_:1})]),_:1}),e(E,{placement:"bottom",content:"系统设置",class:"hide-on-mobile"},{default:a(()=>[e(m,{theme:"default",shape:"square",variant:"text",onClick:i},{default:a(()=>[e(I,{name:"setting"})]),_:1})]),_:1})])]),_:2},[s.layout!=="side"?{name:"default",fn:a(()=>[e(Ia,{class:"header-menu hide-on-mobile","nav-data":s.menu,"is-horizontal":!0},null,8,["nav-data"]),e(y,{placement:"bottom-left",class:"show-on-mobile header-menu-mobile-popup","overlay-style":{padding:"0",width:"100%",marginTop:"2px",boxShadow:"none",borderTop:"1px solid var(--td-border-level-1-color)"}},{content:a(()=>[e(x,{value:v.value,theme:s.theme,"expand-mutex":"",style:{width:"100vw"},onChange:S},{default:a(()=>[e(Ia,{"nav-data":s.menu},null,8,["nav-data"])]),_:1},8,["value","theme"])]),default:a(()=>[e(m,{style:{"margin-left":"-16px"},theme:"default",shape:"square",variant:"text"},{default:a(()=>[e(I,{name:"app"})]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["class","theme","value"])],2)}}}),to=re(eo,[["__scopeId","data-v-f5039bf3"]]),os=ne({__name:"LayoutHeader",setup(s){const n=Gt(),l=ot(),{routers:d}=Ra(n),o=te(()=>l.layout==="mix"?l.splitMenu?d.value.map(i=>({...i,children:[]})):[]:d.value);return(i,v)=>b(l).showHeader?(r(),K(to,{key:0,"show-logo":b(l).showHeaderLogo,theme:b(l).displayMode,layout:b(l).layout,"is-fixed":b(l).isHeaderFixed,menu:o.value,"is-compact":b(l).isSidebarCompact},null,8,["show-logo","theme","layout","is-fixed","menu","is-compact"])):O("",!0)}}),ao={};function so(s,n){const l=p("router-view");return r(),K(l,null,{default:a(({Component:d})=>[e(Wt,{name:"fade",mode:"out-in"},{default:a(()=>[(r(),K(an,null,[(r(),K(lt(d)))],1024))]),_:2},1024)]),_:1})}const no=re(ao,[["render",so],["__scopeId","data-v-6214f40c"]]),lo=ne({__name:"Breadcrumb",setup(s){const n=te(()=>{const l=et(),d=l.path.split("/");return d.shift(),d.reduce((i,v,u)=>(l.matched[u]?.meta?.hiddenBreadcrumb||Object.values(l.params).includes(v)||i.push({path:v,to:i[u-1]?`/${i[u-1].path}/${v}`:`/${v}`,title:l.matched[u]?.meta?.title??v}),i),[])});return(l,d)=>{const o=p("t-breadcrumbItem"),i=p("t-breadcrumb");return r(),K(i,{"max-item-width":"150",class:"tdesign-breadcrumb"},{default:a(()=>[(r(!0),C(pe,null,we(n.value,v=>(r(),K(o,{key:v.to,to:v.to},{default:a(()=>[f(M(v.title),1)]),_:2},1032,["to"]))),128))]),_:1})}}}),oo=re(lo,[["__scopeId","data-v-b4121266"]]),ro={class:"glass-capsule design-card"},io={class:"copyright"},uo=ne({__name:"Footer",setup(s){return(n,l)=>(r(),C("footer",{class:ye(`${b(Me)}-footer-centered-lite`)},[t("div",ro,[l[0]||(l[0]=t("span",{class:"brand"},"MSLX-WEBPANEL",-1)),l[1]||(l[1]=t("span",{class:"divider"},"/",-1)),l[2]||(l[2]=t("span",{class:"brand"},"MSLTEAM",-1)),l[3]||(l[3]=t("span",{class:"divider"},"/",-1)),t("span",io,"© 2021-"+M(new Date().getFullYear()),1)])],2))}}),co=re(uo,[["__scopeId","data-v-05d9fb24"]]),rs=ne({__name:"LayoutContent",setup(s){const n=ot();return(l,d)=>{const o=p("t-content"),i=p("t-footer"),v=p("t-layout");return r(),K(v,{class:ye(`${b(Me)}-layout`)},{default:a(()=>[e(o,{class:ye(`${b(Me)}-content-layout`)},{default:a(()=>[b(n).showBreadcrumb?(r(),K(oo,{key:0})):O("",!0),e(no)]),_:1},8,["class"]),b(n).showFooter?(r(),K(i,{key:0,class:ye(`${b(Me)}-footer-layout`)},{default:a(()=>[e(co)]),_:1},8,["class"])):O("",!0)]),_:1},8,["class"])}}}),mo="mslx-webpanel",po="1.1.10.1",vo={dev:"vite --mode development","dev:linux":"vite --mode development","build:test":"vite build --mode test",build:"vue-tsc --noEmit && vite build --mode release && node generate-build-info.js",preview:"vite preview",lint:"eslint --ext .vue,.js,.jsx,.ts,.tsx ./ --max-warnings 0","lint:fix":"eslint --ext .vue,.js,jsx,.ts,.tsx ./ --max-warnings 0 --fix",stylelint:"stylelint src/**/*.{html,vue,sass,less}","stylelint:fix":"stylelint --fix src/**/*.{html,vue,vss,sass,less}",prepare:`node -e "if(require('fs').existsSync('.git')){process.exit(1)}" || is-ci || husky install`,"site:preview":"npm run build && cp -r dist _site",test:'echo "no test specified,work in process"',"test:coverage":'echo "no test:coverage specified,work in process"'},fo={"@codemirror/lang-javascript":"^6.2.4","@codemirror/lang-json":"^6.0.2","@codemirror/lang-yaml":"^6.1.2","@codemirror/language":"^6.12.1","@codemirror/legacy-modes":"^6.5.2","@codemirror/state":"^6.5.2","@codemirror/theme-one-dark":"^6.1.3","@codemirror/view":"^6.39.2","@eslint/js":"^9.38.0","@microsoft/signalr":"^10.0.0","@vueuse/core":"^14.0.0","@xterm/addon-fit":"^0.11.0","@xterm/xterm":"^5.6.0-beta.143","ansi-colors":"^4.1.3",axios:"^1.13.1","cron-parser":"^5.4.0",dayjs:"^1.11.11",echarts:"^5.5.1",lodash:"4.17.23","md-editor-v3":"^6.1.0",nprogress:"^0.2.0",pinia:"^2.1.7","pinia-plugin-persistedstate":"^3.2.1","qrcode.vue":"^3.4.1",qs:"6.14.1","tdesign-icons-vue-next":"^0.4.1","tdesign-vue-next":"^1.17.1","tvision-color":"^1.6.0","typescript-eslint":"^8.46.2",vue:"^3.4.31","vue-clipboard3":"^2.0.0","vue-codemirror":"^6.1.1","vue-router":"^4.4.0"},go={"@commitlint/cli":"^19.3.0","@commitlint/config-conventional":"^19.2.2","@types/lodash":"^4.17.23","@types/qs":"^6.9.15","@types/ws":"^8.5.10","@typescript-eslint/eslint-plugin":"^8.46.2","@typescript-eslint/parser":"^8.46.2","@vitejs/plugin-vue":"^6.0.3","@vitejs/plugin-vue-jsx":"^5.1.3","@vue/compiler-sfc":"^3.4.31","@vue/eslint-config-typescript":"^14.6.0",commitizen:"^4.3.0","cz-conventional-changelog":"^3.3.0",eslint:"^9.38.0","eslint-config-prettier":"^9.1.0","eslint-plugin-import":"^2.32.0","eslint-plugin-prettier":"^5.1.3","eslint-plugin-vue":"^10.7.0","eslint-plugin-vue-scoped-css":"^2.12.0",husky:"^9.1.1",less:"^4.2.0","lint-staged":"^15.2.7",prettier:"^3.3.3",stylelint:"^16.25.0","stylelint-less":"^3.0.0","stylelint-order":"^6.0.4",typescript:"^5.5.3",vite:"^7.3.1","vite-svg-loader":"^5.1.0","vue-tsc":"^2.0.26"},_o={commitizen:{path:"./node_modules/cz-conventional-changelog"}},ho="MSLX Web Panel",Ot={name:mo,version:po,scripts:vo,dependencies:fo,devDependencies:go,config:_o,"lint-staged":{"*.{js,jsx,vue,ts,tsx}":["prettier --write","npm run lint:fix","git add ."],"*.{html,vue,vss,sass,less}":["npm run stylelint:fix","git add ."]},description:ho},yo=["src"],bo={class:"version-container"},wo=991,ko=ne({__name:"SideNav",props:{menu:{type:Array,default:()=>[]},showLogo:{type:Boolean,default:!0},isFixed:{type:Boolean,default:!0},layout:{type:String,default:""},headerHeight:{type:String,default:"64px"},theme:{type:String,default:"light"},isCompact:{type:Boolean,default:!1}},setup(s){const n=s,l=te(()=>ot().isSidebarCompact),d=te(()=>ia()),o=te(()=>{const S=ia(),A=S.substring(0,S.lastIndexOf("/")),z=lr();return el(z,A===""?[]:[A])}),i=te(()=>{const{isCompact:S}=n;return[`${Me}-sidebar-layout`,{[`${Me}-sidebar-compact`]:S}]}),v=te(()=>{const{showLogo:S,isFixed:A,layout:z}=n;return[`${Me}-side-nav`,{[`${Me}-side-nav-no-logo`]:!S,[`${Me}-side-nav-no-fixed`]:!A,[`${Me}-side-nav-mix-fixed`]:z==="mix"&&A}]}),u=Jt(),c=ot(),_=()=>{const S=window.innerWidth<=wo;c.updateConfig({isSidebarCompact:S})};xe(()=>{_(),window.onresize=()=>{_()}});const h=()=>{u.push("/dashboard/base")};return(S,A)=>{const z=p("t-menu");return r(),C("div",{class:ye(i.value)},[e(z,{class:ye(v.value),theme:s.theme,value:d.value,collapsed:l.value,"default-expanded":o.value},{logo:a(()=>[s.showLogo?(r(),C("span",{key:0,class:ye(`${b(Me)}-side-nav-logo-wrapper`),style:dt(l.value?"display: flex; justify-content: center; width: 100%;":"display: flex; align-items: center; justify-content: flex-start; width: 100%;"),onClick:h},[t("img",{style:{width:"32px","margin-right":"8px"},src:b(Oa),class:ye(`${b(Me)}-side-nav-logo-img`),alt:"logo"},null,10,yo),l.value?O("",!0):(r(),C("span",{key:0,style:{"font-size":"18px","font-weight":"bold","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap"},class:ye(`${b(Me)}-side-nav-logo-text`)}," MSLX 管理中心 ",2))],6)):O("",!0)]),operations:a(()=>[t("span",bo,M(l.value?"":"MSLX-WEBPANEL")+" v"+M(b(Ot).version),1)]),default:a(()=>[e(Ia,{"nav-data":s.menu},null,8,["nav-data"])]),_:1},8,["class","theme","value","collapsed","default-expanded"]),t("div",{class:ye(`${b(Me)}-side-nav-placeholder${l.value?"-hidden":""}`)},null,2)],2)}}}),is=ne({__name:"LayoutSideNav",setup(s){const n=et(),l=Gt(),d=ot(),{routers:o}=Ra(l),i=te(()=>{const{layout:v,splitMenu:u}=d;let c=o.value;return v==="mix"&&u&&c.forEach(_=>{n.path.indexOf(_.path)===0&&(c=_.children.map(h=>({...h,path:`${_.path}/${h.path}`})))}),c});return(v,u)=>b(d).showSidebar?(r(),K(ko,{key:0,"show-logo":b(d).showSidebarLogo,layout:b(d).layout,"is-fixed":b(d).isSidebarFixed,menu:i.value,theme:b(d).displayMode,"is-compact":b(d).isSidebarCompact},null,8,["show-logo","layout","is-fixed","menu","theme","is-compact"])):O("",!0)}}),ja="/assets/jpg/mslx-bg_light_new.CL71WzMj.jpg",Ka="/assets/jpg/mslx-bg_night_new.CfCwUDBl.jpg";let _t=new Map;const us=s=>[s.method,s.url].join("&");class $o{addPending(n){this.removePending(n);const l=us(n);n.cancelToken=n.cancelToken||new aa.CancelToken(d=>{_t.has(l)||_t.set(l,d)})}removeAllPending(){_t.forEach(n=>{n&&ht(n)&&n()}),_t.clear()}removePending(n){const l=us(n);if(_t.has(l)){const d=_t.get(l);d&&d(l),_t.delete(l)}}reset(){_t=new Map}}class Ao{instance;options;constructor(n){this.options=n,this.instance=aa.create(n),this.setupInterceptors()}createAxios(n){this.instance=aa.create(n)}getTransform(){const{transform:n}=this.options;return n}getAxios(){return this.instance}configAxios(n){this.instance&&this.createAxios(n)}setHeader(n){this.instance&&Object.assign(this.instance.defaults.headers,n)}setupInterceptors(){const n=this.getTransform();if(!n)return;const{requestInterceptors:l,requestInterceptorsCatch:d,responseInterceptors:o,responseInterceptorsCatch:i}=n,v=new $o;this.instance.interceptors.request.use(u=>{const{headers:{ignoreRepeatRequest:c}}=u;return(c??this.options.requestOptions?.ignoreRepeatRequest)||v.addPending(u),l&&ht(l)&&(u=l(u,this.options)),u},void 0),d&&ht(d)&&this.instance.interceptors.request.use(void 0,d),this.instance.interceptors.response.use(u=>(u&&v.removePending(u.config),o&&ht(o)&&(u=o(u)),u),void 0),i&&ht(i)&&this.instance.interceptors.response.use(void 0,i)}supportFormData(n){const l=n.headers||this.options.headers;return(l?.["Content-Type"]||l?.["content-type"])!=="application/x-www-form-urlencoded;charset=UTF-8"||!Reflect.has(n,"data")||n.method?.toUpperCase()==="GET"?n:{...n,data:tl.stringify(n.data,{arrayFormat:"brackets"})}}get(n,l){return this.request({...n,method:"GET"},l)}post(n,l){return this.request({...n,method:"POST"},l)}put(n,l){return this.request({...n,method:"PUT"},l)}delete(n,l){return this.request({...n,method:"DELETE"},l)}patch(n,l){return this.request({...n,method:"PATCH"},l)}async request(n,l){let d=al(n);const o=this.getTransform(),{requestOptions:i}=this.options,v={...i,...l},{beforeRequestHook:u,requestCatchHook:c,transformRequestHook:_}=o||{};return u&&ht(u)&&(d=u(d,v)),d.requestOptions=v,d=this.supportFormData(d),new Promise((h,S)=>{this.instance.request(n.retryCount?n:d).then(A=>{if(_&&ht(_)){try{const z=_(A,v);h(z)}catch(z){S(z||new Error("请求错误!"))}return}h(A)}).catch(A=>{if(c&&ht(c)){S(c(A,v));return}aa.isAxiosError(A),S(A)})})}}const xo="YYYY-MM-DD HH:mm:ss";function ds(s,n=!1){if(!s)return n?"":{};const l=new Date().getTime();return n?`?_t=${l}`:{_t:l}}function Va(s){if(Object.prototype.toString.call(s)==="[object Object]")for(const n in s){if(s[n]&&s[n]._isAMomentObject&&(s[n]=s[n].format(xo)),$t(n)){const l=s[n];if(l)try{s[n]=$t(l)?l.trim():l}catch(d){throw new Error(d)}}Ts(s[n])&&Va(s[n])}}function Co(s,n){let l="";for(const d in n)l+=`${d}=${encodeURIComponent(n[d])}&`;return l=l.replace(/&$/,""),/\?$/.test(s)?s+l:s.replace(/\/?$/,"?")+l}const So={transformRequestHook:(s,n)=>{const{isTransformResponse:l,isReturnNativeResponse:d}=n,o=s.config.method?.toLowerCase();if(s.status===204||o==="put"||o==="patch"||d)return s;if(!l)return s.data;const{data:i}=s;if(!i)throw new Error("请求接口错误");if(i&&Reflect.has(i,"code")&&Reflect.has(i,"message")){const{code:u,message:c}=i;if(u===200)return i.data;throw new Error(c||`请求接口错误, 错误码: ${u}`)}else return i},beforeRequestHook:(s,n)=>{const{apiUrl:l,isJoinPrefix:d,urlPrefix:o,joinParamsToUrl:i,formatDate:v,joinTime:u=!0}=n;d&&o&&$t(o)&&(s.url=`${o}${s.url}`),l&&$t(l)&&!s.baseURL&&(s.url=`${l}${s.url}`);const c=s.params||{},_=s.data||!1;return v&&_&&!$t(_)&&Va(_),s.method?.toUpperCase()==="GET"?$t(c)?(s.url=`${s.url+c}${ds(u,!0)}`,s.params=void 0):s.params=Object.assign(c||{},ds(u,!1)):$t(c)?(s.url+=c,s.params=void 0):(v&&Va(c),Reflect.has(s,"data")&&s.data&&(Object.keys(s.data).length>0||_ instanceof FormData)?(s.data=_,s.params=c):(s.data=c,s.params=void 0),i&&(s.url=Co(s.url,{...s.params,...s.data}))),s},requestInterceptors:(s,n)=>{const l=localStorage.getItem(Ut),d=localStorage.getItem(Lt);return d&&!/^(https?:)?\/\//.test(s.url||"")&&!s.baseURL&&(s.baseURL=d),l&&s?.requestOptions?.withToken!==!1&&(s.headers.hasAuthorization()||(s.headers["x-user-token"]=l)),s},responseInterceptors:s=>s,responseInterceptorsCatch:s=>{const{response:n}=s;if(n&&n.data){const d=n.data?.message;return d?Promise.reject(new Error(d)):Promise.reject(s)}return Promise.reject(s)}};function Io(s){return new Ao(sl({authenticationScheme:"",timeout:10*1e3,withCredentials:!1,headers:{"Content-Type":"application/json;charset=UTF-8"},transform:So,requestOptions:{apiUrl:"",isJoinPrefix:!0,urlPrefix:"",isReturnNativeResponse:!1,isTransformResponse:!0,joinParamsToUrl:!1,formatDate:!0,joinTime:!1,ignoreRepeatRequest:!0,withToken:!0,retry:{count:3,delay:1e3}}},{}))}const X=Io();function Vo(){return X.get({url:"/api/settings"})}function Mo(s){return X.post({url:"/api/settings",data:s})}function Uo(s){return X.post({url:"/api/settings/webpanel/style",data:s})}function Lo(){return X.get({url:"/api/settings/webpanel/style"})}async function Qt(){return await X.post({url:"/api/files/upload/init"})}async function Yt(s,n,l,d,o){const i=new FormData;return i.append("index",n.toString()),i.append("file",l),await X.post({url:`/api/files/upload/chunk/${s}`,data:i,headers:{"Content-Type":"multipart/form-data"},timeout:300*1e3,onUploadProgress:d,signal:o})}async function Zt(s,n){return await X.post({url:`/api/files/upload/finish/${s}`,data:{totalChunks:n},timeout:120*1e3})}async function At(s){return await X.post({url:`/api/files/upload/delete/${s}`})}async function Bo(s){return await X.get({url:`/api/files/upload/inspect/${s}`,timeout:60*1e3})}async function Ro(s,n=""){return await X.get({url:`/api/files/instance/${s}/lists`,params:{path:n}})}async function fa(s,n){return await X.get({url:`/api/files/instance/${s}/content`,params:{path:n}})}function Na(s,n,l){return X.post({url:`/api/files/instance/${s}/content`,data:{path:n,content:l}})}function zo(s,n,l){return X.post({url:`/api/files/instance/${s}/directory`,data:{path:n,name:l}})}function Eo(s,n,l){return X.post({url:`/api/files/instance/${s}/rename`,data:{oldPath:n,newPath:l}})}function Po(s,n){return X.post({url:`/api/files/instance/${s}/delete`,data:{paths:n}})}function Fo(s,n,l,d){return X.post({url:`/api/files/instance/${s}/upload`,data:{uploadId:n,fileName:l,currentPath:d}})}function To(s,n){return X.get({url:`/api/files/instance/${s}/download`,params:{path:n},responseType:"blob"})}function Do(s,n,l,d){return X.post({url:`/api/files/instance/${s}/compress`,data:{sources:n,targetName:l,currentPath:d}})}function Oo(s){return X.get({url:`/api/files/task/compress/${s}`})}function jo(s,n,l,d="utf-8",o=!0){return X.post({url:`/api/files/instance/${s}/decompress`,data:{fileName:n,currentPath:l,encoding:d,createSubFolder:o}})}function Ko(s){return X.get({url:`/api/files/task/decompress/${s}`})}async function No(s,n,l){return await X.post({url:`/api/files/instance/${s}/chmod`,data:{path:n,mode:l}})}async function Ma(s,n,l){return await X.get({url:`/api/files/pm/instance/${s}/list?${l?"checkClient=true":""}`,params:{mode:n}})}async function qo(s,n,l,d){return await X.post({url:`/api/files/pm/instance/${s}/set`,data:{mode:n,action:l,targets:d}})}function Go(s,n,l){return X.post({url:`/api/files/instance/${s}/copy`,data:{sourcePaths:n,targetPath:l},timeout:120*1e3})}function Ho(s,n,l){return X.post({url:`/api/files/instance/${s}/move`,data:{sourcePaths:n,targetPath:l},timeout:120*1e3})}function Jo(s,n){return X.post({url:"api/static/images/upload",data:{fileKey:s,fileName:n}})}const Ft=bt("webpanel",{state:()=>({settings:{webPanelStyleDarkBackgroundOpacity:1,webPanelStyleDarkComponentsOpacity:.4,webpPanelTerminalBlurDark:5,webPanelStyleLightBackground:"",webPanelStyleLightBackgroundOpacity:1,webPanelStyleLightComponentsOpacity:.6,webpPanelTerminalBlurLight:5,webPanelStyleDarkBackground:"",webPanelColorizeLogLevel:1},loading:!1,submitLoading:!1}),actions:{async fetchSettings(){this.loading=!0;try{const s=await Lo();this.settings=s}catch(s){console.error("获取面板样式失败",s)}finally{this.loading=!1}},async saveSettings(){this.submitLoading=!0;try{await Uo(this.settings),L.success("面板样式保存成功")}catch(s){L.error("保存失败: "+s.message)}finally{this.submitLoading=!1}},async uploadImage(s){if(!s)return L.error("文件对象无效"),null;if(!["image/png","image/jpeg","image/webp"].includes(s.type))return L.error("仅支持 PNG, JPG, WEBP 格式的图片"),null;if(!(s.size/1024/1024<10))return L.error("图片大小不能超过 10MB"),null;try{const{uploadId:d}=await Qt();return await Yt(d,1,s),await Zt(d,1),await Jo(d,s.name),L.success(`上传成功: ${s.name}`),s.name}catch(d){return L.error("上传失败: "+(d.message||"网络错误")),null}}},persist:{key:"webpanel-style-storage",paths:["settings"]}}),Wo=ne({__name:"index",setup(s){const n=et(),l=ot(),d=Re(),o=Ft(),i=Ra(l),v=(h,S)=>h?h.startsWith("http")?h:`${d.baseUrl||window.location.origin}/api/static/images/${h}`:S,u=te(()=>{const h=o.settings,S=v(h.webPanelStyleLightBackground,ja),A=v(h.webPanelStyleDarkBackground,Ka);return{"--bg-img-light":`url('${S}')`,"--bg-img-dark":`url('${A}')`,"--bg-op-light":h.webPanelStyleLightBackgroundOpacity,"--bg-op-dark":h.webPanelStyleDarkBackgroundOpacity,"--comp-op-light":h.webPanelStyleLightComponentsOpacity,"--comp-op-dark":h.webPanelStyleDarkComponentsOpacity,"--term-blur-light":`${h.webpPanelTerminalBlurLight??5}px`,"--term-blur-dark":`${h.webpPanelTerminalBlurDark??5}px`}}),c=te(()=>l.enableCustomTheme),_=te(()=>[{"t-layout--with-sider":l.showSidebar}]);return xe(()=>{o.fetchSettings()}),ke(()=>n.path,()=>{document.querySelector(`.${Me}-layout`).scrollTo({top:0,behavior:"smooth"})}),(h,S)=>{const A=p("t-aside"),z=p("t-header"),w=p("t-content"),g=p("t-layout");return r(),C("div",{class:ye(["global-layout-bg",{"custom-theme-enabled":c.value}]),style:dt(u.value)},[b(i).layout.value==="side"?(r(),K(g,{key:"side",class:ye(_.value)},{default:a(()=>[e(A,null,{default:a(()=>[e(is)]),_:1}),e(g,null,{default:a(()=>[e(z,null,{default:a(()=>[e(os)]),_:1}),e(w,null,{default:a(()=>[e(rs)]),_:1})]),_:1})]),_:1},8,["class"])):(r(),K(g,{key:"no-side"},{default:a(()=>[e(z,null,{default:a(()=>[e(os)]),_:1}),e(g,{class:ye(_.value)},{default:a(()=>[e(is),e(rs)]),_:1},8,["class"])]),_:1})),e(Da)],6)}}}),ct=re(Wo,[["__scopeId","data-v-1da4b111"]]),Xo=[{path:"/dashboard",redirect:"/dashboard/base",component:ct,name:"dashboard",meta:{title:"仪表盘",icon:"dashboard"},children:[{path:"base",name:"DashboardBaseIndex",component:()=>He(()=>Promise.resolve().then(()=>Ji),void 0),meta:{title:"仪表盘",hidden:!0}}]},{path:"/instance",component:ct,name:"instance",meta:{title:"服务端管理",icon:"server"},children:[{path:"list",name:"InstanceList",component:()=>He(()=>Promise.resolve().then(()=>vu),void 0),meta:{title:"服务端列表",icon:"grid-view"}},{path:"create",name:"InstanceCreate",component:()=>He(()=>Promise.resolve().then(()=>yc),void 0),meta:{title:"创建服务端",icon:"add"}},{path:"backup",name:"InstanceBackupManager",component:()=>He(()=>Promise.resolve().then(()=>Oc),void 0),meta:{title:"备份管理",icon:"backup"}}]},{path:"/frp",component:ct,name:"frp",meta:{title:"隧道管理",icon:"rocket"},children:[{path:"list",name:"FrpList",component:()=>He(()=>Promise.resolve().then(()=>Em),void 0),meta:{title:"隧道列表",icon:"format-vertical-align-left"}},{path:"create",name:"FrpCreate",component:()=>He(()=>Promise.resolve().then(()=>mv),void 0),meta:{title:"创建隧道",icon:"add"}}]}],Qo=Object.freeze(Object.defineProperty({__proto__:null,default:Xo},Symbol.toStringTag,{value:"Module"})),Yo=[{path:"/frp/console",component:ct,meta:{hidden:!0},children:[{path:":frpId",name:"FrpConsole",component:()=>He(()=>Promise.resolve().then(()=>n1),void 0),meta:{title:"隧道控制台",hidden:!0,activeMenu:"/frp/list"}}]},{path:"/instance/console",component:ct,meta:{hidden:!0},children:[{path:":serverId",name:"InstanceConsole",component:()=>He(()=>Promise.resolve().then(()=>oy),void 0),meta:{title:"服务器控制台",hidden:!0,activeMenu:"/instance/list"}}]},{path:"/instance/files",component:ct,meta:{hidden:!0},children:[{path:":serverFilesId",name:"InstanceFiles",component:()=>He(()=>Promise.resolve().then(()=>vb),void 0),meta:{title:"文件管理",hidden:!0,activeMenu:"/instance/list"}}]}],Zo=Object.freeze(Object.defineProperty({__proto__:null,default:Yo},Symbol.toStringTag,{value:"Module"})),cs=()=>He(()=>Promise.resolve().then(()=>hb),void 0),er=[{path:"/frame",name:"Frame",component:ct,redirect:"/frame/doc",meta:{icon:"earth",title:"链接"},children:[{path:"MSLX",name:"MSLX",component:cs,meta:{frameSrc:"https://mslx.mslmc.cn",frameBlank:!0,title:"MSLX 文档",icon:"book"}},{path:"MSLUser",name:"MSLUser",component:cs,meta:{frameSrc:"https://user.mslmc.net",frameBlank:!0,title:"MSL 用户中心",icon:"user-arrow-left"}}]}],tr=Object.freeze(Object.defineProperty({__proto__:null,default:er},Symbol.toStringTag,{value:"Module"})),ar=[{path:"/users",component:ct,name:"usersBase",meta:{title:"用户管理",icon:"user"},children:[{path:"",name:"users",component:()=>He(()=>Promise.resolve().then(()=>Eb),void 0),meta:{title:"用户管理",hidden:!0}}]},{path:"/settings",component:ct,name:"settingsBase",meta:{title:"设置",icon:"setting"},children:[{path:"",name:"settings",component:()=>He(()=>Promise.resolve().then(()=>n0),void 0),meta:{title:"设置",hidden:!0}}]},{path:"/about",component:ct,name:"aboutBase",meta:{title:"关于面板",icon:"info-circle"},children:[{path:"",name:"about",component:()=>He(()=>Promise.resolve().then(()=>l2),void 0),meta:{title:"关于面板",hidden:!0}}]}],sr=Object.freeze(Object.defineProperty({__proto__:null,default:ar},Symbol.toStringTag,{value:"Module"})),ms=Object.assign({"./modules/base.ts":Qo,"./modules/components.ts":Zo,"./modules/iframe.ts":tr,"./modules/others.ts":sr}),Ns=[];Object.keys(ms).forEach(s=>{const n=ms[s].default||{},l=Array.isArray(n)?[...n]:[n];Ns.push(...l)});const Ua=[...Ns],nr=[{path:"/login",name:"login",component:()=>He(()=>Promise.resolve().then(()=>z2),void 0)},{path:"/oauth/callback",name:"oauth",component:()=>He(()=>Promise.resolve().then(()=>Y2),void 0)},{path:"/",redirect:"/dashboard/base"},{path:"/404",name:"404",component:()=>He(()=>Promise.resolve().then(()=>lw),void 0)},{path:"/:w+",name:"404Page",redirect:"/404"}],qs=[...nr,...Ua],lr=()=>{const s=[];return qs.forEach(n=>{n.meta&&n.meta.expanded&&s.push(n.path),n.children&&n.children.length>0&&n.children.filter(l=>l.meta&&l.meta.expanded).forEach(l=>{s.push(n.path),s.push(`${n.path}/${l.path}`)})}),nl(s)},ia=(s=3)=>{const n=mt.currentRoute.value;return n.path?n.meta?.activeMenu?n.meta.activeMenu:n.path.split("/").filter((l,d)=>d<=s&&d>0).map(l=>`/${l}`).join(""):""};function Ie(s){s.includes("http")?window.open(s):mt.replace(s)}const mt=sn({history:nn(),routes:qs,scrollBehavior(){return{el:"#app",top:0,behavior:"smooth"}}});function or(s,n){const l=[],d=[];return s.forEach(o=>{const i=[];o.children?.forEach(v=>{const u=v.meta?.roleCode||v.name;n.indexOf(u)!==-1?i.push(v):d.push(v)}),i.length>0&&(o.children=i,l.push(o))}),{accessedRouters:l,removeRoutes:d}}const Gt=bt("permission",{state:()=>({whiteListRouters:["/login","/oauth/callback"],routers:[],removeRoutes:[],dynamicRoutesAdded:[]}),actions:{async initRoutes(s){this.clearRoutes();let n=[],l=[];if(s.includes("all"))n=Ua;else{const o=or(Ua,s);n=o.accessedRouters,l=o.removeRoutes}const d=[];n.forEach(o=>{mt.addRoute(o),o.name&&d.push(o.name)}),this.routers=n,this.removeRoutes=l,this.dynamicRoutesAdded=d},async clearRoutes(){this.dynamicRoutesAdded.forEach(n=>{mt.hasRoute(n)&&mt.removeRoute(n)}),this.routers=[],this.removeRoutes=[],this.dynamicRoutesAdded=[]}}});function rr(){return Gt(ga)}const ps="remembered_url",vs="remembered_username",wa={name:"",username:"",avatar:"",id:"",version:"",systemInfo:{netVersion:"",osType:"",osVersion:"",osArchitecture:"",hostname:"",docker:!1},targetFrontendVersion:{desktop:"",panel:""},roles:[]},Re=bt("user",{state:()=>({token:localStorage.getItem(Ut)||"",baseUrl:localStorage.getItem(Lt)||window.location.origin,userInfo:{...wa}}),getters:{roles:s=>s.userInfo?.roles||[]},actions:{async checkConnection(s){let n=s;s&&!/^(https?:)?\/\//.test(s)&&(n=`http://${s}`);try{return await X.get({url:"/api/ping",baseURL:n||void 0,timeout:3e3}),!0}catch{return!1}},async login(s){const{url:n,username:l,password:d,checked:o}=s;let i=n;i&&!/^(https?:)?\/\//.test(i)&&(i=`http://${i}`);const v=i||"";try{const u=await X.post({url:"/api/auth/login",baseURL:v,data:{username:l,password:d}});this.token=u.token,this.baseUrl=v,localStorage.setItem(Ut,u.token),localStorage.setItem(Lt,v),o?(localStorage.setItem(ps,n||""),localStorage.setItem(vs,l)):(localStorage.removeItem(ps),localStorage.removeItem(vs)),await this.getUserInfo()}catch(u){throw console.error("Login failed:",u),u}},async loginByOAuth(s){try{this.token=s.token,localStorage.setItem(Ut,s.token),this.baseUrl||(this.baseUrl=window.location.origin,localStorage.setItem(Lt,this.baseUrl)),await this.getUserInfo()}catch(n){throw console.error("OAuth登录失败:",n),n}},async getUserInfo(){if(this.token)try{const s=await X.get({url:"/api/status"});this.userInfo={...wa,...s,name:s.user||s.username,roles:["all"]},await Gt().initRoutes(this.userInfo.roles)}catch(s){console.error("Get user info failed:",s),await this.logout(),Ie("/login")}},async logout(){await Gt().clearRoutes(),localStorage.removeItem(Ut),localStorage.removeItem(Lt),this.token="",this.baseUrl="",this.userInfo={...wa}},async removeToken(){this.token=""}},persist:{afterRestore:s=>{s.store.token&&s.store.getUserInfo()}}});function Gs(){return Re(ga)}const ir={...Ta,showSettingPanel:!1,colorList:xl,chartColors:Ks,systemTheme:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"},ot=bt("setting",{state:()=>ir,getters:{showSidebar:s=>s.layout!=="top",showSidebarLogo:s=>s.layout==="side",showHeaderLogo:s=>s.layout!=="side",displayMode:s=>s.mode==="auto"?s.systemTheme:s.mode},actions:{async changeMode(s){let n=s;s==="auto"&&(n=this.systemTheme);const l=n==="dark";document.documentElement.setAttribute("theme-mode",l?"dark":""),this.chartColors=l?Cl:Ks},setSystemTheme(s){this.systemTheme=s,this.mode==="auto"&&this.changeMode("auto")},changeBrandTheme(s){document.documentElement.setAttribute("theme-color",s)},addColor(s){this.colorList={...this.colorList,...s}},updateConfig(s){for(const n in s)s[n]!==void 0&&(this[n]=s[n]),n==="mode"&&this.changeMode(s[n]),n==="brandTheme"&&this.changeBrandTheme(s[n])}},persist:{paths:[...ll(Ta),"colorList","chartColors"]}});async function ur(){return X.get({url:"/api/update/info"})}async function dr(){return X.get({url:"/api/update/download"})}async function cr(){return X.post({url:"/api/update"})}const qa=bt("update",()=>{const s=$(!1),n=$(null),l=$(null),d=$(!1);return{showUpdateModal:s,updateInfo:n,downloadInfo:l,loading:d,checkAppUpdate:async(v=!1)=>{if(!d.value){d.value=!0;try{const c=await ur();if(c&&c.needUpdate){if(!v&&localStorage.getItem("mslx-skip-version")===c.latestVersion){console.log(`[Update] 用户已跳过版本 ${c.latestVersion}`);return}n.value=c;try{const _=await dr();l.value=_}catch(_){console.error("获取下载链接失败",_),l.value={web:"",file:""}}s.value=!0,v&&L.success("发现新版本！")}else v&&L.success("当前已是最新版本")}catch(u){console.error("[Update] 检查更新失败:",u),v&&L.error("检查更新失败，请检查网络日志")}finally{d.value=!1}}},handleSkipVersion:()=>{n.value?.latestVersion&&(localStorage.setItem("mslx-skip-version",n.value.latestVersion),L.success("已跳过该版本，下次将不再提醒"),s.value=!1)}}}),ga=ln();ga.use(on());Kt.configure({showSpinner:!1});mt.beforeEach(async(s,n,l)=>{window.document.title=s.meta.title?`${s.meta.title} | MSLX 控制台`:"MSLX 控制台",Kt.start();const d=Gs(),o=rr(),{whiteListRouters:i}=o,{token:v}=d;if(v){if(s.path==="/login"||s.path==="/oauth/callback"){l();return}const{roles:u}=d;if(u&&u.length>0)l();else try{await d.getUserInfo();const{roles:c}=d;await o.initRoutes(c),mt.hasRoute(s.name)?l():l("/")}catch(c){L.error(c),l({path:"/login",query:{redirect:encodeURIComponent(s.fullPath)}}),Kt.done()}}else i.indexOf(s.path)!==-1?l():l({path:"/login",query:{redirect:encodeURIComponent(s.fullPath)}}),Kt.done()});mt.afterEach(s=>{s.path==="/login"&&Gs().logout(),Kt.done()});const mr={class:"modal-header"},pr={class:"header-content"},vr={class:"title-row"},fr={class:"version-row"},gr={class:"modal-body"},_r={key:0,class:"status-container success"},hr={key:1,class:"status-container docker-warn"},yr={key:2,class:"status-container server-running-warn"},br={class:"warn-icon-wrapper"},wr={key:3,class:"status-container permission-wait"},kr={key:4,class:"status-container updating"},$r={key:0,class:"error-box"},Ar={class:"progress-info"},xr={class:"speed"},Cr={key:5},Sr={style:{margin:"4px 0 0 0","line-height":"1.6"}},Ir={class:"log-scroll-area"},Vr={class:"log-text"},Mr={key:0,class:"modal-footer"},Ur={class:"primary-actions"},Lr={class:"secondary-grid"},Br={key:0,class:"sub-actions"},Rr={key:1,class:"modal-footer"},zr={key:2,class:"modal-footer"},Er={key:3,class:"modal-footer"},Pr={class:"primary-actions"},Fr=ne({__name:"UpdateModal",props:{visible:{type:Boolean},updateInfo:{},downloadInfo:{}},emits:["close","skip","success"],setup(s,{emit:n}){const l=s,d=n,o=Re(),i=$(!1),v=$(0),u=$("0 KB/s"),c=$("准备中..."),_=$(!1),h=$(!1),S=$(!1),A=$("");let z=null;const w=te(()=>l.updateInfo?.status==="beta"),g=te(()=>{const P=o.userInfo?.systemInfo?.osType||"";return P.includes("macOS")||P.includes("OSX")}),U=te(()=>(o.userInfo?.systemInfo?.osType||"").toLowerCase().includes("linux")),I=P=>{P&&window.open(P,"_blank")},m=()=>{d("close"),Ie("/instance/list")},x=()=>{if(i.value&&!S.value){L.warning("正在更新中，请勿关闭窗口");return}T(),d("close")},y=()=>{d("skip")},E=()=>{window.location.reload()},T=async()=>{if(z){try{await z.stop()}catch(P){console.error("Stop Hub Error:",P)}z=null}},V=async()=>{await T();const{baseUrl:P,token:k}=o,B=new URL("/api/hubs/daemonUpdate",P||window.location.origin);k&&B.searchParams.append("x-user-token",k),z=new It().withUrl(B.toString(),{withCredentials:!1}).configureLogging(Et.Warning).withAutomaticReconnect([0,2e3,5e3,1e4]).build(),z.on("UpdateProgress",R=>{v.value=R.progress||0,u.value=R.speed||"",R.stage==="permission_check"?c.value="等待服务端确认权限...":R.stage==="restarting"?(console.log("[Update] 收到重启信号，准备轮询..."),c.value="服务正在重启...",T(),setTimeout(()=>{q()},3e3)):c.value=R.status||"正在处理..."}),z.on("UpdateFailed",R=>{i.value=!1,A.value=R||"更新失败",T()}),z.onclose(R=>{z&&(i.value&&v.value>=100?setTimeout(()=>{q()},6e3):R&&(i.value=!1,A.value=`连接断开: ${R.message}`))});try{await z.start()}catch(R){A.value=`连接更新服务失败: ${R.message}`,i.value=!1}},N=async()=>{if(!i.value){i.value=!0,_.value=!1,h.value=!1,A.value="",v.value=0,S.value=!1,await V();try{await cr()}catch(P){i.value=!1,T();const k=P.message||"";k.includes("Docker")||k.includes("容器")?_.value=!0:k.includes("运行")&&(k.includes("服务器")||k.includes("实例"))?h.value=!0:A.value=k||"请求更新失败，请检查网络或日志"}}},q=async()=>{c.value="服务正在重启，请稍候...";const P=async()=>{try{return await X.get({url:"/api/ping",timeout:3e3}),!0}catch{return!1}},k=60;let B=0;const R=setInterval(async()=>{B++,await P()?(clearInterval(R),i.value=!1,S.value=!0,c.value="更新成功！",T(),setTimeout(()=>d("success"),1e3)):B>k&&(clearInterval(R),i.value=!1,A.value="服务重启超时，请手动刷新页面检查状态。",T())},2e3)};return Qe(()=>{T()}),(P,k)=>{const B=p("t-tag"),R=p("t-button"),Z=p("t-link"),J=p("t-alert"),W=p("t-progress"),H=p("t-popconfirm"),$e=p("t-dialog");return r(),K($e,{visible:l.visible,header:!1,footer:!1,"close-on-overlay-click":!1,"close-btn":!1,width:"500px",class:"update-modal","destroy-on-close":"",onClose:x},{default:a(()=>[t("div",mr,[t("div",pr,[t("div",vr,[t("h3",null,M(S.value?"更新完成":"发现新版本"),1),w.value?(r(),K(B,{key:0,theme:"warning",variant:"light"},{default:a(()=>[...k[2]||(k[2]=[f("Beta",-1)])]),_:1})):(r(),K(B,{key:1,theme:"success",variant:"light"},{default:a(()=>[...k[3]||(k[3]=[f("Release",-1)])]),_:1}))]),t("div",fr,[e(B,{variant:"outline",size:"small"},{default:a(()=>[f(M(s.updateInfo?.currentVersion),1)]),_:1}),k[4]||(k[4]=t("span",{class:"arrow"},"→",-1)),e(B,{theme:"primary",variant:"light-outline",size:"small"},{default:a(()=>[f(M(s.updateInfo?.latestVersion),1)]),_:1})])]),i.value?O("",!0):(r(),K(R,{key:0,variant:"text",shape:"circle",onClick:x},{icon:a(()=>[e(b(za))]),_:1}))]),t("div",gr,[S.value?(r(),C("div",_r,[e(b(xt),{size:"48px",class:"success-icon"}),k[5]||(k[5]=t("p",null,[t("b",null,"MSLX守护进程端"),f("已成功更新至最新版本")],-1)),k[6]||(k[6]=t("p",{class:"sub-text"},"请刷新页面以加载最新功能",-1))])):_.value?(r(),C("div",hr,[e(J,{theme:"warning",title:"检测到 Docker 环境"},{message:a(()=>[k[8]||(k[8]=f(" 当前程序运行在 ",-1)),k[9]||(k[9]=t("b",null,"Docker 容器",-1)),k[10]||(k[10]=f(" 内，不支持热更新。",-1)),k[11]||(k[11]=t("br",null,null,-1)),k[12]||(k[12]=f("请使用以下命令或者参照 ",-1)),k[13]||(k[13]=t("b",null,"官方文档",-1)),k[14]||(k[14]=f(" 更新。",-1)),k[15]||(k[15]=t("br",null,null,-1)),e(Z,{theme:"primary",href:"https://mslx.mslmc.cn/docs/install/docker/",target:"_blank",style:{"vertical-align":"baseline"}},{default:a(()=>[...k[7]||(k[7]=[t("b",null,"Docker安装/更新文档",-1)])]),_:1})]),_:1}),k[16]||(k[16]=t("div",{class:"code-block"}," docker pull docker.mslmc.cn/xiaoyululu/mslx-daemon:latest && docker-compose up -d # 指令仅适用于Docker Compose安装方式。 ",-1))])):h.value?(r(),C("div",yr,[t("div",br,[e(b(da),{size:"48px",style:{color:"var(--td-warning-color)"}})]),k[17]||(k[17]=t("p",{class:"warn-title"},"无法开始更新",-1)),k[18]||(k[18]=t("p",{class:"warn-desc"},[f(" 检测到当前有服务器实例正在运行。 "),t("br"),f("为了防止数据丢失，请先停止所有实例。 ")],-1))])):c.value.includes("等待服务端确认权限")?(r(),C("div",wr,[...k[19]||(k[19]=[t("p",{class:"warn-title"},"请在服务端确认权限",-1),t("p",{class:"warn-desc"},[f(" macOS 系统已弹出提示： "),t("br"),t("strong",null,"“MSLX-Daemon 想要控制应用程序 终端.app”"),f(),t("br"),f("请务必点击 "),t("strong",null,"【好/OK】"),f(" 以继续更新。 ")],-1)])])):i.value||A.value?(r(),C("div",kr,[A.value?(r(),C("div",$r,[e(b(As),{style:{color:"var(--td-error-color)"}}),t("span",null,M(A.value),1)])):(r(),C(pe,{key:1},[t("div",Ar,[t("span",null,M(c.value),1),t("span",xr,M(u.value),1)]),e(W,{theme:"plump",percentage:v.value,status:v.value>=100?"active":"success"},null,8,["percentage","status"])],64))])):(r(),C("div",Cr,[g.value?(r(),K(J,{key:0,theme:"warning",variant:"outline",class:"macos-alert"},{message:a(()=>[...k[20]||(k[20]=[t("strong",null,"macOS 用户请注意：",-1),t("br",null,null,-1),f("受 Apple 安全机制 (Gatekeeper) 限制，更新重启后应用可能无法自动启动。如遇此情况，请前往「系统设置 > 隐私与安全性」手动允许应用运行。 ",-1)])]),_:1})):O("",!0),U.value?(r(),K(J,{key:1,theme:"info",variant:"outline",class:"macos-alert"},{message:a(()=>[k[26]||(k[26]=t("strong",null,"Linux 用户提示：",-1)),t("ul",Sr,[t("li",null,[k[22]||(k[22]=f(" 如使用一键脚本部署，推荐优先参考 ",-1)),e(Z,{theme:"primary",href:"https://mslx.mslmc.cn/docs/install/linux/",target:"_blank",style:{"vertical-align":"baseline"}},{default:a(()=>[...k[21]||(k[21]=[f(" 官方文档 ",-1)])]),_:1}),k[23]||(k[23]=f(" 使用脚本进行更新。 ",-1))]),k[24]||(k[24]=t("li",null,[f(" 若启用 "),t("strong",null,"Systemd"),f(" 托管，请确保服务名称为 "),t("code",null,"mslx"),f("，否则自动更新后可能无法自动重启。 ")],-1)),k[25]||(k[25]=t("li",null,"如果更新完成后仍然是旧版本，请尝试手动重启服务或手动更新！",-1))])]),_:1})):O("",!0),k[27]||(k[27]=t("div",{class:"log-title"},"更新内容：",-1)),t("div",Ir,[t("div",Vr,M(s.updateInfo?.log||"暂无详细日志"),1)])]))]),!S.value&&!_.value&&!h.value?(r(),C("div",Mr,[t("div",Ur,[e(R,{theme:"primary",block:"",loading:i.value,disabled:i.value,onClick:N},{icon:a(()=>[e(b(xs))]),default:a(()=>[f(" "+M(i.value?"正在更新...":"立即更新"),1)]),_:1},8,["loading","disabled"]),t("div",Lr,[e(R,{variant:"outline",disabled:!s.downloadInfo?.file||i.value,onClick:k[0]||(k[0]=Te=>I(s.downloadInfo?.file||""))},{icon:a(()=>[e(b(ca))]),default:a(()=>[k[28]||(k[28]=f(" 下载新版本 ",-1))]),_:1},8,["disabled"]),e(R,{variant:"dashed",disabled:!s.downloadInfo?.web||i.value,onClick:k[1]||(k[1]=Te=>I(s.downloadInfo?.web||""))},{icon:a(()=>[e(b(Ct))]),default:a(()=>[k[29]||(k[29]=f(" 前往下载页 ",-1))]),_:1},8,["disabled"])])]),i.value?O("",!0):(r(),C("div",Br,[e(H,{content:"确定要跳过此版本吗？跳过后将不再提示该版本的更新。若跳过后需要更新也可以前往设置页面进行更新哦~",theme:"warning",onConfirm:y},{default:a(()=>[e(Z,{theme:"default",hover:"color",size:"small"},{default:a(()=>[...k[30]||(k[30]=[f(" 跳过此版本 ",-1)])]),_:1})]),_:1})]))])):O("",!0),S.value?(r(),C("div",Rr,[e(R,{theme:"primary",block:"",onClick:E},{default:a(()=>[...k[31]||(k[31]=[f("刷新页面",-1)])]),_:1})])):O("",!0),_.value?(r(),C("div",zr,[e(R,{variant:"outline",block:"",onClick:x},{default:a(()=>[...k[32]||(k[32]=[f("我知道了",-1)])]),_:1})])):O("",!0),h.value?(r(),C("div",Er,[t("div",Pr,[e(R,{theme:"primary",block:"",onClick:m},{default:a(()=>[...k[33]||(k[33]=[f(" 前往实例列表管理 ",-1)])]),_:1}),e(R,{variant:"outline",style:{"margin-left":"0"},block:"",onClick:x},{default:a(()=>[...k[34]||(k[34]=[f(" 暂不更新 ",-1)])]),_:1})])])):O("",!0)]),_:1},8,["visible"])}}}),Tr=re(Fr,[["__scopeId","data-v-79a43047"]]),Dr=ne({__name:"App",setup(s){const n=ot(),l=qa(),d=te(()=>n.displayMode),o=window.matchMedia("(prefers-color-scheme: dark)"),i=v=>{n.setSystemTheme(v.matches?"dark":"light")};return xe(()=>{l.checkAppUpdate(!1),o.addEventListener("change",i),n.setSystemTheme(o.matches?"dark":"light")}),Qe(()=>{o.removeEventListener("change",i)}),(v,u)=>{const c=p("router-view");return r(),C(pe,null,[e(c,{class:ye([d.value])},null,8,["class"]),e(Tr,{visible:b(l).showUpdateModal,"update-info":b(l).updateInfo,"download-info":b(l).downloadInfo,onClose:u[0]||(u[0]=_=>b(l).showUpdateModal=!1),onSkip:b(l).handleSkipVersion},null,8,["visible","update-info","download-info","onSkip"])],64)}}}),Or=re(Dr,[["__scopeId","data-v-579b9e12"]]),_a=rn(Or);_a.use(un);_a.use(ga);_a.use(mt);_a.mount("#app");console.log(`
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣤⣤⣶⣶⣤⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣴⣾⠿⠛⠋⠉⠩⣄⠘⢿⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⣿⡏⠑⠒⠀⠀⣀⣀⠀⠀⢹⠈⣿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣿⣷⡀⢀⣰⣿⡿⣿⣧⠀⠀⢡⣾⣧⣀⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⣿⣿⣿⣿⣯⣴⣿⠿⣄⣤⣾⡿⠟⠛⠛⠿⢿⣶⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣴⣶⠿⠛⠋⠙⣿⣏⠀⠀⢻⣿⣡⣀⣀⠀⠀⠀⠀⢹⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣾⠿⠋⠁⠀⣀⣤⣶⣾⣿⣿⣤⣤⣾⣿⠉⠉⠙⠻⣿⠆⢀⣾⡿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⡿⠋⠁⠀⣀⣴⣿⠿⠛⠉⠀⢀⣿⡿⠿⠟⢿⣆⠀⢀⣴⣯⣴⣿⠟⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⣠⡾⠋⠀⠀⣠⣾⠟⠋⠀⠀⠀⠀⠀⣈⣿⣷⣤⣴⣾⣿⣈⣻⣿⡟⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⣰⡿⠁⠀⣠⡾⠋⠁⠀⠀⢀⣠⣴⠶⠞⠛⠛⠋⠉⠉⠉⠉⠙⠛⠻⠷⣦⣤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠰⣿⠁⠀⠀⣿⣄⣀⣠⣴⡾⠛⠉⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⣿⠿⣶⣄⠀⠀⠀⢀⣠⡄⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠈⠛⠶⠶⢾⣿⠿⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢷⣄⠉⠙⠻⠿⠟⢹⡇⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⠟⠁⠀⠀⠀⠀⠀⠀⠀⢀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣄⠀⠀⠀⠀⠘⣿⣿⣦⣀⠀⠲⣾⣁⠀⠀⠀⠀⠀⡀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⢀⡾⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢹⣦⡀⠀⠀⠀⣿⡿⣿⣿⣿⡆⠀⠉⠛⠛⠛⠛⢻⡏⠀
⠀⠀⠀⠀⠀⠀⠀⣠⡾⠁⠀⠀⠀⠀⠀⠀⠀⠀⢀⡄⣸⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⣿⠛⢦⡀⠰⣿⣿⣿⣽⣿⡇⠀⠀⠀⠀⠀⢠⡿⠀⠀
⠀⠀⠀⠀⣀⣤⡾⢻⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠀⡏⠙⣷⡀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡇⠰⣽⣶⣄⠉⠻⣿⣿⣧⠀⠀⢀⣤⣾⠟⠁⠀⠀
⢰⣶⡾⠛⠋⠉⠀⠀⠀⠀⠀⢀⡀⠀⠀⠀⠀⠀⢸⣸⡇⠀⣨⣿⣾⡋⠀⠀⠀⠀⢀⠀⠀⣿⡀⠀⠈⠛⢷⣄⠈⠛⣿⡆⠀⠘⣿⡀⠀⠀⠀⠀
⠀⠙⠿⣦⣀⠀⠀⠀⠀⠀⠀⡾⠀⠀⠀⠀⠀⠀⣿⣿⠀⠀⠋⠀⠙⢿⣦⣀⠀⠀⠘⣷⣄⣹⣧⠀⠀⠀⠈⢻⣦⠀⠈⠋⠀⠀⠘⣧⠀⠀⠀⠀
⠀⠀⠀⠈⠛⠿⢶⡶⠃⠀⣰⠃⠀⠀⠀⠀⠀⢠⣿⠃⠀⠀⠀⠀⠀⠀⠉⠻⢷⣦⣤⣘⣿⡛⠛⠀⢀⣴⣶⣦⡹⣷⡀⠀⠀⠀⠀⠸⣧⠀⠀⠀
⠀⠀⠀⠀⠀⢠⡿⠃⠀⢀⡟⠀⠀⠀⠀⠀⠀⣼⣿⠀⠀⢀⣴⣿⣿⣷⡄⠀⠀⠈⠉⠉⠉⠉⠀⠀⢸⣿⣿⣿⣷⠻⣧⠀⠀⠀⠀⠀⢿⡆⠀⠀
⠀⠀⠀⠀⢰⣿⠁⠀⠀⢸⠁⠀⠀⠀⠀⠀⠈⠋⣿⠀⠀⠸⣿⣿⣿⣿⡷⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠛⠿⠟⠃⠀⢻⣧⠀⠀⠀⠀⠸⣧⠀⠀
⠀⠀⠀⠀⣿⡇⠀⠀⠀⣿⠀⠀⠀⠀⠀⠀⠀⠀⣿⠀⠀⠀⠉⠻⠿⠋⠀⠀⢠⡀⠀⠀⣀⣀⣀⣸⠇⠀⠀⠀⠀⠀⠈⢿⣧⠀⠀⠀⠀⣿⡀⠀
⠀⠀⠀⢰⣿⠁⠀⠀⢰⡏⠀⠀⠀⠀⠀⠀⠀⠀⢿⡀⠀⠀⠀⠀⠀⣸⠀⠀⠈⠛⠒⠛⠉⠈⠉⠀⠀⠀⠀⠀⠀⠀⠀⢸⡟⠀⠀⠀⠀⢸⡇⠀
⠀⠀⠀⢸⣿⠀⠀⠀⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⢸⡇⠀⠀⠀⠀⠚⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣿⠁⠀⠀⠀⠀⢸⣿⠀
⠀⠀⠀⢸⣿⠀⠀⠀⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⠘⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣀⣀⣀⣤⣶⡿⠋⣿⠀⠀⠀⠀⠀⠀⣿⠀
⠀⠀⠀⠘⣿⡄⠀⠀⢸⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀⢿⣧⣄⣀⣀⣀⣠⣤⣶⣶⣾⣿⣿⣿⣿⠿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠀⠀⣠⠀⠀⢠⣿⡄
⠀⠀⠀⠀⢻⣧⠀⠀⠸⣿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠈⣿⣿⣿⣟⠛⢻⡟⢻⡉⠉⣫⣀⠀⠀⠀⠉⠉⠛⠙⠿⣷⣿⡿⠁⢀⣰⡟⠀⠀⢸⣿⠀
⠀⠀⠀⠀⠈⢻⣧⡀⠀⠹⣷⡀⠀⠀⠀⠀⢠⠀⠀⠀⠘⣿⣿⣿⢻⡿⠀⠈⠷⠟⠁⠘⢾⣿⣶⣤⣶⣾⡇⠀⣿⣿⣤⣶⣿⣿⠃⠀⠀⣾⡟⠀
⠀⠀⠀⠀⠀⠈⠻⣷⣄⡀⠹⣷⣄⠀⠀⠀⢸⣷⣤⡀⠀⠈⢻⣿⣯⣤⠀⠀⣠⡀⠀⢀⣼⣿⣿⣿⣿⣟⠁⠐⠿⣿⣿⣿⣿⠋⠀⢀⣾⠟⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠈⠙⠿⣷⣮⣽⣷⣶⣤⣤⣿⣿⣿⣷⣶⣦⣭⣿⣿⣧⣠⠵⢯⡆⠚⣯⢿⠋⠛⠛⢫⣀⣠⣾⣿⢿⣿⣥⣤⠶⠛⠁⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠉⠉⢁⣾⣿⣿⣿⠿⠿⠿⠿⠻⢿⣿⣿⣷⣦⣤⣤⣀⣤⣤⣄⣶⣿⣿⡿⠟⠉⠀⠀⢻⡄⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣴⣿⣿⣿⣿⣿⡇⠀⠀⣀⡀⠈⢿⣧⠀⠉⠙⠛⠛⠛⠛⠛⠛⠉⠁⠀⠀⠀⠀⠀⠀⢿⡄⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣴⣿⣿⡏⠛⠉⢻⣿⣿⣿⣾⣿⣿⠀⢸⣿⠀⠀⠀⠀⠀⠙⠓⠢⠀⠀⠀⠀⠀⠸⠀⠀⠀⠘⣿⡄⠀⠀⠀⠀⠀`);console.log("人生得意须尽吃，莫使金箸空对月。 —— 派蒙");const jr={class:"welcome-header"},Kr={class:"avatar-section"},Nr=["src"],qr={class:"welcome-info"},Gr={class:"welcome-text"},Hr={class:"hitokoto-text"},Jr=ne({__name:"Banner",setup(s){const n=Re(),l=$("");async function d(){const o=`Every little creature in the world has their own piece of paradise.
Plants take root in the boundless earth, and their leaves grow toward the stars.`;try{const i=await X.get({url:"/?c=a&c=b&c=c&c=d",baseURL:"https://v1.hitokoto.cn"});i&&i.hitokoto?l.value=`${i.hitokoto} —— 《${i.from}》${i.from_who?` (${i.from_who})`:""}`:l.value=o}catch(i){l.value=o,console.error("获取一言(Hitokoto)失败:",i)}}return xe(()=>{d()}),(o,i)=>(r(),K(b(Ea),{shadow:"",bordered:!1,class:"welcome-card"},{default:a(()=>[t("div",jr,[t("div",Kr,[t("img",{src:b(n).userInfo.avatar,alt:"头像",class:"user-avatar"},null,8,Nr)]),t("div",qr,[t("h3",Gr,[e(b(ut),{name:"sunny",class:"welcome-icon"}),f(" 你好, "+M(b(n).userInfo.name),1)]),t("p",Hr,M(l.value),1)])])]),_:1}))}}),Wr=re(Jr,[["__scopeId","data-v-bfba57a3"]]),Xr=Re();async function Ga(s){return await X.post({url:"/api/instance/createServer",data:s})}async function Qr(s,n=!1){return await X.post({url:"/api/instance/delete",data:{id:s,deleteFiles:n}})}async function Yr(){return await X.get({url:"/api/instance/list"})}async function Mt(s,n){return await X.post({url:"/api/instance/action",data:{id:s,action:n},timeout:60*1e3})}async function Hs(s){return await X.get({url:"/api/instance/info",params:{id:s}})}async function Zr(s){return await X.get({url:`/api/instance/settings/general/${s}`})}async function ei(s){return await X.post({url:`/api/instance/settings/general/${s.id}`,data:s})}async function ti(s){return await X.get({url:`/api/instance/backups/${s}`})}async function ai(){return await X.get({url:"/api/instance/backups/all"})}async function La(s,n){return await X.post({url:"/api/instance/backups/delete",data:{id:s,fileName:n}})}function Ba(s,n){const{baseUrl:l,token:d}=Xr;return`${l||window.location.origin}/api/instance/backups/download?id=${s}&fileName=${encodeURIComponent(n)}&x-user-token=${d}`}const ea=bt("instanceList",()=>{const s=$([]),n=$(0),l=$(0);async function d(){try{s.value=await Yr(),n.value=s.value.length,l.value=s.value.filter(o=>o.status).length}catch(o){L.error("获取实例列表失败:"+o.message)}}return{instanceList:s,refreshInstanceList:d,totalInstanceCount:n,onlineInstanceCount:l}}),si={class:"info-grid"},ni={class:"info-item"},li={class:"info-label"},oi={class:"info-value"},ri={class:"info-item"},ii={class:"info-label"},ui={class:"info-value"},di={class:"info-item"},ci={class:"info-label"},mi={class:"info-value truncate-value"},pi={class:"info-item"},vi={class:"info-label"},fi={class:"info-value truncate-value"},gi={class:"info-item"},_i={class:"info-label"},hi={class:"info-value truncate-value"},yi={class:"info-item"},bi={class:"info-label"},wi={class:"info-value"},ki={class:"info-item"},$i={class:"info-label"},Ai={class:"info-value truncate-value"},xi={class:"info-item"},Ci={class:"info-label"},Si={class:"info-value"},Ii=ne({__name:"InfoCard",setup(s){const n=Re(),l=ea();return xe(()=>{l.refreshInstanceList()}),(d,o)=>(r(),K(b(Ea),{shadow:"",bordered:!1,class:"system-info-card"},{default:a(()=>[t("div",si,[t("div",ni,[t("span",li,[e(b(ut),{name:"server"}),o[0]||(o[0]=t("span",null,"在线实例：",-1))]),t("span",oi,M(b(l).onlineInstanceCount)+" / "+M(b(l).totalInstanceCount),1)]),t("div",ri,[t("span",ii,[e(b(ut),{name:"logo-codepen"}),o[1]||(o[1]=t("span",null,"NET环境：",-1))]),t("span",ui,M(b(n).userInfo.systemInfo.netVersion),1)]),t("div",di,[t("span",ci,[e(b(ut),{name:"dashboard"}),o[2]||(o[2]=t("span",null,"面板版本：",-1))]),e(b(ba),{content:b(Ot).version,"max-width":"400px"},{default:a(()=>[t("span",mi," v"+M(b(Ot).version),1)]),_:1},8,["content"])]),t("div",pi,[t("span",vi,[e(b(ut),{name:"cloud"}),o[3]||(o[3]=t("span",null,"节点版本：",-1))]),e(b(ba),{content:`v${b(n).userInfo.version}`,"max-width":"400px"},{default:a(()=>[t("span",fi," v"+M(b(n).userInfo.version),1)]),_:1},8,["content"])]),t("div",gi,[t("span",_i,[e(b(ut),{name:"desktop"}),o[4]||(o[4]=t("span",null,"主机名：",-1))]),t("span",hi,M(b(n).userInfo.systemInfo.hostname),1)]),t("div",yi,[t("span",bi,[e(b(ut),{name:"system-code"}),o[5]||(o[5]=t("span",null,"系统类型：",-1))]),t("span",wi,M(b(n).userInfo.systemInfo.osType)+" ("+M(b(n).userInfo.systemInfo.osArchitecture)+")",1)]),t("div",ki,[t("span",$i,[e(b(ut),{name:"system-setting"}),o[6]||(o[6]=t("span",null,"系统版本：",-1))]),e(b(ba),{content:b(n).userInfo.systemInfo.osVersion,"max-width":"400px"},{default:a(()=>[t("span",Ai,M(b(n).userInfo.systemInfo.osVersion),1)]),_:1},8,["content"])]),t("div",xi,[t("span",Ci,[e(b(ut),{name:"check-circle"}),o[7]||(o[7]=t("span",null,"版本匹配：",-1))]),t("span",Si,[e(b(dn),{theme:b(Ot).version.startsWith(b(n).userInfo.targetFrontendVersion.panel)?"success":"danger",variant:"light"},{default:a(()=>[f(M(b(Ot).version.startsWith(b(n).userInfo.targetFrontendVersion.panel)?"正确匹配":"请更新"),1)]),_:1},8,["theme"])])])])]),_:1}))}}),Vi=re(Ii,[["__scopeId","data-v-00dad172"]]),Mi={class:"monitor-dashboard"},Ui={class:"card-content"},Li={class:"info-section"},Bi={class:"value-group"},Ri={class:"value"},zi={class:"card-content"},Ei={class:"info-section"},Pi={class:"value-group"},Fi={class:"value"},Ti={class:"sub-text"},Di=30,Oi=ne({__name:"SystemStatus",setup(s){const n=Re(),l=$(null),d=$(!1),o=$(null),i=$(null);let v=null,u=null;const c=Xe({cpu:0,memUsage:0,memUsed:0,memTotal:0}),_=[],h=[],S=[],A=I=>getComputedStyle(document.documentElement).getPropertyValue(I).trim()||"#999999",z=(I,m,x)=>({grid:{top:10,right:10,bottom:0,left:0,containLabel:!1},tooltip:{trigger:"axis",backgroundColor:"var(--td-bg-color-container)",borderColor:"var(--td-component-border)",textStyle:{color:"var(--td-text-color-primary)"},formatter:y=>{const E=y[0];return`${E.name}<br/><span style="color:${I}">●</span> ${m}: <b>${E.value}%</b>`}},xAxis:{type:"category",boundaryGap:!1,data:_,show:!1},yAxis:{type:"value",max:100,min:0,show:!1},series:[{name:m,type:"line",smooth:!0,showSymbol:!1,lineStyle:{width:2,color:I},areaStyle:{opacity:.2,color:new js(0,0,0,1,[{offset:0,color:I},{offset:1,color:"transparent"}])},data:x}]}),w=()=>{const I=A("--td-brand-color"),m=A("--td-success-color");o.value&&(v=ra(o.value),v.setOption(z(I,"CPU",[]))),i.value&&(u=ra(i.value),u.setOption(z(m,"Memory",[]))),window.addEventListener("resize",g)},g=()=>{v?.resize(),u?.resize()},U=async()=>{const{baseUrl:I,token:m}=n,x=new URL("/api/hubs/system",I||window.location.origin);m&&x.searchParams.append("x-user-token",m),l.value=new It().withUrl(x.toString(),{withCredentials:!1}).withAutomaticReconnect().build(),l.value.on("ReceiveSystemStats",y=>{c.cpu=y.cpu,c.memUsage=y.memUsage,c.memUsed=y.memUsed,c.memTotal=y.memTotal,_.length>=Di&&(_.shift(),h.shift(),S.shift()),_.push(y.timestamp),h.push(y.cpu),S.push(y.memUsage),v?.setOption({xAxis:{data:_},series:[{data:h}]}),u?.setOption({xAxis:{data:_},series:[{data:S}]})});try{await l.value.start(),d.value=!0,await l.value.invoke("JoinMonitor")}catch(y){console.error("SignalR 连接失败:",y)}l.value.onclose(()=>{d.value=!1})};return xe(()=>{yt(()=>{setTimeout(()=>{w(),U()},100)})}),Qe(async()=>{if(window.removeEventListener("resize",g),l.value)try{await l.value.invoke("LeaveMonitor"),await l.value.stop()}catch(I){console.error(I)}v?.dispose(),u?.dispose()}),(I,m)=>{const x=p("t-tag"),y=p("t-card"),E=p("t-col"),T=p("t-row");return r(),C("div",Mi,[e(T,{gutter:[12,12]},{default:a(()=>[e(E,{xs:12,md:6},{default:a(()=>[e(y,{shadow:"",bordered:!1,class:"chart-card",size:"small"},{default:a(()=>[t("div",Ui,[t("div",Li,[m[3]||(m[3]=t("div",{class:"label"},"CPU 使用率",-1)),t("div",Bi,[t("span",Ri,M(c.cpu),1),m[0]||(m[0]=t("span",{class:"unit"},"%",-1))]),d.value?(r(),K(x,{key:0,theme:"success",variant:"light",size:"small",class:"status-tag"},{default:a(()=>[...m[1]||(m[1]=[f(" 实时 ",-1)])]),_:1})):(r(),K(x,{key:1,theme:"danger",variant:"light",size:"small",class:"status-tag"},{default:a(()=>[...m[2]||(m[2]=[f(" 离线 ",-1)])]),_:1}))]),t("div",{ref_key:"cpuChartRef",ref:o,class:"chart-container"},null,512)])]),_:1})]),_:1}),e(E,{xs:12,md:6},{default:a(()=>[e(y,{shadow:"",bordered:!1,class:"chart-card",size:"small"},{default:a(()=>[t("div",zi,[t("div",Ei,[m[5]||(m[5]=t("div",{class:"label"},"内存使用率",-1)),t("div",Pi,[t("span",Fi,M(c.memUsage),1),m[4]||(m[4]=t("span",{class:"unit"},"%",-1))]),t("div",Ti,M((c.memUsed/1024).toFixed(1))+" / "+M((c.memTotal/1024).toFixed(1))+" GB ",1)]),t("div",{ref_key:"memChartRef",ref:i,class:"chart-container"},null,512)])]),_:1})]),_:1})]),_:1})])}}}),ji=re(Oi,[["__scopeId","data-v-e256825a"]]),Ki={class:"card-header"},Ni={class:"announcement-wrapper"},qi=ne({__name:"Announcement",setup(s){const n=$(!0),l=$(""),d=Cs(),o=$(d.value?"dark":"light");ke(d,()=>{o.value=d.value?"dark":"light"});async function i(){n.value=!0;const v=`## 🔴 公告加载失败
- 请检查网络连接或联系管理员。`;try{const u=await X.get({url:"https://api.mslmc.cn/v3/query/notice?query=mslxNoticeMd"});u&&u.mslxNoticeMd?l.value=u.mslxNoticeMd:l.value=v}catch(u){console.error("获取公告失败:",u),l.value=v}finally{n.value=!1}}return xe(()=>{i()}),(v,u)=>(r(),K(b(Ea),{shadow:"",bordered:!1,class:"announcement-card"},{title:a(()=>[t("div",Ki,[e(b(ut),{name:"system-messages"}),u[0]||(u[0]=t("span",null,"系统公告",-1))])]),default:a(()=>[e(b(cn),{loading:n.value,text:"加载中...",size:"small",style:{width:"100%"}},{default:a(()=>[t("div",Ni,[e(b(Ss),{"editor-id":"announcement-preview","model-value":l.value,theme:o.value,class:"md-preview-wrapper"},null,8,["model-value","theme"])])]),_:1},8,["loading"])]),_:1}))}}),Gi=re(qi,[["__scopeId","data-v-a0056e46"]]),Hi=ne({__name:"index",setup(s){const n=Re(),l=te(()=>n.userInfo?.username==="mslx");return(d,o)=>{const i=p("t-alert");return r(),C("div",null,[l.value?(r(),K(i,{key:0,theme:"warning",title:"安全风险提示",message:"检测到您当前正在使用默认账号 (mslx)。为了保障系统安全，请务必尽快修改用户名和密码！",style:{"margin-bottom":"16px"}},{operation:a(()=>[t("span",{style:{cursor:"pointer"},onClick:o[0]||(o[0]=v=>b(Ie)("/settings"))},"去修改")]),_:1})):O("",!0),e(Wr),e(Vi,{style:{"margin-top":"12px"}}),e(ji,{style:{"margin-top":"12px"}}),e(Gi,{style:{"margin-top":"12px"}})])}}}),Ji=Object.freeze(Object.defineProperty({__proto__:null,default:Hi},Symbol.toStringTag,{value:"Module"})),Wi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAACXBIWXMAAAsSAAALEgHS3X78AAADgklEQVR42u2dPWhTYRSGk2qlZKia+BMNFuJQERehuFiogoNSJ7tIi4MKFkELInapVYOIS8SlCqKoiwji5OhStLQOlUz+YUFrC2li7I26hGCwEbXrOTec5OKN93nWw/363S8PJ7w9yU0oBAAAASWsFdPXb1Q5ouZn+Oxp8XVu4XiCDQIgACAAIAAgAASQlVrU6+07aFp0bTTqq5v8WiwG/XWu0gEAAQABAAEAAQABYDkGWuPc5PiEWIttXCfWIpGIebP3L4+arjt28YpYK5VKYu3Rtaumv3f43IgnL5bzedF05nQAQABAAEAAQABAAKgxBr5781asbUl2mKKVVnOLXts6EmLt/XzWdADWWKrtRbuHeiKiNerRAQABAAEAAQABAAGgxhgY3xQXa/lc3hSt3CZ6WrwaOHlKrF0akePVhwuDttNp3WDay8NbN00RsZ6YqE0K6QCAAIAAgACAAIAAgABQy/8BtKyvoY18eyoF9dqJebn2aXrBtG4i9tN0Hz1OwbQXbTTtdv9WtFHx3Mc5OgAgACAAIAAgACAA1BID/wX97TmxVh4/L9a6OitibXW8zbSXeL4sR2RlL/3t8ppZZ4Un58Y4GBAAEAAQABAAEAB8GgPdJnPxWKUpDs6rfS7RAQABAAEAAQABAAGg+WJgy+0hc3zampoSa8XsrFj7dueIaa/flYmfxpoTD8RaNJGUL0x1q+vmlbNbGhyjAwACAAIAAgACAAJAvTGwkFts+KJaXNFizp8YqNT2HDoq1p70Nj7qhYx7eTX9XL5/p1Vdt+3MXdN+HKWmvcZ0AN4CAAEAAQABAAEgcDHQeqH2XbQf9+QfatS+w/cbbeLnfMkpV643Ry8JbXKp7UW7B7dpaEZ5rO2q46N0AEAAQABAAEAAQACok/DwcKoqFQ/07TfFQA0tIv6NieX/+sAzM/rjaryIei+nMnQAQABAAEAAQABAAFjGd08KtU7udo89E2ubk52mNRdmZ8Tai6G9dABAAEAAQABAAEAAQADg/wAuuI07sy7jYguvJ582fE3rL394Me6lAwACAAIAAgACAAJAg2Kg9slf7ZOmu7q7PIuJEo8H9vkqznqBF2dOB+AtABAAEAAQABAAiIE1smPndl/diN+mbF7gxZnTAXgLAAQABAAEAASAoBHWitrzg6B5SKdTYToAIAAgACAAIAAgAAAAAECQ+QUUBtshXi5agwAAAABJRU5ErkJggg==",Xi="/assets/png/mslx-150px-Anvil.BV3t5jxS.png",Qi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAACWElEQVR42u3dPS8EURQG4G1RU6GWoFUqRK9Ao1BoJRJ+gEgUG4XERyJRKIQIFYVE0Gn8rPUPzolc1+zOPG/yljs7e89Tnczu9notz9zsxKBmewKAACAACAACgAAgAMjQDPBoYyns2+l+2O/DtbCAAAAAAAAAAAAAAAAAAAAAAADA3w0wG1DW99eXsDv95bDZ9TNgnQcCAAAAAAAAAAAAAAAAAAAAQKsAZB8wW6SUDvBxcz3sx/1l2M/r87DZ+3d+kQQAAAAAAAAAAAAAAAAAAAAAAL9obSAPdxdhn6/Own5vb4XtPBAAAAAAAAAAAAAAAAAAAAAAWgVgcmpqELV0wLW/2PHVXw5bOsDaD4xkzeYDAAAAAAAAAAAAAAAAAAAAAAC/yfzC4iBqdgO1D6gUSNMDzK6fnS8AAAAAAAAAAAAAAAAAAAAAAPwngJvbp7BNAyldRJX+gEXpAI+OT8ICAAAAAAAAAAAAAAAAAAAAAMB/AshusDaQ2g+clA5wd+8gbHZ+2esBAAAAAAAAAAAAAAAAAAAAAGCYFkFNA6m9iKk94JHfBAIAAAAAAAAAAAAAAAAAAADQKgClA64NpOkB2QQCAAAAAAAAAAAAAAAAAAAAMEoAhh3Iyupq2GEfcHZ+Y2PjYRv/xxAAAAAAAAAAAAAAAAAAAAAAOgWgaSAZgKYXMVmzAWfnBwAAAAAAAAAAAAAAAAAAAAAAo5RSIKWLoNYvYgAAAAAAAAAAAAAAAAAAAAAAoEVApmdmw1rEAAAAAAAAAAAAAAAAAAAAAACAiIiIiIiIiHQwP/KhHMCviKP2AAAAAElFTkSuQmCC",Yi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAABi0lEQVR42u3cMWoCQRSAYW9mkzYHECGFYJXCKrWVTYpcQwIpUliICAaLEDxASiHn2GIs070njMgy+33wyhWZ91fD6mgEAAAAAAAAANAzh5euRLOdx5M974QFgAAQAAJAAAgAAXA/p7euRJMteL+I57yLJ/t8GxIAAkAACAABIAAEwO0ucrIF1T6fLXgzjed7FY8NCwABIAAEgAAQAALgX3bA2fy+x1MbQLbg7PvZsAAQAAJAAAgAASAArvd37Eo0tT8Mqb1osiEBIAAEgAAQAAJAAPTnImn+8RBO7QslNiAABIAAEAACQAAIgP54/ZmVaJyQABAAAkAACAABIADasdg8lmickAAQAAJAAAgAASAA2pG9EOKEBIAAEAACQAAIAAHQDhdBAhCAAAQgAAEIQAACEIAABCAAAQzH8mtSonFCAkAACAABIAAEgABohz+IEIAABCAAAQhAAAIQgAAEIAABCGA4nj/HJRonJAAEgAAQAAJAAAiAdjytxyUaJyQABIAAEAACQAAIYEAu6/zodBuokO4AAAAASUVORK5CYII=",Zi={class:"server-list-container"},eu={class:"page-header"},tu={class:"card-header"},au={class:"status-badge"},su={class:"card-content"},nu={class:"server-name text-ellipsis"},lu={class:"server-info"},ou={class:"info-item"},ru={class:"info-item id-tag"},iu={class:"card-actions"},uu={key:0,class:"empty-state"},du={class:"delete-dialog-body"},cu={class:"checkbox-area"},mu=ne({__name:"index",setup(s){const n=ea();xe(()=>{n.refreshInstanceList()});const l=_=>{switch(_){case 1:return{label:"启动中",theme:"primary",icon:fn,loading:!0};case 2:return{label:"运行中",theme:"success",icon:ma,loading:!1};case 3:return{label:"停止中",theme:"warning",icon:vn,loading:!1};case 4:return{label:"重启中",theme:"primary",icon:at,loading:!0};default:return{label:"未启动",theme:"default",icon:pn,loading:!1}}},d=_=>{Ie(`/instance/console/${_.id}`)},o=(_,h)=>{if(_.includes("http"))return _;switch(_){case"neoforge":return Wi;case"forge":return Xi;case"custom":return Qi;case"server-icon":return new URL(`${localStorage.getItem(Lt)}/api/instance/icon/${h}.png?x-user-token=${localStorage.getItem(Ut)}`,import.meta.url).href;default:return Yi}},i=_=>_==="none"?"自定义模式":_.startsWith("@")?_.includes("neoforge")?"NeoForge":"Forge":_.replace(".jar",""),v=Xe({visible:!1,loading:!1,deleteFile:!1,item:null}),u=(_,h)=>{_.stopPropagation(),v.item=h,v.deleteFile=!1,v.loading=!1,v.visible=!0},c=async()=>{if(v.item){v.loading=!0;try{await Qr(v.item.id,v.deleteFile),L.success("删除成功"),v.visible=!1,await n.refreshInstanceList()}catch(_){L.error("删除失败: "+_.message)}finally{v.loading=!1}}};return(_,h)=>{const S=p("t-button"),A=p("t-space"),z=p("t-loading"),w=p("t-avatar"),g=p("t-tag"),U=p("t-card"),I=p("t-col"),m=p("t-row"),x=p("t-empty"),y=p("t-checkbox"),E=p("t-dialog");return r(),C("div",Zi,[t("div",eu,[h[5]||(h[5]=t("h2",{class:"title"},"服务端列表",-1)),e(A,null,{default:a(()=>[e(S,{theme:"primary",variant:"dashed",onClick:b(n).refreshInstanceList},{default:a(()=>[...h[3]||(h[3]=[f(" 刷新列表 ",-1)])]),_:1},8,["onClick"]),e(S,{theme:"primary",onClick:h[0]||(h[0]=T=>b(Ie)("/instance/create"))},{default:a(()=>[...h[4]||(h[4]=[f(" 添加服务端 ",-1)])]),_:1})]),_:1})]),e(z,{loading:!1,text:"加载中...",fullscreen:""}),e(m,{gutter:[24,24]},{default:a(()=>[(r(!0),C(pe,null,we(b(n).instanceList,T=>(r(),K(I,{key:T.id,xs:12,sm:6,md:4,lg:3,xl:3},{default:a(()=>[e(U,{class:ye(["server-card",`status-${T.status}`]),bordered:!1,onClick:V=>d(T)},{default:a(()=>[t("div",tu,[t("div",{class:ye(["icon-wrapper",`status-${T.status}`])},[e(w,{image:o(T.icon,T.id),size:"large",shape:"round",class:"server-icon"},null,8,["image"])],2),t("div",au,[e(g,{theme:l(T.status).theme,variant:"light",shape:"round"},{icon:a(()=>[(r(),K(lt(l(T.status).icon),{class:ye({"spin-icon":l(T.status).loading})},null,8,["class"]))]),default:a(()=>[f(" "+M(l(T.status).label),1)]),_:2},1032,["theme"])])]),t("div",su,[t("h3",nu,M(T.name),1),t("div",lu,[t("div",ou,[e(b(mn),{class:"info-icon"}),t("span",null,M(i(T.core)),1)]),t("div",ru,[t("span",null,"#"+M(T.id),1)])])]),t("div",iu,[h[6]||(h[6]=t("span",{class:"action-hint"},"点击管理",-1)),e(S,{shape:"circle",theme:"danger",variant:"text",class:"delete-btn",onClick:V=>u(V,T)},{default:a(()=>[e(b(wt))]),_:1},8,["onClick"])])]),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:1}),b(n).instanceList.length===0?(r(),C("div",uu,[e(x,{description:"暂无服务端实例"})])):O("",!0),e(E,{visible:v.visible,"onUpdate:visible":h[2]||(h[2]=T=>v.visible=T),header:"确认删除",theme:"danger","confirm-btn":{content:"确认删除",loading:v.loading},onConfirm:c},{default:a(()=>[t("div",du,[t("p",null,[h[7]||(h[7]=f(" 您确定要删除服务端 ",-1)),t("strong",null,M(v.item?.name),1),f(" (ID: "+M(v.item?.id)+") 吗？ ",1)]),h[9]||(h[9]=t("p",{class:"warning-text"},"此操作不可恢复！",-1)),t("div",cu,[e(y,{modelValue:v.deleteFile,"onUpdate:modelValue":h[1]||(h[1]=T=>v.deleteFile=T)},{default:a(()=>[...h[8]||(h[8]=[f("同时删除服务端文件数据",-1)])]),_:1},8,["modelValue"])])])]),_:1},8,["visible","confirm-btn"])])}}}),pu=re(mu,[["__scopeId","data-v-5b2fff09"]]),vu=Object.freeze(Object.defineProperty({__proto__:null,default:pu},Symbol.toStringTag,{value:"Module"}));async function fu(){return await X.get({url:"/query/server_classify",baseURL:"https://api.mslmc.cn/v3"})}async function gu(s){return await X.get({url:`/query/available_versions/${s}`,baseURL:"https://api.mslmc.cn/v3"})}async function _u(s,n){return await X.get({url:`/download/server/${s}/${n}`,baseURL:"https://api.mslmc.cn/v3"})}const hu={class:"core-selector-layout"},yu={class:"sidebar"},bu={key:1,class:"category-list"},wu=["onClick"],ku={class:"cat-icon"},$u={class:"cat-info"},Au={class:"cat-name"},xu={class:"cat-desc"},Cu={key:0,class:"cat-count"},Su={class:"main-panel"},Iu={class:"panel-section"},Vu={class:"section-header"},Mu={class:"core-grid"},Uu=["onClick"],Lu={key:0,class:"empty-text"},Bu={key:0,class:"panel-section"},Ru={class:"section-header"},zu={class:"section-title"},Eu={class:"version-grid"},Pu=["onClick"],Fu={key:0,class:"empty-text"},Tu=ne({__name:"ServerCoreSelector",props:{visible:{type:Boolean}},emits:["update:visible","confirm"],setup(s,{emit:n}){const l=s,d=n,o=te({get:()=>l.visible,set:y=>d("update:visible",y)}),i=$(!1),v=$(!1),u=$({}),c=$("plugins"),_=$(""),h=$([]),S=$(""),A=[{key:"plugins",name:"插件服务端",desc:"支持 Bukkit/Spigot/Paper 插件",icon:"app",dataKey:"pluginsCore"},{key:"forge_hybrid",name:"NeoForge 系混合服务端",desc:"同时支持 Neoforge/Forge模组 和 插件",icon:"layers",dataKey:"pluginsAndModsCore_Forge"},{key:"fabric_hybrid",name:"Fabric 混合服务端",desc:"同时支持 Fabric模组 和 插件",icon:"cpu",dataKey:"pluginsAndModsCore_Fabric"},{key:"mod_forge",name:"NeoForge 模组服务端",desc:"纯 NeoForge/Forge 模组支持",icon:"tools",dataKey:"modsCore_Forge"},{key:"mod_fabric",name:"Fabric 模组服务端",desc:"纯 Fabric 模组支持",icon:"ai-tool",dataKey:"modsCore_Fabric"},{key:"vanilla",name:"原版服务端",desc:"Minecraft 官方原版核心",icon:"tea",dataKey:"vanillaCore"},{key:"bedrock",name:"基岩版第三方端",desc:"第三方的基岩版服务端",icon:"gift",dataKey:"bedrockCore"},{key:"proxy",name:"代理服务端",desc:"BungeeCord / Velocity 等 用于群组服",icon:"share",dataKey:"proxyCore"}],z=te(()=>{const y=A.find(E=>E.key===c.value);return!y||!u.value?[]:u.value[y.dataKey]||[]}),w=te(()=>S.value?z.value.filter(y=>y.toLowerCase().includes(S.value.toLowerCase())):z.value),g=async()=>{i.value=!0;try{const y=await fu();Array.isArray(y)&&y.length>0?u.value=y[0]:y&&!Array.isArray(y)&&(u.value=y)}catch(y){L.error("获取服务端分类失败"),console.error(y)}finally{i.value=!1}},U=y=>{c.value=y,_.value="",h.value=[],S.value=""},I=y=>{_.value!==y&&(_.value=y,m(y))},m=async y=>{v.value=!0,h.value=[];try{const E=await gu(y);Array.isArray(E)&&E.length>0?h.value=E[0].versionList||[]:E&&!Array.isArray(E)&&(h.value=E.versionList||[])}catch(E){L.error(`获取 ${y} 版本列表失败`),console.error(E)}finally{v.value=!1}},x=async y=>{const E=L.loading("正在获取核心版本信息...",0);try{const T=await _u(_.value,y),V={core:_.value,version:y,url:T.url,sha256:T.sha256||"",filename:`${_.value}-${y}.jar`};L.close(E),d("confirm",V),o.value=!1}catch(T){L.close(E),L.error("获取核心的版本信息失败"),console.error(T)}};return ke(()=>l.visible,y=>{y&&!u.value.pluginsCore&&g()}),(y,E)=>{const T=p("t-loading"),V=p("t-icon"),N=p("t-input"),q=p("t-divider"),P=p("t-button"),k=p("t-dialog");return r(),K(k,{visible:o.value,"onUpdate:visible":E[2]||(E[2]=B=>o.value=B),header:"选择服务端核心",width:"85%",top:"5vh",attach:"body",footer:!1,"destroy-on-close":"",class:"core-selector-dialog"},{default:a(()=>[t("div",hu,[t("div",yu,[E[3]||(E[3]=t("div",{class:"sidebar-title"},"服务端分类",-1)),E[4]||(E[4]=t("div",{class:"sidebar-desc"},"选择您需要的服务端类型",-1)),i.value?(r(),K(T,{key:0,loading:i.value,size:"small",text:"加载分类中..."},null,8,["loading"])):(r(),C("div",bu,[(r(),C(pe,null,we(A,B=>t("div",{key:B.key,class:ye(["category-item",{active:c.value===B.key}]),onClick:R=>U(B.key)},[t("div",ku,[e(V,{name:B.icon},null,8,["name"])]),t("div",$u,[t("div",Au,M(B.name),1),t("div",xu,M(B.desc),1),u.value[B.dataKey]?(r(),C("div",Cu,M(u.value[B.dataKey]?.length||0)+" 个核心 ",1)):O("",!0)])],10,wu)),64))]))]),t("div",Su,[t("div",Iu,[t("div",Vu,[E[5]||(E[5]=t("div",{class:"section-title"},"选择服务端核心",-1)),e(N,{modelValue:S.value,"onUpdate:modelValue":E[0]||(E[0]=B=>S.value=B),placeholder:"搜索核心...",class:"search-input"},{"suffix-icon":a(()=>[e(V,{name:"search"})]),_:1},8,["modelValue"])]),t("div",Mu,[(r(!0),C(pe,null,we(w.value,B=>(r(),C("div",{key:B,class:ye(["core-card",{active:_.value===B}]),onClick:R=>I(B)},[f(M(B)+" ",1),_.value===B?(r(),K(V,{key:0,name:"check",class:"check-icon"})):O("",!0)],10,Uu))),128)),w.value.length===0?(r(),C("div",Lu,"该分类下暂无核心")):O("",!0)])]),_.value?(r(),C("div",Bu,[e(q),t("div",Ru,[t("div",zu,M(_.value)+" 版本列表",1),e(P,{size:"small",variant:"text",onClick:E[1]||(E[1]=B=>m(_.value))},{icon:a(()=>[e(V,{name:"refresh"})]),default:a(()=>[E[6]||(E[6]=f("刷新 ",-1))]),_:1})]),e(T,{loading:v.value,size:"small",text:"获取版本中...",class:"loading-wrapper"},{default:a(()=>[t("div",Eu,[(r(!0),C(pe,null,we(h.value,B=>(r(),C("div",{key:B,class:"version-item",onClick:R=>x(B)},M(B),9,Pu))),128)),h.value.length===0&&!v.value?(r(),C("div",Fu,"未找到该核心的版本信息")):O("",!0)])]),_:1},8,["loading"])])):O("",!0)])])]),_:1},8,["visible"])}}}),Ha=re(Tu,[["__scopeId","data-v-9e97180c"]]);async function Ja(s,n){return await X.get({url:"/query/jdk",baseURL:"https://api.mslmc.cn/v3",params:{os:s,arch:n}})}async function Wa(s=!1){return await X.get({url:"/api/java/list",params:{refresh:s},timeout:60*1e3})}const Du={class:"main-layout-container"},Ou={class:"steps-aside"},ju={class:"main-content"},Ku={key:0,class:"form-step-container"},Nu={class:"step-content"},qu={class:"step-content"},Gu={style:{"margin-top":"6px",display:"flex","flex-direction":"column",gap:"6px"}},Hu={style:{"margin-top":"4px",color:"var(--td-text-color-placeholder)","font-size":"12px"}},Ju={style:{width:"100%"}},Wu={class:"java-option-panel"},Xu={key:0,class:"flex-row"},Qu={class:"tip"},Yu={key:1,class:"flex-row"},Zu={key:2},ed={key:3},td={class:"step-content"},ad={key:0,class:"online-select-area"},sd={class:"select-core-wrapper"},nd={key:0,class:"selected-core-card"},ld={class:"core-icon"},od={class:"core-info"},rd={class:"core-filename"},id={key:1,class:"online-select-area"},ud={class:"select-core-wrapper"},dd={key:1,class:"uploading-state"},cd={class:"core-filename"},md={key:2,class:"selected-core-card"},pd={class:"core-icon"},vd={class:"core-info"},fd={class:"core-filename"},gd={class:"core-url"},_d={key:2,class:"online-select-area"},hd={class:"step-content"},yd={key:1,class:"step-content creation-progress"},bd={class:"progress-title"},wd={class:"log-time"},kd={class:"log-message"},$d={key:2,class:"result-success"},Ad={class:"result-success-title"},xd=ne({__name:"QuickMode",setup(s){const n=Re(),l=$(null),d=ea(),o=$(0),i=$(!1),v=$(!1),u=$(!1),c=$(0),_=$([]),h=$(null),S=$(null),A=$(null),z=$("online"),w=$(!1),g=$(null),U=$(!1),I=$(0),m=$(""),x=$(""),y=$("online"),E=$([]),T=$([]),V=$(""),N=$(""),q=async(F=!1)=>{try{F&&L.info("正在刷新Java版本列表(重新扫描耗时较长)...");const j=await Ja(n.userInfo.systemInfo.osType.toLowerCase().replace("os",""),n.userInfo.systemInfo.osArchitecture.toLowerCase());j&&Array.isArray(j)&&(E.value=j.map(ae=>({label:`Java ${ae}`,value:ae})),E.value.length>0&&!V.value&&(V.value=E.value[1].value)),T.value=(await Wa(F)).map(ae=>({label:`Java ${ae.version}${ae.is64Bit?"":" (32位)"} (${ae.vendor} | ${ae.path})`,value:ae.path})),T.value.length>0&&(N.value=T.value[0].value),F&&L.success("已刷新Java版本列表")}catch(j){L.warning("获取在线Java版本失败"+j.message)}};xe(()=>{q()});const P=$({name:"新建服务器",path:"",java:"",core:"",coreUrl:"",coreSha256:"",coreFileKey:"",packageFileKey:"",minM:1024,maxM:4096,args:""}),k=[{label:"GB",value:"GB"},{label:"MB",value:"MB"}],B=$("GB"),R=$("GB"),Z=te({get:()=>B.value==="GB"?P.value.minM/1024:P.value.minM,set:F=>{P.value.minM=B.value==="GB"?Math.round(F*1024):F}}),J=te({get:()=>R.value==="GB"?P.value.maxM/1024:P.value.maxM,set:F=>{P.value.maxM=R.value==="GB"?Math.round(F*1024):F}});ke([y,V,N],([F,j,ae])=>{F==="env"?P.value.java="java":F==="custom"||F==="local"?P.value.java=ae:F==="online"&&(P.value.java=j?`MSLX://Java/${j}`:""),P.value.java&&l.value?.validate({fields:["java"]})},{immediate:!0});const W=te(()=>({name:[{required:!0,message:"实例名称不能为空",trigger:"blur"}],java:[{required:!0,message:"请配置 Java 环境",trigger:"change"}],core:[{required:!0,message:"核心名称/文件不能为空",trigger:"change"}],coreUrl:[{validator:F=>{if(z.value==="online"){if(!F)return{result:!1,message:"请选择一个服务端核心",type:"error"};if(F&&!/^https?:\/\/.+/.test(F))return{result:!1,message:"下载地址必须以 http(s) 开头",type:"error"}}return!0},trigger:"change"}],coreFileKey:[{validator:F=>z.value==="manual"&&!F?{result:!1,message:"请上传核心文件",type:"error"}:!0,trigger:"change"}],minM:[{required:!0,min:1,message:"最小内存必须大于0",trigger:"blur"}],maxM:[{required:!0,min:1,message:"最大内存必须大于0",trigger:"blur"}]})),H=[["name","path"],["java"],["core","coreUrl","coreSha256","coreFileKey"],["minM","maxM","args"]],$e=()=>{o.value>0&&(o.value-=1)},Te=async()=>{if(o.value===2){if(z.value==="online"){if(!P.value.coreUrl||!P.value.core){L.warning("请点击按钮选择一个服务端核心");return}}else if(z.value==="custom"){if(!P.value.core){L.warning("请输入核心文件名");return}}else if(!P.value.coreFileKey){L.warning("请先上传核心文件");return}}const F=await l.value.validate();if(F===!0){o.value<3&&(o.value+=1);return}const j=new Set(H[o.value]);Object.keys(F).some(me=>j.has(me))?L.warning("请检查当前步骤的输入"):o.value<3&&(o.value+=1)},ge=F=>{P.value.core=F.filename,P.value.coreUrl=F.url,P.value.coreSha256=F.sha256,P.value.coreFileKey="",L.success(`已选择: ${F.core} (${F.version})`),l.value.validate({fields:["core","coreUrl"]})},ze=()=>{g.value?.click()},Le=F=>{if(F===0)return"0 B";const j=1024,ae=["B","KB","MB","GB"],me=Math.floor(Math.log(F)/Math.log(j));return parseFloat((F/Math.pow(j,me)).toFixed(2))+" "+ae[me]},Ee=async F=>{const j=F.target;if(!j.files||j.files.length===0)return;if(P.value.coreFileKey)try{await At(P.value.coreFileKey),console.log("旧临时文件已清理:",P.value.coreFileKey)}catch(ee){console.warn("清理旧文件失败，可能文件已过期",ee)}const ae=j.files[0],me=ae.name;P.value.core=me,P.value.coreUrl="",P.value.coreSha256="",P.value.coreFileKey="",m.value=me,x.value=Le(ae.size),await Je(ae),j.value=""};let Be=null;const Je=async F=>{Be&&Be.abort(),Be=new AbortController,U.value=!0,I.value=0;const ae=F.size>200*1024*1024?50*1024*1024:5*1024*1024,me=Math.ceil(F.size/ae),ee=4,D=5,oe=new Map;let de=0;const _e=()=>{const fe=Date.now();if(fe-de<100)return;de=fe;const be=Array.from(oe.values()).reduce((Ce,Ae)=>Ce+Ae,0),Ue=Math.min(be/F.size*98,98);I.value=Number(Ue.toFixed(1))};try{const be=(await Qt()).uploadId;if(!be)throw new Error("无法获取上传凭证");const Ue=Array.from({length:me},(Q,Se)=>Se),Ce=async Q=>{if(Be?.signal.aborted)throw new Error("已取消");const Se=Q*ae,Oe=Math.min(F.size,Se+ae),je=F.slice(Se,Oe);let Pe;for(let qe=1;qe<=D;qe++){if(Be?.signal.aborted)throw new Error("已取消");try{await Yt(be,Q,je,ce=>{ce&&ce.loaded&&(oe.set(Q,ce.loaded),_e())},Be?.signal),oe.set(Q,je.size),_e();return}catch(ce){Pe=ce,oe.set(Q,0),_e(),qe<D&&await new Promise(rt=>setTimeout(rt,1e3*qe))}}throw new Error(`分片 ${Q} 失败: ${Pe?.message}`)},Ae=async()=>{for(;Ue.length>0&&!Be?.signal.aborted;){const Q=Ue.shift();Q!==void 0&&await Ce(Q)}},Ke=Array(Math.min(ee,me)).fill(null).map(()=>Ae());if(await Promise.all(Ke),Be?.signal.aborted)throw new Error("已取消");const Ne=(await Zt(be,me)).uploadId;I.value=100,P.value.coreFileKey=Ne,L.success("核心文件上传成功！"),l.value?.validate({fields:["core","coreFileKey"]})}catch(fe){if(fe.message==="已取消")return;console.error(fe),L.error(`上传失败: ${fe.message||"未知错误"}`),P.value.core="",m.value="",I.value=0,P.value.coreFileKey&&(At(P.value.coreFileKey).catch(()=>{}),P.value.coreFileKey="")}finally{Be?.signal.aborted||(U.value=!1)}},ie=async()=>{P.value.coreFileKey&&(await At(P.value.coreFileKey),P.value.coreFileKey="",P.value.core="",m.value="",L.success("文件已移除"))},Ve=async()=>{if(!(await l.value.validate()===!0)){L.warning("请检查表单所有内容");return}i.value=!0,_.value=[];const ae={...P.value,path:P.value.path||null,coreUrl:P.value.coreUrl||null,coreSha256:P.value.coreSha256||null,coreFileKey:P.value.coreFileKey||null,args:P.value.args||null};z.value==="manual"?(ae.coreUrl=null,ae.coreSha256=null):ae.coreFileKey=null;try{const ee=(await Ga(ae)).serverId;if(!ee)throw new Error("服务器未返回 ServerId");S.value=ee.toString(),v.value=!0,o.value=4,await De(S.value)}catch(me){const ee=me.message||"创建请求失败，请检查网络或后端服务";L.error(ee),i.value=!1}},De=async F=>{const{baseUrl:j,token:ae}=n;let me=!1;const ee=new URL("/api/hubs/creationProgressHub",j||window.location.origin);ee.searchParams.append("x-user-token",ae),h.value=new It().withUrl(ee.toString(),{withCredentials:!1}).configureLogging(Et.Information).build();const D=(oe,de=null)=>{_.value.push({time:new Date().toLocaleTimeString(),message:oe,progress:de}),yt(()=>{A.value&&(A.value.scrollTop=A.value.scrollHeight)})};h.value.on("StatusUpdate",(oe,de,_e)=>{oe.toString()===F&&(D(de,_e),_e!==null&&_e>=0&&(c.value=_e),_e===100?(me=!0,L.success("服务器创建成功！"),h.value?.stop(),v.value=!1,u.value=!0,o.value=5,i.value=!1,d.refreshInstanceList()):_e===-1&&(L.error(de||"创建过程中发生未知错误"),h.value?.stop(),v.value=!1,i.value=!1,o.value=0))});try{await h.value.start(),D("已连接到实时进度服务..."),await h.value.invoke("TrackServer",F),D("已订阅任务，等待服务器响应...")}catch(oe){me||(D(`SignalR 连接失败: ${oe.message}`,-1),L.error("无法连接到实时进度服务"),v.value=!1,i.value=!1,o.value=0)}};Qe(()=>{h.value?.stop(),Be&&Be.abort()});const se=()=>{u.value=!1,o.value=0,P.value={...P.value,name:"新建服务器",core:"",coreUrl:"",coreSha256:"",path:"",args:"",coreFileKey:""},m.value="",z.value="online",y.value="online",N.value=""};return(F,j)=>{const ae=p("t-step-item"),me=p("t-steps"),ee=p("t-input"),D=p("t-form-item"),oe=p("t-tag"),de=p("t-space"),_e=p("t-icon"),fe=p("t-alert"),be=p("t-radio-button"),Ue=p("t-radio-group"),Ce=p("t-select"),Ae=p("t-button"),Ke=p("t-progress"),We=p("t-input-number"),Ne=p("t-col"),Q=p("t-row"),Se=p("t-textarea"),Oe=p("t-form"),je=p("t-list-item-meta"),Pe=p("t-list-item"),qe=p("t-list");return r(),C("div",null,[t("div",Du,[t("div",Ou,[e(me,{layout:"vertical",style:{"margin-top":"16px"},current:o.value,status:"process",readonly:""},{default:a(()=>[e(ae,{title:"基本信息",content:"填写实例名称和路径"}),e(ae,{title:"Java 环境",content:"配置 Java 运行时"}),e(ae,{title:"核心文件",content:"指定核心文件及下载"}),e(ae,{title:"资源配置",content:"设置内存与 JVM 参数"}),e(ae,{title:"创建实例",content:"提交并等待创建"}),e(ae,{title:"完成",content:"查看创建结果"})]),_:1},8,["current"])]),t("div",ju,[!v.value&&!u.value?(r(),C("div",Ku,[e(Oe,{ref_key:"formRef",ref:l,data:P.value,rules:W.value,"label-align":"top",class:"step-form",onSubmit:Ve},{default:a(()=>[Ye(t("div",Nu,[e(D,{label:"实例名称",name:"name"},{default:a(()=>[e(ee,{modelValue:P.value.name,"onUpdate:modelValue":j[0]||(j[0]=ce=>P.value.name=ce),placeholder:"为你的服务器起个名字"},null,8,["modelValue"])]),_:1}),e(D,{label:"实例路径",name:"path",help:b(n).userInfo.systemInfo.docker?"您正在使用Docker容器部署，为保数据安全，仅支持使用默认数据路径":"选填，留空将使用默认路径"},{default:a(()=>[e(ee,{modelValue:P.value.path,"onUpdate:modelValue":j[1]||(j[1]=ce=>P.value.path=ce),disabled:b(n).userInfo.systemInfo.docker,placeholder:"例如: D:\\MyServer"},null,8,["modelValue","disabled"])]),_:1},8,["help"])],512),[[nt,o.value===0]]),Ye(t("div",qu,[e(fe,{theme:"info",title:"Java 版本选择指南"},{message:a(()=>[t("div",Gu,[e(de,{align:"center",size:12},{default:a(()=>[e(oe,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...j[20]||(j[20]=[f("MC 26.1 - 最新版本",-1)])]),_:1}),e(oe,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...j[21]||(j[21]=[f("Java 25",-1)])]),_:1})]),_:1}),e(de,{align:"center",size:12},{default:a(()=>[e(oe,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...j[22]||(j[22]=[f("MC 1.20.5 - 1.21.11",-1)])]),_:1}),e(oe,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...j[23]||(j[23]=[f("Java 21",-1)])]),_:1})]),_:1}),e(de,{align:"center",size:12},{default:a(()=>[e(oe,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...j[24]||(j[24]=[f("MC 1.18 - 1.20.4",-1)])]),_:1}),e(oe,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...j[25]||(j[25]=[f("Java 17",-1)])]),_:1})]),_:1}),e(de,{align:"center",size:12},{default:a(()=>[e(oe,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...j[26]||(j[26]=[f("MC 1.17 / 1.17.1",-1)])]),_:1}),e(oe,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...j[27]||(j[27]=[f("Java 16",-1)])]),_:1})]),_:1}),e(de,{align:"center",size:12},{default:a(()=>[e(oe,{theme:"default",variant:"outline",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...j[28]||(j[28]=[f("MC 1.13 - 更低版本",-1)])]),_:1}),e(oe,{theme:"default",variant:"light",shape:"round"},{default:a(()=>[...j[29]||(j[29]=[f("Java 8",-1)])]),_:1})]),_:1}),t("div",Hu,[e(_e,{name:"info-circle",size:"small",style:{"margin-right":"4px"}}),j[30]||(j[30]=f(" 建议直接使用推荐版本，避免兼容性问题。 ",-1))])])]),_:1}),e(D,{label:"Java 来源",name:"java"},{default:a(()=>[t("div",Ju,[e(Ue,{modelValue:y.value,"onUpdate:modelValue":j[2]||(j[2]=ce=>y.value=ce),variant:"default-filled"},{default:a(()=>[e(be,{value:"online"},{default:a(()=>[...j[31]||(j[31]=[f("在线下载",-1)])]),_:1}),e(be,{value:"local"},{default:a(()=>[...j[32]||(j[32]=[f("选择电脑上的 Java",-1)])]),_:1}),e(be,{value:"env"},{default:a(()=>[...j[33]||(j[33]=[f("环境变量",-1)])]),_:1}),e(be,{value:"custom"},{default:a(()=>[...j[34]||(j[34]=[f("自定义路径",-1)])]),_:1})]),_:1},8,["modelValue"]),t("div",Wu,[y.value==="online"?(r(),C("div",Xu,[e(Ce,{modelValue:V.value,"onUpdate:modelValue":j[3]||(j[3]=ce=>V.value=ce),options:E.value,placeholder:"请选择 Java 版本"},null,8,["modelValue","options"]),t("div",Qu," 将下载并使用 Java "+M(V.value||"?")+" "+M(b(n).userInfo.systemInfo.osType.toLowerCase().replace("os",""))+" / "+M(b(n).userInfo.systemInfo.osArchitecture.toLowerCase()),1)])):O("",!0),y.value==="local"?(r(),C("div",Yu,[e(Ce,{modelValue:N.value,"onUpdate:modelValue":j[4]||(j[4]=ce=>N.value=ce),options:T.value,placeholder:"请选择 Java 版本"},null,8,["modelValue","options"]),e(Ae,{variant:"outline",theme:"primary",onClick:j[5]||(j[5]=ce=>q(!0))},{default:a(()=>[...j[35]||(j[35]=[f("重新扫描",-1)])]),_:1})])):O("",!0),y.value==="env"?(r(),C("div",Zu,[e(ee,{"model-value":"java",readonly:"",disabled:""}),j[36]||(j[36]=t("div",{class:"tip"},"将使用系统环境变量中的 java 命令",-1))])):O("",!0),y.value==="custom"?(r(),C("div",ed,[e(ee,{modelValue:N.value,"onUpdate:modelValue":j[6]||(j[6]=ce=>N.value=ce),placeholder:"例如: C:\\Program Files\\Java\\jdk-17\\bin\\java.exe"},null,8,["modelValue"])])):O("",!0)])])]),_:1})],512),[[nt,o.value===1]]),Ye(t("div",td,[e(D,{label:"选择您的Minecraft开服使用的服务端核心"},{default:a(()=>[e(Ue,{modelValue:z.value,"onUpdate:modelValue":j[7]||(j[7]=ce=>z.value=ce),variant:"default-filled"},{default:a(()=>[e(be,{value:"online"},{default:a(()=>[...j[37]||(j[37]=[f("在线下载 (推荐)",-1)])]),_:1}),e(be,{value:"manual"},{default:a(()=>[...j[38]||(j[38]=[f("选择本地文件",-1)])]),_:1}),e(be,{value:"custom"},{default:a(()=>[...j[39]||(j[39]=[f("自定义文件名",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),z.value==="online"?(r(),C("div",ad,[e(D,{label:"选择服务端核心",name:"coreUrl"},{default:a(()=>[t("div",sd,[e(Ae,{variant:"outline",onClick:j[8]||(j[8]=ce=>w.value=!0)},{icon:a(()=>[e(_e,{name:"cloud-download"})]),default:a(()=>[j[40]||(j[40]=f(" 点击打开服务端核心选择库 ",-1))]),_:1}),P.value.core?(r(),C("div",nd,[t("div",ld,[e(_e,{name:"check-circle-filled"})]),t("div",od,[t("div",rd,M(P.value.core),1),j[41]||(j[41]=t("div",{class:"core-url",title:"MSLX 将在稍后帮您自动下载此文件..."}," MSLX 将在稍后帮您自动下载此文件... ",-1))]),e(Ae,{shape:"circle",variant:"text",theme:"danger",onClick:j[9]||(j[9]=ce=>{P.value.core="",P.value.coreUrl=""})},{default:a(()=>[e(_e,{name:"close"})]),_:1})])):O("",!0)])]),_:1}),Ye(t("input",{"onUpdate:modelValue":j[10]||(j[10]=ce=>P.value.coreSha256=ce),type:"hidden"},null,512),[[Is,P.value.coreSha256]])])):O("",!0),z.value==="manual"?(r(),C("div",id,[e(D,{label:"上传核心文件",name:"coreFileKey"},{default:a(()=>[t("div",ud,[t("input",{ref_key:"uploadInputRef",ref:g,accept:".jar",type:"file",style:{display:"none"},onChange:Ee},null,544),!U.value&&!P.value.coreFileKey?(r(),K(Ae,{key:0,variant:"outline",onClick:ze},{icon:a(()=>[e(_e,{name:"upload"})]),default:a(()=>[j[42]||(j[42]=f(" 点击选择文件并上传 ",-1))]),_:1})):O("",!0),U.value?(r(),C("div",dd,[t("div",cd,"正在上传: "+M(m.value)+" ("+M(x.value)+")",1),e(Ke,{theme:"line",percentage:I.value},null,8,["percentage"]),j[43]||(j[43]=t("div",{class:"tip"},"别着急，喝杯茶🍵...",-1))])):O("",!0),P.value.coreFileKey&&!U.value?(r(),C("div",md,[t("div",pd,[e(_e,{name:"check-circle-filled"})]),t("div",vd,[t("div",fd,M(m.value),1),t("div",gd,M(x.value)+" | 已上传准备就绪",1)]),e(Ae,{shape:"circle",variant:"text",theme:"primary",onClick:ze},{icon:a(()=>[e(_e,{name:"swap"})]),_:1}),e(Ae,{shape:"circle",variant:"text",theme:"danger",onClick:ie},{icon:a(()=>[e(_e,{name:"delete"})]),_:1})])):O("",!0)])]),_:1})])):O("",!0),z.value==="custom"?(r(),C("div",_d,[e(fe,{theme:"warning",message:"此模式通常用于服务器目录中已经存在核心文件，或者您打算稍后手动通过文件管理上传核心。",style:{"margin-bottom":"16px"}}),e(D,{label:"核心文件名",name:"core",help:"请确保文件名包含后缀，例如: server.jar"},{default:a(()=>[e(ee,{modelValue:P.value.core,"onUpdate:modelValue":j[11]||(j[11]=ce=>P.value.core=ce),placeholder:"请输入核心文件名 (例如 server.jar)"},null,8,["modelValue"])]),_:1})])):O("",!0)],512),[[nt,o.value===2]]),Ye(t("div",hd,[e(Q,{gutter:[16,24]},{default:a(()=>[e(Ne,{xs:12,span:6},{default:a(()=>[e(D,{label:"最小内存",name:"minM"},{default:a(()=>[e(de,{size:8,style:{width:"100%"}},{default:a(()=>[e(We,{modelValue:Z.value,"onUpdate:modelValue":j[12]||(j[12]=ce=>Z.value=ce),min:0,"decimal-places":B.value==="GB"?1:0,placeholder:"Xms",theme:"column",style:{width:"100%"}},null,8,["modelValue","decimal-places"]),e(Ce,{modelValue:B.value,"onUpdate:modelValue":j[13]||(j[13]=ce=>B.value=ce),options:k,clearable:!1,style:{width:"80px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Ne,{xs:12,span:6},{default:a(()=>[e(D,{label:"最大内存",name:"maxM"},{default:a(()=>[e(de,{size:8,style:{width:"100%"}},{default:a(()=>[e(We,{modelValue:J.value,"onUpdate:modelValue":j[14]||(j[14]=ce=>J.value=ce),min:0,"decimal-places":R.value==="GB"?1:0,placeholder:"Xmx",theme:"column",style:{width:"100%"}},null,8,["modelValue","decimal-places"]),e(Ce,{modelValue:R.value,"onUpdate:modelValue":j[15]||(j[15]=ce=>R.value=ce),options:k,clearable:!1,style:{width:"80px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(D,{label:"额外 JVM 参数 (可选)",name:"args",help:"例如: -XX:+UseG1GC",style:{"margin-top":"16px"}},{default:a(()=>[e(Se,{modelValue:P.value.args,"onUpdate:modelValue":j[16]||(j[16]=ce=>P.value.args=ce),placeholder:"-XX:+UseG1GC"},null,8,["modelValue"])]),_:1})],512),[[nt,o.value===3]]),e(D,{class:"step-actions"},{default:a(()=>[o.value>0?(r(),K(Ae,{key:0,theme:"default",onClick:$e},{default:a(()=>[...j[44]||(j[44]=[f("上一步",-1)])]),_:1})):O("",!0),o.value<3?(r(),K(Ae,{key:1,type:"button",onClick:Te},{default:a(()=>[...j[45]||(j[45]=[f("下一步",-1)])]),_:1})):O("",!0),o.value===3?(r(),K(Ae,{key:2,theme:"primary",type:"submit",loading:i.value},{default:a(()=>[...j[46]||(j[46]=[f(" 提交创建 ",-1)])]),_:1},8,["loading"])):O("",!0)]),_:1})]),_:1},8,["data","rules"])])):O("",!0),v.value?(r(),C("div",yd,[t("div",bd,"正在创建实例 ("+M(S.value)+")",1),j[47]||(j[47]=t("p",null,"请勿关闭此页面，创建过程可能需要几分钟...",-1)),e(Ke,{theme:"plump",percentage:c.value,label:`${c.value.toFixed(2)}%`},null,8,["percentage","label"]),t("div",{ref_key:"logContainerRef",ref:A,class:"log-container"},[e(qe,{split:!0},{default:a(()=>[(r(!0),C(pe,null,we(_.value,(ce,rt)=>(r(),K(Pe,{key:rt},{default:a(()=>[e(je,null,{description:a(()=>[t("span",wd,"["+M(ce.time)+"]",1),t("span",kd,M(ce.message),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})],512)])):O("",!0),u.value?(r(),C("div",$d,[e(_e,{class:"result-success-icon",name:"check-circle"}),t("div",Ad,"服务器 ("+M(S.value)+") 已创建成功",1),j[50]||(j[50]=t("div",{class:"result-success-describe"},"你现在可以去服务器列表启动它了",-1)),t("div",null,[e(Ae,{onClick:j[17]||(j[17]=()=>{se(),b(Ie)("/instance/list")})},{default:a(()=>[...j[48]||(j[48]=[f(" 返回服务端列表 ",-1)])]),_:1}),e(Ae,{theme:"default",onClick:j[18]||(j[18]=()=>{se(),b(Ie)(`/instance/console/${S.value}`)})},{default:a(()=>[...j[49]||(j[49]=[f(" 前往控制台 ",-1)])]),_:1})])])):O("",!0)])]),e(Ha,{visible:w.value,"onUpdate:visible":j[19]||(j[19]=ce=>w.value=ce),onConfirm:ge},null,8,["visible"])])}}}),Cd=re(xd,[["__scopeId","data-v-b21eaf5b"]]),Sd={key:0},Id={key:1,class:"result-success"},Vd={class:"result-success-title"},Md=ne({__name:"CustomMode",setup(s){const n=Re(),l=$(!1),d=$(0),o=$(null),i=Xe({name:"",path:null,java:"none",core:"none",coreUrl:"",coreSha256:"",coreFileKey:"",packageFileKey:"",minM:1027,maxM:1027,args:"",ignoreEula:!0}),v={name:[{required:!0,message:"请输入服务器名称",type:"error"}],args:[{required:!0,message:"请输入自定义启动参数",type:"error"}]},u=async({validateResult:_})=>{if(_===!0)try{const h=await Ga(i);d.value=h.serverId,L.success("创建成功"),l.value=!0}catch(h){L.error("创建失败！"+h.message)}else L.warning("请检查表单填写")},c=()=>{l.value=!1,Object.assign(i,{name:"新建服务器",path:null,java:"none",core:"none",packageFileKey:"",coreFileKey:"",coreUrl:"",coreSha256:"",minM:1027,maxM:1027,args:"",ignoreEula:!0})};return(_,h)=>{const S=p("t-input"),A=p("t-form-item"),z=p("t-textarea"),w=p("t-switch"),g=p("t-button"),U=p("t-space"),I=p("t-form"),m=p("t-icon");return r(),C("div",null,[l.value?(r(),C("div",Id,[e(m,{class:"result-success-icon",name:"check-circle"}),t("div",Vd,"服务器 ("+M(d.value)+") 已创建成功",1),h[9]||(h[9]=t("div",{class:"result-success-describe"},"你现在可以去服务器列表启动它了",-1)),t("div",null,[e(g,{onClick:h[4]||(h[4]=()=>{c(),b(Ie)("/instance/list")})},{default:a(()=>[...h[7]||(h[7]=[f(" 返回服务端列表 ",-1)])]),_:1}),e(g,{theme:"default",onClick:h[5]||(h[5]=()=>{c(),b(Ie)(`/instance/console/${d.value}`)})},{default:a(()=>[...h[8]||(h[8]=[f(" 前往控制台 ",-1)])]),_:1})])])):(r(),C("div",Sd,[e(I,{ref_key:"formRef",ref:o,rules:v,data:i,"label-align":"top",onSubmit:u},{default:a(()=>[e(A,{label:"服务器名称",name:"name"},{default:a(()=>[e(S,{modelValue:i.name,"onUpdate:modelValue":h[0]||(h[0]=x=>i.name=x),placeholder:"给你的服务器起一个名字"},null,8,["modelValue"])]),_:1}),e(A,{label:"存储路径(可选)",name:"path",help:b(n).userInfo.systemInfo.docker?"您正在使用Docker容器部署，为保数据安全，仅支持使用默认数据路径":"选填，留空将使用默认路径"},{default:a(()=>[e(S,{modelValue:i.path,"onUpdate:modelValue":h[1]||(h[1]=x=>i.path=x),disabled:b(n).userInfo.systemInfo.docker,placeholder:"请填写服务端保存位置"},null,8,["modelValue","disabled"])]),_:1},8,["help"]),e(A,{label:"启动指令",name:"args",help:"此模式不会自动帮您配置Java环境，您需要填写完整的启动命令。"},{default:a(()=>[e(z,{modelValue:i.args,"onUpdate:modelValue":h[2]||(h[2]=x=>i.args=x),placeholder:"start.bat...",autosize:{minRows:5,maxRows:25},class:"code-font-textarea"},null,8,["modelValue"])]),_:1}),e(A,{label:"忽略EULA提示",name:"args",help:"若您的实例并非MC服务器，可打开此选项"},{default:a(()=>[e(w,{modelValue:i.ignoreEula,"onUpdate:modelValue":h[3]||(h[3]=x=>i.ignoreEula=x),label:["已开启","已关闭"]},null,8,["modelValue"])]),_:1}),e(A,{style:{"margin-top":"20px"}},{default:a(()=>[e(U,null,{default:a(()=>[e(g,{theme:"primary",type:"submit"},{default:a(()=>[...h[6]||(h[6]=[f("提交创建",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]))])}}}),Ud=re(Md,[["__scopeId","data-v-8f0c5701"]]),Ld={class:"main-layout-container"},Bd={class:"steps-aside"},Rd={class:"main-content"},zd={key:0,class:"form-step-container"},Ed={class:"step-content"},Pd={class:"step-content"},Fd={class:"select-core-wrapper"},Td={key:1,class:"uploading-state"},Dd={class:"core-filename"},Od={key:2,class:"uploading-state"},jd={key:3,class:"selected-core-card"},Kd={class:"core-icon"},Nd={class:"core-info"},qd={class:"core-filename"},Gd={class:"core-url"},Hd={class:"step-content"},Jd={key:0},Wd={key:1},Xd={key:0,class:"online-select-area"},Qd={class:"select-core-wrapper"},Yd={key:0,class:"selected-core-card"},Zd={class:"core-icon"},ec={class:"core-info"},tc={class:"core-filename"},ac={key:1,class:"online-select-area"},sc={class:"step-content"},nc={style:{"margin-top":"6px",display:"flex","flex-direction":"column",gap:"6px"}},lc={style:{"margin-top":"4px",color:"var(--td-text-color-placeholder)","font-size":"12px"}},oc={style:{width:"100%"}},rc={class:"java-option-panel"},ic={key:0,class:"flex-row"},uc={key:1,class:"flex-row"},dc={key:2},cc={key:3},mc={class:"step-content"},pc={key:1,class:"step-content creation-progress"},vc={class:"progress-title"},fc={key:2,class:"result-success"},gc=ne({__name:"PackageMode",setup(s){const n=Re(),l=$(null),d=ea(),o=$(0),i=$(!1),v=$(!1),u=$(!1),c=$(0),_=$([]),h=$(null),S=$(null),A=$(null),z=$("online"),w=$(!1),g=$([]),U=$(!1),I=$(""),m=$(null),x=$(!1),y=$(0),E=$(""),T=$(""),V=$("online"),N=$([]),q=$([]),P=$(""),k=$(""),B=async(ee=!1)=>{try{ee&&L.info("正在刷新Java版本列表...");const D=await Ja(n.userInfo.systemInfo.osType.toLowerCase().replace("os",""),n.userInfo.systemInfo.osArchitecture.toLowerCase());D&&Array.isArray(D)&&(N.value=D.map(oe=>({label:`Java ${oe}`,value:oe})),N.value.length>0&&!P.value&&(P.value=N.value[1].value)),q.value=(await Wa(ee)).map(oe=>({label:`Java ${oe.version}${oe.is64Bit?"":" (32位)"} (${oe.vendor} | ${oe.path})`,value:oe.path})),q.value.length>0&&(k.value=q.value[0].value),ee&&L.success("已刷新Java版本列表")}catch(D){L.warning("获取在线Java版本失败: "+D.message)}};xe(()=>{B()});const R=$({name:"新建整合包服务器",path:"",java:"",core:"",coreUrl:"",coreSha256:"",coreFileKey:"",packageFileKey:"",minM:2048,maxM:6144,args:""}),Z=$("GB"),J=$("GB"),W=[{label:"MB",value:"MB"},{label:"GB",value:"GB"}],H=te({get:()=>Z.value==="GB"?R.value.minM/1024:R.value.minM,set:ee=>{R.value.minM=Z.value==="GB"?Math.round(ee*1024):ee}}),$e=te({get:()=>J.value==="GB"?R.value.maxM/1024:R.value.maxM,set:ee=>{R.value.maxM=J.value==="GB"?Math.round(ee*1024):ee}});ke([V,P,k],([ee,D,oe])=>{ee==="env"?R.value.java="java":ee==="custom"||ee==="local"?R.value.java=oe:ee==="online"&&(R.value.java=D?`MSLX://Java/${D}`:""),R.value.java&&l.value?.validate({fields:["java"]})},{immediate:!0});const Te=te(()=>({name:[{required:!0,message:"实例名称不能为空",trigger:"blur"}],packageFileKey:[{required:!0,message:"请上传整合包文件",trigger:"change"}],core:[{validator:ee=>{if(g.value.length>0){if(!ee)return{result:!1,message:"请选择一个启动Jar",type:"error"}}else{if(z.value==="online"&&!R.value.coreUrl)return{result:!1,message:"请选择服务端核心",type:"error"};if(z.value==="manual"&&!R.value.coreFileKey)return{result:!1,message:"请上传核心文件",type:"error"}}return!0},trigger:"change"}],java:[{required:!0,message:"请配置 Java 环境",trigger:"change"}],minM:[{required:!0,min:1,message:"必须大于0",trigger:"blur"}],maxM:[{required:!0,min:1,message:"必须大于0",trigger:"blur"}]})),ge=[["name","path"],["packageFileKey"],["core","coreUrl","coreFileKey"],["java"],["minM","maxM","args"]],ze=()=>{o.value>0&&(o.value-=1)},Le=async()=>{if(o.value===1){if(!R.value.packageFileKey){L.warning("请先上传服务端整合包(Zip)");return}if(x.value||U.value){L.warning("请等待上传或分析完成");return}}if(o.value===2)if(g.value.length>0){if(!R.value.core){L.warning("请从列表中选择一个启动核心");return}}else{if(z.value==="online"&&(!R.value.coreUrl||!R.value.core)){L.warning("请选择一个服务端核心");return}if(z.value==="manual"&&!R.value.coreFileKey){L.warning("请上传核心文件");return}}const ee=await l.value.validate();if(ee===!0){o.value<4&&(o.value+=1);return}const D=new Set(ge[o.value]);Object.keys(ee).some(de=>D.has(de))?L.warning("请检查当前步骤的输入"):o.value<4&&(o.value+=1)},Ee=()=>{m.value?.click()},Be=ee=>{if(ee===0)return"0 B";const D=1024,oe=["B","KB","MB","GB"],de=Math.floor(Math.log(ee)/Math.log(D));return parseFloat((ee/Math.pow(D,de)).toFixed(2))+" "+oe[de]},Je=async ee=>{const D=ee.target;if(!D.files||D.files.length===0)return;if(R.value.packageFileKey)try{await At(R.value.packageFileKey)}catch(de){console.error(de)}R.value.core="",g.value=[],I.value="";const oe=D.files[0];E.value=oe.name,T.value=Be(oe.size),await Ve(oe),D.value=""};let ie=null;const Ve=async ee=>{ie&&ie.abort(),ie=new AbortController,x.value=!0,y.value=0;const oe=ee.size>200*1024*1024?50*1024*1024:10*1024*1024,de=Math.ceil(ee.size/oe),_e=4,fe=5,be=new Map;let Ue=0;const Ce=()=>{const Ae=Date.now();if(Ae-Ue<100)return;Ue=Ae;const Ke=Array.from(be.values()).reduce((Ne,Q)=>Ne+Q,0),We=Math.min(Ke/ee.size*98,98);y.value=Number(We.toFixed(1))};try{const Ke=(await Qt()).uploadId;if(!Ke)throw new Error("无法获取上传凭证");const We=Array.from({length:de},(Pe,qe)=>qe),Ne=async Pe=>{if(ie?.signal.aborted)throw new Error("已取消");const qe=Pe*oe,ce=Math.min(ee.size,qe+oe),rt=ee.slice(qe,ce);let Vt;for(let vt=1;vt<=fe;vt++){if(ie?.signal.aborted)throw new Error("已取消");try{await Yt(Ke,Pe,rt,st=>{st&&st.loaded&&(be.set(Pe,st.loaded),Ce())},ie?.signal),be.set(Pe,rt.size),Ce();return}catch(st){Vt=st,be.set(Pe,0),Ce(),vt<fe&&await new Promise(kt=>setTimeout(kt,1e3*vt))}}throw new Error(`分片 ${Pe} 失败: ${Vt?.message}`)},Q=async()=>{for(;We.length>0&&!ie?.signal.aborted;){const Pe=We.shift();Pe!==void 0&&await Ne(Pe)}},Se=Array(Math.min(_e,de)).fill(null).map(()=>Q());if(await Promise.all(Se),ie?.signal.aborted)throw new Error("已取消");y.value=99;const je=(await Zt(Ke,de)).uploadId;y.value=100,R.value.packageFileKey=je,L.success("上传成功，正在分析整合包内容..."),await De(je)}catch(Ae){if(Ae.message==="已取消")return;ie?.abort(),console.error(Ae),L.error(`上传失败: ${Ae.message||"未知错误"}`),E.value="",y.value=0,R.value.packageFileKey&&(At(R.value.packageFileKey).catch(()=>{}),R.value.packageFileKey="")}finally{ie?.signal.aborted||(x.value=!1)}},De=async ee=>{U.value=!0;try{const D=await Bo(ee);g.value=D.jars||[],I.value=D.detectedRoot||"",D.count===1&&D.jars.length>0?(R.value.core=D.jars[0],L.success(`自动识别到服务端核心: ${D.jars[0]}`)):D.count>1?L.info(`整合包内检测到 ${D.count} 个服务端核心，请在下一步选择`):L.warning("未检测到整合包内存在服务端核心，请在下一步手动配置核心")}catch(D){L.error("整合包分析失败: "+D.message)}finally{U.value=!1}},se=async()=>{R.value.packageFileKey&&(await At(R.value.packageFileKey),R.value.packageFileKey="",E.value="",g.value=[],R.value.core="",L.success("文件已移除"))},F=ee=>{R.value.core=ee.filename,R.value.coreUrl=ee.url,R.value.coreSha256=ee.sha256,R.value.coreFileKey="",L.success(`已选择: ${ee.core} (${ee.version})`)},j=async()=>{if(await l.value.validate()!==!0){L.warning("请检查表单所有内容");return}i.value=!0,_.value=[];const D={...R.value,path:R.value.path||null,coreUrl:R.value.coreUrl||null,coreSha256:R.value.coreSha256||null,coreFileKey:R.value.coreFileKey||null,args:R.value.args||null};g.value.length>0?(D.coreUrl=null,D.coreSha256=null,D.coreFileKey=null):z.value==="manual"?(D.coreUrl=null,D.coreSha256=null):D.coreFileKey=null;try{const de=(await Ga(D)).serverId;if(!de)throw new Error("服务器未返回 ServerId");S.value=de.toString(),v.value=!0,o.value=5,await ae(S.value)}catch(oe){L.error(oe.message||"创建请求失败"),i.value=!1}},ae=async ee=>{const{baseUrl:D,token:oe}=n,de=new URL("/api/hubs/creationProgressHub",D||window.location.origin);de.searchParams.append("x-user-token",oe),h.value=new It().withUrl(de.toString(),{withCredentials:!1}).configureLogging(Et.Information).build(),h.value.on("StatusUpdate",(_e,fe,be)=>{_e.toString()===ee&&(_.value.push({time:new Date().toLocaleTimeString(),message:fe,progress:be}),yt(()=>{A.value&&(A.value.scrollTop=A.value.scrollHeight)}),be!==null&&be>=0&&(c.value=be),be===100?(L.success("服务器创建成功！"),h.value?.stop(),v.value=!1,u.value=!0,o.value=6,i.value=!1,d.refreshInstanceList()):be===-1&&(L.error(fe||"错误"),h.value?.stop(),v.value=!1,i.value=!1,o.value=0))});try{await h.value.start(),await h.value.invoke("TrackServer",ee)}catch(_e){console.error("SignalR Error",_e)}};Qe(()=>{h.value?.stop()});const me=()=>{u.value=!1,o.value=0,R.value={name:"新建整合包服务器",path:"",java:"",core:"",coreUrl:"",coreSha256:"",coreFileKey:"",packageFileKey:"",minM:2048,maxM:6144,args:""},g.value=[],E.value="",z.value="online",V.value="online"};return(ee,D)=>{const oe=p("t-step-item"),de=p("t-steps"),_e=p("t-input"),fe=p("t-form-item"),be=p("t-alert"),Ue=p("t-icon"),Ce=p("t-button"),Ae=p("t-progress"),Ke=p("t-loading"),We=p("t-radio"),Ne=p("t-radio-group"),Q=p("t-radio-button"),Se=p("t-tag"),Oe=p("t-space"),je=p("t-select"),Pe=p("t-input-number"),qe=p("t-col"),ce=p("t-row"),rt=p("t-textarea"),Vt=p("t-form"),vt=p("t-list-item-meta"),st=p("t-list-item"),kt=p("t-list");return r(),C("div",null,[t("div",Ld,[t("div",Bd,[e(de,{layout:"vertical",style:{"margin-top":"16px"},current:o.value,status:"process",readonly:""},{default:a(()=>[e(oe,{title:"基本信息",content:"填写实例名称"}),e(oe,{title:"上传整合包",content:"上传服务端 Zip 包"}),e(oe,{title:"核心配置",content:"确认启动的服务端核心"}),e(oe,{title:"Java 环境",content:"配置 Java 运行时"}),e(oe,{title:"资源配置",content:"设置内存参数"}),e(oe,{title:"创建实例",content:"提交并等待解压"}),e(oe,{title:"完成",content:"查看结果"})]),_:1},8,["current"])]),t("div",Rd,[!v.value&&!u.value?(r(),C("div",zd,[e(Vt,{ref_key:"formRef",ref:l,data:R.value,rules:Te.value,"label-align":"top",class:"step-form",onSubmit:j},{default:a(()=>[Ye(t("div",Ed,[e(fe,{label:"实例名称",name:"name"},{default:a(()=>[e(_e,{modelValue:R.value.name,"onUpdate:modelValue":D[0]||(D[0]=he=>R.value.name=he),placeholder:"为你的服务器起个名字"},null,8,["modelValue"])]),_:1}),e(fe,{label:"实例路径",name:"path",help:b(n).userInfo.systemInfo.docker?"您正在使用Docker容器部署，为保数据安全，仅支持使用默认数据路径":"选填，留空将使用默认路径"},{default:a(()=>[e(_e,{modelValue:R.value.path,"onUpdate:modelValue":D[1]||(D[1]=he=>R.value.path=he),disabled:b(n).userInfo.systemInfo.docker,placeholder:"例如: D:\\MyServer"},null,8,["modelValue","disabled"])]),_:1},8,["help"])],512),[[nt,o.value===0]]),Ye(t("div",Pd,[e(be,{theme:"info",class:"mb-4"},{message:a(()=>[...D[18]||(D[18]=[f(" 请上传包含服务端文件的 ",-1),t("b",null,".zip",-1),f(" 压缩包。上传完成后系统将自动分析包内的服务端核心文件。 ",-1)])]),_:1}),e(fe,{label:"上传服务端整合包 (Zip)",name:"packageFileKey"},{default:a(()=>[t("div",Fd,[t("input",{ref_key:"uploadInputRef",ref:m,accept:".zip",type:"file",style:{display:"none"},onChange:Je},null,544),!x.value&&!R.value.packageFileKey?(r(),K(Ce,{key:0,variant:"outline",onClick:Ee},{icon:a(()=>[e(Ue,{name:"upload"})]),default:a(()=>[D[19]||(D[19]=f(" 点击选择 Zip 文件并上传 ",-1))]),_:1})):O("",!0),x.value?(r(),C("div",Td,[t("div",Dd,"正在上传: "+M(E.value)+" ("+M(T.value)+")",1),e(Ae,{theme:"line",percentage:y.value},null,8,["percentage"]),D[20]||(D[20]=t("div",{class:"tip"},"别着急，喝杯咖啡☕️...",-1))])):O("",!0),!x.value&&U.value?(r(),C("div",Od,[e(Ke,{text:"正在分析压缩包结构...",size:"small"})])):O("",!0),R.value.packageFileKey&&!x.value&&!U.value?(r(),C("div",jd,[t("div",Kd,[e(Ue,{name:"folder-zip"})]),t("div",Nd,[t("div",qd,M(E.value),1),t("div",Gd,M(g.value.length>0?`发现 ${g.value.length} 个服务端核心文件`:"未发现服务端核心文件")+" "+M(I.value?`| 根目录: /${I.value}`:""),1)]),e(Ce,{shape:"circle",variant:"text",theme:"primary",onClick:Ee},{icon:a(()=>[e(Ue,{name:"swap"})]),_:1}),e(Ce,{shape:"circle",variant:"text",theme:"danger",onClick:se},{icon:a(()=>[e(Ue,{name:"delete"})]),_:1})])):O("",!0)])]),_:1})],512),[[nt,o.value===1]]),Ye(t("div",Hd,[g.value.length>0?(r(),C("div",Jd,[e(be,{theme:"success",class:"mb-4"},{message:a(()=>[...D[21]||(D[21]=[f("我们在压缩包中发现了以下服务端核心文件，请选择哪一个作为",-1),t("b",null,"启动核心",-1),f("。",-1)])]),_:1}),e(fe,{label:"选择启动核心",name:"core"},{default:a(()=>[e(Ne,{modelValue:R.value.core,"onUpdate:modelValue":D[2]||(D[2]=he=>R.value.core=he),class:"vertical-radio-group"},{default:a(()=>[(r(!0),C(pe,null,we(g.value,he=>(r(),C("div",{key:he,class:"jar-option-item"},[e(We,{value:he},{default:a(()=>[f(M(he),1)]),_:2},1032,["value"])]))),128))]),_:1},8,["modelValue"])]),_:1})])):(r(),C("div",Wd,[e(be,{theme:"warning",class:"mb-4"},{message:a(()=>[...D[22]||(D[22]=[f("在上传的包中未发现服务端核心文件。请在此处下载一个服务端核心。",-1)])]),_:1}),e(fe,{label:"补充服务端核心"},{default:a(()=>[e(Ne,{modelValue:z.value,"onUpdate:modelValue":D[3]||(D[3]=he=>z.value=he),variant:"default-filled"},{default:a(()=>[e(Q,{value:"online"},{default:a(()=>[...D[23]||(D[23]=[f("在线下载核心",-1)])]),_:1}),e(Q,{disabled:"",value:"manual"},{default:a(()=>[...D[24]||(D[24]=[f("自行上传(不支持)",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),z.value==="online"?(r(),C("div",Xd,[e(fe,{label:"选择服务端核心",name:"coreUrl"},{default:a(()=>[t("div",Qd,[e(Ce,{variant:"outline",onClick:D[4]||(D[4]=he=>w.value=!0)},{icon:a(()=>[e(Ue,{name:"cloud-download"})]),default:a(()=>[D[25]||(D[25]=f(" 打开核心库 ",-1))]),_:1}),R.value.core&&z.value==="online"?(r(),C("div",Yd,[t("div",Zd,[e(Ue,{name:"check-circle-filled"})]),t("div",ec,[t("div",tc,M(R.value.core),1),D[26]||(D[26]=t("div",{class:"core-url"},"将在创建时自动下载",-1))])])):O("",!0)])]),_:1})])):O("",!0),z.value==="manual"?(r(),C("div",ac,[D[27]||(D[27]=t("div",{class:"tip-text"},"请在整合包解压后手动放入核心，或在此处不填写等待创建后手动上传。",-1)),e(be,{theme:"error",message:"此模式下建议确保压缩包内包含核心，或者使用在线下载功能。"})])):O("",!0)]))],512),[[nt,o.value===2]]),Ye(t("div",sc,[e(be,{theme:"info",title:"Java 版本选择指南"},{message:a(()=>[t("div",nc,[e(Oe,{align:"center",size:12},{default:a(()=>[e(Se,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...D[28]||(D[28]=[f("MC 26.1 - 最新版本",-1)])]),_:1}),e(Se,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...D[29]||(D[29]=[f("Java 25",-1)])]),_:1})]),_:1}),e(Oe,{align:"center",size:12},{default:a(()=>[e(Se,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...D[30]||(D[30]=[f("MC 1.20.5 - 1.21.11",-1)])]),_:1}),e(Se,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...D[31]||(D[31]=[f("Java 21",-1)])]),_:1})]),_:1}),e(Oe,{align:"center",size:12},{default:a(()=>[e(Se,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...D[32]||(D[32]=[f("MC 1.18 - 1.20.4",-1)])]),_:1}),e(Se,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...D[33]||(D[33]=[f("Java 17",-1)])]),_:1})]),_:1}),e(Oe,{align:"center",size:12},{default:a(()=>[e(Se,{theme:"primary",variant:"dark",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...D[34]||(D[34]=[f("MC 1.17 / 1.17.1",-1)])]),_:1}),e(Se,{theme:"success",variant:"light",shape:"round"},{default:a(()=>[...D[35]||(D[35]=[f("Java 16",-1)])]),_:1})]),_:1}),e(Oe,{align:"center",size:12},{default:a(()=>[e(Se,{theme:"default",variant:"outline",style:{width:"130px","justify-content":"center"}},{default:a(()=>[...D[36]||(D[36]=[f("MC 1.13 - 更低版本",-1)])]),_:1}),e(Se,{theme:"default",variant:"light",shape:"round"},{default:a(()=>[...D[37]||(D[37]=[f("Java 8",-1)])]),_:1})]),_:1}),t("div",lc,[e(Ue,{name:"info-circle",size:"small",style:{"margin-right":"4px"}}),D[38]||(D[38]=f(" 建议直接使用推荐版本，避免兼容性问题。 ",-1))])])]),_:1}),e(fe,{label:"Java 来源",name:"java"},{default:a(()=>[t("div",oc,[e(Ne,{modelValue:V.value,"onUpdate:modelValue":D[5]||(D[5]=he=>V.value=he),variant:"default-filled"},{default:a(()=>[e(Q,{value:"online"},{default:a(()=>[...D[39]||(D[39]=[f("在线下载",-1)])]),_:1}),e(Q,{value:"local"},{default:a(()=>[...D[40]||(D[40]=[f("本机 Java",-1)])]),_:1}),e(Q,{value:"env"},{default:a(()=>[...D[41]||(D[41]=[f("环境变量",-1)])]),_:1}),e(Q,{value:"custom"},{default:a(()=>[...D[42]||(D[42]=[f("自定义路径",-1)])]),_:1})]),_:1},8,["modelValue"]),t("div",rc,[V.value==="online"?(r(),C("div",ic,[e(je,{modelValue:P.value,"onUpdate:modelValue":D[6]||(D[6]=he=>P.value=he),options:N.value,placeholder:"请选择 Java 版本"},null,8,["modelValue","options"])])):O("",!0),V.value==="local"?(r(),C("div",uc,[e(je,{modelValue:k.value,"onUpdate:modelValue":D[7]||(D[7]=he=>k.value=he),options:q.value,placeholder:"请选择 Java"},null,8,["modelValue","options"]),e(Ce,{variant:"text",onClick:D[8]||(D[8]=he=>B(!0))},{default:a(()=>[...D[43]||(D[43]=[f("刷新",-1)])]),_:1})])):O("",!0),V.value==="env"?(r(),C("div",dc,[e(_e,{"model-value":"java",readonly:"",disabled:""})])):O("",!0),V.value==="custom"?(r(),C("div",cc,[e(_e,{modelValue:k.value,"onUpdate:modelValue":D[9]||(D[9]=he=>k.value=he),placeholder:"C:\\Path\\To\\java.exe"},null,8,["modelValue"])])):O("",!0)])])]),_:1})],512),[[nt,o.value===3]]),Ye(t("div",mc,[e(ce,{gutter:[16,24]},{default:a(()=>[e(qe,{xs:12,span:6},{default:a(()=>[e(fe,{label:"最小内存",name:"minM"},{default:a(()=>[e(Oe,{size:8,style:{width:"100%"}},{default:a(()=>[e(Pe,{modelValue:H.value,"onUpdate:modelValue":D[10]||(D[10]=he=>H.value=he),min:0,"decimal-places":Z.value==="GB"?1:0,placeholder:"Xms",theme:"column",style:{width:"100%"}},null,8,["modelValue","decimal-places"]),e(je,{modelValue:Z.value,"onUpdate:modelValue":D[11]||(D[11]=he=>Z.value=he),options:W,clearable:!1,style:{width:"80px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(qe,{xs:12,span:6},{default:a(()=>[e(fe,{label:"最大内存",name:"maxM"},{default:a(()=>[e(Oe,{size:8,style:{width:"100%"}},{default:a(()=>[e(Pe,{modelValue:$e.value,"onUpdate:modelValue":D[12]||(D[12]=he=>$e.value=he),min:0,"decimal-places":J.value==="GB"?1:0,placeholder:"Xmx",theme:"column",style:{width:"100%"}},null,8,["modelValue","decimal-places"]),e(je,{modelValue:J.value,"onUpdate:modelValue":D[13]||(D[13]=he=>J.value=he),options:W,clearable:!1,style:{width:"80px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(fe,{label:"JVM 参数",name:"args",style:{"margin-top":"16px"}},{default:a(()=>[e(rt,{modelValue:R.value.args,"onUpdate:modelValue":D[14]||(D[14]=he=>R.value.args=he),placeholder:"-XX:+UseG1GC"},null,8,["modelValue"])]),_:1})],512),[[nt,o.value===4]]),e(fe,{class:"step-actions",style:{"margin-top":"16px"}},{default:a(()=>[o.value>0?(r(),K(Ce,{key:0,theme:"default",onClick:ze},{default:a(()=>[...D[44]||(D[44]=[f("上一步",-1)])]),_:1})):O("",!0),o.value<4?(r(),K(Ce,{key:1,type:"button",loading:x.value||U.value,onClick:Le},{default:a(()=>[...D[45]||(D[45]=[f("下一步",-1)])]),_:1},8,["loading"])):O("",!0),o.value===4?(r(),K(Ce,{key:2,theme:"primary",type:"submit",loading:i.value},{default:a(()=>[...D[46]||(D[46]=[f("提交创建",-1)])]),_:1},8,["loading"])):O("",!0)]),_:1})]),_:1},8,["data","rules"])])):O("",!0),v.value?(r(),C("div",pc,[t("div",vc,"正在创建整合包实例 ("+M(S.value)+")",1),D[47]||(D[47]=t("p",null,"正在解压文件并配置环境...",-1)),e(Ae,{theme:"plump",percentage:c.value,label:`${c.value.toFixed(2)}%`},null,8,["percentage","label"]),t("div",{ref_key:"logContainerRef",ref:A,class:"log-container"},[e(kt,{split:!0},{default:a(()=>[(r(!0),C(pe,null,we(_.value,(he,ha)=>(r(),K(st,{key:ha},{default:a(()=>[e(vt,{description:`[${he.time}] ${he.message}`},null,8,["description"])]),_:2},1024))),128))]),_:1})],512)])):O("",!0),u.value?(r(),C("div",fc,[e(Ue,{class:"result-success-icon",name:"check-circle"}),D[50]||(D[50]=t("div",{class:"result-success-title"},"整合包服务器已部署成功",-1)),D[51]||(D[51]=t("div",{class:"result-success-describe"},"文件已解压，环境已配置就绪",-1)),t("div",null,[e(Ce,{onClick:D[15]||(D[15]=()=>{me(),b(Ie)("/instance/list")})},{default:a(()=>[...D[48]||(D[48]=[f(" 返回服务端列表 ",-1)])]),_:1}),e(Ce,{theme:"default",onClick:D[16]||(D[16]=()=>{me(),b(Ie)(`/instance/console/${S.value}`)})},{default:a(()=>[...D[49]||(D[49]=[f(" 前往控制台 ",-1)])]),_:1})])])):O("",!0)])]),e(Ha,{visible:w.value,"onUpdate:visible":D[17]||(D[17]=he=>w.value=he),onConfirm:F},null,8,["visible"])])}}}),_c=re(gc,[["__scopeId","data-v-412b9974"]]),hc=ne({__name:"index",setup(s){const n=$(1);return(l,d)=>{const o=p("t-tab-panel"),i=p("t-tabs"),v=p("t-card");return r(),C("div",null,[e(v,{direction:"vertical"},{default:a(()=>[e(i,{modelValue:n.value,"onUpdate:modelValue":d[0]||(d[0]=u=>n.value=u)},{default:a(()=>[e(o,{value:1,label:"快速模式","destroy-on-hide":!1},{default:a(()=>[e(Cd,{style:{margin:"10px"}})]),_:1}),e(o,{value:2,label:"上传整合包模式","destroy-on-hide":!1},{default:a(()=>[e(_c,{style:{margin:"10px"}})]),_:1}),e(o,{value:3,label:"自定义模式","destroy-on-hide":!1},{default:a(()=>[e(Ud,{style:{margin:"10px"}})]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}}),yc=Object.freeze(Object.defineProperty({__proto__:null,default:hc},Symbol.toStringTag,{value:"Module"})),bc={class:"backup-page-container"},wc={class:"page-header"},kc={key:0,class:"loading-wrapper"},$c={key:1,class:"card-list"},Ac={class:"card-header"},xc={class:"header-left"},Cc={class:"instance-info"},Sc={class:"instance-name"},Ic={class:"instance-core"},Vc={class:"header-right"},Mc={class:"path-section"},Uc=["onClick"],Lc={key:0,class:"backup-table-area"},Bc={key:0,class:"table-toolbar"},Rc={class:"selected-count"},zc={class:"file-name-cell"},Ec=["title"],Pc={class:"op-buttons"},Fc={key:1,class:"empty-backups"},Tc=ne({__name:"index",setup(s){const n=$(!1),l=$([]),d=$(new Set),o=$({}),i=[{colKey:"row-select",type:"multiple",width:30,fixed:"left"},{colKey:"fileName",title:"文件名",ellipsis:!0},{colKey:"fileSizeStr",title:"大小",width:100},{colKey:"createTime",title:"创建时间",width:180},{colKey:"op",title:"操作",width:140,fixed:"right"}],v=te(()=>[...l.value].sort((g,U)=>{const I=g.backups&&g.backups.length>0,m=U.backups&&U.backups.length>0;return I&&!m?-1:!I&&m?1:g.id-U.id})),u=async()=>{n.value=!0;try{const w=await ai();l.value=w||[]}catch(w){L.error("获取备份列表失败"),console.error(w)}finally{n.value=!1}},c=w=>{d.value.has(w)?d.value.delete(w):d.value.add(w)},_=(w,g)=>{const U=Ba(w,g);window.open(U,"_blank")},h=async(w,g)=>{const U=Ze.confirm({header:"确认删除",body:`确定要删除选中的 ${g.length} 个备份文件吗？此操作不可恢复。`,theme:"danger",onConfirm:async()=>{U.hide();const I=L.loading("正在删除中...");try{const m=g.map(x=>La(w,x));await Promise.all(m),L.success("删除成功"),o.value[w]&&(o.value[w]=[]),await u()}catch(m){L.error("部分文件删除失败，请重试 "+m.message)}finally{L.close(I)}}})},S=(w,g)=>{h(w,[g])},A=w=>{const g=o.value[w];if(!g||g.length===0){L.warning("请先选择要删除的文件");return}h(w,g)},z=(w,{_row:g},U)=>{o.value={...o.value,[U]:w}};return xe(()=>{u()}),(w,g)=>{const U=p("t-button"),I=p("t-loading"),m=p("t-tag"),x=p("t-table"),y=p("t-card");return r(),C("div",bc,[t("div",wc,[g[1]||(g[1]=t("div",{class:"title-area"},[t("h2",{class:"page-title"},"实例备份管理"),t("p",{class:"page-desc"},"管理所有服务器实例的本地备份文件")],-1)),e(U,{theme:"primary",variant:"text",loading:n.value,onClick:u},{icon:a(()=>[e(b(at))]),default:a(()=>[g[0]||(g[0]=f(" 刷新列表 ",-1))]),_:1},8,["loading"])]),n.value&&l.value.length===0?(r(),C("div",kc,[e(I,{text:"加载数据中...",size:"small"})])):(r(),C("div",$c,[e(gn,{name:"list-anim"},{default:a(()=>[(r(!0),C(pe,null,we(v.value,E=>(r(),C("div",{key:E.id,class:"instance-card-wrapper"},[e(y,{bordered:!1,class:ye(["instance-card",{"is-empty":!E.backups?.length}])},{default:a(()=>[t("div",Ac,[t("div",xc,[e(m,{theme:"primary",variant:"light",shape:"mark"},{default:a(()=>[f("ID: "+M(E.id),1)]),_:2},1024),t("div",Cc,[t("h3",Sc,[e(b(St),{class:"icon-mr"}),f(" "+M(E.name),1)]),t("span",Ic,[e(b(Bt),{class:"icon-mr"}),f(" "+M(E.core),1)])])]),t("div",Vc,[E.backups?.length?(r(),K(m,{key:0,theme:"success",variant:"outline"},{default:a(()=>[f(M(E.backups.length)+" 个备份 ",1)]),_:2},1024)):(r(),K(m,{key:1,theme:"default",disabled:""},{default:a(()=>[...g[2]||(g[2]=[f("无备份",-1)])]),_:1}))])]),t("div",Mc,[t("div",{class:"path-toggle",onClick:T=>c(E.id)},[e(b(_n)),g[3]||(g[3]=t("span",{class:"label"},"存储路径",-1)),(r(),K(lt(d.value.has(E.id)?b(hn):b(yn)),{class:"toggle-icon"}))],8,Uc),Ye(t("div",{class:"path-content"},M(E.backupPath),513),[[nt,d.value.has(E.id)]])]),E.backups?.length?(r(),C("div",Lc,[o.value[E.id]?.length>0?(r(),C("div",Bc,[t("span",Rc,"已选 "+M(o.value[E.id].length)+" 项",1),e(U,{theme:"danger",variant:"text",size:"small",onClick:T=>A(E.id)},{default:a(()=>[...g[4]||(g[4]=[f(" 批量删除 ",-1)])]),_:1},8,["onClick"])])):O("",!0),e(x,{"row-key":"fileName",data:E.backups,columns:i,"selected-row-keys":o.value[E.id]||[],size:"small",hover:!0,pagination:E.backups.length>5?{pageSize:5}:null,onSelectChange:(T,V)=>z(T,V,E.id)},{fileName:a(({row:T})=>[t("div",zc,[g[5]||(g[5]=t("span",{class:"zip-icon"},"ZIP",-1)),t("span",{class:"text",title:T.fileName},M(T.fileName),9,Ec)])]),op:a(({row:T})=>[t("div",Pc,[e(U,{theme:"primary",variant:"text",size:"small",onClick:V=>_(E.id,T.fileName)},{icon:a(()=>[e(b(ca))]),default:a(()=>[g[6]||(g[6]=f(" 下载 ",-1))]),_:1},8,["onClick"]),e(U,{theme:"danger",variant:"text",size:"small",onClick:V=>S(E.id,T.fileName)},{icon:a(()=>[e(b(wt))]),default:a(()=>[g[7]||(g[7]=f(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:2},1032,["data","columns","selected-row-keys","pagination","onSelectChange"])])):(r(),C("div",Fc,[...g[8]||(g[8]=[t("span",{class:"empty-text"},"当前实例暂无备份文件",-1)])]))]),_:2},1032,["class"])]))),128))]),_:1})]))])}}}),Dc=re(Tc,[["__scopeId","data-v-02bc58e2"]]),Oc=Object.freeze(Object.defineProperty({__proto__:null,default:Dc},Symbol.toStringTag,{value:"Module"})),jc={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function Kc(s,n){return r(),C("svg",jc,[...n[0]||(n[0]=[Pt('<g mask="url(#mask0_17_619)"><path fill="#97A3B7" d="M30 62h88v60H30z"></path><g filter="url(#filter0_f_17_619)"><path fill="#E3E6EB" d="M12 84h80v60H12z"></path></g><g filter="url(#filter1_f_17_619)"><path fill="#E3E6EB" d="M80 54h80v60H80z"></path></g><path fill="#fff" d="M46 105h32v2H46zM46 98h32v2H46zM46 88h16v2H46z"></path></g><path fill="currentcolor" d="M63 20h88v10H63z" opacity=".9"></path><mask id="a" width="88" height="50" x="63" y="30" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="currentcolor" d="M63 30h88v50H63z"></path></mask><g mask="url(#a)"><path fill="currentcolor" d="M63 30h88v50H63z"></path><g filter="url(#filter2_f_17_619)" opacity=".3"><path fill="#97A3B7" d="M30 62h88v60H30z"></path></g></g><path fill="#fff" fill-rule="evenodd" d="m95.686 40.858 10.278 10.277A4 4 0 0 1 107 51c2.213 0 4 1.786 4 4q-.002.538-.134 1.033l10.276 10.28-2.828 2.829-4.598-4.597A17.1 17.1 0 0 1 107 65.909c-7.273 0-13.484-4.524-16-10.91a17.3 17.3 0 0 1 5.696-7.472l-3.838-3.84zM99 55a8.003 8.003 0 0 0 12.063 6.892l-3.029-3.026q-.496.132-1.034.134c-2.213 0-4-1.787-4-4q.002-.538.134-1.034l-3.027-3.027A7.96 7.96 0 0 0 99 54.999m8-10.91c7.273 0 13.484 4.524 16 10.91a17.3 17.3 0 0 1-4.166 6.177l-4.105-4.105a8.003 8.003 0 0 0-9.801-9.8l-2.55-2.551c1.47-.41 3.02-.63 4.622-.63" clip-rule="evenodd"></path><path fill="#fff" d="M68 24h2v2h-2zM74 24h2v2h-2zM80 24h66v2H80z"></path><path fill="#fff" stroke="#000" d="m157 54 24.249 42h-48.498z"></path><path stroke="#000" d="M157 89V71"></path>',8)])])}const fs={render:Kc},Nc={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function qc(s,n){return r(),C("svg",Nc,[...n[0]||(n[0]=[Pt('<g mask="url(#mask0_16559_24301)"><path fill="#97A3B7" d="M30 62h88v60H30z"></path><g filter="url(#filter0_f_16559_24301)"><path fill="#E3E6EB" d="M12 84h80v60H12z"></path></g><g filter="url(#filter1_f_16559_24301)"><path fill="#E3E6EB" d="M80 54h80v60H80z"></path></g><path stroke="#fff" stroke-width="2" d="m49 93-7 7 7 7M69 107l7-7-7-7M62.365 87.443l-6.73 25.114"></path></g><path fill="currentcolor" d="M63 20h88v10H63z" opacity=".9"></path><mask id="a" width="88" height="50" x="63" y="30" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="currentcolor" d="M63 30h88v50H63z"></path></mask><g mask="url(#a)"><path fill="currentcolor" d="M63 30h88v50H63z"></path><g filter="url(#filter2_f_16559_24301)" opacity=".3"><path fill="#97A3B7" d="M30 62h88v60H30z"></path></g></g><path fill="#fff" fill-rule="evenodd" d="M105.25 41c6.765 0 12.25 5.484 12.25 12.25 0 2.433-.709 4.7-1.932 6.606L121 65.288 117.288 69l-5.432-5.432a12.2 12.2 0 0 1-6.606 1.932C98.484 65.5 93 60.016 93 53.25S98.484 41 105.25 41m0 3.5a8.75 8.75 0 1 0 0 17.5 8.75 8.75 0 0 0 0-17.5" clip-rule="evenodd"></path><path fill="#fff" d="M68 24h2v2h-2zM74 24h2v2h-2zM80 24h66v2H80z"></path><path fill="#fff" fill-rule="evenodd" d="M153 56c-12.15 0-22 9.85-22 22 0 4.604 1.414 8.878 3.832 12.41L127 98.5l12.495-3.132A21.9 21.9 0 0 0 153 100c12.15 0 22-9.85 22-22s-9.85-22-22-22" clip-rule="evenodd"></path><path fill="#000" d="M131 78h.5zm3.832 12.41.359.348.284-.293-.23-.337zM127 98.5l-.359-.348-1.219 1.259 1.7-.426zm12.495-3.132.307-.394-.192-.15-.237.06zM153 100v.5zm22-22h-.5zm-43.5 0c0-11.874 9.626-21.5 21.5-21.5v-1c-12.426 0-22.5 10.074-22.5 22.5zm3.745 12.128A21.4 21.4 0 0 1 131.5 78h-1c0 4.708 1.446 9.08 3.919 12.693zm-.772-.066-7.832 8.09.718.696 7.832-8.09zm-7.351 8.923 12.494-3.132-.243-.97-12.495 3.132zM153 99.5c-4.976 0-9.555-1.69-13.198-4.526l-.615.789A22.4 22.4 0 0 0 153 100.5zM174.5 78c0 11.874-9.626 21.5-21.5 21.5v1c12.426 0 22.5-10.074 22.5-22.5zM153 56.5c11.874 0 21.5 9.626 21.5 21.5h1c0-12.426-10.074-22.5-22.5-22.5z"></path>',8)])])}const Gc={render:qc},Hc={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function Jc(s,n){return r(),C("svg",Hc,[...n[0]||(n[0]=[Pt('<g mask="url(#mask0_16559_24251)"><path fill="#97A3B7" d="m68 48 38.105 22v44L68 136l-38.105-22V70z"></path><g filter="url(#a)"><path fill="#E3E6EB" d="M46.391 92h80v60h-80z"></path></g><g filter="url(#b)"><path fill="#E3E6EB" d="M0 23h80v60H0z"></path></g></g><mask id="c" width="78" height="88" x="80" y="9" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="currentcolor" d="m119 9 38.105 22v44L119 97 80.895 75V31z"></path></mask><g mask="url(#c)"><path fill="currentcolor" fill-rule="evenodd" d="M80.895 31v44L119 97l38.105-22V31L119 53z" clip-rule="evenodd"></path><path fill="currentcolor" d="m119-35 38.105 22v44.5L119 53.5l-38.105-22V-13z" opacity=".9"></path><g filter="url(#d)" opacity=".3"><path fill="#97A3B7" d="m68 48 38.105 22v44L68 136l-38.105-22V70z"></path></g></g><path fill="#fff" stroke="#000" d="m143 68.822 4.867 17.053.133.466.469-.118 17.202-4.312-12.335 12.741-.337.348.337.348 12.335 12.741-17.202-4.312-.469-.118-.133.466L143 121.178l-4.867-17.053-.133-.466-.469.118-17.202 4.312 12.335-12.741.337-.348-.337-.348-12.335-12.741 17.202 4.312.469.118.133-.466z"></path><path fill="#fff" fill-rule="evenodd" d="m123.243 35.082 2.828-1.633-2.828-1.633-2.829 1.633zM119 32.632 121.828 31l-7.071-4.082-2.828 1.633zm8.485 3.267c-4.679 2.701-12.291 2.701-16.97 0-4.68-2.702-4.68-7.096 0-9.798s12.291-2.701 16.97 0c4.68 2.702 4.68 7.096 0 9.798m-19.799-11.43c-6.248 3.607-6.248 9.455 0 13.062s16.38 3.607 22.628 0 6.248-9.455 0-13.062-16.38-3.607-22.628 0M41.899 86.286l2.828 1.633v6.532L41.9 92.818zm12.02 6.94 2.829 1.634v6.532l-2.828-1.633zm-9.19 14.289-2.83-1.633.001 3.266 2.828 1.633zl9.192 5.307v3.266l2.828 1.633v-3.266l-2.828-1.633v-3.266l-9.192-5.307z" clip-rule="evenodd"></path><defs><filter id="a" width="180" height="160" x="-3.609" y="42" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_16559_24251" stdDeviation="25"></feGaussianBlur></filter><filter id="b" width="180" height="160" x="-50" y="-27" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_16559_24251" stdDeviation="25"></feGaussianBlur></filter><filter id="d" width="88.21" height="100" x="23.895" y="42" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_16559_24251" stdDeviation="3"></feGaussianBlur></filter></defs>',6)])])}const Wc={render:Jc},Xc={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function Qc(s,n){return r(),C("svg",Xc,[...n[0]||(n[0]=[Pt('<g mask="url(#mask0_22_990)"><path fill="#97A3B7" fill-rule="evenodd" d="m144.569 105.61-48 27.712-48-27.712V83.712L96.57 56l48 27.713z" clip-rule="evenodd"></path><g filter="url(#filter0_f_22_990)"><path fill="#E3E6EB" d="M-3 33.999h80v60H-3z"></path></g><g filter="url(#filter1_f_22_990)"><path fill="#E3E6EB" d="M97 97.999h80v60H97z"></path></g></g><mask id="a" width="86" height="69" x="53" y="16" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="currentcolor" fill-rule="evenodd" d="m113.357 42.715 16.472-9.51a36 36 0 0 0-3.186-2.043c-5.375-3.104-11.92-5.147-18.885-6.139-4.209-5.562-10.18-8.898-17.324-8.828-6.755.087-15.486 5.746-21.507 14.365q-1.247.622-2.432 1.306c-14.378 8.3-16.94 20.75-7.473 30.065-1.035-5.805-.31-10.865 3.101-16.215-.058.632-.21 4.427-.232 5.067-.67 18.914 15.02 34.058 26.139 33.928 8.45-.1 15.565-5.013 20.319-12.631 6.214-1.231 12.089-3.294 17.094-6.183 13.476-7.78 16.567-19.182 9.104-28.268l-16.599 9.582c1.762 3.654.049 7.823-5.078 10.783-5.126 2.96-12.347 3.948-18.677 2.931-2.843-.469-5.522-1.342-7.74-2.622l-.049-.028zM78.655 53.773c-6.127-3.977-5.683-10.226 1.195-14.197s17.703-4.226 24.591-.69zM93.556 18.17c4.61-.04 8.728 2.405 11.94 6.57-8.447-.918-17.384-.326-25.523 1.765 3.699-5.124 8.471-8.275 13.583-8.335m-2.232 63.447c-5.853.068-10.971-3.926-14.377-10.332 8.845 2.342 18.925 2.775 28.427 1.317-3.756 5.52-8.714 8.951-14.05 9.015" clip-rule="evenodd"></path></mask><g mask="url(#a)"><path fill="currentcolor" fill-rule="evenodd" d="m113.357 42.715 16.472-9.51a36 36 0 0 0-3.186-2.043c-5.375-3.104-11.92-5.147-18.885-6.139-4.209-5.562-10.18-8.898-17.324-8.828-6.755.087-15.486 5.746-21.507 14.365q-1.247.622-2.432 1.306c-14.378 8.3-16.94 20.75-7.473 30.065-1.035-5.805-.31-10.865 3.101-16.215-.058.632-.21 4.427-.232 5.067-.67 18.914 15.02 34.058 26.139 33.928 8.45-.1 15.565-5.013 20.319-12.631 6.214-1.231 12.089-3.294 17.094-6.183 13.476-7.78 16.567-19.182 9.104-28.268l-16.599 9.582c1.762 3.654.049 7.823-5.078 10.783-5.126 2.96-12.347 3.948-18.677 2.931-2.843-.469-5.522-1.342-7.74-2.622l-.049-.028zM78.655 53.773c-6.127-3.977-5.683-10.226 1.195-14.197s17.703-4.226 24.591-.69zM93.556 18.17c4.61-.04 8.728 2.405 11.94 6.57-8.447-.918-17.384-.326-25.523 1.765 3.699-5.124 8.471-8.275 13.583-8.335m-2.232 63.447c-5.853.068-10.971-3.926-14.377-10.332 8.845 2.342 18.925 2.775 28.427 1.317-3.756 5.52-8.714 8.951-14.05 9.015" clip-rule="evenodd"></path><g filter="url(#filter2_f_22_990)" opacity=".3"><path fill="#97A3B7" d="m96.569 56 48 27.712v55.426l-48 27.712-48-27.712V83.712z"></path></g></g><circle cx="155" cy="78" r="22" fill="#fff" stroke="#000" transform="rotate(180 155 78)"></circle><path stroke="#000" d="M155 83V65"></path><path fill="#C4C4C4" stroke="#000" stroke-linejoin="round" stroke-width="2" d="M155 87h.004v.004H155z"></path><path stroke="#fff" stroke-width="2" d="M96.57 112V88M86.57 98l10-10 9.999 10"></path>',7)])])}const Yc={render:Qc},Zc={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function em(s,n){return r(),C("svg",Zc,[...n[0]||(n[0]=[Pt('<g mask="url(#mask0_21_716)"><path fill="#97A3B7" fill-rule="evenodd" d="M33 46.843 96.321 119l63.322-72.157C142.742 32 120.583 23 96.321 23 72.061 23 49.901 32 33 46.843" clip-rule="evenodd"></path><g filter="url(#filter0_f_21_716)"><path fill="#E3E6EB" d="M95 21h80v60H95z"></path></g><g filter="url(#filter1_f_21_716)"><path fill="#E3E6EB" d="M-7 43h80v60H-7z"></path></g></g><path fill="currentcolor" d="m72.812 63.688-3.157 3.157 6.246 6.247a50.3 50.3 0 0 0-12.713 8.151L96.321 119l11.913-13.575 6.413 6.412 3.157-3.157L80.45 71.326zM129.455 81.243l-15.318 17.455-28.74-28.74a50.4 50.4 0 0 1 10.924-1.19c12.695 0 24.29 4.709 33.134 12.475"></path><path fill="#fff" stroke="#000" d="m152 21.822 4.867 17.053.133.465.469-.117 17.202-4.312-12.335 12.741-.337.348.337.348 12.335 12.741-17.202-4.312-.469-.117-.133.465L152 74.178l-4.867-17.053-.133-.465-.469.117-17.202 4.312 12.335-12.741.337-.348-.337-.348-12.335-12.741 17.202 4.312.469.117.133-.465z"></path><path stroke="#fff" stroke-width="2" d="M101 31 90 42l11 11-8 8"></path>',4)])])}const tm={render:em},am={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"140",fill:"none"};function sm(s,n){return r(),C("svg",am,[...n[0]||(n[0]=[Pt('<mask id="a" width="78" height="88" x="80" y="9" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="currentColor" d="m119 9 38.105 22v44L119 97 80.895 75V31z"></path></mask><g mask="url(#a)"><path fill="currentColor" d="m119 9 38.105 22v44L119 97 80.895 75V31z"></path><g filter="url(#b)" opacity=".3"><path fill="#97A3B7" d="m68 48 38.105 22v44L68 136l-38.105-22V70z"></path></g></g><mask id="c" width="78" height="88" x="29" y="48" maskUnits="userSpaceOnUse" style="mask-type:alpha;"><path fill="#97A3B7" d="m68 48 38.105 22v44L68 136l-38.105-22V70z"></path></mask><g mask="url(#c)"><path fill="#97A3B7" d="m68 48 38.105 22v44L68 136l-38.105-22V70z"></path><g filter="url(#d)"><path fill="#E3E6EB" d="M46.391 92h80v60h-80z"></path></g><g filter="url(#e)"><path fill="#E3E6EB" d="M0 23h80v60H0z"></path></g></g><path fill="#fff" d="m41.898 86.287 2.829 1.633v6.531l-2.828-1.632zM53.919 93.227l2.828 1.633v6.532l-2.828-1.633zM44.728 107.515l-2.829-1.633v3.266l2.829 1.633zl9.191 5.308v3.265l2.829 1.633v-3.266l-2.828-1.632v-3.266l-9.193-5.308z"></path><path fill="#fff" fill-rule="evenodd" d="M108.348 23.48c-2.16 2.51-1.813 5.903 1.047 8.08 3.265 2.486 8.568 2.447 11.845-.087 3.276-2.534 3.286-6.603.021-9.089-2.86-2.177-7.284-2.417-10.54-.74l5.202 3.96-2.373 1.836z" clip-rule="evenodd"></path><path fill="#fff" fill-rule="evenodd" d="m120.865 33.009 8.965 6.826 2.373-1.836-8.965-6.826q-.481.523-1.089.993-.608.468-1.284.843m-1.203-.916a8.5 8.5 0 0 0 1.305-.828 7.248 7.248 0 0 1 0 0 8.5 8.5 0 0 1-1.305.828" clip-rule="evenodd"></path><path fill="#fff" stroke="#181818" d="m144 70 24.249 42h-48.498z"></path><path stroke="#181818" d="M144 100V82"></path><path stroke="#181818" stroke-linejoin="round" stroke-width="2" d="M144 105h.004v.004H144z"></path><defs><filter id="b" width="88.21" height="100" x="23.895" y="42" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_216_313" stdDeviation="3"></feGaussianBlur></filter><filter id="d" width="180" height="160" x="-3.609" y="42" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_216_313" stdDeviation="25"></feGaussianBlur></filter><filter id="e" width="180" height="160" x="-50" y="-27" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_216_313" stdDeviation="25"></feGaussianBlur></filter></defs>',11)])])}const nm={render:sm},lm={class:"result-container"},om={class:"result-bg-img"},rm={class:"result-title"},im={class:"result-tip"},um=ne({__name:"index",props:{bgUrl:String,title:String,tip:String,type:String},setup(s){const n=s,l=te(()=>{switch(n.type){case"403":return fs;case"404":return Gc;case"500":return Wc;case"ie":return Yc;case"wifi":return tm;case"maintenance":return nm;default:return fs}});return(d,o)=>(r(),C("div",lm,[t("div",om,[(r(),K(lt(l.value)))]),t("div",rm,M(s.title),1),t("div",im,M(s.tip),1),bn(d.$slots,"default",{},void 0)]))}}),gs=re(um,[["__scopeId","data-v-a2dee5ff"]]);async function dm(s,n,l,d="toml"){return await X.post({url:"/api/frp/add",data:{name:s,config:n,provider:l,format:d}})}async function cm(s){return await X.post({url:"/api/frp/delete",data:{id:s}})}function mm(){return X.get({url:"/api/frp/list"})}function _s(s,n){return X.post({url:"/api/frp/action",data:{action:s,id:n}})}function pm(s){return X.get({url:"/api/frp/info",params:{id:s}})}function vm(){return X.get({url:"/api/frp/autostart"})}function fm(s){return X.post({url:"/api/frp/autostart",data:{frpIds:s}})}const Xa=bt("tunnels",()=>{const s=$([]);async function n(){try{s.value=await mm()}catch(l){L.error("获取Frp列表失败:"+l.message)}}return{frpList:s,getTunnels:n}}),gm={class:"dashboard-wrapper"},_m={class:"content-container"},hm={class:"page-header"},ym=["onClick"],bm={class:"card-inner"},wm={class:"header-row"},km={class:"icon-box"},$m={class:"title-section"},Am={class:"card-title"},xm={class:"card-subtitle"},Cm={class:"tags-row"},Sm={class:"hover-action"},Im={class:"auto-start-content"},Vm={class:"tunnel-label"},Mm={class:"tag"},Um={class:"name"},Lm={class:"id"},Bm={key:0,class:"empty-tip"},Rm=ne({__name:"index",setup(s){const n=Xa(),l=$(!0),d=$(!1),o=Xe({visible:!1,loading:!1,submitting:!1,selectedIds:[]}),i=async()=>{o.visible=!0,o.loading=!0;try{n.frpList.length===0&&await n.getTunnels();const S=await vm();o.selectedIds=S||[]}catch(S){L.error("获取自启动配置失败 "+S.message)}finally{o.loading=!1}},v=async()=>{o.submitting=!0;try{await fm(o.selectedIds),L.success("自启动设置已更新"),o.visible=!1}catch(S){L.error("保存失败: "+S.message)}finally{o.submitting=!1}},u=S=>({toml:"primary",ini:"warning",cmd:"danger",json:"success"})[S]||"default";async function c(){try{l.value=!0,d.value=!1,await n.getTunnels()}catch(S){console.error(S),d.value=!0}finally{l.value=!1}}const _=S=>{Ie(`/frp/console/${S.id}`)},h=S=>{const A=Ze.confirm({header:"确认删除隧道?",body:"删除后该隧道将无法恢复。确定要继续吗？",theme:"danger",onConfirm:async()=>{try{await cm(S),L.success(`隧道 ${S} 删除成功`),await c(),A.hide()}catch(z){L.error(z.message)}},onClose:()=>{A.hide()}})};return xe(()=>{c()}),(S,A)=>{const z=p("t-button"),w=p("t-space"),g=p("t-loading"),U=p("t-tag"),I=p("t-col"),m=p("t-row"),x=p("t-alert"),y=p("t-checkbox"),E=p("t-checkbox-group"),T=p("t-dialog");return r(),C("div",gm,[t("div",_m,[t("div",hm,[A[7]||(A[7]=t("h2",{class:"title"},"隧道列表",-1)),e(w,null,{default:a(()=>[e(z,{theme:"primary",variant:"dashed",onClick:c},{default:a(()=>[...A[4]||(A[4]=[f(" 刷新列表 ",-1)])]),_:1}),e(z,{theme:"default",variant:"outline",onClick:i},{default:a(()=>[...A[5]||(A[5]=[f(" 设置自启动 ",-1)])]),_:1}),e(z,{theme:"primary",onClick:A[0]||(A[0]=V=>b(Ie)("/frp/create"))},{default:a(()=>[...A[6]||(A[6]=[f(" 创建隧道 ",-1)])]),_:1})]),_:1})]),l.value?(r(),K(g,{key:0,size:"medium",text:"加载中...",class:"loading-box"})):d.value?(r(),K(gs,{key:1,title:"获取数据失败",tip:"无法连接到服务器，请检查网络或稍后重试",type:"500"},{default:a(()=>[e(z,{onClick:c},{default:a(()=>[...A[8]||(A[8]=[f("重试",-1)])]),_:1})]),_:1})):b(n).frpList.length===0?(r(),K(gs,{key:2,title:"暂无隧道",tip:"您还没有创建任何 Frp 隧道，快去创建一个吧",type:"404"},{default:a(()=>[e(z,{onClick:A[1]||(A[1]=V=>b(Ie)("/frp/create"))},{default:a(()=>[...A[9]||(A[9]=[f("创建隧道",-1)])]),_:1})]),_:1})):(r(),K(m,{key:3,gutter:[20,20]},{default:a(()=>[(r(!0),C(pe,null,we(b(n).frpList,V=>(r(),K(I,{key:V.id,span:24,xs:12,sm:6,md:6,lg:4,xl:4},{default:a(()=>[t("div",{class:"design-card",onClick:N=>_(V)},[t("div",{class:"status-bar",style:dt({background:V.status?"var(--td-success-color)":"var(--td-component-stroke)"})},null,4),t("div",bm,[t("div",wm,[t("div",km,[e(b(St))]),e(U,{variant:"light",theme:V.status?"success":"warning"},{default:a(()=>[f(M(V.status?"运行中":"未运行"),1)]),_:2},1032,["theme"])]),t("div",$m,[t("h3",Am,M(V.name),1),t("div",xm,"ID: "+M(V.id),1)]),t("div",Cm,[e(U,{size:"small",variant:"light",shape:"round"},{icon:a(()=>[e(b(Bt))]),default:a(()=>[f(" "+M(V.service),1)]),_:2},1024),e(U,{size:"small",theme:u(V.configType),variant:"outline",shape:"round"},{default:a(()=>[f(M(V.configType),1)]),_:2},1032,["theme"]),e(z,{shape:"circle",theme:"danger",size:"small",onClick:[N=>h(V.id),jt(()=>{},["stop"])]},{icon:a(()=>[e(b(wt))]),_:1},8,["onClick"])]),t("div",Sm,[e(b(wn))])])],8,ym)]),_:2},1024))),128))]),_:1}))]),e(T,{visible:o.visible,"onUpdate:visible":A[3]||(A[3]=V=>o.visible=V),header:"设置开机自启动隧道",width:"600px","confirm-btn":{content:"保存设置",loading:o.submitting},onConfirm:v},{default:a(()=>[e(g,{loading:o.loading,text:"正在读取配置...",size:"small"},{default:a(()=>[t("div",Im,[e(x,{theme:"info",message:"勾选的隧道将在守护进程启动时自动运行",style:{"margin-bottom":"16px"}}),e(E,{modelValue:o.selectedIds,"onUpdate:modelValue":A[2]||(A[2]=V=>o.selectedIds=V),class:"tunnel-checkbox-group"},{default:a(()=>[e(m,{gutter:[16,16]},{default:a(()=>[(r(!0),C(pe,null,we(b(n).frpList,V=>(r(),K(I,{key:V.id,span:12},{default:a(()=>[e(y,{value:V.id,class:"tunnel-item"},{default:a(()=>[t("div",Vm,[t("span",Mm,[e(U,{theme:"primary"},{default:a(()=>[f(M(V.service),1)]),_:2},1024)]),t("span",Um,M(V.name),1),t("span",Lm,"#"+M(V.id),1)])]),_:2},1032,["value"])]),_:2},1024))),128))]),_:1})]),_:1},8,["modelValue"]),b(n).frpList.length===0?(r(),C("div",Bm,"暂无可用隧道")):O("",!0)])]),_:1},8,["loading"])]),_:1},8,["visible","confirm-btn"])])}}}),zm=re(Rm,[["__scopeId","data-v-b798d09c"]]),Em=Object.freeze(Object.defineProperty({__proto__:null,default:zm},Symbol.toStringTag,{value:"Module"})),Pm=Xa();async function Qa(s,n,l,d="toml"){await dm(s,n,l,d),L.success("添加成功"),await Pm.getTunnels(),Ie("/frp/list")}const Fm={class:"custom-frp-container"},Tm=ne({__name:"Custom",setup(s){const n=$(null),l=Xe({name:"",type:"toml",content:""}),d={name:[{required:!0,message:"请输入隧道名称",type:"error"}],content:[{required:!0,message:"配置文件内容不能为空",type:"error"}]},o=async({validateResult:u})=>{u===!0?await Qa(l.name,l.content,"Custom",l.type):L.warning("请检查表单填写")},i=()=>{L.info("表单已重置")},v=()=>{const u=l.content.trim();if(!u){L.warning("请先输入 INI 配置内容");return}const c={tls_enable:"transport.tls.enable",token:"auth.token",protocol:"transport.protocol",pool_count:"transport.poolCount",tcp_mux:"transport.tcpMux",login_fail_exit:"loginFailExit",custom_domains:"customDomains",locations:"locations",host_header_rewrite:"hostHeaderRewrite",role:"role",sk:"sk"};try{const _=u.split(/\r?\n/);let h="";const S={},A=[];let z=null;_.forEach(g=>{const U=g.trim();if(!U||U.startsWith("#")||U.startsWith(";"))return;const I=U.match(/^\[(.+)\]$/);if(I){h=I[1],h==="common"?z=null:(z={name:h},A.push(z));return}const m=U.match(/^([^=]+)=(.*)$/);if(m){const x=m[1].trim();let y=m[2].trim(),E=x;c[x]?E=c[x]:(E=E.replace(/_([a-z])/g,(T,V)=>V.toUpperCase()),E=E.replace(/Ip/g,"IP")),y==="true"?y=!0:y==="false"?y=!1:!isNaN(Number(y))&&y!==""?y=Number(y):y=String(y),h==="common"||!h?S[E]=y:z&&(z[E]=y)}});let w="";Object.entries(S).forEach(([g,U])=>{const I=typeof U=="string"?`"${U}"`:U;w+=`${g} = ${I}
`}),A.forEach(g=>{w+=`
[[proxies]]
`,Object.entries(g).forEach(([U,I])=>{const m=typeof I=="string"?`"${I}"`:I;w+=`${U} = ${m}
`})}),l.content=w.trim(),l.type="toml",L.success("已转换为 TOML")}catch(_){console.error(_),L.error("转换失败，请检查输入格式")}};return(u,c)=>{const _=p("t-input"),h=p("t-form-item"),S=p("t-radio-button"),A=p("t-radio-group"),z=p("t-button"),w=p("t-textarea"),g=p("t-space"),U=p("t-form"),I=p("t-card");return r(),C("div",Fm,[e(I,{bordered:!1},{header:a(()=>[...c[3]||(c[3]=[t("span",{style:{"font-weight":"bold","font-size":"16px"}},"自定义 Frp 隧道",-1)])]),default:a(()=>[e(U,{ref_key:"formRef",ref:n,data:l,rules:d,"label-align":"top",onReset:i,onSubmit:o},{default:a(()=>[e(h,{label:"隧道名称",name:"name"},{default:a(()=>[e(_,{modelValue:l.name,"onUpdate:modelValue":c[0]||(c[0]=m=>l.name=m),placeholder:"请输入隧道名称"},null,8,["modelValue"])]),_:1}),e(h,{label:"配置类型",name:"type"},{default:a(()=>[e(A,{modelValue:l.type,"onUpdate:modelValue":c[1]||(c[1]=m=>l.type=m),variant:"default-filled"},{default:a(()=>[e(S,{value:"toml"},{default:a(()=>[...c[4]||(c[4]=[f("TOML",-1)])]),_:1}),e(S,{value:"ini"},{default:a(()=>[...c[5]||(c[5]=[f("INI",-1)])]),_:1})]),_:1},8,["modelValue"]),l.type==="ini"?(r(),K(z,{key:0,style:{"margin-left":"8px"},variant:"outline",theme:"primary",size:"small",onClick:v},{default:a(()=>[...c[6]||(c[6]=[f(" 一键转 TOML ",-1)])]),_:1})):O("",!0)]),_:1}),e(h,{label:"隧道配置内容",name:"content"},{default:a(()=>[e(w,{modelValue:l.content,"onUpdate:modelValue":c[2]||(c[2]=m=>l.content=m),placeholder:`serverAddr = "0.0.0.0"
serverPort = 1027

[[proxies]]
name = "nahida_tcp"
...`,autosize:{minRows:10,maxRows:25},class:"code-font-textarea"},null,8,["modelValue"])]),_:1}),e(h,null,{default:a(()=>[e(g,null,{default:a(()=>[e(z,{theme:"primary",type:"submit"},{default:a(()=>[...c[7]||(c[7]=[f("保存配置",-1)])]),_:1}),e(z,{theme:"default",variant:"base",type:"reset"},{default:a(()=>[...c[8]||(c[8]=[f("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})])}}}),Dm=re(Tm,[["__scopeId","data-v-4ef2421f"]]);function Ya(s){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let l="";for(let d=0;d<s;d++)l+=n.charAt(Math.floor(Math.random()*n.length));return l}function Js(s){return new Date(s*1e3).toLocaleString()}function ua(){const s=window.location.hostname;return!!(s==="localhost"||s==="::1"||s==="[::1]"||/^(?:127|10)\.\d+\.\d+\.\d+$|^(?:172\.(?:1[6-9]|2\d|3[0-1]))\.\d+\.\d+$|^(?:192\.168)\.\d+\.\d+$/.test(s)||s.startsWith("fe80:")||s.startsWith("fc")||s.startsWith("fd")||s.endsWith(".local"))}const Om=(s,n="MSL Login",l=500,d=600)=>{if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return window.open(s,"_blank"),null;const i=window.screenLeft!==void 0?window.screenLeft:window.screenX,v=window.screenTop!==void 0?window.screenTop:window.screenY,u=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,c=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,_=u/window.screen.availWidth,h=(u-l)/2/_+i,S=(c-d)/2/_+v,A=`
    scrollbars=yes,
    width=${l/_},
    height=${d/_},
    top=${S},
    left=${h}
  `,z=window.open(s,n,A);return z&&z.focus(),z},jm={class:"custom-option-item"},Km={class:"node-name-text"},Nm={class:"node-tag-group"},qm={class:"node-detail-area"},Gm={class:"detail-tags-row"},Hm={class:"remarks-box"},Jm=ne({__name:"CreateTunnelDialog",props:{visible:{type:Boolean},token:{}},emits:["update:visible","success"],setup(s,{emit:n}){const l=s,d=n,o=$(!1),i=$(!1),v=$([]),u=Xe({nodeId:null,type:"tcp",localIP:"127.0.0.1",localPort:"25565",remotePort:"",name:"",remarks:"无",bindDomain:"",use_kcp:!1,extra_config:""}),c=te(()=>v.value.find(z=>z.id===u.nodeId)||null),_=te(()=>{const z=[{label:"免费节点",value:0,children:[]},{label:"高级节点",value:1,children:[]},{label:"超级节点",value:2,children:[]}];return v.value.forEach(w=>{const g=z.find(U=>U.value===w.allow_user_group);g&&g.children.push(w)}),z.filter(w=>w.children.length>0)}),h=()=>{if(c.value){const{min_open_port:z,max_open_port:w}=c.value;u.remotePort=(Math.floor(Math.random()*(w-z+1))+z).toString()}u.name=Ya(8)},S=async()=>{o.value=!0;try{const z=await X.get({url:"/api/frp/nodeList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${l.token}`}});z.code===200&&(v.value=z.data,l.visible&&v.value.length>0&&!u.nodeId&&(u.nodeId=v.value[0].id,h()))}catch(z){L.error("加载节点失败"+z.message)}finally{o.value=!1}};ke(()=>l.visible,z=>{z&&(v.value.length>0?(u.nodeId||(u.nodeId=v.value[0].id),h()):S())});const A=async()=>{if(u.nodeId){i.value=!0;try{const z=await X.post({url:"/api/frp/addTunnel",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${l.token}`},data:{id:u.nodeId,type:u.type,local_ip:u.localIP,local_port:u.localPort,remote_port:u.remotePort,name:u.name,remarks:u.remarks,bind_domain:u.bindDomain,use_kcp:c.value?.kcp_support===1?u.use_kcp:!1,extra_config:u.extra_config||null}});z.code===200?(L.success("创建成功"),d("success"),d("update:visible",!1)):L.error(z.msg)}finally{i.value=!1}}};return xe(()=>{l.token&&S()}),(z,w)=>{const g=p("t-tag"),U=p("t-option"),I=p("t-option-group"),m=p("t-select"),x=p("t-col"),y=p("t-button"),E=p("t-row"),T=p("t-form-item"),V=p("t-input"),N=p("t-textarea"),q=p("t-form"),P=p("t-loading"),k=p("t-dialog");return r(),K(k,{attach:"body",visible:s.visible,header:"新建隧道",width:"580px","confirm-btn":{content:"提交创建",loading:i.value},onConfirm:A,onClose:w[10]||(w[10]=B=>d("update:visible",!1))},{default:a(()=>[e(P,{loading:o.value},{default:a(()=>[e(q,{data:u,"label-align":"right","label-width":100,class:"dialog-inner-form"},{default:a(()=>[e(T,{label:"选择节点",name:"nodeId"},{default:a(()=>[e(E,{gutter:8,style:{width:"100%"}},{default:a(()=>[e(x,{flex:"auto"},{default:a(()=>[e(m,{modelValue:u.nodeId,"onUpdate:modelValue":w[0]||(w[0]=B=>u.nodeId=B),placeholder:"请选择节点",onChange:h},{default:a(()=>[(r(!0),C(pe,null,we(_.value,B=>(r(),K(I,{key:B.value,label:B.label},{default:a(()=>[(r(!0),C(pe,null,we(B.children,R=>(r(),K(U,{key:R.id,value:R.id,label:R.node},{default:a(()=>[t("div",jm,[t("span",Km,M(R.node),1),t("div",Nm,[e(g,{size:"small",variant:"outline",theme:"primary"},{default:a(()=>[f(M(R.bandwidth)+"M",1)]),_:2},1024),e(g,{size:"small",theme:R.status===1?"success":"danger"},{default:a(()=>[f(M(R.status===1?"在线":"离线"),1)]),_:2},1032,["theme"])])])]),_:2},1032,["value","label"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(x,{flex:"none"},{default:a(()=>[e(y,{variant:"outline",onClick:w[1]||(w[1]=B=>b(Ie)("https://user.mslmc.net/frp/createTunnel"))},{default:a(()=>[...w[11]||(w[11]=[f(" 前往源站创建 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),c.value?(r(),K(T,{key:0,label:"节点详情"},{default:a(()=>[t("div",qm,[t("div",Gm,[e(g,{size:"small",variant:"outline",theme:"primary"},{default:a(()=>[f(M(c.value.bandwidth)+"Mbps",1)]),_:1}),e(g,{size:"small",theme:c.value.need_real_name?"success":"warning"},{default:a(()=>[f(M(c.value.need_real_name?"需要实名认证":"无需实名认证"),1)]),_:1},8,["theme"]),e(g,{size:"small",theme:c.value.status===1?"success":"danger"},{default:a(()=>[f(" 节点状态："+M(c.value.status===1?"在线":"离线"),1)]),_:1},8,["theme"])]),t("div",Hm,[t("pre",null,M(c.value.remarks||"此节点暂无备注"),1)])])]),_:1})):O("",!0),e(T,{label:"隧道类型"},{default:a(()=>[e(m,{modelValue:u.type,"onUpdate:modelValue":w[2]||(w[2]=B=>u.type=B)},{default:a(()=>[e(U,{label:"TCP",value:"tcp"}),c.value?.udp_support?(r(),K(U,{key:0,label:"UDP",value:"udp"})):O("",!0),c.value?.http_support?(r(),K(U,{key:1,label:"HTTP",value:"http"})):O("",!0),c.value?.http_support?(r(),K(U,{key:2,label:"HTTPS",value:"https"})):O("",!0)]),_:1},8,["modelValue"])]),_:1}),e(E,{gutter:[16,20]},{default:a(()=>[e(x,{xs:12,sm:6},{default:a(()=>[e(T,{label:"隧道名称"},{default:a(()=>[e(V,{modelValue:u.name,"onUpdate:modelValue":w[3]||(w[3]=B=>u.name=B)},null,8,["modelValue"])]),_:1})]),_:1}),e(x,{xs:12,sm:6},{default:a(()=>[e(T,{label:"远程端口"},{default:a(()=>[e(V,{modelValue:u.remotePort,"onUpdate:modelValue":w[4]||(w[4]=B=>u.remotePort=B)},{suffix:a(()=>[e(y,{variant:"text",size:"small",onClick:h},{default:a(()=>[...w[12]||(w[12]=[f("随机",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(x,{xs:12,sm:6},{default:a(()=>[e(T,{label:"本地IP"},{default:a(()=>[e(V,{modelValue:u.localIP,"onUpdate:modelValue":w[5]||(w[5]=B=>u.localIP=B)},null,8,["modelValue"])]),_:1})]),_:1}),e(x,{xs:12,sm:6},{default:a(()=>[e(T,{label:"本地端口"},{default:a(()=>[e(V,{modelValue:u.localPort,"onUpdate:modelValue":w[6]||(w[6]=B=>u.localPort=B)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),u.type.includes("http")?(r(),K(T,{key:1,label:"绑定域名",class:"spacing-item"},{default:a(()=>[e(V,{modelValue:u.bindDomain,"onUpdate:modelValue":w[7]||(w[7]=B=>u.bindDomain=B),placeholder:"输入已解析的域名"},null,8,["modelValue"])]),_:1})):O("",!0),e(T,{label:"备注说明",class:"spacing-item"},{default:a(()=>[e(V,{modelValue:u.remarks,"onUpdate:modelValue":w[8]||(w[8]=B=>u.remarks=B)},null,8,["modelValue"])]),_:1}),e(T,{label:"额外参数",class:"spacing-item"},{default:a(()=>[e(N,{modelValue:u.extra_config,"onUpdate:modelValue":w[9]||(w[9]=B=>u.extra_config=B),autosize:{minRows:2},placeholder:"选填，高级配置参数（不懂清留空！！！）"},null,8,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:1},8,["loading"])]),_:1},8,["visible","confirm-btn"])}}}),Wm=re(Jm,[["__scopeId","data-v-a8b2caa6"]]),Xm={key:0,class:"manager-container"},Qm={class:"toolbar"},Ym={class:"record-list"},Zm={key:0,class:"empty-state"},ep={class:"card-main"},tp={class:"domain-title"},ap={class:"sub"},sp={class:"root"},np={class:"info-badges"},lp=["title"],op={key:0,class:"srv-helper"},rp={class:"card-actions"},ip={key:1,class:"form-container"},up={class:"form-header"},dp={class:"remark-display"},cp={key:0,class:"prefix-hint"},mp={class:"row-fields"},pp={class:"form-actions"},vp=ne({__name:"DomainManagerDialog",props:{visible:{type:Boolean},token:{},tunnels:{}},emits:["update:visible"],setup(s,{emit:n}){const l=s,d=n,o=$("list"),i=$("mc_srv"),v=$(!1),u=$(!1),c=$([]),_=$([]),h=$([]),S=$(null),A=Xe({id:0,domain_id:void 0,name:"",type:"A",record:""}),z=te(()=>l.tunnels?l.tunnels.filter(k=>k.type&&k.type.toUpperCase()==="TCP"):[]),w=te(()=>{const k=_.value.find(B=>B.id===A.domain_id);return k?k.remark:""}),g=async()=>{if(l.token){v.value=!0;try{await Promise.all([U(),I(),m()])}catch(k){console.error(k)}finally{v.value=!1}}},U=async()=>{const k=await X.get({url:"/api/domain/dns/list",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${l.token}`}});k.code===200&&(c.value=k.data||[])},I=async()=>{const k=await X.get({url:"/api/domain/list",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${l.token}`}});k.code===200&&(_.value=k.data||[])},m=async()=>{try{const k=await X.get({url:"/api/frp/nodeList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${l.token}`}});k.code===200&&(h.value=k.data||[])}catch(k){console.error("Fetch nodes failed",k)}},x=k=>{const B=l.tunnels.find(R=>R.id===k);if(B){const R=h.value.find(J=>J.id===B.node_id),Z=R?R.domain||R.ip:null;Z?(A.record=`5 5 ${B.remote_port} ${Z}`,L.success("已自动生成解析值")):(L.warning(`无法获取节点(ID:${B.node_id})地址，请手动填写`),A.record=`5 5 ${B.remote_port} 请输入节点地址`),A.type="SRV"}};xe(()=>{l.visible&&l.token&&g()}),ke(()=>l.visible,k=>{k&&(o.value="list",g())}),ke(_,k=>{k.length>0&&A.domain_id===void 0&&A.id===0&&(A.domain_id=k[0].id)});const y=k=>k.type!=="SRV"?"":`${k.name.replace("_minecraft._tcp.","")}.${k.domain}`,E=()=>{o.value="form",i.value="mc_srv",S.value=null,A.id=0,A.name="",A.type="SRV",A.record="",_.value.length>0&&(A.domain_id=_.value[0].id)},T=k=>{o.value="form",i.value="custom",A.id=k.id,A.domain_id=Number(k.domain_id),A.name=k.name,A.type=k.type,A.record=k.record},V=()=>{o.value="list"},N=async()=>{const k=A.type.toUpperCase()==="SRV"||i.value==="mc_srv",B=k?/^[a-zA-Z0-9._-]+$/:/^[a-zA-Z0-9]+$/;let R=A.name;if(R.length<1)return L.warning("请输入子域名名称");if(!B.test(R))return L.warning(k?"SRV支持英文、数字、下划线及点":"普通解析仅支持英文数字");i.value==="mc_srv"&&A.id===0&&(R.startsWith("_minecraft._tcp.")||(R="_minecraft._tcp."+R),A.type="SRV"),u.value=!0;const Z=A.id!==0?"/api/domain/dns/edit":"/api/domain/dns/add";try{const J=await X.post({url:Z,baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${l.token}`},data:{...A,name:R}});J.code===200?(L.success(J.msg||"操作成功"),await U(),o.value="list"):L.error(J.msg)}catch(J){L.error("请求失败: "+J.message)}finally{u.value=!1}},q=async k=>{const B=Ze.confirm({header:"确认删除",body:"确定要删除这条解析记录吗？删除后无法恢复。",onConfirm:async()=>{B.hide();try{const R=await X.post({url:"/api/domain/dns/delete",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${l.token}`},data:{id:k}});R.code===200?(L.success("删除成功"),U()):L.error(R.msg)}catch(R){L.error(R.message)}}})},P=()=>{d("update:visible",!1)};return(k,B)=>{const R=p("t-button"),Z=p("t-empty"),J=p("t-tag"),W=p("t-tooltip"),H=p("t-loading"),$e=p("t-tab-panel"),Te=p("t-tabs"),ge=p("t-option"),ze=p("t-select"),Le=p("t-form-item"),Ee=p("t-input"),Be=p("t-form"),Je=p("t-dialog");return r(),K(Je,{visible:s.visible,header:o.value==="list"?"MSLFrp免费子域名管理":A.id===0?"创建新解析":"编辑解析",width:"650px",attach:"body",footer:!1,onClose:P},{default:a(()=>[o.value==="list"?(r(),C("div",Xm,[t("div",Qm,[e(R,{variant:"text",theme:"default",onClick:B[0]||(B[0]=ie=>b(Ie)("https://www.mslmc.cn/docs/proxy/server-no-port/"))},{icon:a(()=>[e(b(Vs))]),default:a(()=>[B[7]||(B[7]=f("查看文档 ",-1))]),_:1}),e(R,{theme:"primary",onClick:E},{icon:a(()=>[e(b(pa))]),default:a(()=>[B[8]||(B[8]=f("新建解析 ",-1))]),_:1})]),e(H,{loading:v.value,text:"加载中..."},{default:a(()=>[t("div",Ym,[c.value.length===0?(r(),C("div",Zm,[e(Z,{title:"暂无解析记录",description:"点击上方按钮创建一个吧"})])):O("",!0),(r(!0),C(pe,null,we(c.value,ie=>(r(),C("div",{key:ie.id,class:"record-card"},[t("div",ep,[t("div",tp,[t("span",ap,M(ie.name),1),t("span",sp,"."+M(ie.domain),1)]),t("div",np,[e(J,{size:"small",theme:ie.type==="SRV"?"warning":"primary",variant:"light"},{default:a(()=>[f(M(ie.type),1)]),_:2},1032,["theme"]),t("span",{class:"record-value",title:ie.record},M(ie.record),9,lp)]),ie.type==="SRV"?(r(),C("div",op,[e(b(Ct)),t("span",null,[B[9]||(B[9]=f("地址: ",-1)),t("strong",null,M(y(ie)),1)])])):O("",!0)]),t("div",rp,[e(W,{content:"编辑"},{default:a(()=>[e(R,{shape:"circle",variant:"text",onClick:Ve=>T(ie)},{icon:a(()=>[e(b(Ms))]),_:1},8,["onClick"])]),_:2},1024),e(W,{content:"删除"},{default:a(()=>[e(R,{shape:"circle",variant:"text",theme:"danger",onClick:Ve=>q(ie.id)},{icon:a(()=>[e(b(wt))]),_:1},8,["onClick"])]),_:2},1024)])]))),128))])]),_:1},8,["loading"])])):(r(),C("div",ip,[t("div",up,[e(R,{variant:"text",size:"small",onClick:V},{icon:a(()=>[e(b(Us))]),default:a(()=>[B[10]||(B[10]=f(" 返回列表 ",-1))]),_:1})]),A.id===0?(r(),K(Te,{key:0,modelValue:i.value,"onUpdate:modelValue":B[1]||(B[1]=ie=>i.value=ie),class:"mode-tabs"},{default:a(()=>[e($e,{value:"mc_srv",label:"MC Java版隐藏端口"}),e($e,{value:"custom",label:"自定义解析"})]),_:1},8,["modelValue"])):O("",!0),e(Be,{"label-align":"top",data:A,class:"dns-form"},{default:a(()=>[e(Le,{label:"选择域名后缀"},{default:a(()=>[e(ze,{modelValue:A.domain_id,"onUpdate:modelValue":B[2]||(B[2]=ie=>A.domain_id=ie),disabled:A.id!==0,placeholder:"请选择后缀",filterable:""},{default:a(()=>[(r(!0),C(pe,null,we(_.value,ie=>(r(),K(ge,{key:ie.id,value:ie.id,label:ie.domain},{default:a(()=>[f(M(ie.domain),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),w.value?(r(),K(Le,{key:0,label:"备注"},{default:a(()=>[t("div",dp,M(w.value),1)]),_:1})):O("",!0),e(Le,{label:"子域名称",help:"起一个你喜欢的前缀即可"},{default:a(()=>[e(Ee,{modelValue:A.name,"onUpdate:modelValue":B[3]||(B[3]=ie=>A.name=ie),placeholder:"例如: myserver"},{"prefix-icon":a(()=>[i.value==="mc_srv"&&A.id===0?(r(),C("span",cp,"_minecraft._tcp.")):O("",!0)]),_:1},8,["modelValue"])]),_:1}),i.value==="mc_srv"&&A.id===0?(r(),K(Le,{key:1,label:"选择隧道 (自动生成解析值)"},{default:a(()=>[e(ze,{modelValue:S.value,"onUpdate:modelValue":B[4]||(B[4]=ie=>S.value=ie),placeholder:"点击选择已有的 TCP 隧道",onChange:x},{default:a(()=>[(r(!0),C(pe,null,we(z.value,ie=>(r(),K(ge,{key:ie.id,value:ie.id,label:`${ie.name} (端口: ${ie.remote_port})`},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})):O("",!0),t("div",mp,[e(Le,{label:"记录类型",class:"half-width"},{default:a(()=>[e(ze,{modelValue:A.type,"onUpdate:modelValue":B[5]||(B[5]=ie=>A.type=ie)},{default:a(()=>[e(ge,{label:"A (IPv4)",value:"A"}),e(ge,{label:"CNAME (别名)",value:"CNAME"}),e(ge,{label:"AAAA (IPv6)",value:"AAAA"}),e(ge,{label:"SRV (服务记录)",value:"SRV"})]),_:1},8,["modelValue"])]),_:1}),e(Le,{label:"解析记录值",class:"half-width"},{default:a(()=>[e(Ee,{modelValue:A.record,"onUpdate:modelValue":B[6]||(B[6]=ie=>A.record=ie),placeholder:"例: 5 5 25565 node.mslmc.net"},null,8,["modelValue"])]),_:1})]),t("div",pp,[e(R,{theme:"default",variant:"base",onClick:V},{default:a(()=>[...B[11]||(B[11]=[f("取消",-1)])]),_:1}),e(R,{theme:"primary",loading:u.value,onClick:N},{default:a(()=>[f(M(A.id===0?"立即创建":"保存修改"),1)]),_:1},8,["loading"])])]),_:1},8,["data"])]))]),_:1},8,["visible","header"])}}}),fp=re(vp,[["__scopeId","data-v-e04d368f"]]),gp={class:"page-container"},_p={key:0,class:"login-container"},hp={class:"login-card"},yp={class:"icon-wrapper"},bp={key:1,class:"dashboard-container"},wp={class:"stat-item"},kp={class:"value"},$p={class:"stat-item"},Ap={class:"value"},xp={class:"stat-item"},Cp={class:"value"},Sp={class:"stat-item"},Ip={class:"value date-text"},Vp={class:"list-header"},Mp={class:"tunnel-list"},Up=["onClick"],Lp={class:"item-icon"},Bp={class:"item-content"},Rp={class:"item-title"},zp={class:"item-subtitle"},Ep={class:"item-status"},Pp={key:0,class:"empty-state"},Fp={key:0,class:"detail-content"},Tp={class:"detail-header"},Dp={class:"remarks"},Op={class:"detail-grid"},jp={class:"val"},Kp={class:"detail-grid"},Np={class:"val uppercase"},qp={class:"detail-grid"},Gp={class:"val"},Hp={class:"detail-grid"},Jp={class:"val highlight"},Wp={class:"detail-grid"},Xp={class:"val"},Qp={class:"detail-grid"},Yp={class:"val"},Zp={class:"action-area"},ev={key:1,class:"empty-detail"},tv=ne({__name:"index",setup(s){const n=$(!1),l=$(!1),d=()=>{I()},o=$("tKYvKk48Sq5kGAy12IJQxLEKhXx"),i=$(null),v=$(""),u=$(!1),c=$(null),_=$([]),h=$({}),S=$(null),A=te(()=>_.value.find(q=>q.id===S.value)||null),z=te(()=>A.value?h.value[A.value.node_id]||`未知节点 (${A.value.node_id})`:"");xe(()=>{const q=localStorage.getItem("msl-user-token");q&&(v.value=q,I())}),Qe(()=>{i.value&&!i.value.closed&&i.value.close()});async function w(){L.info("正在跳转至MSL用户中心登录...");try{const q=Ya(32),P=await X.post({url:"/api/oauth/createAppLogin",baseURL:"https://user.mslmc.net",data:{appid:o.value,csrf:q}});P.data.ssid?(i.value=Om(P.data.url,"登录到您的MSL账户",600,600),setTimeout(()=>g(q,P.data.ssid),1e3)):L.error(P.msg)}catch(q){L.error(q.message)}}async function g(q,P){if(!i.value?.closed){try{const k=await X.get({url:"/api/oauth/appLogin",baseURL:"https://user.mslmc.net",params:{csrf:q,ssid:P}});if(k.data.token){i.value&&i.value.close(),L.success("登录成功"),v.value=k.data.token,localStorage.setItem("msl-user-token",k.data.token),I();return}}catch(k){L.error("登录失败！"+k.message);return}setTimeout(()=>g(q,P),1e3)}}const U=q=>{if(q===0)return"0 B";const P=1024,k=["B","KB","MB","GB","TB"],B=Math.floor(Math.log(q)/Math.log(P));return parseFloat((q/Math.pow(P,B)).toFixed(2))+" "+k[B]};async function I(){u.value=!0;try{const[q,P]=await Promise.all([X.get({url:"/api/frp/userInfo",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${v.value}`}}),X.get({url:"/api/frp/nodeList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${v.value}`}})]);if(q.code===200)c.value=q.data;else{L.warning("登录已过期，请重新登录～"),v.value="",localStorage.removeItem("msl-user-token");return}if(P.code===200){const B={};P.data.forEach(R=>{B[R.id]=R.node}),h.value=B}const k=await X.get({url:"/api/frp/getTunnelList",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${v.value}`}});k.code===200&&(_.value=k.data,_.value.length>0&&(S.value=_.value[0].id))}catch(q){L.error("数据加载失败: "+q.message)}finally{u.value=!1}}const m=$(!1);async function x(){if(A.value){m.value=!0;try{const q=await X.get({url:"/api/frp/getTunnelConfig",baseURL:"https://user.mslmc.net",params:{id:A.value.id},headers:{Authorization:`Bearer ${v.value}`}});q.code===200?await Qa(A.value.name,q.data,"MSLFrp"):L.error(q.msg)}catch(q){L.error("获取配置失败: "+q.message)}m.value=!1}}const y=()=>{l.value=!0};async function E(){try{await X.get({url:"/api/user/logout",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${v.value}`}}),v.value="",c.value=null,_.value=[],localStorage.removeItem("msl-user-token"),L.success("已退出登录")}catch(q){L.error("退出失败: "+q.message)}}async function T(){await I(),L.success("数据已更新")}const V=$(!1);async function N(){if(A.value){V.value=!0;try{const q=await X.post({url:"/api/frp/deleteTunnel",baseURL:"https://user.mslmc.net",data:{id:A.value.id},headers:{Authorization:`Bearer ${v.value}`}});q.code===200?(L.success("隧道删除成功"),S.value=null,await I()):L.error(q.msg||"删除失败")}catch(q){L.error("操作失败: "+q.message)}finally{V.value=!1}}}return(q,P)=>{const k=p("t-button"),B=p("t-space"),R=p("t-loading"),Z=p("t-tag"),J=p("t-popconfirm"),W=p("t-col"),H=p("t-row"),$e=p("t-card"),Te=p("t-divider");return r(),C("div",gp,[v.value===""?(r(),C("div",_p,[t("div",hp,[t("div",yp,[e(b(na),{size:"48px",style:{color:"var(--td-brand-color)"}})]),P[8]||(P[8]=t("h2",{class:"title"},"欢迎登录 MSLFrp",-1)),P[9]||(P[9]=t("p",{class:"subtitle"},"登录您的MSL账户以使用 MSLFrp 服务",-1)),e(B,{direction:"vertical",size:"medium",style:{width:"100%"}},{default:a(()=>[e(k,{block:"",theme:"primary",size:"large",onClick:w},{icon:a(()=>[e(b(na))]),default:a(()=>[P[6]||(P[6]=f(" 跳转用户中心登录 ",-1))]),_:1}),e(k,{theme:"default",variant:"outline",block:"",size:"large",onClick:P[0]||(P[0]=ge=>b(Ie)("https://user.mslmc.net/register"))},{icon:a(()=>[e(b(kn))]),default:a(()=>[P[7]||(P[7]=f(" 注册 MSL 账户 ",-1))]),_:1})]),_:1})])])):(r(),C("div",bp,[e(R,{attach:"#app-space",loading:u.value,text:"加载数据中..."},null,8,["loading"]),e(B,{id:"app-space",direction:"vertical",size:"large",style:{width:"100%"}},{default:a(()=>[c.value?(r(),K($e,{key:0,bordered:!1,title:"MSLFrp 用户信息",class:"info-card"},{actions:a(()=>[e(B,{size:"small"},{default:a(()=>[e(k,{variant:"outline",theme:"success",size:"small",onClick:P[1]||(P[1]=ge=>b(Ie)("https://user.mslmc.net/store/buy"))},{default:a(()=>[...P[10]||(P[10]=[f(" 订阅会员服务 ",-1)])]),_:1}),e(Z,{theme:"primary",variant:"light-outline"},{default:a(()=>[f(M(c.value.user_group_name),1)]),_:1}),e(J,{content:"确认退出登录吗？",onConfirm:E},{default:a(()=>[e(k,{variant:"outline",theme:"danger",size:"small"},{default:a(()=>[...P[11]||(P[11]=[f(" 退出登录 ",-1)])]),_:1})]),_:1})]),_:1})]),default:a(()=>[e(H,{gutter:[16,16]},{default:a(()=>[e(W,{xs:6,sm:3},{default:a(()=>[t("div",wp,[P[12]||(P[12]=t("div",{class:"label"},"用户昵称",-1)),t("div",kp,[f(M(c.value.name)+" ",1),e(Z,{theme:c.value.realNameStatus?"success":"warning",variant:"dark",size:"small",style:{cursor:"pointer"},onClick:P[2]||(P[2]=ge=>b(Ie)("https://user.mslmc.net/user/profile"))},{default:a(()=>[f(M(c.value.realNameStatus?"已实名":"未实名"),1)]),_:1},8,["theme"])])])]),_:1}),e(W,{xs:6,sm:3},{default:a(()=>[t("div",$p,[P[13]||(P[13]=t("div",{class:"label"},"隧道限额",-1)),t("div",Ap,M(c.value.maxTunnelCount)+" 条",1)])]),_:1}),e(W,{xs:6,sm:3},{default:a(()=>[t("div",xp,[P[14]||(P[14]=t("div",{class:"label"},"速率限制",-1)),t("div",Cp,M(c.value.boundLimit/1024*8)+" Mbps",1)])]),_:1}),e(W,{xs:6,sm:3},{default:a(()=>[t("div",Sp,[P[15]||(P[15]=t("div",{class:"label"},"会员到期时间",-1)),t("div",Ip,M(c.value.outdated===3749682420?"长期有效":b(Js)(c.value.outdated)),1)])]),_:1})]),_:1})]),_:1})):O("",!0),e(H,{gutter:[16,16]},{default:a(()=>[e(W,{xs:12,md:5,lg:4},{default:a(()=>[e($e,{bordered:!1,class:"full-height-card"},{title:a(()=>[t("div",Vp,[P[19]||(P[19]=t("span",null,"我的隧道",-1)),e(B,{size:"4px"},{default:a(()=>[e(k,{style:{"margin-left":"3px"},size:"small",variant:"text",loading:u.value,onClick:T},{icon:a(()=>[e(b(at))]),default:a(()=>[P[16]||(P[16]=f(" 刷新 ",-1))]),_:1},8,["loading"]),e(k,{size:"small",variant:"text",onClick:P[3]||(P[3]=ge=>n.value=!0)},{icon:a(()=>[e(b(Bt))]),default:a(()=>[P[17]||(P[17]=f(" 免费子域名 ",-1))]),_:1}),e(k,{size:"small",variant:"text",onClick:y},{icon:a(()=>[e(b(pa))]),default:a(()=>[P[18]||(P[18]=f(" 新建 ",-1))]),_:1})]),_:1})])]),default:a(()=>[t("div",Mp,[(r(!0),C(pe,null,we(_.value,ge=>(r(),C("div",{key:ge.id,class:ye(["tunnel-item",{active:S.value===ge.id}]),onClick:ze=>S.value=ge.id},[t("div",Lp,[e(b(St))]),t("div",Bp,[t("div",Rp,M(ge.name),1),t("div",zp,M(h.value[ge.node_id]||`Node ${ge.node_id}`),1)]),t("div",Ep,[ge.status===1?(r(),K(Z,{key:0,theme:"success",variant:"light",size:"small"},{default:a(()=>[...P[20]||(P[20]=[f("在线",-1)])]),_:1})):(r(),K(Z,{key:1,theme:"default",variant:"light",size:"small"},{default:a(()=>[...P[21]||(P[21]=[f("未启动",-1)])]),_:1}))])],10,Up))),128)),_.value.length===0?(r(),C("div",Pp,"暂无隧道")):O("",!0)])]),_:1})]),_:1}),e(W,{xs:12,md:7,lg:8},{default:a(()=>[e($e,{bordered:!1,class:"full-height-card"},{title:a(()=>[...P[22]||(P[22]=[t("span",null,"隧道详情",-1)])]),actions:a(()=>[A.value?(r(),K(J,{key:0,content:"确认删除此隧道吗？",theme:"danger",placement:"bottom-right",onConfirm:N},{default:a(()=>[e(k,{theme:"danger",variant:"text",loading:V.value},{default:a(()=>[...P[23]||(P[23]=[f(" 删除隧道 ",-1)])]),_:1},8,["loading"])]),_:1})):O("",!0)]),default:a(()=>[A.value?(r(),C("div",Fp,[t("div",Tp,[t("h3",null,M(A.value.name),1),t("p",Dp,M(A.value.remarks||"暂无备注"),1)]),e(Te),e(H,{gutter:[24,24]},{default:a(()=>[e(W,{span:6},{default:a(()=>[t("div",Op,[P[24]||(P[24]=t("span",{class:"label"},"所在节点",-1)),t("span",jp,M(z.value),1)])]),_:1}),e(W,{span:6},{default:a(()=>[t("div",Kp,[P[25]||(P[25]=t("span",{class:"label"},"协议类型",-1)),t("span",Np,M(A.value.type),1)])]),_:1}),e(W,{span:6},{default:a(()=>[t("div",qp,[P[26]||(P[26]=t("span",{class:"label"},"本地地址",-1)),t("span",Gp,M(A.value.local_ip)+":"+M(A.value.local_port),1)])]),_:1}),e(W,{span:6},{default:a(()=>[t("div",Hp,[P[27]||(P[27]=t("span",{class:"label"},"远程端口",-1)),t("span",Jp,M(A.value.remote_port),1)])]),_:1}),e(W,{span:6},{default:a(()=>[t("div",Wp,[P[28]||(P[28]=t("span",{class:"label"},"今日流量",-1)),t("span",Xp,M(U(A.value.today_traffic*1024*1024)),1)])]),_:1}),e(W,{span:6},{default:a(()=>[t("div",Qp,[P[29]||(P[29]=t("span",{class:"label"},"总流量",-1)),t("span",Yp,M(U(A.value.total_traffic*1024*1024)),1)])]),_:1})]),_:1}),e(Te),t("div",Zp,[e(k,{theme:"primary",size:"large",loading:m.value,block:"",onClick:x},{icon:a(()=>[e(b(Xt))]),default:a(()=>[P[30]||(P[30]=f(" 使用此隧道 ",-1))]),_:1},8,["loading"])])])):(r(),C("div",ev,[e(b(Bt),{size:"48px",style:{color:"var(--td-text-color-disabled)"}}),P[31]||(P[31]=t("p",null,"请在左侧选择一个隧道查看详情",-1))]))]),_:1})]),_:1})]),_:1})]),_:1})])),l.value?(r(),K(Wm,{key:2,visible:l.value,"onUpdate:visible":P[4]||(P[4]=ge=>l.value=ge),token:v.value,onSuccess:d},null,8,["visible","token"])):O("",!0),n.value?(r(),K(fp,{key:3,visible:n.value,"onUpdate:visible":P[5]||(P[5]=ge=>n.value=ge),token:v.value,tunnels:_.value},null,8,["visible","token","tunnels"])):O("",!0)])}}}),av=re(tv,[["__scopeId","data-v-a5e7f491"]]);async function sv(){return await X.get({url:"/query/p2p_server",baseURL:"https://api.mslmc.cn/v3"})}const nv={key:0},lv={key:1},ov={key:0},rv={key:1},iv={key:0},uv={key:1},dv=ne({__name:"MSLP2P",setup(s){const n=Xe({roomId:"",roomKey:"",bindPort:25565,isHoster:!0}),l={roomId:[{required:!0,message:"请输入房间号",type:"error"}],roomKey:[{required:!0,message:"请输入房间密钥",type:"error"}],bindPort:[{required:!0,message:"请输入绑定端口",type:"error"}]},d=async({validateResult:i})=>{i===!0?await o(n.isHoster,n.roomId,n.roomKey,n.bindPort):L.warning("请检查参数是否全部填写完成！")};async function o(i,v,u,c){try{const _=await sv();let h;i?h=`serverAddr = "${_.ip}"
serverPort = ${_.port}

[[proxies]]
name = "${v}"
type = "xtcp"
secretKey = "${u}"
localIP = "127.0.0.1"
localPort = ${c}`:h=`serverAddr = "${_.ip}"
serverPort = ${_.port}

[[visitors]]
name = "p2p_visitor"
type = "xtcp"
serverName = "${v}"
secretKey = "${u}"
bindAddr = "127.0.0.1"
bindPort = ${c}`,await Qa(i?`「联机 - 房主」${v}`:`「联机 - 访客」${v}`,h,"MSL P2P")}catch(_){L.error(`创建联机隧道失败！${_.message}`)}}return(i,v)=>{const u=p("t-radio"),c=p("t-radio-group"),_=p("t-form-item"),h=p("t-input"),S=p("t-button"),A=p("t-form"),z=p("t-card");return r(),C("div",null,[e(z,{bordered:!1},{header:a(()=>[...v[5]||(v[5]=[t("span",{style:{"font-weight":"bold","font-size":"16px"}},"MSL P2P 联机隧道",-1)])]),default:a(()=>[e(A,{data:n,rules:l,"label-width":100,"label-align":"top","reset-type":"initial",onSubmit:d},{default:a(()=>[e(_,{label:"请选择联机类型",name:"isHoster"},{default:a(()=>[e(c,{modelValue:n.isHoster,"onUpdate:modelValue":v[0]||(v[0]=w=>n.isHoster=w)},{default:a(()=>[e(u,{value:!0},{default:a(()=>[...v[6]||(v[6]=[f("创建房间 - 房主",-1)])]),_:1}),e(u,{value:!1},{default:a(()=>[...v[7]||(v[7]=[f("加入房间 - 成员",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"房间号",name:"roomId"},{help:a(()=>[n.isHoster?(r(),C("span",nv,"建议填写您的QQ号码。")):(r(),C("span",lv,"请输入房间创建者提供的房间号。"))]),default:a(()=>[e(h,{modelValue:n.roomId,"onUpdate:modelValue":v[1]||(v[1]=w=>n.roomId=w),placeholder:"请输入房间号"},null,8,["modelValue"])]),_:1}),e(_,{label:"房间密钥",name:"roomKey"},{help:a(()=>[n.isHoster?(r(),C("span",ov,"随便写一个你喜欢的密钥。")):(r(),C("span",rv,"请输入房间创建者提供的密钥。"))]),default:a(()=>[e(h,{modelValue:n.roomKey,"onUpdate:modelValue":v[2]||(v[2]=w=>n.roomKey=w),placeholder:"请输入房间密钥"},null,8,["modelValue"]),n.isHoster?(r(),K(S,{key:0,theme:"default",variant:"base",style:{"margin-left":"5px"},onClick:v[3]||(v[3]=w=>{n.roomKey=b(Ya)(16)})},{default:a(()=>[...v[8]||(v[8]=[f("随机生成",-1)])]),_:1})):O("",!0)]),_:1}),e(_,{label:"绑定端口",name:"bindPort"},{help:a(()=>[n.isHoster?(r(),C("span",iv,"请输入游戏内提示的开放联机端口。")):(r(),C("span",uv,"建议保持默认。"))]),default:a(()=>[e(h,{modelValue:n.bindPort,"onUpdate:modelValue":v[4]||(v[4]=w=>n.bindPort=w),placeholder:"请输入绑定端口"},null,8,["modelValue"])]),_:1}),e(_,{style:{"margin-top":"16px"}},{default:a(()=>[e(S,{theme:"primary",type:"submit"},{default:a(()=>[...v[9]||(v[9]=[f("添加隧道",-1)])]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})])}}}),cv=ne({__name:"index",setup(s){const n=$(1);return(l,d)=>{const o=p("t-tab-panel"),i=p("t-tabs"),v=p("t-card");return r(),C("div",null,[e(v,{direction:"vertical"},{default:a(()=>[e(i,{modelValue:n.value,"onUpdate:modelValue":d[0]||(d[0]=u=>n.value=u)},{default:a(()=>[e(o,{value:1,label:"MSLFrp","destroy-on-hide":!1},{default:a(()=>[e(av,{style:{margin:"15px"}})]),_:1}),e(o,{value:2,label:"MSL 联机","destroy-on-hide":!1},{default:a(()=>[e(dv,{style:{margin:"15px"}})]),_:1}),e(o,{value:3,label:"自定义Frp","destroy-on-hide":!1},{default:a(()=>[e(Dm,{style:{margin:"15px"}})]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}}),mv=Object.freeze(Object.defineProperty({__proto__:null,default:cv},Symbol.toStringTag,{value:"Module"})),pv={class:"terminal-header"},vv={class:"tab-title"},fv=ne({__name:"ConsoleTerminal",props:{frpId:{}},emits:["update"],setup(s,{expose:n,emit:l}){const d=s,o=l,i=Re(),v=$(null),u=$(null);let c=null,_=null,h=null,S=null,A=null;const z={dark:{background:"transparent",foreground:"#cccccc",cursor:"transparent",selectionBackground:"#264f78",black:"#000000",red:"#cd3131",green:"#0dbc79",yellow:"#e5e510",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"},light:{background:"transparent",foreground:"#333333",cursor:"transparent",selectionBackground:"#add6ff",black:"#000000",red:"#cd3131",green:"#00bc79",yellow:"#9d9d10",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"}};ue.enabled=!0;const w=T=>T?(T=T.replace(/^(\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2}(\.\d{3})?)/,V=>ue.gray(V)),T=T.replace(/\[I\]/g,ue.green("[I]")),T=T.replace(/\[W\]/g,ue.yellow("[W]")),T=T.replace(/\[E\]/g,ue.red("[E]")),T=T.replace(/(success)/gi,V=>ue.bold.green(V)),T=T.replace(/(start|starting)/gi,V=>ue.blue(V)),T=T.replace(/(failed|error)/gi,V=>ue.bgRed.white(` ${V} `)),T=T.replace(/(:\d{4,5})/g,V=>ue.cyan(V)),T=T.replace(/(\[[0-9a-f]{8,}\])/g,V=>ue.magenta(V)),T):"",g=()=>{if(!u.value||!v.value)return;if(c){c.clear(),I();return}const T=document.documentElement.getAttribute("theme-mode")==="dark";c=new Ds({cursorBlink:!1,cursorStyle:"bar",fontSize:14,fontFamily:'"Maple Mono", "Maple Mono CN", "Cascadia Code", Consolas, Menlo, "PingFang SC", "Microsoft YaHei", monospace',lineHeight:1.4,theme:T?z.dark:z.light,allowTransparency:!0,disableStdin:!0,convertEol:!0}),_=new Os,c.loadAddon(_),c.open(u.value);const V=()=>{if(u.value&&u.value.clientWidth>0&&u.value.clientHeight>0)try{_?.fit(),c?.scrollToBottom()}catch(N){console.warn(N)}};h=new ResizeObserver(()=>window.requestAnimationFrame(V)),h.observe(v.value),setTimeout(V,100),I()},U=()=>{if(!c)return;const T=document.documentElement.getAttribute("theme-mode")==="dark";c.options.theme=T?z.dark:z.light},I=()=>{c?.writeln("\x1B[1;34m[System]\x1B[0m 正在初始化Frp控制台 ..."),c?.writeln(`\x1B[1;34m[System]\x1B[0m ID: ${d.frpId} | 状态: \x1B[32m已就绪！\x1B[0m`)},m=async()=>{if(A)try{await A.stop(),A=null}catch(T){console.error(T)}},x=async()=>{if(await m(),!d.frpId)return;const{baseUrl:T,token:V}=i,N=new URL("/api/hubs/frpLogsHub",T||window.location.origin);V&&N.searchParams.append("x-user-token",V),console.log(N.toString()),A=new It().withUrl(N.toString(),{withCredentials:!1}).configureLogging(Et.Warning).withAutomaticReconnect([0,2e3,5e3,1e4,3e4]).build(),A.on("ReceiveLog",q=>{c?.writeln(w(q)),q.includes("[MSLX]")&&setTimeout(()=>{o("update")},2e3)}),A.onreconnecting(q=>{c?.writeln("\x1B[1;33m[System] 检测到连接中断，正在尝试重连...\x1B[0m"),console.warn("SignalR Reconnecting:",q)}),A.onreconnected(async()=>{c?.writeln("\x1B[1;32m[System] 网络已恢复，重新连接日志服务...\x1B[0m");try{await A?.invoke("JoinGroup",d.frpId),c?.writeln("\x1B[1;32m[System] 日志服务成功重新连接！\x1B[0m")}catch(q){c?.writeln(`\x1B[1;31m[Error] 重新连接日志服务失败: ${q.message}\x1B[0m`)}}),A.onclose(q=>{q&&(c?.writeln(`\x1B[1;31m[System] 日志服务连接已断开: ${q.message}\x1B[0m`),c?.writeln("\x1B[1;31m[System] 请刷新页面或检查网络连接。\x1B[0m"))});try{await A.start(),c?.writeln("\x1B[1;32m[System] 成功连接到Frpc日志服务\x1B[0m"),await A.invoke("JoinGroup",d.frpId)}catch(q){c?.writeln(`\x1B[1;31m[Error] 连接失败: ${q.message}\x1B[0m`)}};return n({writeln:T=>c?.writeln(T),clear:()=>{c?.clear(),I()}}),ke(()=>d.frpId,async T=>{T&&(g(),await x())}),xe(async()=>{await yt(),g(),S=new MutationObserver(U),S.observe(document.documentElement,{attributes:!0,attributeFilter:["theme-mode"]}),d.frpId&&await x()}),Qe(async()=>{S?.disconnect(),await m(),c?.dispose(),h?.disconnect()}),(T,V)=>(r(),C("div",{ref_key:"terminalWrapper",ref:v,class:"terminal-wrapper"},[t("div",pv,[V[0]||(V[0]=t("div",{class:"dots"},[t("span",{class:"dot red"}),t("span",{class:"dot yellow"}),t("span",{class:"dot green"})],-1)),t("div",vv,"MSLX - Frp 控制台 | "+M(s.frpId),1)]),t("div",{ref_key:"terminalBody",ref:u,class:"terminal-body"},null,512)],512))}}),gv=re(fv,[["__scopeId","data-v-60e866bf"]]),sa=(s,n=!0,l="复制成功")=>new Promise((d,o)=>{navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(s).then(()=>{n&&L.success(l),d()}).catch(()=>{hs(s,n,l,d,o)}):hs(s,n,l,d,o)});function hs(s,n,l,d,o){try{const i=document.createElement("textarea");i.value=s,i.style.top="0",i.style.left="0",i.style.position="fixed",document.body.appendChild(i),i.focus(),i.select();const v=document.execCommand("copy");document.body.removeChild(i),v?(n&&L.success(l),d()):(n&&L.error("复制失败"),o(new Error("execCommand returned false")))}catch(i){n&&L.error("复制出错"),o(i)}}const _v={class:"sidebar-content"},hv={class:"control-header"},yv={class:"control-actions"},bv={class:"action-row"},wv={class:"info-list"},kv={class:"info-item"},$v={class:"label"},Av={class:"value"},xv={key:0,class:"proxy-header"},Cv={class:"info-item"},Sv={class:"label"},Iv=["onClick"],Vv={class:"info-item"},Mv={class:"label"},Uv={class:"value highlight"},Lv={class:"info-item"},Bv={class:"label"},Rv=["onClick"],zv={key:1,class:"info-item"},Ev={class:"label"},Pv=["onClick"],Fv={class:"info-item"},Tv={class:"label"},Dv={class:"value"},Ov={key:1,class:"info-item empty-state"},jv={class:"value"},Kv=ne({__name:"ControlPanel",props:{frpId:{},isRunning:{type:Boolean},loading:{type:Boolean},tunnelInfo:{}},emits:["start","stop","clear-log","edit-config"],setup(s){return(n,l)=>{const d=p("t-tag"),o=p("t-button"),i=p("t-card"),v=p("t-tooltip");return r(),C("div",_v,[e(i,{class:"control-card",bordered:!1},{default:a(()=>[t("div",hv,[t("div",{class:ye(["status-indicator",{running:s.isRunning}])},[l[4]||(l[4]=t("span",{class:"pulse"},null,-1)),f(M(s.isRunning?"Running":"Stopped"),1)],2),e(d,{theme:s.isRunning?"success":"default",variant:"light",shape:"round"},{default:a(()=>[f(M(s.isRunning?"正常运行":"未运行"),1)]),_:1},8,["theme"])]),t("div",yv,[s.isRunning?(r(),K(o,{key:1,theme:"danger",size:"large",block:"",loading:s.loading,onClick:l[1]||(l[1]=u=>n.$emit("stop"))},{icon:a(()=>[e(b(da))]),default:a(()=>[l[6]||(l[6]=f("停止服务 ",-1))]),_:1},8,["loading"])):(r(),K(o,{key:0,theme:"primary",size:"large",block:"",loading:s.loading,onClick:l[0]||(l[0]=u=>n.$emit("start"))},{icon:a(()=>[e(b(Xt))]),default:a(()=>[l[5]||(l[5]=f("启动服务 ",-1))]),_:1},8,["loading"])),t("div",bv,[e(o,{class:"glass-btn",variant:"outline",theme:"warning",onClick:l[2]||(l[2]=u=>n.$emit("clear-log"))},{icon:a(()=>[e(b(at))]),default:a(()=>[l[7]||(l[7]=f("清空日志 ",-1))]),_:1}),e(o,{variant:"outline",theme:"default",onClick:l[3]||(l[3]=u=>n.$emit("edit-config"))},{icon:a(()=>[e(b($n))]),default:a(()=>[l[8]||(l[8]=f("配置文件 ",-1))]),_:1})])])]),_:1}),e(i,{title:"隧道概览",class:"info-card",bordered:!1},{actions:a(()=>[s.tunnelInfo&&s.tunnelInfo.proxies&&s.tunnelInfo.proxies.length>0&&s.tunnelInfo.proxies.some(u=>u.type==="xtcp")?(r(),K(d,{key:0,variant:"light-outline",theme:"primary"},{default:a(()=>[...l[9]||(l[9]=[f("联机房间 - 房主",-1)])]),_:1})):s.tunnelInfo&&s.tunnelInfo.proxies&&s.tunnelInfo.proxies.length>0&&s.tunnelInfo.proxies.some(u=>u.type==="xtcp - Visitors")?(r(),K(d,{key:1,variant:"light-outline",theme:"primary"},{default:a(()=>[...l[10]||(l[10]=[f("联机房间 - 访客",-1)])]),_:1})):(r(),K(o,{key:2,shape:"circle",variant:"text"},{default:a(()=>[e(b(Rt))]),_:1}))]),default:a(()=>[t("div",wv,[t("div",kv,[t("div",$v,[e(b(St)),l[11]||(l[11]=f(" 隧道实例 ID",-1))]),t("div",Av,"#"+M(s.frpId),1)]),s.tunnelInfo&&s.tunnelInfo.proxies&&s.tunnelInfo.proxies.length>0?(r(!0),C(pe,{key:0},we(s.tunnelInfo.proxies,(u,c)=>(r(),C("div",{key:c,class:"proxy-group"},[s.tunnelInfo.proxies.length>1?(r(),C("div",xv,"配置 #"+M(c+1),1)):O("",!0),t("div",Cv,[t("div",Sv,[e(b(Bt)),f(" "+M(u.type.includes("xtcp")?"房间号":"隧道名称"),1)]),e(v,{content:u.proxyName,placement:"top","show-arrow":"","destroy-on-close":""},{default:a(()=>[t("div",{onClick:_=>b(sa)(u.proxyName,!0,`${u.type.includes("xtcp")?"房间号":"隧道名称"}已复制！`),class:"value remote-addr pointer"},M(u.proxyName),9,Iv)]),_:2},1032,["content"])]),t("div",Vv,[t("div",Mv,[e(b(Vs)),l[12]||(l[12]=f(" 协议类型",-1))]),t("div",Uv,M(u.type.toUpperCase()),1)]),t("div",Lv,[t("div",Bv,[e(b(Ct)),f(" "+M(u.type.includes("xtcp")?"房间密钥":"连接地址"),1)]),e(v,{content:u.remoteAddressMain,placement:"top","show-arrow":"","destroy-on-close":""},{default:a(()=>[t("div",{class:"value remote-addr pointer",onClick:_=>b(sa)(u.remoteAddressMain,!0,`${u.type.includes("xtcp")?"房间密钥":"连接地址"}已复制！`)},M(u.remoteAddressMain||"获取中..."),9,Rv)]),_:2},1032,["content"])]),u.remoteAddressBackup&&u.remoteAddressBackup!==u.remoteAddressMain?(r(),C("div",zv,[t("div",Ev,[e(b(Ct)),l[13]||(l[13]=f(" 备用地址",-1))]),e(v,{content:u.remoteAddressBackup,placement:"top","show-arrow":"","destroy-on-close":""},{default:a(()=>[t("div",{class:"value remote-addr pointer",onClick:_=>b(sa)(u.remoteAddressBackup,!0,"备用连接地址已复制！")},M(u.remoteAddressBackup),9,Pv)]),_:2},1032,["content"])])):O("",!0),t("div",Fv,[t("div",Tv,[e(b(Rt)),l[14]||(l[14]=f(" 本地地址",-1))]),t("div",Dv,M(u.localAddress),1)])]))),128)):(r(),C("div",Ov,[l[15]||(l[15]=t("div",{class:"label"},"状态",-1)),t("div",jv,M(s.loading?"正在加载配置...":"暂无详细信息"),1)]))])]),_:1})])}}}),Nv=re(Kv,[["__scopeId","data-v-3a2669c8"]]),qv={class:"editor-container"},Gv={class:"editor-status-bar"},Hv={class:"mode-tag"},Jv={class:"dialog-footer"},Wv={class:"footer-left"},Xv={class:"footer-right"},Qv=ne({__name:"FileEditor",props:{visible:Boolean,fileName:String,content:String,loading:Boolean},emits:["update:visible","save"],setup(s,{emit:n}){const l=s,d=n,o=async()=>{if(!i.value)return;const A=l.fileName?.split(".").pop()?.toLowerCase();let z="",w=[];switch(A){case"json":z="json",w=[as,ss];break;case"yml":case"yaml":z="yaml",w=[yl];break;case"js":case"ts":z="babel",w=[as,ss];break;case"css":case"less":case"scss":z="css",w=[hl];break;case"html":case"xml":z="html",w=[_l];break;default:L.warning("该文件类型暂不支持自动格式化");return}try{const g=await gl.format(i.value,{parser:z,plugins:w,tabWidth:2,printWidth:80,semi:!0,singleQuote:!0});i.value=g,L.success("格式化成功")}catch(g){console.error(g),L.error(`格式化失败: 请检查语法错误
${g.message.split(`
`)[0]}`)}},i=$(""),v=$(!1);let u=null;const c=()=>{const A=document.documentElement.getAttribute("theme-mode");v.value=A==="dark"};xe(()=>{c(),u=new MutationObserver(c),u.observe(document.documentElement,{attributes:!0,attributeFilter:["theme-mode"]})}),Qe(()=>{u?.disconnect()}),ke(()=>l.content,A=>{i.value=A||""},{immediate:!0});const _=te(()=>{const A=[];switch(v.value&&A.push(rl),A.push(il.phrases.of({Find:"查找内容...",Replace:"替换为...",next:"下一个",previous:"上一个",all:"选中所有","match case":"区分大小写","by word":"全字匹配",regexp:"正则表达式",replace:"替换","replace all":"替换全部",close:"关闭"})),l.fileName?.split(".").pop()?.toLowerCase()){case"json":A.push(fl());break;case"yml":case"yaml":A.push(vl());break;case"js":case"ts":A.push(pl());break;case"css":case"less":case"scss":A.push(ml());break;case"html":case"xml":A.push(cl());break;case"toml":case"ini":case"conf":A.push(ul.define(dl));break}return A}),h=()=>{d("update:visible",!1)},S=()=>{d("save",i.value)};return(A,z)=>{const w=p("t-button"),g=p("t-dialog");return r(),K(g,{visible:s.visible,header:`正在编辑: ${s.fileName}`,width:"90%",attach:"body",top:"1vh",class:"editor-dialog",onClose:h},{footer:a(()=>[t("div",Jv,[t("div",Wv,[e(w,{variant:"outline",theme:"default",onClick:o},{default:a(()=>[...z[1]||(z[1]=[f(" 自动格式化 ",-1)])]),_:1})]),t("div",Xv,[e(w,{variant:"outline",onClick:h},{default:a(()=>[...z[2]||(z[2]=[f("取消",-1)])]),_:1}),e(w,{theme:"primary",loading:l.loading,onClick:S},{default:a(()=>[...z[3]||(z[3]=[f(" 保存 ",-1)])]),_:1},8,["loading"])])])]),default:a(()=>[t("div",qv,[e(b(An),{modelValue:i.value,"onUpdate:modelValue":z[0]||(z[0]=U=>i.value=U),placeholder:"文件内容为空...",style:{height:"70vh",fontSize:"14px"},autofocus:!0,"indent-with-tab":!0,"tab-size":2,extensions:_.value},null,8,["modelValue","extensions"])]),t("div",Gv,[t("span",null,"行数: "+M(i.value.split(`
`).length),1),t("span",null,"长度: "+M(i.value.length),1),t("span",Hv,M(v.value?"Dark Mode":"Light Mode"),1)])]),_:1},8,["visible","header"])}}}),Ws=re(Qv,[["__scopeId","data-v-8c0385d1"]]),Yv={class:"console-page"},Zv={class:"layout-container"},e1={class:"main-terminal-area"},t1={class:"sidebar-area"},a1=ne({__name:"index",setup(s){const n=Xa(),l=et(),d=$(parseInt(l.params.frpId)||0),o=$(!1),i=$(!1),v=$(null),u=$(!1),c=$(""),_=$(""),h=$(!1),S=$(null);async function A(){if(d.value)try{v.value=await pm(d.value),o.value=v.value.isRunning,await n.getTunnels()}catch(x){console.error("获取隧道信息失败",x),S.value?.writeln(`\x1B[1;31m[Error] 获取隧道信息失败: ${x}\x1B[0m`)}}const z=async()=>{i.value=!0;try{S.value?.writeln("\x1B[1;32m[System] 正在发送启动指令...\x1B[0m"),await _s("start",d.value),o.value=!0,L.success("启动指令已发送"),setTimeout(A,1500),S.value?.writeln("\x1B[1;35m\x1B[1m[TIPS] 注意：日志可能包含您的在线服务商的Token信息，若需要截图，请将关键信息打码处理！\x1B[0m")}catch(x){S.value?.writeln(`\x1B[1;31m[Error] Frpc启动失败: ${x.message}\x1B[0m`)}finally{i.value=!1}},w=async()=>{i.value=!0;try{S.value?.writeln("\x1B[1;32m[System] 正在发送停止指令...\x1B[0m"),await _s("stop",d.value),o.value=!1,L.warning("停止指令已发送"),setTimeout(A,1e3)}catch(x){S.value?.writeln(`\x1B[1;31m[Error] Frpc停止失败: ${x.message}\x1B[0m`)}finally{i.value=!1}},g=()=>{S.value?.clear()},U=()=>{const x=Ze.confirm({header:"警告",body:`直接编辑配置文件可能会导致服务无法启动或异常。正常情况在线服务商提供的配置文件也不能修改。请确保您了解配置文件的格式和内容。

是否继续？`,theme:"warning",onConfirm:async()=>{x.hide(),await I()}})},I=async()=>{const x=L.loading("正在读取配置文件...");try{let y="toml";const E=n.frpList.find(q=>q.id===d.value);E&&E.configType&&(y=E.configType.toLowerCase());const T=`frpc.${y}`,V=`${d.value}/${T}`,N=await fa(0,V);c.value=T,_.value=N,u.value=!0,L.close(x)}catch(y){L.close(x),L.error("读取配置文件失败: "+y.message),S.value?.writeln(`\x1B[1;31m[Error] 读取配置文件失败: ${y.message}\x1B[0m`)}},m=async x=>{h.value=!0;try{const y=`${d.value}/${c.value}`;await Na(0,y,x),L.success("配置文件保存成功"),u.value=!1,S.value?.writeln("\x1B[1;32m[System] 配置文件已更新，请重启服务以生效。\x1B[0m")}catch(y){L.error("保存失败"),S.value?.writeln(`\x1B[1;31m[Error] 保存失败: ${y.message}\x1B[0m`)}finally{h.value=!1}};return ke(()=>l.params.frpId,async x=>{l.name==="FrpConsole"&&x&&(d.value=parseInt(x),await A())}),xe(()=>{d.value&&A()}),(x,y)=>(r(),C("div",Yv,[t("div",Zv,[t("div",e1,[e(gv,{ref_key:"terminalRef",ref:S,"frp-id":d.value,onUpdate:y[0]||(y[0]=E=>A())},null,8,["frp-id"])]),t("div",t1,[e(Nv,{"frp-id":d.value,"is-running":o.value,loading:i.value,"tunnel-info":v.value,onStart:z,onStop:w,onClearLog:g,onEditConfig:U},null,8,["frp-id","is-running","loading","tunnel-info"])])]),e(Ws,{visible:u.value,"onUpdate:visible":y[1]||(y[1]=E=>u.value=E),"file-name":c.value,content:_.value,loading:h.value,onSave:m},null,8,["visible","file-name","content","loading"])]))}}),s1=re(a1,[["__scopeId","data-v-d01d4c2c"]]),n1=Object.freeze(Object.defineProperty({__proto__:null,default:s1},Symbol.toStringTag,{value:"Module"})),Za=bt("instanceHub",()=>{const s=Re(),n=$(null),l=$(!1),d=$(null),o=$(0),i=$(0);let v=Promise.resolve();const u=$({cpu:0,memBytes:0,memPercent:0}),c=new Set,_=new Set,h=new Set,S=x=>{i.value=x},A=x=>(v=v.then(async()=>{if(o.value++,n.value?.state==="Connected"&&d.value===x)return;n.value&&await w(),d.value=x,i.value=0;const{baseUrl:y,token:E}=s,T=new URL("/api/hubs/instanceControlHub",y||window.location.origin);E&&T.searchParams.append("x-user-token",E);const V=new It().withUrl(T.toString(),{withCredentials:!1}).configureLogging(Et.Warning).withAutomaticReconnect([0,2e3,5e3,1e4]).build();V.on("ReceiveLog",N=>{c.forEach(q=>q(N))}),V.on("RequireEULA",()=>{_.forEach(N=>N())}),V.on("CommandResult",(N,q)=>{h.forEach(P=>P(N,q))}),V.on("ReceiveStatus",(N,q,P)=>{if(String(N)!==String(x))return;let k=0;if(i.value>0){const B=i.value*1024*1024;k=P/B*100,k>100&&(k=100)}u.value={cpu:q,memBytes:P,memPercent:k}}),V.onreconnecting(()=>c.forEach(N=>N("\x1B[1;31m[System] 连接中断，尝试重连...\x1B[0m"))),V.onreconnected(async()=>{c.forEach(N=>N("\x1B[1;32m[System] 网络恢复，重新加入会话...\x1B[0m"));try{await V.invoke("JoinGroup",x)}catch(N){console.error(N)}});try{await V.start(),await V.invoke("JoinGroup",x),n.value=V,l.value=!0,c.forEach(N=>N("\x1B[1;32m[System] 已连接到实例控制服务\x1B[0m"))}catch(N){l.value=!1,c.forEach(q=>q(`\x1B[1;31m[Error] 连接失败: ${N.message}\x1B[0m`)),d.value=null,n.value=null}}),v),z=()=>(v=v.then(async()=>{o.value>0&&o.value--,o.value===0&&await w()}),v),w=async()=>{if(n.value)try{n.value.state==="Connected"&&d.value&&await n.value.invoke("LeaveGroup",d.value),await n.value.stop()}catch(x){console.warn(x)}n.value=null,l.value=!1,d.value=null,i.value=0,u.value={cpu:0,memBytes:0,memPercent:0}};return{isConnected:l,stats:u,currentServerId:d,connect:A,disconnect:z,setMaxMemory:S,sendCommand:async x=>{if(!n.value||n.value.state!=="Connected"||!d.value)throw new Error("未连接到服务");await n.value.invoke("SendCommand",d.value,x)},onLog:x=>(c.add(x),()=>c.delete(x)),onEula:x=>(_.add(x),()=>c.delete(x)),onCommandResult:x=>(h.add(x),()=>h.delete(x))}}),l1=Ft();ue.enabled=!0;const o1=(s,n=-1)=>s?(n===-1&&(n=l1.settings.webPanelColorizeLogLevel),n===0?s:(s=s.replace(/\n/g,`\r
`),s.includes("Done")&&s.includes("!")&&(s=s.replace(/Done \((.*?)\)!/g,(l,d)=>`${ue.green.bold("Done")} (${ue.blue(d)})!`)),s=s.replace(/\b(Server started|Starting Server)\b/g,l=>ue.green.bold(l)),s=s.replace(/\b(IPv4 supported|IPv6 supported)\b/g,l=>ue.cyan(l)),s.startsWith("[System]")&&(s=s.replace(/^\[System]/,`[${ue.blue.bold("System")}]`)),s.includes("[MSLX]")&&(s=s.replace(/\[MSLX]/g,`[${ue.magenta.bold("MSLX")}]`)),s.includes("[MSLX-Backup]")&&(s=s.replace(/\[MSLX-Backup]/g,`[${ue.magenta.bold("MSLX-Backup")}]`)),s.includes("[MSLX-Daemon]")&&(s=s.replace(/\[MSLX-Daemon]/g,`[${ue.magenta.bold("MSLX-Daemon")}]`)),s.startsWith(">>>")&&(s=s.replace(/^>>>/,ue.red.bold(">>>"))),n===1?(s=s.replace(/^\[[^\]]+\s+(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]/,(d,o)=>{switch(o){case"INFO":return ue.green(d);case"WARN":case"WARNING":return ue.yellow(d);case"ERROR":case"FATAL":return ue.red(d);case"DEBUG":return ue.blue(d);default:return d}}),s=s.replace(/^\[\d{2}:\d{2}:\d{2}\]\s+\[[^/]+\/(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]/,(d,o)=>{switch(o){case"INFO":return ue.green(d);case"WARN":case"WARNING":return ue.yellow(d);case"ERROR":case"FATAL":return ue.red(d);default:return d}}),(d=>{const o=/\u001b\[(0;)?31m/.test(d),i=/\b(ERROR|Exception|Caused by|at)\b/i.test(d);return o||i})(s)||(s=s.replace(new RegExp("(?<=:\\s|^)\\s*([([][a-zA-Z0-9_\\-.\\s]+[)\\]])(?=\\s)","g"),d=>ue.cyan(d))),s):/\u001b\[[\d;]*m/.test(s)?(s=s.replace(/(https?:\/\/[^\s]+)/g,l=>ue.blue.underline(l)),s):(s=s.replace(/^\[(\d{2}:\d{2}:\d{2})\s+(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]:/,(l,d,o)=>{let i=o;switch(o){case"INFO":i=ue.green("INFO");break;case"WARN":case"WARNING":i=ue.yellow.bold("WARN");break;case"ERROR":case"FATAL":i=ue.red.bold(o);break;case"DEBUG":i=ue.blue("DEBUG");break}return`[${ue.gray(d)} ${i}]:`}),/^\[\d{2}:\d{2}:\d{2}\]/.test(s)&&(s=s.replace(/^\[(\d{2}:\d{2}:\d{2})\]/,(l,d)=>`[${ue.gray(d)}]`)),s=s.replace(/\[([^/]+)\/(INFO|WARN|WARNING|ERROR|FATAL|DEBUG)\]/g,(l,d,o)=>{const i=ue.blue(d);let v=o;switch(o){case"INFO":v=ue.green("INFO");break;case"WARN":v=ue.yellow("WARN");break;case"ERROR":v=ue.red.bold("ERROR");break}return`[${i}/${v}]`}),s=s.replace(new RegExp("(?<=:\\s|^)\\s*\\[([a-zA-Z0-9_\\-.\\s]+)\\](?=\\s)","g"),(l,d)=>d==="System"||d.includes("MSLX")?l:` [${ue.bold.black(d)}]`),s=s.replace(/(https?:\/\/[^\s]+)/g,l=>ue.blue.underline(l)),s=s.replace(new RegExp("\\b\\d+\\.\\d+[\\w.+\\-@]*(?<!ms|s|MB|GB|KB|%)\\b","g"),l=>ue.magenta(l)),s=s.replace(/\b\d+(\.\d+)?\s?(ms|s|%|MB|GB|KB)\b/gi,l=>ue.blue(l)),s=s.replace(new RegExp("(\\u001b\\[[\\d;]*m)|((?<!\\d:\\d)(?<![.\\-+])\\b\\d+\\b(?![.\\-+])(?!\\s*:\\s*\\d))","g"),(l,d,o)=>{if(d)return l;if(o){if(o.length>=4&&o.length<=6)return ue.blue(o);if(o.length<=3)return ue.blue(o)}return l}),s=s.replace(/(\*:\d{1,5})/,l=>ue.blue.bold(l)),s=s.replace(/\b(Loaded|Saved|Starting|Started|Connected)\b/g,l=>ue.green(l)),s=s.replace(/\bDone\b(?!\u001b)/g,ue.green.bold("Done")),s=s.replace(/\b(Failed|Exception|Error|Caused by|Stopping|Closed)\b/g,l=>ue.red.bold(l)),s=s.replace(/\b(Loading|Preparing|Generating|Saving|Using|Running)\b/g,l=>ue.magenta(l)),s=s.replace(/\b(Minecraft|Paper|Velocity|Java)\b/gi,l=>ue.bold.black(l)),s=s.replace(/'minecraft:[a-z_]+'/g,l=>ue.magenta(l)),s))):"",r1={class:"terminal-header"},i1={class:"tab-title"},u1={class:"terminal-footer"},d1=ne({__name:"ServerTerminal",props:{serverId:{}},emits:["update"],setup(s,{expose:n,emit:l}){const d=s,o=l,i=Za(),v=$(null),u=$(null);let c=null,_=null,h=null,S=null,A=null,z=null,w="";const g=$(""),U={dark:{background:"transparent",foreground:"#cccccc",cursor:"#cccccc",selectionBackground:"#264f78",black:"#000000",red:"#cd3131",green:"#0dbc79",yellow:"#e5e510",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"},light:{background:"transparent",foreground:"#333333",cursor:"#333333",selectionBackground:"#add6ff",black:"#000000",red:"#cd3131",green:"#00bc79",yellow:"#9d9d10",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f3d61a",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"}};ue.enabled=!0;const I=B=>o1(B),m=()=>{if(!u.value||!v.value)return;if(c){c.clear(),V();return}const B=document.documentElement.getAttribute("theme-mode")==="dark";c=new Ds({cursorBlink:!1,cursorStyle:"bar",fontSize:14,fontFamily:'"Maple Mono", "Maple Mono CN", "Cascadia Code", Consolas, Menlo, "PingFang SC", "Microsoft YaHei", monospace',lineHeight:1.4,theme:B?U.dark:U.light,allowTransparency:!0,convertEol:!0}),_=new Os,c.loadAddon(_),c.open(u.value),c.onData(Z=>x(Z));const R=()=>{if(u.value&&u.value.clientWidth>0&&u.value.clientHeight>0)try{_?.fit()}catch(Z){console.warn(Z)}};h=new ResizeObserver(()=>window.requestAnimationFrame(R)),h.observe(v.value),setTimeout(R,100),V()},x=async B=>{!c||!d.serverId||(B==="\r"?(c.write(`\r
`),w.trim()&&await E(w),w=""):B===""?w.length>0&&(w=w.slice(0,-1),c.write("\b \b")):B>=" "&&(w+=B,c.write(B)))},y=async()=>{if(!g.value)return;const B=g.value;c?.writeln(B),await E(B),g.value=""},E=async B=>{try{await i.sendCommand(B)}catch(R){c?.writeln(`\x1B[1;31m[Error] ${R.message}\x1B[0m`)}},T=()=>{if(!c)return;const B=document.documentElement.getAttribute("theme-mode")==="dark";c.options.theme=B?U.dark:U.light},V=()=>{c?.writeln("\x1B[1;34m[System]\x1B[0m 正在连接服务器控制台 ..."),c?.writeln(`\x1B[1;34m[System]\x1B[0m 实例 ID: ${d.serverId}`),c?.writeln("")},N=async()=>{d.serverId&&(A&&A(),A=i.onLog(B=>{c&&c.writeln(I(B)),B.startsWith("[MSLX]")&&o("update")}),z&&z(),z=i.onCommandResult((B,R)=>{B||c?.writeln(`\x1B[1;31m[System] 指令执行反馈: ${R}\x1B[0m`)}),await i.connect(d.serverId))},q=async()=>{A&&A(),z&&z(),await i.disconnect()};return n({writeln:B=>c?.writeln(B),clear:()=>{c?.clear(),V()}}),ke(()=>d.serverId,async(B,R)=>{B!==R&&(await q(),m(),await N())}),xe(async()=>{await yt(),m(),S=new MutationObserver(T),S.observe(document.documentElement,{attributes:!0,attributeFilter:["theme-mode"]}),await N()}),Qe(async()=>{S?.disconnect(),h?.disconnect(),c?.dispose(),await q()}),(B,R)=>(r(),C("div",{ref_key:"terminalWrapper",ref:v,class:"terminal-wrapper"},[t("div",r1,[R[1]||(R[1]=t("div",{class:"dots"},[t("span",{class:"dot red"}),t("span",{class:"dot yellow"}),t("span",{class:"dot green"})],-1)),t("div",i1,"MSLX 服务端控制台 | #"+M(s.serverId),1)]),t("div",{ref_key:"terminalBody",ref:u,class:"terminal-body"},null,512),t("div",u1,[Ye(t("input",{"onUpdate:modelValue":R[0]||(R[0]=Z=>g.value=Z),class:"cmd-input",placeholder:"发送控制台指令...",onKeyup:xn(y,["enter"])},null,544),[[Is,g.value]]),t("button",{class:"send-btn",onClick:y},"发送")])],512))}}),c1=re(d1,[["__scopeId","data-v-127ea751"]]),m1={class:"settings-container"},p1={class:"setting-item"},v1={class:"setting-control"},f1={class:"setting-item"},g1={class:"setting-info"},_1={class:"desc"},h1={class:"setting-control"},y1={class:"setting-item"},b1={class:"setting-control"},w1={key:0,style:{"margin-top":"8px"}},k1={class:"setting-item"},$1={class:"setting-info"},A1={class:"title"},x1={class:"desc"},C1={class:"setting-control"},S1={class:"setting-item"},I1={class:"setting-control"},V1={key:0,class:"core-tools-panel"},M1={key:0,class:"upload-progress"},U1={class:"setting-item"},L1={class:"setting-control flex-row"},B1={class:"memory-input-group"},R1={class:"memory-input-group"},z1={class:"setting-item"},E1={class:"setting-control flex-row"},P1={class:"setting-info-desc-only"},F1={style:{"font-size":"12px",color:"var(--td-text-color-placeholder)",cursor:"help"}},T1={class:"setting-item"},D1={class:"setting-control"},O1={key:0,style:{"margin-top":"8px"}},j1={key:2,class:"setting-group-title"},K1={key:3,class:"setting-item"},N1={class:"setting-control"},q1={key:0,style:{"margin-top":"8px"}},G1={class:"setting-item"},H1={class:"setting-control"},J1={class:"setting-item"},W1={class:"setting-control"},X1={class:"setting-item"},Q1={class:"setting-control"},Y1={key:4,class:"setting-item"},Z1={class:"setting-control"},ef={class:"setting-item"},tf={class:"setting-control"},af={class:"setting-item"},sf={class:"setting-control"},nf={class:"setting-item"},lf={class:"setting-control"},of={key:5,class:"setting-item"},rf={class:"setting-control"},uf={class:"setting-item"},df={class:"setting-control flex-row"},cf={class:"setting-item"},mf={class:"setting-control flex-row"},pf={class:"form-actions"},vf={class:"progress-body"},ff={id:"update-log-box",class:"log-box"},gf={class:"time"},_f={key:0,class:"dialog-actions"},hf=ne({__name:"GeneralSettings",setup(s){const n=et(),l=Re(),d=te(()=>{const se=n.params.serverId;return se?parseInt(se):NaN}),o=$(null),i=$(!1),v=$(!1),u=$(!1),c=[{label:"UTF-8",value:"utf-8"},{label:"GBK",value:"gbk"}],_=$({id:d.value,name:"",base:"",java:"",core:"",minM:1024,maxM:4096,args:"",yggdrasilApiAddr:"",backupMaxCount:20,backupDelay:10,backupPath:"MSLX://Backup/Instance",autoRestart:!1,forceAutoRestart:!0,ignoreEula:!1,runOnStartup:!1,inputEncoding:"utf-8",outputEncoding:"utf-8",fileEncoding:"utf-8",coreUrl:"",coreSha256:"",coreFileKey:""}),h=$("MB"),S=$("MB"),A=[{label:"MB",value:"MB"},{label:"GB",value:"GB"}],z=te({get:()=>{if(h.value==="GB"){const se=_.value.minM/1024;return Math.round(se*100)/100}return _.value.minM},set:se=>{_.value.minM=h.value==="GB"?Math.round(se*1024):se}}),w=te({get:()=>{if(S.value==="GB"){const se=_.value.maxM/1024;return Math.round(se*100)/100}return _.value.maxM},set:se=>{_.value.maxM=S.value==="GB"?Math.round(se*1024):se}}),g=$("custom"),U=$([]),I=$([]),m=$(""),x=$(""),y=async(se=!1)=>{try{se&&L.info("正在扫描 Java 环境...");const F=await Ja(l.userInfo.systemInfo.osType.toLowerCase().replace("os",""),l.userInfo.systemInfo.osArchitecture.toLowerCase());F&&Array.isArray(F)&&(U.value=F.map(ae=>({label:`Java ${ae} (在线)`,value:ae})));const j=await Wa(se);I.value=j.map(ae=>({label:`Java ${ae.version} (${ae.path})`,value:ae.path})),se&&L.success("刷新成功")}catch(F){console.error(F)}};ke([g,m,x],([se,F,j])=>{se==="none"?_.value.java="none":se==="env"?_.value.java="java":se==="custom"||se==="local"?_.value.java=j:se==="online"&&(_.value.java=F?`MSLX://Java/${F}`:"")});const E=$("MSLX://Backup/Instance"),T=$("");ke([E,T],([se,F])=>{se==="custom"?_.value.backupPath=F:_.value.backupPath=se});const V=$(""),N=$(""),q=[{label:"官方/离线模式 (无)",value:"none"},{label:"MSL 统一身份验证 (MSL Skin)",value:"https://skin.mslmc.net/api/yggdrasil"},{label:"LittleSkin",value:"https://littleskin.cn/api/yggdrasil"},{label:"自定义服务器",value:"custom"}];ke([V,N],([se,F])=>{se==="none"?_.value.yggdrasilApiAddr="":se==="custom"?_.value.yggdrasilApiAddr=F:_.value.yggdrasilApiAddr=se});const P=$(!1),k=$(!1),B=$(null),R=$(!1),Z=$(0),J=$(""),W=se=>{_.value.core=se.filename,_.value.coreUrl=se.url,_.value.coreSha256=se.sha256,_.value.coreFileKey="",P.value=!1,L.success(`已选择核心: ${se.filename}，保存后将自动下载`)},H=()=>B.value?.click(),$e=async se=>{const F=se.target;if(!F.files?.length)return;const j=F.files[0];if(_.value.coreFileKey)try{await At(_.value.coreFileKey)}catch{console.error("删除上传失败")}J.value=j.name,R.value=!0,Z.value=0;try{const me=(await Qt()).uploadId,ee=5*1024*1024,D=Math.ceil(j.size/ee);for(let de=0;de<D;de++){const _e=j.slice(de*ee,Math.min(j.size,(de+1)*ee));await Yt(me,de,_e),Z.value=Math.floor((de+1)/D*100)}const oe=await Zt(me,D);_.value.coreFileKey=oe.uploadId,_.value.core=j.name,_.value.coreUrl="",L.success("文件上传就绪，保存后生效"),P.value=!1}catch(ae){L.error(`上传失败: ${ae.message}`)}finally{R.value=!1,F.value=""}},Te=()=>{u.value||Ls.warning({title:"风险操作",content:"修改实例路径会导致面板无法找到原有文件。请确保您已手动移动了文件，或您明确知道自己在做什么。",duration:5e3}),u.value=!u.value},ge=$(!1),ze=$(0),Le=$([]),Ee=$(null),Be=te(()=>g.value==="none"?{name:[{required:!0,message:"服务器名称不能为空",trigger:"blur"}],base:[{required:!0,message:"基础路径不能为空",trigger:"blur"}],args:[{required:!0,message:"自定义模式必须填写启动命令",trigger:"blur"}]}:{name:[{required:!0,message:"服务器名称不能为空",trigger:"blur"}],base:[{required:!0,message:"基础路径不能为空",trigger:"blur"}],java:[{required:!0,message:"Java 环境不能为空",trigger:"change"}],core:[{required:!0,message:"核心文件名不能为空",trigger:"change"}],minM:[{required:!0,message:"必填",trigger:"blur"}],maxM:[{required:!0,message:"必填",trigger:"blur"}]}),Je=async()=>{if(d.value){i.value=!0;try{await y(),_.value.id=d.value;const se=await Zr(d.value);if(_.value={..._.value,...se,coreUrl:"",coreFileKey:"",coreSha256:""},h.value=se.minM>0&&se.minM%1024===0?"GB":"MB",S.value=se.maxM>0&&se.maxM%1024===0?"GB":"MB",u.value=!1,se.java==="none")g.value="none";else if(se.java==="java")g.value="env";else if(se.java.startsWith("MSLX://Java/"))g.value="online",m.value=se.java.replace("MSLX://Java/","");else{const ae=I.value.find(me=>me.value===se.java);g.value=ae?"local":"custom",x.value=se.java}const F=se.backupPath;F==="MSLX://Backup/Instance"||F==="MSLX://Backup/Data"?E.value=F:(E.value="custom",T.value=F);const j=se.yggdrasilApiAddr;j?j==="https://skin.mslmc.net/api/yggdrasil"?V.value="https://skin.mslmc.net/api/yggdrasil":j==="https://littleskin.cn/api/yggdrasil"?V.value="https://littleskin.cn/api/yggdrasil":(V.value="custom",N.value=j):V.value="none"}catch(se){L.error("获取配置失败: "+se.message)}finally{i.value=!1}}};ke(()=>n.params.serverId,se=>{n.name==="InstanceConsole"&&se&&Je()}),xe(Je);const ie=async()=>{if(await o.value?.validate()===!0&&!(g.value!=="none"&&(_.value.coreUrl||_.value.coreFileKey)&&!await new Promise(ae=>{const me=Ze.confirm({header:"确认变更核心文件?",body:"检测到您上传或选择了新的核心文件，这将覆盖服务器现有的部署。",theme:"warning",onConfirm:()=>{me.hide(),ae(!0)},onClose:()=>{me.hide(),ae(!1)}})}))){g.value==="none"&&(_.value.core="none",_.value.minM=1027,_.value.maxM=1102,_.value.java="none",_.value.coreUrl="",_.value.coreFileKey="",_.value.coreSha256=""),v.value=!0;try{const F=await ei(_.value);F.data?.needListen??F.needListen?Ve():(L.success("配置已保存"),v.value=!1,Je())}catch(F){L.error(F.message||"保存失败"),v.value=!1}}},Ve=async()=>{ge.value=!0,ze.value=0,Le.value=[];const{baseUrl:se,token:F}=l,j=new URL("/api/hubs/updateProgressHub",se||window.location.origin);j.searchParams.append("x-user-token",F),Ee.value=new It().withUrl(j.toString(),{withCredentials:!1}).configureLogging(Et.None).build(),Ee.value.on("UpdateStatus",(ae,me,ee)=>{Le.value.push({time:new Date().toLocaleTimeString(),msg:ee?`[错误] ${ae}`:ae}),yt(()=>{const D=document.getElementById("update-log-box");D&&(D.scrollTop=D.scrollHeight)}),me>=0&&(ze.value=Number(me.toFixed(1))),me===100&&(L.success("更新完成"),De(!0))});try{await Ee.value.start(),await Ee.value.invoke("JoinGroup",d.value.toString())}catch{Le.value.push({time:"-",msg:"连接失败"})}},De=(se=!1)=>{Ee.value?.stop(),setTimeout(()=>{ge.value=!1,v.value=!1,se&&Je()},1e3)};return Qe(()=>{Ee.value?.stop()}),(se,F)=>{const j=p("t-input"),ae=p("t-button"),me=p("t-tooltip"),ee=p("t-select"),D=p("t-textarea"),oe=p("t-alert"),de=p("t-icon"),_e=p("t-col"),fe=p("t-row"),be=p("t-progress"),Ue=p("t-space"),Ce=p("t-input-number"),Ae=p("t-switch"),Ke=p("t-form"),We=p("t-loading"),Ne=p("t-dialog");return r(),C("div",m1,[e(We,{loading:i.value,"show-overlay":""},{default:a(()=>[e(Ke,{ref_key:"formRef",ref:o,data:_.value,rules:Be.value,"label-width":"0",onSubmit:ie},{default:a(()=>[F[61]||(F[61]=t("div",{class:"setting-group-title"},"基础设置",-1)),t("div",p1,[F[34]||(F[34]=t("div",{class:"setting-info"},[t("div",{class:"title"},"服务器名称"),t("div",{class:"desc"},"在面板列表中显示的别名，支持中文")],-1)),t("div",v1,[e(j,{modelValue:_.value.name,"onUpdate:modelValue":F[0]||(F[0]=Q=>_.value.name=Q),placeholder:"请输入名称"},null,8,["modelValue"])])]),t("div",f1,[t("div",g1,[F[35]||(F[35]=t("div",{class:"title"},"实例路径",-1)),t("div",_1,[t("span",{class:ye({"text-warning":u.value})},M(u.value?"警告：修改路径可能导致无法找到原文件":"服务器文件的物理存储路径，非必要请勿修改"),3)])]),t("div",h1,[e(j,{modelValue:_.value.base,"onUpdate:modelValue":F[1]||(F[1]=Q=>_.value.base=Q),disabled:!u.value},{suffix:a(()=>[e(me,{content:u.value?"点击锁定":"点击解锁编辑 (慎重)"},{default:a(()=>[e(ae,{variant:"text",shape:"square",onClick:Te},{icon:a(()=>[u.value?(r(),K(b(Cn),{key:0,style:{color:"var(--td-warning-color)"}})):(r(),K(b(va),{key:1}))]),_:1})]),_:1},8,["content"])]),_:1},8,["modelValue","disabled"])])]),F[62]||(F[62]=t("div",{class:"setting-group-title"},"运行模式",-1)),t("div",y1,[F[36]||(F[36]=t("div",{class:"setting-info"},[t("div",{class:"title"},"启动方式"),t("div",{class:"desc"},"选择使用 Java 启动 Minecraft，或使用自定义命令启动其他程序 (如 Bedrock, Python 等)")],-1)),t("div",b1,[e(ee,{modelValue:g.value,"onUpdate:modelValue":F[2]||(F[2]=Q=>g.value=Q),options:[{label:"MSLX 在线下载 (Java)",value:"online"},{label:"使用本地版本 (Java)",value:"local"},{label:"自定义路径 (Java)",value:"custom"},{label:"环境变量 (Java)",value:"env"},{label:"自定义命令 (无Java)",value:"none"}]},null,8,["modelValue"]),g.value!=="none"?(r(),C("div",w1,[g.value==="online"?(r(),K(ee,{key:0,modelValue:m.value,"onUpdate:modelValue":F[3]||(F[3]=Q=>m.value=Q),options:U.value,placeholder:"请选择版本",filterable:""},null,8,["modelValue","options"])):O("",!0),g.value==="local"?(r(),K(ee,{key:1,modelValue:x.value,"onUpdate:modelValue":F[4]||(F[4]=Q=>x.value=Q),options:I.value,placeholder:"选择已识别的 Java"},null,8,["modelValue","options"])):O("",!0),g.value==="custom"?(r(),K(j,{key:2,modelValue:x.value,"onUpdate:modelValue":F[5]||(F[5]=Q=>x.value=Q),placeholder:"输入 java 可执行文件完整路径"},null,8,["modelValue"])):O("",!0)])):O("",!0)])]),t("div",k1,[t("div",$1,[t("div",A1,M(g.value==="none"?"启动命令 (Command)":"启动参数 (JVM Args)"),1),t("div",x1,M(g.value==="none"?"完全自定义的启动命令。程序将直接执行此段内容，不依赖 Java 环境。":"传递给 Java 的启动参数，如 GC 策略 (例如 -XX:+UseG1GC)"),1)]),t("div",C1,[e(D,{modelValue:_.value.args,"onUpdate:modelValue":F[6]||(F[6]=Q=>_.value.args=Q),autosize:{minRows:2,maxRows:4},placeholder:g.value==="none"?"例如: ./bedrock_server_x64":"无特殊需求请留空"},null,8,["modelValue","placeholder"])])]),g.value!=="none"?(r(),C(pe,{key:0},[F[40]||(F[40]=t("div",{class:"setting-group-title"},"核心管理",-1)),t("div",S1,[F[39]||(F[39]=t("div",{class:"setting-info"},[t("div",{class:"title"},"服务端核心文件"),t("div",{class:"desc"},[f(" 指定启动的 Jar 文件名。如果文件已存在于目录中，直接输入文件名即可。 "),t("br"),f("需要更新核心？点击下方“文件工具” ")])],-1)),t("div",I1,[e(j,{modelValue:_.value.core,"onUpdate:modelValue":F[8]||(F[8]=Q=>_.value.core=Q),placeholder:"例如 server.jar"},{suffix:a(()=>[e(ae,{variant:"text",theme:"primary",size:"small",onClick:F[7]||(F[7]=Q=>P.value=!P.value)},{default:a(()=>[f(M(P.value?"收起工具":"文件工具"),1)]),_:1})]),_:1},8,["modelValue"]),P.value?(r(),C("div",V1,[e(Ue,{direction:"vertical",style:{width:"100%"}},{default:a(()=>[e(oe,{theme:"info",message:"在此处操作会自动下载/上传文件，并填入上方的文件名。"}),e(fe,{gutter:12},{default:a(()=>[e(_e,{span:6},{default:a(()=>[e(ae,{block:"",variant:"outline",onClick:F[9]||(F[9]=Q=>k.value=!0)},{icon:a(()=>[e(de,{name:"cloud-download"})]),default:a(()=>[F[37]||(F[37]=f(" 从版本库下载 ",-1))]),_:1})]),_:1}),e(_e,{span:6},{default:a(()=>[e(ae,{block:"",variant:"outline",loading:R.value,onClick:H},{icon:a(()=>[e(de,{name:"upload"})]),default:a(()=>[F[38]||(F[38]=f(" 上传本地文件 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1}),t("input",{ref_key:"uploadInputRef",ref:B,type:"file",accept:".jar",hidden:"",onChange:$e},null,544),R.value?(r(),C("div",M1,[t("span",null,"正在上传: "+M(J.value),1),e(be,{theme:"line",percentage:Z.value},null,8,["percentage"])])):O("",!0)]),_:1})])):O("",!0)])])],64)):O("",!0),g.value!=="none"?(r(),C(pe,{key:1},[F[43]||(F[43]=t("div",{class:"setting-group-title"},"资源限制",-1)),t("div",U1,[F[42]||(F[42]=t("div",{class:"setting-info"},[t("div",{class:"title"},"内存分配"),t("div",{class:"desc"},"设置 Java 堆内存大小 (Xms / Xmx)")],-1)),t("div",L1,[t("div",B1,[e(Ce,{modelValue:z.value,"onUpdate:modelValue":F[10]||(F[10]=Q=>z.value=Q),min:0,"decimal-places":h.value==="GB"?1:0,placeholder:"Xms",theme:"normal",class:"input-left"},null,8,["modelValue","decimal-places"]),e(ee,{modelValue:h.value,"onUpdate:modelValue":F[11]||(F[11]=Q=>h.value=Q),options:A,clearable:!1,class:"select-right"},null,8,["modelValue"])]),F[41]||(F[41]=t("span",{class:"separator"},"-",-1)),t("div",R1,[e(Ce,{modelValue:w.value,"onUpdate:modelValue":F[12]||(F[12]=Q=>w.value=Q),min:0,"decimal-places":S.value==="GB"?1:0,placeholder:"Xmx",theme:"normal",class:"input-left"},null,8,["modelValue","decimal-places"]),e(ee,{modelValue:S.value,"onUpdate:modelValue":F[13]||(F[13]=Q=>S.value=Q),options:A,clearable:!1,class:"select-right"},null,8,["modelValue"])])])])],64)):O("",!0),F[63]||(F[63]=t("div",{class:"setting-group-title"},"备份设置",-1)),t("div",z1,[F[46]||(F[46]=t("div",{class:"setting-info"},[t("div",{class:"title"},"备份策略"),t("div",{class:"desc"},"设置自动备份保留的最大数量，以及触发备份的延迟时间")],-1)),t("div",E1,[e(Ce,{modelValue:_.value.backupMaxCount,"onUpdate:modelValue":F[14]||(F[14]=Q=>_.value.backupMaxCount=Q),min:1,max:100,placeholder:"保留份数",theme:"column",style:{width:"140px"},suffix:"份"},null,8,["modelValue"]),F[44]||(F[44]=t("span",{class:"separator"},"/",-1)),e(Ce,{modelValue:_.value.backupDelay,"onUpdate:modelValue":F[15]||(F[15]=Q=>_.value.backupDelay=Q),min:0,placeholder:"延迟时间",theme:"column",style:{width:"140px"},suffix:"秒"},null,8,["modelValue"])]),t("div",P1,[e(me,{content:"MSLX 向服务器发送 save-all 指令后，会等待指定的秒数，确保数据完全写入硬盘后再开始打包备份。"},{default:a(()=>[t("span",F1,[e(de,{name:"help-circle"}),F[45]||(F[45]=f(" 什么是延迟时间？ ",-1))])]),_:1})])]),t("div",T1,[F[47]||(F[47]=t("div",{class:"setting-info"},[t("div",{class:"title"},"备份存放路径"),t("div",{class:"desc"},"选择备份文件存储的位置。推荐存储在实例文件夹外部以免误删。")],-1)),t("div",D1,[e(ee,{modelValue:E.value,"onUpdate:modelValue":F[16]||(F[16]=Q=>E.value=Q),options:[{label:"实例文件夹内 (Instance)",value:"MSLX://Backup/Instance"},{label:"全局数据目录 (Data)",value:"MSLX://Backup/Data"},{label:"自定义绝对路径",value:"custom"}]},null,8,["modelValue"]),E.value==="custom"?(r(),C("div",O1,[e(j,{modelValue:T.value,"onUpdate:modelValue":F[17]||(F[17]=Q=>T.value=Q),placeholder:"输入备份存放的绝对路径"},null,8,["modelValue"])])):O("",!0)])]),g.value!=="none"?(r(),C("div",j1,"外置登录")):O("",!0),g.value!=="none"?(r(),C("div",K1,[F[48]||(F[48]=t("div",{class:"setting-info"},[t("div",{class:"title"},"Yggdrasil API"),t("div",{class:"desc"},"选择认证服务器。留空则表示使用官方正版登录 (或离线模式)。")],-1)),t("div",N1,[e(ee,{modelValue:V.value,"onUpdate:modelValue":F[18]||(F[18]=Q=>V.value=Q),options:q},null,8,["modelValue"]),V.value==="custom"?(r(),C("div",q1,[e(j,{modelValue:N.value,"onUpdate:modelValue":F[19]||(F[19]=Q=>N.value=Q),placeholder:"输入 Authlib-Injector API 地址"},null,8,["modelValue"])])):O("",!0)])])):O("",!0),F[64]||(F[64]=t("div",{class:"setting-group-title"},"高级设置",-1)),t("div",G1,[F[49]||(F[49]=t("div",{class:"setting-info"},[t("div",{class:"title"},"停止服务器指令"),t("div",{class:"desc"},"设置正常停止时所发送的指令，默认为stop"),t("div",{class:"desc"},"设置为^c为发送Ctrl C (在部分环境可能无法发送成功)")],-1)),t("div",H1,[e(j,{modelValue:_.value.stopCommand,"onUpdate:modelValue":F[20]||(F[20]=Q=>_.value.stopCommand=Q),placeholder:"请输入停止指令"},null,8,["modelValue"])])]),t("div",J1,[F[50]||(F[50]=t("div",{class:"setting-info"},[t("div",{class:"title"},"日志原彩显示"),t("div",{class:"desc"},"开启此选项后，将注入相关环境变量，以让MC终端日志输出原有的色彩样式"),t("div",{class:"desc"},"此功能可以和日志染色功能搭配使用")],-1)),t("div",W1,[e(Ae,{modelValue:_.value.allowOriginASCIIColors,"onUpdate:modelValue":F[21]||(F[21]=Q=>_.value.allowOriginASCIIColors=Q),label:["已开启","已关闭"]},null,8,["modelValue"])])]),t("div",X1,[F[51]||(F[51]=t("div",{class:"setting-info"},[t("div",{class:"title"},"自动重启"),t("div",{class:"desc"},"当服务器崩溃或意外停止时尝试自动重启"),t("div",{class:"desc"},"熔断机制: 若5分钟内尝试重启次数达到 5 次，则停止尝试重启")],-1)),t("div",Q1,[e(Ae,{modelValue:_.value.autoRestart,"onUpdate:modelValue":F[22]||(F[22]=Q=>_.value.autoRestart=Q),label:["已开启","已关闭"]},null,8,["modelValue"])])]),_.value.autoRestart?(r(),C("div",Y1,[F[52]||(F[52]=t("div",{class:"setting-info"},[t("div",{class:"title"},"强制自动重启"),t("div",{class:"desc"},"开启此功能后，就算服务器是正常退出的也会强制重启(正常退出 => 退出代码 0)"),t("div",{class:"desc"},"不影响手动在面板关闭服务器")],-1)),t("div",Z1,[e(Ae,{modelValue:_.value.forceAutoRestart,"onUpdate:modelValue":F[23]||(F[23]=Q=>_.value.forceAutoRestart=Q),label:["已开启","已关闭"]},null,8,["modelValue"])])])):O("",!0),t("div",ef,[F[53]||(F[53]=t("div",{class:"setting-info"},[t("div",{class:"title"},"关服强制结束时间"),t("div",{class:"desc"},"设置在发出Stop指令或关服请求后，等待多久后强制结束进程"),t("div",{class:"desc"},"可设置10 - 120 s")],-1)),t("div",tf,[e(Ce,{modelValue:_.value.forceExitDelay,"onUpdate:modelValue":F[24]||(F[24]=Q=>_.value.forceExitDelay=Q)},null,8,["modelValue"])])]),t("div",af,[F[54]||(F[54]=t("div",{class:"setting-info"},[t("div",{class:"title"},"忽略EULA提示"),t("div",{class:"desc"},"若您的实例并非MC服务器，可打开此选项")],-1)),t("div",sf,[e(Ae,{modelValue:_.value.ignoreEula,"onUpdate:modelValue":F[25]||(F[25]=Q=>_.value.ignoreEula=Q),label:["已开启","已关闭"]},null,8,["modelValue"])])]),t("div",nf,[F[55]||(F[55]=t("div",{class:"setting-info"},[t("div",{class:"title"},"随守护进程启动"),t("div",{class:"desc"},"当物理机开机/面板启动时，自动启动此实例")],-1)),t("div",lf,[e(Ae,{modelValue:_.value.runOnStartup,"onUpdate:modelValue":F[26]||(F[26]=Q=>_.value.runOnStartup=Q),label:["已开启","已关闭"]},null,8,["modelValue"])])]),g.value!=="none"?(r(),C("div",of,[F[56]||(F[56]=t("div",{class:"setting-info"},[t("div",{class:"title"},"强制Java使用UTF8"),t("div",{class:"desc"},"此功能可以解决部分游戏内中文乱码的问题（特别是Windows系统上）"),t("div",{class:"desc"},[f("开启此功能后请务必将下面的"),t("b",null,"文件编码"),f("设置设置为"),t("b",null,"UTF-8")])],-1)),t("div",rf,[e(Ae,{modelValue:_.value.forceJvmUTF8,"onUpdate:modelValue":F[27]||(F[27]=Q=>_.value.forceJvmUTF8=Q),label:["已开启","已关闭"]},null,8,["modelValue"])])])):O("",!0),t("div",uf,[F[57]||(F[57]=t("div",{class:"setting-info"},[t("div",{class:"title"},"控制台编码"),t("div",{class:"desc"},"设置输入输出流的字符集，乱码时请尝试切换")],-1)),t("div",df,[e(ee,{modelValue:_.value.inputEncoding,"onUpdate:modelValue":F[28]||(F[28]=Q=>_.value.inputEncoding=Q),options:c,label:"输入",style:{width:"140px"}},null,8,["modelValue"]),e(ee,{modelValue:_.value.outputEncoding,"onUpdate:modelValue":F[29]||(F[29]=Q=>_.value.outputEncoding=Q),options:c,label:"输出",style:{width:"140px"}},null,8,["modelValue"])])]),t("div",cf,[F[58]||(F[58]=t("div",{class:"setting-info"},[t("div",{class:"title"},"文件编码"),t("div",{class:"desc"},"设置文件编辑和保存时的编码格式，乱码时请尝试切换。(一般Windows是GBK，其他是UTF-8。)")],-1)),t("div",mf,[e(ee,{modelValue:_.value.fileEncoding,"onUpdate:modelValue":F[30]||(F[30]=Q=>_.value.fileEncoding=Q),options:c,style:{width:"140px"}},null,8,["modelValue"])])]),t("div",pf,[e(ae,{theme:"primary",type:"submit",size:"large",loading:v.value},{default:a(()=>[...F[59]||(F[59]=[f("保存设置",-1)])]),_:1},8,["loading"]),e(ae,{theme:"default",variant:"base",size:"large",onClick:Je},{default:a(()=>[...F[60]||(F[60]=[f("重置更改",-1)])]),_:1})])]),_:1},8,["data","rules"])]),_:1},8,["loading"]),e(Ha,{visible:k.value,"onUpdate:visible":F[31]||(F[31]=Q=>k.value=Q),onConfirm:W},null,8,["visible"]),e(Ne,{visible:ge.value,"onUpdate:visible":F[33]||(F[33]=Q=>ge.value=Q),header:"正在应用更新",footer:!1,"close-on-overlay-click":!1,"close-btn":!1,width:"600px"},{default:a(()=>[t("div",vf,[e(be,{theme:"plump",percentage:ze.value,label:`${ze.value}%`},null,8,["percentage","label"]),t("div",ff,[(r(!0),C(pe,null,we(Le.value,(Q,Se)=>(r(),C("div",{key:Se,class:"log-line"},[t("span",gf,M(Q.time),1),f(" "+M(Q.msg),1)]))),128))]),ze.value===100?(r(),C("div",_f,[e(ae,{theme:"primary",onClick:F[32]||(F[32]=Q=>ge.value=!1)},{default:a(()=>[...F[65]||(F[65]=[f("关闭并刷新",-1)])]),_:1})])):O("",!0)])]),_:1},8,["visible"])])}}}),yf=re(hf,[["__scopeId","data-v-1383a479"]]),bf={class:"uploader-container"},wf={key:0,class:"drop-text"},kf={key:1,class:"drop-text"},$f={class:"drop-actions"},Af={key:0,class:"queue-actions"},xf={class:"queue-info"},Cf={key:0},Sf={class:"btn-group"},If={key:1,class:"file-list"},Vf={class:"file-icon-wrapper"},Mf={class:"file-content"},Uf={class:"file-header"},Lf=["title"],Bf={class:"meta"},Rf={key:0,class:"error"},zf={key:1},Ef={class:"size"},Pf=["title"],Ff={class:"progress-wrapper"},Tf={class:"file-action"},Df=ne({__name:"FileUploader",props:{visible:{type:Boolean},instanceId:{},currentPath:{},allowFolder:{type:Boolean,default:!0}},emits:["update:visible","success"],setup(s,{emit:n}){const l=s,d=n,o=$([]),i=$(!1),v=$(!1),u=$(!1),c=$(),_=$(),h=k=>{const B=k.split(".").pop()?.toLowerCase();return["png","jpg","jpeg","gif","ico","webp"].includes(B||"")?{icon:Rs,color:"var(--td-success-color)"}:["jar","zip","rar","7z","tar","gz"].includes(B||"")?{icon:ka,color:"#722ed1"}:["js","ts","py","java","c","cpp","cs","json","yml","yaml","xml","html","css","properties","conf","sh","bat"].includes(B||"")?{icon:Rt,color:"var(--td-warning-color)"}:["log","txt","md","lock"].includes(B||"")?{icon:$a,color:"var(--td-gray-color-6)"}:["db","db-wal","dat"].includes(B||"")?{icon:In,color:"var(--td-gray-color-8)"}:{icon:Nt,color:"var(--td-brand-color)"}},S=k=>k.split("/").pop()||k,A=k=>{const B=k.lastIndexOf("/");return B!==-1?k.substring(0,B):""},z=te(()=>{if(o.value.length===0)return 0;const k=o.value.reduce((B,R)=>B+R.progress,0);return Math.floor(k/o.value.length)}),w=te(()=>o.value.some(k=>k.status==="pending"||k.status==="error")),g=()=>c.value?.click(),U=()=>_.value?.click(),I=k=>{const B=k.target;if(B.files&&B.files.length>0){const Z=Array.from(B.files).map(J=>({file:J,path:J.webkitRelativePath||J.name}));E(Z)}B.value=""},m=async k=>{u.value=!1;const B=k.dataTransfer?.items;if(!B)return;const R=[],Z=Array.from(B).map(J=>J.webkitGetAsEntry()).filter(J=>J!==null);for(const J of Z)J&&await x(J,R);E(R)},x=async(k,B)=>{if(k.isFile){const R=await new Promise((J,W)=>k.file(J,W)),Z=k.fullPath.startsWith("/")?k.fullPath.slice(1):k.fullPath;B.push({file:R,path:Z})}else if(k.isDirectory)if(l.allowFolder){const R=k.createReader(),Z=await y(R);for(const J of Z)await x(J,B)}else L.error("此处不支持上传文件夹")},y=async k=>{let B=[];const R=async()=>{const Z=await new Promise((J,W)=>k.readEntries(J,W));Z.length>0&&(B=B.concat(Z),await R())};return await R(),B},E=k=>{k.forEach(({file:B,path:R})=>{o.value.some(Z=>Z.path===R&&Z.file.size===B.size&&Z.status!=="error")||o.value.push({id:Math.random().toString(36).substring(2),file:B,path:R,status:"pending",progress:0,speed:""})})},T=async()=>{if(i.value)return;i.value=!0,v.value=!1;const k=3,B=o.value.filter(R=>R.status==="pending"||R.status==="error");for(let R=0;R<B.length&&!(v.value&&o.value.length===0);R+=k){const J=B.slice(R,R+k).filter(W=>o.value.some(H=>H.id===W.id));J.length>0&&await Promise.all(J.map(W=>V(W)))}i.value=!1,!v.value&&o.value.length>0&&o.value.every(R=>R.status==="success")&&(L.success("上传完成"),d("success"))},V=async k=>{k.status="uploading",k.progress=0,k.abortController=new AbortController;const B=Date.now();let R=0;try{const J=(await Qt()).uploadId,H=k.file.size>200*1024*1024?50*1024*1024:10*1024*1024,$e=Math.ceil(k.file.size/H),Te=4,ge=5,ze=Array.from({length:$e},(Ve,De)=>De),Le=new Map,Ee=()=>{const Ve=Date.now();if(Ve-R<100)return;R=Ve;const De=Array.from(Le.values()).reduce((j,ae)=>j+ae,0),se=Math.min(De/k.file.size*95,95);k.progress=Number(se.toFixed(1));const F=(Ve-B)/1e3;if(F>0){const j=De/1024/1024/F;k.speed=j.toFixed(1)+" MB/s"}},Be=async Ve=>{if(k.abortController?.signal.aborted)throw new Error("已取消");const De=Ve*H,se=Math.min(k.file.size,De+H),F=k.file.slice(De,se);let j;for(let ae=1;ae<=ge;ae++){if(k.abortController?.signal.aborted)throw new Error("已取消");try{await Yt(J,Ve,F,me=>{me&&me.loaded&&(Le.set(Ve,me.loaded),Ee())},k.abortController?.signal),Le.set(Ve,F.size),Ee();return}catch(me){j=me,ae<ge&&(Le.set(Ve,0),Ee(),await new Promise(ee=>setTimeout(ee,1e3*ae)))}}throw j||new Error(`分片 ${Ve} 失败`)},Je=async()=>{for(;ze.length>0&&!k.abortController?.signal.aborted;){const Ve=ze.shift();if(Ve===void 0)break;await Be(Ve)}},ie=Array(Math.min(Te,$e)).fill(null).map(()=>Je());if(await Promise.all(ie),k.abortController.signal.aborted)throw new Error("已取消");k.status="merging",k.speed="合并中...",k.progress=98,await Zt(J,$e),await Fo(l.instanceId,J,k.path,l.currentPath),k.status="success",k.progress=100,k.speed="完成"}catch(Z){Z.message==="已取消"||k.abortController?.signal.aborted?(k.status="pending",k.speed="已取消",k.progress=0):(k.status="error",k.errorMsg=Z.message||"失败")}},N=k=>{o.value[k].abortController?.abort(),o.value.splice(k,1)},q=()=>{o.value=o.value.filter(k=>k.status!=="success")},P=()=>d("update:visible",!1);return Qe(()=>o.value.forEach(k=>k.abortController?.abort())),(k,B)=>{const R=p("t-button"),Z=p("t-progress"),J=p("t-dialog");return r(),K(J,{visible:s.visible,header:"批量上传文件",width:"650px",footer:!1,onClose:P},{default:a(()=>[t("input",{ref_key:"fileInputRef",ref:c,type:"file",multiple:"",style:{display:"none"},onChange:I},null,544),t("input",{ref_key:"folderInputRef",ref:_,type:"file",webkitdirectory:"",style:{display:"none"},onChange:I},null,544),t("div",bf,[t("div",{class:ye(["drop-zone",{active:u.value}]),onDragover:B[0]||(B[0]=jt(W=>u.value=!0,["prevent"])),onDragleave:B[1]||(B[1]=jt(W=>u.value=!1,["prevent"])),onDrop:jt(m,["prevent"])},[e(b(Bs),{size:"40px",style:{color:"var(--td-brand-color)"}}),l.allowFolder?(r(),C("p",wf,"拖入文件或文件夹")):O("",!0),l.allowFolder?O("",!0):(r(),C("p",kf,"拖入文件")),t("div",$f,[e(R,{variant:"outline",size:"small",onClick:g},{icon:a(()=>[e(b(Nt))]),default:a(()=>[B[2]||(B[2]=f(" 选择文件",-1))]),_:1}),l.allowFolder?(r(),K(R,{key:0,variant:"outline",size:"small",onClick:U},{icon:a(()=>[e(b(zt))]),default:a(()=>[B[3]||(B[3]=f(" 选择文件夹",-1))]),_:1})):O("",!0)])],34),o.value.length>0?(r(),C("div",Af,[t("span",xf,[f(" 队列: "+M(o.value.length)+" 个 | ",1),i.value?(r(),C("span",Cf,"总进度 "+M(z.value)+"%",1)):O("",!0)]),t("div",Sf,[e(R,{theme:"primary",size:"small",disabled:!w.value||i.value,onClick:T},{icon:a(()=>[e(b(Xt))]),default:a(()=>[f(" "+M(i.value?"上传中...":"开始上传"),1)]),_:1},8,["disabled"]),e(R,{variant:"text",size:"small",onClick:q},{icon:a(()=>[e(b(Sn))]),default:a(()=>[B[4]||(B[4]=f(" 清空已完成",-1))]),_:1})])])):O("",!0),o.value.length>0?(r(),C("div",If,[(r(!0),C(pe,null,we(o.value,(W,H)=>(r(),C("div",{key:W.id,class:"file-item"},[t("div",Vf,[(r(),K(lt(h(S(W.path)).icon),{style:dt({color:h(S(W.path)).color})},null,8,["style"]))]),t("div",Mf,[t("div",Uf,[t("div",{class:"name",title:S(W.path)},M(S(W.path)),9,Lf),t("div",Bf,[W.status==="error"?(r(),C("span",Rf,M(W.errorMsg),1)):(r(),C("span",zf,M(W.speed),1)),t("span",Ef,M((W.file.size/1024/1024).toFixed(2))+" MB",1)])]),A(W.path)?(r(),C("div",{key:0,class:"file-path",title:A(W.path)},[e(b(zt),{size:"10px"}),f(" "+M(A(W.path))+"/ ",1)],8,Pf)):O("",!0),t("div",Ff,[e(Z,{percentage:W.progress,status:W.status==="error"?"error":W.status==="success"?"success":"active",size:"small",label:!1},null,8,["percentage","status"])])]),t("div",Tf,[W.status!=="success"?(r(),K(R,{key:0,shape:"circle",variant:"text",size:"small",onClick:$e=>N(H)},{default:a(()=>[e(b(Pa))]),_:1},8,["onClick"])):(r(),K(b(ma),{key:1,style:{color:"var(--td-success-color)","font-size":"18px"}}))])]))),128))])):O("",!0)])]),_:1},8,["visible"])}}}),Xs=re(Df,[["__scopeId","data-v-890b3931"]]),Of={class:"pm-container"},jf={class:"header-section"},Kf={class:"mode-switcher"},Nf={key:0,class:"error-alert-bar"},qf={class:"toolbar"},Gf={class:"left-actions"},Hf={key:0,class:"bulk-actions"},Jf={class:"selected-count"},Wf={class:"right-search"},Xf={class:"table-wrapper"},Qf={style:{display:"flex","align-items":"center",gap:"8px"}},Yf={class:"empty-state"},Zf={class:"tips-footer"},eg=ne({__name:"ModsPluginsManager",setup(s){const n=et(),l=parseInt(n.params.serverId),d=$("mods"),o=$(!1),i=$([]),v=$(""),u=$([]),c=$(""),_=te(()=>{if(!v.value)return i.value;const x=v.value.toLowerCase();return i.value.filter(y=>y.name.toLowerCase().includes(x))}),h=te(()=>[{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{title:"文件名",colKey:"name",sorter:(x,y)=>x.name.localeCompare(y.name),ellipsis:!0},{title:"状态",colKey:"status",width:100},{title:"操作",colKey:"op",width:180,fixed:"right",align:"right"}]),S=async(x=!1)=>{o.value=!0,u.value=[],c.value="";try{const y=await Ma(l,d.value,x),E=(y.clientJarFiles||[]).map(N=>({name:N,status:"enabled",isClient:!0})),T=(y.jarFiles||[]).map(N=>({name:N,status:"enabled"})),V=(y.disableJarFiles||[]).map(N=>({name:N,status:"disabled"}));i.value=[...E,...T,...V],x&&E.length>0?(u.value=E.map(N=>N.name),L.success(`检测到 ${E.length} 个客户端模组`)):x&&L.info("未检测到仅客户端模组")}catch(y){const E=y.message||"获取列表失败";c.value=E,i.value=[]}finally{o.value=!1}},A=async(x,y)=>{if(y.length===0)return;const E={enable:"启用",disable:"禁用",delete:"删除"},T=async()=>{try{o.value=!0;const V=await qo(l,d.value,x,y),{successCount:N,failCount:q}=V||{};q>0?L.warning(`操作完成：成功 ${N} 个，失败 ${q} 个`):L.success(`成功${E[x]} ${N} 个文件`),await S()}catch(V){L.error(V.message||"操作失败"),o.value=!1}};if(x==="delete"){const V=Ze.confirm({header:`确认删除 ${y.length} 个文件?`,body:"此操作不可逆，文件将被永久删除。",theme:"danger",onConfirm:()=>{V.hide(),T()}})}else await T()},z=x=>{d.value=x,S()},w=x=>{const y=x.status==="enabled"?"disable":"enable";A(y,[x.name])},g=x=>{const y=u.value;A(x,y)},U=$(!1),I=()=>{U.value=!0},m=()=>{U.value=!1,S()};return xe(()=>{S()}),ke(()=>n.params.serverId,x=>{x&&location.reload()}),(x,y)=>{const E=p("t-radio-button"),T=p("t-radio-group"),V=p("t-alert"),N=p("t-button"),q=p("t-input"),P=p("t-tag"),k=p("t-switch"),B=p("t-popconfirm"),R=p("t-space"),Z=p("t-table");return r(),C("div",Of,[t("div",jf,[y[13]||(y[13]=t("div",{class:"setting-group-title"}," 资源管理 ",-1)),t("div",Kf,[e(T,{modelValue:d.value,"onUpdate:modelValue":y[0]||(y[0]=J=>d.value=J),variant:"default-filled",onChange:z},{default:a(()=>[e(E,{value:"mods"},{icon:a(()=>[e(b(Aa))]),default:a(()=>[y[11]||(y[11]=f(" 模组 (Mods) ",-1))]),_:1}),e(E,{value:"plugins"},{icon:a(()=>[e(b(qt))]),default:a(()=>[y[12]||(y[12]=f(" 插件 (Plugins) ",-1))]),_:1})]),_:1},8,["modelValue"])])]),c.value?(r(),C("div",Nf,[e(V,{theme:"error",message:c.value,closeable:"",onClose:y[2]||(y[2]=J=>c.value="")},{operation:a(()=>[t("span",{style:{cursor:"pointer","margin-left":"8px"},onClick:y[1]||(y[1]=J=>S(!1))},"重试")]),_:1},8,["message"])])):O("",!0),t("div",qf,[t("div",Gf,[e(N,{theme:"primary",disabled:c.value!=="",onClick:I},{icon:a(()=>[e(b(xa))]),default:a(()=>[y[14]||(y[14]=f(" 上传文件 ",-1))]),_:1},8,["disabled"]),d.value==="mods"?(r(),K(N,{key:0,disabled:c.value!=="",variant:"outline",loading:o.value,onClick:y[3]||(y[3]=J=>S(!0))},{icon:a(()=>[e(b(la))]),default:a(()=>[y[15]||(y[15]=f(" 检测客户端模组 ",-1))]),_:1},8,["disabled","loading"])):O("",!0),e(N,{variant:"outline",loading:o.value,onClick:y[4]||(y[4]=J=>S(!1))},{icon:a(()=>[e(b(at))]),_:1},8,["loading"]),e(Wt,{name:"fade"},{default:a(()=>[u.value.length>0?(r(),C("div",Hf,[y[19]||(y[19]=t("div",{class:"divider"},null,-1)),t("span",Jf,"已选 "+M(u.value.length)+" 项",1),e(N,{size:"small",variant:"text",theme:"success",onClick:y[5]||(y[5]=J=>g("enable"))},{default:a(()=>[...y[16]||(y[16]=[f("启用",-1)])]),_:1}),e(N,{size:"small",variant:"text",theme:"warning",onClick:y[6]||(y[6]=J=>g("disable"))},{default:a(()=>[...y[17]||(y[17]=[f("禁用",-1)])]),_:1}),e(N,{size:"small",variant:"text",theme:"danger",onClick:y[7]||(y[7]=J=>g("delete"))},{default:a(()=>[...y[18]||(y[18]=[f("删除",-1)])]),_:1})])):O("",!0)]),_:1})]),t("div",Wf,[e(q,{modelValue:v.value,"onUpdate:modelValue":y[8]||(y[8]=J=>v.value=J),placeholder:"搜索文件名...",clearable:""},{"prefix-icon":a(()=>[e(b(la))]),_:1},8,["modelValue"])])]),t("div",Xf,[e(Z,{"selected-row-keys":u.value,"onUpdate:selectedRowKeys":y[9]||(y[9]=J=>u.value=J),pagination:{defaultPageSize:20,total:_.value.length,showJumper:!0,defaultCurrent:1},data:_.value,columns:h.value,"row-key":"name",loading:o.value,hover:"",stripe:"",class:"custom-table"},{name:a(({row:J})=>[t("div",Qf,[t("span",null,M(J.name),1),J.isClient?(r(),K(P,{key:0,theme:"warning",variant:"light",size:"small"},{default:a(()=>[...y[20]||(y[20]=[f(" 客户端 ",-1)])]),_:1})):O("",!0)])]),status:a(({row:J})=>[J.status==="enabled"?(r(),K(P,{key:0,theme:"success",variant:"light"},{icon:a(()=>[e(b(xt))]),default:a(()=>[y[21]||(y[21]=f(" 已启用 ",-1))]),_:1})):(r(),K(P,{key:1,theme:"default",variant:"light",style:{color:"var(--td-text-color-placeholder)"}},{icon:a(()=>[e(b(Pa))]),default:a(()=>[y[22]||(y[22]=f(" 已禁用 ",-1))]),_:1}))]),op:a(({row:J})=>[e(R,{size:"small"},{default:a(()=>[e(k,{"model-value":J.status==="enabled",loading:o.value,size:"medium",onChange:W=>w(J)},{label:a(W=>[f(M(W.value?"开":"关"),1)]),_:1},8,["model-value","loading","onChange"]),e(B,{content:"确定要删除此文件吗？",theme:"danger",onConfirm:W=>A("delete",[J.name])},{default:a(()=>[e(N,{variant:"text",theme:"danger",shape:"square"},{default:a(()=>[e(b(wt))]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)]),empty:a(()=>[t("div",Yf,[d.value==="mods"?(r(),K(b(Aa),{key:0,size:"48px",style:{color:"var(--td-gray-color-4)"}})):(r(),K(b(qt),{key:1,size:"48px",style:{color:"var(--td-gray-color-4)"}})),t("p",null,M(`暂无${d.value==="mods"?"模组":"插件"}文件`),1)])]),_:1},8,["selected-row-keys","pagination","data","columns","loading"])]),t("div",Zf,[t("p",null,"提示："+M(d.value==="mods"?"模组":"插件")+"文件存放于服务器根目录的 /"+M(d.value)+" 文件夹下。",1),y[23]||(y[23]=t("p",null,"禁用文件后，会在文件名后添加 .disabled 后缀，服务器将忽略该文件。",-1))]),e(Xs,{visible:U.value,"onUpdate:visible":y[10]||(y[10]=J=>U.value=J),"instance-id":b(l),"current-path":d.value,"allow-folder":!1,onSuccess:m},null,8,["visible","instance-id","current-path"])])}}}),tg=re(eg,[["__scopeId","data-v-c8641ed4"]]),ys=[{key:"motd",label:"服务器标语",desc:"显示在多人游戏列表中的服务器介绍信息，支持颜色代码，不支持中文。",type:"string"},{key:"server-port",label:"服务器端口",desc:"默认为 25565。如果要在一台机器运行多个服务器，必须修改此端口。",type:"number"},{key:"max-players",label:"最大玩家数",desc:"服务器同时允许在线的最大玩家数量。",type:"number"},{key:"online-mode",label:"正版验证",desc:"开启后将验证玩家的正版账号。如果使用离线/皮肤站，请关闭此项。",type:"boolean"},{key:"white-list",label:"启用白名单",desc:"开启后只有在白名单内的玩家才能进入服务器。",type:"boolean"},{key:"enforce-whitelist",label:"强制白名单",desc:"开启后，当玩家不在白名单时，即使已在线也会被踢出（通常用于维护时重新加载白名单）。",type:"boolean"},{key:"level-name",label:"存档文件夹名称",desc:"服务器读取的世界存档文件夹名称（默认为 world）。",type:"string"},{key:"gamemode",label:"默认游戏模式",desc:"新玩家进入服务器时的默认模式。",type:"select",options:[{label:"生存 (Survival)",value:"survival"},{label:"创造 (Creative)",value:"creative"},{label:"冒险 (Adventure)",value:"adventure"},{label:"旁观 (Spectator)",value:"spectator"}]},{key:"force-gamemode",label:"强制游戏模式",desc:"开启后，玩家每次加入服务器都会被重置为默认游戏模式。",type:"boolean"},{key:"difficulty",label:"难度",desc:"世界的游戏难度设置。",type:"select",options:[{label:"和平 (Peaceful)",value:"peaceful"},{label:"简单 (Easy)",value:"easy"},{label:"普通 (Normal)",value:"normal"},{label:"困难 (Hard)",value:"hard"}]},{key:"hardcore",label:"极限模式",desc:"开启后，玩家死亡将被封禁。",type:"boolean"},{key:"allow-flight",label:"允许飞行",desc:"允许生存模式下的玩家飞行（防止被服务端反作弊踢出）。",type:"boolean"},{key:"spawn-protection",label:"出生点保护半径",desc:"出生点周围多少格内禁止非 OP 破坏。设为 0 可禁用。",type:"number"},{key:"player-idle-timeout",label:"挂机踢出时间",desc:"玩家闲置多少分钟后被自动踢出。0 为不限制。",type:"number"},{key:"level-seed",label:"世界种子",desc:"生成世界使用的种子，留空则随机生成。",type:"string"},{key:"level-type",label:"世界类型",desc:"例如 minecraft:normal, minecraft:flat, minecraft:amplified。",type:"string"},{key:"generate-structures",label:"生成结构",desc:"是否生成村庄、地牢等结构。",type:"boolean"},{key:"generator-settings",label:"生成器设置",desc:"用于自定义超平坦或特定生成器的 JSON 参数。",type:"string"},{key:"max-world-size",label:"世界边界半径",desc:"设置世界边界（World Border）的最大半径。",type:"number"},{key:"simulation-distance",label:"模拟距离",desc:"服务器实际运算实体/作物生长的区块半径（3-32）。",type:"number"},{key:"view-distance",label:"视距",desc:"客户端可以看见的区块半径。数值过大显著增加内存和带宽消耗。",type:"number"},{key:"entity-broadcast-range-percentage",label:"实体广播范围百分比",desc:"控制客户端能看到实体的距离系数（100表示默认）。",type:"number"},{key:"max-tick-time",label:"最大刻耗时 (Watchdog)",desc:"一刻的最长处理毫秒数。超过此数值服务器将强制关闭以防卡死。设为 -1 可禁用。",type:"number"},{key:"network-compression-threshold",label:"网络压缩阈值",desc:"数据包超过此字节数时进行压缩。设为 -1 禁用压缩。推荐保持默认 256。",type:"number"},{key:"rate-limit",label:"数据包限制",desc:"如果玩家发送数据包过快，将被踢出。0 为禁用。",type:"number"},{key:"use-native-transport",label:"使用原生传输优化",desc:"Linux 环境下是否启用 Epoll 优化网络性能。",type:"boolean"},{key:"prevent-proxy-connections",label:"防止代理连接",desc:"是否尝试阻止通过 VPN 或代理的连接（ISP/AS 号判断）。",type:"boolean"},{key:"sync-chunk-writes",label:"同步区块写入",desc:"开启后区块写入完成后才继续逻辑，数据更安全但可能掉帧；关闭可能提升性能。",type:"boolean"},{key:"region-file-compression",label:"区块文件压缩格式",desc:"用于保存区块的压缩算法。",type:"select",options:[{label:"Deflate (默认)",value:"deflate"},{label:"LZ4 (更快)",value:"lz4"},{label:"不压缩 (None)",value:"none"}]},{key:"max-chained-neighbor-updates",label:"最大连锁更新数",desc:"限制红石/方块连锁更新的数量以防止崩服。",type:"number"},{key:"log-ips",label:"控制台记录 IP",desc:"是否在控制台日志中显示玩家连接的 IP 地址。",type:"boolean"},{key:"hide-online-players",label:"隐藏在线玩家列表",desc:"开启后，服务器列表中将不显示具体的玩家名单。",type:"boolean"},{key:"enable-status",label:"启用状态查询",desc:"是否允许外部（如服务器列表网站）查询服务器状态。",type:"boolean"},{key:"accepts-transfers",label:"接受服务器传送",desc:"是否允许玩家从其他服务器无缝传送到此服务器。",type:"boolean"},{key:"pause-when-empty-seconds",label:"空载暂停时间",desc:"服务器内无玩家多少秒后暂停游戏循环（省资源）。-1 为不暂停。",type:"number"},{key:"op-permission-level",label:"OP 权限等级",desc:"设置 OP 的默认权限级别。",type:"select",options:[{label:"1 - 无视出生点保护",value:1},{label:"2 - 使用单机指令 (gamemode等)",value:2},{label:"3 - 多人管理 (kick/ban/op)",value:3},{label:"4 - 系统管理 (stop/save)",value:4}]},{key:"function-permission-level",label:"函数权限等级",desc:"数据包(Datapack)中函数的默认执行权限等级。",type:"number"},{key:"enforce-secure-profile",label:"强制安全配置 (签名)",desc:"强制玩家拥有官方签名的公钥（聊天报告相关）。离线服建议关闭。",type:"boolean"},{key:"enable-code-of-conduct",label:"启用行为准则提示",desc:"是否向玩家展示行为准则链接（遥测相关）。",type:"boolean"},{key:"bug-report-link",label:"Bug 反馈链接",desc:"自定义玩家遇到错误时显示的反馈网址。",type:"string"},{key:"resource-pack",label:"资源包下载地址",desc:"玩家进入服务器时提示下载的资源包直链 URL。",type:"string"},{key:"require-resource-pack",label:"强制资源包",desc:"开启后，拒绝下载资源包的玩家将被踢出。",type:"boolean"},{key:"resource-pack-sha1",label:"资源包 SHA1",desc:"资源包文件的 SHA-1 校验码，用于验证完整性和缓存。",type:"string"},{key:"resource-pack-prompt",label:"资源包提示语",desc:"下载资源包时向玩家显示的自定义消息（Json 格式）。",type:"string"},{key:"initial-enabled-packs",label:"初始启用数据包",desc:"世界生成时默认启用的数据包列表（逗号分隔）。",type:"string"},{key:"initial-disabled-packs",label:"初始禁用数据包",desc:"世界生成时默认禁用的数据包列表。",type:"string"},{key:"enable-rcon",label:"启用 RCON",desc:"开启远程控制台协议，允许外部工具发送指令。",type:"boolean"},{key:"rcon.port",label:"RCON 端口",desc:"RCON 监听端口（默认为 25575）。",type:"number"},{key:"rcon.password",label:"RCON 密码",desc:"连接 RCON 必须的密码。请设置复杂的密码。",type:"string"},{key:"broadcast-rcon-to-ops",label:"向 OP 广播 RCON",desc:"当 RCON 执行指令时，是否通知在线的 OP。",type:"boolean"},{key:"enable-query",label:"启用 Query",desc:"开启 GameSpy4 协议，用于获取服务器详细信息。",type:"boolean"},{key:"query.port",label:"Query 端口",desc:"Query 协议监听端口（默认为 25565）。",type:"number"},{key:"broadcast-console-to-ops",label:"向 OP 广播控制台",desc:"控制台执行的指令输出是否发给在线 OP。",type:"boolean"},{key:"enable-jmx-monitoring",label:"启用 JMX 监控",desc:"开启 Java JMX 性能监控（通常用于开发调试）。",type:"boolean"},{key:"management-server-enabled",label:"启用管理后台",desc:"是否启用 Minecraft 官方定义的管理服务器接口。",type:"boolean"},{key:"management-server-port",label:"管理后台端口",desc:"管理接口监听的端口。",type:"number"},{key:"management-server-host",label:"管理后台主机",desc:"管理接口绑定的主机名/IP。",type:"string"},{key:"management-server-allowed-origins",label:"管理后台允许源",desc:"允许访问管理接口的 Origin 列表。",type:"string"},{key:"server-ip",label:"服务器绑定 IP",desc:"指定服务器绑定的本地网卡 IP。留空表示监听所有网卡（0.0.0.0）。",type:"string"},{key:"debug",label:"调试模式",desc:"开启后控制台将输出更多调试信息。",type:"boolean"},{key:"text-filtering-config",label:"文本过滤配置",desc:"用于文本过滤服务的 API 配置。",type:"string"},{key:"status-heartbeat-interval",label:"状态心跳间隔",desc:"服务器向客户端发送状态心跳的间隔（0 为默认）。",type:"number"}],ag={class:"settings-container"},sg={class:"page-header"},ng={class:"config-list"},lg={key:0,class:"empty-tip"},og={class:"setting-info"},rg={class:"title"},ig={class:"key-name-row"},ug={key:0,class:"key-name"},dg={key:0,class:"desc"},cg={class:"setting-control"},mg={class:"form-actions"},pg=ne({__name:"ServerProperties",setup(s){const n=et(),l=$(0),d=$(!1),o=$(!1),i=$({}),v=$(""),u=g=>{const U={};return g.split(`
`).forEach(m=>{const x=m.trim();if(!x||x.startsWith("#"))return;const y=x.indexOf("=");if(y!==-1){const E=x.substring(0,y).trim(),T=x.substring(y+1).trim();U[E]=T}}),U},c=g=>{let U=`#Minecraft server properties
#${new Date().toString()}
`;const I=ys.map(x=>x.key),m=Object.keys(g);return I.forEach(x=>{Object.prototype.hasOwnProperty.call(g,x)&&(U+=`${x}=${g[x]}
`)}),m.forEach(x=>{I.includes(x)||(U+=`${x}=${g[x]}
`)}),U},_=async()=>{if(l.value){d.value=!0;try{const g=await fa(l.value,"server.properties");g&&(v.value=g,i.value=u(g))}catch(g){L.error(`读取配置文件失败: ${g.message}`)}finally{d.value=!1}}},h=async()=>{o.value=!0;try{const g=c(i.value);await Na(l.value,"server.properties",g),L.success("配置文件已保存"),_()}catch(g){L.error(`保存失败: ${g.message}`)}finally{o.value=!1}},S=te(()=>{const g=[],U=i.value,I=new Set(Object.keys(U));return ys.forEach(m=>{I.has(m.key)&&(g.push(m),I.delete(m.key))}),I.forEach(m=>{g.push({key:m,label:m,desc:"未收录的配置项",type:A(U[m]),isUnknown:!0})}),g}),A=g=>g==="true"||g==="false"?"boolean":!isNaN(Number(g))&&g!==""?"number":"string",z=(g,U)=>{const I=i.value[g];return I===void 0?U==="boolean"?!1:"":U==="boolean"?I==="true":U==="number"?Number(I):I},w=(g,U,I)=>{i.value[g]=String(U)};return ke(()=>n.params.serverId,g=>{n.name==="InstanceConsole"&&g&&(l.value=parseInt(g),_())},{immediate:!0}),(g,U)=>{const I=p("t-button"),m=p("t-space"),x=p("t-switch"),y=p("t-select"),E=p("t-input-number"),T=p("t-input"),V=p("t-loading");return r(),C("div",ag,[t("div",sg,[U[1]||(U[1]=t("div",{class:"section-title"},"Server.properties 配置编辑器",-1)),e(m,null,{default:a(()=>[e(I,{variant:"text",shape:"square",loading:d.value,onClick:_},{icon:a(()=>[e(b(at))]),_:1},8,["loading"]),e(I,{theme:"primary",loading:o.value,onClick:h},{icon:a(()=>[e(b(zs))]),default:a(()=>[U[0]||(U[0]=f(" 保存配置 ",-1))]),_:1},8,["loading"])]),_:1})]),e(V,{loading:d.value,text:"正在读取配置文件..."},{default:a(()=>[t("div",ng,[!d.value&&S.value.length===0?(r(),C("div",lg," 无法找到配置项或文件为空 ")):O("",!0),(r(!0),C(pe,null,we(S.value,N=>(r(),C("div",{key:N.key,class:ye(["setting-item",{"unknown-item":N.isUnknown}])},[t("div",og,[t("div",rg,M(N.label),1),t("div",ig,[N.isUnknown?O("",!0):(r(),C("span",ug,M(N.key),1))]),N.isUnknown?O("",!0):(r(),C("div",dg,M(N.desc||"暂无描述"),1))]),t("div",cg,[N.type==="boolean"?(r(),K(x,{key:0,"model-value":z(N.key,"boolean"),"onUpdate:modelValue":q=>w(N.key,q,"boolean")},null,8,["model-value","onUpdate:modelValue"])):N.type==="select"?(r(),K(y,{key:1,"model-value":z(N.key,"string"),options:N.options,placeholder:"请选择","onUpdate:modelValue":q=>w(N.key,q,"string")},null,8,["model-value","options","onUpdate:modelValue"])):N.type==="number"?(r(),K(E,{key:2,"model-value":z(N.key,"number"),theme:"column",style:{width:"100%"},"onUpdate:modelValue":q=>w(N.key,q,"number")},null,8,["model-value","onUpdate:modelValue"])):(r(),K(T,{key:3,"model-value":z(N.key,"string"),placeholder:"未设置","onUpdate:modelValue":q=>w(N.key,q,"string")},null,8,["model-value","onUpdate:modelValue"]))])],2))),128))])]),_:1},8,["loading"]),t("div",mg,[e(I,{theme:"primary",size:"large",loading:o.value,onClick:h},{default:a(()=>[...U[2]||(U[2]=[f("保存设置",-1)])]),_:1},8,["loading"]),e(I,{theme:"default",variant:"base",size:"large",onClick:_},{default:a(()=>[...U[3]||(U[3]=[f("重置更改",-1)])]),_:1})])])}}}),vg=re(pg,[["__scopeId","data-v-6dfcc71c"]]);async function fg(s){return await X.get({url:`/api/instance/tasks/list/${s}`})}async function gg(s,n,l,d,o,i){return await X.post({url:"/api/instance/tasks/create",data:{instanceId:s,name:n,cron:l,payload:d,type:o,enable:i}})}async function _g(s,n,l,d,o,i,v){return await X.post({url:"/api/instance/tasks/update",data:{instanceId:s,id:n,name:l,cron:d,payload:o,type:i,enable:v}})}async function hg(s){return await X.post({url:`/api/instance/tasks/delete/${s}`})}const yg={class:"cron-gen-container"},bg={class:"mode-switch"},wg={key:0,class:"mode-content novice-panel"},kg={class:"novice-input-group"},$g={key:1,class:"mode-content pro-panel"},Ag={class:"tab-scroll-area"},xg={key:0,class:"specific-box"},Cg={class:"result-area"},Sg={class:"cron-display"},Ig={class:"code-box"},Vg={class:"next-runs"},Mg={class:"runs-title"},Ug={key:0,class:"error-msg"},Lg={key:1,class:"runs-list"},Bg={class:"index"},Rg=ne({__name:"CronGenerator",props:{visible:{type:Boolean,default:!1},initialValue:{type:String,default:""}},emits:["update:visible","confirm"],setup(s,{emit:n}){const l=s,d=n,o=$("novice"),i=$(10),v=$("minute"),u=[{label:"秒",value:"second"},{label:"分钟",value:"minute"},{label:"小时",value:"hour"},{label:"天",value:"day"}],c=$("second"),_=[{label:"秒",value:"second",min:0,max:59},{label:"分",value:"minute",min:0,max:59},{label:"时",value:"hour",min:0,max:23},{label:"日",value:"day",min:1,max:31},{label:"月",value:"month",min:1,max:12},{label:"周",value:"week",min:1,max:7}],h=$({second:{type:"every",start:0,step:1,specifics:[]},minute:{type:"every",start:0,step:1,specifics:[]},hour:{type:"every",start:0,step:1,specifics:[]},day:{type:"every",start:1,step:1,specifics:[]},month:{type:"every",start:1,step:1,specifics:[]},week:{type:"any",start:1,step:1,specifics:[]}}),S=[{label:"周日",value:1},{label:"周一",value:2},{label:"周二",value:3},{label:"周三",value:4},{label:"周四",value:5},{label:"周五",value:6},{label:"周六",value:7}],A=te(()=>{const y=(k,B="*")=>{const R=h.value[k];return k==="week"&&R.type==="any"||k==="week"&&h.value.day.type!=="every"||k==="day"&&h.value.week.type!=="any"?"?":R.type==="every"?"*":R.type==="interval"?`${R.start}/${R.step}`:R.type==="specific"?R.specifics.length===0?k==="day"||k==="month"?"1":"0":R.specifics.sort((Z,J)=>Z-J).join(","):B},E=y("second"),T=y("minute"),V=y("hour"),N=y("day"),q=y("month"),P=y("week","?");return`${E} ${T} ${V} ${N} ${q} ${P}`}),z=te(()=>{const y=i.value;switch(v.value){case"second":return`*/${y} * * * * *`;case"minute":return`0 */${y} * * * *`;case"hour":return`0 0 */${y} * * ?`;case"day":return`0 0 0 */${y} * ?`;default:return"* * * * * *"}}),w=te(()=>o.value==="novice"?z.value:A.value),g=$([]),U=$(""),I=()=>{try{const y=ol.CronExpressionParser.parse(w.value,{currentDate:new Date});g.value=y.take(5).map(E=>new Date(E.toString()).toLocaleString()),U.value=""}catch{U.value="无法解析当前 Cron 表达式，请检查规则是否冲突",g.value=[]}};ke(w,()=>{I()},{immediate:!0}),ke(()=>l.visible,y=>{y&&l.initialValue&&(o.value="pro",I())});const m=()=>{if(U.value){L.warning("当前表达式无效，无法保存");return}d("confirm",w.value),d("update:visible",!1)},x=y=>{const E=_.find(V=>V.value===y);if(!E)return[];const T=[];for(let V=E.min;V<=E.max;V++)T.push({label:V.toString(),value:V});return T};return(y,E)=>{const T=p("t-radio-button"),V=p("t-radio-group"),N=p("t-input-number"),q=p("t-select"),P=p("t-alert"),k=p("t-radio"),B=p("t-checkbox-group"),R=p("t-tab-panel"),Z=p("t-tabs"),J=p("t-tag"),W=p("t-dialog");return r(),K(W,{visible:s.visible,header:"Cron 表达式生成器",width:"700px",top:"5vh",onClose:E[4]||(E[4]=H=>d("update:visible",!1)),onConfirm:m},{default:a(()=>[t("div",yg,[t("div",bg,[e(V,{modelValue:o.value,"onUpdate:modelValue":E[0]||(E[0]=H=>o.value=H),variant:"default-filled"},{default:a(()=>[e(T,{value:"novice"},{default:a(()=>[...E[5]||(E[5]=[f("🚀 新手模式",-1)])]),_:1}),e(T,{value:"pro"},{default:a(()=>[...E[6]||(E[6]=[f("🛠️ 专业模式",-1)])]),_:1})]),_:1},8,["modelValue"])]),o.value==="novice"?(r(),C("div",wg,[t("div",kg,[E[7]||(E[7]=t("span",null,"每隔",-1)),e(N,{modelValue:i.value,"onUpdate:modelValue":E[1]||(E[1]=H=>i.value=H),min:1,theme:"column",style:{width:"100px"}},null,8,["modelValue"]),e(q,{modelValue:v.value,"onUpdate:modelValue":E[2]||(E[2]=H=>v.value=H),options:u,style:{width:"100px"}},null,8,["modelValue"]),E[8]||(E[8]=t("span",null,"执行一次",-1))]),e(P,{theme:"info",style:{"margin-top":"16px"}},{message:a(()=>[...E[9]||(E[9]=[f(" 此模式适用于简单的周期性任务。如果需要“每周五上午10点”等复杂规则，请切换到",-1),t("b",null,"专业模式",-1),f("。 ",-1)])]),_:1})])):(r(),C("div",$g,[e(Z,{modelValue:c.value,"onUpdate:modelValue":E[3]||(E[3]=H=>c.value=H)},{default:a(()=>[(r(),C(pe,null,we(_,H=>e(R,{key:H.value,value:H.value,label:H.label},{default:a(()=>[t("div",Ag,[e(V,{modelValue:h.value[H.value].type,"onUpdate:modelValue":$e=>h.value[H.value].type=$e,direction:"vertical"},{default:a(()=>[e(k,{value:"every"},{default:a(()=>[f(M(H.value==="week"?"不指定 (?)":`每${H.label} (*)`),1)]),_:2},1024),H.value!=="week"?(r(),K(k,{key:0,value:"interval"},{default:a(()=>[E[10]||(E[10]=f(" 周期: 从 ",-1)),e(N,{modelValue:h.value[H.value].start,"onUpdate:modelValue":$e=>h.value[H.value].start=$e,min:H.min,max:H.max,size:"small",theme:"column",style:{width:"60px"}},null,8,["modelValue","onUpdate:modelValue","min","max"]),f(" "+M(H.label)+"开始，每 ",1),e(N,{modelValue:h.value[H.value].step,"onUpdate:modelValue":$e=>h.value[H.value].step=$e,min:1,max:H.max,size:"small",theme:"column",style:{width:"60px"}},null,8,["modelValue","onUpdate:modelValue","max"]),f(" "+M(H.label)+"执行一次 ",1)]),_:2},1024)):O("",!0),H.value!=="week"?(r(),K(k,{key:1,value:"specific"},{default:a(()=>[f("指定: 选择具体的"+M(H.label),1)]),_:2},1024)):O("",!0),H.value==="week"?(r(),K(k,{key:2,value:"specific"},{default:a(()=>[...E[11]||(E[11]=[f("指定周几",-1)])]),_:1})):O("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),h.value[H.value].type==="specific"?(r(),C("div",xg,[e(B,{modelValue:h.value[H.value].specifics,"onUpdate:modelValue":$e=>h.value[H.value].specifics=$e,options:H.value==="week"?S:x(H.value),class:"grid-checkbox"},null,8,["modelValue","onUpdate:modelValue","options"])])):O("",!0)])]),_:2},1032,["value","label"])),64))]),_:1},8,["modelValue"])])),t("div",Cg,[t("div",Sg,[E[14]||(E[14]=t("span",{class:"label"},"当前表达式:",-1)),t("div",Ig,[f(M(w.value)+" ",1),U.value?(r(),K(J,{key:1,theme:"danger",variant:"light",size:"small"},{default:a(()=>[e(b(As)),E[13]||(E[13]=f(" 无效",-1))]),_:1})):(r(),K(J,{key:0,theme:"success",variant:"light",size:"small"},{default:a(()=>[e(b(xt)),E[12]||(E[12]=f(" 有效",-1))]),_:1}))])]),t("div",Vg,[t("div",Mg,[e(b(pt)),E[15]||(E[15]=f(" 最近 5 次运行时间预测:",-1))]),U.value?(r(),C("div",Ug,M(U.value),1)):(r(),C("ul",Lg,[(r(!0),C(pe,null,we(g.value,(H,$e)=>(r(),C("li",{key:$e},[t("span",Bg,"#"+M($e+1),1),f(" "+M(H),1)]))),128))]))])])])]),_:1},8,["visible"])}}}),zg=re(Rg,[["__scopeId","data-v-b81cfe41"]]),Dt="https://mslx.mslmc.cn",Ht={cron:`${Dt}/docs/server-config/crons`,style:`${Dt}/docs/style/webpanel/`,style_log_colorizer:`${Dt}/docs/style/webpanel/#%E7%BB%88%E7%AB%AF%E6%97%A5%E5%BF%97%E6%9F%93%E8%89%B2%E7%AD%89%E7%BA%A7%E9%85%8D%E7%BD%AE`,remote_access:`${Dt}/docs/config/remote-access/`,msl_oauth:`${Dt}/docs/config/msl-oauth`},Eg={class:"page-container"},Pg={class:"page-header"},Fg={key:0,class:"create-container"},Tg={class:"container-header"},Dg={class:"title"},Og={class:"setting-item"},jg={class:"setting-control"},Kg={class:"setting-item"},Ng={class:"setting-control"},qg={class:"setting-item"},Gg={class:"setting-control"},Hg={key:0,class:"setting-item"},Jg={class:"setting-info"},Wg={class:"title"},Xg={class:"desc"},Qg={class:"setting-control"},Yg={class:"setting-item"},Zg={class:"setting-control"},e_={class:"form-actions"},t_={class:"task-list"},a_={key:0,class:"empty-state"},s_={class:"card-left"},n_={class:"task-header-row"},l_={class:"task-name"},o_={class:"task-meta-row"},r_={class:"cron-display"},i_=["title"],u_={class:"card-right"},d_=ne({__name:"CronTasks",setup(s){const n=et(),l=te(()=>parseInt(n.params.serverId)),d=$([]),o=$(!1),i=$(!1),v=$(null),u=$(!1),c=$(null),_=$(!1),h=$({id:"",name:"",cron:"",type:"command",payload:"",enable:!0}),S=[{label:"发送命令 (Command)",value:"command"},{label:"备份存档 (Backup)",value:"backup"},{label:"开启服务器 (Start)",value:"start"},{label:"停止服务器 (Stop)",value:"stop"},{label:"重启服务器 (Restart)",value:"restart"}],A={name:[{required:!0,message:"必填",trigger:"blur"}],cron:[{required:!0,message:"必填",trigger:"blur"}],type:[{required:!0,message:"必选",trigger:"change"}],payload:[{validator:T=>h.value.type==="command"&&!T?{result:!1,message:"命令内容不能为空",type:"error"}:!0,trigger:"blur"}]},z=async()=>{if(l.value){o.value=!0;try{const T=await fg(l.value);d.value=T||[]}catch(T){L.error(T.message||"获取列表失败")}finally{o.value=!1}}},w=()=>{i.value||(h.value={id:"",name:"",cron:"",type:"command",payload:"",enable:!0},v.value=null,i.value=!0)},g=T=>{h.value={id:T.id,name:T.name,cron:T.cron,type:T.type.toLowerCase(),payload:T.payload,enable:T.enable},v.value=T.id,i.value=!0,window.scrollTo({top:0,behavior:"smooth"})},U=()=>{i.value=!1,v.value=null},I=async()=>{if(await c.value?.validate()===!0){u.value=!0;try{v.value?(await _g(l.value,h.value.id,h.value.name,h.value.cron,h.value.payload,h.value.type,h.value.enable),L.success("更新成功")):(await gg(l.value,h.value.name,h.value.cron,h.value.payload,h.value.type,h.value.enable),L.success("创建成功")),U(),z()}catch(V){L.error(V.message||"操作失败")}finally{u.value=!1}}},m=T=>{const V=Ze.confirm({header:"确认删除?",body:`确定删除任务 "${T.name}" 吗？`,theme:"danger",onConfirm:async()=>{try{await hg(T.id),L.success("已删除"),z(),V.hide()}catch(N){L.error(N.message)}},onClose:()=>V.hide()})},x=T=>{h.value.cron=T},y=T=>{const V=T.toLowerCase();return V==="start"?Xt:V==="stop"?da:V==="restart"?at:Rt},E=T=>{const V=T.toLowerCase();return V==="start"?"success":V==="stop"?"danger":V==="restart"?"warning":"primary"};return ke(()=>l.value,z),xe(z),(T,V)=>{const N=p("t-button"),q=p("t-space"),P=p("t-input"),k=p("t-select"),B=p("t-textarea"),R=p("t-switch"),Z=p("t-form"),J=p("t-tag"),W=p("t-loading");return r(),C("div",Eg,[t("div",Pg,[V[10]||(V[10]=t("div",{class:"section-title"},"定时计划任务",-1)),e(q,null,{default:a(()=>[i.value?O("",!0):(r(),K(N,{key:0,theme:"default",onClick:V[0]||(V[0]=H=>b(Ie)(b(Ht).cron))},{icon:a(()=>[e(b(oa))]),default:a(()=>[V[8]||(V[8]=f(" 使用文档 ",-1))]),_:1})),i.value?O("",!0):(r(),K(N,{key:1,theme:"primary",onClick:w},{icon:a(()=>[e(b(pa))]),default:a(()=>[V[9]||(V[9]=f(" 创建新任务 ",-1))]),_:1}))]),_:1})]),e(Wt,{name:"slide-fade"},{default:a(()=>[i.value?(r(),C("div",Fg,[t("div",Tg,[t("span",Dg,M(v.value?"编辑任务":"创建新任务"),1),e(N,{size:"small",variant:"text",onClick:U},{default:a(()=>[e(b(za))]),_:1})]),e(Z,{ref_key:"formRef",ref:c,data:h.value,rules:A,"label-width":"0"},{default:a(()=>[t("div",Og,[V[11]||(V[11]=t("div",{class:"setting-info"},[t("div",{class:"title"},"任务名称"),t("div",{class:"desc"},"给这个计划任务起个容易识别的名字，例如“每日自动重启”")],-1)),t("div",jg,[e(P,{modelValue:h.value.name,"onUpdate:modelValue":V[1]||(V[1]=H=>h.value.name=H),placeholder:"请输入任务名称"},null,8,["modelValue"])])]),t("div",Kg,[V[13]||(V[13]=t("div",{class:"setting-info"},[t("div",{class:"title"},"触发规则 (Cron)"),t("div",{class:"desc"},"使用 Cron 表达式定义执行时间。支持秒级精度 (秒 分 时 日 月 周)")],-1)),t("div",Ng,[e(P,{modelValue:h.value.cron,"onUpdate:modelValue":V[2]||(V[2]=H=>h.value.cron=H),placeholder:"例如: 0 0 12 * * ?"},null,8,["modelValue"]),e(N,{variant:"outline",theme:"default",onClick:V[3]||(V[3]=H=>_.value=!0)},{default:a(()=>[...V[12]||(V[12]=[f(" 表达式生成器 ",-1)])]),_:1})])]),t("div",qg,[V[14]||(V[14]=t("div",{class:"setting-info"},[t("div",{class:"title"},"执行操作"),t("div",{class:"desc"},"选择触发时要执行的动作类型")],-1)),t("div",Gg,[e(k,{modelValue:h.value.type,"onUpdate:modelValue":V[4]||(V[4]=H=>h.value.type=H),options:S},null,8,["modelValue"])])]),h.value.type==="command"||h.value.type==="restart"?(r(),C("div",Hg,[t("div",Jg,[t("div",Wg,M(h.value.type==="restart"?"重启提示语":"控制台命令"),1),t("div",Xg,M(h.value.type==="restart"?"重启前发送给全服玩家的倒计时提示消息":"不需要加 /，直接输入命令内容"),1)]),t("div",Qg,[e(B,{modelValue:h.value.payload,"onUpdate:modelValue":V[5]||(V[5]=H=>h.value.payload=H),autosize:{minRows:2,maxRows:5},placeholder:"请输入内容..."},null,8,["modelValue"])])])):O("",!0),t("div",Yg,[V[15]||(V[15]=t("div",{class:"setting-info"},[t("div",{class:"title"},"启用状态"),t("div",{class:"desc"},"暂时禁用此任务而不删除它")],-1)),t("div",Zg,[e(R,{modelValue:h.value.enable,"onUpdate:modelValue":V[6]||(V[6]=H=>h.value.enable=H)},null,8,["modelValue"])])]),t("div",e_,[e(N,{theme:"primary",loading:u.value,onClick:I},{icon:a(()=>[e(b(zs))]),default:a(()=>[f(" "+M(v.value?"保存修改":"立即创建"),1)]),_:1},8,["loading"]),e(N,{theme:"default",variant:"base",onClick:U},{default:a(()=>[...V[16]||(V[16]=[f("取消",-1)])]),_:1})])]),_:1},8,["data"])])):O("",!0)]),_:1}),e(W,{loading:o.value,"show-overlay":""},{default:a(()=>[t("div",t_,[d.value.length===0&&!o.value?(r(),C("div",a_,"暂无任务，请点击上方创建")):O("",!0),(r(!0),C(pe,null,we(d.value,H=>(r(),C("div",{key:H.id,class:"task-card"},[t("div",s_,[t("div",n_,[e(J,{size:"small",theme:H.enable?"success":"warning",variant:"light",class:"status-tag"},{default:a(()=>[f(M(H.enable?"运行中":"已暂停"),1)]),_:2},1032,["theme"]),t("span",l_,M(H.name),1)]),t("div",o_,[e(J,{size:"small",variant:"outline",theme:E(H.type),style:{"margin-right":"8px"}},{icon:a(()=>[(r(),K(lt(y(H.type))))]),default:a(()=>[f(" "+M(H.type.toUpperCase()),1)]),_:2},1032,["theme"]),t("span",r_,[e(b(pt)),f(" "+M(H.cron),1)])]),H.payload?(r(),C("div",{key:0,class:"task-payload",title:H.payload},M(H.payload),9,i_)):O("",!0)]),t("div",u_,[e(N,{variant:"text",theme:"primary",onClick:$e=>g(H)},{icon:a(()=>[e(b(Ms))]),default:a(()=>[V[17]||(V[17]=f(" 编辑 ",-1))]),_:1},8,["onClick"]),e(N,{variant:"text",theme:"danger",onClick:$e=>m(H)},{icon:a(()=>[e(b(wt))]),default:a(()=>[V[18]||(V[18]=f(" 删除 ",-1))]),_:1},8,["onClick"])])]))),128))])]),_:1},8,["loading"]),e(zg,{visible:_.value,"onUpdate:visible":V[7]||(V[7]=H=>_.value=H),"initial-value":h.value.cron,onConfirm:x},null,8,["visible","initial-value"])])}}}),c_=re(d_,[["__scopeId","data-v-98dd2a72"]]),m_={class:"settings-container"},p_={class:"setting-item"},v_={class:"setting-info"},f_={class:"desc"},g_={class:"setting-control"},__={key:0,class:"bulk-action-bar"},h_={class:"selected-text"},y_={class:"backup-table-wrapper"},b_={class:"file-name-cell"},w_={class:"time-cell"},k_=ne({__name:"BackupManager",setup(s){const n=et(),l=te(()=>{const w=n.params.serverId;return w?parseInt(w):NaN}),d=$(!1),o=$([]),i=$([]),v=[{colKey:"row-select",type:"multiple",width:20,fixed:"left"},{colKey:"fileName",title:"文件名",ellipsis:!0,width:200},{colKey:"fileSizeStr",title:"文件大小",width:120},{colKey:"createTime",title:"备份时间",width:180},{colKey:"op",title:"操作",fixed:"right",width:140}],u=w=>new Promise(g=>setTimeout(g,w)),c=async()=>{if(l.value){d.value=!0,i.value=[];try{const w=await ti(l.value);o.value=w.data||w}catch(w){L.error("获取备份列表失败: "+w.message)}finally{d.value=!1}}},_=w=>{i.value=w},h=w=>{const g=Ze.confirm({header:"确认删除备份?",body:`您确定要永久删除文件 "${w.fileName}" 吗？此操作不可恢复。`,theme:"danger",onConfirm:async()=>{g.hide();try{await La(l.value,w.fileName),L.success("删除成功"),await c()}catch(U){L.error(U.message||"删除失败")}},onClose:()=>{g.hide()}})},S=w=>{try{const g=Ba(l.value,w.fileName);window.open(g,"_blank")}catch(g){L.error("下载失败！"+g.message)}},A=()=>{const w=i.value.length;w!==0&&(L.info(`开始下载 ${w} 个文件，请注意允许浏览器弹窗...`),i.value.forEach((g,U)=>{setTimeout(()=>{const I=Ba(l.value,g);window.open(I,"_blank")},U*1e3)}))},z=()=>{const w=i.value.length;if(w===0)return;const g=Ze.confirm({header:"确认批量删除?",body:`您选中了 ${w} 个备份文件。删除后无法恢复，确定要继续吗？`,theme:"danger",onConfirm:async()=>{g.hide(),d.value=!0;let U=0,I=0,m=null;try{for(const[x,y]of i.value.entries()){m&&L.close(m),m=L.loading(`正在删除 ${y} (${x+1}/${w})...`,0);try{await La(l.value,y),U++}catch(E){I++,console.error(`删除 ${y} 失败`,E)}x<w-1&&await u(800)}}finally{m&&L.close(m),d.value=!1,I===0?L.success(`批量删除完成，共删除 ${U} 个文件`):L.warning(`批量操作完成：成功 ${U} 个，失败 ${I} 个`),await c()}},onClose:()=>{g.hide()}})};return ke(()=>n.params.serverId,w=>{w&&c()}),xe(()=>{c()}),(w,g)=>{const U=p("t-button"),I=p("t-tooltip"),m=p("t-space"),x=p("t-table");return r(),C("div",m_,[g[10]||(g[10]=t("div",{class:"setting-group-title"},"备份管理",-1)),t("div",p_,[t("div",v_,[g[4]||(g[4]=t("div",{class:"title"},"存档快照",-1)),t("div",f_,[g[0]||(g[0]=f(" 查看和管理服务器的自动或手动备份。建议定期下载重要备份到本地保存。 ",-1)),g[1]||(g[1]=t("br",null,null,-1)),g[2]||(g[2]=f(" 当前共有 ",-1)),t("b",null,M(o.value.length),1),g[3]||(g[3]=f(" 个备份文件。最大保存备份文件的数量需要在实例设置中配置。 ",-1))])]),t("div",g_,[e(Wt,{name:"fade",mode:"out-in"},{default:a(()=>[i.value.length>0?(r(),C("div",__,[g[7]||(g[7]=t("div",{class:"bar-separator"},null,-1)),t("span",h_,"已选 "+M(i.value.length)+" 项",1),e(U,{variant:"text",theme:"primary",onClick:A},{default:a(()=>[...g[5]||(g[5]=[f(" 下载 ",-1)])]),_:1}),e(U,{variant:"text",theme:"danger",onClick:z},{default:a(()=>[...g[6]||(g[6]=[f(" 删除 ",-1)])]),_:1})])):(r(),K(U,{key:1,theme:"primary",variant:"outline",onClick:c},{icon:a(()=>[e(b(at))]),default:a(()=>[g[8]||(g[8]=f(" 刷新列表 ",-1))]),_:1}))]),_:1})])]),t("div",y_,[e(x,{"row-key":"fileName",data:o.value,columns:v,loading:d.value,"selected-row-keys":i.value,stripe:"",hover:"",class:"custom-table",onSelectChange:_},{fileName:a(({row:y})=>[t("div",b_,[e(b(Nt),{style:{"margin-right":"6px",color:"var(--td-brand-color)"}}),t("span",null,M(y.fileName),1)])]),createTime:a(({row:y})=>[t("div",w_,[e(b(pt),{style:{"margin-right":"6px",color:"var(--td-text-color-placeholder)"}}),f(" "+M(y.createTime),1)])]),op:a(({row:y})=>[e(m,null,{default:a(()=>[e(I,{content:"下载备份"},{default:a(()=>[e(U,{variant:"text",shape:"square",theme:"primary",onClick:E=>S(y)},{default:a(()=>[e(b(ca))]),_:1},8,["onClick"])]),_:2},1024),e(I,{content:"删除备份"},{default:a(()=>[e(U,{variant:"text",shape:"square",theme:"danger",onClick:E=>h(y)},{default:a(()=>[e(b(wt))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),empty:a(()=>[...g[9]||(g[9]=[t("div",{class:"empty-state"},"暂无备份记录",-1)])]),_:1},8,["data","loading","selected-row-keys"])])])}}}),$_=re(k_,[["__scopeId","data-v-e5d92c81"]]),A_={class:"layout-container"},x_={class:"sidebar"},C_=["onClick"],S_={class:"nav-text"},I_={class:"main-content"},V_={key:0,class:"panel-wrapper"},M_={key:1,class:"panel-wrapper"},U_={key:2,class:"panel-wrapper"},L_={key:3,class:"panel-wrapper"},B_={key:4,class:"panel-wrapper"},R_=ne({__name:"InstanceSettings",setup(s,{expose:n}){const l=$(!1),d=$(0),o=[{label:"实例设置",icon:Fa},{label:"插件/模组",icon:Vn},{label:"服务器属性",icon:Mn},{label:"定时任务",icon:pt},{label:"备份管理",icon:Un}];return n({open:()=>{l.value=!0}}),(v,u)=>{const c=p("t-dialog");return r(),K(c,{visible:l.value,"onUpdate:visible":u[0]||(u[0]=_=>l.value=_),header:"实例配置",width:"90%",top:"3vh",attach:"body",footer:!1,class:"settings-dialog"},{default:a(()=>[t("div",A_,[t("div",x_,[(r(),C(pe,null,we(o,(_,h)=>t("div",{key:h,class:ye(["nav-item",{active:d.value===h}]),onClick:S=>d.value=h},[(r(),K(lt(_.icon),{class:"nav-icon"})),t("span",S_,M(_.label),1)],10,C_)),64))]),t("div",I_,[d.value===0?(r(),C("div",V_,[e(yf)])):O("",!0),d.value===1?(r(),C("div",M_,[e(tg)])):O("",!0),d.value===2?(r(),C("div",U_,[e(vg,{"instance-id":21})])):O("",!0),d.value===3?(r(),C("div",L_,[e(c_)])):O("",!0),d.value===4?(r(),C("div",B_,[e($_)])):O("",!0)])])]),_:1},8,["visible"])}}}),z_=re(R_,[["__scopeId","data-v-5ce426cf"]]),E_={class:"monitor-container"},P_={class:"status-header"},F_={class:"status-text"},T_={class:"monitor-content"},D_={class:"monitor-block"},O_={class:"info-item"},j_={class:"label"},K_={class:"value"},N_={class:"monitor-block"},q_={class:"info-item"},G_={class:"label"},H_={class:"value"},J_={key:0,class:"sub-val"},ta=20,W_=ne({__name:"InstanceMonitor",props:{serverId:{},maxMemory:{},isRunning:{type:Boolean}},setup(s){const n=s,l=Za(),d=$(null),o=$(null);let i=null,v=null;const u=$(new Array(ta).fill(0)),c=$(new Array(ta).fill(0)),_=te(()=>n.maxMemory>0),h=(U,I,m=100)=>({grid:{top:4,right:0,bottom:4,left:0},xAxis:{type:"category",show:!1,boundaryGap:!1},yAxis:{type:"value",min:0,max:m===null?void 0:m,show:!1},series:[{type:"line",data:I,smooth:!0,showSymbol:!1,lineStyle:{width:2,color:U},areaStyle:{color:new js(0,0,0,1,[{offset:0,color:U.replace(")",", 0.2)").replace("rgb","rgba")},{offset:1,color:"transparent"}])}}]}),S=()=>{const U=getComputedStyle(document.documentElement),I=U.getPropertyValue("--td-brand-color").trim()||"#0052d9",m=U.getPropertyValue("--td-warning-color").trim()||"#e37318";if(d.value&&(i=ra(d.value),i.setOption(h(I,u.value,100))),o.value){v=ra(o.value);const x=_.value?100:null;v.setOption(h(m,c.value,x))}window.addEventListener("resize",A)},A=()=>{i?.resize(),v?.resize()},z=te(()=>{const U=l.stats.memBytes/1024/1024;return U>1024?`${(U/1024).toFixed(2)} GB`:`${U.toFixed(0)} MB`}),w=async()=>{n.isRunning&&n.serverId&&(l.setMaxMemory(n.maxMemory),await l.connect(n.serverId))},g=async()=>{await l.disconnect()};return ke(()=>n.maxMemory,U=>{if(l.setMaxMemory(U),v){const I=U>0?100:null;v.setOption({yAxis:{max:I===null?void 0:I}})}},{immediate:!0}),ke(()=>l.stats,U=>{if(!(!n.isRunning||l.currentServerId!==n.serverId)){if(u.value.push(U.cpu),u.value.length>ta&&u.value.shift(),_.value)c.value.push(U.memPercent);else{const I=U.memBytes/1024/1024;c.value.push(I)}c.value.length>ta&&c.value.shift(),i?.setOption({series:[{data:u.value}]}),v?.setOption({series:[{data:c.value}]})}},{deep:!0}),ke(()=>n.isRunning,async U=>{U?yt(()=>{A(),w()}):(u.value.fill(0),c.value.fill(0),i?.setOption({series:[{data:u.value}]}),v?.setOption({series:[{data:c.value}]}),await g())}),ke(()=>n.serverId,async(U,I)=>{U!==I&&(await g(),n.isRunning&&await w())}),xe(async()=>{await yt(),S(),n.isRunning&&await w()}),Qe(async()=>{window.removeEventListener("resize",A),await g(),i?.dispose(),v?.dispose()}),(U,I)=>(r(),C("div",E_,[t("div",P_,[t("span",F_,[b(l).isConnected?(r(),K(b(es),{key:0,style:{color:"var(--td-success-color)"}})):(r(),K(b(es),{key:1,style:{color:"var(--td-text-color-disabled)"}})),f(" "+M(b(l).isConnected?"连接正常":"正在连接数据流..."),1)]),t("div",{class:ye(["monitor-dot",{active:b(l).isConnected&&s.isRunning}])},null,2)]),t("div",T_,[t("div",D_,[t("div",O_,[t("div",j_,[e(b(Ca)),I[0]||(I[0]=f(" CPU 使用率",-1))]),t("div",K_,M(b(l).stats.cpu.toFixed(1))+" %",1)]),t("div",{ref_key:"cpuChartRef",ref:d,class:"chart-wrapper"},null,512)]),I[2]||(I[2]=t("div",{class:"divider"},null,-1)),t("div",N_,[t("div",q_,[t("div",G_,[e(b(Ln)),I[1]||(I[1]=f(" 内存使用",-1))]),t("div",H_,[f(M(z.value)+" ",1),_.value?(r(),C("span",J_," ("+M(b(l).stats.memPercent.toFixed(1))+"%) ",1)):O("",!0)])]),t("div",{ref_key:"memChartRef",ref:o,class:"chart-wrapper"},null,512)])])]))}}),X_=re(W_,[["__scopeId","data-v-ddbf668d"]]);async function Q_(s){return await X.get({url:"/api/tools/ai/usage",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${s}`}})}async function Y_(s){return await X.get({url:"/api/tools/ai/models",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${s}`}})}async function Z_(s,n,l,d,o,i){return n===""&&(n=null),l===""&&(l=null),await X.post({url:"/api/tools/ai/analysis",baseURL:"https://user.mslmc.net",headers:{Authorization:`Bearer ${s}`},data:{mods:n,plugins:l,core:d,logs:o,model:i,usemd:!0},timeout:300*1e3})}const eh={class:"analysis-container"},th={class:"panel-left"},ah={class:"form-group"},sh={class:"model-option-item"},nh={class:"form-group"},lh={class:"form-group"},oh={class:"env-tabs"},rh={class:"form-group flex-grow"},ih={class:"action-bar"},uh={class:"panel-right"},dh={class:"panel-header"},ch={class:"stats-tags"},mh={class:"report-content"},ph=ne({__name:"LogAnalysis",props:{visible:{type:Boolean},serverId:{}},emits:["update:visible","submit"],setup(s,{emit:n}){const l=et(),d=s,o=n,i=Xe({coreVersion:"",envType:"mods",modsList:"",pluginsList:"",logContent:"",result:"> ✨ 等待日志分析开始······",selectedModel:"Qwen/Qwen3-14B"}),v=$([]),u=Xe({max:0,today:0,extra:0,lastTime:0}),c=$(!1),_=$(!1),h=$(!1);async function S(){const I=await Q_(localStorage.getItem("msl-user-token"));if(I.code===200)u.max=I.data.max_per_day,u.extra=I.data.extra_tokens,u.lastTime=I.data.last_use_time,u.today=I.data.today_usage;else{L.error("MSL账号未登录或已失效，请重新登录！"),Ie("/frp/create");return}}async function A(){try{_.value=!0,await S();try{const m=await Y_(localStorage.getItem("msl-user-token")||"");m.code===200&&(v.value=m.data,!i.selectedModel&&v.value.length>0&&(i.selectedModel=v.value[0].name))}catch(m){L.error("获取模型列表失败"+m.message)}const I=await Hs(d.serverId);i.coreVersion=I.core;try{const m=await Ma(d.serverId,"mods",!1);i.modsList=(m.jarFiles||[]).join(`
`),i.envType="mods"}catch{i.modsList=""}try{const m=await Ma(d.serverId,"plugins",!1);i.pluginsList=(m.jarFiles||[]).join(`
`),i.modsList==""&&(i.envType="plugins")}catch{i.pluginsList=""}try{i.logContent=await fa(d.serverId,"logs/latest.log")}catch{}}catch(I){L.error(I.message)}_.value=!1}ke(()=>d.visible,I=>{l.name==="InstanceConsole"&&(c.value=I,I&&A())});const z=()=>{o("update:visible",!1)};async function w(){if(i.logContent){if(!i.selectedModel){L.warning("请先选择分析模型");return}h.value=!0,i.result="> ⌛️ 分析日志中··· 请稍等";try{const I=await Z_(localStorage.getItem("msl-user-token"),i.modsList,i.pluginsList,i.coreVersion,i.logContent,i.selectedModel);i.result=I.data.content}catch(I){i.result=`> ❌ 分析出现错误: ${I.message}`}h.value=!1,await S()}}const g=Cs(),U=$(g.value?"dark":"light");return ke(g,()=>{U.value=g.value?"dark":"light"}),(I,m)=>{const x=p("t-tag"),y=p("t-option"),E=p("t-select"),T=p("t-input"),V=p("t-radio-button"),N=p("t-radio-group"),q=p("t-textarea"),P=p("t-button"),k=p("t-loading"),B=p("t-dialog");return r(),K(B,{visible:c.value,"onUpdate:visible":m[6]||(m[6]=R=>c.value=R),width:"90%",top:"3vh",footer:!1,"close-on-overlay-click":!1,class:"log-analysis-dialog",onClose:z},{header:a(()=>[...m[7]||(m[7]=[t("div",{class:"dialog-title"},[t("span",{style:{display:"flex","align-items":"center",gap:"8px"}}," AI 错误日志分析 ")],-1)])]),default:a(()=>[e(k,{loading:_.value},{default:a(()=>[t("div",eh,[t("div",th,[t("div",ah,[m[8]||(m[8]=t("div",{class:"label"},"选择分析模型",-1)),e(E,{modelValue:i.selectedModel,"onUpdate:modelValue":m[0]||(m[0]=R=>i.selectedModel=R),placeholder:"请选择AI模型",filterable:""},{default:a(()=>[(r(!0),C(pe,null,we(v.value,R=>(r(),K(y,{key:R.name,value:R.name,label:R.name},{default:a(()=>[t("div",sh,[t("span",null,M(R.name),1),e(x,{size:"small",variant:"light",theme:"default"},{default:a(()=>[f(" 倍率: "+M(R.rate)+"x ",1)]),_:2},1024)])]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),t("div",nh,[m[9]||(m[9]=t("div",{class:"label"},"服务端核心/版本",-1)),e(T,{modelValue:i.coreVersion,"onUpdate:modelValue":m[1]||(m[1]=R=>i.coreVersion=R),readonly:"",placeholder:"例如: Arclight 1.21.1"},{"prefix-icon":a(()=>[e(b(qt))]),_:1},8,["modelValue"])]),t("div",lh,[m[12]||(m[12]=t("div",{class:"label"},"环境列表",-1)),t("div",oh,[e(N,{modelValue:i.envType,"onUpdate:modelValue":m[2]||(m[2]=R=>i.envType=R),variant:"default-filled",class:"custom-radio-group"},{default:a(()=>[e(V,{value:"mods"},{default:a(()=>[e(b(qt),{class:"mr-1"}),m[10]||(m[10]=f(" 模组 (Mods) ",-1))]),_:1}),e(V,{value:"plugins"},{default:a(()=>[e(b(Aa),{class:"mr-1"}),m[11]||(m[11]=f(" 插件 (Plugins) ",-1))]),_:1})]),_:1},8,["modelValue"])]),Ye(e(q,{modelValue:i.modsList,"onUpdate:modelValue":m[3]||(m[3]=R=>i.modsList=R),readonly:"",autosize:{minRows:4,maxRows:6},placeholder:"暂无模组数据...",class:"mt-2 readonly-textarea"},null,8,["modelValue"]),[[nt,i.envType==="mods"]]),Ye(e(q,{modelValue:i.pluginsList,"onUpdate:modelValue":m[4]||(m[4]=R=>i.pluginsList=R),readonly:"",autosize:{minRows:4,maxRows:6},placeholder:"暂无插件数据...",class:"mt-2 readonly-textarea"},null,8,["modelValue"]),[[nt,i.envType==="plugins"]])]),t("div",rh,[m[13]||(m[13]=t("div",{class:"label"},"错误日志内容",-1)),e(q,{modelValue:i.logContent,"onUpdate:modelValue":m[5]||(m[5]=R=>i.logContent=R),placeholder:"没找到有效日志，您可以手动粘贴日志......",class:"log-textarea"},null,8,["modelValue"])]),t("div",ih,[e(P,{loading:h.value,block:"",theme:"primary",size:"large",onClick:w},{icon:a(()=>[e(b(Bn))]),default:a(()=>[m[14]||(m[14]=f(" 开始 AI 诊断 ",-1))]),_:1},8,["loading"])])]),t("div",uh,[t("div",dh,[m[15]||(m[15]=t("span",{class:"title"},"AI 分析报告",-1)),t("div",ch,[e(x,{theme:"default",variant:"light",size:"small"},{icon:a(()=>[e(b(Rn))]),default:a(()=>[f(" 今日: "+M(u.today)+" / "+M(u.max),1)]),_:1}),e(x,{theme:"primary",variant:"light",size:"small"},{icon:a(()=>[e(b(Nt))]),default:a(()=>[f(" 额外: "+M(u.extra),1)]),_:1}),e(x,{theme:"warning",variant:"light",size:"small"},{icon:a(()=>[e(b(pt))]),default:a(()=>[f(" 上次: "+M(b(Js)(u.lastTime)),1)]),_:1})])]),t("div",mh,[e(b(Ss),{"editor-id":"report-preview","model-value":i.result,theme:U.value,class:"md-preview-wrapper"},null,8,["model-value","theme"])])])])]),_:1},8,["loading"])]),_:1},8,["visible"])}}}),vh=re(ph,[["__scopeId","data-v-ec4bde3b"]]),fh={class:"sidebar-content"},gh={class:"control-header"},_h={class:"control-actions"},hh={key:0,class:"running-action-group"},yh={class:"action-row"},bh={class:"card-content-area"},wh={key:0,class:"info-list"},kh={class:"info-item"},$h={class:"label"},Ah={class:"value"},xh={class:"info-item"},Ch={class:"label"},Sh={class:"value"},Ih={class:"info-item"},Vh={class:"label"},Mh={class:"value"},Uh={class:"info-item"},Lh={class:"label"},Bh={class:"value"},Rh={class:"info-item"},zh={class:"label"},Eh={class:"value"},Ph={class:"info-item"},Fh={class:"label"},Th={class:"value"},Dh={class:"info-item"},Oh={class:"label"},jh={class:"value"},Kh={key:1,class:"info-item"},Nh={class:"label"},qh={class:"info-item"},Gh={class:"label"},Hh={class:"value"},Jh={key:1,class:"monitor-view"},Wh={key:1,class:"monitor-placeholder"},Xh=ne({__name:"ServerControlPanel",props:{serverId:{},status:{},loading:{type:Boolean},serverInfo:{}},emits:["start","stop","clear-log","refresh-info","backup","force-exit","restart"],setup(s,{emit:n}){const l=s,d=n,o=te(()=>{switch(l.status){case 1:return{text:"Starting",label:"启动中",theme:"primary",pulse:!0};case 2:return{text:"Running",label:"运行中",theme:"success",pulse:!0};case 3:return{text:"Stopping",label:"停止中",theme:"warning",pulse:!0};case 4:return{text:"Restarting",label:"重启中",theme:"primary",pulse:!0};default:return{text:"Stopped",label:"已停止",theme:"default",pulse:!1}}}),i=$(!1),v=$(null),u=$("info"),c=()=>{v.value?.open()},_=()=>{d("refresh-info")},h=$(0);let S=null;const A=w=>{if(!w)return 0;const g=w.match(/^(?:(\d+)\.)?(\d{1,2}):(\d{2}):(\d{2})(?:\.\d+)?$/);return g?parseInt(g[1]||"0",10)*86400+parseInt(g[2])*3600+parseInt(g[3])*60+parseInt(g[4]):0},z=te(()=>{if(h.value<=0)return"00:00:00";const w=Math.floor(h.value/86400),g=new Date(h.value*1e3).toISOString().substr(11,8);return w>0?`${w}天 ${g}`:g});return ke(()=>l.serverInfo?.uptime,w=>w&&(h.value=A(w)),{immediate:!0}),ke(()=>l.status,w=>{w===2?S||(S=window.setInterval(()=>h.value++,1e3)):S&&(clearInterval(S),S=null)},{immediate:!0}),Qe(()=>{S&&clearInterval(S)}),(w,g)=>{const U=p("t-tag"),I=p("t-button"),m=p("t-dropdown-item"),x=p("t-dropdown-menu"),y=p("t-dropdown"),E=p("t-card"),T=p("t-radio-button"),V=p("t-radio-group");return r(),C("div",fh,[e(E,{bordered:!1,class:"control-card"},{default:a(()=>[t("div",gh,[t("div",{class:ye(["status-indicator",o.value.theme])},[g[10]||(g[10]=t("span",{class:"pulse"},null,-1)),f(M(o.value.text),1)],2),e(U,{theme:o.value.theme,variant:"light",shape:"round"},{default:a(()=>[f(M(o.value.label),1)]),_:1},8,["theme"])]),t("div",_h,[s.status===0?(r(),K(I,{key:0,theme:"primary",size:"large",block:"",loading:s.loading,onClick:g[0]||(g[0]=N=>{w.$emit("clear-log"),w.$emit("start")})},{icon:a(()=>[e(b(Xt))]),default:a(()=>[g[11]||(g[11]=f("启动实例 ",-1))]),_:1},8,["loading"])):(r(),C(pe,{key:1},[s.status===2&&!s.loading?(r(),C("div",hh,[e(I,{class:"stop-btn",theme:"danger",size:"large",onClick:g[1]||(g[1]=N=>w.$emit("stop"))},{icon:a(()=>[e(b(da))]),default:a(()=>[g[12]||(g[12]=f(" 停止 ",-1))]),_:1}),e(I,{theme:"warning",size:"large",shape:"square",onClick:g[2]||(g[2]=N=>w.$emit("restart"))},{icon:a(()=>[e(b(at))]),_:1})])):O("",!0),s.status===3||s.status===4||s.loading?(r(),K(I,{key:1,class:"force-kill-btn glass-btn",theme:s.loading?"primary":"danger",variant:"outline",block:"",loading:s.loading,onClick:g[3]||(g[3]=N=>w.$emit("force-exit"))},{icon:a(()=>[s.loading?O("",!0):(r(),K(b(Pa),{key:0}))]),default:a(()=>[f(" "+M(s.loading?"正在处理...":"强制结束"),1)]),_:1},8,["theme","loading"])):O("",!0)],64)),t("div",yh,[e(I,{class:"glass-btn",variant:"outline",block:"",onClick:g[4]||(g[4]=N=>b(Ie)(`/instance/files/${s.serverId}`))},{icon:a(()=>[e(b(zt))]),default:a(()=>[g[13]||(g[13]=f("文件管理 ",-1))]),_:1}),e(I,{class:"glass-btn",variant:"outline",block:"",onClick:c},{icon:a(()=>[e(b(Fa))]),default:a(()=>[g[14]||(g[14]=f("实例设置 ",-1))]),_:1})]),e(y,{trigger:"click","min-column-width":120,placement:"bottom"},{default:a(()=>[e(I,{theme:"primary",class:"glass-btn",variant:"outline",block:""},{icon:a(()=>[e(b(Es))]),default:a(()=>[g[15]||(g[15]=f("更多功能 ",-1))]),_:1}),e(x,null,{default:a(()=>[e(m,{onClick:g[5]||(g[5]=N=>w.$emit("clear-log"))},{"prefix-icon":a(()=>[e(b(at))]),default:a(()=>[g[16]||(g[16]=f(" 清空日志 ",-1))]),_:1}),e(m,{disabled:s.status!==2||s.loading,onClick:g[6]||(g[6]=N=>w.$emit("backup"))},{"prefix-icon":a(()=>[e(b(Bt))]),default:a(()=>[g[17]||(g[17]=f(" 立即备份 ",-1))]),_:1},8,["disabled"]),e(m,{onClick:g[7]||(g[7]=N=>i.value=!0)},{"prefix-icon":a(()=>[e(b(zn))]),default:a(()=>[g[18]||(g[18]=f(" 日志分析 ",-1))]),_:1})]),_:1})]),_:1})])]),_:1}),e(E,{bordered:!1,title:"实例概览",class:"info-card"},{actions:a(()=>[e(V,{modelValue:u.value,"onUpdate:modelValue":g[8]||(g[8]=N=>u.value=N),variant:"default-filled",size:"small"},{default:a(()=>[e(T,{value:"info"},{default:a(()=>[e(b(On)),g[19]||(g[19]=f(" 详情",-1))]),_:1}),e(T,{value:"monitor"},{default:a(()=>[e(b(jn)),g[20]||(g[20]=f(" 监控",-1))]),_:1})]),_:1},8,["modelValue"])]),default:a(()=>[t("div",bh,[u.value==="info"?(r(),C("div",wh,[t("div",kh,[t("div",$h,[e(b(En)),g[21]||(g[21]=f(" 实例名称",-1))]),t("div",Ah,M(s.serverInfo?.name),1)]),s.serverInfo?.java!=="none"?(r(),C(pe,{key:0},[t("div",xh,[t("div",Ch,[e(b(Ca)),g[22]||(g[22]=f(" 内存限制",-1))]),t("div",Sh,M(s.serverInfo?.maxM)+" MB",1)]),g[28]||(g[28]=t("div",{class:"proxy-group"},null,-1)),t("div",Ih,[t("div",Vh,[e(b(Pn)),g[23]||(g[23]=f(" 运行端口",-1))]),t("div",Mh,M(s.serverInfo?.mcConfig?.serverPort),1)]),t("div",Uh,[t("div",Lh,[e(b(Fn)),g[24]||(g[24]=f(" 游戏难度",-1))]),t("div",Bh,[e(U,{theme:"primary"},{default:a(()=>[f(M(s.serverInfo?.mcConfig?.difficulty),1)]),_:1})])]),t("div",Rh,[t("div",zh,[e(b(Tn)),g[25]||(g[25]=f(" 游戏模式",-1))]),t("div",Eh,[e(U,null,{default:a(()=>[f(M(s.serverInfo?.mcConfig?.gamemode),1)]),_:1})])]),t("div",Ph,[t("div",Fh,[e(b(zt)),g[26]||(g[26]=f(" 游戏地图",-1))]),t("div",Th,M(s.serverInfo?.mcConfig?.levelName),1)]),t("div",Dh,[t("div",Oh,[e(b(Dn)),g[27]||(g[27]=f(" 正版验证",-1))]),t("div",jh,[e(U,{theme:s.serverInfo?.mcConfig?.onlineMode==="true"?"success":"warning"},{default:a(()=>[f(M(s.serverInfo?.mcConfig?.onlineMode==="true"?"开启":"关闭"),1)]),_:1},8,["theme"])])])],64)):(r(),C("div",Kh,[t("div",Nh,[e(b(Ca)),g[29]||(g[29]=f(" 模式",-1))]),g[30]||(g[30]=t("div",{class:"value"},"自定义模式",-1))])),g[32]||(g[32]=t("div",{class:"proxy-group"},null,-1)),t("div",qh,[t("div",Gh,[e(b(pt)),g[31]||(g[31]=f(" 运行时长",-1))]),t("div",Hh,M(s.status===2?z.value:"--:--:--"),1)])])):u.value==="monitor"?(r(),C("div",Jh,[s.serverInfo&&s.status!==0?(r(),K(X_,{key:0,"server-id":s.serverId,"is-running":s.status===2,"max-memory":s.serverInfo.java==="none"?0:s.serverInfo.maxM||4096},null,8,["server-id","is-running","max-memory"])):(r(),C("div",Wh,"实例未运行"))])):O("",!0)])]),_:1}),e(z_,{ref_key:"settingsRef",ref:v,"server-id":s.serverId,onSuccess:_},null,8,["server-id"]),e(vh,{"server-id":s.serverId,visible:i.value,"onUpdate:visible":g[9]||(g[9]=N=>i.value=N)},null,8,["server-id","visible"])])}}}),Qh=re(Xh,[["__scopeId","data-v-f332d420"]]),Yh={class:"console-page"},Zh={class:"layout-container"},ey={class:"main-terminal-area"},ty={class:"sidebar-area"},ay={style:{"line-height":"1.6"}},sy={style:{"margin-bottom":"12px"}},ny=ne({__name:"index",setup(s){const n=et(),l=ea(),d=Za(),o=$(parseInt(n.params.serverId)||0),i=$(0),v=$(!1),u=$(null),c=$(null);async function _(){if(o.value)try{v.value=!0;const x=await Hs(o.value);await l.refreshInstanceList(),i.value=x.status,u.value=x,v.value=!1}catch(x){c.value?.writeln(`\x1B[1;31m[Error] 获取实例信息失败: ${x.message}\x1B[0m`),v.value=!1}}const h=async()=>{v.value=!0;try{c.value?.writeln("\x1B[1;32m[System] 正在发送启动指令...\x1B[0m"),await Mt(o.value,"start"),L.success("实例启动指令已发送"),v.value=!1}catch(x){c.value?.writeln(`\x1B[1;31m[Error] 启动失败: ${x.message}\x1B[0m`),v.value=!1,i.value=0}},S=async()=>{v.value=!0,i.value=3;try{c.value?.writeln("\x1B[1;32m[System] 正在发送停止指令...\x1B[0m"),await Mt(o.value,"stop"),L.warning("实例停止指令已发送"),v.value=!1,l.refreshInstanceList()}catch(x){c.value?.writeln(`\x1B[1;31m[Error] 停止失败: ${x.message}\x1B[0m`),v.value=!1}},A=async()=>{v.value=!0,i.value=3;try{c.value?.writeln("\x1B[1;32m[System] 正在发送强制退出指令...\x1B[0m"),await Mt(o.value,"forceExit"),L.warning("强制退出指令已发送"),v.value=!1}catch(x){c.value?.writeln(`\x1B[1;31m[Error] 强制退出失败: ${x.message}\x1B[0m`),v.value=!1}},z=async()=>{v.value=!0,i.value=4;try{c.value?.writeln("\x1B[1;32m[System] 正在发送重启指令...\x1B[0m"),await Mt(o.value,"restart"),L.warning("重启执行成功"),v.value=!1,i.value=2}catch(x){c.value?.writeln(`\x1B[1;31m[Error] 重启失败: ${x.message}\x1B[0m`),v.value=!1}},w=async()=>{try{c.value?.writeln("\x1B[1;32m[System] 正在发送备份任务...\x1B[0m"),await Mt(o.value,"backup"),L.success("备份任务启动中···"),v.value=!1}catch(x){c.value?.writeln(`\x1B[1;31m[Error] 备份任务启动失败: ${x.message}\x1B[0m`)}},g=()=>{c.value?.clear()},U=$(!1),I=async()=>{o.value&&(d.onEula(()=>{U.value=!0}),await d.connect(o.value))},m=async x=>{try{U.value=!1,await Mt(o.value,`agreeEula?${x}`),L.success(x?"已发送同意请求":"已发送请求")}catch(y){L.error(y.message||"发送失败")}};return ke(()=>n.params.serverId,async x=>{n.name==="InstanceConsole"&&x&&(o.value=parseInt(x),await _())}),xe(async()=>{o.value&&(await _(),await I())}),(x,y)=>{const E=p("t-link"),T=p("t-dialog");return r(),C("div",Yh,[t("div",Zh,[t("div",ey,[e(c1,{ref_key:"terminalRef",ref:c,"server-id":o.value,onUpdate:y[0]||(y[0]=V=>_())},null,8,["server-id"])]),t("div",ty,[e(Qh,{"server-id":o.value,status:i.value,loading:v.value,"server-info":u.value,onStart:h,onStop:S,onBackup:w,onClearLog:g,onForceExit:A,onRestart:z},null,8,["server-id","status","loading","server-info"])])]),e(T,{visible:U.value,"onUpdate:visible":y[1]||(y[1]=V=>U.value=V),header:"是否同意EULA","confirm-btn":{content:"同意",theme:"primary"},"cancel-btn":{content:"不同意",theme:"default"},onConfirm:y[2]||(y[2]=V=>m(!0)),onCancel:y[3]||(y[3]=V=>m(!1))},{default:a(()=>[t("div",ay,[t("p",sy,[y[5]||(y[5]=f(" 开启Minecraft服务器需要您同意 ",-1)),y[6]||(y[6]=t("strong",null,"EULA",-1)),y[7]||(y[7]=f(" ！",-1)),e(E,{theme:"primary",underline:""},{default:a(()=>[...y[4]||(y[4]=[f(" (https://aka.ms/minecrafteula)",-1)])]),_:1})]),y[8]||(y[8]=t("p",{style:{"margin-bottom":"12px"}},[t("strong",{style:{color:"#e34d59"}},"请您务必认真仔细阅读！")],-1)),y[9]||(y[9]=t("p",{style:{"margin-bottom":"12px"}},[t("strong",null,"注意："),f("不论您选择是或否，服务器都会在您操作后继续运行。")],-1)),y[10]||(y[10]=t("p",{style:{"margin-bottom":"12px",color:"#f59a23"}},[f(" ⚠️ 如果您"),t("strong",null,"未同意 EULA"),f("，服务器可能会在运行时自动关闭！ ")],-1)),y[11]||(y[11]=t("p",{style:{"margin-top":"16px"}},[f("💡 提示：如要在每次启动实例时忽略此提示，请在"),t("strong",null,"设置"),f("里进行配置。")],-1))])]),_:1},8,["visible"])])}}}),ly=re(ny,[["__scopeId","data-v-e85241cf"]]),oy=Object.freeze(Object.defineProperty({__proto__:null,default:ly},Symbol.toStringTag,{value:"Module"})),ry={class:"image-wrapper"},iy=["src","alt"],uy={key:1,class:"loading-placeholder"},dy=ne({__name:"ImagePreview",props:{visible:{type:Boolean},fileName:{},imageBlobUrl:{}},emits:["update:visible"],setup(s,{emit:n}){const l=n,d=()=>{l("update:visible",!1)};return(o,i)=>{const v=p("t-dialog");return r(),K(v,{visible:s.visible,header:s.fileName,footer:!1,width:"auto",top:"10vh",class:"image-preview-dialog",onClose:d},{default:a(()=>[t("div",ry,[s.imageBlobUrl?(r(),C("img",{key:0,src:s.imageBlobUrl,alt:s.fileName},null,8,iy)):(r(),C("div",uy,"加载中..."))])]),_:1},8,["visible","header"])}}}),cy=re(dy,[["__scopeId","data-v-9d5acf17"]]),my={key:0,class:"compress-form"},py={class:"file-list-preview"},vy={class:"actions"},fy={key:1,class:"progress-view"},gy={class:"status-icon"},_y={class:"status-text"},hy=ne({__name:"FileCompressor",props:{visible:{type:Boolean},instanceId:{},currentPath:{},files:{}},emits:["update:visible","success"],setup(s,{emit:n}){const l=s,d=n,o=$(""),i=$("idle"),v=$(0),u=$("");let c=null;ke(()=>l.visible,z=>{z?(i.value="idle",v.value=0,u.value="",l.files.length>0&&(o.value=`${l.files[0]}_packed.zip`)):_()});const _=()=>{c&&(clearInterval(c),c=null)},h=async()=>{if(!o.value.trim()){L.warning("请输入压缩包名称");return}let z=o.value;z.endsWith(".zip")||(z+=".zip"),i.value="processing",v.value=0,u.value="正在提交任务...";try{const g=(await Do(l.instanceId,l.files,z,l.currentPath)).taskId;if(g)S(g);else throw new Error("未获取到任务ID")}catch(w){i.value="error",u.value=w.message||"提交失败"}},S=z=>{c=window.setInterval(async()=>{try{const w=await Oo(z);v.value=w.progress,u.value=w.message,w.status==="success"?(_(),i.value="success",v.value=100,setTimeout(()=>{d("success"),d("update:visible",!1)},1e3)):w.status==="error"&&(_(),i.value="error")}catch(w){console.error(w)}},1e3)},A=()=>{i.value==="processing"&&L.warning("后台任务仍在进行中，关闭窗口不会取消任务"),_(),d("update:visible",!1)};return Qe(()=>_()),(z,w)=>{const g=p("t-input"),U=p("t-button"),I=p("t-loading"),m=p("t-progress"),x=p("t-dialog");return r(),K(x,{visible:s.visible,header:i.value==="idle"?"创建压缩包":"正在压缩",footer:!1,"close-on-overlay-click":!1,width:"480px",onClose:A},{default:a(()=>[i.value==="idle"?(r(),C("div",my,[t("div",py,[w[1]||(w[1]=f(" 即将压缩 ",-1)),t("span",null,M(s.files.length),1),w[2]||(w[2]=f(" 个文件/文件夹 ",-1))]),e(g,{modelValue:o.value,"onUpdate:modelValue":w[0]||(w[0]=y=>o.value=y),placeholder:"请输入文件名",suffix:".zip",autofocus:"",onEnter:h},null,8,["modelValue"]),t("div",vy,[e(U,{theme:"default",variant:"text",onClick:A},{default:a(()=>[...w[3]||(w[3]=[f("取消",-1)])]),_:1}),e(U,{theme:"primary",onClick:h},{default:a(()=>[...w[4]||(w[4]=[f("开始压缩",-1)])]),_:1})])])):(r(),C("div",fy,[t("div",gy,[i.value==="processing"?(r(),K(I,{key:0})):i.value==="success"?(r(),K(b(ma),{key:1,style:{color:"var(--td-success-color)","font-size":"40px"}})):i.value==="error"?(r(),K(b(Ps),{key:2,style:{color:"var(--td-error-color)","font-size":"40px"}})):O("",!0)]),t("div",_y,M(u.value),1),e(m,{theme:"plump",percentage:v.value,status:i.value==="error"?"error":i.value==="success"?"success":"active"},null,8,["percentage","status"])]))]),_:1},8,["visible","header"])}}}),yy=re(hy,[["__scopeId","data-v-da286579"]]),by={class:"decompress-container"},wy={class:"file-info"},ky={class:"value"},$y={key:0,class:"form-item"},Ay={key:1,class:"switch-row"},xy={key:2,class:"progress-area"},Cy={class:"status-header"},Sy={class:"status-text"},Iy={class:"status-percent"},Vy={key:3,class:"actions"},My=ne({__name:"FileDecompress",props:{visible:{type:Boolean},instanceId:{},currentPath:{},fileName:{}},emits:["update:visible","success"],setup(s,{emit:n}){const l=s,d=n,o=te({get:()=>l.visible,set:m=>d("update:visible",m)}),i=$("auto"),v=$(!0),u=$(!1),c=$(0),_=$(""),h=$("");let S=null;const A=[{label:"自动检测 (推荐)",value:"auto"},{label:"UTF-8 (Linux/Mac通用)",value:"utf-8"},{label:"GBK (Windows传统)",value:"gbk"}],z=()=>{i.value="auto",v.value=!0,u.value=!1,c.value=0,_.value="",h.value="",S&&(clearInterval(S),S=null)};ke(()=>l.visible,m=>{m&&z()});const w=()=>{S&&(clearInterval(S),S=null)},g=async()=>{if(!u.value)try{u.value=!0,_.value="正在提交任务...";const m=await jo(l.instanceId,l.fileName,l.currentPath,i.value,v.value);if(m&&m.taskId)h.value=m.taskId,S=window.setInterval(U,1e3);else throw new Error("未能获取任务ID")}catch(m){L.error(m.message||"提交失败"),u.value=!1}},U=async()=>{if(h.value)try{const m=await Ko(h.value);c.value=m.progress||0,_.value=m.message,m.status==="success"?(w(),L.success("解压成功"),c.value=100,setTimeout(()=>{o.value=!1,d("success")},800)):m.status==="error"&&(w(),u.value=!1,L.error(m.message||"解压出错"))}catch(m){console.error("轮询失败",m)}},I=()=>{u.value&&c.value<100&&L.warning("解压正在后台进行中"),w(),o.value=!1};return(m,x)=>{const y=p("t-select"),E=p("t-switch"),T=p("t-progress"),V=p("t-button"),N=p("t-dialog");return r(),K(N,{visible:o.value,"onUpdate:visible":x[2]||(x[2]=q=>o.value=q),header:"解压文件",footer:!1,"close-on-overlay-click":!u.value,"on-close":I,width:"480px"},{default:a(()=>[t("div",by,[t("div",wy,[x[3]||(x[3]=t("span",{class:"label"},"目标文件：",-1)),t("span",ky,M(s.fileName),1)]),u.value?O("",!0):(r(),C("div",$y,[x[4]||(x[4]=t("span",{class:"label"},"文件名编码",-1)),e(y,{modelValue:i.value,"onUpdate:modelValue":x[0]||(x[0]=q=>i.value=q),options:A},null,8,["modelValue"])])),u.value?O("",!0):(r(),C("div",Ay,[x[5]||(x[5]=t("div",{class:"switch-info"},[t("span",{class:"switch-label"},"创建同名文件夹"),t("span",{class:"switch-tip"},"推荐开启，防止文件散乱在当前目录")],-1)),e(E,{modelValue:v.value,"onUpdate:modelValue":x[1]||(x[1]=q=>v.value=q)},null,8,["modelValue"])])),u.value?(r(),C("div",xy,[t("div",Cy,[t("span",Sy,M(_.value),1),t("span",Iy,M(c.value)+"%",1)]),e(T,{theme:"line",percentage:c.value,label:!1,status:c.value===100?"success":"active"},null,8,["percentage","status"])])):O("",!0),u.value?O("",!0):(r(),C("div",Vy,[e(V,{variant:"outline",onClick:I},{default:a(()=>[...x[6]||(x[6]=[f("取消",-1)])]),_:1}),e(V,{theme:"primary",onClick:g},{default:a(()=>[...x[7]||(x[7]=[f("开始解压",-1)])]),_:1})]))])]),_:1},8,["visible","close-on-overlay-click"])}}}),Uy=re(My,[["__scopeId","data-v-9c603684"]]),Ly={class:"permission-form"},By={class:"presets"},Ry={class:"preset-list"},zy={key:0,class:"preset-desc"},Ey={key:1,class:"preset-desc"},Py={key:2,class:"preset-desc"},Fy=ne({__name:"FilePermission",props:{visible:{type:Boolean},instanceId:{},currentPath:{},targets:{}},emits:["update:visible","success"],setup(s,{emit:n}){const l=s,d=n,o=$({mode:"755"}),i=$(!1),v=[{label:"755 (推荐: 所有者读写执/他人读执)",value:"755"},{label:"777 (全开: 所有权限)",value:"777"},{label:"644 (普通文件: 读写/读)",value:"644"}],u=te(()=>l.targets.length===1?`修改权限 - ${l.targets[0].name}`:`批量修改权限 (${l.targets.length} 项)`);ke(()=>l.visible,S=>{S&&l.targets.length>0&&(l.targets.length===1&&l.targets[0].mode&&l.targets[0].mode!=="Unknown"?o.value.mode=l.targets[0].mode:o.value.mode="755")});const c=()=>{d("update:visible",!1),i.value=!1},_=async()=>{if(!o.value.mode||!/^[0-7]{3}$/.test(o.value.mode)){L.warning("请输入正确的3位八进制权限码 (如 755)");return}i.value=!0;let S=0,A=0;try{for(const z of l.targets)try{await No(h,z.fullPath,o.value.mode),S++}catch(w){A++,console.error(w)}A===0?L.success("权限修改成功"):L.warning(`完成: 成功 ${S} 个, 失败 ${A} 个`),d("success"),c()}catch(z){L.error(z.message||"请求失败")}finally{i.value=!1}},h=l.instanceId;return(S,A)=>{const z=p("t-input"),w=p("t-form-item"),g=p("t-tag"),U=p("t-dialog");return r(),K(U,{visible:s.visible,header:u.value,"confirm-btn":{content:"保存修改",loading:i.value},"on-close":c,"on-confirm":_,width:"480px"},{default:a(()=>[t("div",Ly,[e(w,{label:"权限代码","required-mark":""},{default:a(()=>[e(z,{modelValue:o.value.mode,"onUpdate:modelValue":A[0]||(A[0]=I=>o.value.mode=I),placeholder:"例如: 755",tips:"请输入3位八进制数字 (Linux Chmod)"},null,8,["modelValue"])]),_:1}),t("div",By,[A[1]||(A[1]=t("div",{class:"preset-label"},"快捷设置：",-1)),t("div",Ry,[(r(),C(pe,null,we(v,I=>e(g,{key:I.value,variant:"light-outline",theme:"primary",class:"preset-tag",style:{cursor:"pointer"},onClick:m=>o.value.mode=I.value},{default:a(()=>[f(M(I.value),1)]),_:2},1032,["onClick"])),64))]),o.value.mode==="755"?(r(),C("div",zy,"适合可执行程序、脚本或文件夹")):O("",!0),o.value.mode==="644"?(r(),C("div",Ey,"适合普通配置文件、日志等")):O("",!0),o.value.mode==="777"?(r(),C("div",Py,"允许任何人写入 (不安全)")):O("",!0)])])]),_:1},8,["visible","header","confirm-btn"])}}}),Ty=re(Fy,[["__scopeId","data-v-6dc7353c"]]),Dy={class:"file-manager-wrapper"},Oy={class:"toolbar"},jy={class:"breadcrumb-area"},Ky={class:"actions-area"},Ny={key:0},qy={key:0},Gy={key:0},Hy={class:"table-wrapper"},Jy=["onClick"],Wy={class:"name-text"},Xy={class:"op-actions"},Qy={key:0,class:"selection-bar"},Yy={key:0,class:"selection-info"},Zy={key:1,class:"selection-info"},eb={class:"selection-actions"},tb={key:0},ab={key:0},sb={key:0},nb={key:0},lb={key:0},ob={key:0},rb={key:1,class:"selection-bar clipboard-bar"},ib={class:"selection-info"},ub={key:0},db={key:1},cb={class:"selection-actions"},mb=ne({__name:"index",setup(s){const n=et(),l=Jt(),d=te(()=>Number(n.params.serverFilesId)),o=Re(),i=$(!1),v=$([]),u=$(""),c=$([]),_=$(window.innerWidth),h=te(()=>_.value<768),S=$(!1),A=$(!1),z=$(!1),w=$(!1),g=$(!1),U=$(!1),I=$(!1),m=$(!1),x=$(!1),y=$(""),E=$(""),T=$(""),V=$(!1),N=$(""),q=$(""),P=$(""),k=$(""),B=$(null),R=$([]),Z=$(""),J=$([]),W=()=>{_.value=window.innerWidth},H=Y=>{const G=Y.split(".").pop()?.toLowerCase();return["png","jpg","jpeg","gif","ico","webp","bmp","svg"].includes(G||"")},$e=Y=>{const G=Y.split(".").pop()?.toLowerCase();return["zip","jar"].includes(G||"")},Te=Y=>{if(Y.type==="folder"){const ve=Y.name.toLowerCase();return ve==="config"||ve==="settings"?{icon:Fa,color:"var(--td-warning-color)"}:ve.startsWith("world")||ve==="level"?{icon:Hn,color:"var(--td-success-color)"}:["plugins","mods","libraries"].includes(ve)?{icon:qt,color:"var(--td-brand-color)"}:["logs","crash-reports","cache","temp"].includes(ve)?{icon:zt,color:"var(--td-gray-color-6)"}:{icon:zt,color:"var(--td-brand-color)"}}const G=Y.name.split(".").pop()?.toLowerCase();return["png","jpg","jpeg","gif","ico","webp"].includes(G||"")?{icon:Rs,color:"var(--td-success-color)"}:["jar","zip","rar","7z","tar","gz"].includes(G||"")?{icon:ka,color:"#722ed1"}:["yml","yaml","json","properties","toml","xml","conf","sh","bat","cmd"].includes(G||"")?{icon:Rt,color:"var(--td-warning-color)"}:["log","txt","md","lock"].includes(G||"")?{icon:$a,color:"var(--td-gray-color-6)"}:{icon:Nt,color:"var(--td-text-color-secondary)"}},ge=te(()=>v.value.some(Y=>Y.permission&&Y.permission!=="")),ze=te(()=>{const Y={colKey:"row-select",type:"multiple",width:h.value?34:40},G={colKey:"name",title:"文件名",ellipsis:!0,width:"auto"},ve={colKey:"operation",title:"操作",width:h.value?50:80,align:"center",fixed:h.value?"right":void 0};return h.value?[Y,G,ve]:[Y,G,{colKey:"size",title:"大小",width:100,align:"right"},...ge.value?[{colKey:"permission",title:"权限",width:80,align:"center"}]:[],{colKey:"lastModified",title:"修改时间",width:180,align:"center"},ve]}),Le=te(()=>{const Y=u.value.split("/").filter(Fe=>Fe),G=[{name:"根目录",path:""}];let ve="";return Y.forEach(Fe=>{ve=ve?`${ve}/${Fe}`:Fe,G.push({name:Fe,path:ve})}),G}),Ee=te(()=>c.value.length>0),Be=Y=>{if(Y===0)return"-";const G=["B","KB","MB","GB","TB"];let ve=0;for(;Y>=1024&&ve<G.length-1;)Y/=1024,ve++;return`${Y.toFixed(1)} ${G[ve]}`},Je=Y=>Y?new Date(Y).toLocaleString():"-",ie=async()=>{i.value=!0,c.value=[];try{const Y=await Ro(d.value,u.value);v.value=Y||[]}catch(Y){console.error(Y)}finally{i.value=!1}},Ve=async Y=>{q.value&&(window.URL.revokeObjectURL(q.value),q.value="");const G=u.value?`${u.value}/${Y}`:Y,ve=L.loading("正在加载图片...");try{const Fe=await To(d.value,G);if(!(Fe instanceof Blob))throw new Error("无效数据");q.value=window.URL.createObjectURL(Fe),N.value=Y,A.value=!0,L.close(ve)}catch{L.close(ve),L.error("加载失败")}},De=async(Y,G=!1)=>{if(G){E.value=Y,T.value="",S.value=!0;return}if(H(Y)){Ve(Y);return}const ve=u.value?`${u.value}/${Y}`:Y,Fe=L.loading("正在读取文件...");try{const tt=await fa(d.value,ve);E.value=Y,T.value=tt,S.value=!0,L.close(Fe)}catch(tt){L.close(Fe),L.error("读取失败: "+tt.message)}},se=()=>{P.value="",z.value=!0},F=()=>{if(!P.value.trim()){L.warning("请输入文件名");return}z.value=!1,De(P.value,!0)},j=async Y=>{V.value=!0;try{const G=u.value?`${u.value}/${E.value}`:E.value;await Na(d.value,G,Y),L.success("保存成功"),S.value=!1,fe()}catch{L.error("保存失败")}finally{V.value=!1}},ae=()=>{y.value="",x.value=!0},me=async()=>{if(!y.value.trim()){L.warning("请输入文件夹名称");return}try{await zo(d.value,u.value,y.value),L.success("文件夹创建成功"),x.value=!1,fe()}catch(Y){L.error(`创建失败: ${Y.message||"未知错误"}`)}},ee=Y=>{B.value={name:Y.name,fullPath:u.value?`${u.value}/${Y.name}`:Y.name},k.value=Y.name,w.value=!0},D=async()=>{if(!k.value||!B.value)return;const Y=u.value?`${u.value}/${k.value}`:k.value;try{await Eo(d.value,B.value.fullPath,Y),L.success("重命名成功"),w.value=!1,fe()}catch{L.error("重命名失败")}},oe=Y=>{let G=[];if(Y?G=[Y.name]:G=[...c.value],G.length===0)return;const ve=Ze.confirm({header:"确认删除",body:`确定要永久删除这 ${G.length} 项吗？`,theme:"danger",onConfirm:async()=>{try{const Fe=G.map(tt=>u.value?`${u.value}/${tt}`:tt);await Po(d.value,Fe),L.success("删除成功"),c.value=[],fe(),ve.hide()}catch{L.error("删除失败")}}})},de=Y=>{if(Y.type==="folder"){const G=u.value===""?"":"/";u.value=`${u.value}${G}${Y.name}`}else H(Y.name)?Ve(Y.name):De(Y.name)},_e=Y=>{u.value=Y},fe=()=>ie(),be=async Y=>{let G=[];if(Y?G=[Y.name]:G=[...c.value],G.length===0)return;const{baseUrl:ve,token:Fe}=o,tt=ve.endsWith("/")?ve.slice(0,-1):ve;for(const ft of G){if(v.value.find(it=>it.name===ft)?.type==="folder"){L.warning(`暂不支持下载文件夹: ${ft} 请压缩后再下载！`);continue}const Ge=u.value?`${u.value}/${ft}`:ft;try{const it=new URL(`${tt||window.location.origin}/api/files/instance/${d.value}/download`);it.searchParams.append("path",Ge),it.searchParams.append("x-user-token",Fe);const gt=document.createElement("a");gt.href=it.toString(),gt.style.display="none",gt.download=ft,document.body.appendChild(gt),gt.click(),document.body.removeChild(gt)}catch(it){console.error(it),L.error(`创建下载链接失败: ${ft}`)}}Y||(c.value=[])},Ue=()=>{c.value.length!==0&&(R.value=[...c.value],U.value=!0)},Ce=()=>{c.value=[],fe()},Ae=Y=>{Z.value=Y.name,I.value=!0},Ke=()=>{fe()},We=Y=>{if(J.value=[],Y)J.value.push({name:Y.name,fullPath:u.value?`${u.value}/${Y.name}`:Y.name,mode:Y.permission||"755"});else{if(c.value.length===0)return;c.value.forEach(G=>{const ve=v.value.find(Fe=>Fe.name===G);ve&&J.value.push({name:ve.name,fullPath:u.value?`${u.value}/${ve.name}`:ve.name,mode:ve.permission||"755"})})}m.value=!0},Ne=()=>{c.value=[],fe()},Q=()=>fe(),Se=$([]),Oe=$("copy"),je=$(""),Pe=te(()=>Se.value.length>0),qe=te(()=>u.value===je.value),ce=()=>{if(c.value.length===0)return;const Y=c.value.map(G=>u.value?`${u.value}/${G}`:G);Se.value=Y,Oe.value="copy",je.value=u.value,c.value=[],L.info(`已复制 ${Y.length} 项，请前往目标目录粘贴`)},rt=()=>{if(c.value.length===0)return;const Y=c.value.map(G=>u.value?`${u.value}/${G}`:G);Se.value=Y,Oe.value="move",je.value=u.value,c.value=[],L.info(`已剪切 ${Y.length} 项，请前往目标目录粘贴`)},Vt=()=>{Se.value=[],je.value="",L.info("已取消操作")},vt=async()=>{if(Se.value.length===0)return;const Y=L.loading("正在粘贴中...");try{Oe.value==="copy"?await Go(d.value,Se.value,u.value):await Ho(d.value,Se.value,u.value),L.success("粘贴成功"),Se.value=[],fe()}catch(G){L.error(`粘贴失败: ${G.message||"未知错误"}`)}finally{L.close(Y)}},st=$(""),kt=$("name"),he=[{label:"名称 (A-Z)",value:"name"},{label:"时间 (最新)",value:"time"},{label:"大小 (从大到小)",value:"size"}],ha=te(()=>{let Y=[...v.value];if(st.value){const G=st.value.toLowerCase();Y=Y.filter(ve=>ve.name.toLowerCase().includes(G))}return Y.sort((G,ve)=>{if(G.type==="folder"&&ve.type!=="folder")return-1;if(G.type!=="folder"&&ve.type==="folder")return 1;switch(kt.value){case"name":return G.name.localeCompare(ve.name,"zh-CN",{numeric:!0});case"time":return new Date(ve.lastModified).getTime()-new Date(G.lastModified).getTime();case"size":return ve.size-G.size;default:return 0}}),Y});return ke(u,Y=>{l.replace({query:{...n.query,path:Y||void 0}}),ie()}),ke(d,()=>{n.name==="InstanceFiles"&&(u.value="",c.value=[],ie())}),xe(()=>{const Y=n.query.path;window.addEventListener("resize",W),Y?u.value=Y:ie()}),Qe(()=>{window.removeEventListener("resize",W)}),(Y,G)=>{const ve=p("t-breadcrumb-item"),Fe=p("t-breadcrumb"),tt=p("t-input"),ft=p("t-select"),Ge=p("t-button"),it=p("t-dropdown"),gt=p("t-tag"),Ys=p("t-table"),Zs=p("t-card"),ya=p("t-dialog");return r(),C("div",Dy,[e(Zs,{bordered:!1,class:"file-manager-card"},{default:a(()=>[t("div",Oy,[t("div",jy,[e(Fe,{"max-item-width":h.value?"80px":"150px"},{default:a(()=>[(r(!0),C(pe,null,we(Le.value,(le,Tt)=>(r(),K(ve,{key:Tt,class:"crumb-item",onClick:ow=>_e(le.path)},$s({default:a(()=>[f(" "+M(le.name),1)]),_:2},[Tt===0?{name:"icon",fn:a(()=>[e(b(Kn))]),key:"0"}:void 0]),1032,["onClick"]))),128))]),_:1},8,["max-item-width"])]),t("div",Ky,[e(tt,{modelValue:st.value,"onUpdate:modelValue":G[0]||(G[0]=le=>st.value=le),placeholder:"搜索文件...",style:dt({width:h.value?"120px":"200px"})},{"prefix-icon":a(()=>[e(b(la))]),_:1},8,["modelValue","style"]),e(ft,{modelValue:kt.value,"onUpdate:modelValue":G[1]||(G[1]=le=>kt.value=le),options:he,style:dt({width:h.value?"110px":"140px"}),placeholder:"排序"},{prefixIcon:a(()=>[e(b(Nn))]),_:1},8,["modelValue","style"]),e(Ge,{variant:"outline",size:"medium",onClick:G[2]||(G[2]=le=>b(Ie)(`/instance/console/${d.value}`))},{icon:a(()=>[e(b(Us))]),default:a(()=>[h.value?O("",!0):(r(),C("span",Ny,"控制台"))]),_:1}),e(it,{options:[{content:"新建文件",value:"file",onClick:se},{content:"新建文件夹",value:"folder",onClick:ae}]},{default:a(()=>[e(Ge,{variant:"outline",size:"medium"},{icon:a(()=>[e(b(qn))]),default:a(()=>[h.value?O("",!0):(r(),C("span",qy,"新建"))]),_:1})]),_:1},8,["options"]),e(Ge,{theme:"primary",size:"medium",onClick:G[3]||(G[3]=le=>g.value=!0)},{icon:a(()=>[e(b(Bs))]),default:a(()=>[h.value?O("",!0):(r(),C("span",Gy,"上传"))]),_:1}),e(Ge,{variant:"outline",size:"medium",onClick:fe},{icon:a(()=>[e(b(at))]),_:1})])]),t("div",Hy,[e(Ys,{"selected-row-keys":c.value,"onUpdate:selectedRowKeys":G[4]||(G[4]=le=>c.value=le),data:ha.value,columns:ze.value,"row-key":"name",loading:i.value,hover:!0,size:"medium",class:"file-table"},{name:a(({row:le})=>[t("div",{class:"file-name-cell",onClick:jt(Tt=>de(le),["stop"])},[(r(),K(lt(Te(le).icon),{class:"file-icon",style:dt({color:Te(le).color})},null,8,["style"])),t("span",Wy,M(le.name),1)],8,Jy)]),size:a(({row:le})=>[f(M(Be(le.size)),1)]),permission:a(({row:le})=>[le.permission?(r(),K(gt,{key:0,variant:"light",size:"small"},{default:a(()=>[f(M(le.permission),1)]),_:2},1024)):O("",!0)]),lastModified:a(({row:le})=>[f(M(Je(le.lastModified)),1)]),operation:a(({row:le})=>[t("div",Xy,[e(it,{placement:h.value?"bottom-right":"bottom",options:[{content:"解压",value:"decompress",onClick:()=>Ae(le),show:$e(le.name)&&le.type!=="folder"},{content:H(le.name)?"预览":"编辑",value:"edit",onClick:()=>H(le.name)?Ve(le.name):De(le.name),disabled:le.type==="folder"||$e(le.name)},{content:"权限",value:"permission",onClick:()=>We(le),show:ge.value},{content:"下载",value:"download",onClick:()=>be(le)},{content:"重命名",value:"rename",onClick:()=>ee(le)},{content:"删除",value:"delete",theme:"error",onClick:()=>oe(le)}].filter(Tt=>Tt.show!==!1)},{default:a(()=>[e(Ge,{variant:"text",shape:"square",size:"medium"},{default:a(()=>[e(b(Es))]),_:1})]),_:1},8,["placement","options"])])]),empty:a(()=>[...G[24]||(G[24]=[t("div",{class:"empty-state"},"暂无文件",-1)])]),_:1},8,["selected-row-keys","data","columns","loading"])])]),_:1}),e(Wt,{name:"slide-up"},{default:a(()=>[Ee.value?(r(),C("div",Qy,[h.value?(r(),C("div",Zy,[t("span",null,M(c.value.length),1)])):(r(),C("div",Yy,[G[25]||(G[25]=f(" 已选 ",-1)),t("span",null,M(c.value.length),1),G[26]||(G[26]=f(" 项 ",-1))])),t("div",eb,[e(Ge,{size:"small",variant:"text",theme:"primary",onClick:G[5]||(G[5]=le=>ce())},{icon:a(()=>[e(b(Fs))]),default:a(()=>[h.value?O("",!0):(r(),C("span",tb,"复制"))]),_:1}),e(Ge,{size:"small",variant:"text",theme:"primary",onClick:G[6]||(G[6]=le=>rt())},{icon:a(()=>[e(b(Gn))]),default:a(()=>[h.value?O("",!0):(r(),C("span",ab,"剪切"))]),_:1}),e(Ge,{size:"small",variant:"text",theme:"primary",onClick:G[7]||(G[7]=le=>Ue())},{icon:a(()=>[e(b(ka))]),default:a(()=>[h.value?O("",!0):(r(),C("span",sb,"压缩"))]),_:1}),e(Ge,{size:"small",variant:"text",theme:"primary",onClick:G[8]||(G[8]=le=>be())},{icon:a(()=>[e(b(ca))]),default:a(()=>[h.value?O("",!0):(r(),C("span",nb,"下载"))]),_:1}),ge.value?(r(),K(Ge,{key:0,size:"small",variant:"text",theme:"primary",onClick:G[9]||(G[9]=le=>We())},{icon:a(()=>[e(b(va))]),default:a(()=>[h.value?O("",!0):(r(),C("span",lb,"权限"))]),_:1})):O("",!0),e(Ge,{size:"small",variant:"text",theme:"danger",onClick:G[10]||(G[10]=le=>oe())},{icon:a(()=>[e(b(wt))]),default:a(()=>[h.value?O("",!0):(r(),C("span",ob,"删除"))]),_:1}),e(Ge,{size:"small",variant:"text",onClick:G[11]||(G[11]=le=>c.value=[])},{default:a(()=>[...G[27]||(G[27]=[f("取消",-1)])]),_:1})])])):Pe.value?(r(),C("div",rb,[t("div",ib,[Oe.value==="copy"?(r(),C("span",ub,"准备复制")):(r(),C("span",db,"准备移动")),t("span",null,M(Se.value.length),1),G[28]||(G[28]=f(" 项 ",-1))]),t("div",cb,[e(Ge,{theme:"primary",disabled:qe.value,onClick:vt},{icon:a(()=>[e(b($a))]),default:a(()=>[G[29]||(G[29]=f(" 粘贴在此处 ",-1))]),_:1},8,["disabled"]),e(Ge,{variant:"text",theme:"default",onClick:Vt},{icon:a(()=>[e(b(za))]),default:a(()=>[G[30]||(G[30]=f(" 取消 ",-1))]),_:1})])])):O("",!0)]),_:1}),e(Ws,{visible:S.value,"onUpdate:visible":G[12]||(G[12]=le=>S.value=le),"file-name":E.value,content:T.value,loading:V.value,onSave:j},null,8,["visible","file-name","content","loading"]),e(ya,{visible:z.value,"onUpdate:visible":G[14]||(G[14]=le=>z.value=le),header:"新建文件","on-confirm":F},{default:a(()=>[e(tt,{modelValue:P.value,"onUpdate:modelValue":G[13]||(G[13]=le=>P.value=le),placeholder:"输入文件名",autofocus:!0,onEnter:F},null,8,["modelValue"])]),_:1},8,["visible"]),e(ya,{visible:w.value,"onUpdate:visible":G[16]||(G[16]=le=>w.value=le),header:"重命名","on-confirm":D},{default:a(()=>[e(tt,{modelValue:k.value,"onUpdate:modelValue":G[15]||(G[15]=le=>k.value=le),placeholder:"输入新名称",autofocus:!0,onEnter:D},null,8,["modelValue"])]),_:1},8,["visible"]),e(Xs,{visible:g.value,"onUpdate:visible":G[17]||(G[17]=le=>g.value=le),"instance-id":d.value,"current-path":u.value,onSuccess:Q},null,8,["visible","instance-id","current-path"]),e(cy,{visible:A.value,"onUpdate:visible":G[18]||(G[18]=le=>A.value=le),"file-name":N.value,"image-blob-url":q.value},null,8,["visible","file-name","image-blob-url"]),e(yy,{visible:U.value,"onUpdate:visible":G[19]||(G[19]=le=>U.value=le),"instance-id":d.value,"current-path":u.value,files:R.value,onSuccess:Ce},null,8,["visible","instance-id","current-path","files"]),e(Uy,{visible:I.value,"onUpdate:visible":G[20]||(G[20]=le=>I.value=le),"instance-id":d.value,"current-path":u.value,"file-name":Z.value,onSuccess:Ke},null,8,["visible","instance-id","current-path","file-name"]),e(Ty,{visible:m.value,"onUpdate:visible":G[21]||(G[21]=le=>m.value=le),"instance-id":d.value,"current-path":u.value,targets:J.value,onSuccess:Ne},null,8,["visible","instance-id","current-path","targets"]),e(ya,{visible:x.value,"onUpdate:visible":G[23]||(G[23]=le=>x.value=le),header:"新建文件夹","on-confirm":me},{default:a(()=>[e(tt,{modelValue:y.value,"onUpdate:modelValue":G[22]||(G[22]=le=>y.value=le),placeholder:"输入文件夹名称",autofocus:!0,onEnter:me},null,8,["modelValue"])]),_:1},8,["visible"])])}}}),pb=re(mb,[["__scopeId","data-v-bc133c32"]]),vb=Object.freeze(Object.defineProperty({__proto__:null,default:pb},Symbol.toStringTag,{value:"Module"})),fb=ne({name:"FrameBlank"});function gb(s,n,l,d,o,i){return r(),C("div")}const _b=re(fb,[["render",gb]]),hb=Object.freeze(Object.defineProperty({__proto__:null,default:_b},Symbol.toStringTag,{value:"Module"}));function bs(){return X.get({url:"/api/user/me"})}function ws(s){return X.post({url:"/api/user/me/update",data:s})}function yb(){return X.get({url:"/api/admin/user/list"})}function bb(s){return X.post({url:"/api/admin/user/create",data:s})}function wb(s,n){return X.post({url:`/api/admin/user/update/${s}`,data:n})}function kb(s){return X.post({url:`/api/admin/user/delete/${s}`})}const $b={class:"user-manage"},Ab={class:"toolbar"},xb={class:"left-action"},Cb={class:"right-search"},Sb={class:"user-info-cell"},Ib={class:"text-info"},Vb={class:"nickname"},Mb={class:"username"},Ub={key:0,class:"time-text"},Lb={key:1,class:"time-placeholder"},Bb={class:"op-buttons"},Rb=ne({__name:"index",setup(s){const n=$(!1),l=$([]),d=$(""),o=Re(),i=$(!1),v=$("create"),u=$(!1),c=Xe({id:"",username:"",name:"",password:"",role:"admin",resetApiKey:!1}),_={username:[{required:!0,message:"请输入用户名",type:"error"}],role:[{required:!0,message:"请选择角色",type:"error"}],password:[{validator:I=>v.value==="create"&&!I?{result:!1,message:"创建用户时密码必填",type:"error"}:!0}]},h=te(()=>[{colKey:"info",title:"用户信息",width:200,fixed:"left",cell:"info-slot"},{colKey:"role",title:"角色",width:100,cell:"role-slot"},{colKey:"lastLogin",title:"最后登录",width:180,cell:"time-slot",className:"hidden-xs"},{colKey:"op",title:"操作",width:140,fixed:"right",cell:"op-slot"}]),S=te(()=>{if(!d.value)return l.value;const I=d.value.toLowerCase();return l.value.filter(m=>m.username.toLowerCase().includes(I)||m.name&&m.name.toLowerCase().includes(I))}),A=async()=>{n.value=!0;try{const I=await yb();l.value=I}catch(I){L.error(I.message||"获取用户列表失败")}finally{n.value=!1}},z=()=>{v.value="create",c.id="",c.username="",c.name="",c.password="",c.role="admin",c.resetApiKey=!1,i.value=!0},w=I=>{v.value="edit",c.id=I.id,c.username=I.username,c.name=I.name,c.password="",c.role=I.role,c.resetApiKey=!1,i.value=!0},g=async({validateResult:I})=>{if(I===!0){u.value=!0;try{v.value==="create"?(await bb({username:c.username,password:c.password,name:c.name,role:c.role}),L.success("用户创建成功")):(await wb(c.id,{name:c.name,password:c.password||void 0,role:c.role,resetApiKey:c.resetApiKey}),L.success("用户更新成功")),i.value=!1,A()}catch(m){L.error(m.message||"操作失败")}finally{u.value=!1}}},U=I=>{const m=Ze.confirm({header:"删除警告",body:`确定要删除用户 "${I.username}" 吗？此操作不可恢复。`,theme:"danger",onConfirm:async()=>{try{m.hide(),await kb(I.id),L.success("删除成功"),A()}catch(x){L.error(x.message||"删除失败")}}})};return xe(()=>{A()}),(I,m)=>{const x=p("t-button"),y=p("t-input"),E=p("t-avatar"),T=p("t-tag"),V=p("t-divider"),N=p("t-table"),q=p("t-card"),P=p("t-form-item"),k=p("t-radio-button"),B=p("t-radio-group"),R=p("t-checkbox"),Z=p("t-form"),J=p("t-dialog");return r(),C("div",$b,[e(q,{bordered:!1,class:"main-card"},{default:a(()=>[t("div",Ab,[t("div",xb,[e(x,{theme:"primary",onClick:z},{icon:a(()=>[e(b(pa))]),default:a(()=>[m[7]||(m[7]=f(" 新增用户 ",-1))]),_:1})]),t("div",Cb,[e(y,{modelValue:d.value,"onUpdate:modelValue":m[0]||(m[0]=W=>d.value=W),placeholder:"搜索用户名或昵称",clearable:""},{"prefix-icon":a(()=>[e(b(la))]),_:1},8,["modelValue"]),e(x,{variant:"text",shape:"square",onClick:A},{icon:a(()=>[e(b(at))]),_:1})])]),e(N,{"row-key":"id",data:S.value,columns:h.value,loading:n.value,hover:!0,pagination:{defaultPageSize:20,total:S.value.length,showJumper:!0},class:"user-table","table-layout":"auto"},{"info-slot":a(({row:W})=>[t("div",Sb,[e(E,{image:W.avatar,size:"40px",shape:"circle","hide-on-load-failed":!1},{default:a(()=>[f(M(W.name?W.name[0].toUpperCase():"U"),1)]),_:2},1032,["image"]),t("div",Ib,[t("div",Vb,M(W.name||"未设置昵称"),1),t("div",Mb,"@"+M(W.username),1)])])]),"role-slot":a(({row:W})=>[W.role==="admin"?(r(),K(T,{key:0,theme:"success",variant:"light",size:"small",shape:"round"},{default:a(()=>[...m[8]||(m[8]=[f("管理员",-1)])]),_:1})):(r(),K(T,{key:1,theme:"primary",variant:"light",size:"small",shape:"round"},{default:a(()=>[...m[9]||(m[9]=[f("普通用户",-1)])]),_:1}))]),"time-slot":a(({row:W})=>[W.lastLoginTime?(r(),C("span",Ub,M(new Date(W.lastLoginTime).toLocaleString()),1)):(r(),C("span",Lb,"从未登录"))]),"op-slot":a(({row:W})=>[t("div",Bb,[e(x,{variant:"text",theme:"primary",size:"small",onClick:H=>w(W)},{default:a(()=>[...m[10]||(m[10]=[f(" 编辑 ",-1)])]),_:1},8,["onClick"]),e(V,{layout:"vertical"}),e(x,{variant:"text",theme:"danger",size:"small",disabled:W.id===b(o).userInfo.id||W.username==="admin",onClick:H=>U(W)},{default:a(()=>[...m[11]||(m[11]=[f(" 删除 ",-1)])]),_:1},8,["disabled","onClick"])])]),_:1},8,["data","columns","loading","pagination"])]),_:1}),e(J,{visible:i.value,"onUpdate:visible":m[6]||(m[6]=W=>i.value=W),header:v.value==="create"?"新增用户":"编辑用户","confirm-btn":{content:"提交",loading:u.value},"on-confirm":()=>I.$refs.formRef.submit(),width:"480px"},{default:a(()=>[e(Z,{ref:"formRef",data:c,rules:_,"label-align":"top",onSubmit:g},{default:a(()=>[e(P,{label:"用户名",name:"username"},{default:a(()=>[e(y,{modelValue:c.username,"onUpdate:modelValue":m[1]||(m[1]=W=>c.username=W),placeholder:"登录账号",disabled:v.value==="edit"},null,8,["modelValue","disabled"])]),_:1}),e(P,{label:"昵称",name:"name"},{default:a(()=>[e(y,{modelValue:c.name,"onUpdate:modelValue":m[2]||(m[2]=W=>c.name=W),placeholder:"显示名称"},null,8,["modelValue"])]),_:1}),e(P,{label:"角色",name:"role"},{default:a(()=>[e(B,{modelValue:c.role,"onUpdate:modelValue":m[3]||(m[3]=W=>c.role=W),variant:"default-filled"},{default:a(()=>[e(k,{value:"user",disabled:""},{default:a(()=>[...m[12]||(m[12]=[f("普通用户",-1)])]),_:1}),e(k,{value:"admin"},{default:a(()=>[...m[13]||(m[13]=[f("管理员",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(P,{label:"密码",name:"password",help:v.value==="edit"?"留空则不修改密码":""},{default:a(()=>[e(y,{modelValue:c.password,"onUpdate:modelValue":m[4]||(m[4]=W=>c.password=W),type:"password",placeholder:"设置密码",autocomplete:"new-password"},null,8,["modelValue"])]),_:1},8,["help"]),v.value==="edit"?(r(),K(P,{key:0,label:"API 密钥"},{default:a(()=>[e(R,{modelValue:c.resetApiKey,"onUpdate:modelValue":m[5]||(m[5]=W=>c.resetApiKey=W)},{default:a(()=>[...m[14]||(m[14]=[f("重置该用户的 API Key",-1)])]),_:1},8,["modelValue"])]),_:1})):O("",!0)]),_:1},8,["data"])]),_:1},8,["visible","header","confirm-btn","on-confirm"])])}}}),zb=re(Rb,[["__scopeId","data-v-d4b06059"]]),Eb=Object.freeze(Object.defineProperty({__proto__:null,default:zb},Symbol.toStringTag,{value:"Module"})),Pb={class:"profile-header"},Fb={class:"avatar-col"},Tb={class:"info-col"},Db={class:"main-row"},Ob={class:"nickname"},jb={class:"sub-row"},Kb={class:"username"},Nb={key:0,class:"last-login"},qb={key:0,class:"bound-status"},Gb={key:1},Hb=ne({__name:"UserProfileCard",setup(s,{expose:n}){const l=Re(),d=$(!1),o=$(!1),i=$(!1),v=$(""),u=$(""),c=$("qq"),_=Xe({id:"",username:"",name:"",avatar:"",role:"",apiKey:"",lastLoginTime:"",openMSLID:""}),h=Xe({changePassword:!1,newPassword:"",confirmPassword:""}),S=async()=>{d.value=!0;try{const x=await bs();Object.assign(_,x),v.value=x.username;const y=x.avatar&&x.avatar.match(/nk=(\d+)/);y&&y[1]?(c.value="qq",u.value=y[1]):c.value="custom"}catch(x){L.error(x.message||"用户加载失败")}finally{d.value=!1}};ke(u,x=>{c.value==="qq"&&x&&(_.avatar=`https://q.qlogo.cn/g?b=qq&nk=${x}&s=640`)});const A=x=>{x==="qq"&&u.value&&(_.avatar=`https://q.qlogo.cn/g?b=qq&nk=${u.value}&s=640`)},z=()=>{_.apiKey&&navigator.clipboard.writeText(_.apiKey).then(()=>{L.success("API Key 已复制")})},w=()=>{const x=Ze.confirm({header:"重置 API 密钥",theme:"warning",body:"重置后，所有使用旧 Key 的外部工具将立即失效，确定要继续吗？",onConfirm:async()=>{try{x.hide(),await ws({resetApiKey:!0}),L.success("API Key 重置成功");const y=await bs();_.apiKey=y.apiKey}catch(y){L.error(y.message||"重置失败")}}})},g=async()=>{if(h.changePassword){if(!h.newPassword){L.warning("请输入新密码");return}if(h.newPassword!==h.confirmPassword){L.error("两次输入的密码不一致");return}}const x=_.username!==v.value,y=h.changePassword&&!!h.newPassword;o.value=!0;try{const E={username:_.username,name:_.name,avatar:_.avatar,password:y?h.newPassword:void 0,resetApiKey:!1};await ws(E),h.changePassword=!1,h.newPassword="",h.confirmPassword="",v.value=_.username,L.success("个人信息保存成功"),x||y?Ze.alert({header:"重新登录",body:"账号或密码已变更，请重新登录以生效。",confirmBtn:"去登录",onConfirm:async()=>{await l.logout(),window.location.reload()}}):await l.getUserInfo()}catch(E){L.error(E.message)}finally{o.value=!1}};n({initData:S});const U=$(!1),I=async()=>{U.value=!0;try{const x=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);localStorage.setItem("oauth_state",x);const y=`${window.location.origin}/oauth/callback?mode=bind`,E=await X.get({url:"/api/auth/oauth/url",params:{state:x,callback:y}});E&&E.url?window.location.href=E.url:(L.error(E.message||"获取绑定地址失败"),U.value=!1)}catch(x){L.error(x.message||"请求失败"),U.value=!1}},m=()=>{const x=Ze.confirm({header:"解除绑定",theme:"warning",body:"确定要解除与 MSL 账户的绑定吗？解绑后您将无法使用 MSL 账户快捷登录。",onConfirm:async()=>{try{x.hide(),await X.post({url:"/api/auth/oauth/unbind"}),L.success("解绑成功"),await S()}catch(y){L.error(y.message||"解绑失败")}}})};return(x,y)=>{const E=p("t-avatar"),T=p("t-tag"),V=p("t-divider"),N=p("t-radio-button"),q=p("t-radio-group"),P=p("t-input"),k=p("t-space"),B=p("t-form-item"),R=p("t-button"),Z=p("t-switch"),J=p("t-form"),W=p("t-card");return r(),K(W,{bordered:!1,loading:d.value,class:"settings-card"},{default:a(()=>[t("div",Pb,[t("div",Fb,[e(E,{image:_.avatar,size:"80px",shape:"circle",class:"user-avatar-shadow"},{default:a(()=>[f(M(_.name?_.name.slice(0,1).toUpperCase():"U"),1)]),_:1},8,["image"])]),t("div",Tb,[t("div",Db,[t("span",Ob,M(_.name||"未设置昵称"),1),_.role==="admin"?(r(),K(T,{key:0,theme:"success",variant:"light",size:"small",shape:"round"},{default:a(()=>[...y[8]||(y[8]=[f("管理员",-1)])]),_:1})):(r(),K(T,{key:1,theme:"primary",variant:"light",size:"small",shape:"round"},{default:a(()=>[...y[9]||(y[9]=[f("普通用户",-1)])]),_:1}))]),t("div",jb,[t("span",Kb,"@"+M(_.username),1),_.lastLoginTime?(r(),C("span",Nb,[e(b(pt)),f(" "+M(new Date(_.lastLoginTime).toLocaleString()),1)])):O("",!0)])])]),e(V),e(J,{ref:"userForm",data:_,"label-width":100,"label-align":"left",onSubmit:g},{default:a(()=>[e(B,{label:"头像设置"},{default:a(()=>[e(k,{direction:"vertical",style:{width:"100%"}},{default:a(()=>[e(q,{modelValue:c.value,"onUpdate:modelValue":y[0]||(y[0]=H=>c.value=H),variant:"default-filled",onChange:A},{default:a(()=>[e(N,{value:"qq"},{default:a(()=>[e(b(Jn)),y[10]||(y[10]=f(" QQ头像",-1))]),_:1}),e(N,{value:"custom"},{default:a(()=>[e(b(Ct)),y[11]||(y[11]=f(" 链接",-1))]),_:1})]),_:1},8,["modelValue"]),c.value==="qq"?(r(),K(P,{key:0,modelValue:u.value,"onUpdate:modelValue":y[1]||(y[1]=H=>u.value=H),placeholder:"输入QQ号自动获取",type:"number"},{"prefix-icon":a(()=>[e(b(Wn))]),_:1},8,["modelValue"])):(r(),K(P,{key:1,modelValue:_.avatar,"onUpdate:modelValue":y[2]||(y[2]=H=>_.avatar=H),placeholder:"输入图片 URL 链接"},{"prefix-icon":a(()=>[e(b(Xn))]),_:1},8,["modelValue"]))]),_:1})]),_:1}),e(B,{label:"用户昵称",name:"name"},{default:a(()=>[e(P,{modelValue:_.name,"onUpdate:modelValue":y[3]||(y[3]=H=>_.name=H),placeholder:"显示的名称"},null,8,["modelValue"])]),_:1}),e(B,{label:"登录账号",name:"username"},{default:a(()=>[e(P,{modelValue:_.username,"onUpdate:modelValue":y[4]||(y[4]=H=>_.username=H),placeholder:"登录唯一标识"},null,8,["modelValue"])]),_:1}),e(B,{label:"API Key",help:"用于MSLX桌面版/第三方工具连接的凭证，请妥善保管"},{default:a(()=>[e(P,{value:_.apiKey,type:i.value?"text":"password",readonly:"",placeholder:"点击重置生成 Key"},{suffix:a(()=>[e(R,{variant:"text",size:"small",onClick:z},{icon:a(()=>[e(b(Fs))]),_:1}),e(R,{variant:"text",theme:"danger",size:"small",onClick:w},{icon:a(()=>[e(b(at))]),_:1})]),_:1},8,["value","type"])]),_:1}),b(ua)()?O("",!0):(r(),K(V,{key:0,dashed:""})),b(ua)()?O("",!0):(r(),K(B,{key:1,label:"MSL 账户绑定",help:"绑定后可使用 MSL 账户直接登录本控制台"},{default:a(()=>[_.openMSLID&&_.openMSLID!=="0"?(r(),C("div",qb,[e(T,{theme:"success",variant:"light",size:"medium"},{icon:a(()=>[e(b(xt))]),default:a(()=>[f(" 已绑定 (MSL UID: "+M(_.openMSLID)+") ",1)]),_:1}),e(R,{theme:"danger",variant:"text",size:"small",style:{"margin-left":"12px"},onClick:m},{default:a(()=>[...y[12]||(y[12]=[f(" 解除绑定 ",-1)])]),_:1})])):(r(),C("div",Gb,[e(R,{theme:"primary",variant:"outline",loading:U.value,onClick:I},{icon:a(()=>[e(b(Ct))]),default:a(()=>[y[13]||(y[13]=f(" 绑定 MSL 账户 ",-1))]),_:1},8,["loading"])]))]),_:1})),e(V,{dashed:""}),e(B,{label:"修改密码"},{default:a(()=>[e(Z,{modelValue:h.changePassword,"onUpdate:modelValue":y[5]||(y[5]=H=>h.changePassword=H)},null,8,["modelValue"])]),_:1}),h.changePassword?(r(),C(pe,{key:2},[e(B,{label:"新密码","required-mark":""},{default:a(()=>[e(P,{modelValue:h.newPassword,"onUpdate:modelValue":y[6]||(y[6]=H=>h.newPassword=H),type:"password",placeholder:"请输入新密码"},{"prefix-icon":a(()=>[e(b(va))]),_:1},8,["modelValue"])]),_:1}),e(B,{label:"确认密码","required-mark":""},{default:a(()=>[e(P,{modelValue:h.confirmPassword,"onUpdate:modelValue":y[7]||(y[7]=H=>h.confirmPassword=H),type:"password",placeholder:"请再次输入新密码"},{"prefix-icon":a(()=>[e(b(xt))]),_:1},8,["modelValue"])]),_:1})],64)):O("",!0),e(B,null,{default:a(()=>[e(R,{theme:"primary",type:"submit",loading:o.value,block:"",class:"action-btn"},{default:a(()=>[...y[14]||(y[14]=[f(" 保存个人资料 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["data"])]),_:1},8,["loading"])}}}),Jb=re(Hb,[["__scopeId","data-v-66f1e979"]]),Wb={key:1},Xb={class:"status-label"},Qb=ne({__name:"SystemSettingsCard",emits:["refresh"],setup(s,{expose:n,emit:l}){const d=qa(),o=$(!1),i=$(!1),v=Xe({fireWallBanLocalAddr:!1,openWebConsoleOnLaunch:!0,neoForgeInstallerMirrors:"MSL Mirrors",listenHost:"localhost",listenPort:1027,oAuthMSLClientID:"",oAuthMSLClientSecret:""}),u=[{label:"官方源 (较慢)",value:"Official"},{label:"MSL镜像源 (推荐)",value:"MSL Mirrors"},{label:"MSL镜像源 - 备用",value:"MSL Mirrors Backup"}],c=l,_=async()=>{o.value=!0;try{const z=await Vo();Object.assign(v,z)}catch(z){L.error(z.message||"系统设置加载失败")}finally{o.value=!1}},h=async()=>{i.value=!0;try{await Mo(v),L.success("系统设置保存成功")}catch(z){L.error(z.message)}finally{i.value=!1}},S=()=>{_(),c("refresh")};n({initData:_});const A=$("");return xe(()=>{A.value=`${window.location.origin}/oauth/callback`}),(z,w)=>{const g=p("t-button"),U=p("t-form-item"),I=p("t-switch"),m=p("t-select"),x=p("t-divider"),y=p("t-input"),E=p("t-icon"),T=p("t-space"),V=p("t-col"),N=p("t-row"),q=p("t-form"),P=p("t-card");return r(),K(P,{bordered:!1,title:"系统偏好设置",loading:o.value,class:"settings-card"},{actions:a(()=>[e(g,{theme:"primary",variant:"text",size:"small",onClick:S},{default:a(()=>[...w[11]||(w[11]=[f("刷新数据",-1)])]),_:1})]),default:a(()=>[e(q,{ref:"sysForm",data:v,"label-width":120,"label-align":"left",onSubmit:h},{default:a(()=>[w[18]||(w[18]=t("div",{class:"group-title"},"守护进程",-1)),e(U,{label:"软件更新",style:{"margin-top":"6px"}},{default:a(()=>[e(g,{theme:"default",loading:b(d).loading,onClick:w[0]||(w[0]=k=>b(d).checkAppUpdate(!0))},{icon:a(()=>[e(b(xs))]),default:a(()=>[w[12]||(w[12]=f(" 检查更新 ",-1))]),_:1},8,["loading"])]),_:1}),e(U,{label:"自动打开控制台",help:"MSLX 守护进程启动成功后，是否自动登录网页端控制台。"},{default:a(()=>[e(I,{modelValue:v.openWebConsoleOnLaunch,"onUpdate:modelValue":w[1]||(w[1]=k=>v.openWebConsoleOnLaunch=k)},null,8,["modelValue"])]),_:1}),e(U,{label:"安装镜像源",help:"选择在自动安装 NeoForge / Forge 时所使用的镜像源。",style:{"margin-top":"6px"}},{default:a(()=>[e(m,{modelValue:v.neoForgeInstallerMirrors,"onUpdate:modelValue":w[2]||(w[2]=k=>v.neoForgeInstallerMirrors=k),options:u},null,8,["modelValue"])]),_:1}),b(ua)()?O("",!0):(r(),K(x,{key:0,dashed:""})),b(ua)()?O("",!0):(r(),C("div",Wb,[w[14]||(w[14]=t("div",{class:"group-title"},"MSL OAuth 2.0",-1)),e(U,{label:"Client ID",style:{"margin-top":"6px"}},{default:a(()=>[e(y,{modelValue:v.oAuthMSLClientID,"onUpdate:modelValue":w[3]||(w[3]=k=>v.oAuthMSLClientID=k),placeholder:"请输入 Client ID"},{"prefix-icon":a(()=>[e(b(St))]),_:1},8,["modelValue"])]),_:1}),e(U,{label:"Client Secret",help:"配置MSL OAuth 2.0后即可使用您的MSL账号一键登录您的MSLX控制台。",style:{"margin-top":"16px"}},{default:a(()=>[e(y,{modelValue:v.oAuthMSLClientSecret,"onUpdate:modelValue":w[4]||(w[4]=k=>v.oAuthMSLClientSecret=k),type:"password",placeholder:"请输入 Client Secret"},{"prefix-icon":a(()=>[e(b(ts))]),_:1},8,["modelValue"])]),_:1}),e(U,{label:"回调地址",help:"请将此地址复制并填入 MSL用户中心 OAuth应用配置的 [回调地址] 中",style:{"margin-top":"16px"}},{default:a(()=>[e(y,{value:A.value,readonly:"",placeholder:"正在获取当前域名..."},{"prefix-icon":a(()=>[e(b(Ct))]),suffix:a(()=>[e(g,{variant:"text",shape:"square",onClick:w[5]||(w[5]=k=>b(sa)(A.value,!0,"回调地址复制成功"))},{default:a(()=>[e(E,{name:"file-copy"})]),_:1})]),_:1},8,["value"])]),_:1}),e(U,{style:{"margin-top":"6px"},label:"配置教程"},{default:a(()=>[e(T,{align:"center"},{default:a(()=>[e(g,{theme:"default",onClick:w[6]||(w[6]=k=>b(Ie)(b(Ht).msl_oauth))},{icon:a(()=>[e(b(oa))]),default:a(()=>[w[13]||(w[13]=f(" 配置MSL账号快捷登录教程",-1))]),_:1})]),_:1})]),_:1})])),e(x,{dashed:""}),w[19]||(w[19]=t("div",{class:"group-title"},"网络与安全",-1)),e(U,{label:"禁止本地访问",help:"开启后将禁止本地回环地址访问，增强安全性。"},{default:a(()=>[e(T,{align:"center"},{default:a(()=>[e(I,{modelValue:v.fireWallBanLocalAddr,"onUpdate:modelValue":w[7]||(w[7]=k=>v.fireWallBanLocalAddr=k)},null,8,["modelValue"]),t("span",Xb,M(v.fireWallBanLocalAddr?"已开启":"已关闭"),1)]),_:1})]),_:1}),e(U,{label:"监听地址设置",help:"设置MSLX守护进程的监听地址。(需要重启守护进程生效,若不明白这是干什么的请一定不要修改！)",style:{"margin-top":"6px"}},{default:a(()=>[e(N,{gutter:16,style:{width:"100%"}},{default:a(()=>[e(V,{span:6},{default:a(()=>[e(y,{modelValue:v.listenHost,"onUpdate:modelValue":w[8]||(w[8]=k=>v.listenHost=k),placeholder:"localhost"},{"prefix-icon":a(()=>[e(b(St))]),_:1},8,["modelValue"])]),_:1}),e(V,{span:4,style:{display:"flex","align-items":"center"}},{default:a(()=>[w[15]||(w[15]=t("span",{style:{"margin-right":"8px",color:"var(--td-text-color-secondary)"}},":",-1)),e(y,{modelValue:v.listenPort,"onUpdate:modelValue":w[9]||(w[9]=k=>v.listenPort=k),placeholder:"1027",style:{width:"120px"}},{"prefix-icon":a(()=>[e(b(ts))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(U,{style:{"margin-top":"6px"},label:"远程访问"},{default:a(()=>[e(T,{align:"center"},{default:a(()=>[e(g,{theme:"default",onClick:w[10]||(w[10]=k=>b(Ie)(b(Ht).remote_access))},{icon:a(()=>[e(b(oa))]),default:a(()=>[w[16]||(w[16]=f(" 配置远程访问说明",-1))]),_:1})]),_:1})]),_:1}),e(U,null,{default:a(()=>[e(g,{theme:"primary",type:"submit",loading:i.value,block:"",class:"action-btn"},{default:a(()=>[...w[17]||(w[17]=[f(" 保存系统设置 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["data"])]),_:1},8,["loading"])}}}),Yb=re(Qb,[["__scopeId","data-v-65f913a9"]]),Zb=ne({__name:"WebPanelStyleCard",setup(s){const n=Ft(),l=async(d,o)=>{const i=d[0]?.raw||d.raw;if(!i)return;const v=await n.uploadImage(i);v&&(n.settings[o]=v)};return(d,o)=>{const i=p("t-button"),v=p("t-upload"),u=p("t-input"),c=p("t-form-item"),_=p("t-divider"),h=p("t-slider"),S=p("t-col"),A=p("t-row"),z=p("t-option"),w=p("t-select"),g=p("t-space"),U=p("t-form"),I=p("t-card");return r(),K(I,{bordered:!1,title:"面板自定义样式",description:"背景图相关的样式需要在面板左上角的样式面板中启用背景美化才会生效哦！",loading:b(n).loading,class:"settings-card"},{actions:a(()=>[e(i,{theme:"default",onClick:o[0]||(o[0]=m=>b(Ie)(b(Ht).style))},{icon:a(()=>[e(b(oa))]),default:a(()=>[o[13]||(o[13]=f(" 设置文档",-1))]),_:1})]),default:a(()=>[e(U,{data:b(n).settings,"label-width":120,"label-align":"left",onSubmit:b(n).saveSettings},{default:a(()=>[o[16]||(o[16]=t("div",{class:"group-title"},"背景图片设置",-1)),e(c,{label:"浅色背景",help:"留空则使用默认的背景图哦～"},{default:a(()=>[e(u,{modelValue:b(n).settings.webPanelStyleLightBackground,"onUpdate:modelValue":o[2]||(o[2]=m=>b(n).settings.webPanelStyleLightBackground=m),placeholder:"输入完整URL地址或者在右边上传图片"},{suffix:a(()=>[e(v,{theme:"custom",action:"","auto-upload":!1,"show-file-list":!1,accept:"image/png, image/jpeg, image/webp",onChange:o[1]||(o[1]=m=>l(m,"webPanelStyleLightBackground"))},{default:a(()=>[e(i,{variant:"text",shape:"square"},{default:a(()=>[e(b(xa))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"深色背景"},{default:a(()=>[e(u,{modelValue:b(n).settings.webPanelStyleDarkBackground,"onUpdate:modelValue":o[4]||(o[4]=m=>b(n).settings.webPanelStyleDarkBackground=m),placeholder:"输入完整URL地址或者在右边上传图片"},{suffix:a(()=>[e(v,{theme:"custom","auto-upload":!1,"show-file-list":!1,accept:"image/png, image/jpeg, image/webp",onChange:o[3]||(o[3]=m=>l(m,"webPanelStyleDarkBackground"))},{default:a(()=>[e(i,{variant:"text",shape:"square"},{default:a(()=>[e(b(xa))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(_,{dashed:""}),o[17]||(o[17]=t("div",{class:"group-title"},"透明度调整 (0.1 - 1.0)",-1)),e(A,{gutter:[32,16]},{default:a(()=>[e(S,{xs:24,sm:12,md:6},{default:a(()=>[e(c,{label:"浅色背景透明度"},{default:a(()=>[e(h,{modelValue:b(n).settings.webPanelStyleLightBackgroundOpacity,"onUpdate:modelValue":o[5]||(o[5]=m=>b(n).settings.webPanelStyleLightBackgroundOpacity=m),min:.1,max:1,step:.01,"tooltip-props":{theme:"light"}},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{xs:24,sm:12,md:6},{default:a(()=>[e(c,{label:"浅色组件透明度"},{default:a(()=>[e(h,{modelValue:b(n).settings.webPanelStyleLightComponentsOpacity,"onUpdate:modelValue":o[6]||(o[6]=m=>b(n).settings.webPanelStyleLightComponentsOpacity=m),min:.1,max:1,step:.01,"tooltip-props":{theme:"light"}},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{xs:24,sm:12,md:6},{default:a(()=>[e(c,{label:"深色背景透明度"},{default:a(()=>[e(h,{modelValue:b(n).settings.webPanelStyleDarkBackgroundOpacity,"onUpdate:modelValue":o[7]||(o[7]=m=>b(n).settings.webPanelStyleDarkBackgroundOpacity=m),min:.1,max:1,step:.01},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{xs:24,sm:12,md:6},{default:a(()=>[e(c,{label:"深色组件透明度"},{default:a(()=>[e(h,{modelValue:b(n).settings.webPanelStyleDarkComponentsOpacity,"onUpdate:modelValue":o[8]||(o[8]=m=>b(n).settings.webPanelStyleDarkComponentsOpacity=m),min:.1,max:1,step:.01},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(_,{dashed:""}),o[18]||(o[18]=t("div",{class:"group-title"},"终端设置(毛玻璃强度/染色设置)",-1)),e(A,{gutter:[32,16]},{default:a(()=>[e(S,{xs:24,sm:12,md:6},{default:a(()=>[e(c,{label:"浅色模式模糊度"},{default:a(()=>[e(h,{modelValue:b(n).settings.webpPanelTerminalBlurLight,"onUpdate:modelValue":o[9]||(o[9]=m=>b(n).settings.webpPanelTerminalBlurLight=m),min:0,max:50,step:1,"input-number-props":{theme:"column",style:"width: 65px"}},{label:a(({value:m})=>[f(M(m)+"px ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(S,{xs:24,sm:12,md:6},{default:a(()=>[e(c,{label:"深色模式模糊度"},{default:a(()=>[e(h,{modelValue:b(n).settings.webpPanelTerminalBlurDark,"onUpdate:modelValue":o[10]||(o[10]=m=>b(n).settings.webpPanelTerminalBlurDark=m),min:0,max:50,step:1,"input-number-props":{theme:"column",style:"width: 65px"}},{label:a(({value:m})=>[f(M(m)+"px ",1)]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(S,{xs:24,sm:12,md:6},{default:a(()=>[e(g,null,{default:a(()=>[e(c,{label:"日志染色等级"},{default:a(()=>[e(w,{modelValue:b(n).settings.webPanelColorizeLogLevel,"onUpdate:modelValue":o[11]||(o[11]=m=>b(n).settings.webPanelColorizeLogLevel=m)},{default:a(()=>[e(z,{label:"不染色",value:0}),e(z,{label:"简约染色",value:1}),e(z,{label:"增强染色",value:2})]),_:1},8,["modelValue"])]),_:1}),e(i,{theme:"default",onClick:o[12]||(o[12]=m=>b(Ie)(b(Ht).style_log_colorizer))},{icon:a(()=>[e(b(Qn))]),default:a(()=>[o[14]||(o[14]=f(" 有什么区别？",-1))]),_:1})]),_:1})]),_:1})]),_:1}),e(c,{style:{"margin-top":"24px"}},{default:a(()=>[e(i,{theme:"primary",type:"submit",loading:b(n).submitLoading,block:"",class:"action-btn"},{default:a(()=>[...o[15]||(o[15]=[f(" 应用样式设置 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["data","onSubmit"])]),_:1},8,["loading"])}}}),e0=re(Zb,[["__scopeId","data-v-e0f02fd5"]]),t0={class:"settings-page"},a0=ne({__name:"index",setup(s){const n=Ft(),l=$(),d=$(),o=async()=>{const i=[];l.value&&i.push(l.value.initData()),d.value&&i.push(d.value.initData()),i.push(n.fetchSettings()),await Promise.all(i)};return xe(()=>{o()}),(i,v)=>{const u=p("t-space");return r(),C("div",t0,[e(u,{direction:"vertical",size:"large",style:{width:"100%"}},{default:a(()=>[e(Jb,{ref_key:"userCardRef",ref:l},null,512),e(Yb,{ref_key:"sysCardRef",ref:d,onRefresh:o},null,512),e(e0)]),_:1})])}}}),s0=re(a0,[["__scopeId","data-v-5abf49f6"]]),n0=Object.freeze(Object.defineProperty({__proto__:null,default:s0},Symbol.toStringTag,{value:"Module"}));async function l0(){return await X.get({url:"/build.json",baseURL:"/",params:{t:Date.now()}})}async function o0(){return await X.get({url:"/query/changelogs?software=MSLX",baseURL:"https://api.mslmc.cn/v3"})}const r0="/assets/jpg/mslx-aowu.BKxkpLYR.jpg",i0={class:"construction-container"},u0={class:"content-wrapper"},d0={class:"description"},c0={class:"progress-decoration"},m0={class:"action-area"},p0={width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",style:{"margin-right":"4px"}},v0=ne({__name:"HurryUpppppppp",setup(s){const n=$(0),l=$(!1),d=["开发者收到了你的怨念！(╯°□°）╯︵ ┻━┻","正在疯狂敲击键盘中... 🔥","生产队的驴都不敢这么歇！🐴","别催了别催了，头发已经掉光了！👴","再催就把 Bug 变成 Feature！🐛","服务器正在冒烟... 💥","正在与 Bug 进行殊死搏斗！⚔️","不要急，我在试图理解我昨晚写的代码... 🤔","进度条：99%... (卡住了) 🚫","键盘冒火星子了！灭火器准备！🧯","新建文件夹 (2) - 最终版 - 绝对不改版.zip 📁","404 Developer Not Found 🤖","已读不回 (假的，正在改) 📱","正在向虚空终端请求算力... 🧠","画饼中，请稍后... 🥞","再催我就去提瓦特大陆摸鱼了！🎣","纳西妲说她想吃枣椰蜜糖，没空写代码！🍬","正在虚空终端检索：《如何 1 秒写完代码》... 🧠","知识与你分享，但 Bug 不行！📖","再催？再催就把你关进净善宫陪我一起加班！🏰","陷入了改 Bug 的花神诞祭轮回... 第168次尝试... 🔄","别急，代码还在梦境里生长呢 💤","所有的代码，皆是智慧的结晶（大概）✨","我要去上个厕所，把写不完的焦虑通通冲走！🚽","兰那罗说这行代码它不想修，它想去唱歌 🎶","或许... 我们可以用罐装知识把功能直接灌进去？🤔","这虽然是痛痛，但也是成长的过程... (指修Bug) 🩹"],o=te(()=>n.value===0?"这里正在进行一项神秘的大工程...":n.value<5?"工期正在加急！":n.value<10?"好痛！别点啦！":"呜呜呜，错啦，这就去写代码！😭"),i=()=>{n.value++,l.value=!0,setTimeout(()=>{l.value=!1},500);let v=d[Math.floor(Math.random()*d.length)];n.value>20?(v="键盘已经被敲烂了！求放过！🆘",L.error(v)):L.success(v)};return(v,u)=>{const c=p("t-progress"),_=p("t-button");return r(),C("div",i0,[t("div",u0,[t("div",{class:ye(["image-box",{"shake-anim":l.value}])},[...u[0]||(u[0]=[t("img",{src:r0,alt:"施工中",class:"mascot-img"},null,-1),t("div",{class:"halo"},null,-1)])],2),u[2]||(u[2]=t("h1",{class:"main-title"},"嗷呜！Ｏ(≧口≦)Ｏ",-1)),t("p",d0,M(o.value),1),t("div",c0,[e(c,{theme:"plump",percentage:30+n.value%70,label:!1,status:"active"},null,8,["percentage"])]),t("div",m0,[e(_,{theme:"primary",size:"large",shape:"round",variant:"base",class:"urge-btn",onClick:i},{icon:a(()=>[(r(),C("svg",p0,[...u[1]||(u[1]=[t("path",{d:"M8.5 1L2 9h5v6l6.5-8h-5V1z"},null,-1)])]))]),default:a(()=>[f(" 催更 ("+M(n.value)+") ",1)]),_:1})])])])}}}),f0=re(v0,[["__scopeId","data-v-d8b4c962"]]),g0={class:"about-page"},_0={class:"intro-header"},h0={class:"logo-area"},y0={class:"dev-card"},b0={class:"dev-info"},w0={class:"dev-name"},k0={class:"dev-role"},$0=["title"],A0={class:"dev-card"},x0={class:"dev-info"},C0={class:"dev-name"},S0={class:"dev-role",style:{background:"var(--td-success-color-1)",color:"var(--td-success-color-7)"}},I0=["title"],V0={key:0,class:"history-timeline"},M0={class:"timeline-content"},U0={style:{display:"flex","align-items":"center",gap:"8px","margin-bottom":"8px"}},L0={class:"commit-time",style:{"margin-bottom":"0"}},B0={class:"msg",style:{"white-space":"pre-wrap","margin-bottom":"0"}},R0={key:1,style:{"text-align":"center",color:"var(--td-text-color-placeholder)",padding:"20px"}},z0={key:0,class:"build-summary"},E0={class:"info-block"},P0={class:"value version"},F0={class:"info-block"},T0={class:"value time"},D0={class:"info-block"},O0=["title"],j0={class:"sub-value"},K0={class:"info-block"},N0={class:"value framework"},q0={key:1,class:"details-collapse"},G0={class:"panel-header"},H0={class:"history-timeline"},J0={class:"timeline-content"},W0={class:"commit-time"},X0={class:"msg"},Q0={class:"meta"},Y0={class:"hash"},Z0={class:"panel-header"},e2={class:"deps-grid"},t2={class:"dep-item"},a2=["title"],s2=ne({__name:"index",setup(s){const n=[{name:"xiaoyu",role:"Core Developer",avatar:"https://q.qlogo.cn/headimg_dl?dst_uin=1791123970&spec=640&img_type=jpg",desc:"核心开发者"},{name:"Weheal",role:"Core Developer",avatar:"https://q.qlogo.cn/headimg_dl?dst_uin=2035582067&spec=640&img_type=jpg",desc:"核心开发者"}],l=[{name:"GuHanDuRen",role:"Alpha Tester",avatar:"https://q.qlogo.cn/headimg_dl?dst_uin=2778318425&spec=640&img_type=jpg",desc:"最早期内部功能测试"},{name:"邱息",role:"Beta Tester",avatar:"https://q.qlogo.cn/headimg_dl?dst_uin=3687624214&spec=640&img_type=jpg",desc:"提供了宝贵的建议"},{name:"Nebula琳",role:"Beta Tester",avatar:"https://q.qlogo.cn/headimg_dl?dst_uin=3770298358&spec=640&img_type=jpg",desc:"提供了宝贵的建议"},{name:"MSLX Beta 群友们",role:"Members",avatar:"https://p.qlogo.cn/gh/839645854/839645854/0",desc:"感谢各位内测群的群友们！"}],d=$(!0),o=$(null),i=$(!0),v=$([]),u=async()=>{try{d.value=!0,o.value=await l0()}catch(h){console.error(h),L.warning("无法加载构建信息")}finally{d.value=!1}},c=async()=>{try{i.value=!0;const h=await o0();h&&(v.value=h)}catch(h){console.error("获取更新日志失败:",h)}finally{i.value=!1}},_=te(()=>o.value?.dependencies?Object.entries(o.value.dependencies).map(([h,S])=>({name:h,version:S})):[]);return xe(()=>{u(),c()}),(h,S)=>{const A=p("t-card"),z=p("t-avatar"),w=p("t-col"),g=p("t-row"),U=p("t-tag"),I=p("t-timeline-item"),m=p("t-timeline"),x=p("t-divider"),y=p("t-collapse-panel"),E=p("t-collapse"),T=p("t-space");return r(),C("div",g0,[e(T,{direction:"vertical",size:"large",style:{width:"100%"}},{default:a(()=>[e(A,{bordered:!1,class:"intro-card"},{default:a(()=>[t("div",_0,[t("div",h0,[e(b(St),{class:"logo-icon"}),S[0]||(S[0]=t("h1",{class:"project-title"},"关于 MSLX",-1))])]),S[1]||(S[1]=t("div",{class:"intro-text"},[t("p",null,[t("strong",null,"MSLX"),f(" 是由 "),t("strong",null,"MSL 原班团队 MSLTeam"),f(" 倾力打造的全新一代开服工具。 基于 "),t("strong",null,".NET Core 10.0"),f(" 环境。 ")]),t("p",null,[f(" 它传承了 MSL 经典的 UI 设计语言，旨在让操作零门槛——无论是老用户还是新伙伴，都能即刻上手，极速部署您的 MC 服务器。 MSLX 不仅 "),t("strong",null,"完美支持跨平台"),f(" (Windows / macOS / Linux) 运行，相比前代，更引入了强大的 "),t("strong",null,"远程访问"),f(" 功能，让管理更自由。 ")])],-1))]),_:1}),e(A,{bordered:!1,title:"开发团队"},{default:a(()=>[S[2]||(S[2]=t("p",{class:"about-desc"},"感谢以下开发者对本项目的杰出贡献：",-1)),e(g,{gutter:[16,16]},{default:a(()=>[(r(),C(pe,null,we(n,V=>e(w,{key:V.name,span:3,xs:12,sm:6},{default:a(()=>[t("div",y0,[e(z,{image:V.avatar,size:"56px",shape:"circle",class:"dev-avatar"},null,8,["image"]),t("div",b0,[t("div",w0,M(V.name),1),t("div",k0,M(V.role),1),t("div",{class:"dev-desc",title:V.desc},M(V.desc),9,$0)])])]),_:2},1024)),64))]),_:1})]),_:1}),e(A,{bordered:!1,title:"催更？"},{default:a(()=>[e(f0)]),_:1}),e(A,{bordered:!1,title:"鸣谢"},{default:a(()=>[S[3]||(S[3]=t("p",{class:"about-desc"},"特别感谢参与内测并提供反馈的伙伴们：",-1)),e(g,{gutter:[16,16]},{default:a(()=>[(r(),C(pe,null,we(l,V=>e(w,{key:V.name,span:3,xs:12,sm:4,md:4,lg:3},{default:a(()=>[t("div",A0,[e(z,{image:V.avatar,size:"56px",shape:"circle",class:"dev-avatar"},null,8,["image"]),t("div",x0,[t("div",C0,M(V.name),1),t("div",S0,M(V.role),1),t("div",{class:"dev-desc",title:V.desc},M(V.desc),9,I0)])])]),_:2},1024)),64))]),_:1})]),_:1}),e(A,{bordered:!1,title:"更新日志",loading:i.value},{default:a(()=>[v.value.length>0?(r(),C("div",V0,[e(m,null,{default:a(()=>[(r(!0),C(pe,null,we(v.value,(V,N)=>(r(),K(I,{key:N,"dot-color":"primary"},{default:a(()=>[t("div",M0,[t("div",U0,[e(U,{size:"small",variant:"light",theme:"primary"},{default:a(()=>[f(M(V.version),1)]),_:2},1024),t("div",L0,[e(b(pt),{style:{"margin-right":"4px","font-size":"12px"}}),f(" "+M(V.time),1)])]),t("div",B0,M(V.changes),1)])]),_:2},1024))),128))]),_:1})])):i.value?O("",!0):(r(),C("div",R0," 暂无更新日志 "))]),_:1},8,["loading"]),e(A,{bordered:!1,title:"构建信息",loading:d.value},{actions:a(()=>[o.value?(r(),K(U,{key:0,theme:"success",variant:"light"},{icon:a(()=>[e(b(xt))]),default:a(()=>[S[4]||(S[4]=f(" 构建成功 ",-1))]),_:1})):O("",!0)]),default:a(()=>[o.value?(r(),C("div",z0,[e(g,{gutter:[16,16],style:{"align-items":"stretch"}},{default:a(()=>[e(w,{span:3,xs:12,sm:6},{default:a(()=>[t("div",E0,[S[5]||(S[5]=t("div",{class:"label"},"当前版本",-1)),t("div",P0,M(o.value.version),1)])]),_:1}),e(w,{span:3,xs:12,sm:6},{default:a(()=>[t("div",F0,[S[6]||(S[6]=t("div",{class:"label"},"构建时间",-1)),t("div",T0,[e(b(pt)),f(" "+M(o.value.buildTime),1)])])]),_:1}),e(w,{span:3,xs:12,sm:6},{default:a(()=>[t("div",D0,[S[7]||(S[7]=t("div",{class:"label"},"最新提交",-1)),t("div",{class:"value commit",title:o.value.commitMsg},[e(b(Yn)),f(" "+M(o.value.commitId.substring(0,7)),1)],8,O0),t("div",j0,"by "+M(o.value.commitAuthor),1)])]),_:1}),e(w,{span:3,xs:12,sm:6},{default:a(()=>[t("div",K0,[S[10]||(S[10]=t("div",{class:"label"},"核心框架",-1)),t("div",N0,[S[8]||(S[8]=t("span",{class:"dotnet"},".NET 10.0",-1)),e(x,{layout:"vertical"}),S[9]||(S[9]=t("span",{class:"vue"},"Vue 3.x",-1))])])]),_:1})]),_:1})])):O("",!0),o.value?(r(),C("div",q0,[e(E,{borderless:!0},{default:a(()=>[e(y,{value:"history"},{header:a(()=>[t("div",G0,[e(b(Zn)),S[11]||(S[11]=f(" 提交日志 (Commit History)",-1))])]),default:a(()=>[t("div",H0,[e(m,null,{default:a(()=>[(r(!0),C(pe,null,we(o.value.history,V=>(r(),K(I,{key:V.commitId,"dot-color":"primary"},{default:a(()=>[t("div",J0,[t("div",W0,M(V.commitTime),1),t("div",X0,M(V.commitMsg),1),t("div",Q0,[e(U,{size:"small",style:{padding:"0"}},{default:a(()=>[e(b(na)),f(" "+M(V.commitAuthor),1)]),_:2},1024),t("span",Y0,"#"+M(V.commitId.substring(0,7)),1)])])]),_:2},1024))),128))]),_:1})])]),_:1}),e(y,{value:"dependencies"},{header:a(()=>[t("div",Z0,[e(b(Rt)),S[12]||(S[12]=f(" 核心依赖 (Dependencies)",-1))])]),default:a(()=>[t("div",e2,[e(g,{gutter:[12,12]},{default:a(()=>[(r(!0),C(pe,null,we(_.value,V=>(r(),K(w,{key:V.name,span:3,xs:12,sm:6,md:4},{default:a(()=>[t("div",t2,[t("span",{class:"dep-name",title:V.name},M(V.name),9,a2),e(U,{size:"small",variant:"light-outline"},{default:a(()=>[f(M(V.version),1)]),_:2},1024)])]),_:2},1024))),128))]),_:1})])]),_:1})]),_:1})])):O("",!0)]),_:1},8,["loading"])]),_:1})])}}}),n2=re(s2,[["__scopeId","data-v-92efe470"]]),l2=Object.freeze(Object.defineProperty({__proto__:null,default:n2},Symbol.toStringTag,{value:"Module"})),o2={key:0,class:"loading-wrapper"},r2={key:1,class:"input-group"},i2={class:"check-container"},u2={class:"btn-wrapper"},d2={key:0,class:"msl-login-wrapper"},c2={class:"reset-guide"},m2={class:"guide-item"},p2={class:"guide-title"},v2={class:"guide-item"},f2={class:"guide-title"},g2="remembered_url",ks="remembered_username",_2=ne({__name:"Login",setup(s){const n=Re(),l=qa(),d=Jt(),o=et(),i=$(!1),v=$(!1),u=$(!1),c=$(!1),_=$(!0),h=$(!1),S=Xe({url:localStorage.getItem(g2)||"",username:localStorage.getItem(ks)||"",password:"",checked:!!localStorage.getItem(ks)}),A=$(),z=te(()=>{const I={username:[{required:!0,message:"请输入用户名",type:"error"}],password:[{required:!0,message:"请输入密码",type:"error"}]};return c.value||(I.url=[{required:!0,message:"请输入服务器地址",type:"error"}]),I}),w=async()=>{_.value=!0,await n.checkConnection("")?(c.value=!0,S.url=""):c.value=!1;try{(await X.get({url:"/api/auth/oauth/status"})).allowOAuth&&(v.value=!0),_.value=!1}catch{_.value=!1}},g=async({validateResult:I})=>{if(I===!0){i.value=!0;try{await n.login({url:c.value?"":S.url,username:S.username,password:S.password,checked:S.checked}),L.success("登录成功");const m=o.query.redirect,x=m?decodeURIComponent(m):"/dashboard/base";d.push(x),Ls.success({content:`欢迎回来！${n.userInfo.name}`,title:"MSLX 控制台"}),l.checkAppUpdate(!1)}catch(m){L.error(m.message||"登录失败，请检查账号密码")}finally{i.value=!1}}},U=async()=>{try{i.value=!0;const I=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);localStorage.setItem("oauth_state",I);const m=`${window.location.origin}/oauth/callback?mode=login`,x=await X.get({url:"/api/auth/oauth/url",params:{state:I,callback:m}});if(x&&x.url)window.location.href=x.url;else throw new Error(x.message||"获取授权地址失败")}catch(I){L.error(I.message||"无法连接到认证服务器"),i.value=!1}};return xe(()=>{w()}),(I,m)=>{const x=p("t-loading"),y=p("t-icon"),E=p("t-input"),T=p("t-form-item"),V=p("t-checkbox"),N=p("t-link"),q=p("t-button"),P=p("t-form"),k=p("t-divider"),B=p("t-alert"),R=p("t-dialog");return r(),C("div",null,[e(P,{ref_key:"form",ref:A,class:"login-form",data:S,rules:z.value,"label-width":"0",onSubmit:g},{default:a(()=>[_.value?(r(),C("div",o2,[e(x,{text:"正在连接服务...",size:"small"})])):(r(),C("div",r2,[c.value?O("",!0):(r(),K(T,{key:0,name:"url"},{default:a(()=>[e(E,{modelValue:S.url,"onUpdate:modelValue":m[0]||(m[0]=Z=>S.url=Z),size:"large",placeholder:"服务器地址 (如 localhost:1027)",class:"glass-input"},{"prefix-icon":a(()=>[e(y,{name:"server"})]),_:1},8,["modelValue"])]),_:1})),e(T,{name:"username"},{default:a(()=>[e(E,{modelValue:S.username,"onUpdate:modelValue":m[1]||(m[1]=Z=>S.username=Z),size:"large",placeholder:"请输入用户名",class:"glass-input"},{"prefix-icon":a(()=>[e(y,{name:"user"})]),_:1},8,["modelValue"])]),_:1}),e(T,{name:"password"},{default:a(()=>[e(E,{modelValue:S.password,"onUpdate:modelValue":m[3]||(m[3]=Z=>S.password=Z),size:"large",type:u.value?"text":"password",placeholder:"请输入密码",class:"glass-input"},{"prefix-icon":a(()=>[e(y,{name:"lock-on"})]),"suffix-icon":a(()=>[e(y,{name:u.value?"browse":"browse-off",style:{cursor:"pointer"},onClick:m[2]||(m[2]=Z=>u.value=!u.value)},null,8,["name"])]),_:1},8,["modelValue","type"])]),_:1})])),t("div",i2,[e(V,{modelValue:S.checked,"onUpdate:modelValue":m[4]||(m[4]=Z=>S.checked=Z)},{default:a(()=>[...m[7]||(m[7]=[f("记住用户名",-1)])]),_:1},8,["modelValue"]),e(N,{theme:"primary",hover:"color",onClick:m[5]||(m[5]=Z=>h.value=!0)},{default:a(()=>[...m[8]||(m[8]=[f(" 忘记密码？ ",-1)])]),_:1})]),e(T,{class:"btn-container"},{default:a(()=>[t("div",u2,[e(q,{block:"",size:"large",type:"submit",class:"login-btn",loading:i.value},{default:a(()=>[...m[9]||(m[9]=[f(" 登 录 ",-1)])]),_:1},8,["loading"]),v.value?(r(),C("div",d2,[t("a",{class:"msl-link-btn",onClick:U},[e(y,{name:"user-transmit"}),m[10]||(m[10]=t("span",null,"使用 MSL 账户登录",-1))])])):O("",!0)])]),_:1})]),_:1},8,["data","rules"]),e(R,{visible:h.value,"onUpdate:visible":m[6]||(m[6]=Z=>h.value=Z),header:"找回或重置密码",footer:!1,width:"480px",attach:"body"},{default:a(()=>[t("div",c2,[t("div",m2,[t("div",p2,[e(y,{name:"user-talk"}),m[11]||(m[11]=f(" 方式一：联系管理员",-1))]),m[12]||(m[12]=t("p",{class:"guide-desc"},"如果系统中存在其他管理员账号，请联系对应人员协助您在后台重置密码。",-1))]),e(k,{dashed:"",style:{margin:"16px 0"}}),t("div",v2,[t("div",f2,[e(y,{name:"refresh"}),m[13]||(m[13]=f(" 方式二：初始化默认账户",-1))]),m[15]||(m[15]=t("p",{class:"guide-desc"},"若无法联系其他管理员，请在服务器端删除以下配置文件：",-1)),m[16]||(m[16]=t("div",{class:"code-block"},"DaemonData/Configs/UserList.json",-1)),t("p",null,[e(B,{style:{"margin-top":"10px"}},{default:a(()=>[...m[14]||(m[14]=[f("操作提示：删除该文件后，请",-1),t("strong",null,"重启守护进程",-1),f("。系统将自动重新创建包含默认账号密码的初始文件。",-1)])]),_:1})])])])]),_:1},8,["visible"])])}}}),h2=re(_2,[["__scopeId","data-v-b95f4e77"]]),y2={class:"login-header"},b2={class:"logo"},w2={class:"operations-container"},k2=ne({__name:"Header",setup(s){const n=ot(),l=()=>{n.updateConfig({showSettingPanel:!0})},d=()=>{window.open("https://github.com/MSLTeam/MSLX")},o=()=>{window.open("https://mslx.mslmc.cn")};return(i,v)=>{const u=p("t-icon"),c=p("t-button");return r(),C("header",y2,[t("span",b2,[t("img",{src:Oa,class:ye(`${b(Me)}-side-nav-logo-img`),alt:"logo"},null,2),v[0]||(v[0]=t("span",null," MSLX 管理中心 ",-1))]),t("div",w2,[e(c,{theme:"default",shape:"square",variant:"text",onClick:d},{default:a(()=>[e(u,{name:"logo-github",class:"icon"})]),_:1}),e(c,{theme:"default",shape:"square",variant:"text",onClick:o},{default:a(()=>[e(u,{name:"help-circle",class:"icon"})]),_:1}),e(c,{theme:"default",shape:"square",variant:"text",onClick:l},{default:a(()=>[e(u,{name:"setting",class:"icon"})]),_:1})])])}}}),Qs=re(k2,[["__scopeId","data-v-a538553e"]]),$2={class:"login-content"},A2={class:"login-container"},x2={class:"copyright"},C2={class:"welcome-content"},S2={class:"account-card"},I2={class:"info-row"},V2={class:"label"},M2={class:"info-row"},U2={class:"label"},L2={name:"LoginIndex"},B2=ne({...L2,setup(s){const n=Ft(),l=Re(),d=(u,c)=>u?u.startsWith("http")?u:`${l.baseUrl||window.location.origin}/api/static/images/${u}`:c,o=te(()=>{const u=n.settings;return{"--custom-bg-light":`url('${d(u.webPanelStyleLightBackground,ja)}')`,"--custom-bg-dark":`url('${d(u.webPanelStyleDarkBackground,Ka)}')`}}),i=$(!1),v=()=>{i.value=!1;const u=new URL(window.location.href);u.searchParams.delete("initialize"),window.history.replaceState({},"",u)};return xe(()=>{n.fetchSettings(),new URLSearchParams(window.location.search).get("initialize")==="true"&&(i.value=!0)}),(u,c)=>{const _=p("t-alert"),h=p("t-button"),S=p("t-dialog");return r(),C("div",{class:"login-wrapper",style:dt(o.value)},[e(Qs,{class:"login-header-fixed"}),t("div",$2,[t("div",A2,[c[1]||(c[1]=t("div",{class:"title-container"},[t("h1",{class:"title"},"连接到 MSLX"),t("p",{class:"sub-title"},"网页管理中心")],-1)),e(h2),t("footer",x2,"Copyright @ 2021-"+M(new Date().getFullYear())+" MSLTeam",1)])]),e(Da,{class:"tdesign-setting-outside"}),e(S,{visible:i.value,"onUpdate:visible":c[0]||(c[0]=A=>i.value=A),footer:!1,"close-btn":!0,width:"480px",attach:"body",class:"welcome-dialog","on-close":v},{header:a(()=>[...c[2]||(c[2]=[t("div",{class:"dialog-header-row"},[t("span",{class:"emoji-icon"},"🎉"),t("span",{class:"header-text"},"欢迎使用 MSLX 开服器")],-1)])]),default:a(()=>[t("div",C2,[e(_,{theme:"success",class:"security-alert"},{message:a(()=>[...c[3]||(c[3]=[f(" 您似乎是第一次使用？请查阅以下信息，然后开始享受您的MC开服之旅吧～ ",-1)])]),_:1}),t("div",S2,[t("div",I2,[t("span",V2,[e(b(na)),c[4]||(c[4]=f(" 默认账户:",-1))]),c[5]||(c[5]=t("span",{class:"value highlight"},"mslx",-1))]),t("div",M2,[t("span",U2,[e(b(va)),c[6]||(c[6]=f(" 默认密码:",-1))]),c[7]||(c[7]=t("span",{class:"value mono"},"请在MSLX守护进程端控制台查看",-1))])]),e(_,{theme:"warning",class:"security-alert"},{message:a(()=>[...c[8]||(c[8]=[f(" 安全提醒：请登录后",-1),t("b",null,[t("u",null,"立即修改默认的账户名和密码")],-1),f("，保障您的服务安全。 ",-1)])]),_:1}),e(h,{block:"",theme:"primary",size:"large",variant:"base",onClick:v},{icon:a(()=>[e(b(xt))]),default:a(()=>[c[9]||(c[9]=f(" 我已知晓，立即登录 ",-1))]),_:1})])]),_:1},8,["visible"])],4)}}}),R2=re(B2,[["__scopeId","data-v-786dd78b"]]),z2=Object.freeze(Object.defineProperty({__proto__:null,default:R2},Symbol.toStringTag,{value:"Module"})),E2={class:"login-panel"},P2={class:"login-container"},F2={class:"callback-content"},T2={key:0,class:"status-box"},D2={class:"loading-icon-wrapper"},O2={class:"tip-text"},j2={key:1,class:"status-box success"},K2={class:"desc"},N2={class:"sub-desc"},q2={class:"btn-group"},G2={key:2,class:"status-box error"},H2={class:"error-msg-box"},J2={class:"btn-group"},W2={class:"copyright"},X2=ne({__name:"index",setup(s){const n=et(),l=Jt(),d=Re(),o=Ft(),i=(I,m)=>I?I.startsWith("http")?I:`${d.baseUrl||window.location.origin}/api/static/images/${I}`:m,v=te(()=>{const I=o.settings;return{"--custom-bg-light":`url('${i(I.webPanelStyleLightBackground,ja)}')`,"--custom-bg-dark":`url('${i(I.webPanelStyleDarkBackground,Ka)}')`}}),u=$("loading"),c=$("正在验证身份..."),_=$(""),h=$(""),S=$(3),A=async()=>{const{code:I,state:m,mode:x}=n.query;if(!I||!m){u.value="error",_.value="无效的回调参数，缺少 Code 或 State。";return}const y=localStorage.getItem("oauth_state");if(localStorage.removeItem("oauth_state"),m!==y){u.value="error",_.value="安全校验失败 (State Mismatch)，请求可能被篡改。";return}try{if(x==="login")await z(I);else if(x==="bind")await w(I);else throw new Error("未知的操作模式")}catch(E){u.value="error",_.value=E.message||"处理请求时发生未知错误"}},z=async I=>{c.value="正在登录 MSLX...";try{const m=await X.post({url:"/api/auth/oauth/login",data:{code:I}});await d.loginByOAuth(m),u.value="success",h.value=`欢迎回来，${d.userInfo.name||m.data.userInfo?.name}`,g("/dashboard/base")}catch(m){u.value="error",_.value=m.message}},w=async I=>{c.value="正在绑定 MSL 账号...";try{await X.post({url:"/api/auth/oauth/bind",data:{code:I}}),u.value="success",h.value="账号绑定成功！",await d.getUserInfo(),g("/settings")}catch(m){L.error(m.message)}},g=I=>{const m=setInterval(()=>{S.value--,S.value<=0&&(clearInterval(m),Ie(I))},1e3)},U=()=>{Ie("/login")};return xe(()=>{o.fetchSettings(),A()}),(I,m)=>{const x=p("t-loading"),y=p("t-button");return r(),C("div",{class:"login-wrapper",style:dt(v.value)},[e(Qs,{class:"login-header-fixed"}),t("div",E2,[t("div",P2,[m[5]||(m[5]=t("div",{class:"title-container"},[t("h1",{style:{"margin-bottom":"10px"},class:"title"},"MSL 统一身份认证")],-1)),t("div",F2,[u.value==="loading"?(r(),C("div",T2,[t("div",D2,[e(x,{size:"large"})]),t("p",O2,M(c.value),1)])):u.value==="success"?(r(),C("div",j2,[e(b(ma),{class:"icon-success"}),m[2]||(m[2]=t("h2",{class:"status-title"},"操作成功",-1)),t("p",K2,M(h.value),1),t("p",N2,M(S.value)+" 秒后自动跳转...",1),t("div",q2,[e(y,{block:"",size:"large",class:"login-btn",onClick:m[0]||(m[0]=E=>b(l).push("/dashboard/base"))},{default:a(()=>[...m[1]||(m[1]=[f(" 立即进入 ",-1)])]),_:1})])])):(r(),C("div",G2,[e(b(Ps),{class:"icon-error"}),m[4]||(m[4]=t("h2",{class:"status-title"},"操作失败",-1)),t("div",H2,M(_.value),1),t("div",J2,[e(y,{block:"",size:"large",class:"login-btn",onClick:U},{default:a(()=>[...m[3]||(m[3]=[f(" 返回登录页 ",-1)])]),_:1})])]))]),t("footer",W2,"Copyright @ 2021-"+M(new Date().getFullYear())+" MSLTeam",1)])]),e(Da,{class:"tdesign-setting-outside"})],4)}}}),Q2=re(X2,[["__scopeId","data-v-4a099a27"]]),Y2=Object.freeze(Object.defineProperty({__proto__:null,default:Q2},Symbol.toStringTag,{value:"Module"})),Z2={class:"result-content"},ew={class:"result-container"},tw={class:"action-box"},aw={class:"copyright"},sw=ne({__name:"index",setup(s){const n=ot(),l=te(()=>n.displayMode);return(d,o)=>{const i=p("t-button");return r(),C("div",{class:ye(["result-wrapper",l.value])},[t("div",Z2,[t("div",ew,[o[2]||(o[2]=t("div",{class:"result-info"},[t("h1",{class:"code"},"404"),t("h2",{class:"title"},"掉出了这个世界......"),t("p",{class:"desc"},[f("越过基岩的边界，只剩无尽的黑夜，"),t("br"),f("请点击重生，寻回原本的世界。")])],-1)),t("div",tw,[e(i,{theme:"primary",size:"large",block:"",class:"home-btn",onClick:o[0]||(o[0]=v=>b(Ie)("/"))},{default:a(()=>[...o[1]||(o[1]=[f(" 返回主页 ",-1)])]),_:1})]),t("footer",aw,"Copyright @ 2021-"+M(new Date().getFullYear())+" MSLTeam",1)])])],2)}}}),nw=re(sw,[["__scopeId","data-v-86bbfa54"]]),lw=Object.freeze(Object.defineProperty({__proto__:null,default:nw},Symbol.toStringTag,{value:"Module"}));
