import{u as Y,a as A}from"./vue-router.f8VyOqpO.js";import{u as G,a as H,r as K,_ as U,T as O}from"./index.DjdW_re9.js";import{M as L,N as W}from"./tdesign-vue-next.ClIZ97Cx.js";import{D as V,F as f,W as J,K as Q,R as $,b0 as r,aX as y,aY as w,G as o,b2 as a,a$ as t,b1 as Z,b6 as ee,ao as n,b5 as te,ap as M}from"./index.CWeK9ocq.js";import{L as oe}from"./Header.DiNtpnUR.js";import{a7 as se,a8 as ae,a2 as le}from"./tdesign-icons-vue-next.o89AUH_k.js";import"./pinia.CwCJD8HV.js";import"./pinia-plugin-persistedstate_561243483b11dd07f5acf9e797fda690.n2tMOXAx.js";import"./tvision-color.COTpcftn.js";import"./chroma-js.RLxBGt-u.js";import"./bezier-easing.qwUZoLR4.js";import"./lodash.C2dUGbaG.js";import"./axios.R-lXtGyY.js";import"./qs.2H4whylj.js";import"./side-channel.D4adRIkF.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.C4p7aaXq.js";import"./cron-parser.BHsRiybt.js";import"./luxon.BVaPVz1w.js";import"./side-channel-list.Mptt8X3N.js";import"./side-channel-map.DhhAKOp2.js";import"./get-intrinsic.DZF4l_-S.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.GRuZvLsk.js";import"./dunder-proto.BfGlLUzx.js";import"./call-bind-apply-helpers.DPbVMkjK.js";import"./function-bind.CHqF18-c.js";import"./hasown.B1sN64jK.js";import"./call-bound.DTRAK3sj.js";import"./side-channel-weakmap.CTWfHcrJ.js";import"./nprogress.BFWi6Yo1.js";import"./core-js-pure.DN77qAGa.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./lodash-es.ClUTdtmA.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";const re={key:0,class:"loading-wrapper"},ne={key:1,class:"input-group"},ie={class:"check-container"},de={class:"btn-wrapper"},ue={class:"msl-login-wrapper"},me={class:"reset-guide"},ce={class:"guide-item"},pe={class:"guide-title"},ge={class:"guide-item"},fe={class:"guide-title"},_e="remembered_url",C="remembered_username",ve=V({__name:"Login",setup(R){const u=G(),k=H(),_=Y(),s=A(),m=f(!1),v=f(!1),p=f(!1),b=f(!0),x=f(!1),l=J({url:localStorage.getItem(_e)||"",username:localStorage.getItem(C)||"",password:"",checked:!!localStorage.getItem(C)}),I=f(),E=Q(()=>{const i={username:[{required:!0,message:"è¯·è¾“å…¥ç”¨æˆ·å",type:"error"}],password:[{required:!0,message:"è¯·è¾“å…¥å¯†ç ",type:"error"}]};return p.value||(i.url=[{required:!0,message:"è¯·è¾“å…¥æœåŠ¡å™¨åœ°å€",type:"error"}]),i}),z=async()=>{b.value=!0,await u.checkConnection("")?(p.value=!0,l.url=""):p.value=!1,b.value=!1},D=async({validateResult:i})=>{if(i===!0){m.value=!0;try{await u.login({url:p.value?"":l.url,username:l.username,password:l.password,checked:l.checked}),L.success("ç™»å½•æˆåŠŸ");const e=s.query.redirect,c=e?decodeURIComponent(e):"/dashboard/base";_.push(c),W.success({content:`æ¬¢è¿å›æ¥ï¼${u.userInfo.name}`,title:"MSLX æ§åˆ¶å°"}),k.checkAppUpdate(!1)}catch(e){L.error(e.message||"ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥è´¦å·å¯†ç ")}finally{m.value=!1}}},B=async()=>{try{m.value=!0;const i=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);localStorage.setItem("oauth_state",i);const e=`${window.location.origin}/oauth/callback?mode=login`,c=await K.get({url:"/api/auth/oauth/url",params:{state:i,callback:e}});if(c&&c.url)window.location.href=c.url;else throw new Error(c.message||"è·å–æˆæƒåœ°å€å¤±è´¥")}catch(i){L.error(i.message||"æ— æ³•è¿æ¥åˆ°è®¤è¯æœåŠ¡å™¨"),m.value=!1}};return $(()=>{z()}),(i,e)=>{const c=r("t-loading"),g=r("t-icon"),S=r("t-input"),h=r("t-form-item"),N=r("t-checkbox"),q=r("t-link"),P=r("t-button"),X=r("t-form"),T=r("t-divider"),F=r("t-alert"),j=r("t-dialog");return w(),y("div",null,[o(X,{ref_key:"form",ref:I,class:"login-form",data:l,rules:E.value,"label-width":"0",onSubmit:D},{default:a(()=>[b.value?(w(),y("div",re,[o(c,{text:"æ­£åœ¨è¿æ¥æœåŠ¡...",size:"small"})])):(w(),y("div",ne,[p.value?ee("",!0):(w(),Z(h,{key:0,name:"url"},{default:a(()=>[o(S,{modelValue:l.url,"onUpdate:modelValue":e[0]||(e[0]=d=>l.url=d),size:"large",placeholder:"æœåŠ¡å™¨åœ°å€ (å¦‚ localhost:1027)",class:"glass-input"},{"prefix-icon":a(()=>[o(g,{name:"server"})]),_:1},8,["modelValue"])]),_:1})),o(h,{name:"username"},{default:a(()=>[o(S,{modelValue:l.username,"onUpdate:modelValue":e[1]||(e[1]=d=>l.username=d),size:"large",placeholder:"è¯·è¾“å…¥ç”¨æˆ·å",class:"glass-input"},{"prefix-icon":a(()=>[o(g,{name:"user"})]),_:1},8,["modelValue"])]),_:1}),o(h,{name:"password"},{default:a(()=>[o(S,{modelValue:l.password,"onUpdate:modelValue":e[3]||(e[3]=d=>l.password=d),size:"large",type:v.value?"text":"password",placeholder:"è¯·è¾“å…¥å¯†ç ",class:"glass-input"},{"prefix-icon":a(()=>[o(g,{name:"lock-on"})]),"suffix-icon":a(()=>[o(g,{name:v.value?"browse":"browse-off",style:{cursor:"pointer"},onClick:e[2]||(e[2]=d=>v.value=!v.value)},null,8,["name"])]),_:1},8,["modelValue","type"])]),_:1})])),t("div",ie,[o(N,{modelValue:l.checked,"onUpdate:modelValue":e[4]||(e[4]=d=>l.checked=d)},{default:a(()=>[...e[7]||(e[7]=[n("è®°ä½ç”¨æˆ·å",-1)])]),_:1},8,["modelValue"]),o(q,{theme:"primary",hover:"color",onClick:e[5]||(e[5]=d=>x.value=!0)},{default:a(()=>[...e[8]||(e[8]=[n(" å¿˜è®°å¯†ç ï¼Ÿ ",-1)])]),_:1})]),o(h,{class:"btn-container"},{default:a(()=>[t("div",de,[o(P,{block:"",size:"large",type:"submit",class:"login-btn",loading:m.value},{default:a(()=>[...e[9]||(e[9]=[n(" ç™» å½• ",-1)])]),_:1},8,["loading"]),t("div",ue,[t("a",{class:"msl-link-btn",onClick:B},[o(g,{name:"user-transmit"}),e[10]||(e[10]=t("span",null,"ä½¿ç”¨ MSL è´¦æˆ·ç™»å½•",-1))])])])]),_:1})]),_:1},8,["data","rules"]),o(j,{visible:x.value,"onUpdate:visible":e[6]||(e[6]=d=>x.value=d),header:"æ‰¾å›æˆ–é‡ç½®å¯†ç ",footer:!1,width:"480px",attach:"body"},{default:a(()=>[t("div",me,[t("div",ce,[t("div",pe,[o(g,{name:"user-talk"}),e[11]||(e[11]=n(" æ–¹å¼ä¸€ï¼šè”ç³»ç®¡ç†å‘˜",-1))]),e[12]||(e[12]=t("p",{class:"guide-desc"},"å¦‚æœç³»ç»Ÿä¸­å­˜åœ¨å…¶ä»–ç®¡ç†å‘˜è´¦å·ï¼Œè¯·è”ç³»å¯¹åº”äººå‘˜ååŠ©æ‚¨åœ¨åå°é‡ç½®å¯†ç ã€‚",-1))]),o(T,{dashed:"",style:{margin:"16px 0"}}),t("div",ge,[t("div",fe,[o(g,{name:"refresh"}),e[13]||(e[13]=n(" æ–¹å¼äºŒï¼šåˆå§‹åŒ–é»˜è®¤è´¦æˆ·",-1))]),e[15]||(e[15]=t("p",{class:"guide-desc"},"è‹¥æ— æ³•è”ç³»å…¶ä»–ç®¡ç†å‘˜ï¼Œè¯·åœ¨æœåŠ¡å™¨ç«¯åˆ é™¤ä»¥ä¸‹é…ç½®æ–‡ä»¶ï¼š",-1)),e[16]||(e[16]=t("div",{class:"code-block"},"DaemonData/Configs/UserList.json",-1)),t("p",null,[o(F,{style:{"margin-top":"10px"}},{default:a(()=>[...e[14]||(e[14]=[n("æ“ä½œæç¤ºï¼šåˆ é™¤è¯¥æ–‡ä»¶åï¼Œè¯·",-1),t("strong",null,"é‡å¯å®ˆæŠ¤è¿›ç¨‹",-1),n("ã€‚ç³»ç»Ÿå°†è‡ªåŠ¨é‡æ–°åˆ›å»ºåŒ…å«é»˜è®¤è´¦å·å¯†ç çš„åˆå§‹æ–‡ä»¶ã€‚",-1)])]),_:1})])])])]),_:1},8,["visible"])])}}}),be=U(ve,[["__scopeId","data-v-6b1c52ff"]]),we={class:"login-wrapper"},ke={class:"login-content"},he={class:"login-container"},ye={class:"copyright"},xe={class:"welcome-content"},Se={class:"account-card"},Le={class:"info-row"},Me={class:"label"},Ce={class:"info-row"},Ue={class:"label"},Ve={name:"LoginIndex"},$e=V({...Ve,setup(R){const u=f(!1),k=()=>{u.value=!1;const _=new URL(window.location.href);_.searchParams.delete("initialize"),window.history.replaceState({},"",_)};return $(()=>{new URLSearchParams(window.location.search).get("initialize")==="true"&&(u.value=!0)}),(_,s)=>{const m=r("t-alert"),v=r("t-button"),p=r("t-dialog");return w(),y("div",we,[o(oe,{class:"login-header-fixed"}),t("div",ke,[t("div",he,[s[1]||(s[1]=t("div",{class:"title-container"},[t("h1",{class:"title"},"è¿æ¥åˆ° MSLX"),t("p",{class:"sub-title"},"ç½‘é¡µç®¡ç†ä¸­å¿ƒ")],-1)),o(be),t("footer",ye,"Copyright @ 2021-"+te(new Date().getFullYear())+" MSLTeam",1)])]),o(O,{class:"tdesign-setting-outside"}),o(p,{visible:u.value,"onUpdate:visible":s[0]||(s[0]=b=>u.value=b),footer:!1,"close-btn":!0,width:"480px",attach:"body",class:"welcome-dialog","on-close":k},{header:a(()=>[...s[2]||(s[2]=[t("div",{class:"dialog-header-row"},[t("span",{class:"emoji-icon"},"ğŸ‰"),t("span",{class:"header-text"},"æ¬¢è¿ä½¿ç”¨ MSLX å¼€æœå™¨")],-1)])]),default:a(()=>[t("div",xe,[o(m,{theme:"success",class:"security-alert"},{message:a(()=>[...s[3]||(s[3]=[n(" æ‚¨ä¼¼ä¹æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Ÿè¯·æŸ¥é˜…ä»¥ä¸‹ä¿¡æ¯ï¼Œç„¶åå¼€å§‹äº«å—æ‚¨çš„MCå¼€æœä¹‹æ—…å§ï½ ",-1)])]),_:1}),t("div",Se,[t("div",Le,[t("span",Me,[o(M(se)),s[4]||(s[4]=n(" é»˜è®¤è´¦æˆ·:",-1))]),s[5]||(s[5]=t("span",{class:"value highlight"},"mslx",-1))]),t("div",Ce,[t("span",Ue,[o(M(ae)),s[6]||(s[6]=n(" é»˜è®¤å¯†ç :",-1))]),s[7]||(s[7]=t("span",{class:"value mono"},"è¯·åœ¨MSLXå®ˆæŠ¤è¿›ç¨‹ç«¯æ§åˆ¶å°æŸ¥çœ‹",-1))])]),o(m,{theme:"warning",class:"security-alert"},{message:a(()=>[...s[8]||(s[8]=[n(" å®‰å…¨æé†’ï¼šè¯·ç™»å½•å",-1),t("b",null,[t("u",null,"ç«‹å³ä¿®æ”¹é»˜è®¤çš„è´¦æˆ·åå’Œå¯†ç ")],-1),n("ï¼Œä¿éšœæ‚¨çš„æœåŠ¡å®‰å…¨ã€‚ ",-1)])]),_:1}),o(v,{block:"",theme:"primary",size:"large",variant:"base",onClick:k},{icon:a(()=>[o(M(le))]),default:a(()=>[s[9]||(s[9]=n(" æˆ‘å·²çŸ¥æ™“ï¼Œç«‹å³ç™»å½• ",-1))]),_:1})])]),_:1},8,["visible"])])}}}),wt=U($e,[["__scopeId","data-v-59aa3632"]]);export{wt as default};
