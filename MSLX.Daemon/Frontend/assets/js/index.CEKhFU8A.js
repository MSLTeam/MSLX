import{u as G,a as H}from"./vue-router.BSuyFzNa.js";import{u as J,a as Z,r as C,_ as R,T as K}from"./index.Cr1BKOIM.js";import{M,N as Q}from"./tdesign-vue-next.4sGFOLeu.js";import{l as I,k as W,o as E,aZ as r,aU as w,aV as b,j as s,a$ as a,a_ as ee,b3 as V,aY as t,G as n,r as p,c as te,b2 as se,J as U}from"./index.DuVfB4dr.js";import{L as oe}from"./Header.DX5u8QmL.js";import{a7 as ae,a8 as le,a2 as re}from"./tdesign-icons-vue-next.ELWhrgRC.js";import"./pinia.K9HejpEf.js";import"./pinia-plugin-persistedstate_2eabddac918ad8d0cf74e67f4601f4c8.n2tMOXAx.js";import"./tvision-color.Cy78gTfV.js";import"./chroma-js.DO2ptVd8.js";import"./core-js-pure.DbDavgKW.js";import"./bezier-easing.D5A5epFU.js";import"./lodash.CpoxsuHF.js";import"./axios.B9ygI19o.js";import"./qs.B2qFNmGA.js";import"./side-channel.BIlHSgJq.js";import"./es-errors.CFxpeikN.js";import"./object-inspect.CWmL7r7A.js";import"./side-channel-list.DZ_HK50j.js";import"./side-channel-map.DDbmCn0b.js";import"./get-intrinsic.DL3knghB.js";import"./es-object-atoms.Ditt1eQ6.js";import"./math-intrinsics.Cv-yPkyD.js";import"./gopd.fcd2-aIC.js";import"./es-define-property.bDCdrV83.js";import"./has-symbols.BaUvM3gb.js";import"./get-proto.Cbri-GHQ.js";import"./dunder-proto.q7lw_6_J.js";import"./call-bind-apply-helpers.BxcZtPLH.js";import"./function-bind.BbkWVFrm.js";import"./hasown.ckq0ukzO.js";import"./call-bound.Cne7q6oT.js";import"./side-channel-weakmap.BTkyjVO1.js";import"./nprogress.COlaCQ7y.js";import"./crelt.C8TCjufn.js";import"./style-mod.Bc2inJdb.js";import"./w3c-keyname.Vcq4gwWv.js";import"./lodash-es.sbUBen0f.js";import"./mitt.DJ65BbbF.js";import"./sortablejs.C83syoBY.js";const ne={key:0,class:"loading-wrapper"},ie={key:1,class:"input-group"},ue={class:"check-container"},de={class:"btn-wrapper"},me={key:0,class:"msl-login-wrapper"},ce={class:"reset-guide"},pe={class:"guide-item"},ge={class:"guide-title"},fe={class:"guide-item"},_e={class:"guide-title"},ve="remembered_url",$="remembered_username",we=I({__name:"Login",setup(z){const d=J(),k=Z(),_=G(),o=H(),m=p(!1),h=p(!1),v=p(!1),g=p(!1),y=p(!0),S=p(!1),l=W({url:localStorage.getItem(ve)||"",username:localStorage.getItem($)||"",password:"",checked:!!localStorage.getItem($)}),B=p(),D=te(()=>{const i={username:[{required:!0,message:"è¯·è¾“å…¥ç”¨æˆ·å",type:"error"}],password:[{required:!0,message:"è¯·è¾“å…¥å¯†ç ",type:"error"}]};return g.value||(i.url=[{required:!0,message:"è¯·è¾“å…¥æœåŠ¡å™¨åœ°å€",type:"error"}]),i}),N=async()=>{y.value=!0,await d.checkConnection("")?(g.value=!0,l.url=""):g.value=!1;try{(await C.get({url:"/api/auth/oauth/status"})).allowOAuth&&(h.value=!0),y.value=!1}catch{y.value=!1}},q=async({validateResult:i})=>{if(i===!0){m.value=!0;try{await d.login({url:g.value?"":l.url,username:l.username,password:l.password,checked:l.checked}),M.success("ç™»å½•æˆåŠŸ");const e=o.query.redirect,c=e?decodeURIComponent(e):"/dashboard/base";_.push(c),Q.success({content:`æ¬¢è¿å›æ¥ï¼${d.userInfo.name}`,title:"MSLX æ§åˆ¶å°"}),k.checkAppUpdate(!1)}catch(e){M.error(e.message||"ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥è´¦å·å¯†ç ")}finally{m.value=!1}}},P=async()=>{try{m.value=!0;const i=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);localStorage.setItem("oauth_state",i);const e=`${window.location.origin}/oauth/callback?mode=login`,c=await C.get({url:"/api/auth/oauth/url",params:{state:i,callback:e}});if(c&&c.url)window.location.href=c.url;else throw new Error(c.message||"è·å–æˆæƒåœ°å€å¤±è´¥")}catch(i){M.error(i.message||"æ— æ³•è¿æ¥åˆ°è®¤è¯æœåŠ¡å™¨"),m.value=!1}};return E(()=>{N()}),(i,e)=>{const c=r("t-loading"),f=r("t-icon"),L=r("t-input"),x=r("t-form-item"),T=r("t-checkbox"),X=r("t-link"),j=r("t-button"),A=r("t-form"),O=r("t-divider"),F=r("t-alert"),Y=r("t-dialog");return w(),b("div",null,[s(A,{ref_key:"form",ref:B,class:"login-form",data:l,rules:D.value,"label-width":"0",onSubmit:q},{default:a(()=>[y.value?(w(),b("div",ne,[s(c,{text:"æ­£åœ¨è¿æ¥æœåŠ¡...",size:"small"})])):(w(),b("div",ie,[g.value?V("",!0):(w(),ee(x,{key:0,name:"url"},{default:a(()=>[s(L,{modelValue:l.url,"onUpdate:modelValue":e[0]||(e[0]=u=>l.url=u),size:"large",placeholder:"æœåŠ¡å™¨åœ°å€ (å¦‚ localhost:1027)",class:"glass-input"},{"prefix-icon":a(()=>[s(f,{name:"server"})]),_:1},8,["modelValue"])]),_:1})),s(x,{name:"username"},{default:a(()=>[s(L,{modelValue:l.username,"onUpdate:modelValue":e[1]||(e[1]=u=>l.username=u),size:"large",placeholder:"è¯·è¾“å…¥ç”¨æˆ·å",class:"glass-input"},{"prefix-icon":a(()=>[s(f,{name:"user"})]),_:1},8,["modelValue"])]),_:1}),s(x,{name:"password"},{default:a(()=>[s(L,{modelValue:l.password,"onUpdate:modelValue":e[3]||(e[3]=u=>l.password=u),size:"large",type:v.value?"text":"password",placeholder:"è¯·è¾“å…¥å¯†ç ",class:"glass-input"},{"prefix-icon":a(()=>[s(f,{name:"lock-on"})]),"suffix-icon":a(()=>[s(f,{name:v.value?"browse":"browse-off",style:{cursor:"pointer"},onClick:e[2]||(e[2]=u=>v.value=!v.value)},null,8,["name"])]),_:1},8,["modelValue","type"])]),_:1})])),t("div",ue,[s(T,{modelValue:l.checked,"onUpdate:modelValue":e[4]||(e[4]=u=>l.checked=u)},{default:a(()=>[...e[7]||(e[7]=[n("è®°ä½ç”¨æˆ·å",-1)])]),_:1},8,["modelValue"]),s(X,{theme:"primary",hover:"color",onClick:e[5]||(e[5]=u=>S.value=!0)},{default:a(()=>[...e[8]||(e[8]=[n(" å¿˜è®°å¯†ç ï¼Ÿ ",-1)])]),_:1})]),s(x,{class:"btn-container"},{default:a(()=>[t("div",de,[s(j,{block:"",size:"large",type:"submit",class:"login-btn",loading:m.value},{default:a(()=>[...e[9]||(e[9]=[n(" ç™» å½• ",-1)])]),_:1},8,["loading"]),h.value?(w(),b("div",me,[t("a",{class:"msl-link-btn",onClick:P},[s(f,{name:"user-transmit"}),e[10]||(e[10]=t("span",null,"ä½¿ç”¨ MSL è´¦æˆ·ç™»å½•",-1))])])):V("",!0)])]),_:1})]),_:1},8,["data","rules"]),s(Y,{visible:S.value,"onUpdate:visible":e[6]||(e[6]=u=>S.value=u),header:"æ‰¾å›æˆ–é‡ç½®å¯†ç ",footer:!1,width:"480px",attach:"body"},{default:a(()=>[t("div",ce,[t("div",pe,[t("div",ge,[s(f,{name:"user-talk"}),e[11]||(e[11]=n(" æ–¹å¼ä¸€ï¼šè”ç³»ç®¡ç†å‘˜",-1))]),e[12]||(e[12]=t("p",{class:"guide-desc"},"å¦‚æœç³»ç»Ÿä¸­å­˜åœ¨å…¶ä»–ç®¡ç†å‘˜è´¦å·ï¼Œè¯·è”ç³»å¯¹åº”äººå‘˜ååŠ©æ‚¨åœ¨åå°é‡ç½®å¯†ç ã€‚",-1))]),s(O,{dashed:"",style:{margin:"16px 0"}}),t("div",fe,[t("div",_e,[s(f,{name:"refresh"}),e[13]||(e[13]=n(" æ–¹å¼äºŒï¼šåˆå§‹åŒ–é»˜è®¤è´¦æˆ·",-1))]),e[15]||(e[15]=t("p",{class:"guide-desc"},"è‹¥æ— æ³•è”ç³»å…¶ä»–ç®¡ç†å‘˜ï¼Œè¯·åœ¨æœåŠ¡å™¨ç«¯åˆ é™¤ä»¥ä¸‹é…ç½®æ–‡ä»¶ï¼š",-1)),e[16]||(e[16]=t("div",{class:"code-block"},"DaemonData/Configs/UserList.json",-1)),t("p",null,[s(F,{style:{"margin-top":"10px"}},{default:a(()=>[...e[14]||(e[14]=[n("æ“ä½œæç¤ºï¼šåˆ é™¤è¯¥æ–‡ä»¶åï¼Œè¯·",-1),t("strong",null,"é‡å¯å®ˆæŠ¤è¿›ç¨‹",-1),n("ã€‚ç³»ç»Ÿå°†è‡ªåŠ¨é‡æ–°åˆ›å»ºåŒ…å«é»˜è®¤è´¦å·å¯†ç çš„åˆå§‹æ–‡ä»¶ã€‚",-1)])]),_:1})])])])]),_:1},8,["visible"])])}}}),be=R(we,[["__scopeId","data-v-b95f4e77"]]),ke={class:"login-wrapper"},he={class:"login-content"},ye={class:"login-container"},xe={class:"copyright"},Se={class:"welcome-content"},Le={class:"account-card"},Me={class:"info-row"},Ue={class:"label"},Ce={class:"info-row"},Ve={class:"label"},$e={name:"LoginIndex"},Re=I({...$e,setup(z){const d=p(!1),k=()=>{d.value=!1;const _=new URL(window.location.href);_.searchParams.delete("initialize"),window.history.replaceState({},"",_)};return E(()=>{new URLSearchParams(window.location.search).get("initialize")==="true"&&(d.value=!0)}),(_,o)=>{const m=r("t-alert"),h=r("t-button"),v=r("t-dialog");return w(),b("div",ke,[s(oe,{class:"login-header-fixed"}),t("div",he,[t("div",ye,[o[1]||(o[1]=t("div",{class:"title-container"},[t("h1",{class:"title"},"è¿æ¥åˆ° MSLX"),t("p",{class:"sub-title"},"ç½‘é¡µç®¡ç†ä¸­å¿ƒ")],-1)),s(be),t("footer",xe,"Copyright @ 2021-"+se(new Date().getFullYear())+" MSLTeam",1)])]),s(K,{class:"tdesign-setting-outside"}),s(v,{visible:d.value,"onUpdate:visible":o[0]||(o[0]=g=>d.value=g),footer:!1,"close-btn":!0,width:"480px",attach:"body",class:"welcome-dialog","on-close":k},{header:a(()=>[...o[2]||(o[2]=[t("div",{class:"dialog-header-row"},[t("span",{class:"emoji-icon"},"ğŸ‰"),t("span",{class:"header-text"},"æ¬¢è¿ä½¿ç”¨ MSLX å¼€æœå™¨")],-1)])]),default:a(()=>[t("div",Se,[s(m,{theme:"success",class:"security-alert"},{message:a(()=>[...o[3]||(o[3]=[n(" æ‚¨ä¼¼ä¹æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Ÿè¯·æŸ¥é˜…ä»¥ä¸‹ä¿¡æ¯ï¼Œç„¶åå¼€å§‹äº«å—æ‚¨çš„MCå¼€æœä¹‹æ—…å§ï½ ",-1)])]),_:1}),t("div",Le,[t("div",Me,[t("span",Ue,[s(U(ae)),o[4]||(o[4]=n(" é»˜è®¤è´¦æˆ·:",-1))]),o[5]||(o[5]=t("span",{class:"value highlight"},"mslx",-1))]),t("div",Ce,[t("span",Ve,[s(U(le)),o[6]||(o[6]=n(" é»˜è®¤å¯†ç :",-1))]),o[7]||(o[7]=t("span",{class:"value mono"},"è¯·åœ¨MSLXå®ˆæŠ¤è¿›ç¨‹ç«¯æ§åˆ¶å°æŸ¥çœ‹",-1))])]),s(m,{theme:"warning",class:"security-alert"},{message:a(()=>[...o[8]||(o[8]=[n(" å®‰å…¨æé†’ï¼šè¯·ç™»å½•å",-1),t("b",null,[t("u",null,"ç«‹å³ä¿®æ”¹é»˜è®¤çš„è´¦æˆ·åå’Œå¯†ç ")],-1),n("ï¼Œä¿éšœæ‚¨çš„æœåŠ¡å®‰å…¨ã€‚ ",-1)])]),_:1}),s(h,{block:"",theme:"primary",size:"large",variant:"base",onClick:k},{icon:a(()=>[s(U(re))]),default:a(()=>[o[9]||(o[9]=n(" æˆ‘å·²çŸ¥æ™“ï¼Œç«‹å³ç™»å½• ",-1))]),_:1})])]),_:1},8,["visible"])])}}}),wt=R(Re,[["__scopeId","data-v-59aa3632"]]);export{wt as default};
